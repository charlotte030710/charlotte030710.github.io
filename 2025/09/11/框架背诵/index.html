<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>框架背诵 | 浮生若梦</title><meta name="author" content="Charlotte"><meta name="copyright" content="Charlotte"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Java框架核心知识详解一、Spring框架深入解析1.1 Spring核心概念与原理Spring框架是一个分层的企业级应用开发框架，其核心是控制反转（IoC）和面向切面编程（AOP）。 IoC容器原理深入分析IoC（控制反转）的本质： 传统开发中，对象的创建和依赖关系由程序代码直接控制，而IoC将这个控制权交给了外部容器。Spring通过依赖注入（DI）来实现IoC。 IoC容器的实现机制：">
<meta property="og:type" content="article">
<meta property="og:title" content="框架背诵">
<meta property="og:url" content="http://example.com/2025/09/11/%E6%A1%86%E6%9E%B6%E8%83%8C%E8%AF%B5/index.html">
<meta property="og:site_name" content="浮生若梦">
<meta property="og:description" content="Java框架核心知识详解一、Spring框架深入解析1.1 Spring核心概念与原理Spring框架是一个分层的企业级应用开发框架，其核心是控制反转（IoC）和面向切面编程（AOP）。 IoC容器原理深入分析IoC（控制反转）的本质： 传统开发中，对象的创建和依赖关系由程序代码直接控制，而IoC将这个控制权交给了外部容器。Spring通过依赖注入（DI）来实现IoC。 IoC容器的实现机制：">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/title.jpg">
<meta property="article:published_time" content="2025-09-11T10:29:28.000Z">
<meta property="article:modified_time" content="2025-09-11T10:29:28.011Z">
<meta property="article:author" content="Charlotte">
<meta property="article:tag" content="Hexo, Markdown">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/title.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "框架背诵",
  "url": "http://example.com/2025/09/11/%E6%A1%86%E6%9E%B6%E8%83%8C%E8%AF%B5/",
  "image": "http://example.com/img/title.jpg",
  "datePublished": "2025-09-11T10:29:28.000Z",
  "dateModified": "2025-09-11T10:29:28.011Z",
  "author": [
    {
      "@type": "Person",
      "name": "Charlotte",
      "url": "http://example.com"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.svg"><link rel="canonical" href="http://example.com/2025/09/11/%E6%A1%86%E6%9E%B6%E8%83%8C%E8%AF%B5/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '框架背诵',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/custom.css"><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="浮生若梦" type="application/atom+xml">
</head><body><div id="web_bg" style="background-image: url(/img/bg.jpg);"></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/bg.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/img/title.jpg" alt="Logo"><span class="site-name">浮生若梦</span></a><a class="nav-page-title" href="/"><span class="site-name">框架背诵</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"></div></nav><div id="post-info"><h1 class="post-title">框架背诵</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-09-11T10:29:28.000Z" title="发表于 2025-09-11 18:29:28">2025-09-11</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-09-11T10:29:28.011Z" title="更新于 2025-09-11 18:29:28">2025-09-11</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%9C%AA%E5%88%86%E7%B1%BB/">未分类</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="Java框架核心知识详解"><a href="#Java框架核心知识详解" class="headerlink" title="Java框架核心知识详解"></a>Java框架核心知识详解</h1><h2 id="一、Spring框架深入解析"><a href="#一、Spring框架深入解析" class="headerlink" title="一、Spring框架深入解析"></a>一、Spring框架深入解析</h2><h3 id="1-1-Spring核心概念与原理"><a href="#1-1-Spring核心概念与原理" class="headerlink" title="1.1 Spring核心概念与原理"></a>1.1 Spring核心概念与原理</h3><p>Spring框架是一个分层的企业级应用开发框架，其核心是控制反转（IoC）和面向切面编程（AOP）。</p>
<h4 id="IoC容器原理深入分析"><a href="#IoC容器原理深入分析" class="headerlink" title="IoC容器原理深入分析"></a>IoC容器原理深入分析</h4><p><strong>IoC（控制反转）的本质：</strong> 传统开发中，对象的创建和依赖关系由程序代码直接控制，而IoC将这个控制权交给了外部容器。Spring通过依赖注入（DI）来实现IoC。</p>
<p><strong>IoC容器的实现机制：</strong></p>
<ol>
<li><strong>BeanFactory</strong>: 基础容器，提供基本的IoC功能</li>
<li><strong>ApplicationContext</strong>: 高级容器，继承BeanFactory，提供更多企业级功能</li>
</ol>
<p><strong>Bean的生命周期详解：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">实例化 → 属性赋值 → 初始化前处理 → 初始化 → 初始化后处理 → 使用 → 销毁前处理 → 销毁</span><br></pre></td></tr></table></figure>

<p><strong>详细生命周期步骤：</strong></p>
<ol>
<li>Bean元数据解析（XML、注解、Java配置）</li>
<li>调用Bean构造函数实例化</li>
<li>依赖注入（setter方法、构造函数、字段注入）</li>
<li>如果实现了BeanNameAware，调用setBeanName()</li>
<li>如果实现了BeanFactoryAware，调用setBeanFactory()</li>
<li>如果实现了ApplicationContextAware，调用setApplicationContext()</li>
<li>如果有BeanPostProcessor，调用postProcessBeforeInitialization()</li>
<li>如果实现了InitializingBean，调用afterPropertiesSet()</li>
<li>如果配置了init-method，调用自定义初始化方法</li>
<li>如果有BeanPostProcessor，调用postProcessAfterInitialization()</li>
<li>Bean可以被使用</li>
<li>容器关闭时，如果实现了DisposableBean，调用destroy()</li>
<li>如果配置了destroy-method，调用自定义销毁方法</li>
</ol>
<h4 id="DI的三种注入方式对比"><a href="#DI的三种注入方式对比" class="headerlink" title="DI的三种注入方式对比"></a>DI的三种注入方式对比</h4><ul>
<li><p><strong>构造器注入（Constructor Injection）</strong></p>
<ul>
<li><strong>优点</strong>：强制依赖、依赖清晰、不可变性</li>
<li><strong>缺点</strong>：当依赖项过多时构造函数臃肿</li>
<li><strong>最佳实践</strong>：官方推荐，特别是当依赖是必需的、不可选的时候</li>
</ul>
</li>
<li><p><strong>Setter注入（Setter Injection）</strong></p>
<ul>
<li><strong>优点</strong>：可选依赖，灵活性高</li>
<li><strong>缺点</strong>：对象可能处于不完整状态，无法使用final修饰</li>
<li><strong>最佳实践</strong>：用于注入可选的依赖项</li>
</ul>
</li>
<li><p><strong>字段注入（Field Injection）</strong></p>
<ul>
<li><strong>优点</strong>：代码简洁</li>
<li><strong>缺点</strong>：不推荐使用，隐藏依赖、测试困难、无法使用final修饰</li>
</ul>
</li>
</ul>
<h4 id="AOP原理深入分析"><a href="#AOP原理深入分析" class="headerlink" title="AOP原理深入分析"></a>AOP原理深入分析</h4><p><strong>AOP实现机制：</strong> Spring AOP基于代理模式实现，支持两种代理方式：</p>
<ol>
<li><strong>JDK动态代理</strong>: 针对实现了接口的类</li>
<li><strong>CGLIB代理</strong>: 针对没有实现接口的类</li>
</ol>
<p>我们来系统性地讲解一下 <strong>Spring AOP 的实现机制</strong>，包括：</p>
<ol>
<li>JDK 动态代理</li>
<li>CGLIB 动态代理</li>
<li>静态代理（对比说明）</li>
</ol>
<hr>
<h2 id="🌟-一、Spring-AOP-实现机制概述"><a href="#🌟-一、Spring-AOP-实现机制概述" class="headerlink" title="🌟 一、Spring AOP 实现机制概述"></a>🌟 一、Spring AOP 实现机制概述</h2><p>Spring AOP（面向切面编程）是基于 <strong>代理模式</strong> 实现的，它通过在目标方法执行前后织入逻辑（增强），实现横切关注点（如日志、安全、事务等）的分离。</p>
<blockquote>
<p>Spring AOP 仅支持方法级别的代理（即对方法进行增强），不支持字段、构造器等底层字节码增强（这要用 AspectJ）。</p>
</blockquote>
<hr>
<h2 id="🧩-二、Spring-AOP-的两种动态代理方式"><a href="#🧩-二、Spring-AOP-的两种动态代理方式" class="headerlink" title="🧩 二、Spring AOP 的两种动态代理方式"></a>🧩 二、Spring AOP 的两种动态代理方式</h2><h3 id="1️⃣-JDK-动态代理（基于接口）"><a href="#1️⃣-JDK-动态代理（基于接口）" class="headerlink" title="1️⃣ JDK 动态代理（基于接口）"></a>1️⃣ JDK 动态代理（基于接口）</h3><h4 id="✅-原理："><a href="#✅-原理：" class="headerlink" title="✅ 原理："></a>✅ 原理：</h4><ul>
<li>基于 Java 的 <code>java.lang.reflect.Proxy</code> 类实现。</li>
<li>必须要有接口，Spring 会为接口生成代理类。</li>
<li>代理类在运行时实现接口，并将调用委托给 InvocationHandler。</li>
</ul>
<h4 id="📦-示例："><a href="#📦-示例：" class="headerlink" title="📦 示例："></a>📦 示例：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">addUser</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addUser</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;添加用户&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Spring AOP 为 <code>UserService</code> 创建代理：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">UserService</span> <span class="variable">proxy</span> <span class="operator">=</span> (UserService) Proxy.newProxyInstance(</span><br><span class="line">    userService.getClass().getClassLoader(),</span><br><span class="line">    userService.getClass().getInterfaces(),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">InvocationHandler</span>() &#123;</span><br><span class="line">        <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;前置增强&quot;</span>);</span><br><span class="line">            <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> method.invoke(userService, args);</span><br><span class="line">            System.out.println(<span class="string">&quot;后置增强&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<h4 id="🎯-特点："><a href="#🎯-特点：" class="headerlink" title="🎯 特点："></a>🎯 特点：</h4><table>
<thead>
<tr>
<th>特性</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>是否依赖接口</td>
<td>✅ 是</td>
</tr>
<tr>
<td>性能</td>
<td>较高（比 CGLIB 略快）</td>
</tr>
<tr>
<td>生成的代理类</td>
<td>实现接口</td>
</tr>
</tbody></table>
<hr>
<h3 id="2️⃣-CGLIB-动态代理（基于子类）"><a href="#2️⃣-CGLIB-动态代理（基于子类）" class="headerlink" title="2️⃣ CGLIB 动态代理（基于子类）"></a>2️⃣ CGLIB 动态代理（基于子类）</h3><h4 id="✅-原理：-1"><a href="#✅-原理：-1" class="headerlink" title="✅ 原理："></a>✅ 原理：</h4><ul>
<li>使用 CGLIB 库在运行时 <strong>生成目标类的子类</strong>，并重写其方法来实现增强。</li>
<li>适用于 <strong>没有接口</strong> 的类，或者想对类本身增强而非接口。</li>
</ul>
<h4 id="🧪-示例："><a href="#🧪-示例：" class="headerlink" title="🧪 示例："></a>🧪 示例：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addUser</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;添加用户&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Spring 通过 CGLIB 生成子类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Enhancer</span> <span class="variable">enhancer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Enhancer</span>();</span><br><span class="line">enhancer.setSuperclass(UserService.class);</span><br><span class="line">enhancer.setCallback(<span class="keyword">new</span> <span class="title class_">MethodInterceptor</span>() &#123;</span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">intercept</span><span class="params">(Object obj, Method method, Object[] args, MethodProxy proxy)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;前置增强&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> proxy.invokeSuper(obj, args);</span><br><span class="line">        System.out.println(<span class="string">&quot;后置增强&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="type">UserService</span> <span class="variable">proxy</span> <span class="operator">=</span> (UserService) enhancer.create();</span><br></pre></td></tr></table></figure>

<h4 id="🎯-特点：-1"><a href="#🎯-特点：-1" class="headerlink" title="🎯 特点："></a>🎯 特点：</h4><table>
<thead>
<tr>
<th>特性</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>是否依赖接口</td>
<td>❌ 否</td>
</tr>
<tr>
<td>是否可代理 final 类&#x2F;方法</td>
<td>❌ 否（final 无法被继承&#x2F;重写）</td>
</tr>
<tr>
<td>生成的代理类</td>
<td>子类</td>
</tr>
</tbody></table>
<hr>
<h2 id="🏗-三、静态代理（对比动态代理）"><a href="#🏗-三、静态代理（对比动态代理）" class="headerlink" title="🏗 三、静态代理（对比动态代理）"></a>🏗 三、静态代理（对比动态代理）</h2><h3 id="✅-原理：-2"><a href="#✅-原理：-2" class="headerlink" title="✅ 原理："></a>✅ 原理：</h3><ul>
<li>自己写一个代理类，<strong>实现相同接口</strong>，将方法调用委托给目标对象，并在调用前后手动添加增强逻辑。</li>
</ul>
<h4 id="🧪-示例：-1"><a href="#🧪-示例：-1" class="headerlink" title="🧪 示例："></a>🧪 示例：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">addUser</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addUser</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;添加用户&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 静态代理类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceProxy</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> UserService target;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserServiceProxy</span><span class="params">(UserService target)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.target = target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addUser</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;前置增强&quot;</span>);</span><br><span class="line">        target.addUser();</span><br><span class="line">        System.out.println(<span class="string">&quot;后置增强&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="🎯-特点：-2"><a href="#🎯-特点：-2" class="headerlink" title="🎯 特点："></a>🎯 特点：</h4><table>
<thead>
<tr>
<th>特性</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>是否自动生成</td>
<td>❌ 需手动编码</td>
</tr>
<tr>
<td>灵活性</td>
<td>差（每个类都要写一个代理类）</td>
</tr>
<tr>
<td>是否支持 AOP</td>
<td>❌ 无法动态织入多个切面</td>
</tr>
</tbody></table>
<hr>
<h2 id="🔚-四、三者对比总结"><a href="#🔚-四、三者对比总结" class="headerlink" title="🔚 四、三者对比总结"></a>🔚 四、三者对比总结</h2><table>
<thead>
<tr>
<th>特性</th>
<th>静态代理</th>
<th>JDK 动态代理</th>
<th>CGLIB 动态代理</th>
</tr>
</thead>
<tbody><tr>
<td>是否依赖接口</td>
<td>✅ 是</td>
<td>✅ 是</td>
<td>❌ 否</td>
</tr>
<tr>
<td>是否自动生成代理类</td>
<td>❌ 手动编写</td>
<td>✅ 运行时生成</td>
<td>✅ 运行时生成</td>
</tr>
<tr>
<td>是否可代理类</td>
<td>❌ 否（接口为主）</td>
<td>❌ 否（接口为主）</td>
<td>✅ 是（类的子类）</td>
</tr>
<tr>
<td>性能</td>
<td>一般</td>
<td>较高</td>
<td>略慢（但可接受）</td>
</tr>
<tr>
<td>是否支持 final 方法</td>
<td>✅</td>
<td>✅</td>
<td>❌ 否</td>
</tr>
</tbody></table>
<hr>
<h2 id="✅-Spring-如何选择代理方式？"><a href="#✅-Spring-如何选择代理方式？" class="headerlink" title="✅ Spring 如何选择代理方式？"></a>✅ Spring 如何选择代理方式？</h2><ul>
<li>默认使用 JDK 动态代理（如果目标类实现了接口）。</li>
<li>如果目标类没有接口，Spring 自动切换为 CGLIB。</li>
<li>可以强制使用 CGLIB：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableAspectJAutoProxy(proxyTargetClass = true)</span></span><br></pre></td></tr></table></figure>

<p><strong>AOP核心概念：</strong></p>
<ul>
<li><strong>切面（Aspect）</strong>: 横切关注点的模块化</li>
<li><strong>连接点（Joinpoint）</strong>: 程序执行中的特定点</li>
<li><strong>切点（Pointcut）</strong>: 连接点的集合</li>
<li><strong>通知（Advice）</strong>: 切面在特定连接点执行的代码</li>
<li><strong>目标对象（Target）</strong>: 被代理的对象</li>
<li><strong>代理对象（Proxy）</strong>: AOP框架创建的对象</li>
</ul>
<p><strong>JDK动态代理 vs. CGLIB动态代理</strong></p>
<ul>
<li><p><strong>JDK动态代理</strong>：</p>
<ul>
<li>基于接口实现</li>
<li>使用Proxy.newProxyInstance()创建代理</li>
<li>只能代理实现了接口的类</li>
</ul>
</li>
<li><p><strong>CGLIB动态代理</strong>：</p>
<ul>
<li>基于继承实现</li>
<li>使用Enhancer类创建代理</li>
<li>可以代理普通类</li>
<li>不能代理final类和方法</li>
</ul>
</li>
</ul>
<h3 id="1-2-Spring核心注解详解"><a href="#1-2-Spring核心注解详解" class="headerlink" title="1.2 Spring核心注解详解"></a>1.2 Spring核心注解详解</h3><h4 id="基础配置注解"><a href="#基础配置注解" class="headerlink" title="基础配置注解"></a>基础配置注解</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>  <span class="comment">// 表示这是一个配置类</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &quot;com.example&quot;)</span>  <span class="comment">// 组件扫描</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span>  <span class="comment">// 启用自动配置</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span>  <span class="comment">// SpringBoot主类注解，包含上述三个</span></span><br><span class="line"><span class="meta">@Import(OtherConfig.class)</span>  <span class="comment">// 导入其他配置类</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;classpath:application.properties&quot;)</span>  <span class="comment">// 加载属性文件</span></span><br></pre></td></tr></table></figure>

<h4 id="Bean定义注解"><a href="#Bean定义注解" class="headerlink" title="Bean定义注解"></a>Bean定义注解</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>  <span class="comment">// 通用组件</span></span><br><span class="line"><span class="meta">@Service</span>    <span class="comment">// 业务层组件</span></span><br><span class="line"><span class="meta">@Repository</span> <span class="comment">// 数据访问层组件</span></span><br><span class="line"><span class="meta">@Controller</span> <span class="comment">// 控制层组件</span></span><br><span class="line"><span class="meta">@RestController</span> <span class="comment">// RESTful控制器，相当于@Controller + @ResponseBody</span></span><br><span class="line"><span class="meta">@Bean</span>       <span class="comment">// 方法级别，定义Bean</span></span><br><span class="line"><span class="meta">@Scope(&quot;singleton/prototype/request/session&quot;)</span>  <span class="comment">// Bean作用域</span></span><br><span class="line"><span class="meta">@Lazy</span>       <span class="comment">// 延迟初始化</span></span><br><span class="line"><span class="meta">@Primary</span>    <span class="comment">// 优先注入</span></span><br><span class="line"><span class="meta">@Qualifier(&quot;beanName&quot;)</span>  <span class="comment">// 指定注入的Bean名称</span></span><br></pre></td></tr></table></figure>

<h4 id="依赖注入注解"><a href="#依赖注入注解" class="headerlink" title="依赖注入注解"></a>依赖注入注解</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span>  <span class="comment">// 自动装配，可用于构造函数、方法、字段</span></span><br><span class="line"><span class="meta">@Resource</span>   <span class="comment">// JSR-250标准，按名称注入</span></span><br><span class="line"><span class="meta">@Inject</span>     <span class="comment">// JSR-330标准</span></span><br><span class="line"><span class="meta">@Value(&quot;$&#123;property.name&#125;&quot;)</span>  <span class="comment">// 注入配置值</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;app&quot;)</span>  <span class="comment">// 绑定配置属性</span></span><br></pre></td></tr></table></figure>

<h4 id="生命周期注解"><a href="#生命周期注解" class="headerlink" title="生命周期注解"></a>生命周期注解</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostConstruct</span>  <span class="comment">// 初始化方法</span></span><br><span class="line"><span class="meta">@PreDestroy</span>     <span class="comment">// 销毁方法</span></span><br></pre></td></tr></table></figure>

<h4 id="AOP相关注解"><a href="#AOP相关注解" class="headerlink" title="AOP相关注解"></a>AOP相关注解</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span>         <span class="comment">// 声明切面</span></span><br><span class="line"><span class="meta">@Pointcut</span>       <span class="comment">// 定义切点</span></span><br><span class="line"><span class="meta">@Before</span>         <span class="comment">// 前置通知</span></span><br><span class="line"><span class="meta">@After</span>          <span class="comment">// 后置通知</span></span><br><span class="line"><span class="meta">@AfterReturning</span> <span class="comment">// 返回后通知</span></span><br><span class="line"><span class="meta">@AfterThrowing</span>  <span class="comment">// 异常通知</span></span><br><span class="line"><span class="meta">@Around</span>         <span class="comment">// 环绕通知</span></span><br></pre></td></tr></table></figure>

<h3 id="1-3-Spring常见使用场景"><a href="#1-3-Spring常见使用场景" class="headerlink" title="1.3 Spring常见使用场景"></a>1.3 Spring常见使用场景</h3><h4 id="场景1：服务层事务管理"><a href="#场景1：服务层事务管理" class="headerlink" title="场景1：服务层事务管理"></a>场景1：服务层事务管理</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserRepository userRepository;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Transactional(propagation = Propagation.REQUIRED, rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">createUser</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="comment">// 业务逻辑</span></span><br><span class="line">        <span class="keyword">return</span> userRepository.save(user);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Transactional(readOnly = true)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">findById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userRepository.findById(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="场景2：缓存管理"><a href="#场景2：缓存管理" class="headerlink" title="场景2：缓存管理"></a>场景2：缓存管理</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Cacheable(value = &quot;products&quot;, key = &quot;#id&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Product <span class="title function_">getProduct</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> productRepository.findById(id);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@CacheEvict(value = &quot;products&quot;, key = &quot;#product.id&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Product <span class="title function_">updateProduct</span><span class="params">(Product product)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> productRepository.save(product);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-4-Spring常见面试问题"><a href="#1-4-Spring常见面试问题" class="headerlink" title="1.4 Spring常见面试问题"></a>1.4 Spring常见面试问题</h3><p><strong>Q1: Spring IoC容器的初始化过程是怎样的？</strong></p>
<p>A: Spring IoC容器初始化分为三个阶段：</p>
<ol>
<li><strong>Resource定位</strong>: 定位配置文件</li>
<li><strong>BeanDefinition载入</strong>: 将配置信息转换为Spring内部数据结构</li>
<li><strong>BeanDefinition注册</strong>: 将BeanDefinition注册到IoC容器的HashMap中</li>
</ol>
<p>具体流程：</p>
<ul>
<li>创建ApplicationContext</li>
<li>加载配置元数据（XML、注解、Java配置）</li>
<li>解析配置，创建BeanDefinition</li>
<li>注册BeanDefinition到BeanDefinitionRegistry</li>
<li>实例化非懒加载的单例Bean</li>
</ul>
<p><strong>Q2: Spring中的循环依赖是如何解决的？</strong></p>
<p>A: Spring通过三级缓存解决循环依赖：</p>
<ol>
<li><strong>singletonObjects</strong>: 一级缓存，存放完整的Bean实例</li>
<li><strong>earlySingletonObjects</strong>: 二级缓存，存放早期的Bean实例</li>
<li><strong>singletonFactories</strong>: 三级缓存，存放Bean工厂</li>
</ol>
<p>解决过程：</p>
<ul>
<li>A依赖B，B依赖A</li>
<li>创建A时，将A的工厂放入三级缓存</li>
<li>A需要注入B，开始创建B</li>
<li>B需要注入A，从缓存中获取A的早期实例</li>
<li>B创建完成，A继续创建完成</li>
</ul>
<p><strong>Q3: Spring AOP的实现原理？</strong></p>
<p>A: Spring AOP基于代理模式实现：</p>
<ol>
<li><strong>JDK动态代理</strong>: 目标类实现接口时使用，基于反射机制</li>
<li><strong>CGLIB代理</strong>: 目标类没有接口时使用，基于字节码技术</li>
</ol>
<p>代理创建过程：</p>
<ul>
<li>Spring在Bean初始化后，检查是否需要AOP</li>
<li>如果需要，创建代理对象替换原始Bean</li>
<li>代理对象拦截方法调用，执行切面逻辑</li>
</ul>
<h2 id="二、Spring-Boot深入解析"><a href="#二、Spring-Boot深入解析" class="headerlink" title="二、Spring Boot深入解析"></a>二、Spring Boot深入解析</h2><h3 id="2-1-Spring-Boot核心原理"><a href="#2-1-Spring-Boot核心原理" class="headerlink" title="2.1 Spring Boot核心原理"></a>2.1 Spring Boot核心原理</h3><p><strong>自动配置原理：</strong> Spring Boot通过@EnableAutoConfiguration注解启用自动配置机制。</p>
<p>核心类分析：</p>
<ol>
<li><strong>SpringBootApplication</strong>: 组合注解，包含@Configuration、@EnableAutoConfiguration、@ComponentScan</li>
<li><strong>AutoConfigurationImportSelector</strong>: 负责导入自动配置类</li>
<li><strong>spring.factories</strong>: META-INF&#x2F;spring.factories文件定义自动配置类</li>
</ol>
<p><strong>自动配置流程：</strong></p>
<ol>
<li>SpringBoot启动时扫描所有jar包下的META-INF&#x2F;spring.factories文件</li>
<li>加载文件中定义的自动配置类</li>
<li>根据条件注解(@ConditionalOnClass等)判断是否生效</li>
<li>生效的配置类会创建相应的Bean</li>
</ol>
<h3 id="2-2-Spring-Boot启动流程详解"><a href="#2-2-Spring-Boot启动流程详解" class="headerlink" title="2.2 Spring Boot启动流程详解"></a>2.2 Spring Boot启动流程详解</h3><p><strong>SpringApplication.run()方法执行流程：</strong></p>
<ol>
<li><strong>准备阶段</strong>：<ul>
<li>创建SpringApplication实例</li>
<li>确定应用类型（SERVLET、REACTIVE、NONE）</li>
<li>加载ApplicationContextInitializer</li>
<li>加载ApplicationListener</li>
</ul>
</li>
<li><strong>启动阶段</strong>：<ul>
<li>启动计时器</li>
<li>配置Headless模式</li>
<li>获取并启动监听器</li>
<li>准备环境（Environment）</li>
<li>打印Banner</li>
</ul>
</li>
<li><strong>容器创建阶段</strong>：<ul>
<li>创建ApplicationContext</li>
<li>准备ApplicationContext</li>
<li>刷新ApplicationContext</li>
<li>刷新后处理</li>
</ul>
</li>
<li><strong>完成阶段</strong>：<ul>
<li>停止计时器</li>
<li>发布启动完成事件</li>
<li>调用Runners</li>
</ul>
</li>
</ol>
<h3 id="2-3-Spring-Boot核心注解"><a href="#2-3-Spring-Boot核心注解" class="headerlink" title="2.3 Spring Boot核心注解"></a>2.3 Spring Boot核心注解</h3><h4 id="启动类注解"><a href="#启动类注解" class="headerlink" title="启动类注解"></a>启动类注解</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="comment">// 等价于以下三个注解的组合</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootConfiguration</span>  <span class="comment">// Spring Boot配置类</span></span><br><span class="line"><span class="meta">@EnableScheduling</span>        <span class="comment">// 启用定时任务</span></span><br><span class="line"><span class="meta">@EnableAsync</span>            <span class="comment">// 启用异步处理</span></span><br><span class="line"><span class="meta">@EnableCaching</span>          <span class="comment">// 启用缓存</span></span><br></pre></td></tr></table></figure>

<h4 id="条件注解"><a href="#条件注解" class="headerlink" title="条件注解"></a>条件注解</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConditionalOnClass(DataSource.class)</span>      <span class="comment">// 类路径下存在指定类</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(DataSource.class)</span> <span class="comment">// 容器中不存在指定Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(name = &quot;app.enabled&quot;, havingValue = &quot;true&quot;)</span> <span class="comment">// 属性匹配</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication</span>               <span class="comment">// Web应用环境</span></span><br><span class="line"><span class="meta">@ConditionalOnNotWebApplication</span>            <span class="comment">// 非Web应用环境</span></span><br><span class="line"><span class="meta">@Profile(&quot;dev&quot;)</span>                           <span class="comment">// 激活的profile</span></span><br></pre></td></tr></table></figure>

<h4 id="配置属性注解"><a href="#配置属性注解" class="headerlink" title="配置属性注解"></a>配置属性注解</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;app.datasource&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceProperties</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="comment">// getters and setters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-4-Spring-Boot实际应用场景"><a href="#2-4-Spring-Boot实际应用场景" class="headerlink" title="2.4 Spring Boot实际应用场景"></a>2.4 Spring Boot实际应用场景</h3><h4 id="场景1：微服务架构"><a href="#场景1：微服务架构" class="headerlink" title="场景1：微服务架构"></a>场景1：微服务架构</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(UserServiceApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@FeignClient(name = &quot;order-service&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderServiceClient</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/orders/&#123;userId&#125;&quot;)</span></span><br><span class="line">    List&lt;Order&gt; <span class="title function_">getOrdersByUserId</span><span class="params">(<span class="meta">@PathVariable</span> Long userId)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="场景2：数据访问层整合"><a href="#场景2：数据访问层整合" class="headerlink" title="场景2：数据访问层整合"></a>场景2：数据访问层整合</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableJpaRepositories</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(&quot;spring.datasource.primary&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DataSourceProperties <span class="title function_">primaryDataSourceProperties</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DataSourceProperties</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(&quot;spring.datasource.secondary&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DataSourceProperties <span class="title function_">secondaryDataSourceProperties</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DataSourceProperties</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-5-Spring-Boot面试问题"><a href="#2-5-Spring-Boot面试问题" class="headerlink" title="2.5 Spring Boot面试问题"></a>2.5 Spring Boot面试问题</h3><p><strong>Q1: Spring Boot的启动原理是什么？</strong></p>
<p>A: Spring Boot启动原理核心在于自动配置：</p>
<ol>
<li><strong>@SpringBootApplication</strong>组合了三个注解，其中@EnableAutoConfiguration是关键</li>
<li><strong>AutoConfigurationImportSelector</strong>会扫描所有引入的jar包，查找其META-INF&#x2F;spring.factories文件中org.springframework.boot.autoconfigure.EnableAutoConfiguration键所对应的配置类全限定名列表</li>
<li>根据条件注解判断哪些自动配置类生效</li>
<li>生效的配置类会向容器中注册相应的Bean</li>
</ol>
<p><strong>Q2: Spring Boot如何实现自动配置？</strong></p>
<p>A: 自动配置通过以下机制实现：</p>
<ol>
<li><strong>条件注解</strong>: @ConditionalOnClass、@ConditionalOnBean等判断配置是否生效</li>
<li><strong>配置文件</strong>: spring.factories定义自动配置类列表</li>
<li><strong>配置属性</strong>: @ConfigurationProperties绑定配置文件中的属性</li>
<li><strong>默认配置</strong>: 提供合理的默认值，用户可覆盖</li>
</ol>
<p><strong>Q3: Spring Boot Starter的工作原理？</strong></p>
<p>A: Starter是Spring Boot自动配置的载体：</p>
<ol>
<li><strong>依赖管理</strong>: 通过Maven&#x2F;Gradle引入相关依赖</li>
<li><strong>自动配置</strong>: 包含AutoConfiguration类</li>
<li><strong>属性绑定</strong>: 提供ConfigurationProperties类</li>
<li><strong>条件装配</strong>: 使用条件注解控制Bean的创建</li>
</ol>
<h2 id="三、Spring-MVC深入解析"><a href="#三、Spring-MVC深入解析" class="headerlink" title="三、Spring MVC深入解析"></a>三、Spring MVC深入解析</h2><h3 id="3-1-Spring-MVC核心组件"><a href="#3-1-Spring-MVC核心组件" class="headerlink" title="3.1 Spring MVC核心组件"></a>3.1 Spring MVC核心组件</h3><p><strong>DispatcherServlet处理流程：</strong></p>
<ol>
<li><strong>接收请求</strong>: DispatcherServlet接收HTTP请求</li>
<li><strong>查找Handler</strong>: HandlerMapping查找处理请求的Handler</li>
<li><strong>获取HandlerAdapter</strong>: 获取能够执行Handler的HandlerAdapter</li>
<li><strong>执行Handler</strong>: HandlerAdapter执行Handler（Controller方法）</li>
<li><strong>处理结果</strong>: 返回ModelAndView</li>
<li><strong>视图解析</strong>: ViewResolver解析视图名称</li>
<li><strong>渲染视图</strong>: View渲染模型数据</li>
<li><strong>返回响应</strong>: 响应结果返回给客户端</li>
</ol>
<p><strong>核心组件详解：</strong></p>
<ul>
<li><strong>DispatcherServlet</strong>: 前端控制器，统一处理请求</li>
<li><strong>HandlerMapping</strong>: 处理器映射器，URL与Handler的映射</li>
<li><strong>HandlerAdapter</strong>: 处理器适配器，执行Handler</li>
<li><strong>Handler</strong>: 处理器，即Controller</li>
<li><strong>ViewResolver</strong>: 视图解析器</li>
<li><strong>View</strong>: 视图</li>
</ul>
<h3 id="3-2-Spring-MVC核心注解"><a href="#3-2-Spring-MVC核心注解" class="headerlink" title="3.2 Spring MVC核心注解"></a>3.2 Spring MVC核心注解</h3><h4 id="控制器注解"><a href="#控制器注解" class="headerlink" title="控制器注解"></a>控制器注解</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span>             <span class="comment">// 标记控制器类</span></span><br><span class="line"><span class="meta">@RestController</span>        <span class="comment">// RESTful控制器</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api&quot;)</span> <span class="comment">// 请求映射</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/users&quot;)</span>   <span class="comment">// GET请求映射</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/users&quot;)</span>  <span class="comment">// POST请求映射</span></span><br><span class="line"><span class="meta">@PutMapping(&quot;/users/&#123;id&#125;&quot;)</span>    <span class="comment">// PUT请求映射</span></span><br><span class="line"><span class="meta">@DeleteMapping(&quot;/users/&#123;id&#125;&quot;)</span> <span class="comment">// DELETE请求映射</span></span><br><span class="line"><span class="meta">@PatchMapping(&quot;/users/&#123;id&#125;&quot;)</span>  <span class="comment">// PATCH请求映射</span></span><br></pre></td></tr></table></figure>

<h4 id="参数绑定注解"><a href="#参数绑定注解" class="headerlink" title="参数绑定注解"></a>参数绑定注解</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestParam(&quot;name&quot;)</span>           <span class="comment">// 请求参数</span></span><br><span class="line"><span class="meta">@PathVariable(&quot;id&quot;)</span>            <span class="comment">// 路径变量</span></span><br><span class="line"><span class="meta">@RequestBody</span>                   <span class="comment">// 请求体</span></span><br><span class="line"><span class="meta">@RequestHeader(&quot;Content-Type&quot;)</span> <span class="comment">// 请求头</span></span><br><span class="line"><span class="meta">@CookieValue(&quot;sessionId&quot;)</span>      <span class="comment">// Cookie值</span></span><br><span class="line"><span class="meta">@ModelAttribute</span>               <span class="comment">// 模型属性</span></span><br><span class="line"><span class="meta">@SessionAttribute</span>            <span class="comment">// Session属性</span></span><br><span class="line"><span class="meta">@RequestPart</span>                 <span class="comment">// 文件上传</span></span><br></pre></td></tr></table></figure>

<h4 id="响应处理注解"><a href="#响应处理注解" class="headerlink" title="响应处理注解"></a>响应处理注解</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ResponseBody</span>              <span class="comment">// 响应体</span></span><br><span class="line"><span class="meta">@ResponseStatus(HttpStatus.CREATED)</span> <span class="comment">// 响应状态码</span></span><br><span class="line"><span class="meta">@ExceptionHandler</span>         <span class="comment">// 异常处理</span></span><br><span class="line"><span class="meta">@ControllerAdvice</span>        <span class="comment">// 全局控制器增强</span></span><br><span class="line"><span class="meta">@RestControllerAdvice</span>    <span class="comment">// RESTful全局异常处理</span></span><br></pre></td></tr></table></figure>

<h3 id="3-3-Spring-MVC实际应用场景"><a href="#3-3-Spring-MVC实际应用场景" class="headerlink" title="3.3 Spring MVC实际应用场景"></a>3.3 Spring MVC实际应用场景</h3><h4 id="场景1：RESTful-API开发"><a href="#场景1：RESTful-API开发" class="headerlink" title="场景1：RESTful API开发"></a>场景1：RESTful API开发</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/users&quot;)</span></span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;PageResult&lt;User&gt;&gt; <span class="title function_">getUsers</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(defaultValue = &quot;1&quot;)</span> <span class="type">int</span> page,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(defaultValue = &quot;10&quot;)</span> <span class="type">int</span> size,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(required = false)</span> String keyword)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        PageResult&lt;User&gt; result = userService.findUsers(page, size, keyword);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(result);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;User&gt; <span class="title function_">createUser</span><span class="params">(<span class="meta">@Valid</span> <span class="meta">@RequestBody</span> UserCreateRequest request)</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.createUser(request);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.status(HttpStatus.CREATED).body(user);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PutMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;User&gt; <span class="title function_">updateUser</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@PathVariable</span> Long id,</span></span><br><span class="line"><span class="params">            <span class="meta">@Valid</span> <span class="meta">@RequestBody</span> UserUpdateRequest request)</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.updateUser(id, request);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(user);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Void&gt; <span class="title function_">deleteUser</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        userService.deleteUser(id);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.noContent().build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="场景2：全局异常处理"><a href="#场景2：全局异常处理" class="headerlink" title="场景2：全局异常处理"></a>场景2：全局异常处理</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ExceptionHandler(ValidationException.class)</span></span><br><span class="line">    <span class="meta">@ResponseStatus(HttpStatus.BAD_REQUEST)</span></span><br><span class="line">    <span class="keyword">public</span> ErrorResponse <span class="title function_">handleValidationException</span><span class="params">(ValidationException e)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ErrorResponse.builder()</span><br><span class="line">                .code(<span class="string">&quot;VALIDATION_ERROR&quot;</span>)</span><br><span class="line">                .message(e.getMessage())</span><br><span class="line">                .timestamp(LocalDateTime.now())</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ExceptionHandler(EntityNotFoundException.class)</span></span><br><span class="line">    <span class="meta">@ResponseStatus(HttpStatus.NOT_FOUND)</span></span><br><span class="line">    <span class="keyword">public</span> ErrorResponse <span class="title function_">handleEntityNotFoundException</span><span class="params">(EntityNotFoundException e)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ErrorResponse.builder()</span><br><span class="line">                .code(<span class="string">&quot;ENTITY_NOT_FOUND&quot;</span>)</span><br><span class="line">                .message(e.getMessage())</span><br><span class="line">                .timestamp(LocalDateTime.now())</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line">    <span class="meta">@ResponseStatus(HttpStatus.INTERNAL_SERVER_ERROR)</span></span><br><span class="line">    <span class="keyword">public</span> ErrorResponse <span class="title function_">handleGenericException</span><span class="params">(Exception e)</span> &#123;</span><br><span class="line">        log.error(<span class="string">&quot;Unexpected error occurred&quot;</span>, e);</span><br><span class="line">        <span class="keyword">return</span> ErrorResponse.builder()</span><br><span class="line">                .code(<span class="string">&quot;INTERNAL_ERROR&quot;</span>)</span><br><span class="line">                .message(<span class="string">&quot;An unexpected error occurred&quot;</span>)</span><br><span class="line">                .timestamp(LocalDateTime.now())</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="场景3：文件上传处理"><a href="#场景3：文件上传处理" class="headerlink" title="场景3：文件上传处理"></a>场景3：文件上传处理</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/files&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/upload&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;FileUploadResponse&gt; <span class="title function_">uploadFile</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestPart(&quot;file&quot;)</span> MultipartFile file,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(required = false)</span> String description)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 文件类型验证</span></span><br><span class="line">        <span class="keyword">if</span> (!isValidFileType(file.getContentType())) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InvalidFileTypeException</span>(<span class="string">&quot;Invalid file type&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 文件大小验证</span></span><br><span class="line">        <span class="keyword">if</span> (file.getSize() &gt; MAX_FILE_SIZE) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">FileSizeExceededException</span>(<span class="string">&quot;File size exceeds limit&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> fileService.saveFile(file, description);</span><br><span class="line">        </span><br><span class="line">        <span class="type">FileUploadResponse</span> <span class="variable">response</span> <span class="operator">=</span> FileUploadResponse.builder()</span><br><span class="line">                .fileName(fileName)</span><br><span class="line">                .originalName(file.getOriginalFilename())</span><br><span class="line">                .size(file.getSize())</span><br><span class="line">                .contentType(file.getContentType())</span><br><span class="line">                .uploadTime(LocalDateTime.now())</span><br><span class="line">                .build();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-4-Spring-MVC面试问题"><a href="#3-4-Spring-MVC面试问题" class="headerlink" title="3.4 Spring MVC面试问题"></a>3.4 Spring MVC面试问题</h3><p><strong>Q1: Spring MVC的执行流程是怎样的？</strong></p>
<p>A: Spring MVC的执行流程如下：</p>
<ol>
<li>用户发送请求到DispatcherServlet</li>
<li>DispatcherServlet调用HandlerMapping查找Handler</li>
<li>HandlerMapping返回HandlerExecutionChain（包含Handler和拦截器）</li>
<li>DispatcherServlet调用HandlerAdapter执行Handler</li>
<li>Handler执行完成后返回ModelAndView</li>
<li>DispatcherServlet调用ViewResolver解析视图名称</li>
<li>ViewResolver返回View对象</li>
<li>DispatcherServlet调用View的render方法渲染视图</li>
<li>响应结果返回给用户</li>
</ol>
<p><strong>Q2: Spring MVC中的拦截器是如何工作的？</strong></p>
<p>A: 拦截器基于AOP思想，在Handler执行前后进行处理：</p>
<ol>
<li><strong>HandlerInterceptor接口</strong>提供三个方法：<ul>
<li>preHandle(): 前置处理，返回false则中断请求</li>
<li>postHandle(): 后置处理，Handler执行后调用</li>
<li>afterCompletion(): 完成处理，视图渲染后调用</li>
</ul>
</li>
<li><strong>执行顺序</strong>：<ul>
<li>多个拦截器按配置顺序执行preHandle()</li>
<li>按相反顺序执行postHandle()和afterCompletion()</li>
</ul>
</li>
</ol>
<p><strong>Q3: @RequestBody和@ResponseBody的工作原理？</strong></p>
<p>A: 这两个注解基于HttpMessageConverter工作：</p>
<ol>
<li><strong>@RequestBody</strong>:<ul>
<li>使用HttpMessageConverter将HTTP请求体转换为Java对象</li>
<li>常用的转换器：MappingJackson2HttpMessageConverter处理JSON</li>
</ul>
</li>
<li><strong>@ResponseBody</strong>:<ul>
<li>使用HttpMessageConverter将Java对象转换为HTTP响应体</li>
<li>根据Accept头选择合适的转换器</li>
</ul>
</li>
</ol>
<h2 id="四、MyBatis深入解析"><a href="#四、MyBatis深入解析" class="headerlink" title="四、MyBatis深入解析"></a>四、MyBatis深入解析</h2><h3 id="4-1-MyBatis核心原理"><a href="#4-1-MyBatis核心原理" class="headerlink" title="4.1 MyBatis核心原理"></a>4.1 MyBatis核心原理</h3><p><strong>MyBatis架构分析：</strong> MyBatis采用分层架构设计：</p>
<ol>
<li><strong>API接口层</strong>: 提供给外部使用的接口API</li>
<li><strong>数据处理层</strong>: 参数映射、SQL解析、结果映射</li>
<li><strong>基础支撑层</strong>: 连接管理、事务管理、配置加载、缓存处理</li>
</ol>
<p><strong>MyBatis核心组件：</strong></p>
<ul>
<li><strong>SqlSessionFactory</strong>: 会话工厂，负责创建SqlSession</li>
<li><strong>SqlSession</strong>: 会话，执行SQL的核心接口</li>
<li><strong>Executor</strong>: 执行器，实际执行SQL</li>
<li><strong>StatementHandler</strong>: 语句处理器，处理SQL语句</li>
<li><strong>ParameterHandler</strong>: 参数处理器，处理SQL参数</li>
<li><strong>ResultSetHandler</strong>: 结果集处理器，处理查询结果</li>
<li><strong>MappedStatement</strong>: 映射语句，封装SQL配置信息</li>
</ul>
<h3 id="4-2-MyBatis执行流程详解"><a href="#4-2-MyBatis执行流程详解" class="headerlink" title="4.2 MyBatis执行流程详解"></a>4.2 MyBatis执行流程详解</h3><p><strong>SQL执行流程：</strong></p>
<ol>
<li><strong>解析配置</strong>: 解析mybatis-config.xml和Mapper XML文件</li>
<li><strong>创建会话</strong>: 通过SqlSessionFactory创建SqlSession</li>
<li><strong>获取Mapper</strong>: 通过动态代理创建Mapper接口实例</li>
<li><strong>执行SQL</strong>: 调用Mapper方法，转换为MappedStatement执行</li>
<li><strong>参数处理</strong>: ParameterHandler处理输入参数</li>
<li><strong>执行查询</strong>: StatementHandler执行SQL语句</li>
<li><strong>结果映射</strong>: ResultSetHandler处理结果集</li>
<li><strong>返回结果</strong>: 将结果返回给调用方</li>
</ol>
<p><strong>动态代理原理：</strong> MyBatis使用JDK动态代理为Mapper接口创建代理对象：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MapperProxy实现InvocationHandler</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MapperProxy</span>&lt;T&gt; <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 根据方法签名找到对应的MappedStatement</span></span><br><span class="line">        <span class="comment">// 执行SQL并返回结果</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-3-MyBatis核心注解"><a href="#4-3-MyBatis核心注解" class="headerlink" title="4.3 MyBatis核心注解"></a>4.3 MyBatis核心注解</h3><h4 id="基础映射注解"><a href="#基础映射注解" class="headerlink" title="基础映射注解"></a>基础映射注解</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select(&quot;SELECT * FROM users WHERE id = #&#123;id&#125;&quot;)</span></span><br><span class="line">User <span class="title function_">findById</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> Long id)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Insert(&quot;INSERT INTO users(name, email) VALUES(#&#123;name&#125;, #&#123;email&#125;)&quot;)</span></span><br><span class="line"><span class="meta">@Options(useGeneratedKeys = true, keyProperty = &quot;id&quot;)</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">insert</span><span class="params">(User user)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Update(&quot;UPDATE users SET name = #&#123;name&#125; WHERE id = #&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">update</span><span class="params">(User user)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Delete(&quot;DELETE FROM users WHERE id = #&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">delete</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> Long id)</span>;</span><br></pre></td></tr></table></figure>

<h4 id="高级映射注解"><a href="#高级映射注解" class="headerlink" title="高级映射注解"></a>高级映射注解</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 结果映射</span></span><br><span class="line"><span class="meta">@Results(&#123;</span></span><br><span class="line"><span class="meta">    @Result(column = &quot;user_id&quot;, property = &quot;id&quot;),</span></span><br><span class="line"><span class="meta">    @Result(column = &quot;user_name&quot;, property = &quot;name&quot;),</span></span><br><span class="line"><span class="meta">    @Result(column = &quot;create_time&quot;, property = &quot;createTime&quot;)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="meta">@Select(&quot;SELECT user_id, user_name, create_time FROM users&quot;)</span></span><br><span class="line">List&lt;User&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 一对一映射</span></span><br><span class="line"><span class="meta">@One(select = &quot;findUserById&quot;)</span></span><br><span class="line"><span class="meta">@Result(column = &quot;user_id&quot;, property = &quot;user&quot;)</span></span><br><span class="line">Order <span class="title function_">findOrderById</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> Long id)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 一对多映射</span></span><br><span class="line"><span class="meta">@Many(select = &quot;findOrdersByUserId&quot;)</span></span><br><span class="line"><span class="meta">@Result(column = &quot;id&quot;, property = &quot;orders&quot;)</span></span><br><span class="line">User <span class="title function_">findUserWithOrders</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> Long id)</span>;</span><br></pre></td></tr></table></figure>

<h4 id="动态SQL注解"><a href="#动态SQL注解" class="headerlink" title="动态SQL注解"></a>动态SQL注解</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SelectProvider(type = UserSqlProvider.class, method = &quot;findUsers&quot;)</span></span><br><span class="line">List&lt;User&gt; <span class="title function_">findUsers</span><span class="params">(<span class="meta">@Param(&quot;name&quot;)</span> String name, <span class="meta">@Param(&quot;email&quot;)</span> String email)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserSqlProvider</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">findUsers</span><span class="params">(Map&lt;String, Object&gt; params)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SQL</span>() &#123;&#123;</span><br><span class="line">            SELECT(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">            FROM(<span class="string">&quot;users&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (params.get(<span class="string">&quot;name&quot;</span>) != <span class="literal">null</span>) &#123;</span><br><span class="line">                WHERE(<span class="string">&quot;name LIKE CONCAT(&#x27;%&#x27;, #&#123;name&#125;, &#x27;%&#x27;)&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (params.get(<span class="string">&quot;email&quot;</span>) != <span class="literal">null</span>) &#123;</span><br><span class="line">                WHERE(<span class="string">&quot;email = #&#123;email&#125;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;&#125;.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-4-MyBatis缓存机制"><a href="#4-4-MyBatis缓存机制" class="headerlink" title="4.4 MyBatis缓存机制"></a>4.4 MyBatis缓存机制</h3><p><strong>一级缓存（默认开启）：</strong></p>
<ul>
<li>作用域：SqlSession级别</li>
<li>生命周期：与SqlSession相同</li>
<li>存储：HashMap结构，key为CacheKey</li>
</ul>
<p><strong>二级缓存（需要配置）：</strong></p>
<ul>
<li>作用域：Mapper级别</li>
<li>生命周期：与应用程序相同</li>
<li>配置：@CacheNamespace注解或<cache>标签</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CacheNamespace(</span></span><br><span class="line"><span class="meta">    eviction = LRU.class,</span></span><br><span class="line"><span class="meta">    flushInterval = 60000,</span></span><br><span class="line"><span class="meta">    size = 1024,</span></span><br><span class="line"><span class="meta">    readWrite = true</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    <span class="comment">// mapper methods</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-5-MyBatis实际应用场景"><a href="#4-5-MyBatis实际应用场景" class="headerlink" title="4.5 MyBatis实际应用场景"></a>4.5 MyBatis实际应用场景</h3><h4 id="场景1：复杂查询场景"><a href="#场景1：复杂查询场景" class="headerlink" title="场景1：复杂查询场景"></a>场景1：复杂查询场景</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderMapper</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 分页查询订单</span></span><br><span class="line">    <span class="meta">@Select(&quot;&quot;&quot;</span></span><br><span class="line"><span class="meta">        SELECT o.*, u.name as user_name, u.email as user_email</span></span><br><span class="line"><span class="meta">        FROM orders o</span></span><br><span class="line"><span class="meta">        LEFT JOIN users u ON o.user_id = u.id</span></span><br><span class="line"><span class="meta">        WHERE o.status = #&#123;status&#125;</span></span><br><span class="line"><span class="meta">        AND o.create_time BETWEEN #&#123;startTime&#125; AND #&#123;endTime&#125;</span></span><br><span class="line"><span class="meta">        ORDER BY o.create_time DESC</span></span><br><span class="line"><span class="meta">        LIMIT #&#123;offset&#125;, #&#123;limit&#125;</span></span><br><span class="line"><span class="meta">    &quot;&quot;&quot;)</span></span><br><span class="line">    <span class="meta">@Results(&#123;</span></span><br><span class="line"><span class="meta">        @Result(column = &quot;id&quot;, property = &quot;id&quot;),</span></span><br><span class="line"><span class="meta">        @Result(column = &quot;user_id&quot;, property = &quot;userId&quot;),</span></span><br><span class="line"><span class="meta">        @Result(column = &quot;user_name&quot;, property = &quot;user.name&quot;),</span></span><br><span class="line"><span class="meta">        @Result(column = &quot;user_email&quot;, property = &quot;user.email&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    List&lt;OrderVO&gt; <span class="title function_">findOrdersWithUser</span><span class="params">(</span></span><br><span class="line"><span class="params">        <span class="meta">@Param(&quot;status&quot;)</span> String status,</span></span><br><span class="line"><span class="params">        <span class="meta">@Param(&quot;startTime&quot;)</span> LocalDateTime startTime,</span></span><br><span class="line"><span class="params">        <span class="meta">@Param(&quot;endTime&quot;)</span> LocalDateTime endTime,</span></span><br><span class="line"><span class="params">        <span class="meta">@Param(&quot;offset&quot;)</span> <span class="type">int</span> offset,</span></span><br><span class="line"><span class="params">        <span class="meta">@Param(&quot;limit&quot;)</span> <span class="type">int</span> limit</span></span><br><span class="line"><span class="params">    )</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 统计查询</span></span><br><span class="line">    <span class="meta">@Select(&quot;&quot;&quot;</span></span><br><span class="line"><span class="meta">        SELECT </span></span><br><span class="line"><span class="meta">            COUNT(*) as total_count,</span></span><br><span class="line"><span class="meta">            SUM(amount) as total_amount,</span></span><br><span class="line"><span class="meta">            AVG(amount) as avg_amount</span></span><br><span class="line"><span class="meta">        FROM orders </span></span><br><span class="line"><span class="meta">        WHERE status = #&#123;status&#125;</span></span><br><span class="line"><span class="meta">        AND create_time &gt;= #&#123;startTime&#125;</span></span><br><span class="line"><span class="meta">    &quot;&quot;&quot;)</span></span><br><span class="line">    OrderStatistics <span class="title function_">getOrderStatistics</span><span class="params">(</span></span><br><span class="line"><span class="params">        <span class="meta">@Param(&quot;status&quot;)</span> String status,</span></span><br><span class="line"><span class="params">        <span class="meta">@Param(&quot;startTime&quot;)</span> LocalDateTime startTime</span></span><br><span class="line"><span class="params">    )</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="场景2：批量操作场景"><a href="#场景2：批量操作场景" class="headerlink" title="场景2：批量操作场景"></a>场景2：批量操作场景</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BatchMapper</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 批量插入</span></span><br><span class="line">    <span class="meta">@Insert(&quot;&quot;&quot;</span></span><br><span class="line"><span class="meta">        &lt;script&gt;</span></span><br><span class="line"><span class="meta">        INSERT INTO users (name, email, create_time) VALUES</span></span><br><span class="line"><span class="meta">        &lt;foreach collection=&quot;users&quot; item=&quot;user&quot; separator=&quot;,&quot;&gt;</span></span><br><span class="line"><span class="meta">            (#&#123;user.name&#125;, #&#123;user.email&#125;, #&#123;user.createTime&#125;)</span></span><br><span class="line"><span class="meta">        &lt;/foreach&gt;</span></span><br><span class="line"><span class="meta">        &lt;/script&gt;</span></span><br><span class="line"><span class="meta">    &quot;&quot;&quot;)</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">batchInsertUsers</span><span class="params">(<span class="meta">@Param(&quot;users&quot;)</span> List&lt;User&gt; users)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 批量更新</span></span><br><span class="line">    <span class="meta">@Update(&quot;&quot;&quot;</span></span><br><span class="line"><span class="meta">        &lt;script&gt;</span></span><br><span class="line"><span class="meta">        &lt;foreach collection=&quot;users&quot; item=&quot;user&quot; separator=&quot;;&quot;&gt;</span></span><br><span class="line"><span class="meta">            UPDATE users SET </span></span><br><span class="line"><span class="meta">                name = #&#123;user.name&#125;,</span></span><br><span class="line"><span class="meta">                email = #&#123;user.email&#125;,</span></span><br><span class="line"><span class="meta">                update_time = NOW()</span></span><br><span class="line"><span class="meta">            WHERE id = #&#123;user.id&#125;</span></span><br><span class="line"><span class="meta">        &lt;/foreach&gt;</span></span><br><span class="line"><span class="meta">        &lt;/script&gt;</span></span><br><span class="line"><span class="meta">    &quot;&quot;&quot;)</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">batchUpdateUsers</span><span class="params">(<span class="meta">@Param(&quot;users&quot;)</span> List&lt;User&gt; users)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="场景3：动态SQL场景"><a href="#场景3：动态SQL场景" class="headerlink" title="场景3：动态SQL场景"></a>场景3：动态SQL场景</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SelectProvider(type = UserSqlProvider.class, method = &quot;searchUsers&quot;)</span></span><br><span class="line">List&lt;User&gt; <span class="title function_">searchUsers</span><span class="params">(UserSearchCriteria criteria)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserSqlProvider</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">searchUsers</span><span class="params">(UserSearchCriteria criteria)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SQL</span>() &#123;&#123;</span><br><span class="line">            SELECT(<span class="string">&quot;u.*, p.name as profile_name&quot;</span>);</span><br><span class="line">            FROM(<span class="string">&quot;users u&quot;</span>);</span><br><span class="line">            LEFT_OUTER_JOIN(<span class="string">&quot;user_profiles p ON u.id = p.user_id&quot;</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (StringUtils.hasText(criteria.getName())) &#123;</span><br><span class="line">                WHERE(<span class="string">&quot;u.name LIKE CONCAT(&#x27;%&#x27;, #&#123;name&#125;, &#x27;%&#x27;)&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (StringUtils.hasText(criteria.getEmail())) &#123;</span><br><span class="line">                WHERE(<span class="string">&quot;u.email = #&#123;email&#125;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (criteria.getMinAge() != <span class="literal">null</span>) &#123;</span><br><span class="line">                WHERE(<span class="string">&quot;u.age &gt;= #&#123;minAge&#125;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (criteria.getMaxAge() != <span class="literal">null</span>) &#123;</span><br><span class="line">                WHERE(<span class="string">&quot;u.age &lt;= #&#123;maxAge&#125;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (criteria.getCreateTimeStart() != <span class="literal">null</span>) &#123;</span><br><span class="line">                WHERE(<span class="string">&quot;u.create_time &gt;= #&#123;createTimeStart&#125;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (criteria.getCreateTimeEnd() != <span class="literal">null</span>) &#123;</span><br><span class="line">                WHERE(<span class="string">&quot;u.create_time &lt;= #&#123;createTimeEnd&#125;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (CollectionUtils.isNotEmpty(criteria.getStatuses())) &#123;</span><br><span class="line">                WHERE(<span class="string">&quot;u.status IN (&quot;</span> + </span><br><span class="line">                    criteria.getStatuses().stream()</span><br><span class="line">                        .map(s -&gt; <span class="string">&quot;&#x27;&quot;</span> + s + <span class="string">&quot;&#x27;&quot;</span>)</span><br><span class="line">                        .collect(Collectors.joining(<span class="string">&quot;,&quot;</span>)) + <span class="string">&quot;)&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 排序</span></span><br><span class="line">            <span class="keyword">if</span> (StringUtils.hasText(criteria.getSortField())) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="string">&quot;desc&quot;</span>.equalsIgnoreCase(criteria.getSortDirection())) &#123;</span><br><span class="line">                    ORDER_BY(<span class="string">&quot;u.&quot;</span> + criteria.getSortField() + <span class="string">&quot; DESC&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    ORDER_BY(<span class="string">&quot;u.&quot;</span> + criteria.getSortField() + <span class="string">&quot; ASC&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                ORDER_BY(<span class="string">&quot;u.create_time DESC&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;&#125;.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-6-MyBatis性能优化"><a href="#4-6-MyBatis性能优化" class="headerlink" title="4.6 MyBatis性能优化"></a>4.6 MyBatis性能优化</h3><h4 id="优化策略1：合理使用缓存"><a href="#优化策略1：合理使用缓存" class="headerlink" title="优化策略1：合理使用缓存"></a>优化策略1：合理使用缓存</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 开启二级缓存，设置合理的缓存策略</span></span><br><span class="line"><span class="meta">@CacheNamespace(</span></span><br><span class="line"><span class="meta">    eviction = LRU.class,        // 缓存回收策略</span></span><br><span class="line"><span class="meta">    flushInterval = 300000,      // 缓存刷新间隔（5分钟）</span></span><br><span class="line"><span class="meta">    size = 1024,                 // 缓存大小</span></span><br><span class="line"><span class="meta">    readWrite = true,            // 读写缓存</span></span><br><span class="line"><span class="meta">    blocking = false             // 非阻塞缓存</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ProductMapper</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 对于频繁查询且变化不大的数据使用缓存</span></span><br><span class="line">    <span class="meta">@Select(&quot;SELECT * FROM products WHERE category_id = #&#123;categoryId&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@Options(useCache = true)</span></span><br><span class="line">    List&lt;Product&gt; <span class="title function_">findByCategory</span><span class="params">(<span class="meta">@Param(&quot;categoryId&quot;)</span> Long categoryId)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 对于实时性要求高的数据禁用缓存</span></span><br><span class="line">    <span class="meta">@Select(&quot;SELECT * FROM products WHERE id = #&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@Options(useCache = false)</span></span><br><span class="line">    Product <span class="title function_">findRealTimeById</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> Long id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="优化策略2：批量操作"><a href="#优化策略2：批量操作" class="headerlink" title="优化策略2：批量操作"></a>优化策略2：批量操作</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用批量插入替代循环插入</span></span><br><span class="line"><span class="meta">@Insert(&quot;&quot;&quot;</span></span><br><span class="line"><span class="meta">    &lt;script&gt;</span></span><br><span class="line"><span class="meta">    INSERT INTO order_items (order_id, product_id, quantity, price) VALUES</span></span><br><span class="line"><span class="meta">    &lt;foreach collection=&quot;items&quot; item=&quot;item&quot; separator=&quot;,&quot;&gt;</span></span><br><span class="line"><span class="meta">        (#&#123;item.orderId&#125;, #&#123;item.productId&#125;, #&#123;item.quantity&#125;, #&#123;item.price&#125;)</span></span><br><span class="line"><span class="meta">    &lt;/foreach&gt;</span></span><br><span class="line"><span class="meta">    &lt;/script&gt;</span></span><br><span class="line"><span class="meta">&quot;&quot;&quot;)</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">batchInsertOrderItems</span><span class="params">(<span class="meta">@Param(&quot;items&quot;)</span> List&lt;OrderItem&gt; items)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 批量更新优化</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">batchUpdateProducts</span><span class="params">(List&lt;Product&gt; products)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> (<span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession(ExecutorType.BATCH)) &#123;</span><br><span class="line">        <span class="type">ProductMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(ProductMapper.class);</span><br><span class="line">        <span class="keyword">for</span> (Product product : products) &#123;</span><br><span class="line">            mapper.updateProduct(product);</span><br><span class="line">        &#125;</span><br><span class="line">        sqlSession.commit();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="优化策略3：延迟加载"><a href="#优化策略3：延迟加载" class="headerlink" title="优化策略3：延迟加载"></a>优化策略3：延迟加载</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ResultMap(&quot;userResultMap&quot;)</span></span><br><span class="line"><span class="meta">@Select(&quot;SELECT * FROM users WHERE id = #&#123;id&#125;&quot;)</span></span><br><span class="line">User <span class="title function_">findUserById</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> Long id)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在ResultMap中配置延迟加载</span></span><br><span class="line">&lt;resultMap id=<span class="string">&quot;userResultMap&quot;</span> type=<span class="string">&quot;User&quot;</span>&gt;</span><br><span class="line">    &lt;id column=<span class="string">&quot;id&quot;</span> property=<span class="string">&quot;id&quot;</span>/&gt;</span><br><span class="line">    &lt;result column=<span class="string">&quot;name&quot;</span> property=<span class="string">&quot;name&quot;</span>/&gt;</span><br><span class="line">    &lt;collection property=<span class="string">&quot;orders&quot;</span> </span><br><span class="line">                select=<span class="string">&quot;findOrdersByUserId&quot;</span> </span><br><span class="line">                column=<span class="string">&quot;id&quot;</span> </span><br><span class="line">                fetchType=<span class="string">&quot;lazy&quot;</span>/&gt;</span><br><span class="line">&lt;/resultMap&gt;</span><br></pre></td></tr></table></figure>

<h3 id="4-7-MyBatis常见问题与解决方案"><a href="#4-7-MyBatis常见问题与解决方案" class="headerlink" title="4.7 MyBatis常见问题与解决方案"></a>4.7 MyBatis常见问题与解决方案</h3><h4 id="问题1：N-1查询问题"><a href="#问题1：N-1查询问题" class="headerlink" title="问题1：N+1查询问题"></a>问题1：N+1查询问题</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 问题：会产生N+1次查询</span></span><br><span class="line"><span class="meta">@Select(&quot;SELECT * FROM users&quot;)</span></span><br><span class="line">List&lt;User&gt; <span class="title function_">findAllUsers</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Select(&quot;SELECT * FROM orders WHERE user_id = #&#123;userId&#125;&quot;)</span></span><br><span class="line">List&lt;Order&gt; <span class="title function_">findOrdersByUserId</span><span class="params">(<span class="meta">@Param(&quot;userId&quot;)</span> Long userId)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解决方案1：使用联表查询</span></span><br><span class="line"><span class="meta">@Select(&quot;&quot;&quot;</span></span><br><span class="line"><span class="meta">    SELECT u.*, o.id as order_id, o.amount, o.status as order_status</span></span><br><span class="line"><span class="meta">    FROM users u</span></span><br><span class="line"><span class="meta">    LEFT JOIN orders o ON u.id = o.user_id</span></span><br><span class="line"><span class="meta">&quot;&quot;&quot;)</span></span><br><span class="line"><span class="meta">@Results(&#123;</span></span><br><span class="line"><span class="meta">    @Result(column = &quot;id&quot;, property = &quot;id&quot;),</span></span><br><span class="line"><span class="meta">    @Result(column = &quot;name&quot;, property = &quot;name&quot;),</span></span><br><span class="line"><span class="meta">    @Result(column = &quot;order_id&quot;, property = &quot;orders.id&quot;),</span></span><br><span class="line"><span class="meta">    @Result(column = &quot;amount&quot;, property = &quot;orders.amount&quot;),</span></span><br><span class="line"><span class="meta">    @Result(column = &quot;order_status&quot;, property = &quot;orders.status&quot;)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line">List&lt;User&gt; <span class="title function_">findUsersWithOrders</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解决方案2：使用批量查询</span></span><br><span class="line"><span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findUsersWithOrdersOptimized</span><span class="params">(List&lt;Long&gt; userIds)</span> &#123;</span><br><span class="line">    List&lt;User&gt; users = userMapper.findUsersByIds(userIds);</span><br><span class="line">    <span class="keyword">if</span> (!users.isEmpty()) &#123;</span><br><span class="line">        List&lt;Long&gt; ids = users.stream().map(User::getId).collect(Collectors.toList());</span><br><span class="line">        List&lt;Order&gt; orders = orderMapper.findOrdersByUserIds(ids);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 手动组装数据</span></span><br><span class="line">        Map&lt;Long, List&lt;Order&gt;&gt; orderMap = orders.stream()</span><br><span class="line">            .collect(Collectors.groupingBy(Order::getUserId));</span><br><span class="line">        </span><br><span class="line">        users.forEach(user -&gt; user.setOrders(orderMap.get(user.getId())));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> users;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="问题2：大数据量查询内存溢出"><a href="#问题2：大数据量查询内存溢出" class="headerlink" title="问题2：大数据量查询内存溢出"></a>问题2：大数据量查询内存溢出</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 问题：一次性加载大量数据导致内存溢出</span></span><br><span class="line"><span class="meta">@Select(&quot;SELECT * FROM large_table&quot;)</span></span><br><span class="line">List&lt;LargeData&gt; <span class="title function_">findAllData</span><span class="params">()</span>; <span class="comment">// 可能导致OOM</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 解决方案1：分页查询</span></span><br><span class="line"><span class="keyword">public</span> List&lt;LargeData&gt; <span class="title function_">findAllDataWithPaging</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;LargeData&gt; allData = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">int</span> <span class="variable">pageSize</span> <span class="operator">=</span> <span class="number">1000</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">offset</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    List&lt;LargeData&gt; pageData;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        pageData = mapper.findDataWithLimit(offset, pageSize);</span><br><span class="line">        allData.addAll(pageData);</span><br><span class="line">        offset += pageSize;</span><br><span class="line">    &#125; <span class="keyword">while</span> (pageData.size() == pageSize);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> allData;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解决方案2：使用游标查询</span></span><br><span class="line"><span class="meta">@Select(&quot;SELECT * FROM large_table WHERE process_status = &#x27;PENDING&#x27;&quot;)</span></span><br><span class="line"><span class="meta">@Options(resultSetType = ResultSetType.FORWARD_ONLY, fetchSize = 1000)</span></span><br><span class="line">Cursor&lt;LargeData&gt; <span class="title function_">findPendingDataCursor</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processLargeData</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> (Cursor&lt;LargeData&gt; cursor = mapper.findPendingDataCursor()) &#123;</span><br><span class="line">        cursor.forEach(<span class="built_in">this</span>::processData);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="问题3：SQL注入防护"><a href="#问题3：SQL注入防护" class="headerlink" title="问题3：SQL注入防护"></a>问题3：SQL注入防护</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 危险：直接拼接SQL，容易SQL注入</span></span><br><span class="line"><span class="meta">@Select(&quot;SELECT * FROM users WHERE name = &#x27;$&#123;name&#125;&#x27;&quot;)</span> <span class="comment">// 错误示例</span></span><br><span class="line">List&lt;User&gt; <span class="title function_">findByNameUnsafe</span><span class="params">(<span class="meta">@Param(&quot;name&quot;)</span> String name)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 安全：使用参数绑定</span></span><br><span class="line"><span class="meta">@Select(&quot;SELECT * FROM users WHERE name = #&#123;name&#125;&quot;)</span></span><br><span class="line">List&lt;User&gt; <span class="title function_">findByNameSafe</span><span class="params">(<span class="meta">@Param(&quot;name&quot;)</span> String name)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 动态排序的安全处理</span></span><br><span class="line"><span class="meta">@SelectProvider(type = UserSqlProvider.class, method = &quot;findUsersWithSort&quot;)</span></span><br><span class="line">List&lt;User&gt; <span class="title function_">findUsersWithSort</span><span class="params">(<span class="meta">@Param(&quot;sortField&quot;)</span> String sortField, </span></span><br><span class="line"><span class="params">                            <span class="meta">@Param(&quot;sortDirection&quot;)</span> String sortDirection)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserSqlProvider</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Set&lt;String&gt; ALLOWED_SORT_FIELDS = </span><br><span class="line">        Set.of(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;email&quot;</span>, <span class="string">&quot;create_time&quot;</span>, <span class="string">&quot;update_time&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">findUsersWithSort</span><span class="params">(Map&lt;String, Object&gt; params)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sortField</span> <span class="operator">=</span> (String) params.get(<span class="string">&quot;sortField&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">sortDirection</span> <span class="operator">=</span> (String) params.get(<span class="string">&quot;sortDirection&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 白名单验证</span></span><br><span class="line">        <span class="keyword">if</span> (!ALLOWED_SORT_FIELDS.contains(sortField)) &#123;</span><br><span class="line">            sortField = <span class="string">&quot;id&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!<span class="string">&quot;DESC&quot;</span>.equalsIgnoreCase(sortDirection)) &#123;</span><br><span class="line">            sortDirection = <span class="string">&quot;ASC&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;SELECT * FROM users ORDER BY &quot;</span> + sortField + <span class="string">&quot; &quot;</span> + sortDirection;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-8-MyBatis面试高频问题"><a href="#4-8-MyBatis面试高频问题" class="headerlink" title="4.8 MyBatis面试高频问题"></a>4.8 MyBatis面试高频问题</h3><p><strong>Q1: MyBatis的执行流程是怎样的？</strong></p>
<p>A: MyBatis的执行流程包括以下步骤：</p>
<ol>
<li><strong>配置解析</strong>: 解析mybatis-config.xml配置文件和Mapper XML文件，创建Configuration对象</li>
<li><strong>SqlSessionFactory创建</strong>: 根据Configuration创建SqlSessionFactory</li>
<li><strong>SqlSession创建</strong>: 通过SqlSessionFactory.openSession()创建SqlSession</li>
<li><strong>Mapper获取</strong>: 通过SqlSession.getMapper()获取Mapper接口的代理对象</li>
<li><strong>方法调用</strong>: 调用Mapper接口方法，通过动态代理转换为SQL执行</li>
<li><strong>SQL执行</strong>: 通过Executor执行SQL，包括参数处理、语句执行、结果映射</li>
<li><strong>结果返回</strong>: 将执行结果返回给调用方</li>
</ol>
<p><strong>Q2: MyBatis的一级缓存和二级缓存有什么区别？</strong></p>
<p>A: 两级缓存的主要区别：</p>
<p><strong>一级缓存（默认开启）：</strong></p>
<ul>
<li>作用域：SqlSession级别</li>
<li>生命周期：与SqlSession相同，SqlSession关闭时缓存清空</li>
<li>存储结构：HashMap，key为CacheKey（由SQL、参数、分页等组成）</li>
<li>失效条件：执行update、insert、delete操作或手动清空</li>
</ul>
<p><strong>二级缓存（需要配置）：</strong></p>
<ul>
<li>作用域：Mapper级别，多个SqlSession可以共享</li>
<li>生命周期：与应用程序相同</li>
<li>存储结构：可配置（HashMap、LRU、FIFO等）</li>
<li>配置方式：@CacheNamespace注解或<cache>标签</li>
<li>注意事项：需要序列化，可能存在脏读问题</li>
</ul>
<p><strong>Q3: MyBatis如何防止SQL注入？</strong></p>
<p>A: MyBatis通过以下方式防止SQL注入：</p>
<ol>
<li><strong>参数绑定</strong>: 使用#{}而不是${}<ul>
<li>#{}：预编译处理，参数作为占位符传递</li>
<li>${}：字符串替换，直接拼接到SQL中（危险）</li>
</ul>
</li>
<li><strong>类型检查</strong>: MyBatis会对参数类型进行检查</li>
<li><strong>白名单验证</strong>: 对于动态排序等场景，使用白名单验证</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 安全的写法</span></span><br><span class="line"><span class="meta">@Select(&quot;SELECT * FROM users WHERE name = #&#123;name&#125; AND age &gt; #&#123;age&#125;&quot;)</span></span><br><span class="line">List&lt;User&gt; <span class="title function_">findUsers</span><span class="params">(<span class="meta">@Param(&quot;name&quot;)</span> String name, <span class="meta">@Param(&quot;age&quot;)</span> Integer age)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 危险的写法（避免使用）</span></span><br><span class="line"><span class="meta">@Select(&quot;SELECT * FROM users WHERE name = &#x27;$&#123;name&#125;&#x27;&quot;)</span></span><br><span class="line">List&lt;User&gt; <span class="title function_">findUsersUnsafe</span><span class="params">(<span class="meta">@Param(&quot;name&quot;)</span> String name)</span>;</span><br></pre></td></tr></table></figure>

<p><strong>Q4: MyBatis中#{}和${}的区别？</strong></p>
<p>A: 两者的主要区别：</p>
<p><strong>#{}（推荐使用）：</strong></p>
<ul>
<li>预编译处理，生成PreparedStatement</li>
<li>参数会被处理为占位符?</li>
<li>可以防止SQL注入</li>
<li>会进行类型转换</li>
<li>适用于参数值传递</li>
</ul>
<p><strong>${}（谨慎使用）：</strong></p>
<ul>
<li>字符串替换，直接拼接到SQL中</li>
<li>不会进行预编译</li>
<li>存在SQL注入风险</li>
<li>不会进行类型转换</li>
<li>适用于动态表名、列名等场景</li>
</ul>
<p><strong>Q5: MyBatis的动态SQL是如何实现的？</strong></p>
<p>A: MyBatis的动态SQL通过以下标签实现：</p>
<ol>
<li><strong>if标签</strong>: 条件判断</li>
<li><strong>choose&#x2F;when&#x2F;otherwise</strong>: 类似switch-case</li>
<li><strong>where标签</strong>: 智能处理WHERE条件</li>
<li><strong>set标签</strong>: 智能处理SET语句</li>
<li><strong>foreach标签</strong>: 循环处理</li>
<li><strong>trim标签</strong>: 去除多余的字符</li>
</ol>
<p>实现原理：</p>
<ul>
<li>使用OGNL表达式进行条件判断</li>
<li>在SQL解析阶段根据参数值动态生成SQL</li>
<li>通过SqlNode树结构表示动态SQL</li>
<li>在执行时遍历SqlNode树生成最终SQL</li>
</ul>
<h2 id="五、框架整合与最佳实践"><a href="#五、框架整合与最佳实践" class="headerlink" title="五、框架整合与最佳实践"></a>五、框架整合与最佳实践</h2><h3 id="5-1-Spring-Boot-MyBatis整合"><a href="#5-1-Spring-Boot-MyBatis整合" class="headerlink" title="5.1 Spring Boot + MyBatis整合"></a>5.1 Spring Boot + MyBatis整合</h3><h4 id="完整配置示例"><a href="#完整配置示例" class="headerlink" title="完整配置示例"></a>完整配置示例</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 主启动类</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.example.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数据源配置</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(&quot;spring.datasource.primary&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DataSourceProperties <span class="title function_">primaryDataSourceProperties</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DataSourceProperties</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">primaryDataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> primaryDataSourceProperties()</span><br><span class="line">                .initializeDataSourceBuilder()</span><br><span class="line">                .type(HikariDataSource.class)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SqlSessionFactory <span class="title function_">sqlSessionFactory</span><span class="params">(DataSource dataSource)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">SqlSessionFactoryBean</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBean</span>();</span><br><span class="line">        factory.setDataSource(dataSource);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// MyBatis配置</span></span><br><span class="line">        org.apache.ibatis.session.<span class="type">Configuration</span> <span class="variable">config</span> <span class="operator">=</span> </span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">org</span>.apache.ibatis.session.Configuration();</span><br><span class="line">        config.setMapUnderscoreToCamelCase(<span class="literal">true</span>);</span><br><span class="line">        config.setLogImpl(Slf4jImpl.class);</span><br><span class="line">        config.setCacheEnabled(<span class="literal">true</span>);</span><br><span class="line">        config.setLazyLoadingEnabled(<span class="literal">true</span>);</span><br><span class="line">        config.setAggressiveLazyLoading(<span class="literal">false</span>);</span><br><span class="line">        </span><br><span class="line">        factory.setConfiguration(config);</span><br><span class="line">        <span class="keyword">return</span> factory.getObject();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="事务管理配置"><a href="#事务管理配置" class="headerlink" title="事务管理配置"></a>事务管理配置</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderMapper orderMapper;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderItemMapper orderItemMapper;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ProductMapper productMapper;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> Order <span class="title function_">createOrder</span><span class="params">(CreateOrderRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 创建订单</span></span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Order</span>();</span><br><span class="line">        order.setUserId(request.getUserId());</span><br><span class="line">        order.setStatus(<span class="string">&quot;PENDING&quot;</span>);</span><br><span class="line">        order.setCreateTime(LocalDateTime.now());</span><br><span class="line">        orderMapper.insert(order);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. 创建订单项</span></span><br><span class="line">        <span class="type">BigDecimal</span> <span class="variable">totalAmount</span> <span class="operator">=</span> BigDecimal.ZERO;</span><br><span class="line">        List&lt;OrderItem&gt; orderItems = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (CreateOrderItemRequest itemRequest : request.getItems()) &#123;</span><br><span class="line">            <span class="comment">// 检查库存</span></span><br><span class="line">            <span class="type">Product</span> <span class="variable">product</span> <span class="operator">=</span> productMapper.findById(itemRequest.getProductId());</span><br><span class="line">            <span class="keyword">if</span> (product == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ProductNotFoundException</span>(<span class="string">&quot;Product not found: &quot;</span> + itemRequest.getProductId());</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (product.getStock() &lt; itemRequest.getQuantity()) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InsufficientStockException</span>(<span class="string">&quot;Insufficient stock for product: &quot;</span> + product.getName());</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 减库存</span></span><br><span class="line">            productMapper.decreaseStock(itemRequest.getProductId(), itemRequest.getQuantity());</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 创建订单项</span></span><br><span class="line">            <span class="type">OrderItem</span> <span class="variable">orderItem</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderItem</span>();</span><br><span class="line">            orderItem.setOrderId(order.getId());</span><br><span class="line">            orderItem.setProductId(itemRequest.getProductId());</span><br><span class="line">            orderItem.setQuantity(itemRequest.getQuantity());</span><br><span class="line">            orderItem.setPrice(product.getPrice());</span><br><span class="line">            orderItems.add(orderItem);</span><br><span class="line">            </span><br><span class="line">            totalAmount = totalAmount.add(</span><br><span class="line">                product.getPrice().multiply(BigDecimal.valueOf(itemRequest.getQuantity()))</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. 批量插入订单项</span></span><br><span class="line">        <span class="keyword">if</span> (!orderItems.isEmpty()) &#123;</span><br><span class="line">            orderItemMapper.batchInsert(orderItems);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 4. 更新订单总金额</span></span><br><span class="line">        order.setTotalAmount(totalAmount);</span><br><span class="line">        orderMapper.updateAmount(order.getId(), totalAmount);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> order;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Transactional(readOnly = true)</span></span><br><span class="line">    <span class="keyword">public</span> OrderDetailVO <span class="title function_">getOrderDetail</span><span class="params">(Long orderId)</span> &#123;</span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> orderMapper.findById(orderId);</span><br><span class="line">        <span class="keyword">if</span> (order == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OrderNotFoundException</span>(<span class="string">&quot;Order not found: &quot;</span> + orderId);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        List&lt;OrderItem&gt; orderItems = orderItemMapper.findByOrderId(orderId);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> OrderDetailVO.builder()</span><br><span class="line">                .order(order)</span><br><span class="line">                .items(orderItems)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-2-统一异常处理"><a href="#5-2-统一异常处理" class="headerlink" title="5.2 统一异常处理"></a>5.2 统一异常处理</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ExceptionHandler(ValidationException.class)</span></span><br><span class="line">    <span class="meta">@ResponseStatus(HttpStatus.BAD_REQUEST)</span></span><br><span class="line">    <span class="keyword">public</span> ApiResponse&lt;Void&gt; <span class="title function_">handleValidationException</span><span class="params">(ValidationException e)</span> &#123;</span><br><span class="line">        log.warn(<span class="string">&quot;Validation error: &#123;&#125;&quot;</span>, e.getMessage());</span><br><span class="line">        <span class="keyword">return</span> ApiResponse.error(<span class="string">&quot;VALIDATION_ERROR&quot;</span>, e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ExceptionHandler(MethodArgumentNotValidException.class)</span></span><br><span class="line">    <span class="meta">@ResponseStatus(HttpStatus.BAD_REQUEST)</span></span><br><span class="line">    <span class="keyword">public</span> ApiResponse&lt;Void&gt; <span class="title function_">handleMethodArgumentNotValid</span><span class="params">(MethodArgumentNotValidException e)</span> &#123;</span><br><span class="line">        List&lt;String&gt; errors = e.getBindingResult()</span><br><span class="line">                .getFieldErrors()</span><br><span class="line">                .stream()</span><br><span class="line">                .map(error -&gt; error.getField() + <span class="string">&quot;: &quot;</span> + error.getDefaultMessage())</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ApiResponse.error(<span class="string">&quot;VALIDATION_ERROR&quot;</span>, String.join(<span class="string">&quot;, &quot;</span>, errors));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ExceptionHandler(DataIntegrityViolationException.class)</span></span><br><span class="line">    <span class="meta">@ResponseStatus(HttpStatus.CONFLICT)</span></span><br><span class="line">    <span class="keyword">public</span> ApiResponse&lt;Void&gt; <span class="title function_">handleDataIntegrityViolation</span><span class="params">(DataIntegrityViolationException e)</span> &#123;</span><br><span class="line">        log.error(<span class="string">&quot;Data integrity violation&quot;</span>, e);</span><br><span class="line">        <span class="keyword">return</span> ApiResponse.error(<span class="string">&quot;DATA_CONFLICT&quot;</span>, <span class="string">&quot;Data conflict occurred&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ExceptionHandler(OptimisticLockingFailureException.class)</span></span><br><span class="line">    <span class="meta">@ResponseStatus(HttpStatus.CONFLICT)</span></span><br><span class="line">    <span class="keyword">public</span> ApiResponse&lt;Void&gt; <span class="title function_">handleOptimisticLockingFailure</span><span class="params">(OptimisticLockingFailureException e)</span> &#123;</span><br><span class="line">        log.warn(<span class="string">&quot;Optimistic locking failure: &#123;&#125;&quot;</span>, e.getMessage());</span><br><span class="line">        <span class="keyword">return</span> ApiResponse.error(<span class="string">&quot;OPTIMISTIC_LOCK_ERROR&quot;</span>, <span class="string">&quot;Resource has been modified by another user&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line">    <span class="meta">@ResponseStatus(HttpStatus.INTERNAL_SERVER_ERROR)</span></span><br><span class="line">    <span class="keyword">public</span> ApiResponse&lt;Void&gt; <span class="title function_">handleGenericException</span><span class="params">(Exception e)</span> &#123;</span><br><span class="line">        log.error(<span class="string">&quot;Unexpected error occurred&quot;</span>, e);</span><br><span class="line">        <span class="keyword">return</span> ApiResponse.error(<span class="string">&quot;INTERNAL_ERROR&quot;</span>, <span class="string">&quot;An unexpected error occurred&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-3-接口文档与验证"><a href="#5-3-接口文档与验证" class="headerlink" title="5.3 接口文档与验证"></a>5.3 接口文档与验证</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 统一响应格式</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApiResponse</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> success;</span><br><span class="line">    <span class="keyword">private</span> String code;</span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line">    <span class="keyword">private</span> T data;</span><br><span class="line">    <span class="keyword">private</span> Long timestamp;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; ApiResponse&lt;T&gt; <span class="title function_">success</span><span class="params">(T data)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ApiResponse.&lt;T&gt;builder()</span><br><span class="line">                .success(<span class="literal">true</span>)</span><br><span class="line">                .code(<span class="string">&quot;SUCCESS&quot;</span>)</span><br><span class="line">                .data(data)</span><br><span class="line">                .timestamp(System.currentTimeMillis())</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; ApiResponse&lt;T&gt; <span class="title function_">error</span><span class="params">(String code, String message)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ApiResponse.&lt;T&gt;builder()</span><br><span class="line">                .success(<span class="literal">false</span>)</span><br><span class="line">                .code(code)</span><br><span class="line">                .message(message)</span><br><span class="line">                .timestamp(System.currentTimeMillis())</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 请求参数验证</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Valid</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CreateUserRequest</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;用户名不能为空&quot;)</span></span><br><span class="line">    <span class="meta">@Size(min = 2, max = 20, message = &quot;用户名长度必须在2-20个字符之间&quot;)</span></span><br><span class="line">    <span class="meta">@Pattern(regexp = &quot;^[a-zA-Z0-9_\\u4e00-\\u9fa5]+$&quot;, message = &quot;用户名只能包含字母、数字、下划线和中文&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;邮箱不能为空&quot;)</span></span><br><span class="line">    <span class="meta">@Email(message = &quot;邮箱格式不正确&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;密码不能为空&quot;)</span></span><br><span class="line">    <span class="meta">@Size(min = 8, max = 20, message = &quot;密码长度必须在8-20个字符之间&quot;)</span></span><br><span class="line">    <span class="meta">@Pattern(</span></span><br><span class="line"><span class="meta">        regexp = &quot;^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[@$!%*?&amp;])[A-Za-z\\d@$!%*?&amp;]+$&quot;,</span></span><br><span class="line"><span class="meta">        message = &quot;密码必须包含大小写字母、数字和特殊字符&quot;</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotNull(message = &quot;年龄不能为空&quot;)</span></span><br><span class="line">    <span class="meta">@Min(value = 1, message = &quot;年龄必须大于0&quot;)</span></span><br><span class="line">    <span class="meta">@Max(value = 150, message = &quot;年龄不能超过150&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotEmpty(message = &quot;角色不能为空&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;<span class="meta">@NotBlank(message = &quot;角色名称不能为空&quot;)</span> String&gt; roles;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-4-性能监控与优化"><a href="#5-4-性能监控与优化" class="headerlink" title="5.4 性能监控与优化"></a>5.4 性能监控与优化</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 性能监控切面</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PerformanceMonitorAspect</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Around(&quot;@annotation(org.springframework.web.bind.annotation.RequestMapping) || &quot; +</span></span><br><span class="line"><span class="meta">            &quot;@annotation(org.springframework.web.bind.annotation.GetMapping) || &quot; +</span></span><br><span class="line"><span class="meta">            &quot;@annotation(org.springframework.web.bind.annotation.PostMapping) || &quot; +</span></span><br><span class="line"><span class="meta">            &quot;@annotation(org.springframework.web.bind.annotation.PutMapping) || &quot; +</span></span><br><span class="line"><span class="meta">            &quot;@annotation(org.springframework.web.bind.annotation.DeleteMapping)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">monitorPerformance</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> joinPoint.getSignature().toShortString();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> joinPoint.proceed();</span><br><span class="line">            <span class="type">long</span> <span class="variable">endTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">            <span class="type">long</span> <span class="variable">executionTime</span> <span class="operator">=</span> endTime - startTime;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (executionTime &gt; <span class="number">1000</span>) &#123; <span class="comment">// 超过1秒记录警告</span></span><br><span class="line">                log.warn(<span class="string">&quot;Slow API detected: &#123;&#125; took &#123;&#125;ms&quot;</span>, methodName, executionTime);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                log.info(<span class="string">&quot;API performance: &#123;&#125; took &#123;&#125;ms&quot;</span>, methodName, executionTime);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">endTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">            log.error(<span class="string">&quot;API error: &#123;&#125; took &#123;&#125;ms, error: &#123;&#125;&quot;</span>, </span><br><span class="line">                     methodName, endTime - startTime, e.getMessage());</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数据库连接池监控</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceHealthIndicator</span> <span class="keyword">implements</span> <span class="title class_">HealthIndicator</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DataSource dataSource;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Health <span class="title function_">health</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (dataSource <span class="keyword">instanceof</span> HikariDataSource) &#123;</span><br><span class="line">                <span class="type">HikariDataSource</span> <span class="variable">hikariDataSource</span> <span class="operator">=</span> (HikariDataSource) dataSource;</span><br><span class="line">                <span class="type">HikariPoolMXBean</span> <span class="variable">poolBean</span> <span class="operator">=</span> hikariDataSource.getHikariPoolMXBean();</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">return</span> Health.up()</span><br><span class="line">                        .withDetail(<span class="string">&quot;database&quot;</span>, <span class="string">&quot;MySQL&quot;</span>)</span><br><span class="line">                        .withDetail(<span class="string">&quot;activeConnections&quot;</span>, poolBean.getActiveConnections())</span><br><span class="line">                        .withDetail(<span class="string">&quot;idleConnections&quot;</span>, poolBean.getIdleConnections())</span><br><span class="line">                        .withDetail(<span class="string">&quot;totalConnections&quot;</span>, poolBean.getTotalConnections())</span><br><span class="line">                        .withDetail(<span class="string">&quot;threadsAwaitingConnection&quot;</span>, poolBean.getThreadsAwaitingConnection())</span><br><span class="line">                        .build();</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">try</span> (<span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> dataSource.getConnection()) &#123;</span><br><span class="line">                <span class="keyword">return</span> Health.up()</span><br><span class="line">                        .withDetail(<span class="string">&quot;database&quot;</span>, connection.getMetaData().getDatabaseProductName())</span><br><span class="line">                        .build();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> Health.down()</span><br><span class="line">                    .withDetail(<span class="string">&quot;error&quot;</span>, e.getMessage())</span><br><span class="line">                    .build();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-5-高频面试综合题"><a href="#5-5-高频面试综合题" class="headerlink" title="5.5 高频面试综合题"></a>5.5 高频面试综合题</h3><p><strong>Q1: 在微服务架构中，如何设计一个高并发的订单系统？</strong></p>
<p>A: 设计高并发订单系统需要考虑以下几个方面：</p>
<p><strong>1. 架构设计：</strong></p>
<ul>
<li>使用分布式架构，订单服务、库存服务、支付服务分离</li>
<li>引入消息队列处理异步任务</li>
<li>使用Redis做缓存和分布式锁</li>
<li>数据库读写分离，分库分表</li>
</ul>
<p><strong>2. 并发控制：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, String&gt; redisTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> Order <span class="title function_">createOrder</span><span class="params">(CreateOrderRequest request)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">lockKey</span> <span class="operator">=</span> <span class="string">&quot;order:lock:&quot;</span> + request.getUserId();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 分布式锁防止重复下单</span></span><br><span class="line">        <span class="type">Boolean</span> <span class="variable">locked</span> <span class="operator">=</span> redisTemplate.opsForValue()</span><br><span class="line">            .setIfAbsent(lockKey, <span class="string">&quot;1&quot;</span>, Duration.ofSeconds(<span class="number">30</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!locked) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OrderCreationException</span>(<span class="string">&quot;Order creation in progress&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 订单创建逻辑</span></span><br><span class="line">            <span class="keyword">return</span> processOrder(request);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            redisTemplate.delete(lockKey);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>3. 性能优化：</strong></p>
<ul>
<li>使用批量操作减少数据库交互</li>
<li>合理使用缓存策略</li>
<li>异步处理非核心业务逻辑</li>
<li>数据库连接池优化</li>
</ul>
<p><strong>Q2: 如何处理分布式事务？</strong></p>
<p>A: 分布式事务处理方案：</p>
<p><strong>1. 2PC&#x2F;3PC协议：</strong></p>
<ul>
<li>强一致性，但性能较差</li>
<li>适用于对一致性要求极高的场景</li>
</ul>
<p><strong>2. TCC模式：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TccTransaction</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderTccService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">tryCreateOrder</span><span class="params">(CreateOrderRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// Try阶段：预留资源</span></span><br><span class="line">        orderService.reserveOrder(request);</span><br><span class="line">        stockService.reserveStock(request.getItems());</span><br><span class="line">        paymentService.reservePayment(request.getPaymentInfo());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">confirmCreateOrder</span><span class="params">(CreateOrderRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// Confirm阶段：确认操作</span></span><br><span class="line">        orderService.confirmOrder(request);</span><br><span class="line">        stockService.confirmStock(request.getItems());</span><br><span class="line">        paymentService.confirmPayment(request.getPaymentInfo());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cancelCreateOrder</span><span class="params">(CreateOrderRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// Cancel阶段：回滚操作</span></span><br><span class="line">        orderService.cancelOrder(request);</span><br><span class="line">        stockService.cancelStock(request.getItems());</span><br><span class="line">        paymentService.cancelPayment(request.getPaymentInfo());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>3. 消息队列最终一致性：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderEventService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="meta">@Async</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleOrderCreated</span><span class="params">(OrderCreatedEvent event)</span> &#123;</span><br><span class="line">        <span class="comment">// 异步处理订单相关业务</span></span><br><span class="line">        notificationService.sendOrderNotification(event.getOrder());</span><br><span class="line">        inventoryService.updateInventory(event.getOrderItems());</span><br><span class="line">        pointsService.addPoints(event.getUserId(), event.getAmount());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Q3: Spring Boot应用如何优化启动速度？</strong></p>
<p>A: Spring Boot启动优化策略：</p>
<p><strong>1. 依赖优化：</strong></p>
<ul>
<li>移除不必要的依赖</li>
<li>使用spring-boot-starter-web替代完整的spring-web</li>
<li>避免引入大量自动配置类</li>
</ul>
<p><strong>2. 配置优化：</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">main:</span></span><br><span class="line">    <span class="attr">lazy-initialization:</span> <span class="literal">true</span>  <span class="comment"># 启用懒加载</span></span><br><span class="line">  <span class="attr">jpa:</span></span><br><span class="line">    <span class="attr">hibernate:</span></span><br><span class="line">      <span class="attr">ddl-auto:</span> <span class="string">none</span>           <span class="comment"># 禁用DDL自动生成</span></span><br><span class="line">    <span class="attr">show-sql:</span> <span class="literal">false</span>            <span class="comment"># 禁用SQL日志</span></span><br><span class="line">  <span class="attr">devtools:</span></span><br><span class="line">    <span class="attr">restart:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">false</span>           <span class="comment"># 生产环境禁用热重启</span></span><br></pre></td></tr></table></figure>

<p><strong>3. JVM优化：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">java -XX:+UnlockExperimentalVMOptions </span><br><span class="line">     -XX:+UseZGC </span><br><span class="line">     -XX:+UseTransparentHugePages</span><br><span class="line">     -XX:MaxMetaspaceSize=256m</span><br><span class="line">     -Xms512m -Xmx1024m</span><br><span class="line">     -jar application.jar</span><br></pre></td></tr></table></figure>

<p><strong>4. 代码优化：</strong></p>
<ul>
<li>使用@Lazy注解延迟Bean初始化</li>
<li>避免在@PostConstruct中执行耗时操作</li>
<li>合理使用@ConditionalOn*注解</li>
</ul>
<p>好的，这是一份详细的解释，我们来逐个分析这些 Java 虚拟机（JVM）参数：</p>
<p>Bash</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -XX:+UnlockExperimentalVMOptions -XX:+UseZGC -XX:+UseTransparentHugePages -XX:MaxMetaspaceSize=256m -Xms512m -Xmx1024m -jar application.jar</span><br></pre></td></tr></table></figure>

<ul>
<li><code>java</code>: 这是启动 Java 程序的命令。</li>
</ul>
<hr>
<h3 id="内存管理和垃圾回收"><a href="#内存管理和垃圾回收" class="headerlink" title="内存管理和垃圾回收"></a>内存管理和垃圾回收</h3><p>这部分参数主要用于优化 JVM 的内存使用和垃圾回收机制，以获得更好的性能。</p>
<ul>
<li><code>-XX:+UnlockExperimentalVMOptions</code>: 这个参数是用来<strong>解锁实验性（experimental）的 JVM 选项</strong>。ZGC 曾经是实验性功能，所以需要这个参数才能使用。</li>
<li><code>-XX:+UseZGC</code>: 这条命令是启用 <strong>Z 垃圾回收器（Z Garbage Collector）</strong>。ZGC 是一种为<strong>超大堆内存</strong>（从几GB到几十TB）设计的、<strong>低延迟</strong>的垃圾回收器。它的主要目标是在垃圾回收时，尽量减少应用程序的停顿时间，这对于需要极低延迟的应用程序非常重要。</li>
<li><code>-XX:+UseTransparentHugePages</code>: 这个参数开启了<strong>透明大页（Transparent Huge Pages）的支持。在操作系统层面，通常内存是以 4KB 的小页来管理的。而大页（通常是 2MB 或 1GB）可以减少 CPU 在内存管理上的开销，从而提升性能，尤其对于内存占用较大</strong>的应用效果更明显。</li>
<li><code>-XX:MaxMetaspaceSize=256m</code>: 这个参数设置了<strong>元空间（Metaspace）的最大大小为 256MB</strong>。元空间是 JVM 存储类的元数据（如类的名称、方法、字段等信息）的地方。在 Java 8 之后，它取代了之前的“永久代”（PermGen）。</li>
<li><code>-Xms512m</code>: 这条命令设定了 <strong>JVM 堆的初始内存为 512MB</strong>。堆是用来存放 Java 对象的地方。<code>-Xms</code> 决定了 JVM 启动时会申请的最小内存。</li>
<li><code>-Xmx1024m</code>: 这条命令设定了 <strong>JVM 堆的最大内存为 1024MB（即 1GB）</strong>。这是 JVM 运行时可以使用的最大内存。当堆内存用尽时，JVM 会触发垃圾回收，如果依然不足，就会抛出 <code>OutOfMemoryError</code>。</li>
</ul>
<hr>
<p>好的，我们来更详细地聊聊 JVM 堆内存的结构，特别是分代设计和具体的划分比例。</p>
<hr>
<h3 id="堆内存的传统分代结构"><a href="#堆内存的传统分代结构" class="headerlink" title="堆内存的传统分代结构"></a>堆内存的传统分代结构</h3><p>在绝大多数的垃圾回收器中（例如 CMS、G1 之前的串行和并行 GC），堆内存被分为以下几个代（Generation）：</p>
<h4 id="1-年轻代（Young-Generation）"><a href="#1-年轻代（Young-Generation）" class="headerlink" title="1. 年轻代（Young Generation）"></a>1. 年轻代（Young Generation）</h4><p><strong>年轻代是新对象的诞生地。</strong> 绝大多数对象，比如局部变量创建的临时对象，都会在年轻代被创建。年轻代被设计成较小且垃圾回收频率高的区域。</p>
<ul>
<li><strong>Eden 区</strong>：这是年轻代的主要部分，新创建的对象首先被分配到这里。</li>
<li><strong>Survivor 区（幸存者区）</strong>：有两个大小相等的 Survivor 区，通常命名为 <strong>S0</strong> 和 <strong>S1</strong>。它们的作用是保存每次垃圾回收后，还存活的对象。</li>
</ul>
<p><strong>划分比例</strong></p>
<p>在默认情况下，年轻代内部的划分比例通常是：</p>
<ul>
<li><strong>Eden 区 : S0 区 : S1 区 &#x3D; 8 : 1 : 1</strong></li>
</ul>
<p>这个比例可以通过 JVM 参数进行调整，比如使用 <code>-XX:SurvivorRatio=8</code>。这意味着 Eden 区的大小是单个 Survivor 区的 8 倍。</p>
<h4 id="2-老年代（Old-Generation）"><a href="#2-老年代（Old-Generation）" class="headerlink" title="2. 老年代（Old Generation）"></a>2. 老年代（Old Generation）</h4><p><strong>老年代用于存放生命周期较长的对象。</strong> 当一个对象在年轻代经过多次垃圾回收（通常是 15 次，这个次数也可以通过 <code>-XX:MaxTenuringThreshold</code> 参数调整）后仍然存活，或者年轻代放不下的大对象，就会被“晋升”到老年代。</p>
<p>老年代的垃圾回收频率远低于年轻代，但每次回收的开销更大。</p>
<p><strong>划分比例</strong></p>
<p>堆内存中，年轻代和老年代的默认划分比例通常是：</p>
<ul>
<li><strong>年轻代 : 老年代 &#x3D; 1 : 2</strong></li>
</ul>
<p>例如，如果你设置 <code>-Xms1200m -Xmx1200m</code>，那么年轻代大约是 400MB，老年代大约是 800MB。这个比例可以通过 <code>-XX:NewRatio</code> 参数来调整。例如，<code>-XX:NewRatio=2</code> 表示老年代与年轻代的大小比值为 2:1。</p>
<hr>
<h3 id="垃圾回收过程（以-Minor-GC-为例）"><a href="#垃圾回收过程（以-Minor-GC-为例）" class="headerlink" title="垃圾回收过程（以 Minor GC 为例）"></a>垃圾回收过程（以 Minor GC 为例）</h3><p>理解了这些区域，我们再来看看垃圾回收是怎么进行的：</p>
<ol>
<li>当 <strong>Eden 区</strong>满了，会触发一次 <strong>Minor GC</strong>。</li>
<li>Minor GC 会检查 Eden 区和其中一个 Survivor 区（比如 S0）。</li>
<li>它会将所有还<strong>存活的对象</strong>复制到另一个空的 Survivor 区（比如 S1）。</li>
<li>同时，那些<strong>不再被引用的对象</strong>则会被清理。</li>
<li>所有被复制到 S1 区的对象，它们的年龄（<code>age</code>）会加一。</li>
<li>下一次 Minor GC 发生时，同样会扫描 Eden 区和 S1 区，将存活对象复制到 S0 区，清空 Eden 和 S1 区，并增加对象的年龄。</li>
<li>当对象的年龄达到某个阈值时，它就会被<strong>晋升</strong>到老年代。</li>
</ol>
<h3 id="现代垃圾回收器（如-G1-和-ZGC）"><a href="#现代垃圾回收器（如-G1-和-ZGC）" class="headerlink" title="现代垃圾回收器（如 G1 和 ZGC）"></a>现代垃圾回收器（如 G1 和 ZGC）</h3><p>值得注意的是，像 <strong>G1 垃圾回收器</strong>已经打破了这种严格的分代比例。它将堆划分为一个个大小相等的<strong>区域（Region）</strong>，每个区域都可以是 Eden、Survivor 或者老年代。G1 能够更智能地选择要回收的区域，从而在保证低停顿的同时，提高吞吐量。</p>
<p>而 <strong>ZGC</strong> 则更进一步，如我之前所说，它<strong>完全没有年轻代、老年代的概念</strong>，而是通过着色指针和读屏障技术，在不中断应用程序的情况下并发地进行垃圾回收，实现了更低的停顿。</p>
<p>因此，当你使用 ZGC 时，传统的分代比例就不适用了。不过，了解传统的分代结构对于理解 Java 内存管理的基础依然非常重要。</p>
<p>以下是针对Spring Cloud Alibaba及其他分布式技术的深度补充，包含实现原理和核心组件的详细说明：</p>
<hr>
<h2 id="六、Spring-Cloud与分布式技术详解"><a href="#六、Spring-Cloud与分布式技术详解" class="headerlink" title="六、Spring Cloud与分布式技术详解"></a>六、Spring Cloud与分布式技术详解</h2><h3 id="6-1-Spring-Cloud-Alibaba核心组件"><a href="#6-1-Spring-Cloud-Alibaba核心组件" class="headerlink" title="6.1 Spring Cloud Alibaba核心组件"></a>6.1 Spring Cloud Alibaba核心组件</h3><h4 id="Nacos深度解析"><a href="#Nacos深度解析" class="headerlink" title="Nacos深度解析"></a>Nacos深度解析</h4><p><strong>服务发现原理</strong>：</p>
<ol>
<li><p><strong>注册流程</strong>：</p>
<ul>
<li>服务启动时向Nacos Server发送注册请求（HTTP&#x2F;GRPC）</li>
<li>注册信息包含元数据、健康检查方式（TCP&#x2F;HTTP&#x2F;MySQL）</li>
<li>客户端本地缓存服务列表（故障转移）</li>
</ul>
</li>
<li><p><strong>健康检查机制</strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Nacos健康检查配置示例</span></span><br><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    nacos:</span><br><span class="line">      discovery:</span><br><span class="line">        health-check-enabled: <span class="literal">true</span></span><br><span class="line">        health-check-interval: 10s</span><br><span class="line">        health-check-timeout: 5s</span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>配置中心实现</strong>：</p>
<ul>
<li><strong>长轮询机制</strong>（Push+Pull混合模式）：<ul>
<li>客户端发起长轮询请求（默认30秒超时）</li>
<li>服务端配置变更时立即响应</li>
<li>客户端收到变更后拉取最新配置</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 动态配置刷新示例</span></span><br><span class="line"><span class="meta">@RefreshScope</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfigController</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;app.config.item&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String configItem;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Sentinel核心原理"><a href="#Sentinel核心原理" class="headerlink" title="Sentinel核心原理"></a>Sentinel核心原理</h4><p><strong>流量控制规则</strong>：</p>
<ul>
<li><strong>滑动窗口算法</strong>：<ul>
<li>统计周期（1秒）分为多个格子（如20个50ms）</li>
<li>实时淘汰过期格子数据</li>
<li>QPS计算基于当前窗口总请求数</li>
</ul>
</li>
</ul>
<p><strong>熔断降级策略</strong>：</p>
<table>
<thead>
<tr>
<th>策略类型</th>
<th>计算公式</th>
<th>适用场景</th>
</tr>
</thead>
<tbody><tr>
<td>慢调用比例</td>
<td>响应时间 &gt; RT阈值 &amp;&amp; 比例 &gt; 阈值</td>
<td>接口性能波动</td>
</tr>
<tr>
<td>异常比例</td>
<td>异常数 &#x2F; 请求数 &gt; 阈值</td>
<td>依赖服务不稳定</td>
</tr>
<tr>
<td>异常数</td>
<td>异常数 &gt; 阈值（时间窗口内）</td>
<td>关键业务熔断</td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Sentinel规则持久化到Nacos示例</span></span><br><span class="line"><span class="meta">@PostConstruct</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initRules</span><span class="params">()</span> &#123;</span><br><span class="line">    FlowRuleManager.register2Property(</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">NacosDataSourceWrapper</span>(</span><br><span class="line">            <span class="string">&quot;nacos-server:8848&quot;</span>, <span class="string">&quot;sentinel-flow-rules&quot;</span>,</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Converter</span>&lt;String, List&lt;FlowRule&gt;&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> List&lt;FlowRule&gt; <span class="title function_">convert</span><span class="params">(String source)</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> JSON.parseArray(source, FlowRule.class);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="RocketMQ集成"><a href="#RocketMQ集成" class="headerlink" title="RocketMQ集成"></a>RocketMQ集成</h4><p><strong>消息轨迹追踪</strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 生产者配置</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> RocketMQTemplate <span class="title function_">rocketMQTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">RocketMQTemplate</span> <span class="variable">template</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RocketMQTemplate</span>();</span><br><span class="line">    template.setProducer(<span class="keyword">new</span> <span class="title class_">DefaultMQProducer</span>(<span class="string">&quot;producer_group&quot;</span>) &#123;&#123;</span><br><span class="line">        setVipChannelEnabled(<span class="literal">false</span>);</span><br><span class="line">        setTraceDispatcher(<span class="keyword">new</span> <span class="title class_">AsyncTraceDispatcher</span>(<span class="string">&quot;trace_topic&quot;</span>));</span><br><span class="line">    &#125;&#125;);</span><br><span class="line">    <span class="keyword">return</span> template;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 消费者轨迹追踪</span></span><br><span class="line"><span class="meta">@RocketMQMessageListener(</span></span><br><span class="line"><span class="meta">    topic = &quot;order_topic&quot;, </span></span><br><span class="line"><span class="meta">    consumerGroup = &quot;order_consumer&quot;,</span></span><br><span class="line"><span class="meta">    enableMsgTrace = true</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderConsumer</span> <span class="keyword">implements</span> <span class="title class_">RocketMQListener</span>&lt;String&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onMessage</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="comment">// 处理逻辑</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-2-分布式事务增强（Seata原理）"><a href="#6-2-分布式事务增强（Seata原理）" class="headerlink" title="6.2 分布式事务增强（Seata原理）"></a>6.2 分布式事务增强（Seata原理）</h3><h4 id="AT模式工作流程"><a href="#AT模式工作流程" class="headerlink" title="AT模式工作流程"></a>AT模式工作流程</h4><ol>
<li><p><strong>一阶段</strong>：</p>
<ul>
<li>解析SQL生成前后镜像</li>
<li>注册分支事务到TC（Transaction Coordinator）</li>
<li>本地事务提交前记录undo_log</li>
</ul>
</li>
<li><p><strong>二阶段</strong>：</p>
<ul>
<li>成功：异步删除undo_log</li>
<li>失败：根据undo_log补偿（反向SQL）</li>
</ul>
</li>
</ol>
<p><strong>undo_log表示例</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> `undo_log` (</span><br><span class="line">  `id` <span class="type">bigint</span> <span class="keyword">NOT NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `branch_id` <span class="type">bigint</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">  `xid` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  `context` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  `rollback_info` longblob <span class="keyword">NOT NULL</span>,</span><br><span class="line">  `log_status` <span class="type">int</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">  `log_created` datetime <span class="keyword">NOT NULL</span>,</span><br><span class="line">  `log_modified` datetime <span class="keyword">NOT NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY KEY</span> (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `ux_undo_log` (`xid`,`branch_id`)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="TCC模式最佳实践"><a href="#TCC模式最佳实践" class="headerlink" title="TCC模式最佳实践"></a>TCC模式最佳实践</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 账户服务TCC接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AccountTccService</span> &#123;</span><br><span class="line">    <span class="meta">@TwoPhaseBusinessAction(</span></span><br><span class="line"><span class="meta">        name = &quot;deduct&quot;,</span></span><br><span class="line"><span class="meta">        commitMethod = &quot;confirmDeduct&quot;,</span></span><br><span class="line"><span class="meta">        rollbackMethod = &quot;cancelDeduct&quot;</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">prepareDeduct</span><span class="params">(</span></span><br><span class="line"><span class="params">        <span class="meta">@BusinessActionContextParameter(paramName = &quot;userId&quot;)</span> String userId,</span></span><br><span class="line"><span class="params">        <span class="meta">@BusinessActionContextParameter(paramName = &quot;amount&quot;)</span> BigDecimal amount</span></span><br><span class="line"><span class="params">    )</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">confirmDeduct</span><span class="params">(BusinessActionContext context)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">cancelDeduct</span><span class="params">(BusinessActionContext context)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 业务调用方</span></span><br><span class="line"><span class="meta">@GlobalTransactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">placeOrder</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. 冻结库存</span></span><br><span class="line">    inventoryTccService.prepare(<span class="literal">null</span>, order.getProductId(), order.getCount());</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 预扣款</span></span><br><span class="line">    accountTccService.prepareDeduct(order.getUserId(), order.getAmount());</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 创建订单</span></span><br><span class="line">    orderMapper.insert(order);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-3-分布式缓存深度优化"><a href="#6-3-分布式缓存深度优化" class="headerlink" title="6.3 分布式缓存深度优化"></a>6.3 分布式缓存深度优化</h3><h4 id="Redis多级缓存架构"><a href="#Redis多级缓存架构" class="headerlink" title="Redis多级缓存架构"></a>Redis多级缓存架构</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 本地缓存+Caffeine+Redis实现</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> CacheManager <span class="title function_">cacheManager</span><span class="params">(RedisConnectionFactory factory)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CaffeineRedisCacheManager</span>(</span><br><span class="line">        Caffeine.newBuilder()</span><br><span class="line">            .expireAfterWrite(<span class="number">10</span>, TimeUnit.MINUTES)</span><br><span class="line">            .maximumSize(<span class="number">1000</span>),</span><br><span class="line">        RedisCacheWriter.nonLockingRedisCacheWriter(factory),</span><br><span class="line">        RedisCacheConfiguration.defaultCacheConfig()</span><br><span class="line">            .entryTtl(Duration.ofHours(<span class="number">1</span>))</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 热点Key探测</span></span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; T <span class="title function_">getWithHotspotProtection</span><span class="params">(String key, Class&lt;T&gt; type)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. 本地缓存查询</span></span><br><span class="line">    <span class="type">T</span> <span class="variable">value</span> <span class="operator">=</span> localCache.getIfPresent(key);</span><br><span class="line">    <span class="keyword">if</span> (value != <span class="literal">null</span>) <span class="keyword">return</span> value;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. Redis集群查询（带随机过期时间）</span></span><br><span class="line">    value = redisTemplate.opsForValue().get(key);</span><br><span class="line">    <span class="keyword">if</span> (value != <span class="literal">null</span>) &#123;</span><br><span class="line">        localCache.put(key, value);</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 分布式锁防击穿</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">lockKey</span> <span class="operator">=</span> <span class="string">&quot;lock:&quot;</span> + key;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (redisLock.tryLock(lockKey, <span class="number">3</span>, <span class="number">30</span>)) &#123;</span><br><span class="line">            <span class="comment">// 4. 数据库查询</span></span><br><span class="line">            value = databaseLoader.load(key);</span><br><span class="line">            redisTemplate.opsForValue().set(</span><br><span class="line">                key, value, </span><br><span class="line">                ThreadLocalRandom.current().nextInt(<span class="number">30</span>) + <span class="number">30</span>, </span><br><span class="line">                TimeUnit.MINUTES</span><br><span class="line">            );</span><br><span class="line">            localCache.put(key, value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        redisLock.unlock(lockKey);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-4-消息队列高级特性"><a href="#6-4-消息队列高级特性" class="headerlink" title="6.4 消息队列高级特性"></a>6.4 消息队列高级特性</h3><h4 id="RocketMQ事务消息"><a href="#RocketMQ事务消息" class="headerlink" title="RocketMQ事务消息"></a>RocketMQ事务消息</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 事务消息生产者</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendTransactionMessage</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">    <span class="type">TransactionSendResult</span> <span class="variable">result</span> <span class="operator">=</span> rocketMQTemplate.sendMessageInTransaction(</span><br><span class="line">        <span class="string">&quot;order-tx-group&quot;</span>,</span><br><span class="line">        MessageBuilder.withPayload(order)</span><br><span class="line">            .setHeader(RocketMQHeaders.TRANSACTION_ID, order.getId())</span><br><span class="line">            .build(),</span><br><span class="line">        order</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 本地事务执行器</span></span><br><span class="line"><span class="meta">@RocketMQTransactionListener(txProducerGroup = &quot;order-tx-group&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderTransactionListenerImpl</span> <span class="keyword">implements</span> <span class="title class_">RocketMQLocalTransactionListener</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> RocketMQLocalTransactionState <span class="title function_">executeLocalTransaction</span><span class="params">(Message msg, Object arg)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> (Order) arg;</span><br><span class="line">            orderService.createOrder(order); <span class="comment">// 本地事务</span></span><br><span class="line">            <span class="keyword">return</span> RocketMQLocalTransactionState.COMMIT;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> RocketMQLocalTransactionState.ROLLBACK;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> RocketMQLocalTransactionState <span class="title function_">checkLocalTransaction</span><span class="params">(Message msg)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">orderId</span> <span class="operator">=</span> msg.getHeaders().get(<span class="string">&quot;TRANSACTION_ID&quot;</span>).toString();</span><br><span class="line">        <span class="keyword">return</span> orderService.exists(orderId) ? </span><br><span class="line">            RocketMQLocalTransactionState.COMMIT : </span><br><span class="line">            RocketMQLocalTransactionState.ROLLBACK;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Kafka精确一次语义"><a href="#Kafka精确一次语义" class="headerlink" title="Kafka精确一次语义"></a>Kafka精确一次语义</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 生产者配置</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> ProducerFactory&lt;String, String&gt; <span class="title function_">producerFactory</span><span class="params">()</span> &#123;</span><br><span class="line">    Map&lt;String, Object&gt; configs = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    configs.put(ProducerConfig.ENABLE_IDEMPOTENCE_CONFIG, <span class="literal">true</span>);</span><br><span class="line">    configs.put(ProducerConfig.TRANSACTIONAL_ID_CONFIG, <span class="string">&quot;tx-producer-1&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DefaultKafkaProducerFactory</span>&lt;&gt;(configs);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 消费者配置</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> ConsumerFactory&lt;String, String&gt; <span class="title function_">consumerFactory</span><span class="params">()</span> &#123;</span><br><span class="line">    Map&lt;String, Object&gt; configs = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    configs.put(ConsumerConfig.ISOLATION_LEVEL_CONFIG, <span class="string">&quot;read_committed&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DefaultKafkaConsumerFactory</span>&lt;&gt;(configs);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 事务性消费</span></span><br><span class="line"><span class="meta">@KafkaListener(topics = &quot;order-topic&quot;)</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processOrder</span><span class="params">(ConsumerRecord&lt;String, String&gt; record)</span> &#123;</span><br><span class="line">    <span class="type">OrderEvent</span> <span class="variable">event</span> <span class="operator">=</span> parseEvent(record.value());</span><br><span class="line">    orderService.process(event); <span class="comment">// 数据库操作</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="七、云原生支持（新增）"><a href="#七、云原生支持（新增）" class="headerlink" title="七、云原生支持（新增）"></a>七、云原生支持（新增）</h2><h3 id="7-1-Kubernetes集成方案"><a href="#7-1-Kubernetes集成方案" class="headerlink" title="7.1 Kubernetes集成方案"></a>7.1 Kubernetes集成方案</h3><h4 id="服务发现适配"><a href="#服务发现适配" class="headerlink" title="服务发现适配"></a>服务发现适配</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Nacos与K8s Service集成</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">kubernetes:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">all-namespaces:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">$&#123;NACOS_HOST:nacos-headless&#125;:$&#123;NACOS_PORT:8848&#125;</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">$&#123;POD_NAMESPACE:default&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="配置管理方案"><a href="#配置管理方案" class="headerlink" title="配置管理方案"></a>配置管理方案</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 多配置源加载（K8s ConfigMap + Nacos）</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;app&quot;)</span></span><br><span class="line"><span class="meta">@RefreshScope</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;configFromNacos&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String nacosConfig;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;configFromK8s&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String k8sConfig;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="7-2-Service-Mesh整合"><a href="#7-2-Service-Mesh整合" class="headerlink" title="7.2 Service Mesh整合"></a>7.2 Service Mesh整合</h3><h4 id="Istio流量治理"><a href="#Istio流量治理" class="headerlink" title="Istio流量治理"></a>Istio流量治理</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 金丝雀发布策略</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.istio.io/v1alpha3</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">VirtualService</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">order-service</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">hosts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">order-service</span></span><br><span class="line">  <span class="attr">http:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">route:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">destination:</span></span><br><span class="line">            <span class="attr">host:</span> <span class="string">order-service</span></span><br><span class="line">            <span class="attr">subset:</span> <span class="string">v1</span></span><br><span class="line">          <span class="attr">weight:</span> <span class="number">90</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">destination:</span></span><br><span class="line">            <span class="attr">host:</span> <span class="string">order-service</span></span><br><span class="line">            <span class="attr">subset:</span> <span class="string">v2</span></span><br><span class="line">          <span class="attr">weight:</span> <span class="number">10</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="八、性能优化深度实践"><a href="#八、性能优化深度实践" class="headerlink" title="八、性能优化深度实践"></a>八、性能优化深度实践</h2><h3 id="8-1-全链路压测方案"><a href="#8-1-全链路压测方案" class="headerlink" title="8.1 全链路压测方案"></a>8.1 全链路压测方案</h3><h4 id="影子库表配置"><a href="#影子库表配置" class="headerlink" title="影子库表配置"></a>影子库表配置</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ShardingSphere影子库配置</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">shardingsphere:</span></span><br><span class="line">    <span class="attr">datasource:</span></span><br><span class="line">      <span class="attr">names:</span> <span class="string">ds-real,ds-shadow</span></span><br><span class="line">    <span class="attr">rules:</span></span><br><span class="line">      <span class="attr">shadow:</span></span><br><span class="line">        <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">data-sources:</span></span><br><span class="line">          <span class="attr">shadow-data-source:</span></span><br><span class="line">            <span class="attr">source-data-source-name:</span> <span class="string">ds-real</span></span><br><span class="line">            <span class="attr">shadow-data-source-name:</span> <span class="string">ds-shadow</span></span><br><span class="line">        <span class="attr">tables:</span></span><br><span class="line">          <span class="attr">t_order:</span></span><br><span class="line">            <span class="attr">shadow-algorithm-names:</span> [<span class="string">simple-hint-algorithm</span>]</span><br></pre></td></tr></table></figure>

<h4 id="流量染色标记"><a href="#流量染色标记" class="headerlink" title="流量染色标记"></a>流量染色标记</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通过ThreadLocal传递压测标记</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PressureTestContext</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;Boolean&gt; FLAG = ThreadLocal.withInitial(() -&gt; <span class="literal">false</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">markPressureTest</span><span class="params">()</span> &#123;</span><br><span class="line">        FLAG.set(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isPressureTest</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> FLAG.get();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MyBatis拦截器自动路由</span></span><br><span class="line"><span class="meta">@Intercepts(@Signature(type=Executor.class, method=&quot;update&quot;, args=&#123;MappedStatement.class,Object.class&#125;))</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShadowDbInterceptor</span> <span class="keyword">implements</span> <span class="title class_">Interceptor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">intercept</span><span class="params">(Invocation invocation)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="keyword">if</span> (PressureTestContext.isPressureTest()) &#123;</span><br><span class="line">            RoutingContext.setShadowDataSource();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> invocation.proceed();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://example.com">Charlotte</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2025/09/11/%E6%A1%86%E6%9E%B6%E8%83%8C%E8%AF%B5/">http://example.com/2025/09/11/%E6%A1%86%E6%9E%B6%E8%83%8C%E8%AF%B5/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://example.com" target="_blank">浮生若梦</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Hexo-Markdown/">Hexo, Markdown</a></div><div class="post-share"><div class="social-share" data-image="/img/title.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/09/11/%E5%9F%BA%E7%A1%80%E8%83%8C%E8%AF%B5/" title="基础背诵"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">基础背诵</div></div><div class="info-2"><div class="info-item-1">网络基础OSI七层模型OSI (Open Systems Interconnection) 参考模型是一个抽象的、概念性的框架，旨在定义网络通信的功能分层，促进不同系统之间的互操作性。它将网络通信过程分为七个独立的层次，每层负责特定的功能。数据在发送端从上层向下层传输，每层添加自己的控制信息（封装），在接收端则从下层向上层传输，每层剥离对应的控制信息（解封装）。  物理层 (Physical Layer)   功能：负责传输比特流，即原始的二进制数据。定义了物理媒介的电气特性、机械特性、功能特性和过程特性。 工作方式：不关心比特的含义，只负责将其从一个节点传输到另一个节点。例如，规定网络的接口形状、电压、传输速率等。 协议&#x2F;设备：网线 (Ethernet Cable)、光纤 (Fiber Optic)、集线器 (Hub)、中继器 (Repeater)、网卡 (NIC) 的物理部分。 数据单位：比特 (Bit)。   数据链路层 (Data Link Layer)   功能：在物理层提供的不可靠比特流服务的基础上，将比特组合成帧，提供节点到节点之间的数据传输。负责差错控制...</div></div></div></a><a class="pagination-related  no-desc" href="/2025/09/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E9%9D%A2%E8%AF%95/" title="计算机基础面试"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">计算机基础面试</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/09/11/8.21%E5%AD%A6%E4%BC%9A/" title="8.21学会"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-11</div><div class="info-item-2">8.21学会</div></div><div class="info-2"><div class="info-item-1">1.实现单例模式 (Singleton Pattern)懒汉式：使用双重检查锁定 (DCL) 实现线程安全的懒汉式单例模式。这种模式在第一次调用时才创建实例，并且通过两次检查和同步块确保了线程安全和性能。 1234567891011121314151617181920212223242526272829class Singleton &#123;    // 1. volatile 关键字确保多线程环境下，instance 变量的修改能够立即被其他线程看到    private static volatile Singleton instance;    // 2. 私有化构造器，防止外部直接 new 实例    private Singleton() &#123;&#125;    // 3. 提供一个全局访问点，使用 DCL 确保线程安全    public static Singleton getInstance() &#123;        // 第一次检查：如果实例已经存在，直接返回，避免不必要的同步        if (instance == null) &#12...</div></div></div></a><a class="pagination-related no-desc" href="/2025/09/11/%E5%91%BD%E4%BB%A4%E5%A4%A7%E5%85%A8/" title="命令大全"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-11</div><div class="info-item-2">命令大全</div></div></div></a><a class="pagination-related" href="/2025/09/11/%E5%88%86%E5%B8%83%E5%BC%8F/" title="分布式"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-11</div><div class="info-item-2">分布式</div></div><div class="info-2"><div class="info-item-1">1. Spring Cloud 体系核心思想Spring Cloud 并非一个全新的框架，而是一套用于构建微服务架构的规范和解决方案的集合。它巧妙地利用了 Spring Boot 的自动配置和快速开发特性，将业界经过广泛验证的优秀微服务组件（如 Netflix OSS、Alibaba Nacos、HashiCorp Consul 等）进行封装和集成，为开发者提供了一站式的分布式系统开发工具箱，涵盖了服务治理、配置管理、熔断降级、智能路由、服务调用等方方面面。 Netflix OSS 常用组件（部分进入维护模式） 服务注册与发现 (Service Discovery): Eureka 作用: 提供一个服务注册中心。每个微服务启动时，将自己的网络地址等信息“注册”到 Eureka Server。其他服务（消费者）则从 Eureka Server “发现”并拉取所需服务提供者的地址列表，从而实现服务间的动态寻址和调用。 使用: 服务端添加 spring-cloud-starter-netflix-eureka-server 依赖，并使用 @EnableEurekaServer 注解。客...</div></div></div></a><a class="pagination-related no-desc" href="/2025/09/11/%E6%A1%86%E6%9E%B6/" title="框架"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-11</div><div class="info-item-2">框架</div></div></div></a><a class="pagination-related" href="/2025/09/11/%E6%89%8B%E5%86%99%E7%AD%94%E6%A1%88/" title="手写答案"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-11</div><div class="info-item-2">手写答案</div></div><div class="info-2"><div class="info-item-1">1.实现单例模式 (Singleton Pattern)懒汉式：使用双重检查锁定 (DCL) 实现线程安全的懒汉式单例模式。这种模式在第一次调用时才创建实例，并且通过两次检查和同步块确保了线程安全和性能。 1234567891011121314151617181920212223242526272829class Singleton &#123;    // 1. volatile 关键字确保多线程环境下，instance 变量的修改能够立即被其他线程看到    private static volatile Singleton instance;    // 2. 私有化构造器，防止外部直接 new 实例    private Singleton() &#123;&#125;    // 3. 提供一个全局访问点，使用 DCL 确保线程安全    public static Singleton getInstance() &#123;        // 第一次检查：如果实例已经存在，直接返回，避免不必要的同步        if (instance == null) &#12...</div></div></div></a><a class="pagination-related" href="/2025/09/11/web/" title="web"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-11</div><div class="info-item-2">web</div></div><div class="info-2"><div class="info-item-1">好的，让我们深入到 HTTP 协议的底层，全面解剖它的工作原理、请求-响应模型、以及各个组成部分。  一、HTTP 协议概述HTTP（Hypertext Transfer Protocol，超文本传输协议）是应用层协议，它定义了 Web 客户端（如浏览器）和 Web 服务器之间交换数据的规则。它的核心特点是无状态（Stateless），这意味着服务器不会保存客户端的任何信息，每次请求都是独立的。  二、HTTP 请求（Request）一个完整的 HTTP 请求由四部分组成： 1. 请求行（Request Line）这是请求的第一行，它定义了请求的基本信息。  请求方法（Method）：如 GET, POST, PUT, DELETE 等，表示对资源的操作类型。 请求 URL (URI)：资源的地址。 HTTP 协议版本：如 HTTP/1.1, HTTP/2.0。  示例： GET &#x2F;index.html HTTP&#x2F;1.1 2. 请求头（Request Headers）请求头提供了关于客户端、请求体和一些其他元数据的信息。它们以键值对的形式存在。  Host：指...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/title.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Charlotte</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">16</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">1</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/charlotte030710"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Java%E6%A1%86%E6%9E%B6%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.</span> <span class="toc-text">Java框架核心知识详解</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81Spring%E6%A1%86%E6%9E%B6%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90"><span class="toc-number">1.1.</span> <span class="toc-text">一、Spring框架深入解析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-Spring%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E4%B8%8E%E5%8E%9F%E7%90%86"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.1 Spring核心概念与原理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#IoC%E5%AE%B9%E5%99%A8%E5%8E%9F%E7%90%86%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">IoC容器原理深入分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DI%E7%9A%84%E4%B8%89%E7%A7%8D%E6%B3%A8%E5%85%A5%E6%96%B9%E5%BC%8F%E5%AF%B9%E6%AF%94"><span class="toc-number">1.1.1.2.</span> <span class="toc-text">DI的三种注入方式对比</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AOP%E5%8E%9F%E7%90%86%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90"><span class="toc-number">1.1.1.3.</span> <span class="toc-text">AOP原理深入分析</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%8C%9F-%E4%B8%80%E3%80%81Spring-AOP-%E5%AE%9E%E7%8E%B0%E6%9C%BA%E5%88%B6%E6%A6%82%E8%BF%B0"><span class="toc-number">1.2.</span> <span class="toc-text">🌟 一、Spring AOP 实现机制概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%A7%A9-%E4%BA%8C%E3%80%81Spring-AOP-%E7%9A%84%E4%B8%A4%E7%A7%8D%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E6%96%B9%E5%BC%8F"><span class="toc-number">1.3.</span> <span class="toc-text">🧩 二、Spring AOP 的两种动态代理方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%B8%8F%E2%83%A3-JDK-%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%EF%BC%88%E5%9F%BA%E4%BA%8E%E6%8E%A5%E5%8F%A3%EF%BC%89"><span class="toc-number">1.3.1.</span> <span class="toc-text">1️⃣ JDK 动态代理（基于接口）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%9C%85-%E5%8E%9F%E7%90%86%EF%BC%9A"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">✅ 原理：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%93%A6-%E7%A4%BA%E4%BE%8B%EF%BC%9A"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">📦 示例：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%8E%AF-%E7%89%B9%E7%82%B9%EF%BC%9A"><span class="toc-number">1.3.1.3.</span> <span class="toc-text">🎯 特点：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%B8%8F%E2%83%A3-CGLIB-%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%EF%BC%88%E5%9F%BA%E4%BA%8E%E5%AD%90%E7%B1%BB%EF%BC%89"><span class="toc-number">1.3.2.</span> <span class="toc-text">2️⃣ CGLIB 动态代理（基于子类）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%9C%85-%E5%8E%9F%E7%90%86%EF%BC%9A-1"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">✅ 原理：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%A7%AA-%E7%A4%BA%E4%BE%8B%EF%BC%9A"><span class="toc-number">1.3.2.2.</span> <span class="toc-text">🧪 示例：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%8E%AF-%E7%89%B9%E7%82%B9%EF%BC%9A-1"><span class="toc-number">1.3.2.3.</span> <span class="toc-text">🎯 特点：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%8F%97-%E4%B8%89%E3%80%81%E9%9D%99%E6%80%81%E4%BB%A3%E7%90%86%EF%BC%88%E5%AF%B9%E6%AF%94%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%EF%BC%89"><span class="toc-number">1.4.</span> <span class="toc-text">🏗 三、静态代理（对比动态代理）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9C%85-%E5%8E%9F%E7%90%86%EF%BC%9A-2"><span class="toc-number">1.4.1.</span> <span class="toc-text">✅ 原理：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%A7%AA-%E7%A4%BA%E4%BE%8B%EF%BC%9A-1"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">🧪 示例：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%8E%AF-%E7%89%B9%E7%82%B9%EF%BC%9A-2"><span class="toc-number">1.4.1.2.</span> <span class="toc-text">🎯 特点：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%94%9A-%E5%9B%9B%E3%80%81%E4%B8%89%E8%80%85%E5%AF%B9%E6%AF%94%E6%80%BB%E7%BB%93"><span class="toc-number">1.5.</span> <span class="toc-text">🔚 四、三者对比总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%9C%85-Spring-%E5%A6%82%E4%BD%95%E9%80%89%E6%8B%A9%E4%BB%A3%E7%90%86%E6%96%B9%E5%BC%8F%EF%BC%9F"><span class="toc-number">1.6.</span> <span class="toc-text">✅ Spring 如何选择代理方式？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-Spring%E6%A0%B8%E5%BF%83%E6%B3%A8%E8%A7%A3%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.6.1.</span> <span class="toc-text">1.2 Spring核心注解详解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.6.1.1.</span> <span class="toc-text">基础配置注解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Bean%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.6.1.2.</span> <span class="toc-text">Bean定义注解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.6.1.3.</span> <span class="toc-text">依赖注入注解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.6.1.4.</span> <span class="toc-text">生命周期注解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AOP%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.6.1.5.</span> <span class="toc-text">AOP相关注解</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-Spring%E5%B8%B8%E8%A7%81%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.6.2.</span> <span class="toc-text">1.3 Spring常见使用场景</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF1%EF%BC%9A%E6%9C%8D%E5%8A%A1%E5%B1%82%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86"><span class="toc-number">1.6.2.1.</span> <span class="toc-text">场景1：服务层事务管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF2%EF%BC%9A%E7%BC%93%E5%AD%98%E7%AE%A1%E7%90%86"><span class="toc-number">1.6.2.2.</span> <span class="toc-text">场景2：缓存管理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-Spring%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98"><span class="toc-number">1.6.3.</span> <span class="toc-text">1.4 Spring常见面试问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81Spring-Boot%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90"><span class="toc-number">1.7.</span> <span class="toc-text">二、Spring Boot深入解析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-Spring-Boot%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86"><span class="toc-number">1.7.1.</span> <span class="toc-text">2.1 Spring Boot核心原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-Spring-Boot%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.7.2.</span> <span class="toc-text">2.2 Spring Boot启动流程详解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-Spring-Boot%E6%A0%B8%E5%BF%83%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.7.3.</span> <span class="toc-text">2.3 Spring Boot核心注解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E7%B1%BB%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.7.3.1.</span> <span class="toc-text">启动类注解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.7.3.2.</span> <span class="toc-text">条件注解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E5%B1%9E%E6%80%A7%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.7.3.3.</span> <span class="toc-text">配置属性注解</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-Spring-Boot%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.7.4.</span> <span class="toc-text">2.4 Spring Boot实际应用场景</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF1%EF%BC%9A%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84"><span class="toc-number">1.7.4.1.</span> <span class="toc-text">场景1：微服务架构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF2%EF%BC%9A%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE%E5%B1%82%E6%95%B4%E5%90%88"><span class="toc-number">1.7.4.2.</span> <span class="toc-text">场景2：数据访问层整合</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-Spring-Boot%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98"><span class="toc-number">1.7.5.</span> <span class="toc-text">2.5 Spring Boot面试问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81Spring-MVC%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90"><span class="toc-number">1.8.</span> <span class="toc-text">三、Spring MVC深入解析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-Spring-MVC%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6"><span class="toc-number">1.8.1.</span> <span class="toc-text">3.1 Spring MVC核心组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-Spring-MVC%E6%A0%B8%E5%BF%83%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.8.2.</span> <span class="toc-text">3.2 Spring MVC核心注解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E5%99%A8%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.8.2.1.</span> <span class="toc-text">控制器注解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E7%BB%91%E5%AE%9A%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.8.2.2.</span> <span class="toc-text">参数绑定注解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E5%A4%84%E7%90%86%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.8.2.3.</span> <span class="toc-text">响应处理注解</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-Spring-MVC%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.8.3.</span> <span class="toc-text">3.3 Spring MVC实际应用场景</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF1%EF%BC%9ARESTful-API%E5%BC%80%E5%8F%91"><span class="toc-number">1.8.3.1.</span> <span class="toc-text">场景1：RESTful API开发</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF2%EF%BC%9A%E5%85%A8%E5%B1%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-number">1.8.3.2.</span> <span class="toc-text">场景2：全局异常处理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF3%EF%BC%9A%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%A4%84%E7%90%86"><span class="toc-number">1.8.3.3.</span> <span class="toc-text">场景3：文件上传处理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-Spring-MVC%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98"><span class="toc-number">1.8.4.</span> <span class="toc-text">3.4 Spring MVC面试问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81MyBatis%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90"><span class="toc-number">1.9.</span> <span class="toc-text">四、MyBatis深入解析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-MyBatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86"><span class="toc-number">1.9.1.</span> <span class="toc-text">4.1 MyBatis核心原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-MyBatis%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.9.2.</span> <span class="toc-text">4.2 MyBatis执行流程详解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-MyBatis%E6%A0%B8%E5%BF%83%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.9.3.</span> <span class="toc-text">4.3 MyBatis核心注解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E6%98%A0%E5%B0%84%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.9.3.1.</span> <span class="toc-text">基础映射注解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7%E6%98%A0%E5%B0%84%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.9.3.2.</span> <span class="toc-text">高级映射注解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A8%E6%80%81SQL%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.9.3.3.</span> <span class="toc-text">动态SQL注解</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-MyBatis%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6"><span class="toc-number">1.9.4.</span> <span class="toc-text">4.4 MyBatis缓存机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-MyBatis%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.9.5.</span> <span class="toc-text">4.5 MyBatis实际应用场景</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF1%EF%BC%9A%E5%A4%8D%E6%9D%82%E6%9F%A5%E8%AF%A2%E5%9C%BA%E6%99%AF"><span class="toc-number">1.9.5.1.</span> <span class="toc-text">场景1：复杂查询场景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF2%EF%BC%9A%E6%89%B9%E9%87%8F%E6%93%8D%E4%BD%9C%E5%9C%BA%E6%99%AF"><span class="toc-number">1.9.5.2.</span> <span class="toc-text">场景2：批量操作场景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF3%EF%BC%9A%E5%8A%A8%E6%80%81SQL%E5%9C%BA%E6%99%AF"><span class="toc-number">1.9.5.3.</span> <span class="toc-text">场景3：动态SQL场景</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-6-MyBatis%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="toc-number">1.9.6.</span> <span class="toc-text">4.6 MyBatis性能优化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A51%EF%BC%9A%E5%90%88%E7%90%86%E4%BD%BF%E7%94%A8%E7%BC%93%E5%AD%98"><span class="toc-number">1.9.6.1.</span> <span class="toc-text">优化策略1：合理使用缓存</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A52%EF%BC%9A%E6%89%B9%E9%87%8F%E6%93%8D%E4%BD%9C"><span class="toc-number">1.9.6.2.</span> <span class="toc-text">优化策略2：批量操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A53%EF%BC%9A%E5%BB%B6%E8%BF%9F%E5%8A%A0%E8%BD%BD"><span class="toc-number">1.9.6.3.</span> <span class="toc-text">优化策略3：延迟加载</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-7-MyBatis%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E4%B8%8E%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">1.9.7.</span> <span class="toc-text">4.7 MyBatis常见问题与解决方案</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%981%EF%BC%9AN-1%E6%9F%A5%E8%AF%A2%E9%97%AE%E9%A2%98"><span class="toc-number">1.9.7.1.</span> <span class="toc-text">问题1：N+1查询问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%982%EF%BC%9A%E5%A4%A7%E6%95%B0%E6%8D%AE%E9%87%8F%E6%9F%A5%E8%AF%A2%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA"><span class="toc-number">1.9.7.2.</span> <span class="toc-text">问题2：大数据量查询内存溢出</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%983%EF%BC%9ASQL%E6%B3%A8%E5%85%A5%E9%98%B2%E6%8A%A4"><span class="toc-number">1.9.7.3.</span> <span class="toc-text">问题3：SQL注入防护</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-8-MyBatis%E9%9D%A2%E8%AF%95%E9%AB%98%E9%A2%91%E9%97%AE%E9%A2%98"><span class="toc-number">1.9.8.</span> <span class="toc-text">4.8 MyBatis面试高频问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88%E4%B8%8E%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-number">1.10.</span> <span class="toc-text">五、框架整合与最佳实践</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-Spring-Boot-MyBatis%E6%95%B4%E5%90%88"><span class="toc-number">1.10.1.</span> <span class="toc-text">5.1 Spring Boot + MyBatis整合</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%8C%E6%95%B4%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.10.1.1.</span> <span class="toc-text">完整配置示例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86%E9%85%8D%E7%BD%AE"><span class="toc-number">1.10.1.2.</span> <span class="toc-text">事务管理配置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E7%BB%9F%E4%B8%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-number">1.10.2.</span> <span class="toc-text">5.2 统一异常处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3%E4%B8%8E%E9%AA%8C%E8%AF%81"><span class="toc-number">1.10.3.</span> <span class="toc-text">5.3 接口文档与验证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E4%B8%8E%E4%BC%98%E5%8C%96"><span class="toc-number">1.10.4.</span> <span class="toc-text">5.4 性能监控与优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E7%BB%BC%E5%90%88%E9%A2%98"><span class="toc-number">1.10.5.</span> <span class="toc-text">5.5 高频面试综合题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E5%92%8C%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6"><span class="toc-number">1.10.6.</span> <span class="toc-text">内存管理和垃圾回收</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A0%86%E5%86%85%E5%AD%98%E7%9A%84%E4%BC%A0%E7%BB%9F%E5%88%86%E4%BB%A3%E7%BB%93%E6%9E%84"><span class="toc-number">1.10.7.</span> <span class="toc-text">堆内存的传统分代结构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%B9%B4%E8%BD%BB%E4%BB%A3%EF%BC%88Young-Generation%EF%BC%89"><span class="toc-number">1.10.7.1.</span> <span class="toc-text">1. 年轻代（Young Generation）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E8%80%81%E5%B9%B4%E4%BB%A3%EF%BC%88Old-Generation%EF%BC%89"><span class="toc-number">1.10.7.2.</span> <span class="toc-text">2. 老年代（Old Generation）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E8%BF%87%E7%A8%8B%EF%BC%88%E4%BB%A5-Minor-GC-%E4%B8%BA%E4%BE%8B%EF%BC%89"><span class="toc-number">1.10.8.</span> <span class="toc-text">垃圾回收过程（以 Minor GC 为例）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%B0%E4%BB%A3%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8%EF%BC%88%E5%A6%82-G1-%E5%92%8C-ZGC%EF%BC%89"><span class="toc-number">1.10.9.</span> <span class="toc-text">现代垃圾回收器（如 G1 和 ZGC）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81Spring-Cloud%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.11.</span> <span class="toc-text">六、Spring Cloud与分布式技术详解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-Spring-Cloud-Alibaba%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6"><span class="toc-number">1.11.1.</span> <span class="toc-text">6.1 Spring Cloud Alibaba核心组件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Nacos%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90"><span class="toc-number">1.11.1.1.</span> <span class="toc-text">Nacos深度解析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Sentinel%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86"><span class="toc-number">1.11.1.2.</span> <span class="toc-text">Sentinel核心原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RocketMQ%E9%9B%86%E6%88%90"><span class="toc-number">1.11.1.3.</span> <span class="toc-text">RocketMQ集成</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E5%A2%9E%E5%BC%BA%EF%BC%88Seata%E5%8E%9F%E7%90%86%EF%BC%89"><span class="toc-number">1.11.2.</span> <span class="toc-text">6.2 分布式事务增强（Seata原理）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#AT%E6%A8%A1%E5%BC%8F%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-number">1.11.2.1.</span> <span class="toc-text">AT模式工作流程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#TCC%E6%A8%A1%E5%BC%8F%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-number">1.11.2.2.</span> <span class="toc-text">TCC模式最佳实践</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-%E5%88%86%E5%B8%83%E5%BC%8F%E7%BC%93%E5%AD%98%E6%B7%B1%E5%BA%A6%E4%BC%98%E5%8C%96"><span class="toc-number">1.11.3.</span> <span class="toc-text">6.3 分布式缓存深度优化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Redis%E5%A4%9A%E7%BA%A7%E7%BC%93%E5%AD%98%E6%9E%B6%E6%9E%84"><span class="toc-number">1.11.3.1.</span> <span class="toc-text">Redis多级缓存架构</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7"><span class="toc-number">1.11.4.</span> <span class="toc-text">6.4 消息队列高级特性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#RocketMQ%E4%BA%8B%E5%8A%A1%E6%B6%88%E6%81%AF"><span class="toc-number">1.11.4.1.</span> <span class="toc-text">RocketMQ事务消息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Kafka%E7%B2%BE%E7%A1%AE%E4%B8%80%E6%AC%A1%E8%AF%AD%E4%B9%89"><span class="toc-number">1.11.4.2.</span> <span class="toc-text">Kafka精确一次语义</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E4%BA%91%E5%8E%9F%E7%94%9F%E6%94%AF%E6%8C%81%EF%BC%88%E6%96%B0%E5%A2%9E%EF%BC%89"><span class="toc-number">1.12.</span> <span class="toc-text">七、云原生支持（新增）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-Kubernetes%E9%9B%86%E6%88%90%E6%96%B9%E6%A1%88"><span class="toc-number">1.12.1.</span> <span class="toc-text">7.1 Kubernetes集成方案</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0%E9%80%82%E9%85%8D"><span class="toc-number">1.12.1.1.</span> <span class="toc-text">服务发现适配</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86%E6%96%B9%E6%A1%88"><span class="toc-number">1.12.1.2.</span> <span class="toc-text">配置管理方案</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-Service-Mesh%E6%95%B4%E5%90%88"><span class="toc-number">1.12.2.</span> <span class="toc-text">7.2 Service Mesh整合</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Istio%E6%B5%81%E9%87%8F%E6%B2%BB%E7%90%86"><span class="toc-number">1.12.2.1.</span> <span class="toc-text">Istio流量治理</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB%E3%80%81%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E6%B7%B1%E5%BA%A6%E5%AE%9E%E8%B7%B5"><span class="toc-number">1.13.</span> <span class="toc-text">八、性能优化深度实践</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-%E5%85%A8%E9%93%BE%E8%B7%AF%E5%8E%8B%E6%B5%8B%E6%96%B9%E6%A1%88"><span class="toc-number">1.13.1.</span> <span class="toc-text">8.1 全链路压测方案</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BD%B1%E5%AD%90%E5%BA%93%E8%A1%A8%E9%85%8D%E7%BD%AE"><span class="toc-number">1.13.1.1.</span> <span class="toc-text">影子库表配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%81%E9%87%8F%E6%9F%93%E8%89%B2%E6%A0%87%E8%AE%B0"><span class="toc-number">1.13.1.2.</span> <span class="toc-text">流量染色标记</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/11/8.21%E5%AD%A6%E4%BC%9A/" title="8.21学会">8.21学会</a><time datetime="2025-09-11T10:29:28.000Z" title="发表于 2025-09-11 18:29:28">2025-09-11</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/11/%E5%91%BD%E4%BB%A4%E5%A4%A7%E5%85%A8/" title="命令大全">命令大全</a><time datetime="2025-09-11T10:29:28.000Z" title="发表于 2025-09-11 18:29:28">2025-09-11</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/11/%E5%88%86%E5%B8%83%E5%BC%8F/" title="分布式">分布式</a><time datetime="2025-09-11T10:29:28.000Z" title="发表于 2025-09-11 18:29:28">2025-09-11</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/11/%E6%A1%86%E6%9E%B6/" title="框架">框架</a><time datetime="2025-09-11T10:29:28.000Z" title="发表于 2025-09-11 18:29:28">2025-09-11</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/11/%E6%89%8B%E5%86%99%E7%AD%94%E6%A1%88/" title="手写答案">手写答案</a><time datetime="2025-09-11T10:29:28.000Z" title="发表于 2025-09-11 18:29:28">2025-09-11</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/bg.jpg);"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By Charlotte</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.0</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script src="/js/custom.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>