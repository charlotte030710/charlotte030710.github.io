<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>æ¡†æ¶èƒŒè¯µ | æµ®ç”Ÿè‹¥æ¢¦</title><meta name="author" content="Charlotte"><meta name="copyright" content="Charlotte"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Javaæ¡†æ¶æ ¸å¿ƒçŸ¥è¯†è¯¦è§£ä¸€ã€Springæ¡†æ¶æ·±å…¥è§£æ1.1 Springæ ¸å¿ƒæ¦‚å¿µä¸åŸç†Springæ¡†æ¶æ˜¯ä¸€ä¸ªåˆ†å±‚çš„ä¼ä¸šçº§åº”ç”¨å¼€å‘æ¡†æ¶ï¼Œå…¶æ ¸å¿ƒæ˜¯æ§åˆ¶åè½¬ï¼ˆIoCï¼‰å’Œé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼ˆAOPï¼‰ã€‚ IoCå®¹å™¨åŸç†æ·±å…¥åˆ†æIoCï¼ˆæ§åˆ¶åè½¬ï¼‰çš„æœ¬è´¨ï¼š ä¼ ç»Ÿå¼€å‘ä¸­ï¼Œå¯¹è±¡çš„åˆ›å»ºå’Œä¾èµ–å…³ç³»ç”±ç¨‹åºä»£ç ç›´æ¥æ§åˆ¶ï¼Œè€ŒIoCå°†è¿™ä¸ªæ§åˆ¶æƒäº¤ç»™äº†å¤–éƒ¨å®¹å™¨ã€‚Springé€šè¿‡ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰æ¥å®ç°IoCã€‚ IoCå®¹å™¨çš„å®ç°æœºåˆ¶ï¼š">
<meta property="og:type" content="article">
<meta property="og:title" content="æ¡†æ¶èƒŒè¯µ">
<meta property="og:url" content="http://example.com/2025/09/11/%E6%A1%86%E6%9E%B6%E8%83%8C%E8%AF%B5/index.html">
<meta property="og:site_name" content="æµ®ç”Ÿè‹¥æ¢¦">
<meta property="og:description" content="Javaæ¡†æ¶æ ¸å¿ƒçŸ¥è¯†è¯¦è§£ä¸€ã€Springæ¡†æ¶æ·±å…¥è§£æ1.1 Springæ ¸å¿ƒæ¦‚å¿µä¸åŸç†Springæ¡†æ¶æ˜¯ä¸€ä¸ªåˆ†å±‚çš„ä¼ä¸šçº§åº”ç”¨å¼€å‘æ¡†æ¶ï¼Œå…¶æ ¸å¿ƒæ˜¯æ§åˆ¶åè½¬ï¼ˆIoCï¼‰å’Œé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼ˆAOPï¼‰ã€‚ IoCå®¹å™¨åŸç†æ·±å…¥åˆ†æIoCï¼ˆæ§åˆ¶åè½¬ï¼‰çš„æœ¬è´¨ï¼š ä¼ ç»Ÿå¼€å‘ä¸­ï¼Œå¯¹è±¡çš„åˆ›å»ºå’Œä¾èµ–å…³ç³»ç”±ç¨‹åºä»£ç ç›´æ¥æ§åˆ¶ï¼Œè€ŒIoCå°†è¿™ä¸ªæ§åˆ¶æƒäº¤ç»™äº†å¤–éƒ¨å®¹å™¨ã€‚Springé€šè¿‡ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰æ¥å®ç°IoCã€‚ IoCå®¹å™¨çš„å®ç°æœºåˆ¶ï¼š">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/title.jpg">
<meta property="article:published_time" content="2025-09-11T10:29:28.000Z">
<meta property="article:modified_time" content="2025-09-11T10:29:28.011Z">
<meta property="article:author" content="Charlotte">
<meta property="article:tag" content="Hexo, Markdown">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/title.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "æ¡†æ¶èƒŒè¯µ",
  "url": "http://example.com/2025/09/11/%E6%A1%86%E6%9E%B6%E8%83%8C%E8%AF%B5/",
  "image": "http://example.com/img/title.jpg",
  "datePublished": "2025-09-11T10:29:28.000Z",
  "dateModified": "2025-09-11T10:29:28.011Z",
  "author": [
    {
      "@type": "Person",
      "name": "Charlotte",
      "url": "http://example.com"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.svg"><link rel="canonical" href="http://example.com/2025/09/11/%E6%A1%86%E6%9E%B6%E8%83%8C%E8%AF%B5/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶å¤±è´¥',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'åŠ è½½æ›´å¤š'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'æ¡†æ¶èƒŒè¯µ',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/custom.css"><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="æµ®ç”Ÿè‹¥æ¢¦" type="application/atom+xml">
</head><body><div id="web_bg" style="background-image: url(/img/bg.jpg);"></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/bg.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/img/title.jpg" alt="Logo"><span class="site-name">æµ®ç”Ÿè‹¥æ¢¦</span></a><a class="nav-page-title" href="/"><span class="site-name">æ¡†æ¶èƒŒè¯µ</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  è¿”å›é¦–é¡µ</span></span></a></span><div id="menus"></div></nav><div id="post-info"><h1 class="post-title">æ¡†æ¶èƒŒè¯µ</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2025-09-11T10:29:28.000Z" title="å‘è¡¨äº 2025-09-11 18:29:28">2025-09-11</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2025-09-11T10:29:28.011Z" title="æ›´æ–°äº 2025-09-11 18:29:28">2025-09-11</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%9C%AA%E5%88%86%E7%B1%BB/">æœªåˆ†ç±»</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">æµè§ˆé‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="Javaæ¡†æ¶æ ¸å¿ƒçŸ¥è¯†è¯¦è§£"><a href="#Javaæ¡†æ¶æ ¸å¿ƒçŸ¥è¯†è¯¦è§£" class="headerlink" title="Javaæ¡†æ¶æ ¸å¿ƒçŸ¥è¯†è¯¦è§£"></a>Javaæ¡†æ¶æ ¸å¿ƒçŸ¥è¯†è¯¦è§£</h1><h2 id="ä¸€ã€Springæ¡†æ¶æ·±å…¥è§£æ"><a href="#ä¸€ã€Springæ¡†æ¶æ·±å…¥è§£æ" class="headerlink" title="ä¸€ã€Springæ¡†æ¶æ·±å…¥è§£æ"></a>ä¸€ã€Springæ¡†æ¶æ·±å…¥è§£æ</h2><h3 id="1-1-Springæ ¸å¿ƒæ¦‚å¿µä¸åŸç†"><a href="#1-1-Springæ ¸å¿ƒæ¦‚å¿µä¸åŸç†" class="headerlink" title="1.1 Springæ ¸å¿ƒæ¦‚å¿µä¸åŸç†"></a>1.1 Springæ ¸å¿ƒæ¦‚å¿µä¸åŸç†</h3><p>Springæ¡†æ¶æ˜¯ä¸€ä¸ªåˆ†å±‚çš„ä¼ä¸šçº§åº”ç”¨å¼€å‘æ¡†æ¶ï¼Œå…¶æ ¸å¿ƒæ˜¯æ§åˆ¶åè½¬ï¼ˆIoCï¼‰å’Œé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼ˆAOPï¼‰ã€‚</p>
<h4 id="IoCå®¹å™¨åŸç†æ·±å…¥åˆ†æ"><a href="#IoCå®¹å™¨åŸç†æ·±å…¥åˆ†æ" class="headerlink" title="IoCå®¹å™¨åŸç†æ·±å…¥åˆ†æ"></a>IoCå®¹å™¨åŸç†æ·±å…¥åˆ†æ</h4><p><strong>IoCï¼ˆæ§åˆ¶åè½¬ï¼‰çš„æœ¬è´¨ï¼š</strong> ä¼ ç»Ÿå¼€å‘ä¸­ï¼Œå¯¹è±¡çš„åˆ›å»ºå’Œä¾èµ–å…³ç³»ç”±ç¨‹åºä»£ç ç›´æ¥æ§åˆ¶ï¼Œè€ŒIoCå°†è¿™ä¸ªæ§åˆ¶æƒäº¤ç»™äº†å¤–éƒ¨å®¹å™¨ã€‚Springé€šè¿‡ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰æ¥å®ç°IoCã€‚</p>
<p><strong>IoCå®¹å™¨çš„å®ç°æœºåˆ¶ï¼š</strong></p>
<ol>
<li><strong>BeanFactory</strong>: åŸºç¡€å®¹å™¨ï¼Œæä¾›åŸºæœ¬çš„IoCåŠŸèƒ½</li>
<li><strong>ApplicationContext</strong>: é«˜çº§å®¹å™¨ï¼Œç»§æ‰¿BeanFactoryï¼Œæä¾›æ›´å¤šä¼ä¸šçº§åŠŸèƒ½</li>
</ol>
<p><strong>Beançš„ç”Ÿå‘½å‘¨æœŸè¯¦è§£ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å®ä¾‹åŒ– â†’ å±æ€§èµ‹å€¼ â†’ åˆå§‹åŒ–å‰å¤„ç† â†’ åˆå§‹åŒ– â†’ åˆå§‹åŒ–åå¤„ç† â†’ ä½¿ç”¨ â†’ é”€æ¯å‰å¤„ç† â†’ é”€æ¯</span><br></pre></td></tr></table></figure>

<p><strong>è¯¦ç»†ç”Ÿå‘½å‘¨æœŸæ­¥éª¤ï¼š</strong></p>
<ol>
<li>Beanå…ƒæ•°æ®è§£æï¼ˆXMLã€æ³¨è§£ã€Javaé…ç½®ï¼‰</li>
<li>è°ƒç”¨Beanæ„é€ å‡½æ•°å®ä¾‹åŒ–</li>
<li>ä¾èµ–æ³¨å…¥ï¼ˆsetteræ–¹æ³•ã€æ„é€ å‡½æ•°ã€å­—æ®µæ³¨å…¥ï¼‰</li>
<li>å¦‚æœå®ç°äº†BeanNameAwareï¼Œè°ƒç”¨setBeanName()</li>
<li>å¦‚æœå®ç°äº†BeanFactoryAwareï¼Œè°ƒç”¨setBeanFactory()</li>
<li>å¦‚æœå®ç°äº†ApplicationContextAwareï¼Œè°ƒç”¨setApplicationContext()</li>
<li>å¦‚æœæœ‰BeanPostProcessorï¼Œè°ƒç”¨postProcessBeforeInitialization()</li>
<li>å¦‚æœå®ç°äº†InitializingBeanï¼Œè°ƒç”¨afterPropertiesSet()</li>
<li>å¦‚æœé…ç½®äº†init-methodï¼Œè°ƒç”¨è‡ªå®šä¹‰åˆå§‹åŒ–æ–¹æ³•</li>
<li>å¦‚æœæœ‰BeanPostProcessorï¼Œè°ƒç”¨postProcessAfterInitialization()</li>
<li>Beanå¯ä»¥è¢«ä½¿ç”¨</li>
<li>å®¹å™¨å…³é—­æ—¶ï¼Œå¦‚æœå®ç°äº†DisposableBeanï¼Œè°ƒç”¨destroy()</li>
<li>å¦‚æœé…ç½®äº†destroy-methodï¼Œè°ƒç”¨è‡ªå®šä¹‰é”€æ¯æ–¹æ³•</li>
</ol>
<h4 id="DIçš„ä¸‰ç§æ³¨å…¥æ–¹å¼å¯¹æ¯”"><a href="#DIçš„ä¸‰ç§æ³¨å…¥æ–¹å¼å¯¹æ¯”" class="headerlink" title="DIçš„ä¸‰ç§æ³¨å…¥æ–¹å¼å¯¹æ¯”"></a>DIçš„ä¸‰ç§æ³¨å…¥æ–¹å¼å¯¹æ¯”</h4><ul>
<li><p><strong>æ„é€ å™¨æ³¨å…¥ï¼ˆConstructor Injectionï¼‰</strong></p>
<ul>
<li><strong>ä¼˜ç‚¹</strong>ï¼šå¼ºåˆ¶ä¾èµ–ã€ä¾èµ–æ¸…æ™°ã€ä¸å¯å˜æ€§</li>
<li><strong>ç¼ºç‚¹</strong>ï¼šå½“ä¾èµ–é¡¹è¿‡å¤šæ—¶æ„é€ å‡½æ•°è‡ƒè‚¿</li>
<li><strong>æœ€ä½³å®è·µ</strong>ï¼šå®˜æ–¹æ¨èï¼Œç‰¹åˆ«æ˜¯å½“ä¾èµ–æ˜¯å¿…éœ€çš„ã€ä¸å¯é€‰çš„æ—¶å€™</li>
</ul>
</li>
<li><p><strong>Setteræ³¨å…¥ï¼ˆSetter Injectionï¼‰</strong></p>
<ul>
<li><strong>ä¼˜ç‚¹</strong>ï¼šå¯é€‰ä¾èµ–ï¼Œçµæ´»æ€§é«˜</li>
<li><strong>ç¼ºç‚¹</strong>ï¼šå¯¹è±¡å¯èƒ½å¤„äºä¸å®Œæ•´çŠ¶æ€ï¼Œæ— æ³•ä½¿ç”¨finalä¿®é¥°</li>
<li><strong>æœ€ä½³å®è·µ</strong>ï¼šç”¨äºæ³¨å…¥å¯é€‰çš„ä¾èµ–é¡¹</li>
</ul>
</li>
<li><p><strong>å­—æ®µæ³¨å…¥ï¼ˆField Injectionï¼‰</strong></p>
<ul>
<li><strong>ä¼˜ç‚¹</strong>ï¼šä»£ç ç®€æ´</li>
<li><strong>ç¼ºç‚¹</strong>ï¼šä¸æ¨èä½¿ç”¨ï¼Œéšè—ä¾èµ–ã€æµ‹è¯•å›°éš¾ã€æ— æ³•ä½¿ç”¨finalä¿®é¥°</li>
</ul>
</li>
</ul>
<h4 id="AOPåŸç†æ·±å…¥åˆ†æ"><a href="#AOPåŸç†æ·±å…¥åˆ†æ" class="headerlink" title="AOPåŸç†æ·±å…¥åˆ†æ"></a>AOPåŸç†æ·±å…¥åˆ†æ</h4><p><strong>AOPå®ç°æœºåˆ¶ï¼š</strong> Spring AOPåŸºäºä»£ç†æ¨¡å¼å®ç°ï¼Œæ”¯æŒä¸¤ç§ä»£ç†æ–¹å¼ï¼š</p>
<ol>
<li><strong>JDKåŠ¨æ€ä»£ç†</strong>: é’ˆå¯¹å®ç°äº†æ¥å£çš„ç±»</li>
<li><strong>CGLIBä»£ç†</strong>: é’ˆå¯¹æ²¡æœ‰å®ç°æ¥å£çš„ç±»</li>
</ol>
<p>æˆ‘ä»¬æ¥ç³»ç»Ÿæ€§åœ°è®²è§£ä¸€ä¸‹ <strong>Spring AOP çš„å®ç°æœºåˆ¶</strong>ï¼ŒåŒ…æ‹¬ï¼š</p>
<ol>
<li>JDK åŠ¨æ€ä»£ç†</li>
<li>CGLIB åŠ¨æ€ä»£ç†</li>
<li>é™æ€ä»£ç†ï¼ˆå¯¹æ¯”è¯´æ˜ï¼‰</li>
</ol>
<hr>
<h2 id="ğŸŒŸ-ä¸€ã€Spring-AOP-å®ç°æœºåˆ¶æ¦‚è¿°"><a href="#ğŸŒŸ-ä¸€ã€Spring-AOP-å®ç°æœºåˆ¶æ¦‚è¿°" class="headerlink" title="ğŸŒŸ ä¸€ã€Spring AOP å®ç°æœºåˆ¶æ¦‚è¿°"></a>ğŸŒŸ ä¸€ã€Spring AOP å®ç°æœºåˆ¶æ¦‚è¿°</h2><p>Spring AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰æ˜¯åŸºäº <strong>ä»£ç†æ¨¡å¼</strong> å®ç°çš„ï¼Œå®ƒé€šè¿‡åœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œå‰åç»‡å…¥é€»è¾‘ï¼ˆå¢å¼ºï¼‰ï¼Œå®ç°æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼ˆå¦‚æ—¥å¿—ã€å®‰å…¨ã€äº‹åŠ¡ç­‰ï¼‰çš„åˆ†ç¦»ã€‚</p>
<blockquote>
<p>Spring AOP ä»…æ”¯æŒæ–¹æ³•çº§åˆ«çš„ä»£ç†ï¼ˆå³å¯¹æ–¹æ³•è¿›è¡Œå¢å¼ºï¼‰ï¼Œä¸æ”¯æŒå­—æ®µã€æ„é€ å™¨ç­‰åº•å±‚å­—èŠ‚ç å¢å¼ºï¼ˆè¿™è¦ç”¨ AspectJï¼‰ã€‚</p>
</blockquote>
<hr>
<h2 id="ğŸ§©-äºŒã€Spring-AOP-çš„ä¸¤ç§åŠ¨æ€ä»£ç†æ–¹å¼"><a href="#ğŸ§©-äºŒã€Spring-AOP-çš„ä¸¤ç§åŠ¨æ€ä»£ç†æ–¹å¼" class="headerlink" title="ğŸ§© äºŒã€Spring AOP çš„ä¸¤ç§åŠ¨æ€ä»£ç†æ–¹å¼"></a>ğŸ§© äºŒã€Spring AOP çš„ä¸¤ç§åŠ¨æ€ä»£ç†æ–¹å¼</h2><h3 id="1ï¸âƒ£-JDK-åŠ¨æ€ä»£ç†ï¼ˆåŸºäºæ¥å£ï¼‰"><a href="#1ï¸âƒ£-JDK-åŠ¨æ€ä»£ç†ï¼ˆåŸºäºæ¥å£ï¼‰" class="headerlink" title="1ï¸âƒ£ JDK åŠ¨æ€ä»£ç†ï¼ˆåŸºäºæ¥å£ï¼‰"></a>1ï¸âƒ£ JDK åŠ¨æ€ä»£ç†ï¼ˆåŸºäºæ¥å£ï¼‰</h3><h4 id="âœ…-åŸç†ï¼š"><a href="#âœ…-åŸç†ï¼š" class="headerlink" title="âœ… åŸç†ï¼š"></a>âœ… åŸç†ï¼š</h4><ul>
<li>åŸºäº Java çš„ <code>java.lang.reflect.Proxy</code> ç±»å®ç°ã€‚</li>
<li>å¿…é¡»è¦æœ‰æ¥å£ï¼ŒSpring ä¼šä¸ºæ¥å£ç”Ÿæˆä»£ç†ç±»ã€‚</li>
<li>ä»£ç†ç±»åœ¨è¿è¡Œæ—¶å®ç°æ¥å£ï¼Œå¹¶å°†è°ƒç”¨å§”æ‰˜ç»™ InvocationHandlerã€‚</li>
</ul>
<h4 id="ğŸ“¦-ç¤ºä¾‹ï¼š"><a href="#ğŸ“¦-ç¤ºä¾‹ï¼š" class="headerlink" title="ğŸ“¦ ç¤ºä¾‹ï¼š"></a>ğŸ“¦ ç¤ºä¾‹ï¼š</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">addUser</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addUser</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ·»åŠ ç”¨æˆ·&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Spring AOP ä¸º <code>UserService</code> åˆ›å»ºä»£ç†ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">UserService</span> <span class="variable">proxy</span> <span class="operator">=</span> (UserService) Proxy.newProxyInstance(</span><br><span class="line">    userService.getClass().getClassLoader(),</span><br><span class="line">    userService.getClass().getInterfaces(),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">InvocationHandler</span>() &#123;</span><br><span class="line">        <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;å‰ç½®å¢å¼º&quot;</span>);</span><br><span class="line">            <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> method.invoke(userService, args);</span><br><span class="line">            System.out.println(<span class="string">&quot;åç½®å¢å¼º&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<h4 id="ğŸ¯-ç‰¹ç‚¹ï¼š"><a href="#ğŸ¯-ç‰¹ç‚¹ï¼š" class="headerlink" title="ğŸ¯ ç‰¹ç‚¹ï¼š"></a>ğŸ¯ ç‰¹ç‚¹ï¼š</h4><table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>æ˜¯å¦ä¾èµ–æ¥å£</td>
<td>âœ… æ˜¯</td>
</tr>
<tr>
<td>æ€§èƒ½</td>
<td>è¾ƒé«˜ï¼ˆæ¯” CGLIB ç•¥å¿«ï¼‰</td>
</tr>
<tr>
<td>ç”Ÿæˆçš„ä»£ç†ç±»</td>
<td>å®ç°æ¥å£</td>
</tr>
</tbody></table>
<hr>
<h3 id="2ï¸âƒ£-CGLIB-åŠ¨æ€ä»£ç†ï¼ˆåŸºäºå­ç±»ï¼‰"><a href="#2ï¸âƒ£-CGLIB-åŠ¨æ€ä»£ç†ï¼ˆåŸºäºå­ç±»ï¼‰" class="headerlink" title="2ï¸âƒ£ CGLIB åŠ¨æ€ä»£ç†ï¼ˆåŸºäºå­ç±»ï¼‰"></a>2ï¸âƒ£ CGLIB åŠ¨æ€ä»£ç†ï¼ˆåŸºäºå­ç±»ï¼‰</h3><h4 id="âœ…-åŸç†ï¼š-1"><a href="#âœ…-åŸç†ï¼š-1" class="headerlink" title="âœ… åŸç†ï¼š"></a>âœ… åŸç†ï¼š</h4><ul>
<li>ä½¿ç”¨ CGLIB åº“åœ¨è¿è¡Œæ—¶ <strong>ç”Ÿæˆç›®æ ‡ç±»çš„å­ç±»</strong>ï¼Œå¹¶é‡å†™å…¶æ–¹æ³•æ¥å®ç°å¢å¼ºã€‚</li>
<li>é€‚ç”¨äº <strong>æ²¡æœ‰æ¥å£</strong> çš„ç±»ï¼Œæˆ–è€…æƒ³å¯¹ç±»æœ¬èº«å¢å¼ºè€Œéæ¥å£ã€‚</li>
</ul>
<h4 id="ğŸ§ª-ç¤ºä¾‹ï¼š"><a href="#ğŸ§ª-ç¤ºä¾‹ï¼š" class="headerlink" title="ğŸ§ª ç¤ºä¾‹ï¼š"></a>ğŸ§ª ç¤ºä¾‹ï¼š</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addUser</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ·»åŠ ç”¨æˆ·&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Spring é€šè¿‡ CGLIB ç”Ÿæˆå­ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Enhancer</span> <span class="variable">enhancer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Enhancer</span>();</span><br><span class="line">enhancer.setSuperclass(UserService.class);</span><br><span class="line">enhancer.setCallback(<span class="keyword">new</span> <span class="title class_">MethodInterceptor</span>() &#123;</span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">intercept</span><span class="params">(Object obj, Method method, Object[] args, MethodProxy proxy)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å‰ç½®å¢å¼º&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> proxy.invokeSuper(obj, args);</span><br><span class="line">        System.out.println(<span class="string">&quot;åç½®å¢å¼º&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="type">UserService</span> <span class="variable">proxy</span> <span class="operator">=</span> (UserService) enhancer.create();</span><br></pre></td></tr></table></figure>

<h4 id="ğŸ¯-ç‰¹ç‚¹ï¼š-1"><a href="#ğŸ¯-ç‰¹ç‚¹ï¼š-1" class="headerlink" title="ğŸ¯ ç‰¹ç‚¹ï¼š"></a>ğŸ¯ ç‰¹ç‚¹ï¼š</h4><table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>æ˜¯å¦ä¾èµ–æ¥å£</td>
<td>âŒ å¦</td>
</tr>
<tr>
<td>æ˜¯å¦å¯ä»£ç† final ç±»&#x2F;æ–¹æ³•</td>
<td>âŒ å¦ï¼ˆfinal æ— æ³•è¢«ç»§æ‰¿&#x2F;é‡å†™ï¼‰</td>
</tr>
<tr>
<td>ç”Ÿæˆçš„ä»£ç†ç±»</td>
<td>å­ç±»</td>
</tr>
</tbody></table>
<hr>
<h2 id="ğŸ—-ä¸‰ã€é™æ€ä»£ç†ï¼ˆå¯¹æ¯”åŠ¨æ€ä»£ç†ï¼‰"><a href="#ğŸ—-ä¸‰ã€é™æ€ä»£ç†ï¼ˆå¯¹æ¯”åŠ¨æ€ä»£ç†ï¼‰" class="headerlink" title="ğŸ— ä¸‰ã€é™æ€ä»£ç†ï¼ˆå¯¹æ¯”åŠ¨æ€ä»£ç†ï¼‰"></a>ğŸ— ä¸‰ã€é™æ€ä»£ç†ï¼ˆå¯¹æ¯”åŠ¨æ€ä»£ç†ï¼‰</h2><h3 id="âœ…-åŸç†ï¼š-2"><a href="#âœ…-åŸç†ï¼š-2" class="headerlink" title="âœ… åŸç†ï¼š"></a>âœ… åŸç†ï¼š</h3><ul>
<li>è‡ªå·±å†™ä¸€ä¸ªä»£ç†ç±»ï¼Œ<strong>å®ç°ç›¸åŒæ¥å£</strong>ï¼Œå°†æ–¹æ³•è°ƒç”¨å§”æ‰˜ç»™ç›®æ ‡å¯¹è±¡ï¼Œå¹¶åœ¨è°ƒç”¨å‰åæ‰‹åŠ¨æ·»åŠ å¢å¼ºé€»è¾‘ã€‚</li>
</ul>
<h4 id="ğŸ§ª-ç¤ºä¾‹ï¼š-1"><a href="#ğŸ§ª-ç¤ºä¾‹ï¼š-1" class="headerlink" title="ğŸ§ª ç¤ºä¾‹ï¼š"></a>ğŸ§ª ç¤ºä¾‹ï¼š</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">addUser</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addUser</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ·»åŠ ç”¨æˆ·&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é™æ€ä»£ç†ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceProxy</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> UserService target;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserServiceProxy</span><span class="params">(UserService target)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.target = target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addUser</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å‰ç½®å¢å¼º&quot;</span>);</span><br><span class="line">        target.addUser();</span><br><span class="line">        System.out.println(<span class="string">&quot;åç½®å¢å¼º&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ğŸ¯-ç‰¹ç‚¹ï¼š-2"><a href="#ğŸ¯-ç‰¹ç‚¹ï¼š-2" class="headerlink" title="ğŸ¯ ç‰¹ç‚¹ï¼š"></a>ğŸ¯ ç‰¹ç‚¹ï¼š</h4><table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>æ˜¯å¦è‡ªåŠ¨ç”Ÿæˆ</td>
<td>âŒ éœ€æ‰‹åŠ¨ç¼–ç </td>
</tr>
<tr>
<td>çµæ´»æ€§</td>
<td>å·®ï¼ˆæ¯ä¸ªç±»éƒ½è¦å†™ä¸€ä¸ªä»£ç†ç±»ï¼‰</td>
</tr>
<tr>
<td>æ˜¯å¦æ”¯æŒ AOP</td>
<td>âŒ æ— æ³•åŠ¨æ€ç»‡å…¥å¤šä¸ªåˆ‡é¢</td>
</tr>
</tbody></table>
<hr>
<h2 id="ğŸ”š-å››ã€ä¸‰è€…å¯¹æ¯”æ€»ç»“"><a href="#ğŸ”š-å››ã€ä¸‰è€…å¯¹æ¯”æ€»ç»“" class="headerlink" title="ğŸ”š å››ã€ä¸‰è€…å¯¹æ¯”æ€»ç»“"></a>ğŸ”š å››ã€ä¸‰è€…å¯¹æ¯”æ€»ç»“</h2><table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>é™æ€ä»£ç†</th>
<th>JDK åŠ¨æ€ä»£ç†</th>
<th>CGLIB åŠ¨æ€ä»£ç†</th>
</tr>
</thead>
<tbody><tr>
<td>æ˜¯å¦ä¾èµ–æ¥å£</td>
<td>âœ… æ˜¯</td>
<td>âœ… æ˜¯</td>
<td>âŒ å¦</td>
</tr>
<tr>
<td>æ˜¯å¦è‡ªåŠ¨ç”Ÿæˆä»£ç†ç±»</td>
<td>âŒ æ‰‹åŠ¨ç¼–å†™</td>
<td>âœ… è¿è¡Œæ—¶ç”Ÿæˆ</td>
<td>âœ… è¿è¡Œæ—¶ç”Ÿæˆ</td>
</tr>
<tr>
<td>æ˜¯å¦å¯ä»£ç†ç±»</td>
<td>âŒ å¦ï¼ˆæ¥å£ä¸ºä¸»ï¼‰</td>
<td>âŒ å¦ï¼ˆæ¥å£ä¸ºä¸»ï¼‰</td>
<td>âœ… æ˜¯ï¼ˆç±»çš„å­ç±»ï¼‰</td>
</tr>
<tr>
<td>æ€§èƒ½</td>
<td>ä¸€èˆ¬</td>
<td>è¾ƒé«˜</td>
<td>ç•¥æ…¢ï¼ˆä½†å¯æ¥å—ï¼‰</td>
</tr>
<tr>
<td>æ˜¯å¦æ”¯æŒ final æ–¹æ³•</td>
<td>âœ…</td>
<td>âœ…</td>
<td>âŒ å¦</td>
</tr>
</tbody></table>
<hr>
<h2 id="âœ…-Spring-å¦‚ä½•é€‰æ‹©ä»£ç†æ–¹å¼ï¼Ÿ"><a href="#âœ…-Spring-å¦‚ä½•é€‰æ‹©ä»£ç†æ–¹å¼ï¼Ÿ" class="headerlink" title="âœ… Spring å¦‚ä½•é€‰æ‹©ä»£ç†æ–¹å¼ï¼Ÿ"></a>âœ… Spring å¦‚ä½•é€‰æ‹©ä»£ç†æ–¹å¼ï¼Ÿ</h2><ul>
<li>é»˜è®¤ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†ï¼ˆå¦‚æœç›®æ ‡ç±»å®ç°äº†æ¥å£ï¼‰ã€‚</li>
<li>å¦‚æœç›®æ ‡ç±»æ²¡æœ‰æ¥å£ï¼ŒSpring è‡ªåŠ¨åˆ‡æ¢ä¸º CGLIBã€‚</li>
<li>å¯ä»¥å¼ºåˆ¶ä½¿ç”¨ CGLIBï¼š</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableAspectJAutoProxy(proxyTargetClass = true)</span></span><br></pre></td></tr></table></figure>

<p><strong>AOPæ ¸å¿ƒæ¦‚å¿µï¼š</strong></p>
<ul>
<li><strong>åˆ‡é¢ï¼ˆAspectï¼‰</strong>: æ¨ªåˆ‡å…³æ³¨ç‚¹çš„æ¨¡å—åŒ–</li>
<li><strong>è¿æ¥ç‚¹ï¼ˆJoinpointï¼‰</strong>: ç¨‹åºæ‰§è¡Œä¸­çš„ç‰¹å®šç‚¹</li>
<li><strong>åˆ‡ç‚¹ï¼ˆPointcutï¼‰</strong>: è¿æ¥ç‚¹çš„é›†åˆ</li>
<li><strong>é€šçŸ¥ï¼ˆAdviceï¼‰</strong>: åˆ‡é¢åœ¨ç‰¹å®šè¿æ¥ç‚¹æ‰§è¡Œçš„ä»£ç </li>
<li><strong>ç›®æ ‡å¯¹è±¡ï¼ˆTargetï¼‰</strong>: è¢«ä»£ç†çš„å¯¹è±¡</li>
<li><strong>ä»£ç†å¯¹è±¡ï¼ˆProxyï¼‰</strong>: AOPæ¡†æ¶åˆ›å»ºçš„å¯¹è±¡</li>
</ul>
<p><strong>JDKåŠ¨æ€ä»£ç† vs. CGLIBåŠ¨æ€ä»£ç†</strong></p>
<ul>
<li><p><strong>JDKåŠ¨æ€ä»£ç†</strong>ï¼š</p>
<ul>
<li>åŸºäºæ¥å£å®ç°</li>
<li>ä½¿ç”¨Proxy.newProxyInstance()åˆ›å»ºä»£ç†</li>
<li>åªèƒ½ä»£ç†å®ç°äº†æ¥å£çš„ç±»</li>
</ul>
</li>
<li><p><strong>CGLIBåŠ¨æ€ä»£ç†</strong>ï¼š</p>
<ul>
<li>åŸºäºç»§æ‰¿å®ç°</li>
<li>ä½¿ç”¨Enhancerç±»åˆ›å»ºä»£ç†</li>
<li>å¯ä»¥ä»£ç†æ™®é€šç±»</li>
<li>ä¸èƒ½ä»£ç†finalç±»å’Œæ–¹æ³•</li>
</ul>
</li>
</ul>
<h3 id="1-2-Springæ ¸å¿ƒæ³¨è§£è¯¦è§£"><a href="#1-2-Springæ ¸å¿ƒæ³¨è§£è¯¦è§£" class="headerlink" title="1.2 Springæ ¸å¿ƒæ³¨è§£è¯¦è§£"></a>1.2 Springæ ¸å¿ƒæ³¨è§£è¯¦è§£</h3><h4 id="åŸºç¡€é…ç½®æ³¨è§£"><a href="#åŸºç¡€é…ç½®æ³¨è§£" class="headerlink" title="åŸºç¡€é…ç½®æ³¨è§£"></a>åŸºç¡€é…ç½®æ³¨è§£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>  <span class="comment">// è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªé…ç½®ç±»</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &quot;com.example&quot;)</span>  <span class="comment">// ç»„ä»¶æ‰«æ</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span>  <span class="comment">// å¯ç”¨è‡ªåŠ¨é…ç½®</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span>  <span class="comment">// SpringBootä¸»ç±»æ³¨è§£ï¼ŒåŒ…å«ä¸Šè¿°ä¸‰ä¸ª</span></span><br><span class="line"><span class="meta">@Import(OtherConfig.class)</span>  <span class="comment">// å¯¼å…¥å…¶ä»–é…ç½®ç±»</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;classpath:application.properties&quot;)</span>  <span class="comment">// åŠ è½½å±æ€§æ–‡ä»¶</span></span><br></pre></td></tr></table></figure>

<h4 id="Beanå®šä¹‰æ³¨è§£"><a href="#Beanå®šä¹‰æ³¨è§£" class="headerlink" title="Beanå®šä¹‰æ³¨è§£"></a>Beanå®šä¹‰æ³¨è§£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>  <span class="comment">// é€šç”¨ç»„ä»¶</span></span><br><span class="line"><span class="meta">@Service</span>    <span class="comment">// ä¸šåŠ¡å±‚ç»„ä»¶</span></span><br><span class="line"><span class="meta">@Repository</span> <span class="comment">// æ•°æ®è®¿é—®å±‚ç»„ä»¶</span></span><br><span class="line"><span class="meta">@Controller</span> <span class="comment">// æ§åˆ¶å±‚ç»„ä»¶</span></span><br><span class="line"><span class="meta">@RestController</span> <span class="comment">// RESTfulæ§åˆ¶å™¨ï¼Œç›¸å½“äº@Controller + @ResponseBody</span></span><br><span class="line"><span class="meta">@Bean</span>       <span class="comment">// æ–¹æ³•çº§åˆ«ï¼Œå®šä¹‰Bean</span></span><br><span class="line"><span class="meta">@Scope(&quot;singleton/prototype/request/session&quot;)</span>  <span class="comment">// Beanä½œç”¨åŸŸ</span></span><br><span class="line"><span class="meta">@Lazy</span>       <span class="comment">// å»¶è¿Ÿåˆå§‹åŒ–</span></span><br><span class="line"><span class="meta">@Primary</span>    <span class="comment">// ä¼˜å…ˆæ³¨å…¥</span></span><br><span class="line"><span class="meta">@Qualifier(&quot;beanName&quot;)</span>  <span class="comment">// æŒ‡å®šæ³¨å…¥çš„Beanåç§°</span></span><br></pre></td></tr></table></figure>

<h4 id="ä¾èµ–æ³¨å…¥æ³¨è§£"><a href="#ä¾èµ–æ³¨å…¥æ³¨è§£" class="headerlink" title="ä¾èµ–æ³¨å…¥æ³¨è§£"></a>ä¾èµ–æ³¨å…¥æ³¨è§£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span>  <span class="comment">// è‡ªåŠ¨è£…é…ï¼Œå¯ç”¨äºæ„é€ å‡½æ•°ã€æ–¹æ³•ã€å­—æ®µ</span></span><br><span class="line"><span class="meta">@Resource</span>   <span class="comment">// JSR-250æ ‡å‡†ï¼ŒæŒ‰åç§°æ³¨å…¥</span></span><br><span class="line"><span class="meta">@Inject</span>     <span class="comment">// JSR-330æ ‡å‡†</span></span><br><span class="line"><span class="meta">@Value(&quot;$&#123;property.name&#125;&quot;)</span>  <span class="comment">// æ³¨å…¥é…ç½®å€¼</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;app&quot;)</span>  <span class="comment">// ç»‘å®šé…ç½®å±æ€§</span></span><br></pre></td></tr></table></figure>

<h4 id="ç”Ÿå‘½å‘¨æœŸæ³¨è§£"><a href="#ç”Ÿå‘½å‘¨æœŸæ³¨è§£" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸæ³¨è§£"></a>ç”Ÿå‘½å‘¨æœŸæ³¨è§£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostConstruct</span>  <span class="comment">// åˆå§‹åŒ–æ–¹æ³•</span></span><br><span class="line"><span class="meta">@PreDestroy</span>     <span class="comment">// é”€æ¯æ–¹æ³•</span></span><br></pre></td></tr></table></figure>

<h4 id="AOPç›¸å…³æ³¨è§£"><a href="#AOPç›¸å…³æ³¨è§£" class="headerlink" title="AOPç›¸å…³æ³¨è§£"></a>AOPç›¸å…³æ³¨è§£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span>         <span class="comment">// å£°æ˜åˆ‡é¢</span></span><br><span class="line"><span class="meta">@Pointcut</span>       <span class="comment">// å®šä¹‰åˆ‡ç‚¹</span></span><br><span class="line"><span class="meta">@Before</span>         <span class="comment">// å‰ç½®é€šçŸ¥</span></span><br><span class="line"><span class="meta">@After</span>          <span class="comment">// åç½®é€šçŸ¥</span></span><br><span class="line"><span class="meta">@AfterReturning</span> <span class="comment">// è¿”å›åé€šçŸ¥</span></span><br><span class="line"><span class="meta">@AfterThrowing</span>  <span class="comment">// å¼‚å¸¸é€šçŸ¥</span></span><br><span class="line"><span class="meta">@Around</span>         <span class="comment">// ç¯ç»•é€šçŸ¥</span></span><br></pre></td></tr></table></figure>

<h3 id="1-3-Springå¸¸è§ä½¿ç”¨åœºæ™¯"><a href="#1-3-Springå¸¸è§ä½¿ç”¨åœºæ™¯" class="headerlink" title="1.3 Springå¸¸è§ä½¿ç”¨åœºæ™¯"></a>1.3 Springå¸¸è§ä½¿ç”¨åœºæ™¯</h3><h4 id="åœºæ™¯1ï¼šæœåŠ¡å±‚äº‹åŠ¡ç®¡ç†"><a href="#åœºæ™¯1ï¼šæœåŠ¡å±‚äº‹åŠ¡ç®¡ç†" class="headerlink" title="åœºæ™¯1ï¼šæœåŠ¡å±‚äº‹åŠ¡ç®¡ç†"></a>åœºæ™¯1ï¼šæœåŠ¡å±‚äº‹åŠ¡ç®¡ç†</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserRepository userRepository;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Transactional(propagation = Propagation.REQUIRED, rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">createUser</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="comment">// ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">        <span class="keyword">return</span> userRepository.save(user);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Transactional(readOnly = true)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">findById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userRepository.findById(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="åœºæ™¯2ï¼šç¼“å­˜ç®¡ç†"><a href="#åœºæ™¯2ï¼šç¼“å­˜ç®¡ç†" class="headerlink" title="åœºæ™¯2ï¼šç¼“å­˜ç®¡ç†"></a>åœºæ™¯2ï¼šç¼“å­˜ç®¡ç†</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Cacheable(value = &quot;products&quot;, key = &quot;#id&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Product <span class="title function_">getProduct</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> productRepository.findById(id);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@CacheEvict(value = &quot;products&quot;, key = &quot;#product.id&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Product <span class="title function_">updateProduct</span><span class="params">(Product product)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> productRepository.save(product);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-4-Springå¸¸è§é¢è¯•é—®é¢˜"><a href="#1-4-Springå¸¸è§é¢è¯•é—®é¢˜" class="headerlink" title="1.4 Springå¸¸è§é¢è¯•é—®é¢˜"></a>1.4 Springå¸¸è§é¢è¯•é—®é¢˜</h3><p><strong>Q1: Spring IoCå®¹å™¨çš„åˆå§‹åŒ–è¿‡ç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ</strong></p>
<p>A: Spring IoCå®¹å™¨åˆå§‹åŒ–åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š</p>
<ol>
<li><strong>Resourceå®šä½</strong>: å®šä½é…ç½®æ–‡ä»¶</li>
<li><strong>BeanDefinitionè½½å…¥</strong>: å°†é…ç½®ä¿¡æ¯è½¬æ¢ä¸ºSpringå†…éƒ¨æ•°æ®ç»“æ„</li>
<li><strong>BeanDefinitionæ³¨å†Œ</strong>: å°†BeanDefinitionæ³¨å†Œåˆ°IoCå®¹å™¨çš„HashMapä¸­</li>
</ol>
<p>å…·ä½“æµç¨‹ï¼š</p>
<ul>
<li>åˆ›å»ºApplicationContext</li>
<li>åŠ è½½é…ç½®å…ƒæ•°æ®ï¼ˆXMLã€æ³¨è§£ã€Javaé…ç½®ï¼‰</li>
<li>è§£æé…ç½®ï¼Œåˆ›å»ºBeanDefinition</li>
<li>æ³¨å†ŒBeanDefinitionåˆ°BeanDefinitionRegistry</li>
<li>å®ä¾‹åŒ–éæ‡’åŠ è½½çš„å•ä¾‹Bean</li>
</ul>
<p><strong>Q2: Springä¸­çš„å¾ªç¯ä¾èµ–æ˜¯å¦‚ä½•è§£å†³çš„ï¼Ÿ</strong></p>
<p>A: Springé€šè¿‡ä¸‰çº§ç¼“å­˜è§£å†³å¾ªç¯ä¾èµ–ï¼š</p>
<ol>
<li><strong>singletonObjects</strong>: ä¸€çº§ç¼“å­˜ï¼Œå­˜æ”¾å®Œæ•´çš„Beanå®ä¾‹</li>
<li><strong>earlySingletonObjects</strong>: äºŒçº§ç¼“å­˜ï¼Œå­˜æ”¾æ—©æœŸçš„Beanå®ä¾‹</li>
<li><strong>singletonFactories</strong>: ä¸‰çº§ç¼“å­˜ï¼Œå­˜æ”¾Beanå·¥å‚</li>
</ol>
<p>è§£å†³è¿‡ç¨‹ï¼š</p>
<ul>
<li>Aä¾èµ–Bï¼ŒBä¾èµ–A</li>
<li>åˆ›å»ºAæ—¶ï¼Œå°†Açš„å·¥å‚æ”¾å…¥ä¸‰çº§ç¼“å­˜</li>
<li>Aéœ€è¦æ³¨å…¥Bï¼Œå¼€å§‹åˆ›å»ºB</li>
<li>Béœ€è¦æ³¨å…¥Aï¼Œä»ç¼“å­˜ä¸­è·å–Açš„æ—©æœŸå®ä¾‹</li>
<li>Båˆ›å»ºå®Œæˆï¼ŒAç»§ç»­åˆ›å»ºå®Œæˆ</li>
</ul>
<p><strong>Q3: Spring AOPçš„å®ç°åŸç†ï¼Ÿ</strong></p>
<p>A: Spring AOPåŸºäºä»£ç†æ¨¡å¼å®ç°ï¼š</p>
<ol>
<li><strong>JDKåŠ¨æ€ä»£ç†</strong>: ç›®æ ‡ç±»å®ç°æ¥å£æ—¶ä½¿ç”¨ï¼ŒåŸºäºåå°„æœºåˆ¶</li>
<li><strong>CGLIBä»£ç†</strong>: ç›®æ ‡ç±»æ²¡æœ‰æ¥å£æ—¶ä½¿ç”¨ï¼ŒåŸºäºå­—èŠ‚ç æŠ€æœ¯</li>
</ol>
<p>ä»£ç†åˆ›å»ºè¿‡ç¨‹ï¼š</p>
<ul>
<li>Springåœ¨Beanåˆå§‹åŒ–åï¼Œæ£€æŸ¥æ˜¯å¦éœ€è¦AOP</li>
<li>å¦‚æœéœ€è¦ï¼Œåˆ›å»ºä»£ç†å¯¹è±¡æ›¿æ¢åŸå§‹Bean</li>
<li>ä»£ç†å¯¹è±¡æ‹¦æˆªæ–¹æ³•è°ƒç”¨ï¼Œæ‰§è¡Œåˆ‡é¢é€»è¾‘</li>
</ul>
<h2 id="äºŒã€Spring-Bootæ·±å…¥è§£æ"><a href="#äºŒã€Spring-Bootæ·±å…¥è§£æ" class="headerlink" title="äºŒã€Spring Bootæ·±å…¥è§£æ"></a>äºŒã€Spring Bootæ·±å…¥è§£æ</h2><h3 id="2-1-Spring-Bootæ ¸å¿ƒåŸç†"><a href="#2-1-Spring-Bootæ ¸å¿ƒåŸç†" class="headerlink" title="2.1 Spring Bootæ ¸å¿ƒåŸç†"></a>2.1 Spring Bootæ ¸å¿ƒåŸç†</h3><p><strong>è‡ªåŠ¨é…ç½®åŸç†ï¼š</strong> Spring Booté€šè¿‡@EnableAutoConfigurationæ³¨è§£å¯ç”¨è‡ªåŠ¨é…ç½®æœºåˆ¶ã€‚</p>
<p>æ ¸å¿ƒç±»åˆ†æï¼š</p>
<ol>
<li><strong>SpringBootApplication</strong>: ç»„åˆæ³¨è§£ï¼ŒåŒ…å«@Configurationã€@EnableAutoConfigurationã€@ComponentScan</li>
<li><strong>AutoConfigurationImportSelector</strong>: è´Ÿè´£å¯¼å…¥è‡ªåŠ¨é…ç½®ç±»</li>
<li><strong>spring.factories</strong>: META-INF&#x2F;spring.factoriesæ–‡ä»¶å®šä¹‰è‡ªåŠ¨é…ç½®ç±»</li>
</ol>
<p><strong>è‡ªåŠ¨é…ç½®æµç¨‹ï¼š</strong></p>
<ol>
<li>SpringBootå¯åŠ¨æ—¶æ‰«ææ‰€æœ‰jaråŒ…ä¸‹çš„META-INF&#x2F;spring.factoriesæ–‡ä»¶</li>
<li>åŠ è½½æ–‡ä»¶ä¸­å®šä¹‰çš„è‡ªåŠ¨é…ç½®ç±»</li>
<li>æ ¹æ®æ¡ä»¶æ³¨è§£(@ConditionalOnClassç­‰)åˆ¤æ–­æ˜¯å¦ç”Ÿæ•ˆ</li>
<li>ç”Ÿæ•ˆçš„é…ç½®ç±»ä¼šåˆ›å»ºç›¸åº”çš„Bean</li>
</ol>
<h3 id="2-2-Spring-Bootå¯åŠ¨æµç¨‹è¯¦è§£"><a href="#2-2-Spring-Bootå¯åŠ¨æµç¨‹è¯¦è§£" class="headerlink" title="2.2 Spring Bootå¯åŠ¨æµç¨‹è¯¦è§£"></a>2.2 Spring Bootå¯åŠ¨æµç¨‹è¯¦è§£</h3><p><strong>SpringApplication.run()æ–¹æ³•æ‰§è¡Œæµç¨‹ï¼š</strong></p>
<ol>
<li><strong>å‡†å¤‡é˜¶æ®µ</strong>ï¼š<ul>
<li>åˆ›å»ºSpringApplicationå®ä¾‹</li>
<li>ç¡®å®šåº”ç”¨ç±»å‹ï¼ˆSERVLETã€REACTIVEã€NONEï¼‰</li>
<li>åŠ è½½ApplicationContextInitializer</li>
<li>åŠ è½½ApplicationListener</li>
</ul>
</li>
<li><strong>å¯åŠ¨é˜¶æ®µ</strong>ï¼š<ul>
<li>å¯åŠ¨è®¡æ—¶å™¨</li>
<li>é…ç½®Headlessæ¨¡å¼</li>
<li>è·å–å¹¶å¯åŠ¨ç›‘å¬å™¨</li>
<li>å‡†å¤‡ç¯å¢ƒï¼ˆEnvironmentï¼‰</li>
<li>æ‰“å°Banner</li>
</ul>
</li>
<li><strong>å®¹å™¨åˆ›å»ºé˜¶æ®µ</strong>ï¼š<ul>
<li>åˆ›å»ºApplicationContext</li>
<li>å‡†å¤‡ApplicationContext</li>
<li>åˆ·æ–°ApplicationContext</li>
<li>åˆ·æ–°åå¤„ç†</li>
</ul>
</li>
<li><strong>å®Œæˆé˜¶æ®µ</strong>ï¼š<ul>
<li>åœæ­¢è®¡æ—¶å™¨</li>
<li>å‘å¸ƒå¯åŠ¨å®Œæˆäº‹ä»¶</li>
<li>è°ƒç”¨Runners</li>
</ul>
</li>
</ol>
<h3 id="2-3-Spring-Bootæ ¸å¿ƒæ³¨è§£"><a href="#2-3-Spring-Bootæ ¸å¿ƒæ³¨è§£" class="headerlink" title="2.3 Spring Bootæ ¸å¿ƒæ³¨è§£"></a>2.3 Spring Bootæ ¸å¿ƒæ³¨è§£</h3><h4 id="å¯åŠ¨ç±»æ³¨è§£"><a href="#å¯åŠ¨ç±»æ³¨è§£" class="headerlink" title="å¯åŠ¨ç±»æ³¨è§£"></a>å¯åŠ¨ç±»æ³¨è§£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="comment">// ç­‰ä»·äºä»¥ä¸‹ä¸‰ä¸ªæ³¨è§£çš„ç»„åˆ</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootConfiguration</span>  <span class="comment">// Spring Booté…ç½®ç±»</span></span><br><span class="line"><span class="meta">@EnableScheduling</span>        <span class="comment">// å¯ç”¨å®šæ—¶ä»»åŠ¡</span></span><br><span class="line"><span class="meta">@EnableAsync</span>            <span class="comment">// å¯ç”¨å¼‚æ­¥å¤„ç†</span></span><br><span class="line"><span class="meta">@EnableCaching</span>          <span class="comment">// å¯ç”¨ç¼“å­˜</span></span><br></pre></td></tr></table></figure>

<h4 id="æ¡ä»¶æ³¨è§£"><a href="#æ¡ä»¶æ³¨è§£" class="headerlink" title="æ¡ä»¶æ³¨è§£"></a>æ¡ä»¶æ³¨è§£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConditionalOnClass(DataSource.class)</span>      <span class="comment">// ç±»è·¯å¾„ä¸‹å­˜åœ¨æŒ‡å®šç±»</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(DataSource.class)</span> <span class="comment">// å®¹å™¨ä¸­ä¸å­˜åœ¨æŒ‡å®šBean</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(name = &quot;app.enabled&quot;, havingValue = &quot;true&quot;)</span> <span class="comment">// å±æ€§åŒ¹é…</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication</span>               <span class="comment">// Webåº”ç”¨ç¯å¢ƒ</span></span><br><span class="line"><span class="meta">@ConditionalOnNotWebApplication</span>            <span class="comment">// éWebåº”ç”¨ç¯å¢ƒ</span></span><br><span class="line"><span class="meta">@Profile(&quot;dev&quot;)</span>                           <span class="comment">// æ¿€æ´»çš„profile</span></span><br></pre></td></tr></table></figure>

<h4 id="é…ç½®å±æ€§æ³¨è§£"><a href="#é…ç½®å±æ€§æ³¨è§£" class="headerlink" title="é…ç½®å±æ€§æ³¨è§£"></a>é…ç½®å±æ€§æ³¨è§£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;app.datasource&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceProperties</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="comment">// getters and setters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-4-Spring-Bootå®é™…åº”ç”¨åœºæ™¯"><a href="#2-4-Spring-Bootå®é™…åº”ç”¨åœºæ™¯" class="headerlink" title="2.4 Spring Bootå®é™…åº”ç”¨åœºæ™¯"></a>2.4 Spring Bootå®é™…åº”ç”¨åœºæ™¯</h3><h4 id="åœºæ™¯1ï¼šå¾®æœåŠ¡æ¶æ„"><a href="#åœºæ™¯1ï¼šå¾®æœåŠ¡æ¶æ„" class="headerlink" title="åœºæ™¯1ï¼šå¾®æœåŠ¡æ¶æ„"></a>åœºæ™¯1ï¼šå¾®æœåŠ¡æ¶æ„</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(UserServiceApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@FeignClient(name = &quot;order-service&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderServiceClient</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/orders/&#123;userId&#125;&quot;)</span></span><br><span class="line">    List&lt;Order&gt; <span class="title function_">getOrdersByUserId</span><span class="params">(<span class="meta">@PathVariable</span> Long userId)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="åœºæ™¯2ï¼šæ•°æ®è®¿é—®å±‚æ•´åˆ"><a href="#åœºæ™¯2ï¼šæ•°æ®è®¿é—®å±‚æ•´åˆ" class="headerlink" title="åœºæ™¯2ï¼šæ•°æ®è®¿é—®å±‚æ•´åˆ"></a>åœºæ™¯2ï¼šæ•°æ®è®¿é—®å±‚æ•´åˆ</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableJpaRepositories</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(&quot;spring.datasource.primary&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DataSourceProperties <span class="title function_">primaryDataSourceProperties</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DataSourceProperties</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(&quot;spring.datasource.secondary&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DataSourceProperties <span class="title function_">secondaryDataSourceProperties</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DataSourceProperties</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-5-Spring-Booté¢è¯•é—®é¢˜"><a href="#2-5-Spring-Booté¢è¯•é—®é¢˜" class="headerlink" title="2.5 Spring Booté¢è¯•é—®é¢˜"></a>2.5 Spring Booté¢è¯•é—®é¢˜</h3><p><strong>Q1: Spring Bootçš„å¯åŠ¨åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p>
<p>A: Spring Bootå¯åŠ¨åŸç†æ ¸å¿ƒåœ¨äºè‡ªåŠ¨é…ç½®ï¼š</p>
<ol>
<li><strong>@SpringBootApplication</strong>ç»„åˆäº†ä¸‰ä¸ªæ³¨è§£ï¼Œå…¶ä¸­@EnableAutoConfigurationæ˜¯å…³é”®</li>
<li><strong>AutoConfigurationImportSelector</strong>ä¼šæ‰«ææ‰€æœ‰å¼•å…¥çš„jaråŒ…ï¼ŒæŸ¥æ‰¾å…¶META-INF&#x2F;spring.factoriesæ–‡ä»¶ä¸­org.springframework.boot.autoconfigure.EnableAutoConfigurationé”®æ‰€å¯¹åº”çš„é…ç½®ç±»å…¨é™å®šååˆ—è¡¨</li>
<li>æ ¹æ®æ¡ä»¶æ³¨è§£åˆ¤æ–­å“ªäº›è‡ªåŠ¨é…ç½®ç±»ç”Ÿæ•ˆ</li>
<li>ç”Ÿæ•ˆçš„é…ç½®ç±»ä¼šå‘å®¹å™¨ä¸­æ³¨å†Œç›¸åº”çš„Bean</li>
</ol>
<p><strong>Q2: Spring Bootå¦‚ä½•å®ç°è‡ªåŠ¨é…ç½®ï¼Ÿ</strong></p>
<p>A: è‡ªåŠ¨é…ç½®é€šè¿‡ä»¥ä¸‹æœºåˆ¶å®ç°ï¼š</p>
<ol>
<li><strong>æ¡ä»¶æ³¨è§£</strong>: @ConditionalOnClassã€@ConditionalOnBeanç­‰åˆ¤æ–­é…ç½®æ˜¯å¦ç”Ÿæ•ˆ</li>
<li><strong>é…ç½®æ–‡ä»¶</strong>: spring.factorieså®šä¹‰è‡ªåŠ¨é…ç½®ç±»åˆ—è¡¨</li>
<li><strong>é…ç½®å±æ€§</strong>: @ConfigurationPropertiesç»‘å®šé…ç½®æ–‡ä»¶ä¸­çš„å±æ€§</li>
<li><strong>é»˜è®¤é…ç½®</strong>: æä¾›åˆç†çš„é»˜è®¤å€¼ï¼Œç”¨æˆ·å¯è¦†ç›–</li>
</ol>
<p><strong>Q3: Spring Boot Starterçš„å·¥ä½œåŸç†ï¼Ÿ</strong></p>
<p>A: Starteræ˜¯Spring Bootè‡ªåŠ¨é…ç½®çš„è½½ä½“ï¼š</p>
<ol>
<li><strong>ä¾èµ–ç®¡ç†</strong>: é€šè¿‡Maven&#x2F;Gradleå¼•å…¥ç›¸å…³ä¾èµ–</li>
<li><strong>è‡ªåŠ¨é…ç½®</strong>: åŒ…å«AutoConfigurationç±»</li>
<li><strong>å±æ€§ç»‘å®š</strong>: æä¾›ConfigurationPropertiesç±»</li>
<li><strong>æ¡ä»¶è£…é…</strong>: ä½¿ç”¨æ¡ä»¶æ³¨è§£æ§åˆ¶Beançš„åˆ›å»º</li>
</ol>
<h2 id="ä¸‰ã€Spring-MVCæ·±å…¥è§£æ"><a href="#ä¸‰ã€Spring-MVCæ·±å…¥è§£æ" class="headerlink" title="ä¸‰ã€Spring MVCæ·±å…¥è§£æ"></a>ä¸‰ã€Spring MVCæ·±å…¥è§£æ</h2><h3 id="3-1-Spring-MVCæ ¸å¿ƒç»„ä»¶"><a href="#3-1-Spring-MVCæ ¸å¿ƒç»„ä»¶" class="headerlink" title="3.1 Spring MVCæ ¸å¿ƒç»„ä»¶"></a>3.1 Spring MVCæ ¸å¿ƒç»„ä»¶</h3><p><strong>DispatcherServletå¤„ç†æµç¨‹ï¼š</strong></p>
<ol>
<li><strong>æ¥æ”¶è¯·æ±‚</strong>: DispatcherServletæ¥æ”¶HTTPè¯·æ±‚</li>
<li><strong>æŸ¥æ‰¾Handler</strong>: HandlerMappingæŸ¥æ‰¾å¤„ç†è¯·æ±‚çš„Handler</li>
<li><strong>è·å–HandlerAdapter</strong>: è·å–èƒ½å¤Ÿæ‰§è¡ŒHandlerçš„HandlerAdapter</li>
<li><strong>æ‰§è¡ŒHandler</strong>: HandlerAdapteræ‰§è¡ŒHandlerï¼ˆControlleræ–¹æ³•ï¼‰</li>
<li><strong>å¤„ç†ç»“æœ</strong>: è¿”å›ModelAndView</li>
<li><strong>è§†å›¾è§£æ</strong>: ViewResolverè§£æè§†å›¾åç§°</li>
<li><strong>æ¸²æŸ“è§†å›¾</strong>: Viewæ¸²æŸ“æ¨¡å‹æ•°æ®</li>
<li><strong>è¿”å›å“åº”</strong>: å“åº”ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯</li>
</ol>
<p><strong>æ ¸å¿ƒç»„ä»¶è¯¦è§£ï¼š</strong></p>
<ul>
<li><strong>DispatcherServlet</strong>: å‰ç«¯æ§åˆ¶å™¨ï¼Œç»Ÿä¸€å¤„ç†è¯·æ±‚</li>
<li><strong>HandlerMapping</strong>: å¤„ç†å™¨æ˜ å°„å™¨ï¼ŒURLä¸Handlerçš„æ˜ å°„</li>
<li><strong>HandlerAdapter</strong>: å¤„ç†å™¨é€‚é…å™¨ï¼Œæ‰§è¡ŒHandler</li>
<li><strong>Handler</strong>: å¤„ç†å™¨ï¼Œå³Controller</li>
<li><strong>ViewResolver</strong>: è§†å›¾è§£æå™¨</li>
<li><strong>View</strong>: è§†å›¾</li>
</ul>
<h3 id="3-2-Spring-MVCæ ¸å¿ƒæ³¨è§£"><a href="#3-2-Spring-MVCæ ¸å¿ƒæ³¨è§£" class="headerlink" title="3.2 Spring MVCæ ¸å¿ƒæ³¨è§£"></a>3.2 Spring MVCæ ¸å¿ƒæ³¨è§£</h3><h4 id="æ§åˆ¶å™¨æ³¨è§£"><a href="#æ§åˆ¶å™¨æ³¨è§£" class="headerlink" title="æ§åˆ¶å™¨æ³¨è§£"></a>æ§åˆ¶å™¨æ³¨è§£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span>             <span class="comment">// æ ‡è®°æ§åˆ¶å™¨ç±»</span></span><br><span class="line"><span class="meta">@RestController</span>        <span class="comment">// RESTfulæ§åˆ¶å™¨</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api&quot;)</span> <span class="comment">// è¯·æ±‚æ˜ å°„</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/users&quot;)</span>   <span class="comment">// GETè¯·æ±‚æ˜ å°„</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/users&quot;)</span>  <span class="comment">// POSTè¯·æ±‚æ˜ å°„</span></span><br><span class="line"><span class="meta">@PutMapping(&quot;/users/&#123;id&#125;&quot;)</span>    <span class="comment">// PUTè¯·æ±‚æ˜ å°„</span></span><br><span class="line"><span class="meta">@DeleteMapping(&quot;/users/&#123;id&#125;&quot;)</span> <span class="comment">// DELETEè¯·æ±‚æ˜ å°„</span></span><br><span class="line"><span class="meta">@PatchMapping(&quot;/users/&#123;id&#125;&quot;)</span>  <span class="comment">// PATCHè¯·æ±‚æ˜ å°„</span></span><br></pre></td></tr></table></figure>

<h4 id="å‚æ•°ç»‘å®šæ³¨è§£"><a href="#å‚æ•°ç»‘å®šæ³¨è§£" class="headerlink" title="å‚æ•°ç»‘å®šæ³¨è§£"></a>å‚æ•°ç»‘å®šæ³¨è§£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestParam(&quot;name&quot;)</span>           <span class="comment">// è¯·æ±‚å‚æ•°</span></span><br><span class="line"><span class="meta">@PathVariable(&quot;id&quot;)</span>            <span class="comment">// è·¯å¾„å˜é‡</span></span><br><span class="line"><span class="meta">@RequestBody</span>                   <span class="comment">// è¯·æ±‚ä½“</span></span><br><span class="line"><span class="meta">@RequestHeader(&quot;Content-Type&quot;)</span> <span class="comment">// è¯·æ±‚å¤´</span></span><br><span class="line"><span class="meta">@CookieValue(&quot;sessionId&quot;)</span>      <span class="comment">// Cookieå€¼</span></span><br><span class="line"><span class="meta">@ModelAttribute</span>               <span class="comment">// æ¨¡å‹å±æ€§</span></span><br><span class="line"><span class="meta">@SessionAttribute</span>            <span class="comment">// Sessionå±æ€§</span></span><br><span class="line"><span class="meta">@RequestPart</span>                 <span class="comment">// æ–‡ä»¶ä¸Šä¼ </span></span><br></pre></td></tr></table></figure>

<h4 id="å“åº”å¤„ç†æ³¨è§£"><a href="#å“åº”å¤„ç†æ³¨è§£" class="headerlink" title="å“åº”å¤„ç†æ³¨è§£"></a>å“åº”å¤„ç†æ³¨è§£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ResponseBody</span>              <span class="comment">// å“åº”ä½“</span></span><br><span class="line"><span class="meta">@ResponseStatus(HttpStatus.CREATED)</span> <span class="comment">// å“åº”çŠ¶æ€ç </span></span><br><span class="line"><span class="meta">@ExceptionHandler</span>         <span class="comment">// å¼‚å¸¸å¤„ç†</span></span><br><span class="line"><span class="meta">@ControllerAdvice</span>        <span class="comment">// å…¨å±€æ§åˆ¶å™¨å¢å¼º</span></span><br><span class="line"><span class="meta">@RestControllerAdvice</span>    <span class="comment">// RESTfulå…¨å±€å¼‚å¸¸å¤„ç†</span></span><br></pre></td></tr></table></figure>

<h3 id="3-3-Spring-MVCå®é™…åº”ç”¨åœºæ™¯"><a href="#3-3-Spring-MVCå®é™…åº”ç”¨åœºæ™¯" class="headerlink" title="3.3 Spring MVCå®é™…åº”ç”¨åœºæ™¯"></a>3.3 Spring MVCå®é™…åº”ç”¨åœºæ™¯</h3><h4 id="åœºæ™¯1ï¼šRESTful-APIå¼€å‘"><a href="#åœºæ™¯1ï¼šRESTful-APIå¼€å‘" class="headerlink" title="åœºæ™¯1ï¼šRESTful APIå¼€å‘"></a>åœºæ™¯1ï¼šRESTful APIå¼€å‘</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/users&quot;)</span></span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;PageResult&lt;User&gt;&gt; <span class="title function_">getUsers</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(defaultValue = &quot;1&quot;)</span> <span class="type">int</span> page,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(defaultValue = &quot;10&quot;)</span> <span class="type">int</span> size,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(required = false)</span> String keyword)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        PageResult&lt;User&gt; result = userService.findUsers(page, size, keyword);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(result);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;User&gt; <span class="title function_">createUser</span><span class="params">(<span class="meta">@Valid</span> <span class="meta">@RequestBody</span> UserCreateRequest request)</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.createUser(request);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.status(HttpStatus.CREATED).body(user);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PutMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;User&gt; <span class="title function_">updateUser</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@PathVariable</span> Long id,</span></span><br><span class="line"><span class="params">            <span class="meta">@Valid</span> <span class="meta">@RequestBody</span> UserUpdateRequest request)</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.updateUser(id, request);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(user);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Void&gt; <span class="title function_">deleteUser</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        userService.deleteUser(id);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.noContent().build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="åœºæ™¯2ï¼šå…¨å±€å¼‚å¸¸å¤„ç†"><a href="#åœºæ™¯2ï¼šå…¨å±€å¼‚å¸¸å¤„ç†" class="headerlink" title="åœºæ™¯2ï¼šå…¨å±€å¼‚å¸¸å¤„ç†"></a>åœºæ™¯2ï¼šå…¨å±€å¼‚å¸¸å¤„ç†</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ExceptionHandler(ValidationException.class)</span></span><br><span class="line">    <span class="meta">@ResponseStatus(HttpStatus.BAD_REQUEST)</span></span><br><span class="line">    <span class="keyword">public</span> ErrorResponse <span class="title function_">handleValidationException</span><span class="params">(ValidationException e)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ErrorResponse.builder()</span><br><span class="line">                .code(<span class="string">&quot;VALIDATION_ERROR&quot;</span>)</span><br><span class="line">                .message(e.getMessage())</span><br><span class="line">                .timestamp(LocalDateTime.now())</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ExceptionHandler(EntityNotFoundException.class)</span></span><br><span class="line">    <span class="meta">@ResponseStatus(HttpStatus.NOT_FOUND)</span></span><br><span class="line">    <span class="keyword">public</span> ErrorResponse <span class="title function_">handleEntityNotFoundException</span><span class="params">(EntityNotFoundException e)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ErrorResponse.builder()</span><br><span class="line">                .code(<span class="string">&quot;ENTITY_NOT_FOUND&quot;</span>)</span><br><span class="line">                .message(e.getMessage())</span><br><span class="line">                .timestamp(LocalDateTime.now())</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line">    <span class="meta">@ResponseStatus(HttpStatus.INTERNAL_SERVER_ERROR)</span></span><br><span class="line">    <span class="keyword">public</span> ErrorResponse <span class="title function_">handleGenericException</span><span class="params">(Exception e)</span> &#123;</span><br><span class="line">        log.error(<span class="string">&quot;Unexpected error occurred&quot;</span>, e);</span><br><span class="line">        <span class="keyword">return</span> ErrorResponse.builder()</span><br><span class="line">                .code(<span class="string">&quot;INTERNAL_ERROR&quot;</span>)</span><br><span class="line">                .message(<span class="string">&quot;An unexpected error occurred&quot;</span>)</span><br><span class="line">                .timestamp(LocalDateTime.now())</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="åœºæ™¯3ï¼šæ–‡ä»¶ä¸Šä¼ å¤„ç†"><a href="#åœºæ™¯3ï¼šæ–‡ä»¶ä¸Šä¼ å¤„ç†" class="headerlink" title="åœºæ™¯3ï¼šæ–‡ä»¶ä¸Šä¼ å¤„ç†"></a>åœºæ™¯3ï¼šæ–‡ä»¶ä¸Šä¼ å¤„ç†</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/files&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/upload&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;FileUploadResponse&gt; <span class="title function_">uploadFile</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestPart(&quot;file&quot;)</span> MultipartFile file,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(required = false)</span> String description)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ–‡ä»¶ç±»å‹éªŒè¯</span></span><br><span class="line">        <span class="keyword">if</span> (!isValidFileType(file.getContentType())) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InvalidFileTypeException</span>(<span class="string">&quot;Invalid file type&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ–‡ä»¶å¤§å°éªŒè¯</span></span><br><span class="line">        <span class="keyword">if</span> (file.getSize() &gt; MAX_FILE_SIZE) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">FileSizeExceededException</span>(<span class="string">&quot;File size exceeds limit&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> fileService.saveFile(file, description);</span><br><span class="line">        </span><br><span class="line">        <span class="type">FileUploadResponse</span> <span class="variable">response</span> <span class="operator">=</span> FileUploadResponse.builder()</span><br><span class="line">                .fileName(fileName)</span><br><span class="line">                .originalName(file.getOriginalFilename())</span><br><span class="line">                .size(file.getSize())</span><br><span class="line">                .contentType(file.getContentType())</span><br><span class="line">                .uploadTime(LocalDateTime.now())</span><br><span class="line">                .build();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-4-Spring-MVCé¢è¯•é—®é¢˜"><a href="#3-4-Spring-MVCé¢è¯•é—®é¢˜" class="headerlink" title="3.4 Spring MVCé¢è¯•é—®é¢˜"></a>3.4 Spring MVCé¢è¯•é—®é¢˜</h3><p><strong>Q1: Spring MVCçš„æ‰§è¡Œæµç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ</strong></p>
<p>A: Spring MVCçš„æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>ç”¨æˆ·å‘é€è¯·æ±‚åˆ°DispatcherServlet</li>
<li>DispatcherServletè°ƒç”¨HandlerMappingæŸ¥æ‰¾Handler</li>
<li>HandlerMappingè¿”å›HandlerExecutionChainï¼ˆåŒ…å«Handlerå’Œæ‹¦æˆªå™¨ï¼‰</li>
<li>DispatcherServletè°ƒç”¨HandlerAdapteræ‰§è¡ŒHandler</li>
<li>Handleræ‰§è¡Œå®Œæˆåè¿”å›ModelAndView</li>
<li>DispatcherServletè°ƒç”¨ViewResolverè§£æè§†å›¾åç§°</li>
<li>ViewResolverè¿”å›Viewå¯¹è±¡</li>
<li>DispatcherServletè°ƒç”¨Viewçš„renderæ–¹æ³•æ¸²æŸ“è§†å›¾</li>
<li>å“åº”ç»“æœè¿”å›ç»™ç”¨æˆ·</li>
</ol>
<p><strong>Q2: Spring MVCä¸­çš„æ‹¦æˆªå™¨æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</strong></p>
<p>A: æ‹¦æˆªå™¨åŸºäºAOPæ€æƒ³ï¼Œåœ¨Handleræ‰§è¡Œå‰åè¿›è¡Œå¤„ç†ï¼š</p>
<ol>
<li><strong>HandlerInterceptoræ¥å£</strong>æä¾›ä¸‰ä¸ªæ–¹æ³•ï¼š<ul>
<li>preHandle(): å‰ç½®å¤„ç†ï¼Œè¿”å›falseåˆ™ä¸­æ–­è¯·æ±‚</li>
<li>postHandle(): åç½®å¤„ç†ï¼ŒHandleræ‰§è¡Œåè°ƒç”¨</li>
<li>afterCompletion(): å®Œæˆå¤„ç†ï¼Œè§†å›¾æ¸²æŸ“åè°ƒç”¨</li>
</ul>
</li>
<li><strong>æ‰§è¡Œé¡ºåº</strong>ï¼š<ul>
<li>å¤šä¸ªæ‹¦æˆªå™¨æŒ‰é…ç½®é¡ºåºæ‰§è¡ŒpreHandle()</li>
<li>æŒ‰ç›¸åé¡ºåºæ‰§è¡ŒpostHandle()å’ŒafterCompletion()</li>
</ul>
</li>
</ol>
<p><strong>Q3: @RequestBodyå’Œ@ResponseBodyçš„å·¥ä½œåŸç†ï¼Ÿ</strong></p>
<p>A: è¿™ä¸¤ä¸ªæ³¨è§£åŸºäºHttpMessageConverterå·¥ä½œï¼š</p>
<ol>
<li><strong>@RequestBody</strong>:<ul>
<li>ä½¿ç”¨HttpMessageConverterå°†HTTPè¯·æ±‚ä½“è½¬æ¢ä¸ºJavaå¯¹è±¡</li>
<li>å¸¸ç”¨çš„è½¬æ¢å™¨ï¼šMappingJackson2HttpMessageConverterå¤„ç†JSON</li>
</ul>
</li>
<li><strong>@ResponseBody</strong>:<ul>
<li>ä½¿ç”¨HttpMessageConverterå°†Javaå¯¹è±¡è½¬æ¢ä¸ºHTTPå“åº”ä½“</li>
<li>æ ¹æ®Acceptå¤´é€‰æ‹©åˆé€‚çš„è½¬æ¢å™¨</li>
</ul>
</li>
</ol>
<h2 id="å››ã€MyBatisæ·±å…¥è§£æ"><a href="#å››ã€MyBatisæ·±å…¥è§£æ" class="headerlink" title="å››ã€MyBatisæ·±å…¥è§£æ"></a>å››ã€MyBatisæ·±å…¥è§£æ</h2><h3 id="4-1-MyBatisæ ¸å¿ƒåŸç†"><a href="#4-1-MyBatisæ ¸å¿ƒåŸç†" class="headerlink" title="4.1 MyBatisæ ¸å¿ƒåŸç†"></a>4.1 MyBatisæ ¸å¿ƒåŸç†</h3><p><strong>MyBatisæ¶æ„åˆ†æï¼š</strong> MyBatisé‡‡ç”¨åˆ†å±‚æ¶æ„è®¾è®¡ï¼š</p>
<ol>
<li><strong>APIæ¥å£å±‚</strong>: æä¾›ç»™å¤–éƒ¨ä½¿ç”¨çš„æ¥å£API</li>
<li><strong>æ•°æ®å¤„ç†å±‚</strong>: å‚æ•°æ˜ å°„ã€SQLè§£æã€ç»“æœæ˜ å°„</li>
<li><strong>åŸºç¡€æ”¯æ’‘å±‚</strong>: è¿æ¥ç®¡ç†ã€äº‹åŠ¡ç®¡ç†ã€é…ç½®åŠ è½½ã€ç¼“å­˜å¤„ç†</li>
</ol>
<p><strong>MyBatisæ ¸å¿ƒç»„ä»¶ï¼š</strong></p>
<ul>
<li><strong>SqlSessionFactory</strong>: ä¼šè¯å·¥å‚ï¼Œè´Ÿè´£åˆ›å»ºSqlSession</li>
<li><strong>SqlSession</strong>: ä¼šè¯ï¼Œæ‰§è¡ŒSQLçš„æ ¸å¿ƒæ¥å£</li>
<li><strong>Executor</strong>: æ‰§è¡Œå™¨ï¼Œå®é™…æ‰§è¡ŒSQL</li>
<li><strong>StatementHandler</strong>: è¯­å¥å¤„ç†å™¨ï¼Œå¤„ç†SQLè¯­å¥</li>
<li><strong>ParameterHandler</strong>: å‚æ•°å¤„ç†å™¨ï¼Œå¤„ç†SQLå‚æ•°</li>
<li><strong>ResultSetHandler</strong>: ç»“æœé›†å¤„ç†å™¨ï¼Œå¤„ç†æŸ¥è¯¢ç»“æœ</li>
<li><strong>MappedStatement</strong>: æ˜ å°„è¯­å¥ï¼Œå°è£…SQLé…ç½®ä¿¡æ¯</li>
</ul>
<h3 id="4-2-MyBatisæ‰§è¡Œæµç¨‹è¯¦è§£"><a href="#4-2-MyBatisæ‰§è¡Œæµç¨‹è¯¦è§£" class="headerlink" title="4.2 MyBatisæ‰§è¡Œæµç¨‹è¯¦è§£"></a>4.2 MyBatisæ‰§è¡Œæµç¨‹è¯¦è§£</h3><p><strong>SQLæ‰§è¡Œæµç¨‹ï¼š</strong></p>
<ol>
<li><strong>è§£æé…ç½®</strong>: è§£æmybatis-config.xmlå’ŒMapper XMLæ–‡ä»¶</li>
<li><strong>åˆ›å»ºä¼šè¯</strong>: é€šè¿‡SqlSessionFactoryåˆ›å»ºSqlSession</li>
<li><strong>è·å–Mapper</strong>: é€šè¿‡åŠ¨æ€ä»£ç†åˆ›å»ºMapperæ¥å£å®ä¾‹</li>
<li><strong>æ‰§è¡ŒSQL</strong>: è°ƒç”¨Mapperæ–¹æ³•ï¼Œè½¬æ¢ä¸ºMappedStatementæ‰§è¡Œ</li>
<li><strong>å‚æ•°å¤„ç†</strong>: ParameterHandlerå¤„ç†è¾“å…¥å‚æ•°</li>
<li><strong>æ‰§è¡ŒæŸ¥è¯¢</strong>: StatementHandleræ‰§è¡ŒSQLè¯­å¥</li>
<li><strong>ç»“æœæ˜ å°„</strong>: ResultSetHandlerå¤„ç†ç»“æœé›†</li>
<li><strong>è¿”å›ç»“æœ</strong>: å°†ç»“æœè¿”å›ç»™è°ƒç”¨æ–¹</li>
</ol>
<p><strong>åŠ¨æ€ä»£ç†åŸç†ï¼š</strong> MyBatisä½¿ç”¨JDKåŠ¨æ€ä»£ç†ä¸ºMapperæ¥å£åˆ›å»ºä»£ç†å¯¹è±¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MapperProxyå®ç°InvocationHandler</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MapperProxy</span>&lt;T&gt; <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// æ ¹æ®æ–¹æ³•ç­¾åæ‰¾åˆ°å¯¹åº”çš„MappedStatement</span></span><br><span class="line">        <span class="comment">// æ‰§è¡ŒSQLå¹¶è¿”å›ç»“æœ</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-3-MyBatisæ ¸å¿ƒæ³¨è§£"><a href="#4-3-MyBatisæ ¸å¿ƒæ³¨è§£" class="headerlink" title="4.3 MyBatisæ ¸å¿ƒæ³¨è§£"></a>4.3 MyBatisæ ¸å¿ƒæ³¨è§£</h3><h4 id="åŸºç¡€æ˜ å°„æ³¨è§£"><a href="#åŸºç¡€æ˜ å°„æ³¨è§£" class="headerlink" title="åŸºç¡€æ˜ å°„æ³¨è§£"></a>åŸºç¡€æ˜ å°„æ³¨è§£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select(&quot;SELECT * FROM users WHERE id = #&#123;id&#125;&quot;)</span></span><br><span class="line">User <span class="title function_">findById</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> Long id)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Insert(&quot;INSERT INTO users(name, email) VALUES(#&#123;name&#125;, #&#123;email&#125;)&quot;)</span></span><br><span class="line"><span class="meta">@Options(useGeneratedKeys = true, keyProperty = &quot;id&quot;)</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">insert</span><span class="params">(User user)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Update(&quot;UPDATE users SET name = #&#123;name&#125; WHERE id = #&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">update</span><span class="params">(User user)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Delete(&quot;DELETE FROM users WHERE id = #&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">delete</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> Long id)</span>;</span><br></pre></td></tr></table></figure>

<h4 id="é«˜çº§æ˜ å°„æ³¨è§£"><a href="#é«˜çº§æ˜ å°„æ³¨è§£" class="headerlink" title="é«˜çº§æ˜ å°„æ³¨è§£"></a>é«˜çº§æ˜ å°„æ³¨è§£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç»“æœæ˜ å°„</span></span><br><span class="line"><span class="meta">@Results(&#123;</span></span><br><span class="line"><span class="meta">    @Result(column = &quot;user_id&quot;, property = &quot;id&quot;),</span></span><br><span class="line"><span class="meta">    @Result(column = &quot;user_name&quot;, property = &quot;name&quot;),</span></span><br><span class="line"><span class="meta">    @Result(column = &quot;create_time&quot;, property = &quot;createTime&quot;)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="meta">@Select(&quot;SELECT user_id, user_name, create_time FROM users&quot;)</span></span><br><span class="line">List&lt;User&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸€å¯¹ä¸€æ˜ å°„</span></span><br><span class="line"><span class="meta">@One(select = &quot;findUserById&quot;)</span></span><br><span class="line"><span class="meta">@Result(column = &quot;user_id&quot;, property = &quot;user&quot;)</span></span><br><span class="line">Order <span class="title function_">findOrderById</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> Long id)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸€å¯¹å¤šæ˜ å°„</span></span><br><span class="line"><span class="meta">@Many(select = &quot;findOrdersByUserId&quot;)</span></span><br><span class="line"><span class="meta">@Result(column = &quot;id&quot;, property = &quot;orders&quot;)</span></span><br><span class="line">User <span class="title function_">findUserWithOrders</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> Long id)</span>;</span><br></pre></td></tr></table></figure>

<h4 id="åŠ¨æ€SQLæ³¨è§£"><a href="#åŠ¨æ€SQLæ³¨è§£" class="headerlink" title="åŠ¨æ€SQLæ³¨è§£"></a>åŠ¨æ€SQLæ³¨è§£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SelectProvider(type = UserSqlProvider.class, method = &quot;findUsers&quot;)</span></span><br><span class="line">List&lt;User&gt; <span class="title function_">findUsers</span><span class="params">(<span class="meta">@Param(&quot;name&quot;)</span> String name, <span class="meta">@Param(&quot;email&quot;)</span> String email)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserSqlProvider</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">findUsers</span><span class="params">(Map&lt;String, Object&gt; params)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SQL</span>() &#123;&#123;</span><br><span class="line">            SELECT(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">            FROM(<span class="string">&quot;users&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (params.get(<span class="string">&quot;name&quot;</span>) != <span class="literal">null</span>) &#123;</span><br><span class="line">                WHERE(<span class="string">&quot;name LIKE CONCAT(&#x27;%&#x27;, #&#123;name&#125;, &#x27;%&#x27;)&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (params.get(<span class="string">&quot;email&quot;</span>) != <span class="literal">null</span>) &#123;</span><br><span class="line">                WHERE(<span class="string">&quot;email = #&#123;email&#125;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;&#125;.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-4-MyBatisç¼“å­˜æœºåˆ¶"><a href="#4-4-MyBatisç¼“å­˜æœºåˆ¶" class="headerlink" title="4.4 MyBatisç¼“å­˜æœºåˆ¶"></a>4.4 MyBatisç¼“å­˜æœºåˆ¶</h3><p><strong>ä¸€çº§ç¼“å­˜ï¼ˆé»˜è®¤å¼€å¯ï¼‰ï¼š</strong></p>
<ul>
<li>ä½œç”¨åŸŸï¼šSqlSessionçº§åˆ«</li>
<li>ç”Ÿå‘½å‘¨æœŸï¼šä¸SqlSessionç›¸åŒ</li>
<li>å­˜å‚¨ï¼šHashMapç»“æ„ï¼Œkeyä¸ºCacheKey</li>
</ul>
<p><strong>äºŒçº§ç¼“å­˜ï¼ˆéœ€è¦é…ç½®ï¼‰ï¼š</strong></p>
<ul>
<li>ä½œç”¨åŸŸï¼šMapperçº§åˆ«</li>
<li>ç”Ÿå‘½å‘¨æœŸï¼šä¸åº”ç”¨ç¨‹åºç›¸åŒ</li>
<li>é…ç½®ï¼š@CacheNamespaceæ³¨è§£æˆ–<cache>æ ‡ç­¾</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CacheNamespace(</span></span><br><span class="line"><span class="meta">    eviction = LRU.class,</span></span><br><span class="line"><span class="meta">    flushInterval = 60000,</span></span><br><span class="line"><span class="meta">    size = 1024,</span></span><br><span class="line"><span class="meta">    readWrite = true</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    <span class="comment">// mapper methods</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-5-MyBatiså®é™…åº”ç”¨åœºæ™¯"><a href="#4-5-MyBatiså®é™…åº”ç”¨åœºæ™¯" class="headerlink" title="4.5 MyBatiså®é™…åº”ç”¨åœºæ™¯"></a>4.5 MyBatiså®é™…åº”ç”¨åœºæ™¯</h3><h4 id="åœºæ™¯1ï¼šå¤æ‚æŸ¥è¯¢åœºæ™¯"><a href="#åœºæ™¯1ï¼šå¤æ‚æŸ¥è¯¢åœºæ™¯" class="headerlink" title="åœºæ™¯1ï¼šå¤æ‚æŸ¥è¯¢åœºæ™¯"></a>åœºæ™¯1ï¼šå¤æ‚æŸ¥è¯¢åœºæ™¯</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderMapper</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ†é¡µæŸ¥è¯¢è®¢å•</span></span><br><span class="line">    <span class="meta">@Select(&quot;&quot;&quot;</span></span><br><span class="line"><span class="meta">        SELECT o.*, u.name as user_name, u.email as user_email</span></span><br><span class="line"><span class="meta">        FROM orders o</span></span><br><span class="line"><span class="meta">        LEFT JOIN users u ON o.user_id = u.id</span></span><br><span class="line"><span class="meta">        WHERE o.status = #&#123;status&#125;</span></span><br><span class="line"><span class="meta">        AND o.create_time BETWEEN #&#123;startTime&#125; AND #&#123;endTime&#125;</span></span><br><span class="line"><span class="meta">        ORDER BY o.create_time DESC</span></span><br><span class="line"><span class="meta">        LIMIT #&#123;offset&#125;, #&#123;limit&#125;</span></span><br><span class="line"><span class="meta">    &quot;&quot;&quot;)</span></span><br><span class="line">    <span class="meta">@Results(&#123;</span></span><br><span class="line"><span class="meta">        @Result(column = &quot;id&quot;, property = &quot;id&quot;),</span></span><br><span class="line"><span class="meta">        @Result(column = &quot;user_id&quot;, property = &quot;userId&quot;),</span></span><br><span class="line"><span class="meta">        @Result(column = &quot;user_name&quot;, property = &quot;user.name&quot;),</span></span><br><span class="line"><span class="meta">        @Result(column = &quot;user_email&quot;, property = &quot;user.email&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    List&lt;OrderVO&gt; <span class="title function_">findOrdersWithUser</span><span class="params">(</span></span><br><span class="line"><span class="params">        <span class="meta">@Param(&quot;status&quot;)</span> String status,</span></span><br><span class="line"><span class="params">        <span class="meta">@Param(&quot;startTime&quot;)</span> LocalDateTime startTime,</span></span><br><span class="line"><span class="params">        <span class="meta">@Param(&quot;endTime&quot;)</span> LocalDateTime endTime,</span></span><br><span class="line"><span class="params">        <span class="meta">@Param(&quot;offset&quot;)</span> <span class="type">int</span> offset,</span></span><br><span class="line"><span class="params">        <span class="meta">@Param(&quot;limit&quot;)</span> <span class="type">int</span> limit</span></span><br><span class="line"><span class="params">    )</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç»Ÿè®¡æŸ¥è¯¢</span></span><br><span class="line">    <span class="meta">@Select(&quot;&quot;&quot;</span></span><br><span class="line"><span class="meta">        SELECT </span></span><br><span class="line"><span class="meta">            COUNT(*) as total_count,</span></span><br><span class="line"><span class="meta">            SUM(amount) as total_amount,</span></span><br><span class="line"><span class="meta">            AVG(amount) as avg_amount</span></span><br><span class="line"><span class="meta">        FROM orders </span></span><br><span class="line"><span class="meta">        WHERE status = #&#123;status&#125;</span></span><br><span class="line"><span class="meta">        AND create_time &gt;= #&#123;startTime&#125;</span></span><br><span class="line"><span class="meta">    &quot;&quot;&quot;)</span></span><br><span class="line">    OrderStatistics <span class="title function_">getOrderStatistics</span><span class="params">(</span></span><br><span class="line"><span class="params">        <span class="meta">@Param(&quot;status&quot;)</span> String status,</span></span><br><span class="line"><span class="params">        <span class="meta">@Param(&quot;startTime&quot;)</span> LocalDateTime startTime</span></span><br><span class="line"><span class="params">    )</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="åœºæ™¯2ï¼šæ‰¹é‡æ“ä½œåœºæ™¯"><a href="#åœºæ™¯2ï¼šæ‰¹é‡æ“ä½œåœºæ™¯" class="headerlink" title="åœºæ™¯2ï¼šæ‰¹é‡æ“ä½œåœºæ™¯"></a>åœºæ™¯2ï¼šæ‰¹é‡æ“ä½œåœºæ™¯</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BatchMapper</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ‰¹é‡æ’å…¥</span></span><br><span class="line">    <span class="meta">@Insert(&quot;&quot;&quot;</span></span><br><span class="line"><span class="meta">        &lt;script&gt;</span></span><br><span class="line"><span class="meta">        INSERT INTO users (name, email, create_time) VALUES</span></span><br><span class="line"><span class="meta">        &lt;foreach collection=&quot;users&quot; item=&quot;user&quot; separator=&quot;,&quot;&gt;</span></span><br><span class="line"><span class="meta">            (#&#123;user.name&#125;, #&#123;user.email&#125;, #&#123;user.createTime&#125;)</span></span><br><span class="line"><span class="meta">        &lt;/foreach&gt;</span></span><br><span class="line"><span class="meta">        &lt;/script&gt;</span></span><br><span class="line"><span class="meta">    &quot;&quot;&quot;)</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">batchInsertUsers</span><span class="params">(<span class="meta">@Param(&quot;users&quot;)</span> List&lt;User&gt; users)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ‰¹é‡æ›´æ–°</span></span><br><span class="line">    <span class="meta">@Update(&quot;&quot;&quot;</span></span><br><span class="line"><span class="meta">        &lt;script&gt;</span></span><br><span class="line"><span class="meta">        &lt;foreach collection=&quot;users&quot; item=&quot;user&quot; separator=&quot;;&quot;&gt;</span></span><br><span class="line"><span class="meta">            UPDATE users SET </span></span><br><span class="line"><span class="meta">                name = #&#123;user.name&#125;,</span></span><br><span class="line"><span class="meta">                email = #&#123;user.email&#125;,</span></span><br><span class="line"><span class="meta">                update_time = NOW()</span></span><br><span class="line"><span class="meta">            WHERE id = #&#123;user.id&#125;</span></span><br><span class="line"><span class="meta">        &lt;/foreach&gt;</span></span><br><span class="line"><span class="meta">        &lt;/script&gt;</span></span><br><span class="line"><span class="meta">    &quot;&quot;&quot;)</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">batchUpdateUsers</span><span class="params">(<span class="meta">@Param(&quot;users&quot;)</span> List&lt;User&gt; users)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="åœºæ™¯3ï¼šåŠ¨æ€SQLåœºæ™¯"><a href="#åœºæ™¯3ï¼šåŠ¨æ€SQLåœºæ™¯" class="headerlink" title="åœºæ™¯3ï¼šåŠ¨æ€SQLåœºæ™¯"></a>åœºæ™¯3ï¼šåŠ¨æ€SQLåœºæ™¯</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SelectProvider(type = UserSqlProvider.class, method = &quot;searchUsers&quot;)</span></span><br><span class="line">List&lt;User&gt; <span class="title function_">searchUsers</span><span class="params">(UserSearchCriteria criteria)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserSqlProvider</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">searchUsers</span><span class="params">(UserSearchCriteria criteria)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SQL</span>() &#123;&#123;</span><br><span class="line">            SELECT(<span class="string">&quot;u.*, p.name as profile_name&quot;</span>);</span><br><span class="line">            FROM(<span class="string">&quot;users u&quot;</span>);</span><br><span class="line">            LEFT_OUTER_JOIN(<span class="string">&quot;user_profiles p ON u.id = p.user_id&quot;</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (StringUtils.hasText(criteria.getName())) &#123;</span><br><span class="line">                WHERE(<span class="string">&quot;u.name LIKE CONCAT(&#x27;%&#x27;, #&#123;name&#125;, &#x27;%&#x27;)&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (StringUtils.hasText(criteria.getEmail())) &#123;</span><br><span class="line">                WHERE(<span class="string">&quot;u.email = #&#123;email&#125;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (criteria.getMinAge() != <span class="literal">null</span>) &#123;</span><br><span class="line">                WHERE(<span class="string">&quot;u.age &gt;= #&#123;minAge&#125;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (criteria.getMaxAge() != <span class="literal">null</span>) &#123;</span><br><span class="line">                WHERE(<span class="string">&quot;u.age &lt;= #&#123;maxAge&#125;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (criteria.getCreateTimeStart() != <span class="literal">null</span>) &#123;</span><br><span class="line">                WHERE(<span class="string">&quot;u.create_time &gt;= #&#123;createTimeStart&#125;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (criteria.getCreateTimeEnd() != <span class="literal">null</span>) &#123;</span><br><span class="line">                WHERE(<span class="string">&quot;u.create_time &lt;= #&#123;createTimeEnd&#125;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (CollectionUtils.isNotEmpty(criteria.getStatuses())) &#123;</span><br><span class="line">                WHERE(<span class="string">&quot;u.status IN (&quot;</span> + </span><br><span class="line">                    criteria.getStatuses().stream()</span><br><span class="line">                        .map(s -&gt; <span class="string">&quot;&#x27;&quot;</span> + s + <span class="string">&quot;&#x27;&quot;</span>)</span><br><span class="line">                        .collect(Collectors.joining(<span class="string">&quot;,&quot;</span>)) + <span class="string">&quot;)&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// æ’åº</span></span><br><span class="line">            <span class="keyword">if</span> (StringUtils.hasText(criteria.getSortField())) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="string">&quot;desc&quot;</span>.equalsIgnoreCase(criteria.getSortDirection())) &#123;</span><br><span class="line">                    ORDER_BY(<span class="string">&quot;u.&quot;</span> + criteria.getSortField() + <span class="string">&quot; DESC&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    ORDER_BY(<span class="string">&quot;u.&quot;</span> + criteria.getSortField() + <span class="string">&quot; ASC&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                ORDER_BY(<span class="string">&quot;u.create_time DESC&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;&#125;.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-6-MyBatisæ€§èƒ½ä¼˜åŒ–"><a href="#4-6-MyBatisæ€§èƒ½ä¼˜åŒ–" class="headerlink" title="4.6 MyBatisæ€§èƒ½ä¼˜åŒ–"></a>4.6 MyBatisæ€§èƒ½ä¼˜åŒ–</h3><h4 id="ä¼˜åŒ–ç­–ç•¥1ï¼šåˆç†ä½¿ç”¨ç¼“å­˜"><a href="#ä¼˜åŒ–ç­–ç•¥1ï¼šåˆç†ä½¿ç”¨ç¼“å­˜" class="headerlink" title="ä¼˜åŒ–ç­–ç•¥1ï¼šåˆç†ä½¿ç”¨ç¼“å­˜"></a>ä¼˜åŒ–ç­–ç•¥1ï¼šåˆç†ä½¿ç”¨ç¼“å­˜</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼€å¯äºŒçº§ç¼“å­˜ï¼Œè®¾ç½®åˆç†çš„ç¼“å­˜ç­–ç•¥</span></span><br><span class="line"><span class="meta">@CacheNamespace(</span></span><br><span class="line"><span class="meta">    eviction = LRU.class,        // ç¼“å­˜å›æ”¶ç­–ç•¥</span></span><br><span class="line"><span class="meta">    flushInterval = 300000,      // ç¼“å­˜åˆ·æ–°é—´éš”ï¼ˆ5åˆ†é’Ÿï¼‰</span></span><br><span class="line"><span class="meta">    size = 1024,                 // ç¼“å­˜å¤§å°</span></span><br><span class="line"><span class="meta">    readWrite = true,            // è¯»å†™ç¼“å­˜</span></span><br><span class="line"><span class="meta">    blocking = false             // éé˜»å¡ç¼“å­˜</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ProductMapper</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¯¹äºé¢‘ç¹æŸ¥è¯¢ä¸”å˜åŒ–ä¸å¤§çš„æ•°æ®ä½¿ç”¨ç¼“å­˜</span></span><br><span class="line">    <span class="meta">@Select(&quot;SELECT * FROM products WHERE category_id = #&#123;categoryId&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@Options(useCache = true)</span></span><br><span class="line">    List&lt;Product&gt; <span class="title function_">findByCategory</span><span class="params">(<span class="meta">@Param(&quot;categoryId&quot;)</span> Long categoryId)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¯¹äºå®æ—¶æ€§è¦æ±‚é«˜çš„æ•°æ®ç¦ç”¨ç¼“å­˜</span></span><br><span class="line">    <span class="meta">@Select(&quot;SELECT * FROM products WHERE id = #&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@Options(useCache = false)</span></span><br><span class="line">    Product <span class="title function_">findRealTimeById</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> Long id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ä¼˜åŒ–ç­–ç•¥2ï¼šæ‰¹é‡æ“ä½œ"><a href="#ä¼˜åŒ–ç­–ç•¥2ï¼šæ‰¹é‡æ“ä½œ" class="headerlink" title="ä¼˜åŒ–ç­–ç•¥2ï¼šæ‰¹é‡æ“ä½œ"></a>ä¼˜åŒ–ç­–ç•¥2ï¼šæ‰¹é‡æ“ä½œ</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨æ‰¹é‡æ’å…¥æ›¿ä»£å¾ªç¯æ’å…¥</span></span><br><span class="line"><span class="meta">@Insert(&quot;&quot;&quot;</span></span><br><span class="line"><span class="meta">    &lt;script&gt;</span></span><br><span class="line"><span class="meta">    INSERT INTO order_items (order_id, product_id, quantity, price) VALUES</span></span><br><span class="line"><span class="meta">    &lt;foreach collection=&quot;items&quot; item=&quot;item&quot; separator=&quot;,&quot;&gt;</span></span><br><span class="line"><span class="meta">        (#&#123;item.orderId&#125;, #&#123;item.productId&#125;, #&#123;item.quantity&#125;, #&#123;item.price&#125;)</span></span><br><span class="line"><span class="meta">    &lt;/foreach&gt;</span></span><br><span class="line"><span class="meta">    &lt;/script&gt;</span></span><br><span class="line"><span class="meta">&quot;&quot;&quot;)</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">batchInsertOrderItems</span><span class="params">(<span class="meta">@Param(&quot;items&quot;)</span> List&lt;OrderItem&gt; items)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰¹é‡æ›´æ–°ä¼˜åŒ–</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">batchUpdateProducts</span><span class="params">(List&lt;Product&gt; products)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> (<span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession(ExecutorType.BATCH)) &#123;</span><br><span class="line">        <span class="type">ProductMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(ProductMapper.class);</span><br><span class="line">        <span class="keyword">for</span> (Product product : products) &#123;</span><br><span class="line">            mapper.updateProduct(product);</span><br><span class="line">        &#125;</span><br><span class="line">        sqlSession.commit();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ä¼˜åŒ–ç­–ç•¥3ï¼šå»¶è¿ŸåŠ è½½"><a href="#ä¼˜åŒ–ç­–ç•¥3ï¼šå»¶è¿ŸåŠ è½½" class="headerlink" title="ä¼˜åŒ–ç­–ç•¥3ï¼šå»¶è¿ŸåŠ è½½"></a>ä¼˜åŒ–ç­–ç•¥3ï¼šå»¶è¿ŸåŠ è½½</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ResultMap(&quot;userResultMap&quot;)</span></span><br><span class="line"><span class="meta">@Select(&quot;SELECT * FROM users WHERE id = #&#123;id&#125;&quot;)</span></span><br><span class="line">User <span class="title function_">findUserById</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> Long id)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨ResultMapä¸­é…ç½®å»¶è¿ŸåŠ è½½</span></span><br><span class="line">&lt;resultMap id=<span class="string">&quot;userResultMap&quot;</span> type=<span class="string">&quot;User&quot;</span>&gt;</span><br><span class="line">    &lt;id column=<span class="string">&quot;id&quot;</span> property=<span class="string">&quot;id&quot;</span>/&gt;</span><br><span class="line">    &lt;result column=<span class="string">&quot;name&quot;</span> property=<span class="string">&quot;name&quot;</span>/&gt;</span><br><span class="line">    &lt;collection property=<span class="string">&quot;orders&quot;</span> </span><br><span class="line">                select=<span class="string">&quot;findOrdersByUserId&quot;</span> </span><br><span class="line">                column=<span class="string">&quot;id&quot;</span> </span><br><span class="line">                fetchType=<span class="string">&quot;lazy&quot;</span>/&gt;</span><br><span class="line">&lt;/resultMap&gt;</span><br></pre></td></tr></table></figure>

<h3 id="4-7-MyBatiså¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ"><a href="#4-7-MyBatiså¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ" class="headerlink" title="4.7 MyBatiså¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ"></a>4.7 MyBatiså¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</h3><h4 id="é—®é¢˜1ï¼šN-1æŸ¥è¯¢é—®é¢˜"><a href="#é—®é¢˜1ï¼šN-1æŸ¥è¯¢é—®é¢˜" class="headerlink" title="é—®é¢˜1ï¼šN+1æŸ¥è¯¢é—®é¢˜"></a>é—®é¢˜1ï¼šN+1æŸ¥è¯¢é—®é¢˜</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é—®é¢˜ï¼šä¼šäº§ç”ŸN+1æ¬¡æŸ¥è¯¢</span></span><br><span class="line"><span class="meta">@Select(&quot;SELECT * FROM users&quot;)</span></span><br><span class="line">List&lt;User&gt; <span class="title function_">findAllUsers</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Select(&quot;SELECT * FROM orders WHERE user_id = #&#123;userId&#125;&quot;)</span></span><br><span class="line">List&lt;Order&gt; <span class="title function_">findOrdersByUserId</span><span class="params">(<span class="meta">@Param(&quot;userId&quot;)</span> Long userId)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è§£å†³æ–¹æ¡ˆ1ï¼šä½¿ç”¨è”è¡¨æŸ¥è¯¢</span></span><br><span class="line"><span class="meta">@Select(&quot;&quot;&quot;</span></span><br><span class="line"><span class="meta">    SELECT u.*, o.id as order_id, o.amount, o.status as order_status</span></span><br><span class="line"><span class="meta">    FROM users u</span></span><br><span class="line"><span class="meta">    LEFT JOIN orders o ON u.id = o.user_id</span></span><br><span class="line"><span class="meta">&quot;&quot;&quot;)</span></span><br><span class="line"><span class="meta">@Results(&#123;</span></span><br><span class="line"><span class="meta">    @Result(column = &quot;id&quot;, property = &quot;id&quot;),</span></span><br><span class="line"><span class="meta">    @Result(column = &quot;name&quot;, property = &quot;name&quot;),</span></span><br><span class="line"><span class="meta">    @Result(column = &quot;order_id&quot;, property = &quot;orders.id&quot;),</span></span><br><span class="line"><span class="meta">    @Result(column = &quot;amount&quot;, property = &quot;orders.amount&quot;),</span></span><br><span class="line"><span class="meta">    @Result(column = &quot;order_status&quot;, property = &quot;orders.status&quot;)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line">List&lt;User&gt; <span class="title function_">findUsersWithOrders</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è§£å†³æ–¹æ¡ˆ2ï¼šä½¿ç”¨æ‰¹é‡æŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findUsersWithOrdersOptimized</span><span class="params">(List&lt;Long&gt; userIds)</span> &#123;</span><br><span class="line">    List&lt;User&gt; users = userMapper.findUsersByIds(userIds);</span><br><span class="line">    <span class="keyword">if</span> (!users.isEmpty()) &#123;</span><br><span class="line">        List&lt;Long&gt; ids = users.stream().map(User::getId).collect(Collectors.toList());</span><br><span class="line">        List&lt;Order&gt; orders = orderMapper.findOrdersByUserIds(ids);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ‰‹åŠ¨ç»„è£…æ•°æ®</span></span><br><span class="line">        Map&lt;Long, List&lt;Order&gt;&gt; orderMap = orders.stream()</span><br><span class="line">            .collect(Collectors.groupingBy(Order::getUserId));</span><br><span class="line">        </span><br><span class="line">        users.forEach(user -&gt; user.setOrders(orderMap.get(user.getId())));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> users;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="é—®é¢˜2ï¼šå¤§æ•°æ®é‡æŸ¥è¯¢å†…å­˜æº¢å‡º"><a href="#é—®é¢˜2ï¼šå¤§æ•°æ®é‡æŸ¥è¯¢å†…å­˜æº¢å‡º" class="headerlink" title="é—®é¢˜2ï¼šå¤§æ•°æ®é‡æŸ¥è¯¢å†…å­˜æº¢å‡º"></a>é—®é¢˜2ï¼šå¤§æ•°æ®é‡æŸ¥è¯¢å†…å­˜æº¢å‡º</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é—®é¢˜ï¼šä¸€æ¬¡æ€§åŠ è½½å¤§é‡æ•°æ®å¯¼è‡´å†…å­˜æº¢å‡º</span></span><br><span class="line"><span class="meta">@Select(&quot;SELECT * FROM large_table&quot;)</span></span><br><span class="line">List&lt;LargeData&gt; <span class="title function_">findAllData</span><span class="params">()</span>; <span class="comment">// å¯èƒ½å¯¼è‡´OOM</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è§£å†³æ–¹æ¡ˆ1ï¼šåˆ†é¡µæŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">public</span> List&lt;LargeData&gt; <span class="title function_">findAllDataWithPaging</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;LargeData&gt; allData = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">int</span> <span class="variable">pageSize</span> <span class="operator">=</span> <span class="number">1000</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">offset</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    List&lt;LargeData&gt; pageData;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        pageData = mapper.findDataWithLimit(offset, pageSize);</span><br><span class="line">        allData.addAll(pageData);</span><br><span class="line">        offset += pageSize;</span><br><span class="line">    &#125; <span class="keyword">while</span> (pageData.size() == pageSize);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> allData;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è§£å†³æ–¹æ¡ˆ2ï¼šä½¿ç”¨æ¸¸æ ‡æŸ¥è¯¢</span></span><br><span class="line"><span class="meta">@Select(&quot;SELECT * FROM large_table WHERE process_status = &#x27;PENDING&#x27;&quot;)</span></span><br><span class="line"><span class="meta">@Options(resultSetType = ResultSetType.FORWARD_ONLY, fetchSize = 1000)</span></span><br><span class="line">Cursor&lt;LargeData&gt; <span class="title function_">findPendingDataCursor</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processLargeData</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> (Cursor&lt;LargeData&gt; cursor = mapper.findPendingDataCursor()) &#123;</span><br><span class="line">        cursor.forEach(<span class="built_in">this</span>::processData);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="é—®é¢˜3ï¼šSQLæ³¨å…¥é˜²æŠ¤"><a href="#é—®é¢˜3ï¼šSQLæ³¨å…¥é˜²æŠ¤" class="headerlink" title="é—®é¢˜3ï¼šSQLæ³¨å…¥é˜²æŠ¤"></a>é—®é¢˜3ï¼šSQLæ³¨å…¥é˜²æŠ¤</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å±é™©ï¼šç›´æ¥æ‹¼æ¥SQLï¼Œå®¹æ˜“SQLæ³¨å…¥</span></span><br><span class="line"><span class="meta">@Select(&quot;SELECT * FROM users WHERE name = &#x27;$&#123;name&#125;&#x27;&quot;)</span> <span class="comment">// é”™è¯¯ç¤ºä¾‹</span></span><br><span class="line">List&lt;User&gt; <span class="title function_">findByNameUnsafe</span><span class="params">(<span class="meta">@Param(&quot;name&quot;)</span> String name)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®‰å…¨ï¼šä½¿ç”¨å‚æ•°ç»‘å®š</span></span><br><span class="line"><span class="meta">@Select(&quot;SELECT * FROM users WHERE name = #&#123;name&#125;&quot;)</span></span><br><span class="line">List&lt;User&gt; <span class="title function_">findByNameSafe</span><span class="params">(<span class="meta">@Param(&quot;name&quot;)</span> String name)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŠ¨æ€æ’åºçš„å®‰å…¨å¤„ç†</span></span><br><span class="line"><span class="meta">@SelectProvider(type = UserSqlProvider.class, method = &quot;findUsersWithSort&quot;)</span></span><br><span class="line">List&lt;User&gt; <span class="title function_">findUsersWithSort</span><span class="params">(<span class="meta">@Param(&quot;sortField&quot;)</span> String sortField, </span></span><br><span class="line"><span class="params">                            <span class="meta">@Param(&quot;sortDirection&quot;)</span> String sortDirection)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserSqlProvider</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Set&lt;String&gt; ALLOWED_SORT_FIELDS = </span><br><span class="line">        Set.of(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;email&quot;</span>, <span class="string">&quot;create_time&quot;</span>, <span class="string">&quot;update_time&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">findUsersWithSort</span><span class="params">(Map&lt;String, Object&gt; params)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sortField</span> <span class="operator">=</span> (String) params.get(<span class="string">&quot;sortField&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">sortDirection</span> <span class="operator">=</span> (String) params.get(<span class="string">&quot;sortDirection&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ç™½åå•éªŒè¯</span></span><br><span class="line">        <span class="keyword">if</span> (!ALLOWED_SORT_FIELDS.contains(sortField)) &#123;</span><br><span class="line">            sortField = <span class="string">&quot;id&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!<span class="string">&quot;DESC&quot;</span>.equalsIgnoreCase(sortDirection)) &#123;</span><br><span class="line">            sortDirection = <span class="string">&quot;ASC&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;SELECT * FROM users ORDER BY &quot;</span> + sortField + <span class="string">&quot; &quot;</span> + sortDirection;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-8-MyBatisé¢è¯•é«˜é¢‘é—®é¢˜"><a href="#4-8-MyBatisé¢è¯•é«˜é¢‘é—®é¢˜" class="headerlink" title="4.8 MyBatisé¢è¯•é«˜é¢‘é—®é¢˜"></a>4.8 MyBatisé¢è¯•é«˜é¢‘é—®é¢˜</h3><p><strong>Q1: MyBatisçš„æ‰§è¡Œæµç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ</strong></p>
<p>A: MyBatisçš„æ‰§è¡Œæµç¨‹åŒ…æ‹¬ä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ol>
<li><strong>é…ç½®è§£æ</strong>: è§£æmybatis-config.xmlé…ç½®æ–‡ä»¶å’ŒMapper XMLæ–‡ä»¶ï¼Œåˆ›å»ºConfigurationå¯¹è±¡</li>
<li><strong>SqlSessionFactoryåˆ›å»º</strong>: æ ¹æ®Configurationåˆ›å»ºSqlSessionFactory</li>
<li><strong>SqlSessionåˆ›å»º</strong>: é€šè¿‡SqlSessionFactory.openSession()åˆ›å»ºSqlSession</li>
<li><strong>Mapperè·å–</strong>: é€šè¿‡SqlSession.getMapper()è·å–Mapperæ¥å£çš„ä»£ç†å¯¹è±¡</li>
<li><strong>æ–¹æ³•è°ƒç”¨</strong>: è°ƒç”¨Mapperæ¥å£æ–¹æ³•ï¼Œé€šè¿‡åŠ¨æ€ä»£ç†è½¬æ¢ä¸ºSQLæ‰§è¡Œ</li>
<li><strong>SQLæ‰§è¡Œ</strong>: é€šè¿‡Executoræ‰§è¡ŒSQLï¼ŒåŒ…æ‹¬å‚æ•°å¤„ç†ã€è¯­å¥æ‰§è¡Œã€ç»“æœæ˜ å°„</li>
<li><strong>ç»“æœè¿”å›</strong>: å°†æ‰§è¡Œç»“æœè¿”å›ç»™è°ƒç”¨æ–¹</li>
</ol>
<p><strong>Q2: MyBatisçš„ä¸€çº§ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></p>
<p>A: ä¸¤çº§ç¼“å­˜çš„ä¸»è¦åŒºåˆ«ï¼š</p>
<p><strong>ä¸€çº§ç¼“å­˜ï¼ˆé»˜è®¤å¼€å¯ï¼‰ï¼š</strong></p>
<ul>
<li>ä½œç”¨åŸŸï¼šSqlSessionçº§åˆ«</li>
<li>ç”Ÿå‘½å‘¨æœŸï¼šä¸SqlSessionç›¸åŒï¼ŒSqlSessionå…³é—­æ—¶ç¼“å­˜æ¸…ç©º</li>
<li>å­˜å‚¨ç»“æ„ï¼šHashMapï¼Œkeyä¸ºCacheKeyï¼ˆç”±SQLã€å‚æ•°ã€åˆ†é¡µç­‰ç»„æˆï¼‰</li>
<li>å¤±æ•ˆæ¡ä»¶ï¼šæ‰§è¡Œupdateã€insertã€deleteæ“ä½œæˆ–æ‰‹åŠ¨æ¸…ç©º</li>
</ul>
<p><strong>äºŒçº§ç¼“å­˜ï¼ˆéœ€è¦é…ç½®ï¼‰ï¼š</strong></p>
<ul>
<li>ä½œç”¨åŸŸï¼šMapperçº§åˆ«ï¼Œå¤šä¸ªSqlSessionå¯ä»¥å…±äº«</li>
<li>ç”Ÿå‘½å‘¨æœŸï¼šä¸åº”ç”¨ç¨‹åºç›¸åŒ</li>
<li>å­˜å‚¨ç»“æ„ï¼šå¯é…ç½®ï¼ˆHashMapã€LRUã€FIFOç­‰ï¼‰</li>
<li>é…ç½®æ–¹å¼ï¼š@CacheNamespaceæ³¨è§£æˆ–<cache>æ ‡ç­¾</li>
<li>æ³¨æ„äº‹é¡¹ï¼šéœ€è¦åºåˆ—åŒ–ï¼Œå¯èƒ½å­˜åœ¨è„è¯»é—®é¢˜</li>
</ul>
<p><strong>Q3: MyBatiså¦‚ä½•é˜²æ­¢SQLæ³¨å…¥ï¼Ÿ</strong></p>
<p>A: MyBatisé€šè¿‡ä»¥ä¸‹æ–¹å¼é˜²æ­¢SQLæ³¨å…¥ï¼š</p>
<ol>
<li><strong>å‚æ•°ç»‘å®š</strong>: ä½¿ç”¨#{}è€Œä¸æ˜¯${}<ul>
<li>#{}ï¼šé¢„ç¼–è¯‘å¤„ç†ï¼Œå‚æ•°ä½œä¸ºå ä½ç¬¦ä¼ é€’</li>
<li>${}ï¼šå­—ç¬¦ä¸²æ›¿æ¢ï¼Œç›´æ¥æ‹¼æ¥åˆ°SQLä¸­ï¼ˆå±é™©ï¼‰</li>
</ul>
</li>
<li><strong>ç±»å‹æ£€æŸ¥</strong>: MyBatisä¼šå¯¹å‚æ•°ç±»å‹è¿›è¡Œæ£€æŸ¥</li>
<li><strong>ç™½åå•éªŒè¯</strong>: å¯¹äºåŠ¨æ€æ’åºç­‰åœºæ™¯ï¼Œä½¿ç”¨ç™½åå•éªŒè¯</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®‰å…¨çš„å†™æ³•</span></span><br><span class="line"><span class="meta">@Select(&quot;SELECT * FROM users WHERE name = #&#123;name&#125; AND age &gt; #&#123;age&#125;&quot;)</span></span><br><span class="line">List&lt;User&gt; <span class="title function_">findUsers</span><span class="params">(<span class="meta">@Param(&quot;name&quot;)</span> String name, <span class="meta">@Param(&quot;age&quot;)</span> Integer age)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å±é™©çš„å†™æ³•ï¼ˆé¿å…ä½¿ç”¨ï¼‰</span></span><br><span class="line"><span class="meta">@Select(&quot;SELECT * FROM users WHERE name = &#x27;$&#123;name&#125;&#x27;&quot;)</span></span><br><span class="line">List&lt;User&gt; <span class="title function_">findUsersUnsafe</span><span class="params">(<span class="meta">@Param(&quot;name&quot;)</span> String name)</span>;</span><br></pre></td></tr></table></figure>

<p><strong>Q4: MyBatisä¸­#{}å’Œ${}çš„åŒºåˆ«ï¼Ÿ</strong></p>
<p>A: ä¸¤è€…çš„ä¸»è¦åŒºåˆ«ï¼š</p>
<p><strong>#{}ï¼ˆæ¨èä½¿ç”¨ï¼‰ï¼š</strong></p>
<ul>
<li>é¢„ç¼–è¯‘å¤„ç†ï¼Œç”ŸæˆPreparedStatement</li>
<li>å‚æ•°ä¼šè¢«å¤„ç†ä¸ºå ä½ç¬¦?</li>
<li>å¯ä»¥é˜²æ­¢SQLæ³¨å…¥</li>
<li>ä¼šè¿›è¡Œç±»å‹è½¬æ¢</li>
<li>é€‚ç”¨äºå‚æ•°å€¼ä¼ é€’</li>
</ul>
<p><strong>${}ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰ï¼š</strong></p>
<ul>
<li>å­—ç¬¦ä¸²æ›¿æ¢ï¼Œç›´æ¥æ‹¼æ¥åˆ°SQLä¸­</li>
<li>ä¸ä¼šè¿›è¡Œé¢„ç¼–è¯‘</li>
<li>å­˜åœ¨SQLæ³¨å…¥é£é™©</li>
<li>ä¸ä¼šè¿›è¡Œç±»å‹è½¬æ¢</li>
<li>é€‚ç”¨äºåŠ¨æ€è¡¨åã€åˆ—åç­‰åœºæ™¯</li>
</ul>
<p><strong>Q5: MyBatisçš„åŠ¨æ€SQLæ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</strong></p>
<p>A: MyBatisçš„åŠ¨æ€SQLé€šè¿‡ä»¥ä¸‹æ ‡ç­¾å®ç°ï¼š</p>
<ol>
<li><strong>ifæ ‡ç­¾</strong>: æ¡ä»¶åˆ¤æ–­</li>
<li><strong>choose&#x2F;when&#x2F;otherwise</strong>: ç±»ä¼¼switch-case</li>
<li><strong>whereæ ‡ç­¾</strong>: æ™ºèƒ½å¤„ç†WHEREæ¡ä»¶</li>
<li><strong>setæ ‡ç­¾</strong>: æ™ºèƒ½å¤„ç†SETè¯­å¥</li>
<li><strong>foreachæ ‡ç­¾</strong>: å¾ªç¯å¤„ç†</li>
<li><strong>trimæ ‡ç­¾</strong>: å»é™¤å¤šä½™çš„å­—ç¬¦</li>
</ol>
<p>å®ç°åŸç†ï¼š</p>
<ul>
<li>ä½¿ç”¨OGNLè¡¨è¾¾å¼è¿›è¡Œæ¡ä»¶åˆ¤æ–­</li>
<li>åœ¨SQLè§£æé˜¶æ®µæ ¹æ®å‚æ•°å€¼åŠ¨æ€ç”ŸæˆSQL</li>
<li>é€šè¿‡SqlNodeæ ‘ç»“æ„è¡¨ç¤ºåŠ¨æ€SQL</li>
<li>åœ¨æ‰§è¡Œæ—¶éå†SqlNodeæ ‘ç”Ÿæˆæœ€ç»ˆSQL</li>
</ul>
<h2 id="äº”ã€æ¡†æ¶æ•´åˆä¸æœ€ä½³å®è·µ"><a href="#äº”ã€æ¡†æ¶æ•´åˆä¸æœ€ä½³å®è·µ" class="headerlink" title="äº”ã€æ¡†æ¶æ•´åˆä¸æœ€ä½³å®è·µ"></a>äº”ã€æ¡†æ¶æ•´åˆä¸æœ€ä½³å®è·µ</h2><h3 id="5-1-Spring-Boot-MyBatisæ•´åˆ"><a href="#5-1-Spring-Boot-MyBatisæ•´åˆ" class="headerlink" title="5.1 Spring Boot + MyBatisæ•´åˆ"></a>5.1 Spring Boot + MyBatisæ•´åˆ</h3><h4 id="å®Œæ•´é…ç½®ç¤ºä¾‹"><a href="#å®Œæ•´é…ç½®ç¤ºä¾‹" class="headerlink" title="å®Œæ•´é…ç½®ç¤ºä¾‹"></a>å®Œæ•´é…ç½®ç¤ºä¾‹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸»å¯åŠ¨ç±»</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.example.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ•°æ®æºé…ç½®</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(&quot;spring.datasource.primary&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DataSourceProperties <span class="title function_">primaryDataSourceProperties</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DataSourceProperties</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">primaryDataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> primaryDataSourceProperties()</span><br><span class="line">                .initializeDataSourceBuilder()</span><br><span class="line">                .type(HikariDataSource.class)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SqlSessionFactory <span class="title function_">sqlSessionFactory</span><span class="params">(DataSource dataSource)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">SqlSessionFactoryBean</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBean</span>();</span><br><span class="line">        factory.setDataSource(dataSource);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// MyBatisé…ç½®</span></span><br><span class="line">        org.apache.ibatis.session.<span class="type">Configuration</span> <span class="variable">config</span> <span class="operator">=</span> </span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">org</span>.apache.ibatis.session.Configuration();</span><br><span class="line">        config.setMapUnderscoreToCamelCase(<span class="literal">true</span>);</span><br><span class="line">        config.setLogImpl(Slf4jImpl.class);</span><br><span class="line">        config.setCacheEnabled(<span class="literal">true</span>);</span><br><span class="line">        config.setLazyLoadingEnabled(<span class="literal">true</span>);</span><br><span class="line">        config.setAggressiveLazyLoading(<span class="literal">false</span>);</span><br><span class="line">        </span><br><span class="line">        factory.setConfiguration(config);</span><br><span class="line">        <span class="keyword">return</span> factory.getObject();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="äº‹åŠ¡ç®¡ç†é…ç½®"><a href="#äº‹åŠ¡ç®¡ç†é…ç½®" class="headerlink" title="äº‹åŠ¡ç®¡ç†é…ç½®"></a>äº‹åŠ¡ç®¡ç†é…ç½®</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderMapper orderMapper;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderItemMapper orderItemMapper;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ProductMapper productMapper;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> Order <span class="title function_">createOrder</span><span class="params">(CreateOrderRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. åˆ›å»ºè®¢å•</span></span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Order</span>();</span><br><span class="line">        order.setUserId(request.getUserId());</span><br><span class="line">        order.setStatus(<span class="string">&quot;PENDING&quot;</span>);</span><br><span class="line">        order.setCreateTime(LocalDateTime.now());</span><br><span class="line">        orderMapper.insert(order);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. åˆ›å»ºè®¢å•é¡¹</span></span><br><span class="line">        <span class="type">BigDecimal</span> <span class="variable">totalAmount</span> <span class="operator">=</span> BigDecimal.ZERO;</span><br><span class="line">        List&lt;OrderItem&gt; orderItems = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (CreateOrderItemRequest itemRequest : request.getItems()) &#123;</span><br><span class="line">            <span class="comment">// æ£€æŸ¥åº“å­˜</span></span><br><span class="line">            <span class="type">Product</span> <span class="variable">product</span> <span class="operator">=</span> productMapper.findById(itemRequest.getProductId());</span><br><span class="line">            <span class="keyword">if</span> (product == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ProductNotFoundException</span>(<span class="string">&quot;Product not found: &quot;</span> + itemRequest.getProductId());</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (product.getStock() &lt; itemRequest.getQuantity()) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InsufficientStockException</span>(<span class="string">&quot;Insufficient stock for product: &quot;</span> + product.getName());</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// å‡åº“å­˜</span></span><br><span class="line">            productMapper.decreaseStock(itemRequest.getProductId(), itemRequest.getQuantity());</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// åˆ›å»ºè®¢å•é¡¹</span></span><br><span class="line">            <span class="type">OrderItem</span> <span class="variable">orderItem</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderItem</span>();</span><br><span class="line">            orderItem.setOrderId(order.getId());</span><br><span class="line">            orderItem.setProductId(itemRequest.getProductId());</span><br><span class="line">            orderItem.setQuantity(itemRequest.getQuantity());</span><br><span class="line">            orderItem.setPrice(product.getPrice());</span><br><span class="line">            orderItems.add(orderItem);</span><br><span class="line">            </span><br><span class="line">            totalAmount = totalAmount.add(</span><br><span class="line">                product.getPrice().multiply(BigDecimal.valueOf(itemRequest.getQuantity()))</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. æ‰¹é‡æ’å…¥è®¢å•é¡¹</span></span><br><span class="line">        <span class="keyword">if</span> (!orderItems.isEmpty()) &#123;</span><br><span class="line">            orderItemMapper.batchInsert(orderItems);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 4. æ›´æ–°è®¢å•æ€»é‡‘é¢</span></span><br><span class="line">        order.setTotalAmount(totalAmount);</span><br><span class="line">        orderMapper.updateAmount(order.getId(), totalAmount);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> order;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Transactional(readOnly = true)</span></span><br><span class="line">    <span class="keyword">public</span> OrderDetailVO <span class="title function_">getOrderDetail</span><span class="params">(Long orderId)</span> &#123;</span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> orderMapper.findById(orderId);</span><br><span class="line">        <span class="keyword">if</span> (order == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OrderNotFoundException</span>(<span class="string">&quot;Order not found: &quot;</span> + orderId);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        List&lt;OrderItem&gt; orderItems = orderItemMapper.findByOrderId(orderId);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> OrderDetailVO.builder()</span><br><span class="line">                .order(order)</span><br><span class="line">                .items(orderItems)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-2-ç»Ÿä¸€å¼‚å¸¸å¤„ç†"><a href="#5-2-ç»Ÿä¸€å¼‚å¸¸å¤„ç†" class="headerlink" title="5.2 ç»Ÿä¸€å¼‚å¸¸å¤„ç†"></a>5.2 ç»Ÿä¸€å¼‚å¸¸å¤„ç†</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ExceptionHandler(ValidationException.class)</span></span><br><span class="line">    <span class="meta">@ResponseStatus(HttpStatus.BAD_REQUEST)</span></span><br><span class="line">    <span class="keyword">public</span> ApiResponse&lt;Void&gt; <span class="title function_">handleValidationException</span><span class="params">(ValidationException e)</span> &#123;</span><br><span class="line">        log.warn(<span class="string">&quot;Validation error: &#123;&#125;&quot;</span>, e.getMessage());</span><br><span class="line">        <span class="keyword">return</span> ApiResponse.error(<span class="string">&quot;VALIDATION_ERROR&quot;</span>, e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ExceptionHandler(MethodArgumentNotValidException.class)</span></span><br><span class="line">    <span class="meta">@ResponseStatus(HttpStatus.BAD_REQUEST)</span></span><br><span class="line">    <span class="keyword">public</span> ApiResponse&lt;Void&gt; <span class="title function_">handleMethodArgumentNotValid</span><span class="params">(MethodArgumentNotValidException e)</span> &#123;</span><br><span class="line">        List&lt;String&gt; errors = e.getBindingResult()</span><br><span class="line">                .getFieldErrors()</span><br><span class="line">                .stream()</span><br><span class="line">                .map(error -&gt; error.getField() + <span class="string">&quot;: &quot;</span> + error.getDefaultMessage())</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ApiResponse.error(<span class="string">&quot;VALIDATION_ERROR&quot;</span>, String.join(<span class="string">&quot;, &quot;</span>, errors));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ExceptionHandler(DataIntegrityViolationException.class)</span></span><br><span class="line">    <span class="meta">@ResponseStatus(HttpStatus.CONFLICT)</span></span><br><span class="line">    <span class="keyword">public</span> ApiResponse&lt;Void&gt; <span class="title function_">handleDataIntegrityViolation</span><span class="params">(DataIntegrityViolationException e)</span> &#123;</span><br><span class="line">        log.error(<span class="string">&quot;Data integrity violation&quot;</span>, e);</span><br><span class="line">        <span class="keyword">return</span> ApiResponse.error(<span class="string">&quot;DATA_CONFLICT&quot;</span>, <span class="string">&quot;Data conflict occurred&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ExceptionHandler(OptimisticLockingFailureException.class)</span></span><br><span class="line">    <span class="meta">@ResponseStatus(HttpStatus.CONFLICT)</span></span><br><span class="line">    <span class="keyword">public</span> ApiResponse&lt;Void&gt; <span class="title function_">handleOptimisticLockingFailure</span><span class="params">(OptimisticLockingFailureException e)</span> &#123;</span><br><span class="line">        log.warn(<span class="string">&quot;Optimistic locking failure: &#123;&#125;&quot;</span>, e.getMessage());</span><br><span class="line">        <span class="keyword">return</span> ApiResponse.error(<span class="string">&quot;OPTIMISTIC_LOCK_ERROR&quot;</span>, <span class="string">&quot;Resource has been modified by another user&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line">    <span class="meta">@ResponseStatus(HttpStatus.INTERNAL_SERVER_ERROR)</span></span><br><span class="line">    <span class="keyword">public</span> ApiResponse&lt;Void&gt; <span class="title function_">handleGenericException</span><span class="params">(Exception e)</span> &#123;</span><br><span class="line">        log.error(<span class="string">&quot;Unexpected error occurred&quot;</span>, e);</span><br><span class="line">        <span class="keyword">return</span> ApiResponse.error(<span class="string">&quot;INTERNAL_ERROR&quot;</span>, <span class="string">&quot;An unexpected error occurred&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-3-æ¥å£æ–‡æ¡£ä¸éªŒè¯"><a href="#5-3-æ¥å£æ–‡æ¡£ä¸éªŒè¯" class="headerlink" title="5.3 æ¥å£æ–‡æ¡£ä¸éªŒè¯"></a>5.3 æ¥å£æ–‡æ¡£ä¸éªŒè¯</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç»Ÿä¸€å“åº”æ ¼å¼</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApiResponse</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> success;</span><br><span class="line">    <span class="keyword">private</span> String code;</span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line">    <span class="keyword">private</span> T data;</span><br><span class="line">    <span class="keyword">private</span> Long timestamp;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; ApiResponse&lt;T&gt; <span class="title function_">success</span><span class="params">(T data)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ApiResponse.&lt;T&gt;builder()</span><br><span class="line">                .success(<span class="literal">true</span>)</span><br><span class="line">                .code(<span class="string">&quot;SUCCESS&quot;</span>)</span><br><span class="line">                .data(data)</span><br><span class="line">                .timestamp(System.currentTimeMillis())</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; ApiResponse&lt;T&gt; <span class="title function_">error</span><span class="params">(String code, String message)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ApiResponse.&lt;T&gt;builder()</span><br><span class="line">                .success(<span class="literal">false</span>)</span><br><span class="line">                .code(code)</span><br><span class="line">                .message(message)</span><br><span class="line">                .timestamp(System.currentTimeMillis())</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯·æ±‚å‚æ•°éªŒè¯</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Valid</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CreateUserRequest</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;ç”¨æˆ·åä¸èƒ½ä¸ºç©º&quot;)</span></span><br><span class="line">    <span class="meta">@Size(min = 2, max = 20, message = &quot;ç”¨æˆ·åé•¿åº¦å¿…é¡»åœ¨2-20ä¸ªå­—ç¬¦ä¹‹é—´&quot;)</span></span><br><span class="line">    <span class="meta">@Pattern(regexp = &quot;^[a-zA-Z0-9_\\u4e00-\\u9fa5]+$&quot;, message = &quot;ç”¨æˆ·ååªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿å’Œä¸­æ–‡&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;é‚®ç®±ä¸èƒ½ä¸ºç©º&quot;)</span></span><br><span class="line">    <span class="meta">@Email(message = &quot;é‚®ç®±æ ¼å¼ä¸æ­£ç¡®&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;å¯†ç ä¸èƒ½ä¸ºç©º&quot;)</span></span><br><span class="line">    <span class="meta">@Size(min = 8, max = 20, message = &quot;å¯†ç é•¿åº¦å¿…é¡»åœ¨8-20ä¸ªå­—ç¬¦ä¹‹é—´&quot;)</span></span><br><span class="line">    <span class="meta">@Pattern(</span></span><br><span class="line"><span class="meta">        regexp = &quot;^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[@$!%*?&amp;])[A-Za-z\\d@$!%*?&amp;]+$&quot;,</span></span><br><span class="line"><span class="meta">        message = &quot;å¯†ç å¿…é¡»åŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šå­—ç¬¦&quot;</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotNull(message = &quot;å¹´é¾„ä¸èƒ½ä¸ºç©º&quot;)</span></span><br><span class="line">    <span class="meta">@Min(value = 1, message = &quot;å¹´é¾„å¿…é¡»å¤§äº0&quot;)</span></span><br><span class="line">    <span class="meta">@Max(value = 150, message = &quot;å¹´é¾„ä¸èƒ½è¶…è¿‡150&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotEmpty(message = &quot;è§’è‰²ä¸èƒ½ä¸ºç©º&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;<span class="meta">@NotBlank(message = &quot;è§’è‰²åç§°ä¸èƒ½ä¸ºç©º&quot;)</span> String&gt; roles;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-4-æ€§èƒ½ç›‘æ§ä¸ä¼˜åŒ–"><a href="#5-4-æ€§èƒ½ç›‘æ§ä¸ä¼˜åŒ–" class="headerlink" title="5.4 æ€§èƒ½ç›‘æ§ä¸ä¼˜åŒ–"></a>5.4 æ€§èƒ½ç›‘æ§ä¸ä¼˜åŒ–</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ€§èƒ½ç›‘æ§åˆ‡é¢</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PerformanceMonitorAspect</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Around(&quot;@annotation(org.springframework.web.bind.annotation.RequestMapping) || &quot; +</span></span><br><span class="line"><span class="meta">            &quot;@annotation(org.springframework.web.bind.annotation.GetMapping) || &quot; +</span></span><br><span class="line"><span class="meta">            &quot;@annotation(org.springframework.web.bind.annotation.PostMapping) || &quot; +</span></span><br><span class="line"><span class="meta">            &quot;@annotation(org.springframework.web.bind.annotation.PutMapping) || &quot; +</span></span><br><span class="line"><span class="meta">            &quot;@annotation(org.springframework.web.bind.annotation.DeleteMapping)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">monitorPerformance</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> joinPoint.getSignature().toShortString();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> joinPoint.proceed();</span><br><span class="line">            <span class="type">long</span> <span class="variable">endTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">            <span class="type">long</span> <span class="variable">executionTime</span> <span class="operator">=</span> endTime - startTime;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (executionTime &gt; <span class="number">1000</span>) &#123; <span class="comment">// è¶…è¿‡1ç§’è®°å½•è­¦å‘Š</span></span><br><span class="line">                log.warn(<span class="string">&quot;Slow API detected: &#123;&#125; took &#123;&#125;ms&quot;</span>, methodName, executionTime);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                log.info(<span class="string">&quot;API performance: &#123;&#125; took &#123;&#125;ms&quot;</span>, methodName, executionTime);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">endTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">            log.error(<span class="string">&quot;API error: &#123;&#125; took &#123;&#125;ms, error: &#123;&#125;&quot;</span>, </span><br><span class="line">                     methodName, endTime - startTime, e.getMessage());</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ•°æ®åº“è¿æ¥æ± ç›‘æ§</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceHealthIndicator</span> <span class="keyword">implements</span> <span class="title class_">HealthIndicator</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DataSource dataSource;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Health <span class="title function_">health</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (dataSource <span class="keyword">instanceof</span> HikariDataSource) &#123;</span><br><span class="line">                <span class="type">HikariDataSource</span> <span class="variable">hikariDataSource</span> <span class="operator">=</span> (HikariDataSource) dataSource;</span><br><span class="line">                <span class="type">HikariPoolMXBean</span> <span class="variable">poolBean</span> <span class="operator">=</span> hikariDataSource.getHikariPoolMXBean();</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">return</span> Health.up()</span><br><span class="line">                        .withDetail(<span class="string">&quot;database&quot;</span>, <span class="string">&quot;MySQL&quot;</span>)</span><br><span class="line">                        .withDetail(<span class="string">&quot;activeConnections&quot;</span>, poolBean.getActiveConnections())</span><br><span class="line">                        .withDetail(<span class="string">&quot;idleConnections&quot;</span>, poolBean.getIdleConnections())</span><br><span class="line">                        .withDetail(<span class="string">&quot;totalConnections&quot;</span>, poolBean.getTotalConnections())</span><br><span class="line">                        .withDetail(<span class="string">&quot;threadsAwaitingConnection&quot;</span>, poolBean.getThreadsAwaitingConnection())</span><br><span class="line">                        .build();</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">try</span> (<span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> dataSource.getConnection()) &#123;</span><br><span class="line">                <span class="keyword">return</span> Health.up()</span><br><span class="line">                        .withDetail(<span class="string">&quot;database&quot;</span>, connection.getMetaData().getDatabaseProductName())</span><br><span class="line">                        .build();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> Health.down()</span><br><span class="line">                    .withDetail(<span class="string">&quot;error&quot;</span>, e.getMessage())</span><br><span class="line">                    .build();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-5-é«˜é¢‘é¢è¯•ç»¼åˆé¢˜"><a href="#5-5-é«˜é¢‘é¢è¯•ç»¼åˆé¢˜" class="headerlink" title="5.5 é«˜é¢‘é¢è¯•ç»¼åˆé¢˜"></a>5.5 é«˜é¢‘é¢è¯•ç»¼åˆé¢˜</h3><p><strong>Q1: åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œå¦‚ä½•è®¾è®¡ä¸€ä¸ªé«˜å¹¶å‘çš„è®¢å•ç³»ç»Ÿï¼Ÿ</strong></p>
<p>A: è®¾è®¡é«˜å¹¶å‘è®¢å•ç³»ç»Ÿéœ€è¦è€ƒè™‘ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p>
<p><strong>1. æ¶æ„è®¾è®¡ï¼š</strong></p>
<ul>
<li>ä½¿ç”¨åˆ†å¸ƒå¼æ¶æ„ï¼Œè®¢å•æœåŠ¡ã€åº“å­˜æœåŠ¡ã€æ”¯ä»˜æœåŠ¡åˆ†ç¦»</li>
<li>å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—å¤„ç†å¼‚æ­¥ä»»åŠ¡</li>
<li>ä½¿ç”¨Redisåšç¼“å­˜å’Œåˆ†å¸ƒå¼é”</li>
<li>æ•°æ®åº“è¯»å†™åˆ†ç¦»ï¼Œåˆ†åº“åˆ†è¡¨</li>
</ul>
<p><strong>2. å¹¶å‘æ§åˆ¶ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, String&gt; redisTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> Order <span class="title function_">createOrder</span><span class="params">(CreateOrderRequest request)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">lockKey</span> <span class="operator">=</span> <span class="string">&quot;order:lock:&quot;</span> + request.getUserId();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// åˆ†å¸ƒå¼é”é˜²æ­¢é‡å¤ä¸‹å•</span></span><br><span class="line">        <span class="type">Boolean</span> <span class="variable">locked</span> <span class="operator">=</span> redisTemplate.opsForValue()</span><br><span class="line">            .setIfAbsent(lockKey, <span class="string">&quot;1&quot;</span>, Duration.ofSeconds(<span class="number">30</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!locked) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OrderCreationException</span>(<span class="string">&quot;Order creation in progress&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// è®¢å•åˆ›å»ºé€»è¾‘</span></span><br><span class="line">            <span class="keyword">return</span> processOrder(request);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            redisTemplate.delete(lockKey);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>3. æ€§èƒ½ä¼˜åŒ–ï¼š</strong></p>
<ul>
<li>ä½¿ç”¨æ‰¹é‡æ“ä½œå‡å°‘æ•°æ®åº“äº¤äº’</li>
<li>åˆç†ä½¿ç”¨ç¼“å­˜ç­–ç•¥</li>
<li>å¼‚æ­¥å¤„ç†éæ ¸å¿ƒä¸šåŠ¡é€»è¾‘</li>
<li>æ•°æ®åº“è¿æ¥æ± ä¼˜åŒ–</li>
</ul>
<p><strong>Q2: å¦‚ä½•å¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡ï¼Ÿ</strong></p>
<p>A: åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†æ–¹æ¡ˆï¼š</p>
<p><strong>1. 2PC&#x2F;3PCåè®®ï¼š</strong></p>
<ul>
<li>å¼ºä¸€è‡´æ€§ï¼Œä½†æ€§èƒ½è¾ƒå·®</li>
<li>é€‚ç”¨äºå¯¹ä¸€è‡´æ€§è¦æ±‚æé«˜çš„åœºæ™¯</li>
</ul>
<p><strong>2. TCCæ¨¡å¼ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TccTransaction</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderTccService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">tryCreateOrder</span><span class="params">(CreateOrderRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// Tryé˜¶æ®µï¼šé¢„ç•™èµ„æº</span></span><br><span class="line">        orderService.reserveOrder(request);</span><br><span class="line">        stockService.reserveStock(request.getItems());</span><br><span class="line">        paymentService.reservePayment(request.getPaymentInfo());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">confirmCreateOrder</span><span class="params">(CreateOrderRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// Confirmé˜¶æ®µï¼šç¡®è®¤æ“ä½œ</span></span><br><span class="line">        orderService.confirmOrder(request);</span><br><span class="line">        stockService.confirmStock(request.getItems());</span><br><span class="line">        paymentService.confirmPayment(request.getPaymentInfo());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cancelCreateOrder</span><span class="params">(CreateOrderRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// Cancelé˜¶æ®µï¼šå›æ»šæ“ä½œ</span></span><br><span class="line">        orderService.cancelOrder(request);</span><br><span class="line">        stockService.cancelStock(request.getItems());</span><br><span class="line">        paymentService.cancelPayment(request.getPaymentInfo());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>3. æ¶ˆæ¯é˜Ÿåˆ—æœ€ç»ˆä¸€è‡´æ€§ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderEventService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="meta">@Async</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleOrderCreated</span><span class="params">(OrderCreatedEvent event)</span> &#123;</span><br><span class="line">        <span class="comment">// å¼‚æ­¥å¤„ç†è®¢å•ç›¸å…³ä¸šåŠ¡</span></span><br><span class="line">        notificationService.sendOrderNotification(event.getOrder());</span><br><span class="line">        inventoryService.updateInventory(event.getOrderItems());</span><br><span class="line">        pointsService.addPoints(event.getUserId(), event.getAmount());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Q3: Spring Bootåº”ç”¨å¦‚ä½•ä¼˜åŒ–å¯åŠ¨é€Ÿåº¦ï¼Ÿ</strong></p>
<p>A: Spring Bootå¯åŠ¨ä¼˜åŒ–ç­–ç•¥ï¼š</p>
<p><strong>1. ä¾èµ–ä¼˜åŒ–ï¼š</strong></p>
<ul>
<li>ç§»é™¤ä¸å¿…è¦çš„ä¾èµ–</li>
<li>ä½¿ç”¨spring-boot-starter-webæ›¿ä»£å®Œæ•´çš„spring-web</li>
<li>é¿å…å¼•å…¥å¤§é‡è‡ªåŠ¨é…ç½®ç±»</li>
</ul>
<p><strong>2. é…ç½®ä¼˜åŒ–ï¼š</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">main:</span></span><br><span class="line">    <span class="attr">lazy-initialization:</span> <span class="literal">true</span>  <span class="comment"># å¯ç”¨æ‡’åŠ è½½</span></span><br><span class="line">  <span class="attr">jpa:</span></span><br><span class="line">    <span class="attr">hibernate:</span></span><br><span class="line">      <span class="attr">ddl-auto:</span> <span class="string">none</span>           <span class="comment"># ç¦ç”¨DDLè‡ªåŠ¨ç”Ÿæˆ</span></span><br><span class="line">    <span class="attr">show-sql:</span> <span class="literal">false</span>            <span class="comment"># ç¦ç”¨SQLæ—¥å¿—</span></span><br><span class="line">  <span class="attr">devtools:</span></span><br><span class="line">    <span class="attr">restart:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">false</span>           <span class="comment"># ç”Ÿäº§ç¯å¢ƒç¦ç”¨çƒ­é‡å¯</span></span><br></pre></td></tr></table></figure>

<p><strong>3. JVMä¼˜åŒ–ï¼š</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">java -XX:+UnlockExperimentalVMOptions </span><br><span class="line">     -XX:+UseZGC </span><br><span class="line">     -XX:+UseTransparentHugePages</span><br><span class="line">     -XX:MaxMetaspaceSize=256m</span><br><span class="line">     -Xms512m -Xmx1024m</span><br><span class="line">     -jar application.jar</span><br></pre></td></tr></table></figure>

<p><strong>4. ä»£ç ä¼˜åŒ–ï¼š</strong></p>
<ul>
<li>ä½¿ç”¨@Lazyæ³¨è§£å»¶è¿ŸBeanåˆå§‹åŒ–</li>
<li>é¿å…åœ¨@PostConstructä¸­æ‰§è¡Œè€—æ—¶æ“ä½œ</li>
<li>åˆç†ä½¿ç”¨@ConditionalOn*æ³¨è§£</li>
</ul>
<p>å¥½çš„ï¼Œè¿™æ˜¯ä¸€ä»½è¯¦ç»†çš„è§£é‡Šï¼Œæˆ‘ä»¬æ¥é€ä¸ªåˆ†æè¿™äº› Java è™šæ‹Ÿæœºï¼ˆJVMï¼‰å‚æ•°ï¼š</p>
<p>Bash</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -XX:+UnlockExperimentalVMOptions -XX:+UseZGC -XX:+UseTransparentHugePages -XX:MaxMetaspaceSize=256m -Xms512m -Xmx1024m -jar application.jar</span><br></pre></td></tr></table></figure>

<ul>
<li><code>java</code>: è¿™æ˜¯å¯åŠ¨ Java ç¨‹åºçš„å‘½ä»¤ã€‚</li>
</ul>
<hr>
<h3 id="å†…å­˜ç®¡ç†å’Œåƒåœ¾å›æ”¶"><a href="#å†…å­˜ç®¡ç†å’Œåƒåœ¾å›æ”¶" class="headerlink" title="å†…å­˜ç®¡ç†å’Œåƒåœ¾å›æ”¶"></a>å†…å­˜ç®¡ç†å’Œåƒåœ¾å›æ”¶</h3><p>è¿™éƒ¨åˆ†å‚æ•°ä¸»è¦ç”¨äºä¼˜åŒ– JVM çš„å†…å­˜ä½¿ç”¨å’Œåƒåœ¾å›æ”¶æœºåˆ¶ï¼Œä»¥è·å¾—æ›´å¥½çš„æ€§èƒ½ã€‚</p>
<ul>
<li><code>-XX:+UnlockExperimentalVMOptions</code>: è¿™ä¸ªå‚æ•°æ˜¯ç”¨æ¥<strong>è§£é”å®éªŒæ€§ï¼ˆexperimentalï¼‰çš„ JVM é€‰é¡¹</strong>ã€‚ZGC æ›¾ç»æ˜¯å®éªŒæ€§åŠŸèƒ½ï¼Œæ‰€ä»¥éœ€è¦è¿™ä¸ªå‚æ•°æ‰èƒ½ä½¿ç”¨ã€‚</li>
<li><code>-XX:+UseZGC</code>: è¿™æ¡å‘½ä»¤æ˜¯å¯ç”¨ <strong>Z åƒåœ¾å›æ”¶å™¨ï¼ˆZ Garbage Collectorï¼‰</strong>ã€‚ZGC æ˜¯ä¸€ç§ä¸º<strong>è¶…å¤§å †å†…å­˜</strong>ï¼ˆä»å‡ GBåˆ°å‡ åTBï¼‰è®¾è®¡çš„ã€<strong>ä½å»¶è¿Ÿ</strong>çš„åƒåœ¾å›æ”¶å™¨ã€‚å®ƒçš„ä¸»è¦ç›®æ ‡æ˜¯åœ¨åƒåœ¾å›æ”¶æ—¶ï¼Œå°½é‡å‡å°‘åº”ç”¨ç¨‹åºçš„åœé¡¿æ—¶é—´ï¼Œè¿™å¯¹äºéœ€è¦æä½å»¶è¿Ÿçš„åº”ç”¨ç¨‹åºéå¸¸é‡è¦ã€‚</li>
<li><code>-XX:+UseTransparentHugePages</code>: è¿™ä¸ªå‚æ•°å¼€å¯äº†<strong>é€æ˜å¤§é¡µï¼ˆTransparent Huge Pagesï¼‰çš„æ”¯æŒã€‚åœ¨æ“ä½œç³»ç»Ÿå±‚é¢ï¼Œé€šå¸¸å†…å­˜æ˜¯ä»¥ 4KB çš„å°é¡µæ¥ç®¡ç†çš„ã€‚è€Œå¤§é¡µï¼ˆé€šå¸¸æ˜¯ 2MB æˆ– 1GBï¼‰å¯ä»¥å‡å°‘ CPU åœ¨å†…å­˜ç®¡ç†ä¸Šçš„å¼€é”€ï¼Œä»è€Œæå‡æ€§èƒ½ï¼Œå°¤å…¶å¯¹äºå†…å­˜å ç”¨è¾ƒå¤§</strong>çš„åº”ç”¨æ•ˆæœæ›´æ˜æ˜¾ã€‚</li>
<li><code>-XX:MaxMetaspaceSize=256m</code>: è¿™ä¸ªå‚æ•°è®¾ç½®äº†<strong>å…ƒç©ºé—´ï¼ˆMetaspaceï¼‰çš„æœ€å¤§å¤§å°ä¸º 256MB</strong>ã€‚å…ƒç©ºé—´æ˜¯ JVM å­˜å‚¨ç±»çš„å…ƒæ•°æ®ï¼ˆå¦‚ç±»çš„åç§°ã€æ–¹æ³•ã€å­—æ®µç­‰ä¿¡æ¯ï¼‰çš„åœ°æ–¹ã€‚åœ¨ Java 8 ä¹‹åï¼Œå®ƒå–ä»£äº†ä¹‹å‰çš„â€œæ°¸ä¹…ä»£â€ï¼ˆPermGenï¼‰ã€‚</li>
<li><code>-Xms512m</code>: è¿™æ¡å‘½ä»¤è®¾å®šäº† <strong>JVM å †çš„åˆå§‹å†…å­˜ä¸º 512MB</strong>ã€‚å †æ˜¯ç”¨æ¥å­˜æ”¾ Java å¯¹è±¡çš„åœ°æ–¹ã€‚<code>-Xms</code> å†³å®šäº† JVM å¯åŠ¨æ—¶ä¼šç”³è¯·çš„æœ€å°å†…å­˜ã€‚</li>
<li><code>-Xmx1024m</code>: è¿™æ¡å‘½ä»¤è®¾å®šäº† <strong>JVM å †çš„æœ€å¤§å†…å­˜ä¸º 1024MBï¼ˆå³ 1GBï¼‰</strong>ã€‚è¿™æ˜¯ JVM è¿è¡Œæ—¶å¯ä»¥ä½¿ç”¨çš„æœ€å¤§å†…å­˜ã€‚å½“å †å†…å­˜ç”¨å°½æ—¶ï¼ŒJVM ä¼šè§¦å‘åƒåœ¾å›æ”¶ï¼Œå¦‚æœä¾ç„¶ä¸è¶³ï¼Œå°±ä¼šæŠ›å‡º <code>OutOfMemoryError</code>ã€‚</li>
</ul>
<hr>
<p>å¥½çš„ï¼Œæˆ‘ä»¬æ¥æ›´è¯¦ç»†åœ°èŠèŠ JVM å †å†…å­˜çš„ç»“æ„ï¼Œç‰¹åˆ«æ˜¯åˆ†ä»£è®¾è®¡å’Œå…·ä½“çš„åˆ’åˆ†æ¯”ä¾‹ã€‚</p>
<hr>
<h3 id="å †å†…å­˜çš„ä¼ ç»Ÿåˆ†ä»£ç»“æ„"><a href="#å †å†…å­˜çš„ä¼ ç»Ÿåˆ†ä»£ç»“æ„" class="headerlink" title="å †å†…å­˜çš„ä¼ ç»Ÿåˆ†ä»£ç»“æ„"></a>å †å†…å­˜çš„ä¼ ç»Ÿåˆ†ä»£ç»“æ„</h3><p>åœ¨ç»å¤§å¤šæ•°çš„åƒåœ¾å›æ”¶å™¨ä¸­ï¼ˆä¾‹å¦‚ CMSã€G1 ä¹‹å‰çš„ä¸²è¡Œå’Œå¹¶è¡Œ GCï¼‰ï¼Œå †å†…å­˜è¢«åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªä»£ï¼ˆGenerationï¼‰ï¼š</p>
<h4 id="1-å¹´è½»ä»£ï¼ˆYoung-Generationï¼‰"><a href="#1-å¹´è½»ä»£ï¼ˆYoung-Generationï¼‰" class="headerlink" title="1. å¹´è½»ä»£ï¼ˆYoung Generationï¼‰"></a>1. å¹´è½»ä»£ï¼ˆYoung Generationï¼‰</h4><p><strong>å¹´è½»ä»£æ˜¯æ–°å¯¹è±¡çš„è¯ç”Ÿåœ°ã€‚</strong> ç»å¤§å¤šæ•°å¯¹è±¡ï¼Œæ¯”å¦‚å±€éƒ¨å˜é‡åˆ›å»ºçš„ä¸´æ—¶å¯¹è±¡ï¼Œéƒ½ä¼šåœ¨å¹´è½»ä»£è¢«åˆ›å»ºã€‚å¹´è½»ä»£è¢«è®¾è®¡æˆè¾ƒå°ä¸”åƒåœ¾å›æ”¶é¢‘ç‡é«˜çš„åŒºåŸŸã€‚</p>
<ul>
<li><strong>Eden åŒº</strong>ï¼šè¿™æ˜¯å¹´è½»ä»£çš„ä¸»è¦éƒ¨åˆ†ï¼Œæ–°åˆ›å»ºçš„å¯¹è±¡é¦–å…ˆè¢«åˆ†é…åˆ°è¿™é‡Œã€‚</li>
<li><strong>Survivor åŒºï¼ˆå¹¸å­˜è€…åŒºï¼‰</strong>ï¼šæœ‰ä¸¤ä¸ªå¤§å°ç›¸ç­‰çš„ Survivor åŒºï¼Œé€šå¸¸å‘½åä¸º <strong>S0</strong> å’Œ <strong>S1</strong>ã€‚å®ƒä»¬çš„ä½œç”¨æ˜¯ä¿å­˜æ¯æ¬¡åƒåœ¾å›æ”¶åï¼Œè¿˜å­˜æ´»çš„å¯¹è±¡ã€‚</li>
</ul>
<p><strong>åˆ’åˆ†æ¯”ä¾‹</strong></p>
<p>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå¹´è½»ä»£å†…éƒ¨çš„åˆ’åˆ†æ¯”ä¾‹é€šå¸¸æ˜¯ï¼š</p>
<ul>
<li><strong>Eden åŒº : S0 åŒº : S1 åŒº &#x3D; 8 : 1 : 1</strong></li>
</ul>
<p>è¿™ä¸ªæ¯”ä¾‹å¯ä»¥é€šè¿‡ JVM å‚æ•°è¿›è¡Œè°ƒæ•´ï¼Œæ¯”å¦‚ä½¿ç”¨ <code>-XX:SurvivorRatio=8</code>ã€‚è¿™æ„å‘³ç€ Eden åŒºçš„å¤§å°æ˜¯å•ä¸ª Survivor åŒºçš„ 8 å€ã€‚</p>
<h4 id="2-è€å¹´ä»£ï¼ˆOld-Generationï¼‰"><a href="#2-è€å¹´ä»£ï¼ˆOld-Generationï¼‰" class="headerlink" title="2. è€å¹´ä»£ï¼ˆOld Generationï¼‰"></a>2. è€å¹´ä»£ï¼ˆOld Generationï¼‰</h4><p><strong>è€å¹´ä»£ç”¨äºå­˜æ”¾ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„å¯¹è±¡ã€‚</strong> å½“ä¸€ä¸ªå¯¹è±¡åœ¨å¹´è½»ä»£ç»è¿‡å¤šæ¬¡åƒåœ¾å›æ”¶ï¼ˆé€šå¸¸æ˜¯ 15 æ¬¡ï¼Œè¿™ä¸ªæ¬¡æ•°ä¹Ÿå¯ä»¥é€šè¿‡ <code>-XX:MaxTenuringThreshold</code> å‚æ•°è°ƒæ•´ï¼‰åä»ç„¶å­˜æ´»ï¼Œæˆ–è€…å¹´è½»ä»£æ”¾ä¸ä¸‹çš„å¤§å¯¹è±¡ï¼Œå°±ä¼šè¢«â€œæ™‹å‡â€åˆ°è€å¹´ä»£ã€‚</p>
<p>è€å¹´ä»£çš„åƒåœ¾å›æ”¶é¢‘ç‡è¿œä½äºå¹´è½»ä»£ï¼Œä½†æ¯æ¬¡å›æ”¶çš„å¼€é”€æ›´å¤§ã€‚</p>
<p><strong>åˆ’åˆ†æ¯”ä¾‹</strong></p>
<p>å †å†…å­˜ä¸­ï¼Œå¹´è½»ä»£å’Œè€å¹´ä»£çš„é»˜è®¤åˆ’åˆ†æ¯”ä¾‹é€šå¸¸æ˜¯ï¼š</p>
<ul>
<li><strong>å¹´è½»ä»£ : è€å¹´ä»£ &#x3D; 1 : 2</strong></li>
</ul>
<p>ä¾‹å¦‚ï¼Œå¦‚æœä½ è®¾ç½® <code>-Xms1200m -Xmx1200m</code>ï¼Œé‚£ä¹ˆå¹´è½»ä»£å¤§çº¦æ˜¯ 400MBï¼Œè€å¹´ä»£å¤§çº¦æ˜¯ 800MBã€‚è¿™ä¸ªæ¯”ä¾‹å¯ä»¥é€šè¿‡ <code>-XX:NewRatio</code> å‚æ•°æ¥è°ƒæ•´ã€‚ä¾‹å¦‚ï¼Œ<code>-XX:NewRatio=2</code> è¡¨ç¤ºè€å¹´ä»£ä¸å¹´è½»ä»£çš„å¤§å°æ¯”å€¼ä¸º 2:1ã€‚</p>
<hr>
<h3 id="åƒåœ¾å›æ”¶è¿‡ç¨‹ï¼ˆä»¥-Minor-GC-ä¸ºä¾‹ï¼‰"><a href="#åƒåœ¾å›æ”¶è¿‡ç¨‹ï¼ˆä»¥-Minor-GC-ä¸ºä¾‹ï¼‰" class="headerlink" title="åƒåœ¾å›æ”¶è¿‡ç¨‹ï¼ˆä»¥ Minor GC ä¸ºä¾‹ï¼‰"></a>åƒåœ¾å›æ”¶è¿‡ç¨‹ï¼ˆä»¥ Minor GC ä¸ºä¾‹ï¼‰</h3><p>ç†è§£äº†è¿™äº›åŒºåŸŸï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹åƒåœ¾å›æ”¶æ˜¯æ€ä¹ˆè¿›è¡Œçš„ï¼š</p>
<ol>
<li>å½“ <strong>Eden åŒº</strong>æ»¡äº†ï¼Œä¼šè§¦å‘ä¸€æ¬¡ <strong>Minor GC</strong>ã€‚</li>
<li>Minor GC ä¼šæ£€æŸ¥ Eden åŒºå’Œå…¶ä¸­ä¸€ä¸ª Survivor åŒºï¼ˆæ¯”å¦‚ S0ï¼‰ã€‚</li>
<li>å®ƒä¼šå°†æ‰€æœ‰è¿˜<strong>å­˜æ´»çš„å¯¹è±¡</strong>å¤åˆ¶åˆ°å¦ä¸€ä¸ªç©ºçš„ Survivor åŒºï¼ˆæ¯”å¦‚ S1ï¼‰ã€‚</li>
<li>åŒæ—¶ï¼Œé‚£äº›<strong>ä¸å†è¢«å¼•ç”¨çš„å¯¹è±¡</strong>åˆ™ä¼šè¢«æ¸…ç†ã€‚</li>
<li>æ‰€æœ‰è¢«å¤åˆ¶åˆ° S1 åŒºçš„å¯¹è±¡ï¼Œå®ƒä»¬çš„å¹´é¾„ï¼ˆ<code>age</code>ï¼‰ä¼šåŠ ä¸€ã€‚</li>
<li>ä¸‹ä¸€æ¬¡ Minor GC å‘ç”Ÿæ—¶ï¼ŒåŒæ ·ä¼šæ‰«æ Eden åŒºå’Œ S1 åŒºï¼Œå°†å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ° S0 åŒºï¼Œæ¸…ç©º Eden å’Œ S1 åŒºï¼Œå¹¶å¢åŠ å¯¹è±¡çš„å¹´é¾„ã€‚</li>
<li>å½“å¯¹è±¡çš„å¹´é¾„è¾¾åˆ°æŸä¸ªé˜ˆå€¼æ—¶ï¼Œå®ƒå°±ä¼šè¢«<strong>æ™‹å‡</strong>åˆ°è€å¹´ä»£ã€‚</li>
</ol>
<h3 id="ç°ä»£åƒåœ¾å›æ”¶å™¨ï¼ˆå¦‚-G1-å’Œ-ZGCï¼‰"><a href="#ç°ä»£åƒåœ¾å›æ”¶å™¨ï¼ˆå¦‚-G1-å’Œ-ZGCï¼‰" class="headerlink" title="ç°ä»£åƒåœ¾å›æ”¶å™¨ï¼ˆå¦‚ G1 å’Œ ZGCï¼‰"></a>ç°ä»£åƒåœ¾å›æ”¶å™¨ï¼ˆå¦‚ G1 å’Œ ZGCï¼‰</h3><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåƒ <strong>G1 åƒåœ¾å›æ”¶å™¨</strong>å·²ç»æ‰“ç ´äº†è¿™ç§ä¸¥æ ¼çš„åˆ†ä»£æ¯”ä¾‹ã€‚å®ƒå°†å †åˆ’åˆ†ä¸ºä¸€ä¸ªä¸ªå¤§å°ç›¸ç­‰çš„<strong>åŒºåŸŸï¼ˆRegionï¼‰</strong>ï¼Œæ¯ä¸ªåŒºåŸŸéƒ½å¯ä»¥æ˜¯ Edenã€Survivor æˆ–è€…è€å¹´ä»£ã€‚G1 èƒ½å¤Ÿæ›´æ™ºèƒ½åœ°é€‰æ‹©è¦å›æ”¶çš„åŒºåŸŸï¼Œä»è€Œåœ¨ä¿è¯ä½åœé¡¿çš„åŒæ—¶ï¼Œæé«˜ååé‡ã€‚</p>
<p>è€Œ <strong>ZGC</strong> åˆ™æ›´è¿›ä¸€æ­¥ï¼Œå¦‚æˆ‘ä¹‹å‰æ‰€è¯´ï¼Œå®ƒ<strong>å®Œå…¨æ²¡æœ‰å¹´è½»ä»£ã€è€å¹´ä»£çš„æ¦‚å¿µ</strong>ï¼Œè€Œæ˜¯é€šè¿‡ç€è‰²æŒ‡é’ˆå’Œè¯»å±éšœæŠ€æœ¯ï¼Œåœ¨ä¸ä¸­æ–­åº”ç”¨ç¨‹åºçš„æƒ…å†µä¸‹å¹¶å‘åœ°è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œå®ç°äº†æ›´ä½çš„åœé¡¿ã€‚</p>
<p>å› æ­¤ï¼Œå½“ä½ ä½¿ç”¨ ZGC æ—¶ï¼Œä¼ ç»Ÿçš„åˆ†ä»£æ¯”ä¾‹å°±ä¸é€‚ç”¨äº†ã€‚ä¸è¿‡ï¼Œäº†è§£ä¼ ç»Ÿçš„åˆ†ä»£ç»“æ„å¯¹äºç†è§£ Java å†…å­˜ç®¡ç†çš„åŸºç¡€ä¾ç„¶éå¸¸é‡è¦ã€‚</p>
<p>ä»¥ä¸‹æ˜¯é’ˆå¯¹Spring Cloud AlibabaåŠå…¶ä»–åˆ†å¸ƒå¼æŠ€æœ¯çš„æ·±åº¦è¡¥å……ï¼ŒåŒ…å«å®ç°åŸç†å’Œæ ¸å¿ƒç»„ä»¶çš„è¯¦ç»†è¯´æ˜ï¼š</p>
<hr>
<h2 id="å…­ã€Spring-Cloudä¸åˆ†å¸ƒå¼æŠ€æœ¯è¯¦è§£"><a href="#å…­ã€Spring-Cloudä¸åˆ†å¸ƒå¼æŠ€æœ¯è¯¦è§£" class="headerlink" title="å…­ã€Spring Cloudä¸åˆ†å¸ƒå¼æŠ€æœ¯è¯¦è§£"></a>å…­ã€Spring Cloudä¸åˆ†å¸ƒå¼æŠ€æœ¯è¯¦è§£</h2><h3 id="6-1-Spring-Cloud-Alibabaæ ¸å¿ƒç»„ä»¶"><a href="#6-1-Spring-Cloud-Alibabaæ ¸å¿ƒç»„ä»¶" class="headerlink" title="6.1 Spring Cloud Alibabaæ ¸å¿ƒç»„ä»¶"></a>6.1 Spring Cloud Alibabaæ ¸å¿ƒç»„ä»¶</h3><h4 id="Nacosæ·±åº¦è§£æ"><a href="#Nacosæ·±åº¦è§£æ" class="headerlink" title="Nacosæ·±åº¦è§£æ"></a>Nacosæ·±åº¦è§£æ</h4><p><strong>æœåŠ¡å‘ç°åŸç†</strong>ï¼š</p>
<ol>
<li><p><strong>æ³¨å†Œæµç¨‹</strong>ï¼š</p>
<ul>
<li>æœåŠ¡å¯åŠ¨æ—¶å‘Nacos Serverå‘é€æ³¨å†Œè¯·æ±‚ï¼ˆHTTP&#x2F;GRPCï¼‰</li>
<li>æ³¨å†Œä¿¡æ¯åŒ…å«å…ƒæ•°æ®ã€å¥åº·æ£€æŸ¥æ–¹å¼ï¼ˆTCP&#x2F;HTTP&#x2F;MySQLï¼‰</li>
<li>å®¢æˆ·ç«¯æœ¬åœ°ç¼“å­˜æœåŠ¡åˆ—è¡¨ï¼ˆæ•…éšœè½¬ç§»ï¼‰</li>
</ul>
</li>
<li><p><strong>å¥åº·æ£€æŸ¥æœºåˆ¶</strong>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Nacoså¥åº·æ£€æŸ¥é…ç½®ç¤ºä¾‹</span></span><br><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    nacos:</span><br><span class="line">      discovery:</span><br><span class="line">        health-check-enabled: <span class="literal">true</span></span><br><span class="line">        health-check-interval: 10s</span><br><span class="line">        health-check-timeout: 5s</span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>é…ç½®ä¸­å¿ƒå®ç°</strong>ï¼š</p>
<ul>
<li><strong>é•¿è½®è¯¢æœºåˆ¶</strong>ï¼ˆPush+Pullæ··åˆæ¨¡å¼ï¼‰ï¼š<ul>
<li>å®¢æˆ·ç«¯å‘èµ·é•¿è½®è¯¢è¯·æ±‚ï¼ˆé»˜è®¤30ç§’è¶…æ—¶ï¼‰</li>
<li>æœåŠ¡ç«¯é…ç½®å˜æ›´æ—¶ç«‹å³å“åº”</li>
<li>å®¢æˆ·ç«¯æ”¶åˆ°å˜æ›´åæ‹‰å–æœ€æ–°é…ç½®</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŠ¨æ€é…ç½®åˆ·æ–°ç¤ºä¾‹</span></span><br><span class="line"><span class="meta">@RefreshScope</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfigController</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;app.config.item&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String configItem;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Sentinelæ ¸å¿ƒåŸç†"><a href="#Sentinelæ ¸å¿ƒåŸç†" class="headerlink" title="Sentinelæ ¸å¿ƒåŸç†"></a>Sentinelæ ¸å¿ƒåŸç†</h4><p><strong>æµé‡æ§åˆ¶è§„åˆ™</strong>ï¼š</p>
<ul>
<li><strong>æ»‘åŠ¨çª—å£ç®—æ³•</strong>ï¼š<ul>
<li>ç»Ÿè®¡å‘¨æœŸï¼ˆ1ç§’ï¼‰åˆ†ä¸ºå¤šä¸ªæ ¼å­ï¼ˆå¦‚20ä¸ª50msï¼‰</li>
<li>å®æ—¶æ·˜æ±°è¿‡æœŸæ ¼å­æ•°æ®</li>
<li>QPSè®¡ç®—åŸºäºå½“å‰çª—å£æ€»è¯·æ±‚æ•°</li>
</ul>
</li>
</ul>
<p><strong>ç†”æ–­é™çº§ç­–ç•¥</strong>ï¼š</p>
<table>
<thead>
<tr>
<th>ç­–ç•¥ç±»å‹</th>
<th>è®¡ç®—å…¬å¼</th>
<th>é€‚ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody><tr>
<td>æ…¢è°ƒç”¨æ¯”ä¾‹</td>
<td>å“åº”æ—¶é—´ &gt; RTé˜ˆå€¼ &amp;&amp; æ¯”ä¾‹ &gt; é˜ˆå€¼</td>
<td>æ¥å£æ€§èƒ½æ³¢åŠ¨</td>
</tr>
<tr>
<td>å¼‚å¸¸æ¯”ä¾‹</td>
<td>å¼‚å¸¸æ•° &#x2F; è¯·æ±‚æ•° &gt; é˜ˆå€¼</td>
<td>ä¾èµ–æœåŠ¡ä¸ç¨³å®š</td>
</tr>
<tr>
<td>å¼‚å¸¸æ•°</td>
<td>å¼‚å¸¸æ•° &gt; é˜ˆå€¼ï¼ˆæ—¶é—´çª—å£å†…ï¼‰</td>
<td>å…³é”®ä¸šåŠ¡ç†”æ–­</td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Sentinelè§„åˆ™æŒä¹…åŒ–åˆ°Nacosç¤ºä¾‹</span></span><br><span class="line"><span class="meta">@PostConstruct</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initRules</span><span class="params">()</span> &#123;</span><br><span class="line">    FlowRuleManager.register2Property(</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">NacosDataSourceWrapper</span>(</span><br><span class="line">            <span class="string">&quot;nacos-server:8848&quot;</span>, <span class="string">&quot;sentinel-flow-rules&quot;</span>,</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Converter</span>&lt;String, List&lt;FlowRule&gt;&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> List&lt;FlowRule&gt; <span class="title function_">convert</span><span class="params">(String source)</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> JSON.parseArray(source, FlowRule.class);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="RocketMQé›†æˆ"><a href="#RocketMQé›†æˆ" class="headerlink" title="RocketMQé›†æˆ"></a>RocketMQé›†æˆ</h4><p><strong>æ¶ˆæ¯è½¨è¿¹è¿½è¸ª</strong>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç”Ÿäº§è€…é…ç½®</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> RocketMQTemplate <span class="title function_">rocketMQTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">RocketMQTemplate</span> <span class="variable">template</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RocketMQTemplate</span>();</span><br><span class="line">    template.setProducer(<span class="keyword">new</span> <span class="title class_">DefaultMQProducer</span>(<span class="string">&quot;producer_group&quot;</span>) &#123;&#123;</span><br><span class="line">        setVipChannelEnabled(<span class="literal">false</span>);</span><br><span class="line">        setTraceDispatcher(<span class="keyword">new</span> <span class="title class_">AsyncTraceDispatcher</span>(<span class="string">&quot;trace_topic&quot;</span>));</span><br><span class="line">    &#125;&#125;);</span><br><span class="line">    <span class="keyword">return</span> template;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¶ˆè´¹è€…è½¨è¿¹è¿½è¸ª</span></span><br><span class="line"><span class="meta">@RocketMQMessageListener(</span></span><br><span class="line"><span class="meta">    topic = &quot;order_topic&quot;, </span></span><br><span class="line"><span class="meta">    consumerGroup = &quot;order_consumer&quot;,</span></span><br><span class="line"><span class="meta">    enableMsgTrace = true</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderConsumer</span> <span class="keyword">implements</span> <span class="title class_">RocketMQListener</span>&lt;String&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onMessage</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="comment">// å¤„ç†é€»è¾‘</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-2-åˆ†å¸ƒå¼äº‹åŠ¡å¢å¼ºï¼ˆSeataåŸç†ï¼‰"><a href="#6-2-åˆ†å¸ƒå¼äº‹åŠ¡å¢å¼ºï¼ˆSeataåŸç†ï¼‰" class="headerlink" title="6.2 åˆ†å¸ƒå¼äº‹åŠ¡å¢å¼ºï¼ˆSeataåŸç†ï¼‰"></a>6.2 åˆ†å¸ƒå¼äº‹åŠ¡å¢å¼ºï¼ˆSeataåŸç†ï¼‰</h3><h4 id="ATæ¨¡å¼å·¥ä½œæµç¨‹"><a href="#ATæ¨¡å¼å·¥ä½œæµç¨‹" class="headerlink" title="ATæ¨¡å¼å·¥ä½œæµç¨‹"></a>ATæ¨¡å¼å·¥ä½œæµç¨‹</h4><ol>
<li><p><strong>ä¸€é˜¶æ®µ</strong>ï¼š</p>
<ul>
<li>è§£æSQLç”Ÿæˆå‰åé•œåƒ</li>
<li>æ³¨å†Œåˆ†æ”¯äº‹åŠ¡åˆ°TCï¼ˆTransaction Coordinatorï¼‰</li>
<li>æœ¬åœ°äº‹åŠ¡æäº¤å‰è®°å½•undo_log</li>
</ul>
</li>
<li><p><strong>äºŒé˜¶æ®µ</strong>ï¼š</p>
<ul>
<li>æˆåŠŸï¼šå¼‚æ­¥åˆ é™¤undo_log</li>
<li>å¤±è´¥ï¼šæ ¹æ®undo_logè¡¥å¿ï¼ˆåå‘SQLï¼‰</li>
</ul>
</li>
</ol>
<p><strong>undo_logè¡¨ç¤ºä¾‹</strong>ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> `undo_log` (</span><br><span class="line">  `id` <span class="type">bigint</span> <span class="keyword">NOT NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `branch_id` <span class="type">bigint</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">  `xid` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  `context` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  `rollback_info` longblob <span class="keyword">NOT NULL</span>,</span><br><span class="line">  `log_status` <span class="type">int</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">  `log_created` datetime <span class="keyword">NOT NULL</span>,</span><br><span class="line">  `log_modified` datetime <span class="keyword">NOT NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY KEY</span> (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `ux_undo_log` (`xid`,`branch_id`)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="TCCæ¨¡å¼æœ€ä½³å®è·µ"><a href="#TCCæ¨¡å¼æœ€ä½³å®è·µ" class="headerlink" title="TCCæ¨¡å¼æœ€ä½³å®è·µ"></a>TCCæ¨¡å¼æœ€ä½³å®è·µ</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è´¦æˆ·æœåŠ¡TCCæ¥å£</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AccountTccService</span> &#123;</span><br><span class="line">    <span class="meta">@TwoPhaseBusinessAction(</span></span><br><span class="line"><span class="meta">        name = &quot;deduct&quot;,</span></span><br><span class="line"><span class="meta">        commitMethod = &quot;confirmDeduct&quot;,</span></span><br><span class="line"><span class="meta">        rollbackMethod = &quot;cancelDeduct&quot;</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">prepareDeduct</span><span class="params">(</span></span><br><span class="line"><span class="params">        <span class="meta">@BusinessActionContextParameter(paramName = &quot;userId&quot;)</span> String userId,</span></span><br><span class="line"><span class="params">        <span class="meta">@BusinessActionContextParameter(paramName = &quot;amount&quot;)</span> BigDecimal amount</span></span><br><span class="line"><span class="params">    )</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">confirmDeduct</span><span class="params">(BusinessActionContext context)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">cancelDeduct</span><span class="params">(BusinessActionContext context)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸šåŠ¡è°ƒç”¨æ–¹</span></span><br><span class="line"><span class="meta">@GlobalTransactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">placeOrder</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. å†»ç»“åº“å­˜</span></span><br><span class="line">    inventoryTccService.prepare(<span class="literal">null</span>, order.getProductId(), order.getCount());</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. é¢„æ‰£æ¬¾</span></span><br><span class="line">    accountTccService.prepareDeduct(order.getUserId(), order.getAmount());</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. åˆ›å»ºè®¢å•</span></span><br><span class="line">    orderMapper.insert(order);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-3-åˆ†å¸ƒå¼ç¼“å­˜æ·±åº¦ä¼˜åŒ–"><a href="#6-3-åˆ†å¸ƒå¼ç¼“å­˜æ·±åº¦ä¼˜åŒ–" class="headerlink" title="6.3 åˆ†å¸ƒå¼ç¼“å­˜æ·±åº¦ä¼˜åŒ–"></a>6.3 åˆ†å¸ƒå¼ç¼“å­˜æ·±åº¦ä¼˜åŒ–</h3><h4 id="Rediså¤šçº§ç¼“å­˜æ¶æ„"><a href="#Rediså¤šçº§ç¼“å­˜æ¶æ„" class="headerlink" title="Rediså¤šçº§ç¼“å­˜æ¶æ„"></a>Rediså¤šçº§ç¼“å­˜æ¶æ„</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æœ¬åœ°ç¼“å­˜+Caffeine+Rediså®ç°</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> CacheManager <span class="title function_">cacheManager</span><span class="params">(RedisConnectionFactory factory)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CaffeineRedisCacheManager</span>(</span><br><span class="line">        Caffeine.newBuilder()</span><br><span class="line">            .expireAfterWrite(<span class="number">10</span>, TimeUnit.MINUTES)</span><br><span class="line">            .maximumSize(<span class="number">1000</span>),</span><br><span class="line">        RedisCacheWriter.nonLockingRedisCacheWriter(factory),</span><br><span class="line">        RedisCacheConfiguration.defaultCacheConfig()</span><br><span class="line">            .entryTtl(Duration.ofHours(<span class="number">1</span>))</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// çƒ­ç‚¹Keyæ¢æµ‹</span></span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; T <span class="title function_">getWithHotspotProtection</span><span class="params">(String key, Class&lt;T&gt; type)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. æœ¬åœ°ç¼“å­˜æŸ¥è¯¢</span></span><br><span class="line">    <span class="type">T</span> <span class="variable">value</span> <span class="operator">=</span> localCache.getIfPresent(key);</span><br><span class="line">    <span class="keyword">if</span> (value != <span class="literal">null</span>) <span class="keyword">return</span> value;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. Redisé›†ç¾¤æŸ¥è¯¢ï¼ˆå¸¦éšæœºè¿‡æœŸæ—¶é—´ï¼‰</span></span><br><span class="line">    value = redisTemplate.opsForValue().get(key);</span><br><span class="line">    <span class="keyword">if</span> (value != <span class="literal">null</span>) &#123;</span><br><span class="line">        localCache.put(key, value);</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. åˆ†å¸ƒå¼é”é˜²å‡»ç©¿</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">lockKey</span> <span class="operator">=</span> <span class="string">&quot;lock:&quot;</span> + key;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (redisLock.tryLock(lockKey, <span class="number">3</span>, <span class="number">30</span>)) &#123;</span><br><span class="line">            <span class="comment">// 4. æ•°æ®åº“æŸ¥è¯¢</span></span><br><span class="line">            value = databaseLoader.load(key);</span><br><span class="line">            redisTemplate.opsForValue().set(</span><br><span class="line">                key, value, </span><br><span class="line">                ThreadLocalRandom.current().nextInt(<span class="number">30</span>) + <span class="number">30</span>, </span><br><span class="line">                TimeUnit.MINUTES</span><br><span class="line">            );</span><br><span class="line">            localCache.put(key, value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        redisLock.unlock(lockKey);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-4-æ¶ˆæ¯é˜Ÿåˆ—é«˜çº§ç‰¹æ€§"><a href="#6-4-æ¶ˆæ¯é˜Ÿåˆ—é«˜çº§ç‰¹æ€§" class="headerlink" title="6.4 æ¶ˆæ¯é˜Ÿåˆ—é«˜çº§ç‰¹æ€§"></a>6.4 æ¶ˆæ¯é˜Ÿåˆ—é«˜çº§ç‰¹æ€§</h3><h4 id="RocketMQäº‹åŠ¡æ¶ˆæ¯"><a href="#RocketMQäº‹åŠ¡æ¶ˆæ¯" class="headerlink" title="RocketMQäº‹åŠ¡æ¶ˆæ¯"></a>RocketMQäº‹åŠ¡æ¶ˆæ¯</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// äº‹åŠ¡æ¶ˆæ¯ç”Ÿäº§è€…</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendTransactionMessage</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">    <span class="type">TransactionSendResult</span> <span class="variable">result</span> <span class="operator">=</span> rocketMQTemplate.sendMessageInTransaction(</span><br><span class="line">        <span class="string">&quot;order-tx-group&quot;</span>,</span><br><span class="line">        MessageBuilder.withPayload(order)</span><br><span class="line">            .setHeader(RocketMQHeaders.TRANSACTION_ID, order.getId())</span><br><span class="line">            .build(),</span><br><span class="line">        order</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æœ¬åœ°äº‹åŠ¡æ‰§è¡Œå™¨</span></span><br><span class="line"><span class="meta">@RocketMQTransactionListener(txProducerGroup = &quot;order-tx-group&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderTransactionListenerImpl</span> <span class="keyword">implements</span> <span class="title class_">RocketMQLocalTransactionListener</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> RocketMQLocalTransactionState <span class="title function_">executeLocalTransaction</span><span class="params">(Message msg, Object arg)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> (Order) arg;</span><br><span class="line">            orderService.createOrder(order); <span class="comment">// æœ¬åœ°äº‹åŠ¡</span></span><br><span class="line">            <span class="keyword">return</span> RocketMQLocalTransactionState.COMMIT;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> RocketMQLocalTransactionState.ROLLBACK;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> RocketMQLocalTransactionState <span class="title function_">checkLocalTransaction</span><span class="params">(Message msg)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">orderId</span> <span class="operator">=</span> msg.getHeaders().get(<span class="string">&quot;TRANSACTION_ID&quot;</span>).toString();</span><br><span class="line">        <span class="keyword">return</span> orderService.exists(orderId) ? </span><br><span class="line">            RocketMQLocalTransactionState.COMMIT : </span><br><span class="line">            RocketMQLocalTransactionState.ROLLBACK;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Kafkaç²¾ç¡®ä¸€æ¬¡è¯­ä¹‰"><a href="#Kafkaç²¾ç¡®ä¸€æ¬¡è¯­ä¹‰" class="headerlink" title="Kafkaç²¾ç¡®ä¸€æ¬¡è¯­ä¹‰"></a>Kafkaç²¾ç¡®ä¸€æ¬¡è¯­ä¹‰</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç”Ÿäº§è€…é…ç½®</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> ProducerFactory&lt;String, String&gt; <span class="title function_">producerFactory</span><span class="params">()</span> &#123;</span><br><span class="line">    Map&lt;String, Object&gt; configs = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    configs.put(ProducerConfig.ENABLE_IDEMPOTENCE_CONFIG, <span class="literal">true</span>);</span><br><span class="line">    configs.put(ProducerConfig.TRANSACTIONAL_ID_CONFIG, <span class="string">&quot;tx-producer-1&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DefaultKafkaProducerFactory</span>&lt;&gt;(configs);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¶ˆè´¹è€…é…ç½®</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> ConsumerFactory&lt;String, String&gt; <span class="title function_">consumerFactory</span><span class="params">()</span> &#123;</span><br><span class="line">    Map&lt;String, Object&gt; configs = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    configs.put(ConsumerConfig.ISOLATION_LEVEL_CONFIG, <span class="string">&quot;read_committed&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DefaultKafkaConsumerFactory</span>&lt;&gt;(configs);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// äº‹åŠ¡æ€§æ¶ˆè´¹</span></span><br><span class="line"><span class="meta">@KafkaListener(topics = &quot;order-topic&quot;)</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processOrder</span><span class="params">(ConsumerRecord&lt;String, String&gt; record)</span> &#123;</span><br><span class="line">    <span class="type">OrderEvent</span> <span class="variable">event</span> <span class="operator">=</span> parseEvent(record.value());</span><br><span class="line">    orderService.process(event); <span class="comment">// æ•°æ®åº“æ“ä½œ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ä¸ƒã€äº‘åŸç”Ÿæ”¯æŒï¼ˆæ–°å¢ï¼‰"><a href="#ä¸ƒã€äº‘åŸç”Ÿæ”¯æŒï¼ˆæ–°å¢ï¼‰" class="headerlink" title="ä¸ƒã€äº‘åŸç”Ÿæ”¯æŒï¼ˆæ–°å¢ï¼‰"></a>ä¸ƒã€äº‘åŸç”Ÿæ”¯æŒï¼ˆæ–°å¢ï¼‰</h2><h3 id="7-1-Kubernetesé›†æˆæ–¹æ¡ˆ"><a href="#7-1-Kubernetesé›†æˆæ–¹æ¡ˆ" class="headerlink" title="7.1 Kubernetesé›†æˆæ–¹æ¡ˆ"></a>7.1 Kubernetesé›†æˆæ–¹æ¡ˆ</h3><h4 id="æœåŠ¡å‘ç°é€‚é…"><a href="#æœåŠ¡å‘ç°é€‚é…" class="headerlink" title="æœåŠ¡å‘ç°é€‚é…"></a>æœåŠ¡å‘ç°é€‚é…</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Nacosä¸K8s Serviceé›†æˆ</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">kubernetes:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">all-namespaces:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">$&#123;NACOS_HOST:nacos-headless&#125;:$&#123;NACOS_PORT:8848&#125;</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">$&#123;POD_NAMESPACE:default&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="é…ç½®ç®¡ç†æ–¹æ¡ˆ"><a href="#é…ç½®ç®¡ç†æ–¹æ¡ˆ" class="headerlink" title="é…ç½®ç®¡ç†æ–¹æ¡ˆ"></a>é…ç½®ç®¡ç†æ–¹æ¡ˆ</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¤šé…ç½®æºåŠ è½½ï¼ˆK8s ConfigMap + Nacosï¼‰</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;app&quot;)</span></span><br><span class="line"><span class="meta">@RefreshScope</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;configFromNacos&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String nacosConfig;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;configFromK8s&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String k8sConfig;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="7-2-Service-Meshæ•´åˆ"><a href="#7-2-Service-Meshæ•´åˆ" class="headerlink" title="7.2 Service Meshæ•´åˆ"></a>7.2 Service Meshæ•´åˆ</h3><h4 id="Istioæµé‡æ²»ç†"><a href="#Istioæµé‡æ²»ç†" class="headerlink" title="Istioæµé‡æ²»ç†"></a>Istioæµé‡æ²»ç†</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é‡‘ä¸é›€å‘å¸ƒç­–ç•¥</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.istio.io/v1alpha3</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">VirtualService</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">order-service</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">hosts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">order-service</span></span><br><span class="line">  <span class="attr">http:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">route:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">destination:</span></span><br><span class="line">            <span class="attr">host:</span> <span class="string">order-service</span></span><br><span class="line">            <span class="attr">subset:</span> <span class="string">v1</span></span><br><span class="line">          <span class="attr">weight:</span> <span class="number">90</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">destination:</span></span><br><span class="line">            <span class="attr">host:</span> <span class="string">order-service</span></span><br><span class="line">            <span class="attr">subset:</span> <span class="string">v2</span></span><br><span class="line">          <span class="attr">weight:</span> <span class="number">10</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="å…«ã€æ€§èƒ½ä¼˜åŒ–æ·±åº¦å®è·µ"><a href="#å…«ã€æ€§èƒ½ä¼˜åŒ–æ·±åº¦å®è·µ" class="headerlink" title="å…«ã€æ€§èƒ½ä¼˜åŒ–æ·±åº¦å®è·µ"></a>å…«ã€æ€§èƒ½ä¼˜åŒ–æ·±åº¦å®è·µ</h2><h3 id="8-1-å…¨é“¾è·¯å‹æµ‹æ–¹æ¡ˆ"><a href="#8-1-å…¨é“¾è·¯å‹æµ‹æ–¹æ¡ˆ" class="headerlink" title="8.1 å…¨é“¾è·¯å‹æµ‹æ–¹æ¡ˆ"></a>8.1 å…¨é“¾è·¯å‹æµ‹æ–¹æ¡ˆ</h3><h4 id="å½±å­åº“è¡¨é…ç½®"><a href="#å½±å­åº“è¡¨é…ç½®" class="headerlink" title="å½±å­åº“è¡¨é…ç½®"></a>å½±å­åº“è¡¨é…ç½®</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ShardingSphereå½±å­åº“é…ç½®</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">shardingsphere:</span></span><br><span class="line">    <span class="attr">datasource:</span></span><br><span class="line">      <span class="attr">names:</span> <span class="string">ds-real,ds-shadow</span></span><br><span class="line">    <span class="attr">rules:</span></span><br><span class="line">      <span class="attr">shadow:</span></span><br><span class="line">        <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">data-sources:</span></span><br><span class="line">          <span class="attr">shadow-data-source:</span></span><br><span class="line">            <span class="attr">source-data-source-name:</span> <span class="string">ds-real</span></span><br><span class="line">            <span class="attr">shadow-data-source-name:</span> <span class="string">ds-shadow</span></span><br><span class="line">        <span class="attr">tables:</span></span><br><span class="line">          <span class="attr">t_order:</span></span><br><span class="line">            <span class="attr">shadow-algorithm-names:</span> [<span class="string">simple-hint-algorithm</span>]</span><br></pre></td></tr></table></figure>

<h4 id="æµé‡æŸ“è‰²æ ‡è®°"><a href="#æµé‡æŸ“è‰²æ ‡è®°" class="headerlink" title="æµé‡æŸ“è‰²æ ‡è®°"></a>æµé‡æŸ“è‰²æ ‡è®°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€šè¿‡ThreadLocalä¼ é€’å‹æµ‹æ ‡è®°</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PressureTestContext</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;Boolean&gt; FLAG = ThreadLocal.withInitial(() -&gt; <span class="literal">false</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">markPressureTest</span><span class="params">()</span> &#123;</span><br><span class="line">        FLAG.set(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isPressureTest</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> FLAG.get();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MyBatisæ‹¦æˆªå™¨è‡ªåŠ¨è·¯ç”±</span></span><br><span class="line"><span class="meta">@Intercepts(@Signature(type=Executor.class, method=&quot;update&quot;, args=&#123;MappedStatement.class,Object.class&#125;))</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShadowDbInterceptor</span> <span class="keyword">implements</span> <span class="title class_">Interceptor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">intercept</span><span class="params">(Invocation invocation)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="keyword">if</span> (PressureTestContext.isPressureTest()) &#123;</span><br><span class="line">            RoutingContext.setShadowDataSource();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> invocation.proceed();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="http://example.com">Charlotte</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="http://example.com/2025/09/11/%E6%A1%86%E6%9E%B6%E8%83%8C%E8%AF%B5/">http://example.com/2025/09/11/%E6%A1%86%E6%9E%B6%E8%83%8C%E8%AF%B5/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥æº <a href="http://example.com" target="_blank">æµ®ç”Ÿè‹¥æ¢¦</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Hexo-Markdown/">Hexo, Markdown</a></div><div class="post-share"><div class="social-share" data-image="/img/title.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/09/11/%E5%9F%BA%E7%A1%80%E8%83%8C%E8%AF%B5/" title="åŸºç¡€èƒŒè¯µ"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">ä¸Šä¸€ç¯‡</div><div class="info-item-2">åŸºç¡€èƒŒè¯µ</div></div><div class="info-2"><div class="info-item-1">ç½‘ç»œåŸºç¡€OSIä¸ƒå±‚æ¨¡å‹OSI (Open Systems Interconnection) å‚è€ƒæ¨¡å‹æ˜¯ä¸€ä¸ªæŠ½è±¡çš„ã€æ¦‚å¿µæ€§çš„æ¡†æ¶ï¼Œæ—¨åœ¨å®šä¹‰ç½‘ç»œé€šä¿¡çš„åŠŸèƒ½åˆ†å±‚ï¼Œä¿ƒè¿›ä¸åŒç³»ç»Ÿä¹‹é—´çš„äº’æ“ä½œæ€§ã€‚å®ƒå°†ç½‘ç»œé€šä¿¡è¿‡ç¨‹åˆ†ä¸ºä¸ƒä¸ªç‹¬ç«‹çš„å±‚æ¬¡ï¼Œæ¯å±‚è´Ÿè´£ç‰¹å®šçš„åŠŸèƒ½ã€‚æ•°æ®åœ¨å‘é€ç«¯ä»ä¸Šå±‚å‘ä¸‹å±‚ä¼ è¾“ï¼Œæ¯å±‚æ·»åŠ è‡ªå·±çš„æ§åˆ¶ä¿¡æ¯ï¼ˆå°è£…ï¼‰ï¼Œåœ¨æ¥æ”¶ç«¯åˆ™ä»ä¸‹å±‚å‘ä¸Šå±‚ä¼ è¾“ï¼Œæ¯å±‚å‰¥ç¦»å¯¹åº”çš„æ§åˆ¶ä¿¡æ¯ï¼ˆè§£å°è£…ï¼‰ã€‚  ç‰©ç†å±‚ (Physical Layer)   åŠŸèƒ½ï¼šè´Ÿè´£ä¼ è¾“æ¯”ç‰¹æµï¼Œå³åŸå§‹çš„äºŒè¿›åˆ¶æ•°æ®ã€‚å®šä¹‰äº†ç‰©ç†åª’ä»‹çš„ç”µæ°”ç‰¹æ€§ã€æœºæ¢°ç‰¹æ€§ã€åŠŸèƒ½ç‰¹æ€§å’Œè¿‡ç¨‹ç‰¹æ€§ã€‚ å·¥ä½œæ–¹å¼ï¼šä¸å…³å¿ƒæ¯”ç‰¹çš„å«ä¹‰ï¼Œåªè´Ÿè´£å°†å…¶ä»ä¸€ä¸ªèŠ‚ç‚¹ä¼ è¾“åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹ã€‚ä¾‹å¦‚ï¼Œè§„å®šç½‘ç»œçš„æ¥å£å½¢çŠ¶ã€ç”µå‹ã€ä¼ è¾“é€Ÿç‡ç­‰ã€‚ åè®®&#x2F;è®¾å¤‡ï¼šç½‘çº¿ (Ethernet Cable)ã€å…‰çº¤ (Fiber Optic)ã€é›†çº¿å™¨ (Hub)ã€ä¸­ç»§å™¨ (Repeater)ã€ç½‘å¡ (NIC) çš„ç‰©ç†éƒ¨åˆ†ã€‚ æ•°æ®å•ä½ï¼šæ¯”ç‰¹ (Bit)ã€‚   æ•°æ®é“¾è·¯å±‚ (Data Link Layer)   åŠŸèƒ½ï¼šåœ¨ç‰©ç†å±‚æä¾›çš„ä¸å¯é æ¯”ç‰¹æµæœåŠ¡çš„åŸºç¡€ä¸Šï¼Œå°†æ¯”ç‰¹ç»„åˆæˆå¸§ï¼Œæä¾›èŠ‚ç‚¹åˆ°èŠ‚ç‚¹ä¹‹é—´çš„æ•°æ®ä¼ è¾“ã€‚è´Ÿè´£å·®é”™æ§åˆ¶...</div></div></div></a><a class="pagination-related  no-desc" href="/2025/09/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E9%9D%A2%E8%AF%95/" title="è®¡ç®—æœºåŸºç¡€é¢è¯•"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">ä¸‹ä¸€ç¯‡</div><div class="info-item-2">è®¡ç®—æœºåŸºç¡€é¢è¯•</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/09/11/8.21%E5%AD%A6%E4%BC%9A/" title="8.21å­¦ä¼š"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-11</div><div class="info-item-2">8.21å­¦ä¼š</div></div><div class="info-2"><div class="info-item-1">1.å®ç°å•ä¾‹æ¨¡å¼ (Singleton Pattern)æ‡’æ±‰å¼ï¼šä½¿ç”¨åŒé‡æ£€æŸ¥é”å®š (DCL) å®ç°çº¿ç¨‹å®‰å…¨çš„æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼ã€‚è¿™ç§æ¨¡å¼åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶æ‰åˆ›å»ºå®ä¾‹ï¼Œå¹¶ä¸”é€šè¿‡ä¸¤æ¬¡æ£€æŸ¥å’ŒåŒæ­¥å—ç¡®ä¿äº†çº¿ç¨‹å®‰å…¨å’Œæ€§èƒ½ã€‚ 1234567891011121314151617181920212223242526272829class Singleton &#123;    // 1. volatile å…³é”®å­—ç¡®ä¿å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œinstance å˜é‡çš„ä¿®æ”¹èƒ½å¤Ÿç«‹å³è¢«å…¶ä»–çº¿ç¨‹çœ‹åˆ°    private static volatile Singleton instance;    // 2. ç§æœ‰åŒ–æ„é€ å™¨ï¼Œé˜²æ­¢å¤–éƒ¨ç›´æ¥ new å®ä¾‹    private Singleton() &#123;&#125;    // 3. æä¾›ä¸€ä¸ªå…¨å±€è®¿é—®ç‚¹ï¼Œä½¿ç”¨ DCL ç¡®ä¿çº¿ç¨‹å®‰å…¨    public static Singleton getInstance() &#123;        // ç¬¬ä¸€æ¬¡æ£€æŸ¥ï¼šå¦‚æœå®ä¾‹å·²ç»å­˜åœ¨ï¼Œç›´æ¥è¿”å›ï¼Œé¿å…ä¸å¿…è¦çš„åŒæ­¥        if (instance == null) &#12...</div></div></div></a><a class="pagination-related no-desc" href="/2025/09/11/%E5%91%BD%E4%BB%A4%E5%A4%A7%E5%85%A8/" title="å‘½ä»¤å¤§å…¨"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-11</div><div class="info-item-2">å‘½ä»¤å¤§å…¨</div></div></div></a><a class="pagination-related" href="/2025/09/11/%E5%88%86%E5%B8%83%E5%BC%8F/" title="åˆ†å¸ƒå¼"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-11</div><div class="info-item-2">åˆ†å¸ƒå¼</div></div><div class="info-2"><div class="info-item-1">1. Spring Cloud ä½“ç³»æ ¸å¿ƒæ€æƒ³Spring Cloud å¹¶éä¸€ä¸ªå…¨æ–°çš„æ¡†æ¶ï¼Œè€Œæ˜¯ä¸€å¥—ç”¨äºæ„å»ºå¾®æœåŠ¡æ¶æ„çš„è§„èŒƒå’Œè§£å†³æ–¹æ¡ˆçš„é›†åˆã€‚å®ƒå·§å¦™åœ°åˆ©ç”¨äº† Spring Boot çš„è‡ªåŠ¨é…ç½®å’Œå¿«é€Ÿå¼€å‘ç‰¹æ€§ï¼Œå°†ä¸šç•Œç»è¿‡å¹¿æ³›éªŒè¯çš„ä¼˜ç§€å¾®æœåŠ¡ç»„ä»¶ï¼ˆå¦‚ Netflix OSSã€Alibaba Nacosã€HashiCorp Consul ç­‰ï¼‰è¿›è¡Œå°è£…å’Œé›†æˆï¼Œä¸ºå¼€å‘è€…æä¾›äº†ä¸€ç«™å¼çš„åˆ†å¸ƒå¼ç³»ç»Ÿå¼€å‘å·¥å…·ç®±ï¼Œæ¶µç›–äº†æœåŠ¡æ²»ç†ã€é…ç½®ç®¡ç†ã€ç†”æ–­é™çº§ã€æ™ºèƒ½è·¯ç”±ã€æœåŠ¡è°ƒç”¨ç­‰æ–¹æ–¹é¢é¢ã€‚ Netflix OSS å¸¸ç”¨ç»„ä»¶ï¼ˆéƒ¨åˆ†è¿›å…¥ç»´æŠ¤æ¨¡å¼ï¼‰ æœåŠ¡æ³¨å†Œä¸å‘ç° (Service Discovery): Eureka ä½œç”¨: æä¾›ä¸€ä¸ªæœåŠ¡æ³¨å†Œä¸­å¿ƒã€‚æ¯ä¸ªå¾®æœåŠ¡å¯åŠ¨æ—¶ï¼Œå°†è‡ªå·±çš„ç½‘ç»œåœ°å€ç­‰ä¿¡æ¯â€œæ³¨å†Œâ€åˆ° Eureka Serverã€‚å…¶ä»–æœåŠ¡ï¼ˆæ¶ˆè´¹è€…ï¼‰åˆ™ä» Eureka Server â€œå‘ç°â€å¹¶æ‹‰å–æ‰€éœ€æœåŠ¡æä¾›è€…çš„åœ°å€åˆ—è¡¨ï¼Œä»è€Œå®ç°æœåŠ¡é—´çš„åŠ¨æ€å¯»å€å’Œè°ƒç”¨ã€‚ ä½¿ç”¨: æœåŠ¡ç«¯æ·»åŠ  spring-cloud-starter-netflix-eureka-server ä¾èµ–ï¼Œå¹¶ä½¿ç”¨ @EnableEurekaServer æ³¨è§£ã€‚å®¢...</div></div></div></a><a class="pagination-related no-desc" href="/2025/09/11/%E6%A1%86%E6%9E%B6/" title="æ¡†æ¶"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-11</div><div class="info-item-2">æ¡†æ¶</div></div></div></a><a class="pagination-related" href="/2025/09/11/%E6%89%8B%E5%86%99%E7%AD%94%E6%A1%88/" title="æ‰‹å†™ç­”æ¡ˆ"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-11</div><div class="info-item-2">æ‰‹å†™ç­”æ¡ˆ</div></div><div class="info-2"><div class="info-item-1">1.å®ç°å•ä¾‹æ¨¡å¼ (Singleton Pattern)æ‡’æ±‰å¼ï¼šä½¿ç”¨åŒé‡æ£€æŸ¥é”å®š (DCL) å®ç°çº¿ç¨‹å®‰å…¨çš„æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼ã€‚è¿™ç§æ¨¡å¼åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶æ‰åˆ›å»ºå®ä¾‹ï¼Œå¹¶ä¸”é€šè¿‡ä¸¤æ¬¡æ£€æŸ¥å’ŒåŒæ­¥å—ç¡®ä¿äº†çº¿ç¨‹å®‰å…¨å’Œæ€§èƒ½ã€‚ 1234567891011121314151617181920212223242526272829class Singleton &#123;    // 1. volatile å…³é”®å­—ç¡®ä¿å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œinstance å˜é‡çš„ä¿®æ”¹èƒ½å¤Ÿç«‹å³è¢«å…¶ä»–çº¿ç¨‹çœ‹åˆ°    private static volatile Singleton instance;    // 2. ç§æœ‰åŒ–æ„é€ å™¨ï¼Œé˜²æ­¢å¤–éƒ¨ç›´æ¥ new å®ä¾‹    private Singleton() &#123;&#125;    // 3. æä¾›ä¸€ä¸ªå…¨å±€è®¿é—®ç‚¹ï¼Œä½¿ç”¨ DCL ç¡®ä¿çº¿ç¨‹å®‰å…¨    public static Singleton getInstance() &#123;        // ç¬¬ä¸€æ¬¡æ£€æŸ¥ï¼šå¦‚æœå®ä¾‹å·²ç»å­˜åœ¨ï¼Œç›´æ¥è¿”å›ï¼Œé¿å…ä¸å¿…è¦çš„åŒæ­¥        if (instance == null) &#12...</div></div></div></a><a class="pagination-related" href="/2025/09/11/web/" title="web"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-11</div><div class="info-item-2">web</div></div><div class="info-2"><div class="info-item-1">å¥½çš„ï¼Œè®©æˆ‘ä»¬æ·±å…¥åˆ° HTTP åè®®çš„åº•å±‚ï¼Œå…¨é¢è§£å‰–å®ƒçš„å·¥ä½œåŸç†ã€è¯·æ±‚-å“åº”æ¨¡å‹ã€ä»¥åŠå„ä¸ªç»„æˆéƒ¨åˆ†ã€‚  ä¸€ã€HTTP åè®®æ¦‚è¿°HTTPï¼ˆHypertext Transfer Protocolï¼Œè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰æ˜¯åº”ç”¨å±‚åè®®ï¼Œå®ƒå®šä¹‰äº† Web å®¢æˆ·ç«¯ï¼ˆå¦‚æµè§ˆå™¨ï¼‰å’Œ Web æœåŠ¡å™¨ä¹‹é—´äº¤æ¢æ•°æ®çš„è§„åˆ™ã€‚å®ƒçš„æ ¸å¿ƒç‰¹ç‚¹æ˜¯æ— çŠ¶æ€ï¼ˆStatelessï¼‰ï¼Œè¿™æ„å‘³ç€æœåŠ¡å™¨ä¸ä¼šä¿å­˜å®¢æˆ·ç«¯çš„ä»»ä½•ä¿¡æ¯ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½æ˜¯ç‹¬ç«‹çš„ã€‚  äºŒã€HTTP è¯·æ±‚ï¼ˆRequestï¼‰ä¸€ä¸ªå®Œæ•´çš„ HTTP è¯·æ±‚ç”±å››éƒ¨åˆ†ç»„æˆï¼š 1. è¯·æ±‚è¡Œï¼ˆRequest Lineï¼‰è¿™æ˜¯è¯·æ±‚çš„ç¬¬ä¸€è¡Œï¼Œå®ƒå®šä¹‰äº†è¯·æ±‚çš„åŸºæœ¬ä¿¡æ¯ã€‚  è¯·æ±‚æ–¹æ³•ï¼ˆMethodï¼‰ï¼šå¦‚ GET, POST, PUT, DELETE ç­‰ï¼Œè¡¨ç¤ºå¯¹èµ„æºçš„æ“ä½œç±»å‹ã€‚ è¯·æ±‚ URL (URI)ï¼šèµ„æºçš„åœ°å€ã€‚ HTTP åè®®ç‰ˆæœ¬ï¼šå¦‚ HTTP/1.1, HTTP/2.0ã€‚  ç¤ºä¾‹ï¼š GET &#x2F;index.html HTTP&#x2F;1.1 2. è¯·æ±‚å¤´ï¼ˆRequest Headersï¼‰è¯·æ±‚å¤´æä¾›äº†å…³äºå®¢æˆ·ç«¯ã€è¯·æ±‚ä½“å’Œä¸€äº›å…¶ä»–å…ƒæ•°æ®çš„ä¿¡æ¯ã€‚å®ƒä»¬ä»¥é”®å€¼å¯¹çš„å½¢å¼å­˜åœ¨ã€‚  Hostï¼šæŒ‡...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/title.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Charlotte</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">16</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">1</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">2</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/charlotte030710"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Java%E6%A1%86%E6%9E%B6%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.</span> <span class="toc-text">Javaæ¡†æ¶æ ¸å¿ƒçŸ¥è¯†è¯¦è§£</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81Spring%E6%A1%86%E6%9E%B6%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90"><span class="toc-number">1.1.</span> <span class="toc-text">ä¸€ã€Springæ¡†æ¶æ·±å…¥è§£æ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-Spring%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E4%B8%8E%E5%8E%9F%E7%90%86"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.1 Springæ ¸å¿ƒæ¦‚å¿µä¸åŸç†</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#IoC%E5%AE%B9%E5%99%A8%E5%8E%9F%E7%90%86%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">IoCå®¹å™¨åŸç†æ·±å…¥åˆ†æ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DI%E7%9A%84%E4%B8%89%E7%A7%8D%E6%B3%A8%E5%85%A5%E6%96%B9%E5%BC%8F%E5%AF%B9%E6%AF%94"><span class="toc-number">1.1.1.2.</span> <span class="toc-text">DIçš„ä¸‰ç§æ³¨å…¥æ–¹å¼å¯¹æ¯”</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AOP%E5%8E%9F%E7%90%86%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90"><span class="toc-number">1.1.1.3.</span> <span class="toc-text">AOPåŸç†æ·±å…¥åˆ†æ</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%8C%9F-%E4%B8%80%E3%80%81Spring-AOP-%E5%AE%9E%E7%8E%B0%E6%9C%BA%E5%88%B6%E6%A6%82%E8%BF%B0"><span class="toc-number">1.2.</span> <span class="toc-text">ğŸŒŸ ä¸€ã€Spring AOP å®ç°æœºåˆ¶æ¦‚è¿°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%A7%A9-%E4%BA%8C%E3%80%81Spring-AOP-%E7%9A%84%E4%B8%A4%E7%A7%8D%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E6%96%B9%E5%BC%8F"><span class="toc-number">1.3.</span> <span class="toc-text">ğŸ§© äºŒã€Spring AOP çš„ä¸¤ç§åŠ¨æ€ä»£ç†æ–¹å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%B8%8F%E2%83%A3-JDK-%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%EF%BC%88%E5%9F%BA%E4%BA%8E%E6%8E%A5%E5%8F%A3%EF%BC%89"><span class="toc-number">1.3.1.</span> <span class="toc-text">1ï¸âƒ£ JDK åŠ¨æ€ä»£ç†ï¼ˆåŸºäºæ¥å£ï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%9C%85-%E5%8E%9F%E7%90%86%EF%BC%9A"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">âœ… åŸç†ï¼š</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%93%A6-%E7%A4%BA%E4%BE%8B%EF%BC%9A"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">ğŸ“¦ ç¤ºä¾‹ï¼š</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%8E%AF-%E7%89%B9%E7%82%B9%EF%BC%9A"><span class="toc-number">1.3.1.3.</span> <span class="toc-text">ğŸ¯ ç‰¹ç‚¹ï¼š</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%B8%8F%E2%83%A3-CGLIB-%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%EF%BC%88%E5%9F%BA%E4%BA%8E%E5%AD%90%E7%B1%BB%EF%BC%89"><span class="toc-number">1.3.2.</span> <span class="toc-text">2ï¸âƒ£ CGLIB åŠ¨æ€ä»£ç†ï¼ˆåŸºäºå­ç±»ï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%9C%85-%E5%8E%9F%E7%90%86%EF%BC%9A-1"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">âœ… åŸç†ï¼š</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%A7%AA-%E7%A4%BA%E4%BE%8B%EF%BC%9A"><span class="toc-number">1.3.2.2.</span> <span class="toc-text">ğŸ§ª ç¤ºä¾‹ï¼š</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%8E%AF-%E7%89%B9%E7%82%B9%EF%BC%9A-1"><span class="toc-number">1.3.2.3.</span> <span class="toc-text">ğŸ¯ ç‰¹ç‚¹ï¼š</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%8F%97-%E4%B8%89%E3%80%81%E9%9D%99%E6%80%81%E4%BB%A3%E7%90%86%EF%BC%88%E5%AF%B9%E6%AF%94%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%EF%BC%89"><span class="toc-number">1.4.</span> <span class="toc-text">ğŸ— ä¸‰ã€é™æ€ä»£ç†ï¼ˆå¯¹æ¯”åŠ¨æ€ä»£ç†ï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9C%85-%E5%8E%9F%E7%90%86%EF%BC%9A-2"><span class="toc-number">1.4.1.</span> <span class="toc-text">âœ… åŸç†ï¼š</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%A7%AA-%E7%A4%BA%E4%BE%8B%EF%BC%9A-1"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">ğŸ§ª ç¤ºä¾‹ï¼š</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%8E%AF-%E7%89%B9%E7%82%B9%EF%BC%9A-2"><span class="toc-number">1.4.1.2.</span> <span class="toc-text">ğŸ¯ ç‰¹ç‚¹ï¼š</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%94%9A-%E5%9B%9B%E3%80%81%E4%B8%89%E8%80%85%E5%AF%B9%E6%AF%94%E6%80%BB%E7%BB%93"><span class="toc-number">1.5.</span> <span class="toc-text">ğŸ”š å››ã€ä¸‰è€…å¯¹æ¯”æ€»ç»“</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%9C%85-Spring-%E5%A6%82%E4%BD%95%E9%80%89%E6%8B%A9%E4%BB%A3%E7%90%86%E6%96%B9%E5%BC%8F%EF%BC%9F"><span class="toc-number">1.6.</span> <span class="toc-text">âœ… Spring å¦‚ä½•é€‰æ‹©ä»£ç†æ–¹å¼ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-Spring%E6%A0%B8%E5%BF%83%E6%B3%A8%E8%A7%A3%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.6.1.</span> <span class="toc-text">1.2 Springæ ¸å¿ƒæ³¨è§£è¯¦è§£</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.6.1.1.</span> <span class="toc-text">åŸºç¡€é…ç½®æ³¨è§£</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Bean%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.6.1.2.</span> <span class="toc-text">Beanå®šä¹‰æ³¨è§£</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.6.1.3.</span> <span class="toc-text">ä¾èµ–æ³¨å…¥æ³¨è§£</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.6.1.4.</span> <span class="toc-text">ç”Ÿå‘½å‘¨æœŸæ³¨è§£</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AOP%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.6.1.5.</span> <span class="toc-text">AOPç›¸å…³æ³¨è§£</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-Spring%E5%B8%B8%E8%A7%81%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.6.2.</span> <span class="toc-text">1.3 Springå¸¸è§ä½¿ç”¨åœºæ™¯</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF1%EF%BC%9A%E6%9C%8D%E5%8A%A1%E5%B1%82%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86"><span class="toc-number">1.6.2.1.</span> <span class="toc-text">åœºæ™¯1ï¼šæœåŠ¡å±‚äº‹åŠ¡ç®¡ç†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF2%EF%BC%9A%E7%BC%93%E5%AD%98%E7%AE%A1%E7%90%86"><span class="toc-number">1.6.2.2.</span> <span class="toc-text">åœºæ™¯2ï¼šç¼“å­˜ç®¡ç†</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-Spring%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98"><span class="toc-number">1.6.3.</span> <span class="toc-text">1.4 Springå¸¸è§é¢è¯•é—®é¢˜</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81Spring-Boot%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90"><span class="toc-number">1.7.</span> <span class="toc-text">äºŒã€Spring Bootæ·±å…¥è§£æ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-Spring-Boot%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86"><span class="toc-number">1.7.1.</span> <span class="toc-text">2.1 Spring Bootæ ¸å¿ƒåŸç†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-Spring-Boot%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.7.2.</span> <span class="toc-text">2.2 Spring Bootå¯åŠ¨æµç¨‹è¯¦è§£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-Spring-Boot%E6%A0%B8%E5%BF%83%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.7.3.</span> <span class="toc-text">2.3 Spring Bootæ ¸å¿ƒæ³¨è§£</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E7%B1%BB%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.7.3.1.</span> <span class="toc-text">å¯åŠ¨ç±»æ³¨è§£</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.7.3.2.</span> <span class="toc-text">æ¡ä»¶æ³¨è§£</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E5%B1%9E%E6%80%A7%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.7.3.3.</span> <span class="toc-text">é…ç½®å±æ€§æ³¨è§£</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-Spring-Boot%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.7.4.</span> <span class="toc-text">2.4 Spring Bootå®é™…åº”ç”¨åœºæ™¯</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF1%EF%BC%9A%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84"><span class="toc-number">1.7.4.1.</span> <span class="toc-text">åœºæ™¯1ï¼šå¾®æœåŠ¡æ¶æ„</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF2%EF%BC%9A%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE%E5%B1%82%E6%95%B4%E5%90%88"><span class="toc-number">1.7.4.2.</span> <span class="toc-text">åœºæ™¯2ï¼šæ•°æ®è®¿é—®å±‚æ•´åˆ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-Spring-Boot%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98"><span class="toc-number">1.7.5.</span> <span class="toc-text">2.5 Spring Booté¢è¯•é—®é¢˜</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81Spring-MVC%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90"><span class="toc-number">1.8.</span> <span class="toc-text">ä¸‰ã€Spring MVCæ·±å…¥è§£æ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-Spring-MVC%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6"><span class="toc-number">1.8.1.</span> <span class="toc-text">3.1 Spring MVCæ ¸å¿ƒç»„ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-Spring-MVC%E6%A0%B8%E5%BF%83%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.8.2.</span> <span class="toc-text">3.2 Spring MVCæ ¸å¿ƒæ³¨è§£</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E5%99%A8%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.8.2.1.</span> <span class="toc-text">æ§åˆ¶å™¨æ³¨è§£</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E7%BB%91%E5%AE%9A%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.8.2.2.</span> <span class="toc-text">å‚æ•°ç»‘å®šæ³¨è§£</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E5%A4%84%E7%90%86%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.8.2.3.</span> <span class="toc-text">å“åº”å¤„ç†æ³¨è§£</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-Spring-MVC%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.8.3.</span> <span class="toc-text">3.3 Spring MVCå®é™…åº”ç”¨åœºæ™¯</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF1%EF%BC%9ARESTful-API%E5%BC%80%E5%8F%91"><span class="toc-number">1.8.3.1.</span> <span class="toc-text">åœºæ™¯1ï¼šRESTful APIå¼€å‘</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF2%EF%BC%9A%E5%85%A8%E5%B1%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-number">1.8.3.2.</span> <span class="toc-text">åœºæ™¯2ï¼šå…¨å±€å¼‚å¸¸å¤„ç†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF3%EF%BC%9A%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%A4%84%E7%90%86"><span class="toc-number">1.8.3.3.</span> <span class="toc-text">åœºæ™¯3ï¼šæ–‡ä»¶ä¸Šä¼ å¤„ç†</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-Spring-MVC%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98"><span class="toc-number">1.8.4.</span> <span class="toc-text">3.4 Spring MVCé¢è¯•é—®é¢˜</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81MyBatis%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90"><span class="toc-number">1.9.</span> <span class="toc-text">å››ã€MyBatisæ·±å…¥è§£æ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-MyBatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86"><span class="toc-number">1.9.1.</span> <span class="toc-text">4.1 MyBatisæ ¸å¿ƒåŸç†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-MyBatis%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.9.2.</span> <span class="toc-text">4.2 MyBatisæ‰§è¡Œæµç¨‹è¯¦è§£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-MyBatis%E6%A0%B8%E5%BF%83%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.9.3.</span> <span class="toc-text">4.3 MyBatisæ ¸å¿ƒæ³¨è§£</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E6%98%A0%E5%B0%84%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.9.3.1.</span> <span class="toc-text">åŸºç¡€æ˜ å°„æ³¨è§£</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7%E6%98%A0%E5%B0%84%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.9.3.2.</span> <span class="toc-text">é«˜çº§æ˜ å°„æ³¨è§£</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A8%E6%80%81SQL%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.9.3.3.</span> <span class="toc-text">åŠ¨æ€SQLæ³¨è§£</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-MyBatis%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6"><span class="toc-number">1.9.4.</span> <span class="toc-text">4.4 MyBatisç¼“å­˜æœºåˆ¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-MyBatis%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.9.5.</span> <span class="toc-text">4.5 MyBatiså®é™…åº”ç”¨åœºæ™¯</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF1%EF%BC%9A%E5%A4%8D%E6%9D%82%E6%9F%A5%E8%AF%A2%E5%9C%BA%E6%99%AF"><span class="toc-number">1.9.5.1.</span> <span class="toc-text">åœºæ™¯1ï¼šå¤æ‚æŸ¥è¯¢åœºæ™¯</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF2%EF%BC%9A%E6%89%B9%E9%87%8F%E6%93%8D%E4%BD%9C%E5%9C%BA%E6%99%AF"><span class="toc-number">1.9.5.2.</span> <span class="toc-text">åœºæ™¯2ï¼šæ‰¹é‡æ“ä½œåœºæ™¯</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF3%EF%BC%9A%E5%8A%A8%E6%80%81SQL%E5%9C%BA%E6%99%AF"><span class="toc-number">1.9.5.3.</span> <span class="toc-text">åœºæ™¯3ï¼šåŠ¨æ€SQLåœºæ™¯</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-6-MyBatis%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="toc-number">1.9.6.</span> <span class="toc-text">4.6 MyBatisæ€§èƒ½ä¼˜åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A51%EF%BC%9A%E5%90%88%E7%90%86%E4%BD%BF%E7%94%A8%E7%BC%93%E5%AD%98"><span class="toc-number">1.9.6.1.</span> <span class="toc-text">ä¼˜åŒ–ç­–ç•¥1ï¼šåˆç†ä½¿ç”¨ç¼“å­˜</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A52%EF%BC%9A%E6%89%B9%E9%87%8F%E6%93%8D%E4%BD%9C"><span class="toc-number">1.9.6.2.</span> <span class="toc-text">ä¼˜åŒ–ç­–ç•¥2ï¼šæ‰¹é‡æ“ä½œ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A53%EF%BC%9A%E5%BB%B6%E8%BF%9F%E5%8A%A0%E8%BD%BD"><span class="toc-number">1.9.6.3.</span> <span class="toc-text">ä¼˜åŒ–ç­–ç•¥3ï¼šå»¶è¿ŸåŠ è½½</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-7-MyBatis%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E4%B8%8E%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">1.9.7.</span> <span class="toc-text">4.7 MyBatiså¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%981%EF%BC%9AN-1%E6%9F%A5%E8%AF%A2%E9%97%AE%E9%A2%98"><span class="toc-number">1.9.7.1.</span> <span class="toc-text">é—®é¢˜1ï¼šN+1æŸ¥è¯¢é—®é¢˜</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%982%EF%BC%9A%E5%A4%A7%E6%95%B0%E6%8D%AE%E9%87%8F%E6%9F%A5%E8%AF%A2%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA"><span class="toc-number">1.9.7.2.</span> <span class="toc-text">é—®é¢˜2ï¼šå¤§æ•°æ®é‡æŸ¥è¯¢å†…å­˜æº¢å‡º</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%983%EF%BC%9ASQL%E6%B3%A8%E5%85%A5%E9%98%B2%E6%8A%A4"><span class="toc-number">1.9.7.3.</span> <span class="toc-text">é—®é¢˜3ï¼šSQLæ³¨å…¥é˜²æŠ¤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-8-MyBatis%E9%9D%A2%E8%AF%95%E9%AB%98%E9%A2%91%E9%97%AE%E9%A2%98"><span class="toc-number">1.9.8.</span> <span class="toc-text">4.8 MyBatisé¢è¯•é«˜é¢‘é—®é¢˜</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88%E4%B8%8E%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-number">1.10.</span> <span class="toc-text">äº”ã€æ¡†æ¶æ•´åˆä¸æœ€ä½³å®è·µ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-Spring-Boot-MyBatis%E6%95%B4%E5%90%88"><span class="toc-number">1.10.1.</span> <span class="toc-text">5.1 Spring Boot + MyBatisæ•´åˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%8C%E6%95%B4%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.10.1.1.</span> <span class="toc-text">å®Œæ•´é…ç½®ç¤ºä¾‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86%E9%85%8D%E7%BD%AE"><span class="toc-number">1.10.1.2.</span> <span class="toc-text">äº‹åŠ¡ç®¡ç†é…ç½®</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E7%BB%9F%E4%B8%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-number">1.10.2.</span> <span class="toc-text">5.2 ç»Ÿä¸€å¼‚å¸¸å¤„ç†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3%E4%B8%8E%E9%AA%8C%E8%AF%81"><span class="toc-number">1.10.3.</span> <span class="toc-text">5.3 æ¥å£æ–‡æ¡£ä¸éªŒè¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E4%B8%8E%E4%BC%98%E5%8C%96"><span class="toc-number">1.10.4.</span> <span class="toc-text">5.4 æ€§èƒ½ç›‘æ§ä¸ä¼˜åŒ–</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E7%BB%BC%E5%90%88%E9%A2%98"><span class="toc-number">1.10.5.</span> <span class="toc-text">5.5 é«˜é¢‘é¢è¯•ç»¼åˆé¢˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E5%92%8C%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6"><span class="toc-number">1.10.6.</span> <span class="toc-text">å†…å­˜ç®¡ç†å’Œåƒåœ¾å›æ”¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A0%86%E5%86%85%E5%AD%98%E7%9A%84%E4%BC%A0%E7%BB%9F%E5%88%86%E4%BB%A3%E7%BB%93%E6%9E%84"><span class="toc-number">1.10.7.</span> <span class="toc-text">å †å†…å­˜çš„ä¼ ç»Ÿåˆ†ä»£ç»“æ„</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%B9%B4%E8%BD%BB%E4%BB%A3%EF%BC%88Young-Generation%EF%BC%89"><span class="toc-number">1.10.7.1.</span> <span class="toc-text">1. å¹´è½»ä»£ï¼ˆYoung Generationï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E8%80%81%E5%B9%B4%E4%BB%A3%EF%BC%88Old-Generation%EF%BC%89"><span class="toc-number">1.10.7.2.</span> <span class="toc-text">2. è€å¹´ä»£ï¼ˆOld Generationï¼‰</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E8%BF%87%E7%A8%8B%EF%BC%88%E4%BB%A5-Minor-GC-%E4%B8%BA%E4%BE%8B%EF%BC%89"><span class="toc-number">1.10.8.</span> <span class="toc-text">åƒåœ¾å›æ”¶è¿‡ç¨‹ï¼ˆä»¥ Minor GC ä¸ºä¾‹ï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%B0%E4%BB%A3%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8%EF%BC%88%E5%A6%82-G1-%E5%92%8C-ZGC%EF%BC%89"><span class="toc-number">1.10.9.</span> <span class="toc-text">ç°ä»£åƒåœ¾å›æ”¶å™¨ï¼ˆå¦‚ G1 å’Œ ZGCï¼‰</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81Spring-Cloud%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.11.</span> <span class="toc-text">å…­ã€Spring Cloudä¸åˆ†å¸ƒå¼æŠ€æœ¯è¯¦è§£</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-Spring-Cloud-Alibaba%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6"><span class="toc-number">1.11.1.</span> <span class="toc-text">6.1 Spring Cloud Alibabaæ ¸å¿ƒç»„ä»¶</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Nacos%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90"><span class="toc-number">1.11.1.1.</span> <span class="toc-text">Nacosæ·±åº¦è§£æ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Sentinel%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86"><span class="toc-number">1.11.1.2.</span> <span class="toc-text">Sentinelæ ¸å¿ƒåŸç†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RocketMQ%E9%9B%86%E6%88%90"><span class="toc-number">1.11.1.3.</span> <span class="toc-text">RocketMQé›†æˆ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E5%A2%9E%E5%BC%BA%EF%BC%88Seata%E5%8E%9F%E7%90%86%EF%BC%89"><span class="toc-number">1.11.2.</span> <span class="toc-text">6.2 åˆ†å¸ƒå¼äº‹åŠ¡å¢å¼ºï¼ˆSeataåŸç†ï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#AT%E6%A8%A1%E5%BC%8F%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-number">1.11.2.1.</span> <span class="toc-text">ATæ¨¡å¼å·¥ä½œæµç¨‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#TCC%E6%A8%A1%E5%BC%8F%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-number">1.11.2.2.</span> <span class="toc-text">TCCæ¨¡å¼æœ€ä½³å®è·µ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-%E5%88%86%E5%B8%83%E5%BC%8F%E7%BC%93%E5%AD%98%E6%B7%B1%E5%BA%A6%E4%BC%98%E5%8C%96"><span class="toc-number">1.11.3.</span> <span class="toc-text">6.3 åˆ†å¸ƒå¼ç¼“å­˜æ·±åº¦ä¼˜åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Redis%E5%A4%9A%E7%BA%A7%E7%BC%93%E5%AD%98%E6%9E%B6%E6%9E%84"><span class="toc-number">1.11.3.1.</span> <span class="toc-text">Rediså¤šçº§ç¼“å­˜æ¶æ„</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7"><span class="toc-number">1.11.4.</span> <span class="toc-text">6.4 æ¶ˆæ¯é˜Ÿåˆ—é«˜çº§ç‰¹æ€§</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#RocketMQ%E4%BA%8B%E5%8A%A1%E6%B6%88%E6%81%AF"><span class="toc-number">1.11.4.1.</span> <span class="toc-text">RocketMQäº‹åŠ¡æ¶ˆæ¯</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Kafka%E7%B2%BE%E7%A1%AE%E4%B8%80%E6%AC%A1%E8%AF%AD%E4%B9%89"><span class="toc-number">1.11.4.2.</span> <span class="toc-text">Kafkaç²¾ç¡®ä¸€æ¬¡è¯­ä¹‰</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E4%BA%91%E5%8E%9F%E7%94%9F%E6%94%AF%E6%8C%81%EF%BC%88%E6%96%B0%E5%A2%9E%EF%BC%89"><span class="toc-number">1.12.</span> <span class="toc-text">ä¸ƒã€äº‘åŸç”Ÿæ”¯æŒï¼ˆæ–°å¢ï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-Kubernetes%E9%9B%86%E6%88%90%E6%96%B9%E6%A1%88"><span class="toc-number">1.12.1.</span> <span class="toc-text">7.1 Kubernetesé›†æˆæ–¹æ¡ˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0%E9%80%82%E9%85%8D"><span class="toc-number">1.12.1.1.</span> <span class="toc-text">æœåŠ¡å‘ç°é€‚é…</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86%E6%96%B9%E6%A1%88"><span class="toc-number">1.12.1.2.</span> <span class="toc-text">é…ç½®ç®¡ç†æ–¹æ¡ˆ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-Service-Mesh%E6%95%B4%E5%90%88"><span class="toc-number">1.12.2.</span> <span class="toc-text">7.2 Service Meshæ•´åˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Istio%E6%B5%81%E9%87%8F%E6%B2%BB%E7%90%86"><span class="toc-number">1.12.2.1.</span> <span class="toc-text">Istioæµé‡æ²»ç†</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB%E3%80%81%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E6%B7%B1%E5%BA%A6%E5%AE%9E%E8%B7%B5"><span class="toc-number">1.13.</span> <span class="toc-text">å…«ã€æ€§èƒ½ä¼˜åŒ–æ·±åº¦å®è·µ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-%E5%85%A8%E9%93%BE%E8%B7%AF%E5%8E%8B%E6%B5%8B%E6%96%B9%E6%A1%88"><span class="toc-number">1.13.1.</span> <span class="toc-text">8.1 å…¨é“¾è·¯å‹æµ‹æ–¹æ¡ˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BD%B1%E5%AD%90%E5%BA%93%E8%A1%A8%E9%85%8D%E7%BD%AE"><span class="toc-number">1.13.1.1.</span> <span class="toc-text">å½±å­åº“è¡¨é…ç½®</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%81%E9%87%8F%E6%9F%93%E8%89%B2%E6%A0%87%E8%AE%B0"><span class="toc-number">1.13.1.2.</span> <span class="toc-text">æµé‡æŸ“è‰²æ ‡è®°</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/11/8.21%E5%AD%A6%E4%BC%9A/" title="8.21å­¦ä¼š">8.21å­¦ä¼š</a><time datetime="2025-09-11T10:29:28.000Z" title="å‘è¡¨äº 2025-09-11 18:29:28">2025-09-11</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/11/%E5%91%BD%E4%BB%A4%E5%A4%A7%E5%85%A8/" title="å‘½ä»¤å¤§å…¨">å‘½ä»¤å¤§å…¨</a><time datetime="2025-09-11T10:29:28.000Z" title="å‘è¡¨äº 2025-09-11 18:29:28">2025-09-11</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/11/%E5%88%86%E5%B8%83%E5%BC%8F/" title="åˆ†å¸ƒå¼">åˆ†å¸ƒå¼</a><time datetime="2025-09-11T10:29:28.000Z" title="å‘è¡¨äº 2025-09-11 18:29:28">2025-09-11</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/11/%E6%A1%86%E6%9E%B6/" title="æ¡†æ¶">æ¡†æ¶</a><time datetime="2025-09-11T10:29:28.000Z" title="å‘è¡¨äº 2025-09-11 18:29:28">2025-09-11</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/11/%E6%89%8B%E5%86%99%E7%AD%94%E6%A1%88/" title="æ‰‹å†™ç­”æ¡ˆ">æ‰‹å†™ç­”æ¡ˆ</a><time datetime="2025-09-11T10:29:28.000Z" title="å‘è¡¨äº 2025-09-11 18:29:28">2025-09-11</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/bg.jpg);"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By Charlotte</span><span class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.0</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æ—¥é—´å’Œå¤œé—´æ¨¡å¼åˆ‡æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script src="/js/custom.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>