<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>æ•°æ®ç»“æ„</title>
      <link href="/2025/09/20/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
      <url>/2025/09/20/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/</url>
      
        <content type="html"><![CDATA[<hr><h1 id="1-æ•°ç»„-Array"><a href="#1-æ•°ç»„-Array" class="headerlink" title="1. æ•°ç»„ (Array)"></a>1. æ•°ç»„ (Array)</h1><p><strong>ç‰¹ç‚¹</strong>ï¼šè¿ç»­å†…å­˜ï¼Œéšæœºè®¿é—® O(1)ï¼Œæ’å…¥&#x2F;åˆ é™¤ O(n)ã€‚</p><h3 id="å¸¸è§æ“ä½œ"><a href="#å¸¸è§æ“ä½œ" class="headerlink" title="å¸¸è§æ“ä½œ"></a>å¸¸è§æ“ä½œ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// éå†</span></span><br><span class="line"><span class="type">int</span>[] arr = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; arr.length; i++) System.out.print(arr[i] + <span class="string">&quot; &quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŸ¥æ‰¾ï¼ˆçº¿æ€§æŸ¥æ‰¾ï¼‰</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">find</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (arr[i] == target) <span class="keyword">return</span> i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ’å…¥ï¼ˆæŒ‡å®šä½ç½®ï¼‰</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[] insert(<span class="type">int</span>[] arr, <span class="type">int</span> pos, <span class="type">int</span> val) &#123;</span><br><span class="line">    <span class="type">int</span>[] newArr = <span class="keyword">new</span> <span class="title class_">int</span>[arr.length + <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, j = <span class="number">0</span>; i &lt; newArr.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i == pos) newArr[i] = val;</span><br><span class="line">        <span class="keyword">else</span> newArr[i] = arr[j++];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> newArr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ é™¤ï¼ˆæŒ‡å®šä½ç½®ï¼‰</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[] delete(<span class="type">int</span>[] arr, <span class="type">int</span> pos) &#123;</span><br><span class="line">    <span class="type">int</span>[] newArr = <span class="keyword">new</span> <span class="title class_">int</span>[arr.length - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, j = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i == pos) <span class="keyword">continue</span>;</span><br><span class="line">        newArr[j++] = arr[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> newArr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åè½¬</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">reverse</span><span class="params">(<span class="type">int</span>[] arr)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, j = arr.length - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; j) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">tmp</span> <span class="operator">=</span> arr[i]; arr[i] = arr[j]; arr[j] = tmp;</span><br><span class="line">        i++; j--;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h1 id="2-é“¾è¡¨-Linked-List"><a href="#2-é“¾è¡¨-Linked-List" class="headerlink" title="2. é“¾è¡¨ (Linked List)"></a>2. é“¾è¡¨ (Linked List)</h1><p><strong>ç‰¹ç‚¹</strong>ï¼šåŠ¨æ€å­˜å‚¨ï¼Œæ’å…¥&#x2F;åˆ é™¤ O(1)ï¼Œéšæœºè®¿é—® O(n)ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ListNode</span> &#123;</span><br><span class="line">    <span class="type">int</span> val;</span><br><span class="line">    ListNode next;</span><br><span class="line">    ListNode(<span class="type">int</span> val) &#123; <span class="built_in">this</span>.val = val; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// éå†</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">traverse</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">ListNode</span> <span class="variable">p</span> <span class="operator">=</span> head; p != <span class="literal">null</span>; p = p.next)</span><br><span class="line">        System.out.print(p.val + <span class="string">&quot; &quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ’å…¥ï¼ˆå¤´æ’ï¼‰</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ListNode <span class="title function_">insertHead</span><span class="params">(ListNode head, <span class="type">int</span> val)</span> &#123;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">node</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(val);</span><br><span class="line">    node.next = head;</span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ’å…¥ï¼ˆæŒ‡å®šèŠ‚ç‚¹åï¼‰</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">insertAfter</span><span class="params">(ListNode node, <span class="type">int</span> val)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">newNode</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(val);</span><br><span class="line">    newNode.next = node.next;</span><br><span class="line">    node.next = newNode;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ é™¤ï¼ˆæŒ‰å€¼ï¼‰</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ListNode <span class="title function_">delete</span><span class="params">(ListNode head, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (head == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (head.val == target) <span class="keyword">return</span> head.next;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">p</span> <span class="operator">=</span> head;</span><br><span class="line">    <span class="keyword">while</span> (p.next != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (p.next.val == target) &#123;</span><br><span class="line">            p.next = p.next.next; <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        p = p.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> head;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åè½¬</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ListNode <span class="title function_">reverse</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">prev</span> <span class="operator">=</span> <span class="literal">null</span>, curr = head;</span><br><span class="line">    <span class="keyword">while</span> (curr != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">next</span> <span class="operator">=</span> curr.next;</span><br><span class="line">        curr.next = prev;</span><br><span class="line">        prev = curr;</span><br><span class="line">        curr = next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> prev;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h1 id="3-æ ˆ-Stack"><a href="#3-æ ˆ-Stack" class="headerlink" title="3. æ ˆ (Stack)"></a>3. æ ˆ (Stack)</h1><p><strong>ç‰¹ç‚¹</strong>ï¼šLIFOï¼Œå¸¸ç”¨æ•°ç»„æˆ–é“¾è¡¨å®ç°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyStack</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> LinkedList&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">push</span><span class="params">(<span class="type">int</span> val)</span> &#123; list.addLast(val); &#125; <span class="comment">// å…¥æ ˆ</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">pop</span><span class="params">()</span> &#123; <span class="keyword">return</span> list.removeLast(); &#125;   <span class="comment">// å‡ºæ ˆ</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">peek</span><span class="params">()</span> &#123; <span class="keyword">return</span> list.getLast(); &#125;     <span class="comment">// æŸ¥çœ‹æ ˆé¡¶</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">()</span> &#123; <span class="keyword">return</span> list.isEmpty(); &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h1 id="4-é˜Ÿåˆ—-Queue"><a href="#4-é˜Ÿåˆ—-Queue" class="headerlink" title="4. é˜Ÿåˆ— (Queue)"></a>4. é˜Ÿåˆ— (Queue)</h1><p><strong>ç‰¹ç‚¹</strong>ï¼šFIFOï¼Œå¯ä»¥ç”¨é“¾è¡¨æˆ–å¾ªç¯æ•°ç»„å®ç°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyQueue</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> LinkedList&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">enqueue</span><span class="params">(<span class="type">int</span> val)</span> &#123; list.addLast(val); &#125; <span class="comment">// å…¥é˜Ÿ</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">dequeue</span><span class="params">()</span> &#123; <span class="keyword">return</span> list.removeFirst(); &#125; <span class="comment">// å‡ºé˜Ÿ</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">peek</span><span class="params">()</span> &#123; <span class="keyword">return</span> list.getFirst(); &#125;       <span class="comment">// æŸ¥çœ‹é˜Ÿé¦–</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">()</span> &#123; <span class="keyword">return</span> list.isEmpty(); &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åŒç«¯é˜Ÿåˆ— Deque</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Deque&lt;Integer&gt; deque = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">deque.addFirst(<span class="number">1</span>); <span class="comment">// å¤´æ’</span></span><br><span class="line">deque.addLast(<span class="number">2</span>);  <span class="comment">// å°¾æ’</span></span><br><span class="line">deque.removeFirst();</span><br><span class="line">deque.removeLast();</span><br></pre></td></tr></table></figure><hr><h1 id="5-æ ‘-Tree"><a href="#5-æ ‘-Tree" class="headerlink" title="5. æ ‘ (Tree)"></a>5. æ ‘ (Tree)</h1><p>ä»¥ <strong>äºŒå‰æ ‘</strong> ä¸ºä¾‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TreeNode</span> &#123;</span><br><span class="line">    <span class="type">int</span> val;</span><br><span class="line">    TreeNode left, right;</span><br><span class="line">    TreeNode(<span class="type">int</span> val) &#123; <span class="built_in">this</span>.val = val; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‰åºéå† (æ ¹-å·¦-å³)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">preorder</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (root == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">    System.out.print(root.val + <span class="string">&quot; &quot;</span>);</span><br><span class="line">    preorder(root.left);</span><br><span class="line">    preorder(root.right);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸­åºéå† (å·¦-æ ¹-å³)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">inorder</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (root == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">    inorder(root.left);</span><br><span class="line">    System.out.print(root.val + <span class="string">&quot; &quot;</span>);</span><br><span class="line">    inorder(root.right);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ååºéå† (å·¦-å³-æ ¹)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">postorder</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (root == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">    postorder(root.left);</span><br><span class="line">    postorder(root.right);</span><br><span class="line">    System.out.print(root.val + <span class="string">&quot; &quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å±‚åºéå† (BFS)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">levelOrder</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (root == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">    Queue&lt;TreeNode&gt; q = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    q.add(root);</span><br><span class="line">    <span class="keyword">while</span> (!q.isEmpty()) &#123;</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">node</span> <span class="operator">=</span> q.poll();</span><br><span class="line">        System.out.print(node.val + <span class="string">&quot; &quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (node.left != <span class="literal">null</span>) q.add(node.left);</span><br><span class="line">        <span class="keyword">if</span> (node.right != <span class="literal">null</span>) q.add(node.right);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h1 id="6-å †-Heap"><a href="#6-å †-Heap" class="headerlink" title="6. å † (Heap)"></a>6. å † (Heap)</h1><p>å¸¸ç”¨ <strong>æœ€å°å † &#x2F; æœ€å¤§å †</strong>ï¼Œä¸€èˆ¬ç”¨æ•°ç»„å®ç°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.PriorityQueue;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æœ€å°å †</span></span><br><span class="line">PriorityQueue&lt;Integer&gt; minHeap = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;();</span><br><span class="line">minHeap.add(<span class="number">3</span>);</span><br><span class="line">minHeap.add(<span class="number">1</span>);</span><br><span class="line">minHeap.add(<span class="number">5</span>);</span><br><span class="line">System.out.println(minHeap.poll()); <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æœ€å¤§å †</span></span><br><span class="line">PriorityQueue&lt;Integer&gt; maxHeap = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;((a, b) -&gt; b - a);</span><br><span class="line">maxHeap.add(<span class="number">3</span>);</span><br><span class="line">maxHeap.add(<span class="number">1</span>);</span><br><span class="line">maxHeap.add(<span class="number">5</span>);</span><br><span class="line">System.out.println(maxHeap.poll()); <span class="comment">// 5</span></span><br></pre></td></tr></table></figure><hr><h1 id="7-å›¾-Graph"><a href="#7-å›¾-Graph" class="headerlink" title="7. å›¾ (Graph)"></a>7. å›¾ (Graph)</h1><p>å¸¸è§è¡¨ç¤ºï¼š<strong>é‚»æ¥è¡¨</strong>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Graph</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;Integer, List&lt;Integer&gt;&gt; adj = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addEdge</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v)</span> &#123;</span><br><span class="line">        adj.computeIfAbsent(u, k -&gt; <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;()).add(v);</span><br><span class="line">        adj.computeIfAbsent(v, k -&gt; <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;()).add(u); <span class="comment">// æ— å‘å›¾</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// BFS éå†</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">bfs</span><span class="params">(<span class="type">int</span> start)</span> &#123;</span><br><span class="line">        Set&lt;Integer&gt; visited = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        Queue&lt;Integer&gt; q = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        q.add(start);</span><br><span class="line">        visited.add(start);</span><br><span class="line">        <span class="keyword">while</span> (!q.isEmpty()) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">node</span> <span class="operator">=</span> q.poll();</span><br><span class="line">            System.out.print(node + <span class="string">&quot; &quot;</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> nei : adj.getOrDefault(node, <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;())) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!visited.contains(nei)) &#123;</span><br><span class="line">                    visited.add(nei);</span><br><span class="line">                    q.add(nei);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// DFS éå†</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">dfs</span><span class="params">(<span class="type">int</span> start)</span> &#123;</span><br><span class="line">        Set&lt;Integer&gt; visited = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        dfsHelper(start, visited);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">dfsHelper</span><span class="params">(<span class="type">int</span> node, Set&lt;Integer&gt; visited)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (visited.contains(node)) <span class="keyword">return</span>;</span><br><span class="line">        visited.add(node);</span><br><span class="line">        System.out.print(node + <span class="string">&quot; &quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> nei : adj.getOrDefault(node, <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;())) &#123;</span><br><span class="line">            dfsHelper(nei, visited);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
            <tag> æ•°æ®ç»“æ„ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å‘½ä»¤å¤§å…¨</title>
      <link href="/2025/09/11/%E5%91%BD%E4%BB%A4%E5%A4%A7%E5%85%A8/"/>
      <url>/2025/09/11/%E5%91%BD%E4%BB%A4%E5%A4%A7%E5%85%A8/</url>
      
        <content type="html"><![CDATA[<hr><h1 id="ğŸ“Œ-ä¸€ã€Linux-å¸¸è§å‘½ä»¤å¤§å…¨"><a href="#ğŸ“Œ-ä¸€ã€Linux-å¸¸è§å‘½ä»¤å¤§å…¨" class="headerlink" title="ğŸ“Œ ä¸€ã€Linux å¸¸è§å‘½ä»¤å¤§å…¨"></a>ğŸ“Œ ä¸€ã€Linux å¸¸è§å‘½ä»¤å¤§å…¨</h1><h3 id="ğŸ”¹-æ–‡ä»¶ä¸ç›®å½•æ“ä½œ"><a href="#ğŸ”¹-æ–‡ä»¶ä¸ç›®å½•æ“ä½œ" class="headerlink" title="ğŸ”¹ æ–‡ä»¶ä¸ç›®å½•æ“ä½œ"></a>ğŸ”¹ æ–‡ä»¶ä¸ç›®å½•æ“ä½œ</h3><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>ls</code></td><td>åˆ—å‡ºç›®å½•å†…å®¹</td><td><code>ls -al</code> æ˜¾ç¤ºéšè—æ–‡ä»¶å’Œè¯¦ç»†ä¿¡æ¯</td></tr><tr><td><code>pwd</code></td><td>æ˜¾ç¤ºå½“å‰ç›®å½•</td><td><code>pwd</code></td></tr><tr><td><code>cd</code></td><td>åˆ‡æ¢ç›®å½•</td><td><code>cd /usr/local</code></td></tr><tr><td><code>mkdir</code></td><td>åˆ›å»ºç›®å½•</td><td><code>mkdir -p /data/logs</code></td></tr><tr><td><code>rmdir</code></td><td>åˆ é™¤ç©ºç›®å½•</td><td><code>rmdir old</code></td></tr><tr><td><code>rm</code></td><td>åˆ é™¤æ–‡ä»¶&#x2F;ç›®å½•</td><td><code>rm -rf /tmp/test</code></td></tr><tr><td><code>cp</code></td><td>å¤åˆ¶æ–‡ä»¶&#x2F;ç›®å½•</td><td><code>cp a.txt /tmp/</code>ï¼Œ<code>cp -r dir1 dir2</code></td></tr><tr><td><code>mv</code></td><td>ç§»åŠ¨&#x2F;é‡å‘½å</td><td><code>mv old.txt new.txt</code></td></tr><tr><td><code>find</code></td><td>æŸ¥æ‰¾æ–‡ä»¶</td><td><code>find / -name &quot;*.log&quot;</code></td></tr><tr><td><code>locate</code></td><td>å¿«é€ŸæŸ¥æ‰¾æ–‡ä»¶ï¼ˆéœ€ <code>updatedb</code>ï¼‰</td><td><code>locate nginx.conf</code></td></tr></tbody></table><hr><h3 id="ğŸ”¹-æ–‡ä»¶æŸ¥çœ‹ä¸ç¼–è¾‘"><a href="#ğŸ”¹-æ–‡ä»¶æŸ¥çœ‹ä¸ç¼–è¾‘" class="headerlink" title="ğŸ”¹ æ–‡ä»¶æŸ¥çœ‹ä¸ç¼–è¾‘"></a>ğŸ”¹ æ–‡ä»¶æŸ¥çœ‹ä¸ç¼–è¾‘</h3><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>cat</code></td><td>æŸ¥çœ‹æ–‡ä»¶å†…å®¹</td><td><code>cat file.txt</code></td></tr><tr><td><code>tac</code></td><td>åå‘è¾“å‡º</td><td><code>tac file.txt</code></td></tr><tr><td><code>less</code></td><td>åˆ†é¡µæŸ¥çœ‹</td><td><code>less /var/log/syslog</code></td></tr><tr><td><code>head</code></td><td>æŸ¥çœ‹å‰ N è¡Œ</td><td><code>head -n 20 file.log</code></td></tr><tr><td><code>tail</code></td><td>æŸ¥çœ‹æœ«å°¾ N è¡Œ</td><td><code>tail -f app.log</code> å®æ—¶è·Ÿè¸ª</td></tr><tr><td><code>wc</code></td><td>ç»Ÿè®¡è¡Œã€å­—æ•°ã€å­—ç¬¦æ•°</td><td><code>wc -l file.txt</code></td></tr><tr><td><code>nano/vim</code></td><td>ç¼–è¾‘æ–‡ä»¶</td><td><code>vim nginx.conf</code></td></tr></tbody></table><hr><h3 id="ğŸ”¹-ç”¨æˆ·ä¸æƒé™"><a href="#ğŸ”¹-ç”¨æˆ·ä¸æƒé™" class="headerlink" title="ğŸ”¹ ç”¨æˆ·ä¸æƒé™"></a>ğŸ”¹ ç”¨æˆ·ä¸æƒé™</h3><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>whoami</code></td><td>å½“å‰ç”¨æˆ·</td><td><code>whoami</code></td></tr><tr><td><code>id</code></td><td>ç”¨æˆ· ID å’Œç»„ ID</td><td><code>id root</code></td></tr><tr><td><code>useradd</code></td><td>æ–°å»ºç”¨æˆ·</td><td><code>useradd -m testuser</code></td></tr><tr><td><code>passwd</code></td><td>ä¿®æ”¹å¯†ç </td><td><code>passwd testuser</code></td></tr><tr><td><code>su</code></td><td>åˆ‡æ¢ç”¨æˆ·</td><td><code>su - testuser</code></td></tr><tr><td><code>sudo</code></td><td>ä»¥ root æƒé™æ‰§è¡Œ</td><td><code>sudo apt update</code></td></tr><tr><td><code>chmod</code></td><td>ä¿®æ”¹æƒé™</td><td><code>chmod 755 file.sh</code></td></tr><tr><td><code>chown</code></td><td>ä¿®æ”¹å±ä¸»</td><td><code>chown user:group file.txt</code></td></tr></tbody></table><hr><h3 id="ğŸ”¹-ç³»ç»Ÿç®¡ç†"><a href="#ğŸ”¹-ç³»ç»Ÿç®¡ç†" class="headerlink" title="ğŸ”¹ ç³»ç»Ÿç®¡ç†"></a>ğŸ”¹ ç³»ç»Ÿç®¡ç†</h3><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>ps</code></td><td>æŸ¥çœ‹è¿›ç¨‹</td><td>&#96;ps -ef</td></tr><tr><td><code>top</code></td><td>å®æ—¶æŸ¥çœ‹è¿›ç¨‹</td><td><code>top</code></td></tr><tr><td><code>htop</code></td><td>é«˜çº§ topï¼ˆéœ€å®‰è£…ï¼‰</td><td><code>htop</code></td></tr><tr><td><code>kill</code></td><td>æ€è¿›ç¨‹</td><td><code>kill -9 1234</code></td></tr><tr><td><code>df -h</code></td><td>æŸ¥çœ‹ç£ç›˜ä½¿ç”¨</td><td><code>df -h</code></td></tr><tr><td><code>du -sh</code></td><td>æŸ¥çœ‹ç›®å½•å¤§å°</td><td><code>du -sh /var/log</code></td></tr><tr><td><code>free -h</code></td><td>æŸ¥çœ‹å†…å­˜ä½¿ç”¨</td><td><code>free -h</code></td></tr><tr><td><code>uptime</code></td><td>ç³»ç»Ÿè¿è¡Œæ—¶é•¿</td><td><code>uptime</code></td></tr><tr><td><code>uname -a</code></td><td>ç³»ç»Ÿä¿¡æ¯</td><td><code>uname -a</code></td></tr><tr><td><code>shutdown -h now</code></td><td>ç«‹åˆ»å…³æœº</td><td><code>shutdown -r now</code> é‡å¯</td></tr></tbody></table><hr><h3 id="ğŸ”¹-ç½‘ç»œç›¸å…³"><a href="#ğŸ”¹-ç½‘ç»œç›¸å…³" class="headerlink" title="ğŸ”¹ ç½‘ç»œç›¸å…³"></a>ğŸ”¹ ç½‘ç»œç›¸å…³</h3><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>ping</code></td><td>æµ‹è¯•ç½‘ç»œè¿é€š</td><td><code>ping www.baidu.com</code></td></tr><tr><td><code>curl</code></td><td>è¯·æ±‚ URL</td><td><code>curl -I https://www.baidu.com</code></td></tr><tr><td><code>wget</code></td><td>ä¸‹è½½æ–‡ä»¶</td><td><code>wget http://example.com/file.zip</code></td></tr><tr><td><code>netstat -tulnp</code></td><td>æŸ¥çœ‹ç«¯å£å ç”¨</td><td>&#96;netstat -tulnp</td></tr><tr><td><code>ss -lntp</code></td><td>æ›´å¿«çš„ç«¯å£æŸ¥è¯¢</td><td><code>ss -lntp</code></td></tr><tr><td><code>scp</code></td><td>è¿œç¨‹æ‹·è´æ–‡ä»¶</td><td><code>scp file.txt user@host:/path/</code></td></tr><tr><td><code>ssh</code></td><td>ç™»å½•è¿œç¨‹ä¸»æœº</td><td><code>ssh user@192.168.1.1</code></td></tr></tbody></table><hr><h1 id="ğŸ“Œ-äºŒã€MySQL-å¸¸è§å‘½ä»¤å¤§å…¨"><a href="#ğŸ“Œ-äºŒã€MySQL-å¸¸è§å‘½ä»¤å¤§å…¨" class="headerlink" title="ğŸ“Œ äºŒã€MySQL å¸¸è§å‘½ä»¤å¤§å…¨"></a>ğŸ“Œ äºŒã€MySQL å¸¸è§å‘½ä»¤å¤§å…¨</h1><h3 id="ğŸ”¹-ç™»å½•ä¸åŸºæœ¬æ“ä½œ"><a href="#ğŸ”¹-ç™»å½•ä¸åŸºæœ¬æ“ä½œ" class="headerlink" title="ğŸ”¹ ç™»å½•ä¸åŸºæœ¬æ“ä½œ"></a>ğŸ”¹ ç™»å½•ä¸åŸºæœ¬æ“ä½œ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p               <span class="comment"># ç™»å½• MySQL</span></span><br><span class="line">mysql -h 127.0.0.1 -P 3306 -u root -p   <span class="comment"># æŒ‡å®šåœ°å€ç«¯å£</span></span><br><span class="line"><span class="built_in">exit</span>;                          <span class="comment"># é€€å‡º</span></span><br></pre></td></tr></table></figure><h3 id="ğŸ”¹-æ•°æ®åº“æ“ä½œ"><a href="#ğŸ”¹-æ•°æ®åº“æ“ä½œ" class="headerlink" title="ğŸ”¹ æ•°æ®åº“æ“ä½œ"></a>ğŸ”¹ æ•°æ®åº“æ“ä½œ</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> DATABASES;                <span class="comment">-- æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“</span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE testdb;        <span class="comment">-- åˆ›å»ºæ•°æ®åº“</span></span><br><span class="line"><span class="keyword">DROP</span> DATABASE testdb;          <span class="comment">-- åˆ é™¤æ•°æ®åº“</span></span><br><span class="line">USE testdb;                    <span class="comment">-- åˆ‡æ¢æ•°æ®åº“</span></span><br></pre></td></tr></table></figure><h3 id="ğŸ”¹-è¡¨æ“ä½œ"><a href="#ğŸ”¹-è¡¨æ“ä½œ" class="headerlink" title="ğŸ”¹ è¡¨æ“ä½œ"></a>ğŸ”¹ è¡¨æ“ä½œ</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> TABLES;                               <span class="comment">-- æŸ¥çœ‹è¡¨</span></span><br><span class="line"><span class="keyword">DESCRIBE</span> users;                            <span class="comment">-- æŸ¥çœ‹è¡¨ç»“æ„</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">INT</span> AUTO_INCREMENT <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    age <span class="type">INT</span></span><br><span class="line">);                                         <span class="comment">-- åˆ›å»ºè¡¨</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> users;                          <span class="comment">-- åˆ é™¤è¡¨</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> users <span class="keyword">ADD</span> email <span class="type">VARCHAR</span>(<span class="number">100</span>);  <span class="comment">-- å¢åŠ åˆ—</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> users <span class="keyword">DROP</span> <span class="keyword">COLUMN</span> email;       <span class="comment">-- åˆ é™¤åˆ—</span></span><br></pre></td></tr></table></figure><h3 id="ğŸ”¹-æ•°æ®æ“ä½œ-CRUD"><a href="#ğŸ”¹-æ•°æ®æ“ä½œ-CRUD" class="headerlink" title="ğŸ”¹ æ•°æ®æ“ä½œ (CRUD)"></a>ğŸ”¹ æ•°æ®æ“ä½œ (CRUD)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT INTO</span> users(name, age) <span class="keyword">VALUES</span>(<span class="string">&#x27;Tom&#x27;</span>, <span class="number">20</span>);  <span class="comment">-- æ’å…¥</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users;                             <span class="comment">-- æŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">SELECT</span> name, age <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> age <span class="operator">&gt;</span> <span class="number">18</span>;      <span class="comment">-- æ¡ä»¶æŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">UPDATE</span> users <span class="keyword">SET</span> age <span class="operator">=</span> <span class="number">25</span> <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;Tom&#x27;</span>;    <span class="comment">-- æ›´æ–°</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;Tom&#x27;</span>;            <span class="comment">-- åˆ é™¤</span></span><br></pre></td></tr></table></figure><h3 id="ğŸ”¹-ç”¨æˆ·ä¸æƒé™-1"><a href="#ğŸ”¹-ç”¨æˆ·ä¸æƒé™-1" class="headerlink" title="ğŸ”¹ ç”¨æˆ·ä¸æƒé™"></a>ğŸ”¹ ç”¨æˆ·ä¸æƒé™</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;test&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;123456&#x27;</span>;       <span class="comment">-- åˆ›å»ºç”¨æˆ·</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> PRIVILEGES <span class="keyword">ON</span> testdb.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;test&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;      <span class="comment">-- æˆæƒ</span></span><br><span class="line"><span class="keyword">REVOKE</span> <span class="keyword">ALL</span> PRIVILEGES <span class="keyword">ON</span> testdb.<span class="operator">*</span> <span class="keyword">FROM</span> <span class="string">&#x27;test&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;   <span class="comment">-- å›æ”¶æƒé™</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">USER</span> <span class="string">&#x27;test&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;                                <span class="comment">-- åˆ é™¤ç”¨æˆ·</span></span><br><span class="line">FLUSH PRIVILEGES;                                    <span class="comment">-- åˆ·æ–°æƒé™</span></span><br></pre></td></tr></table></figure><h3 id="ğŸ”¹-å¤‡ä»½ä¸æ¢å¤"><a href="#ğŸ”¹-å¤‡ä»½ä¸æ¢å¤" class="headerlink" title="ğŸ”¹ å¤‡ä»½ä¸æ¢å¤"></a>ğŸ”¹ å¤‡ä»½ä¸æ¢å¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -u root -p testdb &gt; testdb.sql     <span class="comment"># å¯¼å‡ºæ•°æ®åº“</span></span><br><span class="line">mysqldump -u root -p --all-databases &gt; all.sql</span><br><span class="line">mysql -u root -p testdb &lt; testdb.sql         <span class="comment"># å¯¼å…¥æ•°æ®åº“</span></span><br></pre></td></tr></table></figure><hr><h1 id="ğŸ“Œ-ä¸‰ã€Git-å¸¸è§å‘½ä»¤å¤§å…¨"><a href="#ğŸ“Œ-ä¸‰ã€Git-å¸¸è§å‘½ä»¤å¤§å…¨" class="headerlink" title="ğŸ“Œ ä¸‰ã€Git å¸¸è§å‘½ä»¤å¤§å…¨"></a>ğŸ“Œ ä¸‰ã€Git å¸¸è§å‘½ä»¤å¤§å…¨</h1><h3 id="ğŸ”¹-åŸºç¡€é…ç½®"><a href="#ğŸ”¹-åŸºç¡€é…ç½®" class="headerlink" title="ğŸ”¹ åŸºç¡€é…ç½®"></a>ğŸ”¹ åŸºç¡€é…ç½®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name <span class="string">&quot;YourName&quot;</span></span><br><span class="line">git config --global user.email <span class="string">&quot;you@example.com&quot;</span></span><br><span class="line">git config --list       <span class="comment"># æŸ¥çœ‹é…ç½®</span></span><br></pre></td></tr></table></figure><h3 id="ğŸ”¹-ä»“åº“æ“ä½œ"><a href="#ğŸ”¹-ä»“åº“æ“ä½œ" class="headerlink" title="ğŸ”¹ ä»“åº“æ“ä½œ"></a>ğŸ”¹ ä»“åº“æ“ä½œ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git init                          <span class="comment"># åˆå§‹åŒ–ä»“åº“</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/xxx.git  <span class="comment"># å…‹éš†ä»“åº“</span></span><br><span class="line">git remote -v                     <span class="comment"># æŸ¥çœ‹è¿œç¨‹ä»“åº“</span></span><br><span class="line">git remote add origin git@github.com:xxx.git  <span class="comment"># æ·»åŠ è¿œç¨‹ä»“åº“</span></span><br></pre></td></tr></table></figure><h3 id="ğŸ”¹-æ–‡ä»¶æ“ä½œ"><a href="#ğŸ”¹-æ–‡ä»¶æ“ä½œ" class="headerlink" title="ğŸ”¹ æ–‡ä»¶æ“ä½œ"></a>ğŸ”¹ æ–‡ä»¶æ“ä½œ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git status        <span class="comment"># æŸ¥çœ‹çŠ¶æ€</span></span><br><span class="line">git add file.txt  <span class="comment"># æ·»åŠ æ–‡ä»¶</span></span><br><span class="line">git add .         <span class="comment"># æ·»åŠ æ‰€æœ‰æ–‡ä»¶</span></span><br><span class="line">git commit -m <span class="string">&quot;æè¿°&quot;</span>   <span class="comment"># æäº¤</span></span><br><span class="line">git diff          <span class="comment"># æŸ¥çœ‹ä¿®æ”¹</span></span><br><span class="line">git <span class="built_in">log</span>           <span class="comment"># æŸ¥çœ‹æäº¤å†å²</span></span><br><span class="line">git reset --hard HEAD^   <span class="comment"># å›é€€ä¸Šä¸€ä¸ªç‰ˆæœ¬</span></span><br></pre></td></tr></table></figure><h3 id="ğŸ”¹-åˆ†æ”¯æ“ä½œ"><a href="#ğŸ”¹-åˆ†æ”¯æ“ä½œ" class="headerlink" title="ğŸ”¹ åˆ†æ”¯æ“ä½œ"></a>ğŸ”¹ åˆ†æ”¯æ“ä½œ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git branch                  <span class="comment"># æŸ¥çœ‹åˆ†æ”¯</span></span><br><span class="line">git branch new-feature      <span class="comment"># æ–°å»ºåˆ†æ”¯</span></span><br><span class="line">git checkout new-feature    <span class="comment"># åˆ‡æ¢åˆ†æ”¯</span></span><br><span class="line">git checkout -b dev         <span class="comment"># æ–°å»ºå¹¶åˆ‡æ¢</span></span><br><span class="line">git merge dev               <span class="comment"># åˆå¹¶åˆ†æ”¯</span></span><br><span class="line">git branch -d dev           <span class="comment"># åˆ é™¤åˆ†æ”¯</span></span><br></pre></td></tr></table></figure><h3 id="ğŸ”¹-è¿œç¨‹ä»“åº“"><a href="#ğŸ”¹-è¿œç¨‹ä»“åº“" class="headerlink" title="ğŸ”¹ è¿œç¨‹ä»“åº“"></a>ğŸ”¹ è¿œç¨‹ä»“åº“</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git pull origin main        <span class="comment"># æ‹‰å–ä»£ç </span></span><br><span class="line">git push origin main        <span class="comment"># æ¨é€ä»£ç </span></span><br><span class="line">git push -u origin main     <span class="comment"># å…³è”è¿œç¨‹åˆ†æ”¯å¹¶æ¨é€</span></span><br><span class="line">git fetch origin            <span class="comment"># è·å–æœ€æ–°åˆ†æ”¯ä¿¡æ¯</span></span><br></pre></td></tr></table></figure><h3 id="ğŸ”¹-æ ‡ç­¾ç®¡ç†"><a href="#ğŸ”¹-æ ‡ç­¾ç®¡ç†" class="headerlink" title="ğŸ”¹ æ ‡ç­¾ç®¡ç†"></a>ğŸ”¹ æ ‡ç­¾ç®¡ç†</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git tag v1.0                        <span class="comment"># æ‰“æ ‡ç­¾</span></span><br><span class="line">git tag                             <span class="comment"># æŸ¥çœ‹æ ‡ç­¾</span></span><br><span class="line">git push origin v1.0                <span class="comment"># æ¨é€æ ‡ç­¾</span></span><br><span class="line">git push origin --tags              <span class="comment"># æ¨é€æ‰€æœ‰æ ‡ç­¾</span></span><br><span class="line">git tag -d v1.0                     <span class="comment"># åˆ é™¤æœ¬åœ°æ ‡ç­¾</span></span><br><span class="line">git push origin :refs/tags/v1.0     <span class="comment"># åˆ é™¤è¿œç¨‹æ ‡ç­¾</span></span><br></pre></td></tr></table></figure><hr>]]></content>
      
      
      <categories>
          
          <category> å‘½ä»¤ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mysql </tag>
            
            <tag> Linux </tag>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¢˜å•</title>
      <link href="/2025/09/11/%E9%A2%98%E5%8D%95/"/>
      <url>/2025/09/11/%E9%A2%98%E5%8D%95/</url>
      
        <content type="html"><![CDATA[<hr><h2 id="ğŸ”¹-æ•°ç»„ï¼ˆArrayï¼‰"><a href="#ğŸ”¹-æ•°ç»„ï¼ˆArrayï¼‰" class="headerlink" title="ğŸ”¹ æ•°ç»„ï¼ˆArrayï¼‰"></a>ğŸ”¹ æ•°ç»„ï¼ˆArrayï¼‰</h2><h3 id="1-ä¸¤æ•°ä¹‹å’Œ"><a href="#1-ä¸¤æ•°ä¹‹å’Œ" class="headerlink" title="1. ä¸¤æ•°ä¹‹å’Œ"></a>1. ä¸¤æ•°ä¹‹å’Œ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span>[] twoSum(<span class="type">int</span>[] nums, <span class="type">int</span> target) &#123;</span><br><span class="line">    Map&lt;Integer, Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">diff</span> <span class="operator">=</span> target - nums[i];</span><br><span class="line">        <span class="keyword">if</span> (map.containsKey(diff)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;map.get(diff), i&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        map.put(nums[i], i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-æœ€å¤§å­æ•°ç»„å’Œï¼ˆKadane-ç®—æ³•ï¼‰"><a href="#2-æœ€å¤§å­æ•°ç»„å’Œï¼ˆKadane-ç®—æ³•ï¼‰" class="headerlink" title="2. æœ€å¤§å­æ•°ç»„å’Œï¼ˆKadane ç®—æ³•ï¼‰"></a>2. æœ€å¤§å­æ•°ç»„å’Œï¼ˆKadane ç®—æ³•ï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxSubArray</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> nums[<span class="number">0</span>], cur = nums[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">        cur = Math.max(nums[i], cur + nums[i]);</span><br><span class="line">        max = Math.max(max, cur);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> max;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="ğŸ”¹-é“¾è¡¨ï¼ˆLinked-Listï¼‰"><a href="#ğŸ”¹-é“¾è¡¨ï¼ˆLinked-Listï¼‰" class="headerlink" title="ğŸ”¹ é“¾è¡¨ï¼ˆLinked Listï¼‰"></a>ğŸ”¹ é“¾è¡¨ï¼ˆLinked Listï¼‰</h2><h3 id="1-åè½¬é“¾è¡¨"><a href="#1-åè½¬é“¾è¡¨" class="headerlink" title="1. åè½¬é“¾è¡¨"></a>1. åè½¬é“¾è¡¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">reverseList</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">prev</span> <span class="operator">=</span> <span class="literal">null</span>, cur = head;</span><br><span class="line">    <span class="keyword">while</span> (cur != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">next</span> <span class="operator">=</span> cur.next;</span><br><span class="line">        cur.next = prev;</span><br><span class="line">        prev = cur;</span><br><span class="line">        cur = next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> prev;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-åˆ¤æ–­é“¾è¡¨æ˜¯å¦æœ‰ç¯ï¼ˆå¿«æ…¢æŒ‡é’ˆï¼‰"><a href="#2-åˆ¤æ–­é“¾è¡¨æ˜¯å¦æœ‰ç¯ï¼ˆå¿«æ…¢æŒ‡é’ˆï¼‰" class="headerlink" title="2. åˆ¤æ–­é“¾è¡¨æ˜¯å¦æœ‰ç¯ï¼ˆå¿«æ…¢æŒ‡é’ˆï¼‰"></a>2. åˆ¤æ–­é“¾è¡¨æ˜¯å¦æœ‰ç¯ï¼ˆå¿«æ…¢æŒ‡é’ˆï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasCycle</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">slow</span> <span class="operator">=</span> head, fast = head;</span><br><span class="line">    <span class="keyword">while</span> (fast != <span class="literal">null</span> &amp;&amp; fast.next != <span class="literal">null</span>) &#123;</span><br><span class="line">        slow = slow.next;</span><br><span class="line">        fast = fast.next.next;</span><br><span class="line">        <span class="keyword">if</span> (slow == fast) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="ğŸ”¹-æ ˆ-é˜Ÿåˆ—"><a href="#ğŸ”¹-æ ˆ-é˜Ÿåˆ—" class="headerlink" title="ğŸ”¹ æ ˆ &#x2F; é˜Ÿåˆ—"></a>ğŸ”¹ æ ˆ &#x2F; é˜Ÿåˆ—</h2><h3 id="1-æœ‰æ•ˆæ‹¬å·"><a href="#1-æœ‰æ•ˆæ‹¬å·" class="headerlink" title="1. æœ‰æ•ˆæ‹¬å·"></a>1. æœ‰æ•ˆæ‹¬å·</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValid</span><span class="params">(String s)</span> &#123;</span><br><span class="line">    Stack&lt;Character&gt; stack = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">char</span> c : s.toCharArray()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (c == <span class="string">&#x27;(&#x27;</span>) stack.push(<span class="string">&#x27;)&#x27;</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (c == <span class="string">&#x27;[&#x27;</span>) stack.push(<span class="string">&#x27;]&#x27;</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (c == <span class="string">&#x27;&#123;&#x27;</span>) stack.push(<span class="string">&#x27;&#125;&#x27;</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (stack.isEmpty() || stack.pop() != c) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> stack.isEmpty();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-ç”¨æ ˆå®ç°é˜Ÿåˆ—"><a href="#2-ç”¨æ ˆå®ç°é˜Ÿåˆ—" class="headerlink" title="2. ç”¨æ ˆå®ç°é˜Ÿåˆ—"></a>2. ç”¨æ ˆå®ç°é˜Ÿåˆ—</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyQueue</span> &#123;</span><br><span class="line">    Stack&lt;Integer&gt; in = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">    Stack&lt;Integer&gt; out = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">push</span><span class="params">(<span class="type">int</span> x)</span> &#123; in.push(x); &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">pop</span><span class="params">()</span> &#123; peek(); <span class="keyword">return</span> out.pop(); &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">peek</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (out.isEmpty()) <span class="keyword">while</span> (!in.isEmpty()) out.push(in.pop());</span><br><span class="line">        <span class="keyword">return</span> out.peek();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">empty</span><span class="params">()</span> &#123; <span class="keyword">return</span> in.isEmpty() &amp;&amp; out.isEmpty(); &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="ğŸ”¹-äºŒå‰æ ‘"><a href="#ğŸ”¹-äºŒå‰æ ‘" class="headerlink" title="ğŸ”¹ äºŒå‰æ ‘"></a>ğŸ”¹ äºŒå‰æ ‘</h2><h3 id="1-äºŒå‰æ ‘çš„éå†ï¼ˆé€’å½’-è¿­ä»£ï¼‰"><a href="#1-äºŒå‰æ ‘çš„éå†ï¼ˆé€’å½’-è¿­ä»£ï¼‰" class="headerlink" title="1. äºŒå‰æ ‘çš„éå†ï¼ˆé€’å½’ &amp; è¿­ä»£ï¼‰"></a>1. äºŒå‰æ ‘çš„éå†ï¼ˆé€’å½’ &amp; è¿­ä»£ï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‰åºéå†</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">preorder</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (root == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">    System.out.print(root.val + <span class="string">&quot; &quot;</span>);</span><br><span class="line">    preorder(root.left);</span><br><span class="line">    preorder(root.right);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å±‚åºéå†</span></span><br><span class="line"><span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">levelOrder</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">if</span> (root == <span class="literal">null</span>) <span class="keyword">return</span> res;</span><br><span class="line">    Queue&lt;TreeNode&gt; q = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    q.offer(root);</span><br><span class="line">    <span class="keyword">while</span> (!q.isEmpty()) &#123;</span><br><span class="line">        List&lt;Integer&gt; level = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> q.size();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">            <span class="type">TreeNode</span> <span class="variable">node</span> <span class="operator">=</span> q.poll();</span><br><span class="line">            level.add(node.val);</span><br><span class="line">            <span class="keyword">if</span> (node.left != <span class="literal">null</span>) q.offer(node.left);</span><br><span class="line">            <span class="keyword">if</span> (node.right != <span class="literal">null</span>) q.offer(node.right);</span><br><span class="line">        &#125;</span><br><span class="line">        res.add(level);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-éªŒè¯äºŒå‰æœç´¢æ ‘"><a href="#2-éªŒè¯äºŒå‰æœç´¢æ ‘" class="headerlink" title="2. éªŒè¯äºŒå‰æœç´¢æ ‘"></a>2. éªŒè¯äºŒå‰æœç´¢æ ‘</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValidBST</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> helper(root, Long.MIN_VALUE, Long.MAX_VALUE);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">helper</span><span class="params">(TreeNode node, <span class="type">long</span> min, <span class="type">long</span> max)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span> (node.val &lt;= min || node.val &gt;= max) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> helper(node.left, min, node.val) &amp;&amp; helper(node.right, node.val, max);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="ğŸ”¹-å †-ä¼˜å…ˆé˜Ÿåˆ—"><a href="#ğŸ”¹-å †-ä¼˜å…ˆé˜Ÿåˆ—" class="headerlink" title="ğŸ”¹ å † &#x2F; ä¼˜å…ˆé˜Ÿåˆ—"></a>ğŸ”¹ å † &#x2F; ä¼˜å…ˆé˜Ÿåˆ—</h2><h3 id="1-æ•°ç»„ä¸­çš„ç¬¬-K-å¤§å…ƒç´ "><a href="#1-æ•°ç»„ä¸­çš„ç¬¬-K-å¤§å…ƒç´ " class="headerlink" title="1. æ•°ç»„ä¸­çš„ç¬¬ K å¤§å…ƒç´ "></a>1. æ•°ç»„ä¸­çš„ç¬¬ K å¤§å…ƒç´ </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findKthLargest</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">    PriorityQueue&lt;Integer&gt; pq = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> n : nums) &#123;</span><br><span class="line">        pq.offer(n);</span><br><span class="line">        <span class="keyword">if</span> (pq.size() &gt; k) pq.poll();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> pq.peek();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="ğŸ”¹-å›¾"><a href="#ğŸ”¹-å›¾" class="headerlink" title="ğŸ”¹ å›¾"></a>ğŸ”¹ å›¾</h2><h3 id="1-å›¾çš„-BFS"><a href="#1-å›¾çš„-BFS" class="headerlink" title="1. å›¾çš„ BFS"></a>1. å›¾çš„ BFS</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">bfs</span><span class="params">(<span class="type">int</span> start, List&lt;List&lt;Integer&gt;&gt; graph)</span> &#123;</span><br><span class="line">    <span class="type">boolean</span>[] visited = <span class="keyword">new</span> <span class="title class_">boolean</span>[graph.size()];</span><br><span class="line">    Queue&lt;Integer&gt; queue = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    queue.offer(start);</span><br><span class="line">    visited[start] = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">while</span> (!queue.isEmpty()) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">node</span> <span class="operator">=</span> queue.poll();</span><br><span class="line">        System.out.print(node + <span class="string">&quot; &quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> nei : graph.get(node)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!visited[nei]) &#123;</span><br><span class="line">                visited[nei] = <span class="literal">true</span>;</span><br><span class="line">                queue.offer(nei);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-å²›å±¿æ•°é‡ï¼ˆDFSï¼‰"><a href="#2-å²›å±¿æ•°é‡ï¼ˆDFSï¼‰" class="headerlink" title="2. å²›å±¿æ•°é‡ï¼ˆDFSï¼‰"></a>2. å²›å±¿æ•°é‡ï¼ˆDFSï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">numIslands</span><span class="params">(<span class="type">char</span>[][] grid)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; grid.length; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; grid[<span class="number">0</span>].length; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (grid[i][j] == <span class="string">&#x27;1&#x27;</span>) &#123;</span><br><span class="line">                dfs(grid, i, j);</span><br><span class="line">                count++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">dfs</span><span class="params">(<span class="type">char</span>[][] grid, <span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (i &lt; <span class="number">0</span> || j &lt; <span class="number">0</span> || i &gt;= grid.length || j &gt;= grid[<span class="number">0</span>].length || grid[i][j] == <span class="string">&#x27;0&#x27;</span>) <span class="keyword">return</span>;</span><br><span class="line">    grid[i][j] = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    dfs(grid, i + <span class="number">1</span>, j);</span><br><span class="line">    dfs(grid, i - <span class="number">1</span>, j);</span><br><span class="line">    dfs(grid, i, j + <span class="number">1</span>);</span><br><span class="line">    dfs(grid, i, j - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="ğŸ”¹-æ’åºç®—æ³•"><a href="#ğŸ”¹-æ’åºç®—æ³•" class="headerlink" title="ğŸ”¹ æ’åºç®—æ³•"></a>ğŸ”¹ æ’åºç®—æ³•</h2><h3 id="å¿«é€Ÿæ’åº"><a href="#å¿«é€Ÿæ’åº" class="headerlink" title="å¿«é€Ÿæ’åº"></a>å¿«é€Ÿæ’åº</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">quickSort</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> left, <span class="type">int</span> right)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (left &gt;= right) <span class="keyword">return</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">pivot</span> <span class="operator">=</span> arr[left], i = left, j = right;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; j) &#123;</span><br><span class="line">        <span class="keyword">while</span> (i &lt; j &amp;&amp; arr[j] &gt;= pivot) j--;</span><br><span class="line">        arr[i] = arr[j];</span><br><span class="line">        <span class="keyword">while</span> (i &lt; j &amp;&amp; arr[i] &lt;= pivot) i++;</span><br><span class="line">        arr[j] = arr[i];</span><br><span class="line">    &#125;</span><br><span class="line">    arr[i] = pivot;</span><br><span class="line">    quickSort(arr, left, i - <span class="number">1</span>);</span><br><span class="line">    quickSort(arr, i + <span class="number">1</span>, right);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="ğŸ”¹-åŠ¨æ€è§„åˆ’ï¼ˆDPï¼‰"><a href="#ğŸ”¹-åŠ¨æ€è§„åˆ’ï¼ˆDPï¼‰" class="headerlink" title="ğŸ”¹ åŠ¨æ€è§„åˆ’ï¼ˆDPï¼‰"></a>ğŸ”¹ åŠ¨æ€è§„åˆ’ï¼ˆDPï¼‰</h2><h3 id="1-çˆ¬æ¥¼æ¢¯ï¼ˆæ–æ³¢é‚£å¥‘ï¼‰"><a href="#1-çˆ¬æ¥¼æ¢¯ï¼ˆæ–æ³¢é‚£å¥‘ï¼‰" class="headerlink" title="1. çˆ¬æ¥¼æ¢¯ï¼ˆæ–æ³¢é‚£å¥‘ï¼‰"></a>1. çˆ¬æ¥¼æ¢¯ï¼ˆæ–æ³¢é‚£å¥‘ï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">climbStairs</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (n &lt;= <span class="number">2</span>) <span class="keyword">return</span> n;</span><br><span class="line">    <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">1</span>, b = <span class="number">2</span>, res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">3</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        res = a + b;</span><br><span class="line">        a = b;</span><br><span class="line">        b = res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-æœ€é•¿å…¬å…±å­åºåˆ—ï¼ˆLCSï¼‰"><a href="#2-æœ€é•¿å…¬å…±å­åºåˆ—ï¼ˆLCSï¼‰" class="headerlink" title="2. æœ€é•¿å…¬å…±å­åºåˆ—ï¼ˆLCSï¼‰"></a>2. æœ€é•¿å…¬å…±å­åºåˆ—ï¼ˆLCSï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">longestCommonSubsequence</span><span class="params">(String text1, String text2)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> text1.length(), n = text2.length();</span><br><span class="line">    <span class="type">int</span>[][] dp = <span class="keyword">new</span> <span class="title class_">int</span>[m + <span class="number">1</span>][n + <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= m; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt;= n; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (text1.charAt(i - <span class="number">1</span>) == text2.charAt(j - <span class="number">1</span>)) &#123;</span><br><span class="line">                dp[i][j] = dp[i - <span class="number">1</span>][j - <span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                dp[i][j] = Math.max(dp[i - <span class="number">1</span>][j], dp[i][j - <span class="number">1</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[m][n];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h1 id="é«˜çº§"><a href="#é«˜çº§" class="headerlink" title="é«˜çº§"></a>é«˜çº§</h1><blockquote><p>å…ˆç»™ä¸¤ä¸ªé€šç”¨è¾…åŠ©ç±»ï¼ˆå¾ˆå¤šé¢˜ä¼šç”¨åˆ°ï¼‰ï¼š<code>ListNode</code>ï¼ˆé“¾è¡¨èŠ‚ç‚¹ï¼‰å’Œ <code>TreeNode</code>ï¼ˆäºŒå‰æ ‘èŠ‚ç‚¹ï¼‰ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€šç”¨è¾…åŠ©ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ListNode</span> &#123;</span><br><span class="line">    <span class="type">int</span> val;</span><br><span class="line">    ListNode next;</span><br><span class="line">    ListNode(<span class="type">int</span> v) &#123; val = v; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TreeNode</span> &#123;</span><br><span class="line">    <span class="type">int</span> val;</span><br><span class="line">    TreeNode left, right;</span><br><span class="line">    TreeNode(<span class="type">int</span> v) &#123; val = v; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ç›®å½•ï¼ˆå¿«é€Ÿè·³è½¬ï¼‰"><a href="#ç›®å½•ï¼ˆå¿«é€Ÿè·³è½¬ï¼‰" class="headerlink" title="ç›®å½•ï¼ˆå¿«é€Ÿè·³è½¬ï¼‰"></a>ç›®å½•ï¼ˆå¿«é€Ÿè·³è½¬ï¼‰</h1><ol><li>æ•°ç»„ &#x2F; åŒæŒ‡é’ˆ &#x2F; æ»‘åŠ¨çª—å£ &#x2F; å‰ç¼€å’Œ</li><li>æ’åº &#x2F; é€‰æ‹©ï¼ˆQuickselectï¼‰</li><li>é“¾è¡¨è¿›é˜¶</li><li>æ ˆè¿›é˜¶ &#x2F; å•è°ƒæ ˆ</li><li>é˜Ÿåˆ— &#x2F; åŒç«¯é˜Ÿåˆ—ï¼ˆæ»‘åŠ¨çª—å£æœ€å¤§å€¼ï¼‰</li><li>å †ï¼ˆåˆå¹¶ K è¡¨ã€æ•°æ®æµä¸­ä½æ•°ï¼‰</li><li>æ ‘ï¼ˆåºåˆ—åŒ–&#x2F;ååºåˆ—åŒ–ã€LCAã€æœ€å¤§è·¯å¾„å’Œï¼‰</li><li>å›¾ï¼ˆæ‹“æ‰‘ã€Dijkstraã€Bellman-Fordã€å¹¶æŸ¥é›†ï¼‰</li><li>åŠ¨æ€è§„åˆ’ï¼ˆLISã€èƒŒåŒ…ã€DP çŠ¶æ€å‹ç¼©ç­‰ï¼‰</li><li>å›æº¯ï¼ˆN çš‡åã€ç»„åˆ&#x2F;å­é›†å˜ä½“ï¼‰</li><li>å­—ç¬¦ä¸²ï¼ˆKMPã€Rabin-Karpã€æœ€å°è¦†ç›–å­ä¸²ï¼‰</li><li>å­—å…¸æ ‘ Trie</li><li>çº¿æ®µæ ‘ &#x2F; æ ‘çŠ¶æ•°ç»„ï¼ˆFenwickï¼‰</li><li>ä½è¿ç®— &#x2F; æ•°å­¦å°æŠ€å·§</li><li>è®¾è®¡é¢˜ï¼ˆLRU Cacheï¼‰</li></ol><hr><h1 id="1-æ•°ç»„-åŒæŒ‡é’ˆ-æ»‘åŠ¨çª—å£-å‰ç¼€å’Œ"><a href="#1-æ•°ç»„-åŒæŒ‡é’ˆ-æ»‘åŠ¨çª—å£-å‰ç¼€å’Œ" class="headerlink" title="1. æ•°ç»„ &#x2F; åŒæŒ‡é’ˆ &#x2F; æ»‘åŠ¨çª—å£ &#x2F; å‰ç¼€å’Œ"></a>1. æ•°ç»„ &#x2F; åŒæŒ‡é’ˆ &#x2F; æ»‘åŠ¨çª—å£ &#x2F; å‰ç¼€å’Œ</h1><h3 id="1-1-æœ€é•¿ä¸å«é‡å¤å­—ç¬¦çš„å­ä¸²ï¼ˆLeetCode-3ï¼‰"><a href="#1-1-æœ€é•¿ä¸å«é‡å¤å­—ç¬¦çš„å­ä¸²ï¼ˆLeetCode-3ï¼‰" class="headerlink" title="1.1 æœ€é•¿ä¸å«é‡å¤å­—ç¬¦çš„å­ä¸²ï¼ˆLeetCode 3ï¼‰"></a>1.1 æœ€é•¿ä¸å«é‡å¤å­—ç¬¦çš„å­ä¸²ï¼ˆLeetCode 3ï¼‰</h3><p>æ€è·¯ï¼šæ»‘åŠ¨çª—å£ + å“ˆå¸Œè¡¨è®°å½•å­—ç¬¦ä¸Šæ¬¡å‡ºç°ä½ç½®ã€‚<br> å¤æ‚åº¦ï¼šO(n) æ—¶é—´ï¼ŒO(min(n, charset)) ç©ºé—´ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">lengthOfLongestSubstring</span><span class="params">(String s)</span> &#123;</span><br><span class="line">    <span class="type">int</span>[] last = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">128</span>]; <span class="comment">// ASCII</span></span><br><span class="line">    Arrays.fill(last, -<span class="number">1</span>);</span><br><span class="line">    <span class="type">int</span> <span class="variable">start</span> <span class="operator">=</span> <span class="number">0</span>, maxLen = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; s.length(); i++) &#123;</span><br><span class="line">        <span class="type">char</span> <span class="variable">c</span> <span class="operator">=</span> s.charAt(i);</span><br><span class="line">        start = Math.max(start, last[c] + <span class="number">1</span>);</span><br><span class="line">        maxLen = Math.max(maxLen, i - start + <span class="number">1</span>);</span><br><span class="line">        last[c] = i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> maxLen;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-2-æœ€å°è¦†ç›–å­ä¸²ï¼ˆLeetCode-76ï¼‰"><a href="#1-2-æœ€å°è¦†ç›–å­ä¸²ï¼ˆLeetCode-76ï¼‰" class="headerlink" title="1.2 æœ€å°è¦†ç›–å­ä¸²ï¼ˆLeetCode 76ï¼‰"></a>1.2 æœ€å°è¦†ç›–å­ä¸²ï¼ˆLeetCode 76ï¼‰</h3><p>æ€è·¯ï¼šæ»‘åŠ¨çª—å£ + è®¡æ•°è¡¨ï¼›éœ€è¦æ»¡è¶³æ¡ä»¶æ—¶æ”¶ç¼©å·¦è¾¹ç•Œã€‚<br> å¤æ‚åº¦ï¼šO(n)ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">minWindow</span><span class="params">(String s, String t)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (s.length() &lt; t.length()) <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="type">int</span>[] need = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">128</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">char</span> c : t.toCharArray()) need[c]++;</span><br><span class="line">    <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>, right = <span class="number">0</span>, required = t.length(), minLen = Integer.MAX_VALUE, start = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (right &lt; s.length()) &#123;</span><br><span class="line">        <span class="type">char</span> <span class="variable">c</span> <span class="operator">=</span> s.charAt(right++);</span><br><span class="line">        <span class="keyword">if</span> (need[c]-- &gt; <span class="number">0</span>) required--;</span><br><span class="line">        <span class="keyword">while</span> (required == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (right - left &lt; minLen) &#123; minLen = right - left; start = left; &#125;</span><br><span class="line">            <span class="type">char</span> <span class="variable">d</span> <span class="operator">=</span> s.charAt(left++);</span><br><span class="line">            <span class="keyword">if</span> (need[d]++ &gt;= <span class="number">0</span>) required++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> minLen == Integer.MAX_VALUE ? <span class="string">&quot;&quot;</span> : s.substring(start, start + minLen);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-3-å­æ•°ç»„å’Œç­‰äº-kï¼ˆLeetCode-560ï¼‰"><a href="#1-3-å­æ•°ç»„å’Œç­‰äº-kï¼ˆLeetCode-560ï¼‰" class="headerlink" title="1.3 å­æ•°ç»„å’Œç­‰äº kï¼ˆLeetCode 560ï¼‰"></a>1.3 å­æ•°ç»„å’Œç­‰äº kï¼ˆLeetCode 560ï¼‰</h3><p>æ€è·¯ï¼šå‰ç¼€å’Œ + å“ˆå¸Œè¡¨è®°å½•ä¹‹å‰å‡ºç°çš„å‰ç¼€å’Œé¢‘æ¬¡ã€‚<br> å¤æ‚åº¦ï¼šO(n)ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">subarraySum</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">    Map&lt;Integer, Integer&gt; cnt = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    cnt.put(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>, res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> x : nums) &#123;</span><br><span class="line">        sum += x;</span><br><span class="line">        res += cnt.getOrDefault(sum - k, <span class="number">0</span>);</span><br><span class="line">        cnt.put(sum, cnt.getOrDefault(sum, <span class="number">0</span>) + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-4-ä¸‰æ•°ä¹‹å’Œæœ€æ¥è¿‘ï¼ˆLeetCode-16ï¼‰"><a href="#1-4-ä¸‰æ•°ä¹‹å’Œæœ€æ¥è¿‘ï¼ˆLeetCode-16ï¼‰" class="headerlink" title="1.4 ä¸‰æ•°ä¹‹å’Œæœ€æ¥è¿‘ï¼ˆLeetCode 16ï¼‰"></a>1.4 ä¸‰æ•°ä¹‹å’Œæœ€æ¥è¿‘ï¼ˆLeetCode 16ï¼‰</h3><p>æ€è·¯ï¼šæ’åº + åŒæŒ‡é’ˆã€‚å¤æ‚åº¦ O(n^2)ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">threeSumClosest</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">    Arrays.sort(nums);</span><br><span class="line">    <span class="type">int</span> <span class="variable">closest</span> <span class="operator">=</span> nums[<span class="number">0</span>] + nums[<span class="number">1</span>] + nums[<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length - <span class="number">2</span>; i++) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> i + <span class="number">1</span>, r = nums.length - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (l &lt; r) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> nums[i] + nums[l] + nums[r];</span><br><span class="line">            <span class="keyword">if</span> (Math.abs(sum - target) &lt; Math.abs(closest - target)) closest = sum;</span><br><span class="line">            <span class="keyword">if</span> (sum &gt; target) r--;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (sum &lt; target) l++;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">return</span> target;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> closest;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h1 id="2-æ’åº-é€‰æ‹©-Quickselect"><a href="#2-æ’åº-é€‰æ‹©-Quickselect" class="headerlink" title="2. æ’åº &#x2F; é€‰æ‹© (Quickselect)"></a>2. æ’åº &#x2F; é€‰æ‹© (Quickselect)</h1><h3 id="2-1-Quickselectï¼šç¬¬-k-å°-ç¬¬-k-å¤§"><a href="#2-1-Quickselectï¼šç¬¬-k-å°-ç¬¬-k-å¤§" class="headerlink" title="2.1 Quickselectï¼šç¬¬ k å° &#x2F; ç¬¬ k å¤§"></a>2.1 Quickselectï¼šç¬¬ k å° &#x2F; ç¬¬ k å¤§</h3><p>æ€è·¯ï¼šç±»ä¼¼å¿«é€Ÿæ’åº partitionï¼ŒæœŸæœ›çº¿æ€§æ—¶é—´ã€‚<br> å¤æ‚åº¦ï¼šå¹³å‡ O(n)ï¼Œæœ€å O(n^2)ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">quickSelect</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> k)</span> &#123; <span class="comment">// 1-based k-th smallest</span></span><br><span class="line">    <span class="keyword">return</span> quickSelect(nums, <span class="number">0</span>, nums.length - <span class="number">1</span>, k - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="title function_">quickSelect</span><span class="params">(<span class="type">int</span>[] a, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (l == r) <span class="keyword">return</span> a[l];</span><br><span class="line">    <span class="type">int</span> <span class="variable">pivot</span> <span class="operator">=</span> partition(a, l, r);</span><br><span class="line">    <span class="keyword">if</span> (k == pivot) <span class="keyword">return</span> a[k];</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (k &lt; pivot) <span class="keyword">return</span> quickSelect(a, l, pivot - <span class="number">1</span>, k);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> quickSelect(a, pivot + <span class="number">1</span>, r, k);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="title function_">partition</span><span class="params">(<span class="type">int</span>[] a, <span class="type">int</span> l, <span class="type">int</span> r)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">pivotVal</span> <span class="operator">=</span> a[r], i = l;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> l; j &lt; r; j++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (a[j] &lt;= pivotVal) swap(a, i++, j);</span><br><span class="line">    &#125;</span><br><span class="line">    swap(a, i, r);</span><br><span class="line">    <span class="keyword">return</span> i;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">int</span>[] a, <span class="type">int</span> i, <span class="type">int</span> j)</span> &#123; <span class="type">int</span> <span class="variable">t</span> <span class="operator">=</span> a[i]; a[i] = a[j]; a[j] = t; &#125;</span><br></pre></td></tr></table></figure><hr><h1 id="3-é“¾è¡¨è¿›é˜¶"><a href="#3-é“¾è¡¨è¿›é˜¶" class="headerlink" title="3. é“¾è¡¨è¿›é˜¶"></a>3. é“¾è¡¨è¿›é˜¶</h1><h3 id="3-1-åè½¬-k-ä¸ªä¸€ç»„ï¼ˆLeetCode-25ï¼‰"><a href="#3-1-åè½¬-k-ä¸ªä¸€ç»„ï¼ˆLeetCode-25ï¼‰" class="headerlink" title="3.1 åè½¬ k ä¸ªä¸€ç»„ï¼ˆLeetCode 25ï¼‰"></a>3.1 åè½¬ k ä¸ªä¸€ç»„ï¼ˆLeetCode 25ï¼‰</h3><p>æ€è·¯ï¼šåˆ†æ®µåè½¬ã€‚å¤æ‚åº¦ O(n)ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">reverseKGroup</span><span class="params">(ListNode head, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">dummy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">0</span>), prev = dummy;</span><br><span class="line">    dummy.next = head;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">node</span> <span class="operator">=</span> prev;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; k &amp;&amp; node != <span class="literal">null</span>; i++) node = node.next;</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="literal">null</span>) <span class="keyword">break</span>;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">tail</span> <span class="operator">=</span> prev.next, curr = tail.next;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; k; i++) &#123;</span><br><span class="line">            tail.next = curr.next;</span><br><span class="line">            curr.next = prev.next;</span><br><span class="line">            prev.next = curr;</span><br><span class="line">            curr = tail.next;</span><br><span class="line">        &#125;</span><br><span class="line">        prev = tail;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dummy.next;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-2-é“¾è¡¨æ’åºï¼ˆå½’å¹¶æ’åºï¼ŒLeetCode-148ï¼‰"><a href="#3-2-é“¾è¡¨æ’åºï¼ˆå½’å¹¶æ’åºï¼ŒLeetCode-148ï¼‰" class="headerlink" title="3.2 é“¾è¡¨æ’åºï¼ˆå½’å¹¶æ’åºï¼ŒLeetCode 148ï¼‰"></a>3.2 é“¾è¡¨æ’åºï¼ˆå½’å¹¶æ’åºï¼ŒLeetCode 148ï¼‰</h3><p>æ€è·¯ï¼šé€’å½’åˆ†æ²»ï¼ŒO(n log n) æ—¶é—´ï¼ŒO(log n) é€’å½’æ ˆç©ºé—´ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">sortList</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (head == <span class="literal">null</span> || head.next == <span class="literal">null</span>) <span class="keyword">return</span> head;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">slow</span> <span class="operator">=</span> head, fast = head.next;</span><br><span class="line">    <span class="keyword">while</span> (fast != <span class="literal">null</span> &amp;&amp; fast.next != <span class="literal">null</span>) &#123;</span><br><span class="line">        slow = slow.next;</span><br><span class="line">        fast = fast.next.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">mid</span> <span class="operator">=</span> slow.next; slow.next = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">return</span> merge(sortList(head), sortList(mid));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> ListNode <span class="title function_">merge</span><span class="params">(ListNode a, ListNode b)</span> &#123;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">dummy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">0</span>), p = dummy;</span><br><span class="line">    <span class="keyword">while</span> (a != <span class="literal">null</span> &amp;&amp; b != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (a.val &lt; b.val) &#123; p.next = a; a = a.next; &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123; p.next = b; b = b.next; &#125;</span><br><span class="line">        p = p.next;</span><br><span class="line">    &#125;</span><br><span class="line">    p.next = (a != <span class="literal">null</span>) ? a : b;</span><br><span class="line">    <span class="keyword">return</span> dummy.next;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-3-ç¯çš„å…¥å£ï¼ˆLeetCode-142ï¼‰"><a href="#3-3-ç¯çš„å…¥å£ï¼ˆLeetCode-142ï¼‰" class="headerlink" title="3.3 ç¯çš„å…¥å£ï¼ˆLeetCode 142ï¼‰"></a>3.3 ç¯çš„å…¥å£ï¼ˆLeetCode 142ï¼‰</h3><p>æ€è·¯ï¼šFloyd å¿«æ…¢æŒ‡é’ˆï¼Œæ‰¾åˆ°ç›¸é‡ç‚¹åä»å¤´ä¸ç›¸é‡ç‚¹åŒæ­¥ç§»åŠ¨ã€‚å¤æ‚åº¦ O(n)ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">detectCycle</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">slow</span> <span class="operator">=</span> head, fast = head;</span><br><span class="line">    <span class="keyword">while</span> (fast != <span class="literal">null</span> &amp;&amp; fast.next != <span class="literal">null</span>) &#123;</span><br><span class="line">        slow = slow.next; fast = fast.next.next;</span><br><span class="line">        <span class="keyword">if</span> (slow == fast) &#123;</span><br><span class="line">            <span class="type">ListNode</span> <span class="variable">p</span> <span class="operator">=</span> head;</span><br><span class="line">            <span class="keyword">while</span> (p != slow) &#123; p = p.next; slow = slow.next; &#125;</span><br><span class="line">            <span class="keyword">return</span> p;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h1 id="4-æ ˆè¿›é˜¶-å•è°ƒæ ˆ"><a href="#4-æ ˆè¿›é˜¶-å•è°ƒæ ˆ" class="headerlink" title="4. æ ˆè¿›é˜¶ &#x2F; å•è°ƒæ ˆ"></a>4. æ ˆè¿›é˜¶ &#x2F; å•è°ƒæ ˆ</h1><h3 id="4-1-å•è°ƒæ ˆæ¨¡æ¿ï¼ˆè§£å†³æœ€è¿‘æ›´å¤§-æ›´å°å…ƒç´ ã€ç›´æ–¹å›¾æœ€å¤§çŸ©å½¢ç­‰ï¼‰"><a href="#4-1-å•è°ƒæ ˆæ¨¡æ¿ï¼ˆè§£å†³æœ€è¿‘æ›´å¤§-æ›´å°å…ƒç´ ã€ç›´æ–¹å›¾æœ€å¤§çŸ©å½¢ç­‰ï¼‰" class="headerlink" title="4.1 å•è°ƒæ ˆæ¨¡æ¿ï¼ˆè§£å†³æœ€è¿‘æ›´å¤§&#x2F;æ›´å°å…ƒç´ ã€ç›´æ–¹å›¾æœ€å¤§çŸ©å½¢ç­‰ï¼‰"></a>4.1 å•è°ƒæ ˆæ¨¡æ¿ï¼ˆè§£å†³æœ€è¿‘æ›´å¤§&#x2F;æ›´å°å…ƒç´ ã€ç›´æ–¹å›¾æœ€å¤§çŸ©å½¢ç­‰ï¼‰</h3><p>æ€è·¯ï¼šç»´æŠ¤å•è°ƒé€’å¢æˆ–é€’å‡æ ˆï¼ˆå­˜ä¸‹æ ‡ï¼‰ã€‚å¤æ‚åº¦ O(n)ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä»¥å¯»æ‰¾æ¯ä¸ªå…ƒç´ å³ä¾§ç¬¬ä¸€ä¸ªå¤§äºå®ƒçš„ä¸‹æ ‡ä¸ºä¾‹</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span>[] nextGreaterIndices(<span class="type">int</span>[] arr) &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> arr.length;</span><br><span class="line">    <span class="type">int</span>[] res = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">    Arrays.fill(res, -<span class="number">1</span>);</span><br><span class="line">    Deque&lt;Integer&gt; st = <span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">while</span> (!st.isEmpty() &amp;&amp; arr[i] &gt; arr[st.peek()]) res[st.pop()] = i;</span><br><span class="line">        st.push(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-2-é€†æ³¢å…°è¡¨è¾¾å¼æ±‚å€¼ï¼ˆLeetCode-150ï¼‰"><a href="#4-2-é€†æ³¢å…°è¡¨è¾¾å¼æ±‚å€¼ï¼ˆLeetCode-150ï¼‰" class="headerlink" title="4.2 é€†æ³¢å…°è¡¨è¾¾å¼æ±‚å€¼ï¼ˆLeetCode 150ï¼‰"></a>4.2 é€†æ³¢å…°è¡¨è¾¾å¼æ±‚å€¼ï¼ˆLeetCode 150ï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">evalRPN</span><span class="params">(String[] tokens)</span> &#123;</span><br><span class="line">    Deque&lt;Integer&gt; st = <span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (String t : tokens) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;+-*/&quot;</span>.contains(t)) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> st.pop(), a = st.pop();</span><br><span class="line">            <span class="keyword">switch</span> (t) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;+&quot;</span> : st.push(a + b); <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;-&quot;</span> : st.push(a - b); <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;*&quot;</span> : st.push(a * b); <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;/&quot;</span> : st.push(a / b); <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> st.push(Integer.parseInt(t));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> st.pop();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h1 id="5-é˜Ÿåˆ—-åŒç«¯é˜Ÿåˆ—ï¼ˆæ»‘åŠ¨çª—å£æœ€å¤§å€¼ï¼‰"><a href="#5-é˜Ÿåˆ—-åŒç«¯é˜Ÿåˆ—ï¼ˆæ»‘åŠ¨çª—å£æœ€å¤§å€¼ï¼‰" class="headerlink" title="5. é˜Ÿåˆ— &#x2F; åŒç«¯é˜Ÿåˆ—ï¼ˆæ»‘åŠ¨çª—å£æœ€å¤§å€¼ï¼‰"></a>5. é˜Ÿåˆ— &#x2F; åŒç«¯é˜Ÿåˆ—ï¼ˆæ»‘åŠ¨çª—å£æœ€å¤§å€¼ï¼‰</h1><h3 id="5-1-æ»‘åŠ¨çª—å£æœ€å¤§å€¼ï¼ˆLeetCode-239ï¼‰"><a href="#5-1-æ»‘åŠ¨çª—å£æœ€å¤§å€¼ï¼ˆLeetCode-239ï¼‰" class="headerlink" title="5.1 æ»‘åŠ¨çª—å£æœ€å¤§å€¼ï¼ˆLeetCode 239ï¼‰"></a>5.1 æ»‘åŠ¨çª—å£æœ€å¤§å€¼ï¼ˆLeetCode 239ï¼‰</h3><p>æ€è·¯ï¼šç”¨åŒç«¯é˜Ÿåˆ—ç»´æŠ¤å½“å‰çª—å£çš„â€œå€™é€‰â€ä¸‹æ ‡ï¼ˆå•è°ƒé€’å‡ï¼‰ã€‚å¤æ‚åº¦ O(n)ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span>[] maxSlidingWindow(<span class="type">int</span>[] nums, <span class="type">int</span> k) &#123;</span><br><span class="line">    <span class="keyword">if</span> (nums.length == <span class="number">0</span>) <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">0</span>];</span><br><span class="line">    Deque&lt;Integer&gt; dq = <span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> nums.length;</span><br><span class="line">    <span class="type">int</span>[] res = <span class="keyword">new</span> <span class="title class_">int</span>[n - k + <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">while</span> (!dq.isEmpty() &amp;&amp; dq.peekFirst() &lt; i - k + <span class="number">1</span>) dq.pollFirst();</span><br><span class="line">        <span class="keyword">while</span> (!dq.isEmpty() &amp;&amp; nums[dq.peekLast()] &lt; nums[i]) dq.pollLast();</span><br><span class="line">        dq.offerLast(i);</span><br><span class="line">        <span class="keyword">if</span> (i &gt;= k - <span class="number">1</span>) res[i - k + <span class="number">1</span>] = nums[dq.peekFirst()];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h1 id="6-å †ï¼ˆPriorityQueueï¼‰"><a href="#6-å †ï¼ˆPriorityQueueï¼‰" class="headerlink" title="6. å †ï¼ˆPriorityQueueï¼‰"></a>6. å †ï¼ˆPriorityQueueï¼‰</h1><h3 id="6-1-åˆå¹¶-K-ä¸ªæœ‰åºé“¾è¡¨ï¼ˆLeetCode-23ï¼‰"><a href="#6-1-åˆå¹¶-K-ä¸ªæœ‰åºé“¾è¡¨ï¼ˆLeetCode-23ï¼‰" class="headerlink" title="6.1 åˆå¹¶ K ä¸ªæœ‰åºé“¾è¡¨ï¼ˆLeetCode 23ï¼‰"></a>6.1 åˆå¹¶ K ä¸ªæœ‰åºé“¾è¡¨ï¼ˆLeetCode 23ï¼‰</h3><p>æ€è·¯ï¼šæŠŠæ¯ä¸ªé“¾è¡¨å¤´æ”¾å…¥æœ€å°å †ï¼Œå¾ªç¯å¼¹å‡ºæœ€å°èŠ‚ç‚¹å¹¶æ¨è¿›ã€‚å¤æ‚åº¦ O(N log k)ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">mergeKLists</span><span class="params">(ListNode[] lists)</span> &#123;</span><br><span class="line">    PriorityQueue&lt;ListNode&gt; pq = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;((a,b) -&gt; a.val - b.val);</span><br><span class="line">    <span class="keyword">for</span> (ListNode ln : lists) <span class="keyword">if</span> (ln != <span class="literal">null</span>) pq.offer(ln);</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">dummy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">0</span>), cur = dummy;</span><br><span class="line">    <span class="keyword">while</span> (!pq.isEmpty()) &#123;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">node</span> <span class="operator">=</span> pq.poll();</span><br><span class="line">        cur.next = node; cur = cur.next;</span><br><span class="line">        <span class="keyword">if</span> (node.next != <span class="literal">null</span>) pq.offer(node.next);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dummy.next;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-2-æ•°æ®æµä¸­ä½æ•°ï¼ˆMedianFinderï¼‰"><a href="#6-2-æ•°æ®æµä¸­ä½æ•°ï¼ˆMedianFinderï¼‰" class="headerlink" title="6.2 æ•°æ®æµä¸­ä½æ•°ï¼ˆMedianFinderï¼‰"></a>6.2 æ•°æ®æµä¸­ä½æ•°ï¼ˆMedianFinderï¼‰</h3><p>æ€è·¯ï¼šç»´æŠ¤ä¸¤ä¸ªå †ï¼ˆå¤§é¡¶å †ä¿å­˜è¾ƒå°ä¸€åŠï¼Œå°é¡¶å †ä¿å­˜è¾ƒå¤§ä¸€åŠï¼‰ã€‚å¤æ‚åº¦ add O(log n)ï¼ŒfindMedian O(1)ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MedianFinder</span> &#123;</span><br><span class="line">    PriorityQueue&lt;Integer&gt; small = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;((a,b)-&gt;b-a); <span class="comment">// max-heap</span></span><br><span class="line">    PriorityQueue&lt;Integer&gt; large = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;(); <span class="comment">// min-heap</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addNum</span><span class="params">(<span class="type">int</span> num)</span> &#123;</span><br><span class="line">        small.offer(num);</span><br><span class="line">        large.offer(small.poll());</span><br><span class="line">        <span class="keyword">if</span> (small.size() &lt; large.size()) small.offer(large.poll());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">findMedian</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (small.size() &gt; large.size()) <span class="keyword">return</span> small.peek();</span><br><span class="line">        <span class="keyword">return</span> (small.peek() + large.peek()) / <span class="number">2.0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h1 id="7-æ ‘é«˜çº§é¢˜"><a href="#7-æ ‘é«˜çº§é¢˜" class="headerlink" title="7. æ ‘é«˜çº§é¢˜"></a>7. æ ‘é«˜çº§é¢˜</h1><h3 id="7-1-äºŒå‰æ ‘åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ï¼ˆLeetCode-297ï¼‰"><a href="#7-1-äºŒå‰æ ‘åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ï¼ˆLeetCode-297ï¼‰" class="headerlink" title="7.1 äºŒå‰æ ‘åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ï¼ˆLeetCode 297ï¼‰"></a>7.1 äºŒå‰æ ‘åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ï¼ˆLeetCode 297ï¼‰</h3><p>æ€è·¯ï¼šBFSï¼ˆå±‚åºï¼‰ç”¨ç‰¹æ®Šç¬¦å·è¡¨ç¤º nullï¼Œæˆ–ç”¨å‰åº + æ ‡è®° nullã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// BFS åºåˆ—åŒ–</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Codec</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">serialize</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        Queue&lt;TreeNode&gt; q = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        q.offer(root);</span><br><span class="line">        <span class="keyword">while</span> (!q.isEmpty()) &#123;</span><br><span class="line">            <span class="type">TreeNode</span> <span class="variable">n</span> <span class="operator">=</span> q.poll();</span><br><span class="line">            <span class="keyword">if</span> (n == <span class="literal">null</span>) sb.append(<span class="string">&quot;#,&quot;</span>);</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                sb.append(n.val).append(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">                q.offer(n.left); q.offer(n.right);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">deserialize</span><span class="params">(String data)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (data == <span class="literal">null</span> || data.isEmpty()) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        String[] arr = data.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        Queue&lt;TreeNode&gt; q = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">root</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(Integer.parseInt(arr[<span class="number">0</span>]));</span><br><span class="line">        q.offer(root);</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (!q.isEmpty()) &#123;</span><br><span class="line">            <span class="type">TreeNode</span> <span class="variable">node</span> <span class="operator">=</span> q.poll();</span><br><span class="line">            <span class="keyword">if</span> (!arr[i].equals(<span class="string">&quot;#&quot;</span>)) &#123; node.left = <span class="keyword">new</span> <span class="title class_">TreeNode</span>(Integer.parseInt(arr[i])); q.offer(node.left); &#125;</span><br><span class="line">            i++;</span><br><span class="line">            <span class="keyword">if</span> (!arr[i].equals(<span class="string">&quot;#&quot;</span>)) &#123; node.right = <span class="keyword">new</span> <span class="title class_">TreeNode</span>(Integer.parseInt(arr[i])); q.offer(node.right); &#125;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="7-2-æœ€è¿‘å…¬å…±ç¥–å…ˆï¼ˆLCA-äºŒå‰æ ‘ï¼ŒLeetCode-236ï¼‰"><a href="#7-2-æœ€è¿‘å…¬å…±ç¥–å…ˆï¼ˆLCA-äºŒå‰æ ‘ï¼ŒLeetCode-236ï¼‰" class="headerlink" title="7.2 æœ€è¿‘å…¬å…±ç¥–å…ˆï¼ˆLCA, äºŒå‰æ ‘ï¼ŒLeetCode 236ï¼‰"></a>7.2 æœ€è¿‘å…¬å…±ç¥–å…ˆï¼ˆLCA, äºŒå‰æ ‘ï¼ŒLeetCode 236ï¼‰</h3><p>æ€è·¯ï¼šé€’å½’æœç´¢å·¦å³å­æ ‘ï¼Œè‹¥å·¦å³éƒ½æœ‰é null è¿”å›å½“å‰ç»“ç‚¹ã€‚å¤æ‚åº¦ O(n)ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">lowestCommonAncestor</span><span class="params">(TreeNode root, TreeNode p, TreeNode q)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (root == <span class="literal">null</span> || root == p || root == q) <span class="keyword">return</span> root;</span><br><span class="line">    <span class="type">TreeNode</span> <span class="variable">left</span> <span class="operator">=</span> lowestCommonAncestor(root.left, p, q);</span><br><span class="line">    <span class="type">TreeNode</span> <span class="variable">right</span> <span class="operator">=</span> lowestCommonAncestor(root.right, p, q);</span><br><span class="line">    <span class="keyword">if</span> (left != <span class="literal">null</span> &amp;&amp; right != <span class="literal">null</span>) <span class="keyword">return</span> root;</span><br><span class="line">    <span class="keyword">return</span> left != <span class="literal">null</span> ? left : right;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="7-3-äºŒå‰æ ‘æœ€å¤§è·¯å¾„å’Œï¼ˆLeetCode-124ï¼‰"><a href="#7-3-äºŒå‰æ ‘æœ€å¤§è·¯å¾„å’Œï¼ˆLeetCode-124ï¼‰" class="headerlink" title="7.3 äºŒå‰æ ‘æœ€å¤§è·¯å¾„å’Œï¼ˆLeetCode 124ï¼‰"></a>7.3 äºŒå‰æ ‘æœ€å¤§è·¯å¾„å’Œï¼ˆLeetCode 124ï¼‰</h3><p>æ€è·¯ï¼šæ¯ä¸ªèŠ‚ç‚¹è®¡ç®—ç»è¿‡è¯¥èŠ‚ç‚¹çš„æœ€å¤§å‘ä¸‹è·¯å¾„è´¡çŒ®ï¼Œç»´æŠ¤å…¨å±€æœ€å¤§ã€‚å¤æ‚åº¦ O(n)ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="variable">maxSum</span> <span class="operator">=</span> Integer.MIN_VALUE;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxPathSum</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    dfs(root);</span><br><span class="line">    <span class="keyword">return</span> maxSum;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="title function_">dfs</span><span class="params">(TreeNode node)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> Math.max(<span class="number">0</span>, dfs(node.left));</span><br><span class="line">    <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> Math.max(<span class="number">0</span>, dfs(node.right));</span><br><span class="line">    maxSum = Math.max(maxSum, node.val + left + right);</span><br><span class="line">    <span class="keyword">return</span> node.val + Math.max(left, right);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h1 id="8-å›¾ï¼ˆé«˜çº§ï¼‰"><a href="#8-å›¾ï¼ˆé«˜çº§ï¼‰" class="headerlink" title="8. å›¾ï¼ˆé«˜çº§ï¼‰"></a>8. å›¾ï¼ˆé«˜çº§ï¼‰</h1><h3 id="8-1-æ‹“æ‰‘æ’åºï¼ˆKahn-ç®—æ³•ï¼‰"><a href="#8-1-æ‹“æ‰‘æ’åºï¼ˆKahn-ç®—æ³•ï¼‰" class="headerlink" title="8.1 æ‹“æ‰‘æ’åºï¼ˆKahn ç®—æ³•ï¼‰"></a>8.1 æ‹“æ‰‘æ’åºï¼ˆKahn ç®—æ³•ï¼‰</h3><p>æ€è·¯ï¼šå…¥åº¦ä¸º 0 çš„ç‚¹å…¥é˜Ÿï¼Œé€å‡ºå¹¶å‡å°é‚»å±…å…¥åº¦ã€‚èƒ½æ£€æµ‹æœ‰å‘æ— ç¯å›¾ã€‚å¤æ‚åº¦ O(V+E)ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">topoSort</span><span class="params">(<span class="type">int</span> n, List&lt;List&lt;Integer&gt;&gt; adj)</span> &#123;</span><br><span class="line">    <span class="type">int</span>[] indeg = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">u</span> <span class="operator">=</span> <span class="number">0</span>; u &lt; n; u++) <span class="keyword">for</span> (<span class="type">int</span> v : adj.get(u)) indeg[v]++;</span><br><span class="line">    Queue&lt;Integer&gt; q = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) <span class="keyword">if</span> (indeg[i] == <span class="number">0</span>) q.offer(i);</span><br><span class="line">    List&lt;Integer&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">while</span> (!q.isEmpty()) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">u</span> <span class="operator">=</span> q.poll(); res.add(u);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> v : adj.get(u)) <span class="keyword">if</span> (--indeg[v] == <span class="number">0</span>) q.offer(v);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res.size() == n ? res : <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(); <span class="comment">// è‹¥æœ‰ç¯åˆ™è¿”å›ç©º</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="8-2-Dijkstraï¼ˆå¸¦ä¼˜å…ˆé˜Ÿåˆ—çš„é‚»æ¥è¡¨ç‰ˆæœ¬ï¼‰"><a href="#8-2-Dijkstraï¼ˆå¸¦ä¼˜å…ˆé˜Ÿåˆ—çš„é‚»æ¥è¡¨ç‰ˆæœ¬ï¼‰" class="headerlink" title="8.2 Dijkstraï¼ˆå¸¦ä¼˜å…ˆé˜Ÿåˆ—çš„é‚»æ¥è¡¨ç‰ˆæœ¬ï¼‰"></a>8.2 Dijkstraï¼ˆå¸¦ä¼˜å…ˆé˜Ÿåˆ—çš„é‚»æ¥è¡¨ç‰ˆæœ¬ï¼‰</h3><p>å¤æ‚åº¦ O((V+E) log V)ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Edge</span> &#123; <span class="type">int</span> to, w; Edge(<span class="type">int</span> t, <span class="type">int</span> w)&#123;to=t;<span class="built_in">this</span>.w=w;&#125; &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span>[] dijkstra(<span class="type">int</span> n, List&lt;List&lt;Edge&gt;&gt; graph, <span class="type">int</span> src) &#123;</span><br><span class="line">    <span class="type">int</span>[] dist = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">    Arrays.fill(dist, Integer.MAX_VALUE);</span><br><span class="line">    dist[src] = <span class="number">0</span>;</span><br><span class="line">    PriorityQueue&lt;<span class="type">int</span>[]&gt; pq = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;(Comparator.comparingInt(a-&gt;a[<span class="number">0</span>]));</span><br><span class="line">    pq.offer(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">0</span>, src&#125;);</span><br><span class="line">    <span class="keyword">while</span> (!pq.isEmpty()) &#123;</span><br><span class="line">        <span class="type">int</span>[] cur = pq.poll();</span><br><span class="line">        <span class="type">int</span> <span class="variable">d</span> <span class="operator">=</span> cur[<span class="number">0</span>], u = cur[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span> (d &gt; dist[u]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">for</span> (Edge e : graph.get(u)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (dist[u] + e.w &lt; dist[e.to]) &#123;</span><br><span class="line">                dist[e.to] = dist[u] + e.w;</span><br><span class="line">                pq.offer(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;dist[e.to], e.to&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dist;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="8-3-Bellman-Fordï¼ˆå¸¦è´Ÿæƒæ£€æµ‹ï¼‰"><a href="#8-3-Bellman-Fordï¼ˆå¸¦è´Ÿæƒæ£€æµ‹ï¼‰" class="headerlink" title="8.3 Bellman-Fordï¼ˆå¸¦è´Ÿæƒæ£€æµ‹ï¼‰"></a>8.3 Bellman-Fordï¼ˆå¸¦è´Ÿæƒæ£€æµ‹ï¼‰</h3><p>å¤æ‚åº¦ O(V*E)ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span>[] bellmanFord(<span class="type">int</span> n, <span class="type">int</span> src, <span class="type">int</span>[][] edges) &#123;</span><br><span class="line">    <span class="type">int</span>[] dist = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">    Arrays.fill(dist, Integer.MAX_VALUE);</span><br><span class="line">    dist[src] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; n; i++) &#123; <span class="comment">// relax n-1 times</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span>[] e : edges) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">u</span> <span class="operator">=</span> e[<span class="number">0</span>], v = e[<span class="number">1</span>], w = e[<span class="number">2</span>];</span><br><span class="line">            <span class="keyword">if</span> (dist[u] != Integer.MAX_VALUE &amp;&amp; dist[u] + w &lt; dist[v]) dist[v] = dist[u] + w;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ£€æµ‹è´Ÿç¯</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span>[] e : edges) &#123;</span><br><span class="line">        <span class="keyword">if</span> (dist[e[<span class="number">0</span>]] != Integer.MAX_VALUE &amp;&amp; dist[e[<span class="number">0</span>]] + e[<span class="number">2</span>] &lt; dist[e[<span class="number">1</span>]]) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>; <span class="comment">// å­˜åœ¨è´Ÿç¯</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dist;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="8-4-å¹¶æŸ¥é›†ï¼ˆUnion-Findï¼‰"><a href="#8-4-å¹¶æŸ¥é›†ï¼ˆUnion-Findï¼‰" class="headerlink" title="8.4 å¹¶æŸ¥é›†ï¼ˆUnion-Findï¼‰"></a>8.4 å¹¶æŸ¥é›†ï¼ˆUnion-Findï¼‰</h3><p>æ€è·¯ï¼šç”¨äºè¿é€šæ€§ã€ç¾¤ç»„åˆå¹¶ã€Kruskal æœ€å°ç”Ÿæˆæ ‘ç­‰ã€‚å¸¦è·¯å¾„å‹ç¼©å’ŒæŒ‰ç§©åˆå¹¶ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">UnionFind</span> &#123;</span><br><span class="line">    <span class="type">int</span>[] parent, rank;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UnionFind</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        parent = <span class="keyword">new</span> <span class="title class_">int</span>[n]; rank = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) parent[i] = i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">find</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (parent[x] != x) parent[x] = find(parent[x]);</span><br><span class="line">        <span class="keyword">return</span> parent[x];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">union</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">rx</span> <span class="operator">=</span> find(x), ry = find(y);</span><br><span class="line">        <span class="keyword">if</span> (rx == ry) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">if</span> (rank[rx] &lt; rank[ry]) parent[rx] = ry;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (rank[rx] &gt; rank[ry]) parent[ry] = rx;</span><br><span class="line">        <span class="keyword">else</span> &#123; parent[ry] = rx; rank[rx]++; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h1 id="9-åŠ¨æ€è§„åˆ’ï¼ˆDPï¼‰"><a href="#9-åŠ¨æ€è§„åˆ’ï¼ˆDPï¼‰" class="headerlink" title="9. åŠ¨æ€è§„åˆ’ï¼ˆDPï¼‰"></a>9. åŠ¨æ€è§„åˆ’ï¼ˆDPï¼‰</h1><h3 id="9-1-æœ€é•¿é€’å¢å­åºåˆ—ï¼ˆLISï¼‰-â€”-O-n-log-n"><a href="#9-1-æœ€é•¿é€’å¢å­åºåˆ—ï¼ˆLISï¼‰-â€”-O-n-log-n" class="headerlink" title="9.1 æœ€é•¿é€’å¢å­åºåˆ—ï¼ˆLISï¼‰ â€” O(n log n)"></a>9.1 æœ€é•¿é€’å¢å­åºåˆ—ï¼ˆLISï¼‰ â€” O(n log n)</h3><p>æ€è·¯ï¼šç»´æŠ¤ tails æ•°ç»„ï¼Œtails[i] &#x3D; æœ€å°ç»“å°¾å€¼ä½¿å¾—é•¿åº¦ä¸º i+1ã€‚å¯é€‰é‡å»ºè·¯å¾„ã€‚å¤æ‚åº¦ O(n log n)ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">lengthOfLIS</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (nums.length == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span>[] tails = <span class="keyword">new</span> <span class="title class_">int</span>[nums.length];</span><br><span class="line">    <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> x : nums) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> Arrays.binarySearch(tails, <span class="number">0</span>, size, x);</span><br><span class="line">        <span class="keyword">if</span> (i &lt; <span class="number">0</span>) i = -(i + <span class="number">1</span>);</span><br><span class="line">        tails[i] = x;</span><br><span class="line">        <span class="keyword">if</span> (i == size) size++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="9-2-0-1-èƒŒåŒ…ï¼ˆç»å…¸-DPï¼‰"><a href="#9-2-0-1-èƒŒåŒ…ï¼ˆç»å…¸-DPï¼‰" class="headerlink" title="9.2 0&#x2F;1 èƒŒåŒ…ï¼ˆç»å…¸ DPï¼‰"></a>9.2 0&#x2F;1 èƒŒåŒ…ï¼ˆç»å…¸ DPï¼‰</h3><p>æ—¶é—´ O(nW)ï¼Œç©ºé—´å¯æ»šåŠ¨åˆ° O(W)ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">knapsack</span><span class="params">(<span class="type">int</span> W, <span class="type">int</span>[] wt, <span class="type">int</span>[] val)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> wt.length;</span><br><span class="line">    <span class="type">int</span>[] dp = <span class="keyword">new</span> <span class="title class_">int</span>[W + <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">w</span> <span class="operator">=</span> W; w &gt;= wt[i]; w--) &#123;</span><br><span class="line">            dp[w] = Math.max(dp[w], dp[w - wt[i]] + val[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[W];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="9-3-å­—ç¬¦ä¸²æ‹†åˆ†ï¼ˆWord-Breakï¼ŒLeetCode-139ï¼‰"><a href="#9-3-å­—ç¬¦ä¸²æ‹†åˆ†ï¼ˆWord-Breakï¼ŒLeetCode-139ï¼‰" class="headerlink" title="9.3 å­—ç¬¦ä¸²æ‹†åˆ†ï¼ˆWord Breakï¼ŒLeetCode 139ï¼‰"></a>9.3 å­—ç¬¦ä¸²æ‹†åˆ†ï¼ˆWord Breakï¼ŒLeetCode 139ï¼‰</h3><p>æ€è·¯ï¼šDPï¼Œdp[i] &#x3D; [0..i)æ˜¯å¦å¯æ‹†åˆ†ã€‚å¤æ‚åº¦ O(n^2)ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">wordBreak</span><span class="params">(String s, List&lt;String&gt; wordDict)</span> &#123;</span><br><span class="line">    Set&lt;String&gt; set = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;(wordDict);</span><br><span class="line">    <span class="type">boolean</span>[] dp = <span class="keyword">new</span> <span class="title class_">boolean</span>[s.length() + <span class="number">1</span>];</span><br><span class="line">    dp[<span class="number">0</span>] = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= s.length(); i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; i; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (dp[j] &amp;&amp; set.contains(s.substring(j, i))) &#123; dp[i] = <span class="literal">true</span>; <span class="keyword">break</span>; &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[s.length()];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h1 id="10-å›æº¯ï¼ˆBacktrackingï¼‰"><a href="#10-å›æº¯ï¼ˆBacktrackingï¼‰" class="headerlink" title="10. å›æº¯ï¼ˆBacktrackingï¼‰"></a>10. å›æº¯ï¼ˆBacktrackingï¼‰</h1><h3 id="10-1-N-çš‡åï¼ˆLeetCode-51ï¼‰"><a href="#10-1-N-çš‡åï¼ˆLeetCode-51ï¼‰" class="headerlink" title="10.1 N çš‡åï¼ˆLeetCode 51ï¼‰"></a>10.1 N çš‡åï¼ˆLeetCode 51ï¼‰</h3><p>æ€è·¯ï¼šå›æº¯ + åˆ— &#x2F; æ–œå¯¹è§’ å‰ªæï¼Œå¯ç”¨ä½è¿ç®—ä¼˜åŒ–ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;List&lt;String&gt;&gt; <span class="title function_">solveNQueens</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    List&lt;List&lt;String&gt;&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">char</span>[][] board = <span class="keyword">new</span> <span class="title class_">char</span>[n][n];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">char</span>[] row : board) Arrays.fill(row, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">    backtrack(<span class="number">0</span>, board, res, n);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">backtrack</span><span class="params">(<span class="type">int</span> row, <span class="type">char</span>[][] board, List&lt;List&lt;String&gt;&gt; res, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (row == n) &#123;</span><br><span class="line">        List&lt;String&gt; sol = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">char</span>[] r : board) sol.add(<span class="keyword">new</span> <span class="title class_">String</span>(r));</span><br><span class="line">        res.add(sol);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">col</span> <span class="operator">=</span> <span class="number">0</span>; col &lt; n; col++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!isValid(board, row, col, n)) <span class="keyword">continue</span>;</span><br><span class="line">        board[row][col] = <span class="string">&#x27;Q&#x27;</span>;</span><br><span class="line">        backtrack(row + <span class="number">1</span>, board, res, n);</span><br><span class="line">        board[row][col] = <span class="string">&#x27;.&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isValid</span><span class="params">(<span class="type">char</span>[][] board, <span class="type">int</span> row, <span class="type">int</span> col, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; row; i++) <span class="keyword">if</span> (board[i][col] == <span class="string">&#x27;Q&#x27;</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> row - <span class="number">1</span>, j = col - <span class="number">1</span>; i &gt;= <span class="number">0</span> &amp;&amp; j &gt;= <span class="number">0</span>; i--, j--) <span class="keyword">if</span> (board[i][j] == <span class="string">&#x27;Q&#x27;</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> row - <span class="number">1</span>, j = col + <span class="number">1</span>; i &gt;= <span class="number">0</span> &amp;&amp; j &lt; n; i--, j++) <span class="keyword">if</span> (board[i][j] == <span class="string">&#x27;Q&#x27;</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="10-2-ç»„åˆæ€»å’Œï¼ˆCombination-Sumï¼ŒLeetCode-39ï¼‰"><a href="#10-2-ç»„åˆæ€»å’Œï¼ˆCombination-Sumï¼ŒLeetCode-39ï¼‰" class="headerlink" title="10.2 ç»„åˆæ€»å’Œï¼ˆCombination Sumï¼ŒLeetCode 39ï¼‰"></a>10.2 ç»„åˆæ€»å’Œï¼ˆCombination Sumï¼ŒLeetCode 39ï¼‰</h3><p>æ€è·¯ï¼šå›æº¯ï¼Œæ³¨æ„å»é‡ä¸å‰ªæï¼ˆæ’åºåå‰ªæï¼‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">combinationSum</span><span class="params">(<span class="type">int</span>[] candidates, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">    Arrays.sort(candidates);</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    back(candidates, <span class="number">0</span>, target, <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(), res);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">back</span><span class="params">(<span class="type">int</span>[] cand, <span class="type">int</span> idx, <span class="type">int</span> target, List&lt;Integer&gt; path, List&lt;List&lt;Integer&gt;&gt; res)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (target == <span class="number">0</span>) &#123; res.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(path)); <span class="keyword">return</span>; &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> idx; i &lt; cand.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (cand[i] &gt; target) <span class="keyword">break</span>;</span><br><span class="line">        path.add(cand[i]);</span><br><span class="line">        back(cand, i, target - cand[i], path, res); <span class="comment">// i å…è®¸é‡å¤</span></span><br><span class="line">        path.remove(path.size() - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h1 id="11-å­—ç¬¦ä¸²ç®—æ³•"><a href="#11-å­—ç¬¦ä¸²ç®—æ³•" class="headerlink" title="11. å­—ç¬¦ä¸²ç®—æ³•"></a>11. å­—ç¬¦ä¸²ç®—æ³•</h1><h3 id="11-1-KMPï¼ˆè®¡ç®—-LPSï¼‰"><a href="#11-1-KMPï¼ˆè®¡ç®—-LPSï¼‰" class="headerlink" title="11.1 KMPï¼ˆè®¡ç®— LPSï¼‰"></a>11.1 KMPï¼ˆè®¡ç®— LPSï¼‰</h3><p>æ€è·¯ï¼šé¢„å¤„ç†æ¨¡å¼ä¸²å¾—åˆ°æœ€é•¿ç›¸åŒå‰åç¼€æ•°ç»„ lpsï¼Œç„¶åçº¿æ€§åŒ¹é…ã€‚å¤æ‚åº¦ O(n+m)ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span>[] computeLPS(String pat) &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> pat.length();</span><br><span class="line">    <span class="type">int</span>[] lps = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">    <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> <span class="number">0</span>, i = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; n) &#123;</span><br><span class="line">        <span class="keyword">if</span> (pat.charAt(i) == pat.charAt(len)) &#123; lps[i++] = ++len; &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (len &gt; <span class="number">0</span>) len = lps[len - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">else</span> &#123; lps[i++] = <span class="number">0</span>; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> lps;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">kmp</span><span class="params">(String s, String pat)</span> &#123;</span><br><span class="line">    <span class="type">int</span>[] lps = computeLPS(pat);</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, j = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; s.length()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (s.charAt(i) == pat.charAt(j)) &#123; i++; j++; <span class="keyword">if</span> (j == pat.length()) <span class="keyword">return</span> i - j; &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (j &gt; <span class="number">0</span>) j = lps[j - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">else</span> i++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="11-2-Rabin-Karpï¼ˆå­—ç¬¦ä¸²å“ˆå¸Œï¼‰"><a href="#11-2-Rabin-Karpï¼ˆå­—ç¬¦ä¸²å“ˆå¸Œï¼‰" class="headerlink" title="11.2 Rabin-Karpï¼ˆå­—ç¬¦ä¸²å“ˆå¸Œï¼‰"></a>11.2 Rabin-Karpï¼ˆå­—ç¬¦ä¸²å“ˆå¸Œï¼‰</h3><p>æ€è·¯ï¼šç”¨æ»šåŠ¨å“ˆå¸Œå¿«é€Ÿæ¯”è¾ƒå­ä¸²ï¼Œæ³¨æ„å“ˆå¸Œå†²çªå¤„ç†ã€‚å¤æ‚åº¦ å¹³å‡ O(n).</p><hr><h1 id="12-å­—å…¸æ ‘-Trie"><a href="#12-å­—å…¸æ ‘-Trie" class="headerlink" title="12. å­—å…¸æ ‘ Trie"></a>12. å­—å…¸æ ‘ Trie</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Trie</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">        Node[] next = <span class="keyword">new</span> <span class="title class_">Node</span>[<span class="number">26</span>];</span><br><span class="line">        <span class="type">boolean</span> end;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Node</span> <span class="variable">root</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Node</span>();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(String word)</span> &#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">cur</span> <span class="operator">=</span> root;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">char</span> c : word.toCharArray()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (cur.next[c - <span class="string">&#x27;a&#x27;</span>] == <span class="literal">null</span>) cur.next[c - <span class="string">&#x27;a&#x27;</span>] = <span class="keyword">new</span> <span class="title class_">Node</span>();</span><br><span class="line">            cur = cur.next[c - <span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        cur.end = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">search</span><span class="params">(String word)</span> &#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">cur</span> <span class="operator">=</span> root;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">char</span> c : word.toCharArray()) &#123;</span><br><span class="line">            cur = cur.next[c - <span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">            <span class="keyword">if</span> (cur == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> cur.end;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">startsWith</span><span class="params">(String prefix)</span> &#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">cur</span> <span class="operator">=</span> root;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">char</span> c : prefix.toCharArray()) &#123;</span><br><span class="line">            cur = cur.next[c - <span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">            <span class="keyword">if</span> (cur == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h1 id="13-çº¿æ®µæ ‘-æ ‘çŠ¶æ•°ç»„ï¼ˆFenwickï¼‰"><a href="#13-çº¿æ®µæ ‘-æ ‘çŠ¶æ•°ç»„ï¼ˆFenwickï¼‰" class="headerlink" title="13. çº¿æ®µæ ‘ &#x2F; æ ‘çŠ¶æ•°ç»„ï¼ˆFenwickï¼‰"></a>13. çº¿æ®µæ ‘ &#x2F; æ ‘çŠ¶æ•°ç»„ï¼ˆFenwickï¼‰</h1><h3 id="13-1-æ ‘çŠ¶æ•°ç»„ï¼ˆFenwickï¼‰"><a href="#13-1-æ ‘çŠ¶æ•°ç»„ï¼ˆFenwickï¼‰" class="headerlink" title="13.1 æ ‘çŠ¶æ•°ç»„ï¼ˆFenwickï¼‰"></a>13.1 æ ‘çŠ¶æ•°ç»„ï¼ˆFenwickï¼‰</h3><p>åŠŸèƒ½ï¼šå‰ç¼€å’Œ &#x2F; å•ç‚¹æ›´æ–°ï¼Œæ„å»ºç®€å•ï¼Œå¤æ‚åº¦ O(log n)ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Fenwick</span> &#123;</span><br><span class="line">    <span class="type">int</span> n; <span class="type">int</span>[] bit;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Fenwick</span><span class="params">(<span class="type">int</span> n)</span> &#123; <span class="built_in">this</span>.n = n; bit = <span class="keyword">new</span> <span class="title class_">int</span>[n + <span class="number">1</span>]; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> delta)</span> &#123; <span class="keyword">for</span> (; i &lt;= n; i += i &amp; -i) bit[i] += delta; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">query</span><span class="params">(<span class="type">int</span> i)</span> &#123; <span class="type">int</span> <span class="variable">s</span> <span class="operator">=</span> <span class="number">0</span>; <span class="keyword">for</span> (; i &gt; <span class="number">0</span>; i -= i &amp; -i) s += bit[i]; <span class="keyword">return</span> s; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">rangeQuery</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span> &#123; <span class="keyword">return</span> query(r) - query(l - <span class="number">1</span>); &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="13-2-çº¿æ®µæ ‘ï¼ˆåŒºé—´å’Œ-åŒºé—´æ›´æ–°ï¼‰"><a href="#13-2-çº¿æ®µæ ‘ï¼ˆåŒºé—´å’Œ-åŒºé—´æ›´æ–°ï¼‰" class="headerlink" title="13.2 çº¿æ®µæ ‘ï¼ˆåŒºé—´å’Œ &#x2F; åŒºé—´æ›´æ–°ï¼‰"></a>13.2 çº¿æ®µæ ‘ï¼ˆåŒºé—´å’Œ &#x2F; åŒºé—´æ›´æ–°ï¼‰</h3><p>å®ç°ç•¥é•¿ï¼Œæ¨¡å¼ç†Ÿæ‚‰åç›´æ¥å†™æ¨¡æ¿å³å¯ â€”â€” æ”¯æŒåŒºé—´æŸ¥è¯¢&#x2F;æ›´æ–°ï¼Œå¤æ‚åº¦ O(log n)ã€‚</p><hr><h1 id="14-ä½è¿ç®—-æ•°å­¦å°æŠ€å·§"><a href="#14-ä½è¿ç®—-æ•°å­¦å°æŠ€å·§" class="headerlink" title="14. ä½è¿ç®— &#x2F; æ•°å­¦å°æŠ€å·§"></a>14. ä½è¿ç®— &#x2F; æ•°å­¦å°æŠ€å·§</h1><ul><li>å•æ•°ï¼š<code>x &amp; 1</code>ï¼›å–å <code>~x</code>ã€‚</li><li>å¼‚æˆ–ç‰¹æ€§ï¼š<code>a ^ a = 0</code>ï¼Œç”¨äºæ±‚å•æ•°ã€äº¤æ¢ä¸éœ€è¦ä¸´æ—¶å˜é‡ç­‰ã€‚</li><li><code>lowbit(x) = x &amp; -x</code>ï¼ˆæ ‘çŠ¶æ•°ç»„ç”¨åˆ°ï¼‰ã€‚</li><li>ç»Ÿè®¡ 1 çš„ä¸ªæ•°ï¼ˆHamming weightï¼‰ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hammingWeight</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">cnt</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (n != <span class="number">0</span>) &#123; n &amp;= (n - <span class="number">1</span>); cnt++; &#125;</span><br><span class="line">    <span class="keyword">return</span> cnt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å•æ•°é—®é¢˜ï¼ˆæ•°ç»„ä¸­å…¶å®ƒæ•°å‡ºç°ä¸¤æ¬¡ï¼Œåªæœ‰ä¸€ä¸ªå‡ºç°ä¸€æ¬¡ï¼‰ï¼šä½¿ç”¨ XORã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">singleNumber</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> x : nums) res ^= x;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h1 id="15-è®¾è®¡é¢˜ï¼šLRU-Cacheï¼ˆåŒå‘é“¾è¡¨-å“ˆå¸Œè¡¨ï¼‰"><a href="#15-è®¾è®¡é¢˜ï¼šLRU-Cacheï¼ˆåŒå‘é“¾è¡¨-å“ˆå¸Œè¡¨ï¼‰" class="headerlink" title="15. è®¾è®¡é¢˜ï¼šLRU Cacheï¼ˆåŒå‘é“¾è¡¨ + å“ˆå¸Œè¡¨ï¼‰"></a>15. è®¾è®¡é¢˜ï¼šLRU Cacheï¼ˆåŒå‘é“¾è¡¨ + å“ˆå¸Œè¡¨ï¼‰</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LRUCache</span> &#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Node</span> &#123; <span class="type">int</span> key, val; Node prev, next; Node(<span class="type">int</span> k,<span class="type">int</span> v)&#123;key=k;val=v;&#125; &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> capacity;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;Integer, Node&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Node</span> <span class="variable">head</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Node</span>(<span class="number">0</span>,<span class="number">0</span>), tail = <span class="keyword">new</span> <span class="title class_">Node</span>(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LRUCache</span><span class="params">(<span class="type">int</span> cap)</span> &#123;</span><br><span class="line">        capacity = cap;</span><br><span class="line">        head.next = tail; tail.prev = head;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(Node node)</span> &#123;</span><br><span class="line">        node.prev.next = node.next; node.next.prev = node.prev;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">addToHead</span><span class="params">(Node node)</span> &#123;</span><br><span class="line">        node.next = head.next; node.prev = head;</span><br><span class="line">        head.next.prev = node; head.next = node;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">get</span><span class="params">(<span class="type">int</span> key)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!map.containsKey(key)) <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">node</span> <span class="operator">=</span> map.get(key);</span><br><span class="line">        remove(node); addToHead(node);</span><br><span class="line">        <span class="keyword">return</span> node.val;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(<span class="type">int</span> key, <span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (map.containsKey(key)) &#123;</span><br><span class="line">            <span class="type">Node</span> <span class="variable">node</span> <span class="operator">=</span> map.get(key); node.val = value;</span><br><span class="line">            remove(node); addToHead(node);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (map.size() == capacity) &#123;</span><br><span class="line">                <span class="type">Node</span> <span class="variable">tailPrev</span> <span class="operator">=</span> tail.prev;</span><br><span class="line">                remove(tailPrev);</span><br><span class="line">                map.remove(tailPrev.key);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">Node</span> <span class="variable">node</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Node</span>(key, value);</span><br><span class="line">            addToHead(node); map.put(key, node);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h1 id="å°ç»“ä¸å¤ä¹ å»ºè®®ï¼ˆç»™ä½ ä¸€ä¸ªåˆ·é¢˜è·¯çº¿ï¼‰"><a href="#å°ç»“ä¸å¤ä¹ å»ºè®®ï¼ˆç»™ä½ ä¸€ä¸ªåˆ·é¢˜è·¯çº¿ï¼‰" class="headerlink" title="å°ç»“ä¸å¤ä¹ å»ºè®®ï¼ˆç»™ä½ ä¸€ä¸ªåˆ·é¢˜è·¯çº¿ï¼‰"></a>å°ç»“ä¸å¤ä¹ å»ºè®®ï¼ˆç»™ä½ ä¸€ä¸ªåˆ·é¢˜è·¯çº¿ï¼‰</h1><ul><li>åŸºç¡€é¢˜ï¼ˆæ•°ç»„ &#x2F; é“¾è¡¨ &#x2F; æ ˆ &#x2F; é˜Ÿåˆ— &#x2F; å“ˆå¸Œè¡¨ï¼‰ï¼šå…ˆç†Ÿç»ƒå¢åˆ æŸ¥éå†ï¼Œèƒ½å†™æ¨¡æ¿ã€‚</li><li>é€’å½’ + æ ‘ï¼ˆä¸­åº&#x2F;å‰åº&#x2F;ååº&#x2F;å±‚åºï¼‰ â†’ å†åš LCAã€åºåˆ—åŒ–ã€æœ€ä½æ·±åº¦ã€‚</li><li>åŒæŒ‡é’ˆ &#x2F; æ»‘åŠ¨çª—å£ &#x2F; å•è°ƒæ ˆï¼šæ‹¿æ¥è§£å†³å­æ•°ç»„ã€å­ä¸²ç±»é¢˜ã€‚</li><li>å † &#x2F; å¹¶æŸ¥é›† &#x2F; å›¾ï¼ˆBFS&#x2F;DFS&#x2F;Dijkstra&#x2F;æ‹“æ‰‘ï¼‰ â†’ é¢è¯•å¸¸è€ƒã€‚</li><li>åŠ¨æ€è§„åˆ’ï¼šä»ç»å…¸ 1D DP â†’ èƒŒåŒ…ã€åºåˆ— DP â†’ çŠ¶æ€å‹ç¼©ã€‚</li><li>å›æº¯ï¼šèƒŒè¯µå›æº¯æ¨¡æ¿ï¼Œç»ƒ N çš‡åã€å­é›† &#x2F; ç»„åˆ &#x2F; æ’åˆ— å˜ä½“ã€‚</li><li>è®¾è®¡é¢˜ï¼šLRU&#x2F;MedianFinder&#x2F;Trie&#x2F;SegmentTree æ¨¡æ¿è¦ç†Ÿæ‚‰ã€‚</li></ul><hr>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
            <tag> æ•°æ®ç»“æ„ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>web</title>
      <link href="/2025/09/11/web/"/>
      <url>/2025/09/11/web/</url>
      
        <content type="html"><![CDATA[<p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ·±å…¥åˆ° HTTP åè®®çš„åº•å±‚ï¼Œå…¨é¢è§£å‰–å®ƒçš„å·¥ä½œåŸç†ã€è¯·æ±‚-å“åº”æ¨¡å‹ã€ä»¥åŠå„ä¸ªç»„æˆéƒ¨åˆ†ã€‚</p><hr><h3 id="ä¸€ã€HTTP-åè®®æ¦‚è¿°"><a href="#ä¸€ã€HTTP-åè®®æ¦‚è¿°" class="headerlink" title="ä¸€ã€HTTP åè®®æ¦‚è¿°"></a>ä¸€ã€HTTP åè®®æ¦‚è¿°</h3><p>HTTPï¼ˆHypertext Transfer Protocolï¼Œè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰æ˜¯åº”ç”¨å±‚åè®®ï¼Œå®ƒå®šä¹‰äº† Web å®¢æˆ·ç«¯ï¼ˆå¦‚æµè§ˆå™¨ï¼‰å’Œ Web æœåŠ¡å™¨ä¹‹é—´äº¤æ¢æ•°æ®çš„è§„åˆ™ã€‚å®ƒçš„æ ¸å¿ƒç‰¹ç‚¹æ˜¯<strong>æ— çŠ¶æ€ï¼ˆStatelessï¼‰</strong>ï¼Œè¿™æ„å‘³ç€æœåŠ¡å™¨ä¸ä¼šä¿å­˜å®¢æˆ·ç«¯çš„ä»»ä½•ä¿¡æ¯ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½æ˜¯ç‹¬ç«‹çš„ã€‚</p><hr><h3 id="äºŒã€HTTP-è¯·æ±‚ï¼ˆRequestï¼‰"><a href="#äºŒã€HTTP-è¯·æ±‚ï¼ˆRequestï¼‰" class="headerlink" title="äºŒã€HTTP è¯·æ±‚ï¼ˆRequestï¼‰"></a>äºŒã€HTTP è¯·æ±‚ï¼ˆRequestï¼‰</h3><p>ä¸€ä¸ªå®Œæ•´çš„ HTTP è¯·æ±‚ç”±å››éƒ¨åˆ†ç»„æˆï¼š</p><h4 id="1-è¯·æ±‚è¡Œï¼ˆRequest-Lineï¼‰"><a href="#1-è¯·æ±‚è¡Œï¼ˆRequest-Lineï¼‰" class="headerlink" title="1. è¯·æ±‚è¡Œï¼ˆRequest Lineï¼‰"></a>1. è¯·æ±‚è¡Œï¼ˆRequest Lineï¼‰</h4><p>è¿™æ˜¯è¯·æ±‚çš„ç¬¬ä¸€è¡Œï¼Œå®ƒå®šä¹‰äº†è¯·æ±‚çš„åŸºæœ¬ä¿¡æ¯ã€‚</p><ul><li><strong>è¯·æ±‚æ–¹æ³•ï¼ˆMethodï¼‰</strong>ï¼šå¦‚ <code>GET</code>, <code>POST</code>, <code>PUT</code>, <code>DELETE</code> ç­‰ï¼Œè¡¨ç¤ºå¯¹èµ„æºçš„æ“ä½œç±»å‹ã€‚</li><li><strong>è¯·æ±‚ URL (URI)</strong>ï¼šèµ„æºçš„åœ°å€ã€‚</li><li><strong>HTTP åè®®ç‰ˆæœ¬</strong>ï¼šå¦‚ <code>HTTP/1.1</code>, <code>HTTP/2.0</code>ã€‚</li></ul><p>ç¤ºä¾‹ï¼š</p><p>GET &#x2F;index.html HTTP&#x2F;1.1</p><h4 id="2-è¯·æ±‚å¤´ï¼ˆRequest-Headersï¼‰"><a href="#2-è¯·æ±‚å¤´ï¼ˆRequest-Headersï¼‰" class="headerlink" title="2. è¯·æ±‚å¤´ï¼ˆRequest Headersï¼‰"></a>2. è¯·æ±‚å¤´ï¼ˆRequest Headersï¼‰</h4><p>è¯·æ±‚å¤´æä¾›äº†å…³äºå®¢æˆ·ç«¯ã€è¯·æ±‚ä½“å’Œä¸€äº›å…¶ä»–å…ƒæ•°æ®çš„ä¿¡æ¯ã€‚å®ƒä»¬ä»¥é”®å€¼å¯¹çš„å½¢å¼å­˜åœ¨ã€‚</p><ul><li><strong>Host</strong>ï¼šæŒ‡å®šè¯·æ±‚çš„ç›®æ ‡æœåŠ¡å™¨çš„åŸŸåå’Œç«¯å£å·ã€‚</li><li><strong>User-Agent</strong>ï¼šå®¢æˆ·ç«¯çš„è½¯ä»¶ç±»å‹å’Œç‰ˆæœ¬ï¼Œå¦‚æµè§ˆå™¨ä¿¡æ¯ã€‚</li><li><strong>Accept</strong>ï¼šå®¢æˆ·ç«¯èƒ½å¤Ÿå¤„ç†çš„åª’ä½“ç±»å‹ï¼Œå‘Šè¯‰æœåŠ¡å™¨å¸Œæœ›è¿”å›ä»€ä¹ˆæ ¼å¼çš„æ•°æ®ï¼ˆå¦‚ <code>application/json</code>, <code>text/html</code>ï¼‰ã€‚</li><li><strong>Content-Type</strong>ï¼š<strong>è¯·æ±‚ä½“</strong>ä¸­çš„æ•°æ®ç±»å‹ï¼Œåªåœ¨æœ‰è¯·æ±‚ä½“æ—¶ä½¿ç”¨ï¼ˆå¦‚ <code>POST</code>ï¼‰ã€‚å¸¸è§çš„æœ‰ï¼š<ul><li><code>application/x-www-form-urlencoded</code>ï¼šé»˜è®¤ç¼–ç ï¼Œç”¨äºæäº¤è¡¨å•æ•°æ®ã€‚</li><li><code>multipart/form-data</code>ï¼šç”¨äºä¸Šä¼ æ–‡ä»¶ã€‚</li><li><code>application/json</code>ï¼šç”¨äºå‰åç«¯åˆ†ç¦»ï¼Œæäº¤ JSON æ•°æ®ã€‚</li></ul></li><li><strong>Content-Length</strong>ï¼šè¯·æ±‚ä½“çš„é•¿åº¦ï¼ˆå­—èŠ‚ï¼‰ã€‚</li><li><strong>Cookie</strong>ï¼šå®¢æˆ·ç«¯å­˜å‚¨çš„ Cookie ä¿¡æ¯ï¼Œç”¨äºä¼šè¯ç®¡ç†ã€‚</li><li><strong>Authorization</strong>ï¼šç”¨äºèº«ä»½è®¤è¯ï¼Œå¦‚æºå¸¦ Bearer Tokenã€‚</li><li><strong>Referer</strong>ï¼šè¯·æ±‚ä»å“ªä¸ªé¡µé¢è·³è½¬è€Œæ¥ã€‚</li></ul><h4 id="3-ç©ºè¡Œ"><a href="#3-ç©ºè¡Œ" class="headerlink" title="3. ç©ºè¡Œ"></a>3. ç©ºè¡Œ</h4><p>ä¸€ä¸ªç©ºè¡Œç”¨äºåˆ†éš”è¯·æ±‚å¤´å’Œè¯·æ±‚ä½“ã€‚</p><h4 id="4-è¯·æ±‚ä½“ï¼ˆRequest-Bodyï¼‰"><a href="#4-è¯·æ±‚ä½“ï¼ˆRequest-Bodyï¼‰" class="headerlink" title="4. è¯·æ±‚ä½“ï¼ˆRequest Bodyï¼‰"></a>4. è¯·æ±‚ä½“ï¼ˆRequest Bodyï¼‰</h4><p>è¯·æ±‚ä½“åŒ…å«å®¢æˆ·ç«¯æäº¤ç»™æœåŠ¡å™¨çš„æ•°æ®ï¼Œé€šå¸¸ç”¨äº <code>POST</code>ã€<code>PUT</code> ç­‰è¯·æ±‚ã€‚GET è¯·æ±‚é€šå¸¸æ²¡æœ‰è¯·æ±‚ä½“ã€‚</p><hr><h3 id="ä¸‰ã€HTTP-å“åº”ï¼ˆResponseï¼‰"><a href="#ä¸‰ã€HTTP-å“åº”ï¼ˆResponseï¼‰" class="headerlink" title="ä¸‰ã€HTTP å“åº”ï¼ˆResponseï¼‰"></a>ä¸‰ã€HTTP å“åº”ï¼ˆResponseï¼‰</h3><p>ä¸€ä¸ªå®Œæ•´çš„ HTTP å“åº”ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š</p><h4 id="1-çŠ¶æ€è¡Œï¼ˆStatus-Lineï¼‰"><a href="#1-çŠ¶æ€è¡Œï¼ˆStatus-Lineï¼‰" class="headerlink" title="1. çŠ¶æ€è¡Œï¼ˆStatus Lineï¼‰"></a>1. çŠ¶æ€è¡Œï¼ˆStatus Lineï¼‰</h4><p>è¿™æ˜¯å“åº”çš„ç¬¬ä¸€è¡Œï¼Œå®šä¹‰äº†å“åº”çš„åŸºæœ¬ä¿¡æ¯ã€‚</p><ul><li><strong>HTTP åè®®ç‰ˆæœ¬</strong>ï¼šå¦‚ <code>HTTP/1.1</code>ã€‚</li><li><strong>çŠ¶æ€ç ï¼ˆStatus Codeï¼‰</strong>ï¼šä¸‰ä½æ•°å­—ï¼Œè¡¨ç¤ºè¯·æ±‚ç»“æœã€‚</li><li><strong>çŠ¶æ€ä¿¡æ¯ï¼ˆReason Phraseï¼‰</strong>ï¼šå¯¹çŠ¶æ€ç çš„ç®€çŸ­æè¿°ã€‚</li></ul><p>ç¤ºä¾‹ï¼š</p><p>HTTP&#x2F;1.1 200 OK</p><h4 id="2-å“åº”å¤´ï¼ˆResponse-Headersï¼‰"><a href="#2-å“åº”å¤´ï¼ˆResponse-Headersï¼‰" class="headerlink" title="2. å“åº”å¤´ï¼ˆResponse Headersï¼‰"></a>2. å“åº”å¤´ï¼ˆResponse Headersï¼‰</h4><p>å“åº”å¤´æä¾›äº†å…³äºæœåŠ¡å™¨ã€å“åº”ä½“å’Œä¼šè¯çš„å…ƒæ•°æ®ä¿¡æ¯ã€‚</p><ul><li><strong>Content-Type</strong>ï¼š<strong>å“åº”ä½“</strong>çš„æ•°æ®ç±»å‹ã€‚</li><li><strong>Content-Length</strong>ï¼šå“åº”ä½“çš„é•¿åº¦ã€‚</li><li><strong>Set-Cookie</strong>ï¼šæœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€ Cookieï¼Œç”¨äºå­˜å‚¨ä¼šè¯ ID ç­‰ä¿¡æ¯ã€‚</li><li><strong>Location</strong>ï¼šç”¨äºé‡å®šå‘ï¼ŒæŒ‡å®šæ–°çš„ URLã€‚</li><li><strong>Cache-Control</strong>ï¼šæ§åˆ¶æµè§ˆå™¨ç¼“å­˜è¡Œä¸ºã€‚</li></ul><h4 id="3-ç©ºè¡Œ-1"><a href="#3-ç©ºè¡Œ-1" class="headerlink" title="3. ç©ºè¡Œ"></a>3. ç©ºè¡Œ</h4><p>ä¸€ä¸ªç©ºè¡Œç”¨äºåˆ†éš”å“åº”å¤´å’Œå“åº”ä½“ã€‚</p><h4 id="4-å“åº”ä½“ï¼ˆResponse-Bodyï¼‰"><a href="#4-å“åº”ä½“ï¼ˆResponse-Bodyï¼‰" class="headerlink" title="4. å“åº”ä½“ï¼ˆResponse Bodyï¼‰"></a>4. å“åº”ä½“ï¼ˆResponse Bodyï¼‰</h4><p>å“åº”ä½“åŒ…å«äº†æœåŠ¡å™¨è¿”å›ç»™å®¢æˆ·ç«¯çš„å®é™…æ•°æ®ï¼Œå¦‚ HTML ç½‘é¡µå†…å®¹ã€JSON æ•°æ®æˆ–å›¾ç‰‡ç­‰ã€‚</p><hr><h3 id="å››ã€HTTP-æ–¹æ³•çš„å¹‚ç­‰æ€§ä¸å®‰å…¨æ€§"><a href="#å››ã€HTTP-æ–¹æ³•çš„å¹‚ç­‰æ€§ä¸å®‰å…¨æ€§" class="headerlink" title="å››ã€HTTP æ–¹æ³•çš„å¹‚ç­‰æ€§ä¸å®‰å…¨æ€§"></a>å››ã€HTTP æ–¹æ³•çš„å¹‚ç­‰æ€§ä¸å®‰å…¨æ€§</h3><ul><li><strong>å®‰å…¨æ€§</strong>ï¼šæŒ‡è¯·æ±‚æ–¹æ³•ä¸ä¼šå¯¹æœåŠ¡å™¨ä¸Šçš„èµ„æºçŠ¶æ€äº§ç”Ÿä¿®æ”¹ã€‚<code>GET</code> å’Œ <code>HEAD</code> æ–¹æ³•æ˜¯å®‰å…¨çš„ã€‚</li><li><strong>å¹‚ç­‰æ€§</strong>ï¼šæŒ‡è¯·æ±‚æ–¹æ³•é‡å¤æ‰§è¡Œå¤šæ¬¡ï¼Œå¯¹æœåŠ¡å™¨ä¸Šçš„èµ„æºçŠ¶æ€äº§ç”Ÿçš„å½±å“ä¸æ‰§è¡Œä¸€æ¬¡çš„å½±å“ç›¸åŒã€‚<ul><li><strong>å¹‚ç­‰æ–¹æ³•</strong>ï¼š<code>GET</code>, <code>HEAD</code>, <code>PUT</code>, <code>DELETE</code>ã€‚</li><li><strong>éå¹‚ç­‰æ–¹æ³•</strong>ï¼š<code>POST</code>ã€‚</li></ul></li></ul><table><thead><tr><th>æ–¹æ³•</th><th>å®‰å…¨æ€§</th><th>å¹‚ç­‰æ€§</th><th>å…¸å‹ç”¨é€”</th></tr></thead><tbody><tr><td><strong>GET</strong></td><td>æ˜¯</td><td>æ˜¯</td><td>è·å–èµ„æº</td></tr><tr><td><strong>POST</strong></td><td>å¦</td><td>å¦</td><td>åˆ›å»ºèµ„æº</td></tr><tr><td><strong>PUT</strong></td><td>å¦</td><td>æ˜¯</td><td>æ›´æ–°æˆ–æ›¿æ¢èµ„æº</td></tr><tr><td><strong>DELETE</strong></td><td>å¦</td><td>æ˜¯</td><td>åˆ é™¤èµ„æº</td></tr></tbody></table><hr><h3 id="äº”ã€HTTP-çš„ä¼šè¯ç®¡ç†ï¼šCookie"><a href="#äº”ã€HTTP-çš„ä¼šè¯ç®¡ç†ï¼šCookie" class="headerlink" title="äº”ã€HTTP çš„ä¼šè¯ç®¡ç†ï¼šCookie"></a>äº”ã€HTTP çš„ä¼šè¯ç®¡ç†ï¼šCookie</h3><p>HTTP æœ¬èº«æ˜¯æ— çŠ¶æ€çš„ï¼Œä½†ä¸ºäº†è·Ÿè¸ªç”¨æˆ·ï¼Œå¼•å…¥äº† Cookieã€‚</p><ol><li><strong>åˆ›å»º</strong>ï¼šæœåŠ¡å™¨é€šè¿‡å“åº”å¤´ <code>Set-Cookie</code> å‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª Cookieã€‚</li><li><strong>å­˜å‚¨</strong>ï¼šæµè§ˆå™¨æ¥æ”¶åˆ° <code>Set-Cookie</code> åï¼Œä¼šå°†å…¶å­˜å‚¨åœ¨æœ¬åœ°ã€‚</li><li><strong>æºå¸¦</strong>ï¼šä¹‹åï¼Œæ¯æ¬¡å¯¹åŒä¸€åŸŸåå‘èµ·è¯·æ±‚æ—¶ï¼Œæµè§ˆå™¨éƒ½ä¼šè‡ªåŠ¨åœ¨è¯·æ±‚å¤´ <code>Cookie</code> ä¸­å¸¦ä¸Šè¿™ä¸ª Cookieã€‚</li></ol><p>é€šè¿‡åœ¨ Cookie ä¸­å­˜å‚¨ä¸€ä¸ª SessionIDï¼ŒæœåŠ¡å™¨å°±å¯ä»¥åœ¨åç»­è¯·æ±‚ä¸­æ‰¾åˆ°å¯¹åº”çš„ä¼šè¯æ•°æ®ï¼Œä»è€Œå®ç°çŠ¶æ€ç®¡ç†ã€‚</p><hr><h3 id="å…­ã€HTTP-1-1-ä¸-HTTP-2-çš„åŒºåˆ«"><a href="#å…­ã€HTTP-1-1-ä¸-HTTP-2-çš„åŒºåˆ«" class="headerlink" title="å…­ã€HTTP&#x2F;1.1 ä¸ HTTP&#x2F;2 çš„åŒºåˆ«"></a>å…­ã€HTTP&#x2F;1.1 ä¸ HTTP&#x2F;2 çš„åŒºåˆ«</h3><ul><li><strong>å¤šè·¯å¤ç”¨ï¼ˆMultiplexingï¼‰</strong>ï¼šHTTP&#x2F;2 å…è®¸åœ¨<strong>ä¸€ä¸ª TCP è¿æ¥</strong>ä¸ŠåŒæ—¶å‘é€å¤šä¸ªè¯·æ±‚å’Œå“åº”ï¼Œè§£å†³äº† HTTP&#x2F;1.1 é˜Ÿå¤´é˜»å¡çš„é—®é¢˜ï¼Œæ˜¾è‘—æé«˜äº†æ€§èƒ½ã€‚</li><li><strong>å¤´éƒ¨å‹ç¼©ï¼ˆHeader Compressionï¼‰</strong>ï¼šHTTP&#x2F;2 ä½¿ç”¨ HPACK ç®—æ³•å‹ç¼©è¯·æ±‚å’Œå“åº”å¤´ï¼Œå‡å°‘äº†æ•°æ®ä¼ è¾“é‡ã€‚</li><li><strong>æœåŠ¡å™¨æ¨é€ï¼ˆServer Pushï¼‰</strong>ï¼šæœåŠ¡å™¨å¯ä»¥åœ¨å®¢æˆ·ç«¯è¯·æ±‚ä¸€ä¸ªèµ„æºæ—¶ï¼Œä¸»åŠ¨æ¨é€å…¶ä»–å®ƒè®¤ä¸ºå®¢æˆ·ç«¯å¯èƒ½éœ€è¦çš„èµ„æºï¼Œå‡å°‘äº†å®¢æˆ·ç«¯çš„è¯·æ±‚æ¬¡æ•°ã€‚</li><li><strong>äºŒè¿›åˆ¶åˆ†å¸§ï¼ˆBinary Framingï¼‰</strong>ï¼šHTTP&#x2F;2 å°†æ‰€æœ‰ä¼ è¾“ä¿¡æ¯åˆ†å‰²æˆæ›´å°çš„æ¶ˆæ¯å’Œå¸§ï¼Œå¹¶é‡‡ç”¨äºŒè¿›åˆ¶ç¼–ç ï¼Œä½¿å¾—è§£ææ›´é«˜æ•ˆã€‚</li></ul><p>å¥½çš„ï¼Œæˆ‘ä»¬æ¥è¯¦ç»†è¡¥å…… <strong>HTTP&#x2F;1.0</strong> çš„æ ¸å¿ƒæ¦‚å¿µï¼Œå¹¶å¯¹æ•´ä¸ª HTTP åè®®æ—è¿›è¡Œå…¨é¢çš„å¯¹æ¯”å’Œæ·±å…¥è§£æã€‚</p><hr><h3 id="ä¸€ã€HTTP-åè®®æ—æ¼”å˜ï¼šä»-1-0-åˆ°-2-0"><a href="#ä¸€ã€HTTP-åè®®æ—æ¼”å˜ï¼šä»-1-0-åˆ°-2-0" class="headerlink" title="ä¸€ã€HTTP åè®®æ—æ¼”å˜ï¼šä» 1.0 åˆ° 2.0"></a>ä¸€ã€HTTP åè®®æ—æ¼”å˜ï¼šä» 1.0 åˆ° 2.0</h3><h4 id="HTTP-1-0"><a href="#HTTP-1-0" class="headerlink" title="HTTP&#x2F;1.0"></a>HTTP&#x2F;1.0</h4><p>HTTP&#x2F;1.0 æ˜¯ HTTP åè®®çš„æ—©æœŸç‰ˆæœ¬ï¼Œå®ƒçš„è®¾è®¡ç›¸å¯¹ç®€å•ï¼Œä¸»è¦ç”¨äºæ»¡è¶³åŸºæœ¬çš„ç½‘é¡µæµè§ˆéœ€æ±‚ã€‚</p><ul><li><strong>æ ¸å¿ƒç‰¹ç‚¹ï¼š</strong><ul><li><strong>éæŒä¹…è¿æ¥ï¼ˆNon-persistent Connectionï¼‰</strong>ï¼šè¿™æ˜¯ HTTP&#x2F;1.0 æœ€æ˜¾è‘—çš„ç‰¹ç‚¹ã€‚æ¯è¿›è¡Œä¸€æ¬¡ HTTP è¯·æ±‚-å“åº”ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å°±ä¼šå»ºç«‹ä¸€ä¸ªæ–°çš„ <strong>TCP è¿æ¥</strong>ï¼Œå¹¶åœ¨è¯·æ±‚å®Œæˆåç«‹å³æ–­å¼€ã€‚<ul><li><strong>ç¼ºç‚¹</strong>ï¼šæ¯æ¬¡è¯·æ±‚éƒ½éœ€è¦ç»è¿‡ TCP ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹çš„è¿‡ç¨‹ï¼Œè¿™å¸¦æ¥äº†å·¨å¤§çš„æ€§èƒ½å¼€é”€ã€‚å¦‚æœä¸€ä¸ªç½‘é¡µåŒ…å«å¤šä¸ªå›¾ç‰‡ã€CSS æˆ– JavaScript æ–‡ä»¶ï¼Œæµè§ˆå™¨éœ€è¦ä¸ºæ¯ä¸ªæ–‡ä»¶å•ç‹¬å»ºç«‹å’Œæ–­å¼€è¿æ¥ï¼Œå¯¼è‡´é¡µé¢åŠ è½½é€Ÿåº¦æ…¢ã€‚</li></ul></li><li><strong>æ— ä¸»æœºå¤´ï¼ˆNo Host Headerï¼‰</strong>ï¼šè¯·æ±‚å¤´ä¸­æ²¡æœ‰ <code>Host</code> å­—æ®µã€‚è¿™æ„å‘³ç€ä¸€ä¸ª IP åœ°å€åªèƒ½å¯¹åº”ä¸€ä¸ªåŸŸåã€‚å¦‚æœæœåŠ¡å™¨ä¸Šæœ‰å¤šä¸ªç½‘ç«™ï¼Œå°±æ— æ³•é€šè¿‡ IP åœ°å€æ¥åŒºåˆ†å®ƒä»¬ï¼Œè¿™åœ¨è™šæ‹Ÿä¸»æœºæ—¶ä»£æ˜¯ä¸ªå¤§é—®é¢˜ã€‚</li><li><strong>ä¸æ”¯æŒç®¡çº¿åŒ–ï¼ˆPipeliningï¼‰</strong>ï¼šå®¢æˆ·ç«¯å‘é€ä¸€ä¸ªè¯·æ±‚åï¼Œå¿…é¡»ç­‰å¾…æœåŠ¡å™¨çš„å“åº”ï¼Œæ‰èƒ½å‘é€ä¸‹ä¸€ä¸ªè¯·æ±‚ã€‚</li></ul></li></ul><h4 id="HTTP-1-1"><a href="#HTTP-1-1" class="headerlink" title="HTTP&#x2F;1.1"></a>HTTP&#x2F;1.1</h4><p>HTTP&#x2F;1.1 åè®®æ˜¯å¯¹ 1.0 çš„é‡å¤§æ”¹è¿›ï¼Œè§£å†³äº†å…¶å¤§éƒ¨åˆ†æ€§èƒ½ç“¶é¢ˆã€‚</p><ul><li><strong>æ ¸å¿ƒç‰¹ç‚¹ï¼š</strong><ul><li><strong>æŒä¹…è¿æ¥ï¼ˆPersistent Connectionï¼‰</strong>ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼ŒHTTP&#x2F;1.1 ä¼šåœ¨ä¸€æ¬¡è¯·æ±‚-å“åº”ä¹‹å<strong>ä¿æŒ TCP è¿æ¥ä¸æ–­å¼€</strong>ã€‚å®¢æˆ·ç«¯å¯ä»¥ç»§ç»­åœ¨è¿™ä¸ªè¿æ¥ä¸Šå‘é€åç»­è¯·æ±‚ã€‚<ul><li><strong>ä¼˜ç‚¹</strong>ï¼šæ˜¾è‘—å‡å°‘äº† TCP è¿æ¥çš„å»ºç«‹å’Œæ–­å¼€å¼€é”€ï¼Œæé«˜äº†é¡µé¢åŠ è½½é€Ÿåº¦ã€‚è¿™ä¸ªç‰¹æ€§ä¹Ÿç§°ä¸ºâ€œKeep-Aliveâ€ã€‚</li></ul></li><li><strong>æ”¯æŒä¸»æœºå¤´ï¼ˆHost Headerï¼‰</strong>ï¼šè¯·æ±‚å¤´ä¸­å¼•å…¥äº† <code>Host</code> å­—æ®µï¼Œå…è®¸åœ¨åŒä¸€ä¸ª IP åœ°å€ä¸Šéƒ¨ç½²å¤šä¸ªè™šæ‹Ÿä¸»æœºï¼ˆåŸŸåï¼‰ã€‚</li><li><strong>æ”¯æŒç®¡çº¿åŒ–ï¼ˆPipeliningï¼‰</strong>ï¼šå®¢æˆ·ç«¯å¯ä»¥åœ¨æ”¶åˆ°ä¸Šä¸€ä¸ªå“åº”ä¹‹å‰ï¼Œè¿ç»­å‘é€å¤šä¸ªè¯·æ±‚ã€‚<ul><li><strong>ç¼ºç‚¹</strong>ï¼šè™½ç„¶æé«˜äº†æ•ˆç‡ï¼Œä½†å­˜åœ¨**é˜Ÿå¤´é˜»å¡ï¼ˆHead-of-Line Blockingï¼‰**é—®é¢˜ã€‚å¦‚æœç¬¬ä¸€ä¸ªè¯·æ±‚å¤„ç†æ—¶é—´å¾ˆé•¿ï¼Œåé¢çš„è¯·æ±‚å³ä½¿å·²ç»å¤„ç†å®Œæˆï¼Œä¹Ÿå¿…é¡»ç­‰å¾…å®ƒçš„å“åº”ï¼Œå¯¼è‡´æ•´ä¸ªè¿æ¥çš„æ•ˆç‡é™ä½ã€‚</li></ul></li><li><strong>å¼•å…¥ç¼“å­˜æœºåˆ¶</strong>ï¼šé€šè¿‡ <code>Cache-Control</code>, <code>ETag</code>, <code>If-None-Match</code> ç­‰è¯·æ±‚å¤´ï¼ŒHTTP&#x2F;1.1 æä¾›äº†æ›´å®Œå–„çš„ç¼“å­˜æœºåˆ¶ï¼Œå‡å°‘äº†ä¸å¿…è¦çš„è¯·æ±‚ã€‚</li></ul></li></ul><h4 id="HTTP-2-0"><a href="#HTTP-2-0" class="headerlink" title="HTTP&#x2F;2.0"></a>HTTP&#x2F;2.0</h4><p>HTTP&#x2F;2.0 æ˜¯ä¸ºäº†è§£å†³ HTTP&#x2F;1.1 åœ¨ç§»åŠ¨äº’è”ç½‘å’Œé«˜å¹¶å‘åœºæ™¯ä¸‹çš„æ€§èƒ½é—®é¢˜è€Œè®¾è®¡çš„ã€‚å®ƒä¸æ˜¯å¯¹ HTTP&#x2F;1.1 çš„ç®€å•å‡çº§ï¼Œè€Œæ˜¯å¯¹åè®®åº•å±‚è¿›è¡Œäº†é‡æ„ã€‚</p><ul><li><strong>æ ¸å¿ƒç‰¹ç‚¹ï¼š</strong><ul><li><strong>å¤šè·¯å¤ç”¨ï¼ˆMultiplexingï¼‰</strong>ï¼šè¿™æ˜¯ HTTP&#x2F;2 çš„æ ¸å¿ƒã€‚å®ƒå…è®¸åœ¨<strong>ä¸€ä¸ª TCP è¿æ¥</strong>ä¸ŠåŒæ—¶å¤„ç†å¤šä¸ª HTTP è¯·æ±‚å’Œå“åº”ã€‚<ul><li><strong>å¦‚ä½•å®ç°ï¼Ÿ</strong>ï¼šHTTP&#x2F;2 å°†æ‰€æœ‰æ•°æ®æµï¼ˆStreamï¼‰åˆ†å‰²æˆæ›´å°çš„äºŒè¿›åˆ¶å¸§ï¼ˆFrameï¼‰ï¼Œæ¯ä¸ªå¸§éƒ½å¸¦æœ‰å”¯ä¸€çš„æ ‡è¯†ç¬¦ã€‚è¿™æ ·ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯ä»¥åœ¨åŒä¸€ä¸ªè¿æ¥ä¸Šäº¤é”™å‘é€å’Œæ¥æ”¶å¸§ï¼Œç„¶åæ ¹æ®æ ‡è¯†ç¬¦é‡æ–°ç»„è£…ï¼Œä»è€Œå½»åº•è§£å†³äº† HTTP&#x2F;1.1 çš„é˜Ÿå¤´é˜»å¡é—®é¢˜ã€‚</li></ul></li><li><strong>å¤´éƒ¨å‹ç¼©ï¼ˆHeader Compressionï¼‰</strong>ï¼šHTTP&#x2F;2 ä½¿ç”¨ HPACK ç®—æ³•æ¥å‹ç¼©è¯·æ±‚å’Œå“åº”å¤´ï¼Œå°¤å…¶æ˜¯å¯¹äºé‡å¤å‘é€çš„å­—æ®µï¼Œå¤§å¤§å‡å°‘äº†æ•°æ®ä¼ è¾“é‡ã€‚</li><li><strong>æœåŠ¡å™¨æ¨é€ï¼ˆServer Pushï¼‰</strong>ï¼šæœåŠ¡å™¨å¯ä»¥åœ¨å®¢æˆ·ç«¯è¯·æ±‚ä¸€ä¸ªèµ„æºï¼ˆå¦‚ HTML é¡µé¢ï¼‰æ—¶ï¼Œä¸»åŠ¨æ¨é€å…¶ä»–å®ƒè®¤ä¸ºå®¢æˆ·ç«¯å¯èƒ½éœ€è¦çš„èµ„æºï¼ˆå¦‚ CSS å’Œ JS æ–‡ä»¶ï¼‰ï¼Œè€Œæ— éœ€å®¢æˆ·ç«¯æ˜¾å¼è¯·æ±‚ï¼Œè¿›ä¸€æ­¥æé«˜äº†åŠ è½½é€Ÿåº¦ã€‚</li><li><strong>äºŒè¿›åˆ¶åè®®</strong>ï¼šHTTP&#x2F;2 æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶åè®®ï¼Œè€Œä¸æ˜¯æ–‡æœ¬åè®®ï¼Œè§£ææ›´é«˜æ•ˆã€æ›´ä¸å®¹æ˜“å‡ºé”™ã€‚</li></ul></li></ul><hr><h3 id="äºŒã€HTTP-åè®®ç‰ˆæœ¬å¯¹æ¯”æ€»ç»“"><a href="#äºŒã€HTTP-åè®®ç‰ˆæœ¬å¯¹æ¯”æ€»ç»“" class="headerlink" title="äºŒã€HTTP åè®®ç‰ˆæœ¬å¯¹æ¯”æ€»ç»“"></a>äºŒã€HTTP åè®®ç‰ˆæœ¬å¯¹æ¯”æ€»ç»“</h3><p>ç†è§£ HTTP åè®®çš„æ¼”å˜å†ç¨‹ï¼Œèƒ½è®©ä½ æ›´æ·±åˆ»åœ°ä½“ä¼šåˆ° Web æ€§èƒ½ä¼˜åŒ–çš„æ–¹å‘ï¼Œä»¥åŠç°ä»£ Web æ¡†æ¶å¦‚ä½•åˆ©ç”¨è¿™äº›åº•å±‚åè®®ç‰¹æ€§æ¥æä¾›æ›´é«˜æ•ˆçš„æœåŠ¡ã€‚</p><table><thead><tr><th>ç‰¹æ€§</th><th>HTTP&#x2F;1.0</th><th>HTTP&#x2F;1.1</th><th>HTTP&#x2F;2.0</th></tr></thead><tbody><tr><td><strong>TCP è¿æ¥</strong></td><td>éæŒä¹…è¿æ¥</td><td>é»˜è®¤æŒä¹…è¿æ¥</td><td>å•ä¸ª TCP è¿æ¥å¤šè·¯å¤ç”¨</td></tr><tr><td><strong>æ€§èƒ½ç“¶é¢ˆ</strong></td><td>å¤šæ¬¡æ¡æ‰‹æŒ¥æ‰‹å¼€é”€</td><td>é˜Ÿå¤´é˜»å¡</td><td>æ— </td></tr><tr><td><strong>ä¸»æœºå¤´</strong></td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ (<code>Host</code> Header)</td><td>æ”¯æŒ</td></tr><tr><td><strong>å¹¶å‘è¯·æ±‚</strong></td><td>ä¸²è¡Œï¼ˆä¸€ä¸ªè¯·æ±‚ä¸€ä¸ªè¿æ¥ï¼‰</td><td>ä¸²è¡Œï¼ˆä¸€ä¸ªè¿æ¥ä¸€ä¸ªè¯·æ±‚ï¼‰</td><td>å¹¶è¡Œï¼ˆä¸€ä¸ªè¿æ¥å¤šä¸ªè¯·æ±‚ï¼‰</td></tr><tr><td><strong>æ•°æ®æ ¼å¼</strong></td><td>æ–‡æœ¬åè®®</td><td>æ–‡æœ¬åè®®</td><td>äºŒè¿›åˆ¶åè®®</td></tr><tr><td><strong>å¤´éƒ¨</strong></td><td>æ— å‹ç¼©</td><td>æ— å‹ç¼©</td><td>HPACK ç®—æ³•å‹ç¼©</td></tr><tr><td><strong>æœåŠ¡å™¨æ¨é€</strong></td><td>ä¸æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td></tr></tbody></table><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æŠŠæ‰€æœ‰å…³äº Servlet çš„çŸ¥è¯†ç‚¹æ•´åˆåœ¨ä¸€èµ·ï¼Œè¿›è¡Œä¸€æ¬¡æœ€å…¨é¢ã€æœ€æ·±å…¥çš„å‰–æã€‚æˆ‘ä»¬å°†ä»åŸºç¡€æ¦‚å¿µå¼€å§‹ï¼Œé€æ­¥æ·±å…¥åˆ°å®ƒçš„ç”Ÿå‘½å‘¨æœŸã€é…ç½®ã€æ ¸å¿ƒæ–¹æ³•ä»¥åŠä¸ Servlet è§„èŒƒç›¸å…³çš„å…¶ä»–é‡è¦ç»„ä»¶ã€‚</p><hr><h3 id="Servlet-æ¦‚è¿°ï¼šJava-Web-çš„æ ¸å¿ƒåŸºçŸ³"><a href="#Servlet-æ¦‚è¿°ï¼šJava-Web-çš„æ ¸å¿ƒåŸºçŸ³" class="headerlink" title="Servlet æ¦‚è¿°ï¼šJava Web çš„æ ¸å¿ƒåŸºçŸ³"></a>Servlet æ¦‚è¿°ï¼šJava Web çš„æ ¸å¿ƒåŸºçŸ³</h3><p><strong>Servlet</strong> æ˜¯ Java EE è§„èŒƒä¸­çš„ä¸€ä¸ªæ ¸å¿ƒç»„ä»¶ï¼Œå®ƒæ˜¯ä¸€ä¸ªè¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„ Java ç¨‹åºï¼Œç”¨äºå¤„ç† HTTP è¯·æ±‚å’Œç”ŸæˆåŠ¨æ€å“åº”ã€‚ä½ å¯ä»¥æŠŠå®ƒçœ‹ä½œæ˜¯æ‰€æœ‰ Java Web æ¡†æ¶ï¼ˆå¦‚ Spring MVCï¼‰çš„åº•å±‚å¼•æ“ã€‚</p><p><strong>å®ƒçš„æ ¸å¿ƒä½œç”¨</strong>æ˜¯ä½œä¸ºå®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰å’Œ Java åº”ç”¨ç¨‹åºä¹‹é—´çš„â€œæ¡¥æ¢â€ã€‚Servlet å®¹å™¨ï¼ˆå¦‚ Tomcatã€Jettyï¼‰è´Ÿè´£ç›‘å¬ç½‘ç»œè¯·æ±‚ï¼Œç„¶åå°†è¯·æ±‚åˆ†å‘ç»™ç›¸åº”çš„ Servlet è¿›è¡Œå¤„ç†ã€‚</p><h3 id="Servlet-çš„ç”Ÿå‘½å‘¨æœŸï¼šç”±å®¹å™¨ä¸¥æ ¼ç®¡ç†"><a href="#Servlet-çš„ç”Ÿå‘½å‘¨æœŸï¼šç”±å®¹å™¨ä¸¥æ ¼ç®¡ç†" class="headerlink" title="Servlet çš„ç”Ÿå‘½å‘¨æœŸï¼šç”±å®¹å™¨ä¸¥æ ¼ç®¡ç†"></a>Servlet çš„ç”Ÿå‘½å‘¨æœŸï¼šç”±å®¹å™¨ä¸¥æ ¼ç®¡ç†</h3><p>ä¸€ä¸ª Servlet çš„ç”Ÿå‘½å‘¨æœŸç”± Servlet å®¹å™¨ä¸¥æ ¼ç®¡ç†ï¼Œé€šå¸¸åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š</p><ol><li><strong>åˆå§‹åŒ–ï¼ˆInitializationï¼‰</strong><ul><li><strong>æ—¶æœº</strong>ï¼šå½“ Servlet å®¹å™¨ç¬¬ä¸€æ¬¡åŠ è½½ Servlet ç±»å¹¶åˆ›å»ºå…¶å®ä¾‹åï¼Œç«‹å³è°ƒç”¨ <code>init()</code> æ–¹æ³•ã€‚</li><li><strong>ç‰¹æ€§</strong>ï¼šè¿™ä¸ªæ–¹æ³•<strong>åªæ‰§è¡Œä¸€æ¬¡</strong>ï¼Œé€šå¸¸ç”¨äºåŠ è½½é…ç½®æ–‡ä»¶ã€å»ºç«‹æ•°æ®åº“è¿æ¥æ± ç­‰ä¸€æ¬¡æ€§ã€è€—æ—¶çš„ä»»åŠ¡ã€‚å¦‚æœ <code>init()</code> æ–¹æ³•æŠ›å‡ºå¼‚å¸¸ï¼ŒServlet å°†æ— æ³•æä¾›æœåŠ¡ã€‚</li></ul></li><li><strong>æœåŠ¡ï¼ˆServicingï¼‰</strong><ul><li><strong>æ—¶æœº</strong>ï¼šæ¯å½“ä¸€ä¸ªå®¢æˆ·ç«¯è¯·æ±‚åˆ°è¾¾æ—¶ï¼Œå®¹å™¨ä¼šä¸ºè¯¥è¯·æ±‚åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œå¹¶è°ƒç”¨ <code>service()</code> æ–¹æ³•ã€‚</li><li><strong>ç‰¹æ€§</strong>ï¼š<code>service()</code> æ–¹æ³•æ˜¯ Servlet çš„æ ¸å¿ƒï¼Œå®ƒä¼šæ ¹æ®è¯·æ±‚ç±»å‹ï¼ˆå¦‚ GETã€POSTï¼‰è‡ªåŠ¨è°ƒç”¨ç›¸åº”çš„ <code>doGet()</code>ã€<code>doPost()</code> ç­‰æ–¹æ³•ã€‚ç”±äºæ­¤æ–¹æ³•ä¼šè¢«å¤šä¸ªçº¿ç¨‹å¹¶å‘è°ƒç”¨ï¼Œå› æ­¤è®¿é—®å…±äº«èµ„æºæ—¶å¿…é¡»æ³¨æ„<strong>çº¿ç¨‹å®‰å…¨</strong>ã€‚</li></ul></li><li><strong>é”€æ¯ï¼ˆDestructionï¼‰</strong><ul><li><strong>æ—¶æœº</strong>ï¼šå½“ Servlet å®¹å™¨å…³é—­æˆ–å†³å®šå¸è½½æŸä¸ª Servlet æ—¶ï¼Œä¼šè°ƒç”¨å…¶ <code>destroy()</code> æ–¹æ³•ã€‚</li><li><strong>ç‰¹æ€§</strong>ï¼šè¿™ä¸ªæ–¹æ³•ä¹Ÿ<strong>åªæ‰§è¡Œä¸€æ¬¡</strong>ï¼Œç”¨äºé‡Šæ”¾èµ„æºï¼Œå¦‚å…³é—­æ•°æ®åº“è¿æ¥æˆ–æ–‡ä»¶æµã€‚</li></ul></li></ol><h3 id="Servlet-çš„é…ç½®å’Œéƒ¨ç½²ï¼šä¸¤ç§ä¸»è¦æ–¹å¼"><a href="#Servlet-çš„é…ç½®å’Œéƒ¨ç½²ï¼šä¸¤ç§ä¸»è¦æ–¹å¼" class="headerlink" title="Servlet çš„é…ç½®å’Œéƒ¨ç½²ï¼šä¸¤ç§ä¸»è¦æ–¹å¼"></a>Servlet çš„é…ç½®å’Œéƒ¨ç½²ï¼šä¸¤ç§ä¸»è¦æ–¹å¼</h3><p>ä¸ºäº†è®©å®¹å™¨çŸ¥é“å¦‚ä½•åŠ è½½å’Œæ˜ å°„ Servletï¼Œä½ éœ€è¦è¿›è¡Œé…ç½®ã€‚</p><ol><li><strong>web.xml é…ç½®ï¼ˆä¼ ç»Ÿæ–¹å¼ï¼‰</strong><ul><li>åœ¨ <code>web.xml</code> æ–‡ä»¶ä¸­ï¼Œä½¿ç”¨ <code>&lt;servlet&gt;</code> æ ‡ç­¾å®šä¹‰ Servlet ç±»ï¼Œå¹¶ä½¿ç”¨ <code>&lt;servlet-mapping&gt;</code> æ ‡ç­¾å°†å®ƒæ˜ å°„åˆ°ä¸€ä¸ª URL è·¯å¾„ã€‚</li><li><strong>ä¼˜ç‚¹</strong>ï¼šé…ç½®é›†ä¸­ï¼Œæ˜“äºç®¡ç†ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šå¦‚æœ Servlet å¾ˆå¤šï¼Œ<code>web.xml</code> æ–‡ä»¶ä¼šå˜å¾—éå¸¸åºå¤§ã€‚</li></ul></li><li><strong>æ³¨è§£é…ç½®ï¼ˆç°ä»£æ–¹å¼ï¼‰</strong><ul><li>ä» Servlet 3.0 è§„èŒƒå¼€å§‹ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>@WebServlet</code> æ³¨è§£æ¥ç®€åŒ–é…ç½®ã€‚åªéœ€åœ¨ä½ çš„ Servlet ç±»ä¸Šæ·»åŠ  <code>@WebServlet(&quot;/path&quot;)</code> æ³¨è§£ï¼Œå®¹å™¨å°±ä¼šè‡ªåŠ¨è¯†åˆ«å’Œé…ç½®å®ƒã€‚</li><li><strong>ä¼˜ç‚¹</strong>ï¼šé…ç½®ç®€å•ï¼Œä»£ç å’Œé…ç½®åœ¨ä¸€èµ·ï¼Œæé«˜äº†å¯è¯»æ€§ã€‚</li></ul></li></ol><h3 id="Servlet-çš„æ ¸å¿ƒæ–¹æ³•ï¼šå¤„ç†è¯·æ±‚å’Œå“åº”"><a href="#Servlet-çš„æ ¸å¿ƒæ–¹æ³•ï¼šå¤„ç†è¯·æ±‚å’Œå“åº”" class="headerlink" title="Servlet çš„æ ¸å¿ƒæ–¹æ³•ï¼šå¤„ç†è¯·æ±‚å’Œå“åº”"></a>Servlet çš„æ ¸å¿ƒæ–¹æ³•ï¼šå¤„ç†è¯·æ±‚å’Œå“åº”</h3><p>æ‰€æœ‰ Servlet éƒ½åº”è¯¥å®ç° <code>javax.servlet.Servlet</code> æ¥å£ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬æ›´å¸¸ç»§æ‰¿ <code>javax.servlet.http.HttpServlet</code>ï¼Œå› ä¸ºå®ƒæä¾›äº†æ›´æ–¹ä¾¿çš„ HTTP è¯·æ±‚å¤„ç†æ–¹æ³•ã€‚</p><ul><li><code>service(HttpServletRequest req, HttpServletResponse res)</code>ï¼šè¿™æ˜¯æ ¸å¿ƒæœåŠ¡æ–¹æ³•ï¼Œç”±å®¹å™¨è°ƒç”¨ã€‚å®ƒä¼šæ ¹æ®è¯·æ±‚çš„ HTTP æ–¹æ³•ï¼ˆGETã€POSTã€PUT ç­‰ï¼‰æ¥è°ƒç”¨ç›¸åº”çš„ <code>doGet()</code>ã€<code>doPost()</code> ç­‰æ–¹æ³•ã€‚</li><li><code>doGet(HttpServletRequest req, HttpServletResponse res)</code>ï¼šå¤„ç†æ‰€æœ‰ GET è¯·æ±‚ã€‚</li><li><code>doPost(HttpServletRequest req, HttpServletResponse res)</code>ï¼šå¤„ç†æ‰€æœ‰ POST è¯·æ±‚ã€‚</li><li><code>doPut(HttpServletRequest req, HttpServletResponse res)</code>ï¼šå¤„ç†æ‰€æœ‰ PUT è¯·æ±‚ã€‚</li><li><code>doDelete(HttpServletRequest req, HttpServletResponse res)</code>ï¼šå¤„ç†æ‰€æœ‰ DELETE è¯·æ±‚ã€‚</li></ul><p>åœ¨è¿™äº›æ–¹æ³•ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡ <code>req</code> (è¯·æ±‚) å’Œ <code>res</code> (å“åº”) å¯¹è±¡æ¥ä¸å®¢æˆ·ç«¯è¿›è¡Œäº¤äº’ã€‚</p><h3 id="Servlet-çš„è¯·æ±‚å’Œå“åº”å¤„ç†ï¼šä¸å®¢æˆ·ç«¯äº¤äº’"><a href="#Servlet-çš„è¯·æ±‚å’Œå“åº”å¤„ç†ï¼šä¸å®¢æˆ·ç«¯äº¤äº’" class="headerlink" title="Servlet çš„è¯·æ±‚å’Œå“åº”å¤„ç†ï¼šä¸å®¢æˆ·ç«¯äº¤äº’"></a>Servlet çš„è¯·æ±‚å’Œå“åº”å¤„ç†ï¼šä¸å®¢æˆ·ç«¯äº¤äº’</h3><ul><li><strong>è·å–è¯·æ±‚å‚æ•°</strong><ul><li><code>req.getParameter(&quot;paramName&quot;)</code>ï¼šè·å–å•ä¸ªå‚æ•°å€¼ã€‚</li><li><code>req.getParameterValues(&quot;paramName&quot;)</code>ï¼šè·å–å…·æœ‰ç›¸åŒåç§°çš„å¤šä¸ªå‚æ•°å€¼ï¼ˆå¦‚å¤é€‰æ¡†ï¼‰ã€‚</li></ul></li><li><strong>è®¾ç½®å“åº”å¤´</strong><ul><li><code>res.setContentType(&quot;text/html;charset=UTF-8&quot;)</code>ï¼šè®¾ç½®å“åº”çš„å†…å®¹ç±»å‹å’Œå­—ç¬¦ç¼–ç ã€‚</li><li><code>res.setHeader(&quot;HeaderName&quot;, &quot;HeaderValue&quot;)</code>ï¼šè®¾ç½®è‡ªå®šä¹‰å“åº”å¤´ã€‚</li></ul></li><li><strong>å†™å…¥å“åº”å†…å®¹</strong><ul><li><code>res.getWriter()</code>ï¼šè·å–ä¸€ä¸ª <code>PrintWriter</code>ï¼Œç”¨äºå‘å®¢æˆ·ç«¯å‘é€æ–‡æœ¬å“åº”ã€‚</li><li><code>res.getOutputStream()</code>ï¼šè·å–ä¸€ä¸ª <code>ServletOutputStream</code>ï¼Œç”¨äºå‘å®¢æˆ·ç«¯å‘é€äºŒè¿›åˆ¶å“åº”ï¼ˆå¦‚å›¾ç‰‡ã€æ–‡ä»¶ï¼‰ã€‚</li></ul></li></ul><h3 id="Servlet-çš„æ ¸å¿ƒç»„ä»¶ä¸ä½œç”¨åŸŸ"><a href="#Servlet-çš„æ ¸å¿ƒç»„ä»¶ä¸ä½œç”¨åŸŸ" class="headerlink" title="Servlet çš„æ ¸å¿ƒç»„ä»¶ä¸ä½œç”¨åŸŸ"></a>Servlet çš„æ ¸å¿ƒç»„ä»¶ä¸ä½œç”¨åŸŸ</h3><p>ç†è§£ Servlet è§„èŒƒä¸­çš„è¿™äº›ç»„ä»¶ï¼Œèƒ½å¸®åŠ©ä½ æ›´åˆç†åœ°ç®¡ç†æ•°æ®å’Œèµ„æºã€‚</p><ol><li><strong>ServletContext (åº”ç”¨ä¸Šä¸‹æ–‡)</strong><ul><li><strong>ä½œç”¨</strong>ï¼šä»£è¡¨æ•´ä¸ª Web åº”ç”¨ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸä¸åº”ç”¨ç›¸åŒã€‚</li><li><strong>ä½œç”¨åŸŸ</strong>ï¼šæ•°æ®åœ¨æ‰€æœ‰ Servletã€JSP å’Œ Filter ä¹‹é—´<strong>å…±äº«</strong>ã€‚</li><li><strong>ç”¨é€”</strong>ï¼šå­˜å‚¨å…¨å±€é…ç½®å’Œå…±äº«æ•°æ®ã€‚</li></ul></li><li><strong>ServletConfig (é…ç½®å¯¹è±¡)</strong><ul><li><strong>ä½œç”¨</strong>ï¼šä»£è¡¨ä¸€ä¸ª Servlet ç‹¬æœ‰çš„é…ç½®ã€‚</li><li><strong>ä½œç”¨åŸŸ</strong>ï¼šä»…åœ¨å®ƒæ‰€å…³è”çš„ Servlet å†…éƒ¨æœ‰æ•ˆã€‚</li><li><strong>ç”¨é€”</strong>ï¼šè·å–ç‰¹å®š Servlet çš„åˆå§‹åŒ–å‚æ•°ã€‚</li></ul></li><li><strong>å››å¤§ä½œç”¨åŸŸ</strong><ul><li><strong>PageContext (é¡µé¢ä½œç”¨åŸŸ)</strong>ï¼šä»…åœ¨ JSP é¡µé¢å†…æœ‰æ•ˆã€‚</li><li><strong>HttpServletRequest (è¯·æ±‚ä½œç”¨åŸŸ)</strong>ï¼šåœ¨ä¸€æ¬¡å®Œæ•´çš„è¯·æ±‚-å“åº”å‘¨æœŸå†…æœ‰æ•ˆï¼Œå³ä½¿è¯·æ±‚è¢«è½¬å‘ï¼Œæ•°æ®ä¾ç„¶å¯è§ã€‚</li><li><strong>HttpSession (ä¼šè¯ä½œç”¨åŸŸ)</strong>ï¼šåœ¨åŒä¸€ä¸ªæµè§ˆå™¨ä¼šè¯ä¸­æœ‰æ•ˆï¼Œç”¨äºå­˜å‚¨ç”¨æˆ·ç‰¹å®šæ•°æ®ã€‚</li><li><strong>ServletContext (åº”ç”¨ä½œç”¨åŸŸ)</strong>ï¼šåœ¨æ•´ä¸ª Web åº”ç”¨ä¸­éƒ½æœ‰æ•ˆï¼Œç”¨äºå­˜å‚¨å…¨å±€æ•°æ®ã€‚</li></ul></li></ol><p>å¥½çš„ï¼Œæˆ‘ä»¬æ¥è¯¦ç»†ã€æ·±å…¥åœ°èŠèŠ Web å¼€å‘ä¸­è‡³å…³é‡è¦çš„ä¸¤ä¸ªæ¦‚å¿µï¼šCookie å’Œ Sessionã€‚å®ƒä»¬æ˜¯è§£å†³ HTTP æ— çŠ¶æ€é—®é¢˜çš„æ ¸å¿ƒæ–¹æ¡ˆï¼Œä½†å·¥ä½œæœºåˆ¶å’Œåº”ç”¨åœºæ™¯å´å¤§ä¸ç›¸åŒã€‚</p><hr><h3 id="Cookieï¼šå®¢æˆ·ç«¯çš„â€œå°çº¸æ¡â€"><a href="#Cookieï¼šå®¢æˆ·ç«¯çš„â€œå°çº¸æ¡â€" class="headerlink" title="Cookieï¼šå®¢æˆ·ç«¯çš„â€œå°çº¸æ¡â€"></a>Cookieï¼šå®¢æˆ·ç«¯çš„â€œå°çº¸æ¡â€</h3><p><strong>Cookie</strong> æ˜¯æœåŠ¡å™¨å‘é€ç»™æµè§ˆå™¨å¹¶å­˜å‚¨åœ¨å®¢æˆ·ç«¯çš„ä¸€å°æ®µæ–‡æœ¬ä¿¡æ¯ã€‚æµè§ˆå™¨åœ¨ä¸‹æ¬¡è®¿é—®åŒä¸€æœåŠ¡å™¨æ—¶ï¼Œä¼šè‡ªåŠ¨å°†è¯¥ Cookie åŒ…å«åœ¨è¯·æ±‚ä¸­å‘é€å›å»ã€‚</p><h4 id="æ ¸å¿ƒå·¥ä½œæœºåˆ¶"><a href="#æ ¸å¿ƒå·¥ä½œæœºåˆ¶" class="headerlink" title="æ ¸å¿ƒå·¥ä½œæœºåˆ¶"></a>æ ¸å¿ƒå·¥ä½œæœºåˆ¶</h4><ol><li><p>æœåŠ¡å™¨åˆ›å»º Cookieï¼š</p><p>å½“ç”¨æˆ·é¦–æ¬¡è®¿é—®ç½‘ç«™æ—¶ï¼ŒæœåŠ¡å™¨åœ¨å“åº”å¤´ï¼ˆResponse Headerï¼‰ä¸­æ·»åŠ ä¸€ä¸ª Set-Cookie å­—æ®µã€‚</p><p>æ¯”å¦‚ï¼šSet-Cookie: JSESSIONID&#x3D;abcde12345; Path&#x3D;&#x2F;; HttpOnly</p></li><li><p>æµè§ˆå™¨ä¿å­˜ Cookieï¼š</p><p>æµè§ˆå™¨æ¥æ”¶åˆ°å“åº”åï¼Œä¼šè§£æ Set-Cookie å¤´ï¼Œå¹¶å°†è¯¥ä¿¡æ¯ä»¥é”®å€¼å¯¹çš„å½¢å¼å­˜å‚¨åœ¨æœ¬åœ°ã€‚</p></li><li><p>æµè§ˆå™¨å‘é€ Cookieï¼š</p><p>åœ¨åç»­çš„è¯·æ±‚ä¸­ï¼Œåªè¦è¯·æ±‚çš„åŸŸåå’Œè·¯å¾„ä¸ Cookie çš„è®¾ç½®ç›¸ç¬¦ï¼Œæµè§ˆå™¨å°±ä¼šè‡ªåŠ¨åœ¨è¯·æ±‚å¤´ï¼ˆRequest Headerï¼‰ä¸­æ·»åŠ  Cookie å­—æ®µï¼Œå°†å­˜å‚¨çš„ Cookie ä¿¡æ¯å‘é€ç»™æœåŠ¡å™¨ã€‚</p><p>æ¯”å¦‚ï¼šCookie: JSESSIONID&#x3D;abcde12345</p></li></ol><h4 id="Cookie-çš„ä¼˜ç¼ºç‚¹"><a href="#Cookie-çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="Cookie çš„ä¼˜ç¼ºç‚¹"></a>Cookie çš„ä¼˜ç¼ºç‚¹</h4><ul><li><strong>ä¼˜ç‚¹</strong>ï¼š<ul><li><strong>å‡è½»æœåŠ¡å™¨å‹åŠ›</strong>ï¼šæ•°æ®å­˜å‚¨åœ¨å®¢æˆ·ç«¯ï¼ŒæœåŠ¡å™¨ä¸éœ€è¦ä¸ºæ¯ä¸ªç”¨æˆ·ç»´æŠ¤çŠ¶æ€ï¼Œé€‚ç”¨äºå¤§è§„æ¨¡è®¿é—®ã€‚</li><li><strong>å¯æ‰©å±•æ€§å¼º</strong>ï¼šæ— çŠ¶æ€ï¼Œå¤©ç„¶é€‚åˆåˆ†å¸ƒå¼æ¶æ„ã€‚</li></ul></li><li><strong>ç¼ºç‚¹</strong>ï¼š<ul><li><strong>å®‰å…¨æ€§å·®</strong>ï¼šæ•°æ®ä»¥æ˜æ–‡å½¢å¼å­˜å‚¨ï¼Œå®¹æ˜“è¢«çªƒå–å’Œç¯¡æ”¹ã€‚</li><li><strong>å®¹é‡é™åˆ¶</strong>ï¼šå•ä¸ª Cookie çš„å¤§å°é€šå¸¸ä¸è¶…è¿‡ 4KBï¼Œä¸”ä¸€ä¸ªåŸŸåä¸‹çš„ Cookie æ€»æ•°ä¹Ÿæœ‰é™åˆ¶ã€‚</li><li><strong>ç”¨æˆ·å¯ç¦ç”¨</strong>ï¼šå¦‚æœç”¨æˆ·ç¦ç”¨äº†æµè§ˆå™¨ Cookie åŠŸèƒ½ï¼Œç›¸å…³åŠŸèƒ½å°†æ— æ³•ä½¿ç”¨ã€‚</li></ul></li></ul><hr><h3 id="Sessionï¼šæœåŠ¡å™¨çš„â€œä¸ªäººæ¡£æ¡ˆâ€"><a href="#Sessionï¼šæœåŠ¡å™¨çš„â€œä¸ªäººæ¡£æ¡ˆâ€" class="headerlink" title="Sessionï¼šæœåŠ¡å™¨çš„â€œä¸ªäººæ¡£æ¡ˆâ€"></a>Sessionï¼šæœåŠ¡å™¨çš„â€œä¸ªäººæ¡£æ¡ˆâ€</h3><p><strong>Session</strong> æ˜¯æœåŠ¡å™¨ä¸ºæ¯ä¸ªç”¨æˆ·åˆ›å»ºçš„ä¸€ä¸ªå¯¹è±¡ï¼Œç”¨äºå­˜å‚¨ç‰¹å®šç”¨æˆ·çš„ä¼šè¯æ•°æ®ã€‚å®ƒå°†ç”¨æˆ·çš„çŠ¶æ€ä¿¡æ¯ä¿å­˜åœ¨æœåŠ¡å™¨ç«¯ï¼Œå¹¶é€šè¿‡ä¸€ä¸ªå”¯ä¸€çš„ <strong>Session ID</strong> æ¥è¯†åˆ«ä¸åŒçš„ç”¨æˆ·ã€‚</p><h4 id="æ ¸å¿ƒå·¥ä½œæœºåˆ¶-1"><a href="#æ ¸å¿ƒå·¥ä½œæœºåˆ¶-1" class="headerlink" title="æ ¸å¿ƒå·¥ä½œæœºåˆ¶"></a>æ ¸å¿ƒå·¥ä½œæœºåˆ¶</h4><ol><li><p>æœåŠ¡å™¨åˆ›å»º Sessionï¼š</p><p>å½“ç”¨æˆ·é¦–æ¬¡è®¿é—® Web åº”ç”¨æ—¶ï¼ŒæœåŠ¡å™¨ä¼šåˆ›å»ºä¸€ä¸ª HttpSession å¯¹è±¡ï¼Œå¹¶ä¸ºå…¶åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„ Session IDã€‚</p></li><li><p>ä¼ é€’ Session IDï¼š</p><p>æœåŠ¡å™¨å°†è¿™ä¸ª Session ID ä»¥ Cookie çš„å½¢å¼å‘é€ç»™æµè§ˆå™¨ï¼ˆè¿™ä¸ª Cookie é€šå¸¸å« JSESSIONIDï¼‰ã€‚</p><ul><li>å¦‚æœæµè§ˆå™¨ç¦ç”¨äº† Cookieï¼ŒæœåŠ¡å™¨å¯ä»¥é€šè¿‡ <strong>URL é‡å†™</strong>çš„æ–¹å¼ï¼Œå°† Session ID é™„åŠ åˆ°æ¯ä¸ª URL çš„æœ«å°¾ï¼Œä¾‹å¦‚ï¼š<code>.../index.jsp;jsessionid=abcde12345</code>ã€‚</li></ul></li><li><p>æœåŠ¡å™¨ç»´æŠ¤ Sessionï¼š</p><p>Session ID ä¼ é€’åˆ°å®¢æˆ·ç«¯åï¼ŒæœåŠ¡å™¨ä¼šåœ¨å†…å­˜ä¸­æˆ–æŒä¹…åŒ–å­˜å‚¨ä¸­ä¿å­˜è¿™ä¸ª HttpSession å¯¹è±¡åŠå…¶æ•°æ®ã€‚</p></li><li><p>è¯†åˆ«ç”¨æˆ·ï¼š</p><p>åç»­çš„è¯·æ±‚ä¸­ï¼Œæµè§ˆå™¨éƒ½ä¼šå¸¦ç€åŒ…å« Session ID çš„ Cookieã€‚æœåŠ¡å™¨é€šè¿‡è¿™ä¸ª ID å°±èƒ½ä»å†…å­˜ä¸­æ‰¾åˆ°å¯¹åº”çš„ HttpSession å¯¹è±¡ï¼Œä»è€Œè·å–è¯¥ç”¨æˆ·çš„çŠ¶æ€ä¿¡æ¯ã€‚</p></li></ol><h4 id="Session-çš„ä¼˜ç¼ºç‚¹"><a href="#Session-çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="Session çš„ä¼˜ç¼ºç‚¹"></a>Session çš„ä¼˜ç¼ºç‚¹</h4><ul><li><strong>ä¼˜ç‚¹</strong>ï¼š<ul><li><strong>å®‰å…¨æ€§é«˜</strong>ï¼šæ ¸å¿ƒæ•°æ®å­˜å‚¨åœ¨æœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯åªä¼ é€’ä¸€ä¸ªæ— æ³•çŒœè§£çš„ IDã€‚</li><li><strong>å®¹é‡å¤§</strong>ï¼šå­˜å‚¨åœ¨æœåŠ¡å™¨ï¼Œç†è®ºä¸Šæ²¡æœ‰å¤§å°é™åˆ¶ã€‚</li></ul></li><li><strong>ç¼ºç‚¹</strong>ï¼š<ul><li><strong>å ç”¨æœåŠ¡å™¨èµ„æº</strong>ï¼šæ¯ä¸ªæ´»è·ƒçš„ Session éƒ½ä¼šå ç”¨æœåŠ¡å™¨å†…å­˜ï¼Œåœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹å¯èƒ½æˆä¸ºç“¶é¢ˆã€‚</li><li><strong>åˆ†å¸ƒå¼æŒ‘æˆ˜</strong>ï¼šåœ¨å¤šå°æœåŠ¡å™¨ç»„æˆçš„é›†ç¾¤ç¯å¢ƒä¸­ï¼Œéœ€è¦é¢å¤–çš„æœºåˆ¶ï¼ˆå¦‚ Session å…±äº«æˆ–ç²˜æ€§ä¼šè¯ï¼‰æ¥ç¡®ä¿ç”¨æˆ·çš„è¯·æ±‚æ€»æ˜¯è¢«è½¬å‘åˆ°åŒä¸€ä¸ª Session æ‰€åœ¨çš„æœåŠ¡å™¨ï¼Œæˆ–è€…æ‰€æœ‰æœåŠ¡å™¨éƒ½èƒ½è®¿é—®åˆ° Session æ•°æ®ã€‚</li></ul></li></ul><hr><h3 id="Cookie-ä¸-Session-çš„å¯¹æ¯”æ€»ç»“"><a href="#Cookie-ä¸-Session-çš„å¯¹æ¯”æ€»ç»“" class="headerlink" title="Cookie ä¸ Session çš„å¯¹æ¯”æ€»ç»“"></a>Cookie ä¸ Session çš„å¯¹æ¯”æ€»ç»“</h3><table><thead><tr><th>ç‰¹æ€§</th><th>Cookie</th><th>Session</th></tr></thead><tbody><tr><td><strong>æ•°æ®å­˜å‚¨ä½ç½®</strong></td><td>å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰</td><td>æœåŠ¡å™¨ç«¯</td></tr><tr><td><strong>å®‰å…¨æ€§</strong></td><td>è¾ƒä½ï¼Œæ˜“è¢«ç¯¡æ”¹</td><td>è¾ƒé«˜ï¼Œæ•°æ®å®‰å…¨</td></tr><tr><td><strong>æ•°æ®å®¹é‡</strong></td><td>è¾ƒå°ï¼ˆ~4KBï¼‰</td><td>è¾ƒå¤§ï¼Œæ— æ˜æ˜¾é™åˆ¶</td></tr><tr><td><strong>æ€§èƒ½</strong></td><td>è½»é‡ï¼Œä¸å ç”¨æœåŠ¡å™¨èµ„æº</td><td>å ç”¨æœåŠ¡å™¨å†…å­˜ï¼Œå¯èƒ½å½±å“æ€§èƒ½</td></tr><tr><td><strong>å¯æ‰©å±•æ€§</strong></td><td>å¤©ç„¶æ— çŠ¶æ€ï¼Œæ˜“äºæ‰©å±•</td><td>åˆ†å¸ƒå¼ç¯å¢ƒä¸‹éœ€è¦é¢å¤–é…ç½®</td></tr><tr><td><strong>ä¸»è¦ç”¨é€”</strong></td><td>è´­ç‰©è½¦ã€ç”¨æˆ·åå¥½ã€è½»é‡çº§çŠ¶æ€</td><td>ç™»å½•çŠ¶æ€ã€æƒé™éªŒè¯ã€æ•æ„Ÿæ•°æ®</td></tr></tbody></table><p>å¥½çš„ï¼Œæˆ‘å·²å°† GET å’Œ POST è¯·æ±‚çš„æ‰€æœ‰æ ¸å¿ƒåŒºåˆ«æ•´ç†æˆä¸€ä¸ªç®€æ´æ˜äº†çš„è¡¨æ ¼ï¼Œå¹¶è¡¥å……äº†æ›´å¤šç»†èŠ‚ï¼Œä½¿å…¶æ›´å…¨é¢ã€‚</p><h3 id="GET-å’Œ-POST-è¯·æ±‚çš„å…¨é¢å¯¹æ¯”"><a href="#GET-å’Œ-POST-è¯·æ±‚çš„å…¨é¢å¯¹æ¯”" class="headerlink" title="GET å’Œ POST è¯·æ±‚çš„å…¨é¢å¯¹æ¯”"></a>GET å’Œ POST è¯·æ±‚çš„å…¨é¢å¯¹æ¯”</h3><table><thead><tr><th>ç‰¹æ€§</th><th>GET è¯·æ±‚</th><th>POST è¯·æ±‚</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td><strong>åŸºæœ¬ä½œç”¨</strong></td><td>ä»æœåŠ¡å™¨<strong>è·å–</strong>èµ„æº</td><td>å‘æœåŠ¡å™¨<strong>æäº¤</strong>æ•°æ®ï¼Œé€šå¸¸ç”¨äº<strong>åˆ›å»º</strong>èµ„æºã€‚</td><td>è¯­ä¹‰ä¸åŒæ˜¯æ‰€æœ‰åŒºåˆ«çš„æ ¹æœ¬ã€‚</td></tr><tr><td><strong>ä¼ å‚æ–¹å¼</strong></td><td>å‚æ•°é™„åŠ åœ¨ URL ä¸­</td><td>å‚æ•°æ”¾åœ¨è¯·æ±‚ä½“ï¼ˆRequest Bodyï¼‰ä¸­</td><td>GET å‚æ•°å¯è§ï¼ŒPOST å‚æ•°éšè—ã€‚</td></tr><tr><td><strong>å®‰å…¨æ€§</strong></td><td><strong>ä¸å®‰å…¨</strong>ï¼ŒURL æš´éœ²</td><td><strong>ç›¸å¯¹å®‰å…¨</strong>ï¼Œå‚æ•°éšè—åœ¨è¯·æ±‚ä½“ä¸­</td><td>è¿™é‡Œçš„â€œå®‰å…¨â€æŒ‡æ•°æ®ä¸è¢«æš´éœ²ã€‚</td></tr><tr><td><strong>å¹‚ç­‰æ€§</strong></td><td><strong>æ˜¯</strong>ï¼ˆå¤šæ¬¡æ‰§è¡Œç»“æœç›¸åŒï¼‰</td><td><strong>å¦</strong>ï¼ˆå¤šæ¬¡æ‰§è¡Œå¯èƒ½äº§ç”Ÿæ–°èµ„æºï¼‰</td><td>å¹‚ç­‰æ€§æ˜¯ RESTful è®¾è®¡çš„å…³é”®åŸåˆ™ã€‚</td></tr><tr><td><strong>æµè§ˆå™¨è¡Œä¸º</strong></td><td>å›é€€æ— å®³ï¼Œå¯è¢«è®°å½•åœ¨å†å²ã€æ”¶è—ä¸ºä¹¦ç­¾ã€‚</td><td>å›é€€æ—¶é€šå¸¸ä¼šæç¤ºé‡æ–°æäº¤ï¼Œä¸è®°å½•åœ¨å†å²ã€ä¸å¯æ”¶è—ã€‚</td><td>é˜²æ­¢æ„å¤–æäº¤å¯¼è‡´æ•°æ®é‡å¤ã€‚</td></tr><tr><td><strong>ç¼“å­˜</strong></td><td><strong>å¯ä»¥è¢«ç¼“å­˜</strong></td><td><strong>ä¸ä¼šè¢«ç¼“å­˜</strong></td><td>ç¼“å­˜èƒ½æé«˜æ€§èƒ½ï¼Œä½†ä»…é™äºåªè¯»æ“ä½œã€‚</td></tr><tr><td><strong>ä¼ è¾“æ•°æ®é‡</strong></td><td>æœ‰é•¿åº¦é™åˆ¶ï¼ˆURLé•¿åº¦é™åˆ¶ï¼‰</td><td>æ— é•¿åº¦é™åˆ¶ï¼ˆå–å†³äºæœåŠ¡å™¨é…ç½®ï¼‰</td><td>GET ä¸é€‚åˆä¼ è¾“å¤§é‡æ•°æ®ã€‚</td></tr><tr><td><strong>æ•°æ®ç¼–ç </strong></td><td>åªæ”¯æŒ URL ç¼–ç </td><td>æ”¯æŒå¤šç§ç¼–ç ï¼ˆå¦‚<code>application/json</code>ï¼‰</td><td>POST çµæ´»æ€§é«˜ï¼Œé€‚åˆå„ç§æ•°æ®ç±»å‹ã€‚</td></tr><tr><td><strong>å‘é€æ–‡ä»¶</strong></td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ (<code>multipart/form-data</code>)</td><td>æ–‡ä»¶å¿…é¡»é€šè¿‡è¯·æ±‚ä½“ä¼ è¾“ã€‚</td></tr><tr><td><strong>HTTP æŠ¥æ–‡</strong></td><td>æ— è¯·æ±‚ä½“</td><td>æœ‰è¯·æ±‚ä½“</td><td>GET è¯·æ±‚æŠ¥æ–‡æ›´å°ï¼Œæ›´è½»é‡ã€‚</td></tr><tr><td><strong>TCP&#x2F;IP åè®®</strong></td><td>ä¸€æ¬¡æ€§å‘é€æ‰€æœ‰æ•°æ®åŒ…</td><td>æµè§ˆå™¨é€šå¸¸ä¼šå…ˆå‘é€è¯·æ±‚å¤´ï¼ŒæœåŠ¡å™¨å“åº” 100-continue åå†å‘é€è¯·æ±‚ä½“</td><td>POST çš„åˆ†æ­¥å‘é€æœºåˆ¶å¯ä»¥é¿å…å‘é€ä¸å¿…è¦çš„æ•°æ®ã€‚</td></tr></tbody></table><p>å¥½çš„ï¼Œæˆ‘ä»¬å°†ä»¥ Servlet çš„è¯¦ç»†å‰–ææ–¹å¼ï¼Œå…¨é¢ã€æ·±å…¥åœ°ä»‹ç» WebSocketã€‚æˆ‘ä»¬å°†ä»å®ƒçš„æ¦‚å¿µã€ç”Ÿå‘½å‘¨æœŸã€æ ¸å¿ƒ APIï¼Œåˆ°å®ƒä¸ HTTP çš„åŒºåˆ«ä»¥åŠåœ¨ç°ä»£ Web ä¸­çš„åº”ç”¨ï¼Œè¿›è¡Œç³»ç»Ÿæ€§çš„æ¢³ç†ã€‚</p><hr><h3 id="WebSocket-æ¦‚è¿°ï¼šWeb-é€šä¿¡çš„é©å‘½"><a href="#WebSocket-æ¦‚è¿°ï¼šWeb-é€šä¿¡çš„é©å‘½" class="headerlink" title="WebSocket æ¦‚è¿°ï¼šWeb é€šä¿¡çš„é©å‘½"></a>WebSocket æ¦‚è¿°ï¼šWeb é€šä¿¡çš„é©å‘½</h3><p><strong>WebSocket</strong> åè®®æ˜¯ HTML5 å¼€å§‹æä¾›çš„ä¸€ç§åœ¨å•ä¸ª TCP è¿æ¥ä¸Šè¿›è¡Œ<strong>å…¨åŒå·¥é€šä¿¡</strong>çš„åè®®ã€‚ä¸ä¼ ç»Ÿçš„ HTTP åè®®ä¸åŒï¼Œå®ƒæ‰“ç ´äº†è¯·æ±‚-å“åº”çš„å•å‘æ¨¡å¼ï¼Œä½¿å¾—å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯ä»¥<strong>å®æ—¶åœ°åŒå‘è‡ªç”±ä¼ è¾“æ•°æ®</strong>ã€‚</p><p><strong>å®ƒçš„æ ¸å¿ƒä½œç”¨</strong>æ˜¯è§£å†³ Web åº”ç”¨ä¸­<strong>å®æ—¶é€šä¿¡</strong>çš„éœ€æ±‚ï¼Œä¾‹å¦‚ï¼šèŠå¤©åº”ç”¨ã€åœ¨çº¿æ¸¸æˆã€è‚¡ç¥¨è¡Œæƒ…ã€å®æ—¶åä½œå·¥å…·ç­‰ã€‚å®ƒæå¤§åœ°å‡å°‘äº†ç½‘ç»œå¼€é”€ï¼Œæé«˜äº†é€šä¿¡æ•ˆç‡ã€‚</p><h3 id="WebSocket-çš„æ ¸å¿ƒå·¥ä½œåŸç†"><a href="#WebSocket-çš„æ ¸å¿ƒå·¥ä½œåŸç†" class="headerlink" title="WebSocket çš„æ ¸å¿ƒå·¥ä½œåŸç†"></a>WebSocket çš„æ ¸å¿ƒå·¥ä½œåŸç†</h3><p>è¦ç†è§£ WebSocketï¼Œå¿…é¡»é¦–å…ˆç†è§£å®ƒä¸ HTTP çš„å…³ç³»ã€‚</p><ol><li><strong>åŸºäº HTTP çš„æ¡æ‰‹ï¼ˆHandshakeï¼‰</strong>ï¼š<ul><li>WebSocket çš„è¿æ¥å»ºç«‹è¿‡ç¨‹æ˜¯åŸºäº HTTP åè®®çš„ã€‚</li><li>å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªç‰¹æ®Šçš„ HTTP è¯·æ±‚ï¼Œå…¶ä¸­åŒ…å« <code>Upgrade: websocket</code> å’Œ <code>Connection: Upgrade</code> è¯·æ±‚å¤´ï¼Œå‘æœåŠ¡å™¨è¯·æ±‚å°† HTTP åè®®å‡çº§åˆ° WebSocket åè®®ã€‚</li><li>è¿™æ˜¯ä¸€ä¸ª**â€œæ¡æ‰‹â€**è¿‡ç¨‹ã€‚</li></ul></li><li><strong>åè®®å‡çº§ä¸æŒä¹…è¿æ¥</strong>ï¼š<ul><li>å¦‚æœæœåŠ¡å™¨æ”¯æŒ WebSocketï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªç‰¹æ®Šçš„ HTTP å“åº”ï¼ˆçŠ¶æ€ç  <code>101 Switching Protocols</code>ï¼‰ã€‚</li><li>æ¡æ‰‹æˆåŠŸåï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„ TCP è¿æ¥å°†<strong>ä¿æŒæ‰“å¼€çŠ¶æ€</strong>ã€‚</li><li>è¿™æ—¶ï¼Œåè®®å°±ä» HTTP å‡çº§åˆ°äº† WebSocketï¼ŒåŒæ–¹å¯ä»¥åœ¨è¿™ä¸ª<strong>æŒä¹…çš„ TCP è¿æ¥</strong>ä¸Šè‡ªç”±åœ°åŒå‘å‘é€æ•°æ®ï¼Œè€Œæ— éœ€å†è¿›è¡Œ HTTP å¤´éƒ¨å¼€é”€ã€‚</li></ul></li><li><strong>æ•°æ®å¸§ä¼ è¾“</strong>ï¼š<ul><li>WebSocket åè®®å®šä¹‰äº†**æ•°æ®å¸§ï¼ˆData Framesï¼‰**çš„æ¦‚å¿µã€‚å®ƒå°†æ•°æ®åˆ†å‰²æˆæ›´å°ã€æ›´è½»é‡çº§çš„å¸§ï¼Œè€Œä¸æ˜¯åƒ HTTP é‚£æ ·å‘é€æ•´ä¸ªæŠ¥æ–‡ã€‚</li><li>è¿™æ ·ï¼Œå³ä½¿ä¼ è¾“å°‘é‡æ•°æ®ï¼Œä¹Ÿä¸ä¼šæœ‰å¾ˆå¤§çš„åè®®å¼€é”€ï¼Œéå¸¸é€‚åˆå®æ—¶é€šä¿¡ã€‚</li></ul></li></ol><h3 id="WebSocket-çš„ç”Ÿå‘½å‘¨æœŸï¼šäº‹ä»¶é©±åŠ¨æ¨¡å‹"><a href="#WebSocket-çš„ç”Ÿå‘½å‘¨æœŸï¼šäº‹ä»¶é©±åŠ¨æ¨¡å‹" class="headerlink" title="WebSocket çš„ç”Ÿå‘½å‘¨æœŸï¼šäº‹ä»¶é©±åŠ¨æ¨¡å‹"></a>WebSocket çš„ç”Ÿå‘½å‘¨æœŸï¼šäº‹ä»¶é©±åŠ¨æ¨¡å‹</h3><p>WebSocket çš„ç”Ÿå‘½å‘¨æœŸç”±å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å…±åŒç»´æŠ¤ï¼Œç”±ä¸€ç³»åˆ—äº‹ä»¶é©±åŠ¨ï¼š</p><h4 id="1-è¿æ¥å»ºç«‹ï¼ˆConnection-Establishmentï¼‰"><a href="#1-è¿æ¥å»ºç«‹ï¼ˆConnection-Establishmentï¼‰" class="headerlink" title="1. è¿æ¥å»ºç«‹ï¼ˆConnection Establishmentï¼‰"></a>1. è¿æ¥å»ºç«‹ï¼ˆConnection Establishmentï¼‰</h4><ul><li><strong>å®¢æˆ·ç«¯</strong>ï¼šé€šè¿‡ <code>new WebSocket(url)</code> å»ºç«‹è¿æ¥ã€‚</li><li><strong>æœåŠ¡å™¨</strong>ï¼šå½“å®¢æˆ·ç«¯å‘é€æ¡æ‰‹è¯·æ±‚åï¼ŒæœåŠ¡å™¨å¤„ç†å¹¶æ¥å—è¿æ¥ï¼Œæ­¤æ—¶è§¦å‘ <code>onopen</code> äº‹ä»¶ã€‚</li></ul><h4 id="2-æ•°æ®ä¼ è¾“ï¼ˆData-Transmissionï¼‰"><a href="#2-æ•°æ®ä¼ è¾“ï¼ˆData-Transmissionï¼‰" class="headerlink" title="2. æ•°æ®ä¼ è¾“ï¼ˆData Transmissionï¼‰"></a>2. æ•°æ®ä¼ è¾“ï¼ˆData Transmissionï¼‰</h4><ul><li><strong>å‘é€</strong>ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½å¯ä»¥é€šè¿‡å„è‡ªçš„ <code>send()</code> æ–¹æ³•å‘å¯¹æ–¹å‘é€æ•°æ®ã€‚</li><li><strong>æ¥æ”¶</strong>ï¼šå½“ä¸€æ–¹æ¥æ”¶åˆ°æ•°æ®æ—¶ï¼Œä¼šè§¦å‘ <code>onmessage</code> äº‹ä»¶ã€‚</li></ul><h4 id="3-è¿æ¥å…³é—­ï¼ˆConnection-Closeï¼‰"><a href="#3-è¿æ¥å…³é—­ï¼ˆConnection-Closeï¼‰" class="headerlink" title="3. è¿æ¥å…³é—­ï¼ˆConnection Closeï¼‰"></a>3. è¿æ¥å…³é—­ï¼ˆConnection Closeï¼‰</h4><ul><li><strong>ä¸»åŠ¨å…³é—­</strong>ï¼šå®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨å¯ä»¥è°ƒç”¨ <code>close()</code> æ–¹æ³•ä¸»åŠ¨å…³é—­è¿æ¥ã€‚</li><li><strong>å¼‚å¸¸å…³é—­</strong>ï¼šè¿æ¥å¯èƒ½å› ç½‘ç»œæ•…éšœã€å¿ƒè·³è¶…æ—¶ç­‰åŸå› æ„å¤–å…³é—­ã€‚</li><li><strong>äº‹ä»¶</strong>ï¼šæ— è®ºæ˜¯ä¸»åŠ¨è¿˜æ˜¯è¢«åŠ¨ï¼Œè¿æ¥å…³é—­æ—¶éƒ½ä¼šè§¦å‘ <code>onclose</code> äº‹ä»¶ã€‚</li></ul><h3 id="WebSocket-çš„æ ¸å¿ƒ-APIï¼ˆä»¥-JavaScript-ä¸ºä¾‹ï¼‰"><a href="#WebSocket-çš„æ ¸å¿ƒ-APIï¼ˆä»¥-JavaScript-ä¸ºä¾‹ï¼‰" class="headerlink" title="WebSocket çš„æ ¸å¿ƒ APIï¼ˆä»¥ JavaScript ä¸ºä¾‹ï¼‰"></a>WebSocket çš„æ ¸å¿ƒ APIï¼ˆä»¥ JavaScript ä¸ºä¾‹ï¼‰</h3><p>WebSocket çš„ API è®¾è®¡éå¸¸ç®€æ´ï¼Œä¸»è¦åŸºäºäº‹ä»¶ç›‘å¬å’Œæ–¹æ³•è°ƒç”¨ã€‚</p><ul><li><strong>new WebSocket(url)</strong>ï¼šåˆ›å»ºä¸€ä¸ª WebSocket å®¢æˆ·ç«¯å®ä¾‹ã€‚</li><li><strong>websocket.onopen</strong>ï¼šè¿æ¥æˆåŠŸå»ºç«‹æ—¶è§¦å‘ã€‚</li><li><strong>websocket.onmessage &#x3D; function(event)</strong>ï¼šæ¥æ”¶åˆ°æœåŠ¡å™¨æ•°æ®æ—¶è§¦å‘ï¼Œæ•°æ®åœ¨ <code>event.data</code> ä¸­ã€‚</li><li><strong>websocket.onerror</strong>ï¼šè¿æ¥å‘ç”Ÿé”™è¯¯æ—¶è§¦å‘ã€‚</li><li><strong>websocket.onclose</strong>ï¼šè¿æ¥å…³é—­æ—¶è§¦å‘ã€‚</li><li><strong>websocket.send(data)</strong>ï¼šå‘æœåŠ¡å™¨å‘é€æ•°æ®ã€‚</li><li><strong>websocket.close()</strong>ï¼šå…³é—­è¿æ¥ã€‚</li></ul><h3 id="WebSocket-ä¸-HTTP-çš„æœ¬è´¨åŒºåˆ«"><a href="#WebSocket-ä¸-HTTP-çš„æœ¬è´¨åŒºåˆ«" class="headerlink" title="WebSocket ä¸ HTTP çš„æœ¬è´¨åŒºåˆ«"></a>WebSocket ä¸ HTTP çš„æœ¬è´¨åŒºåˆ«</h3><table><thead><tr><th>ç‰¹æ€§</th><th>HTTP</th><th>WebSocket</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td><strong>é€šä¿¡æ¨¡å¼</strong></td><td><strong>å•å‘</strong>ï¼ˆè¯·æ±‚-å“åº”ï¼‰</td><td><strong>åŒå‘</strong>ï¼ˆå…¨åŒå·¥ï¼‰</td><td>HTTP å®¢æˆ·ç«¯å¿…é¡»å…ˆå‘è¯·æ±‚ï¼ŒæœåŠ¡å™¨æ‰èƒ½å“åº”ã€‚</td></tr><tr><td><strong>è¿æ¥çŠ¶æ€</strong></td><td><strong>æ— çŠ¶æ€</strong>ï¼ŒçŸ­è¿æ¥</td><td><strong>æœ‰çŠ¶æ€</strong>ï¼Œé•¿è¿æ¥</td><td>HTTP æ¯æ¬¡è¯·æ±‚éƒ½éœ€è¦é‡æ–°å»ºç«‹è¿æ¥ã€‚</td></tr><tr><td><strong>åè®®å¼€é”€</strong></td><td><strong>å¤§</strong>ï¼ˆæ¯æ¬¡è¯·æ±‚éƒ½æºå¸¦å¤´éƒ¨ï¼‰</td><td><strong>å°</strong>ï¼ˆæ¡æ‰‹ååªä¼ è¾“æ•°æ®å¸§ï¼‰</td><td>HTTP é€‚åˆä¼ è¾“å¤§æ–‡ä»¶ï¼ŒWebSocket é€‚åˆå°æ•°æ®é¢‘ç¹ä¼ è¾“ã€‚</td></tr><tr><td><strong>æœåŠ¡å™¨ä¸»åŠ¨æ€§</strong></td><td><strong>è¢«åŠ¨</strong>ï¼ˆæ— æ³•ä¸»åŠ¨æ¨é€ï¼‰</td><td><strong>ä¸»åŠ¨</strong>ï¼ˆå¯éšæ—¶æ¨é€æ•°æ®ï¼‰</td><td>WebSocket è§£å†³äº† HTTP çš„â€œæœåŠ¡å™¨æ¨â€éš¾é¢˜ã€‚</td></tr><tr><td><strong>åº”ç”¨åœºæ™¯</strong></td><td>ç½‘é¡µæµè§ˆã€API è°ƒç”¨ã€æ–‡ä»¶ä¸‹è½½</td><td>èŠå¤©ã€æ¸¸æˆã€å®æ—¶æ•°æ®æ›´æ–°</td><td></td></tr></tbody></table><h3 id="WebSocket-åœ¨ç°ä»£-Java-Web-ä¸­çš„åº”ç”¨"><a href="#WebSocket-åœ¨ç°ä»£-Java-Web-ä¸­çš„åº”ç”¨" class="headerlink" title="WebSocket åœ¨ç°ä»£ Java Web ä¸­çš„åº”ç”¨"></a>WebSocket åœ¨ç°ä»£ Java Web ä¸­çš„åº”ç”¨</h3><p>åœ¨ Java åç«¯ï¼ŒWebSocket é€šå¸¸ç”±ä¸“é—¨çš„æ¡†æ¶æˆ–å®¹å™¨æ¥å®ç°ï¼Œå¦‚ï¼š</p><ul><li><strong>JavaEE 7+ çš„ WebSocket API</strong>ï¼šæä¾›äº† <code>javax.websocket</code> åŒ…ï¼Œå¯ä»¥ç›´æ¥åœ¨ Servlet å®¹å™¨ä¸­å¼€å‘ WebSocket åº”ç”¨ã€‚</li><li><strong>Spring Framework</strong>ï¼šæä¾›äº†å¼ºå¤§çš„ WebSocket æ”¯æŒï¼Œé›†æˆäº† STOMPï¼ˆSimple Text Oriented Messaging Protocolï¼‰åè®®ï¼Œç®€åŒ–äº†æ¶ˆæ¯è·¯ç”±å’Œç®¡ç†ã€‚</li></ul><p>åœ¨è¿™äº›æ¡†æ¶ä¸­ï¼Œä½ é€šå¸¸ä¼šå®šä¹‰ä¸€ä¸ª WebSocket ç«¯ç‚¹ï¼ˆEndpointï¼‰ï¼Œç±»ä¼¼äº Servletï¼Œå®ƒè´Ÿè´£å¤„ç†è¿æ¥çš„å»ºç«‹ã€æ¶ˆæ¯çš„æ¥æ”¶å’Œå‘é€ã€ä»¥åŠè¿æ¥çš„å…³é—­ã€‚</p><p>æ€»è€Œè¨€ä¹‹ï¼ŒWebSocket æ˜¯ HTTP åè®®åœ¨å®æ—¶é€šä¿¡é¢†åŸŸçš„æœ‰åŠ›è¡¥å……ã€‚å®ƒé€šè¿‡ä¸€æ¬¡æ€§çš„æ¡æ‰‹å»ºç«‹ä¸€ä¸ªæŒä¹…çš„åŒå‘é€šé“ï¼Œæå¤§åœ°æé«˜äº† Web åº”ç”¨çš„äº¤äº’æ€§å’Œæ•ˆç‡ï¼Œæ˜¯ç°ä»£ Web æ¶æ„ä¸­ä¸å¯æˆ–ç¼ºçš„ä¸€éƒ¨åˆ†ã€‚</p><p>å¥½çš„ï¼Œä¸ºäº†æ›´å¥½åœ°ç†è§£ WebSocket çš„å·¥ä½œåŸç†ï¼Œæˆ‘å°†æä¾›å‡ ä¸ªå…·ä½“çš„åº”ç”¨åœºæ™¯å’Œç›¸åº”çš„ä»£ç ç¤ºä¾‹ã€‚è¿™äº›ç¤ºä¾‹å°†æ¶µç›–å®¢æˆ·ç«¯ï¼ˆJavaScriptï¼‰å’ŒæœåŠ¡å™¨ç«¯ï¼ˆJava&#x2F;Spring Bootï¼‰çš„ä»£ç ï¼Œä»¥ä¾¿ä½ èƒ½å¤Ÿå®Œæ•´åœ°çœ‹åˆ°åŒå‘é€šä¿¡æ˜¯å¦‚ä½•å®ç°çš„ã€‚</p><hr><h3 id="ç¤ºä¾‹ä¸€ï¼šå®æ—¶èŠå¤©åº”ç”¨"><a href="#ç¤ºä¾‹ä¸€ï¼šå®æ—¶èŠå¤©åº”ç”¨" class="headerlink" title="ç¤ºä¾‹ä¸€ï¼šå®æ—¶èŠå¤©åº”ç”¨"></a>ç¤ºä¾‹ä¸€ï¼šå®æ—¶èŠå¤©åº”ç”¨</h3><p>è¿™æ˜¯ WebSocket æœ€ç»å…¸çš„ç”¨ä¾‹ã€‚</p><h4 id="åº”ç”¨åœºæ™¯ï¼š"><a href="#åº”ç”¨åœºæ™¯ï¼š" class="headerlink" title="åº”ç”¨åœºæ™¯ï¼š"></a><strong>åº”ç”¨åœºæ™¯</strong>ï¼š</h4><p>å¤šä¸ªç”¨æˆ·è¿æ¥åˆ°èŠå¤©å®¤ï¼Œå½“ä¸€ä¸ªç”¨æˆ·å‘é€æ¶ˆæ¯æ—¶ï¼ŒæœåŠ¡å™¨å°†è¯¥æ¶ˆæ¯å®æ—¶å¹¿æ’­ç»™æ‰€æœ‰å…¶ä»–åœ¨çº¿ç”¨æˆ·ã€‚</p><h4 id="æ ¸å¿ƒé€»è¾‘ï¼š"><a href="#æ ¸å¿ƒé€»è¾‘ï¼š" class="headerlink" title="æ ¸å¿ƒé€»è¾‘ï¼š"></a><strong>æ ¸å¿ƒé€»è¾‘</strong>ï¼š</h4><ul><li><strong>å®¢æˆ·ç«¯</strong>ï¼šå½“ç”¨æˆ·åœ¨è¾“å…¥æ¡†ä¸­æŒ‰ä¸‹å›è½¦ï¼ŒJavaScript å°†æ¶ˆæ¯é€šè¿‡ WebSocket è¿æ¥å‘é€ç»™æœåŠ¡å™¨ã€‚</li><li><strong>æœåŠ¡å™¨</strong>ï¼šæ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œéå†æ‰€æœ‰å·²è¿æ¥çš„ WebSocket ä¼šè¯ï¼Œå°†æ¶ˆæ¯é€ä¸€å‘é€ç»™æ¯ä¸ªä¼šè¯ã€‚</li></ul><h4 id="ä»£ç ç¤ºä¾‹ï¼š"><a href="#ä»£ç ç¤ºä¾‹ï¼š" class="headerlink" title="ä»£ç ç¤ºä¾‹ï¼š"></a><strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</h4><p><strong>1. å®¢æˆ·ç«¯ (JavaScript)</strong></p><p>JavaScript</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿æ¥ WebSocket æœåŠ¡å™¨</span></span><br><span class="line"><span class="type">const</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WebSocket</span>(<span class="string">&#x27;ws://localhost:8080/chat&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›‘å¬è¿æ¥æˆåŠŸäº‹ä»¶</span></span><br><span class="line">socket.onopen = function(event) &#123;</span><br><span class="line">  console.log(<span class="string">&quot;WebSocketè¿æ¥å·²å»ºç«‹&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›‘å¬æ¥æ”¶æ¶ˆæ¯äº‹ä»¶</span></span><br><span class="line">socket.onmessage = function(event) &#123;</span><br><span class="line">  <span class="type">const</span> <span class="variable">message</span> <span class="operator">=</span> event.data;</span><br><span class="line">  <span class="type">const</span> <span class="variable">chatBox</span> <span class="operator">=</span> document.getElementById(<span class="string">&#x27;chat-box&#x27;</span>);</span><br><span class="line">  chatBox.innerHTML += `&lt;p&gt;$&#123;message&#125;&lt;/p&gt;`; <span class="comment">// å°†æ¶ˆæ¯æ·»åŠ åˆ°èŠå¤©æ¡†</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›‘å¬è¿æ¥å…³é—­äº‹ä»¶</span></span><br><span class="line">socket.onclose = function(event) &#123;</span><br><span class="line">  console.log(<span class="string">&quot;WebSocketè¿æ¥å·²å…³é—­&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›‘å¬é”™è¯¯äº‹ä»¶</span></span><br><span class="line">socket.onerror = function(event) &#123;</span><br><span class="line">  console.log(<span class="string">&quot;WebSocketå‘ç”Ÿé”™è¯¯:&quot;</span>, event);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘é€æ¶ˆæ¯å‡½æ•°</span></span><br><span class="line">function <span class="title function_">sendMessage</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">const</span> <span class="variable">input</span> <span class="operator">=</span> document.getElementById(<span class="string">&#x27;message-input&#x27;</span>);</span><br><span class="line">  <span class="type">const</span> <span class="variable">message</span> <span class="operator">=</span> input.value;</span><br><span class="line">  <span class="keyword">if</span> (message) &#123;</span><br><span class="line">    socket.send(message); <span class="comment">// é€šè¿‡ WebSocket å‘é€æ¶ˆæ¯</span></span><br><span class="line">    input.value = <span class="string">&#x27;&#x27;</span>; <span class="comment">// æ¸…ç©ºè¾“å…¥æ¡†</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»‘å®šå›è½¦äº‹ä»¶</span></span><br><span class="line">document.getElementById(<span class="string">&#x27;message-input&#x27;</span>).addEventListener(<span class="string">&#x27;keypress&#x27;</span>, function(e) &#123;</span><br><span class="line">  <span class="keyword">if</span> (e.key === <span class="string">&#x27;Enter&#x27;</span>) &#123;</span><br><span class="line">    sendMessage();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><strong>2. æœåŠ¡å™¨ç«¯ (Java&#x2F;Spring Boot)</strong></p><p>Java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> javax.websocket.*;</span><br><span class="line"><span class="keyword">import</span> javax.websocket.server.ServerEndpoint;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CopyOnWriteArraySet;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ServerEndpoint(&quot;/chat&quot;)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatWebSocketEndpoint</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å­˜å‚¨æ‰€æœ‰è¿æ¥çš„å®¢æˆ·ç«¯ä¼šè¯</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> CopyOnWriteArraySet&lt;Session&gt; sessions = <span class="keyword">new</span> <span class="title class_">CopyOnWriteArraySet</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å½“å®¢æˆ·ç«¯è¿æ¥æˆåŠŸæ—¶è°ƒç”¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnOpen</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onOpen</span><span class="params">(Session session)</span> &#123;</span><br><span class="line">        sessions.add(session); <span class="comment">// æ·»åŠ æ–°ä¼šè¯</span></span><br><span class="line">        System.out.println(<span class="string">&quot;æ–°è¿æ¥ï¼š&quot;</span> + session.getId());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å½“å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯æ—¶è°ƒç”¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnMessage</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onMessage</span><span class="params">(String message, Session session)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ”¶åˆ°æ¶ˆæ¯ï¼š&quot;</span> + message + <span class="string">&quot; æ¥è‡ªï¼š&quot;</span> + session.getId());</span><br><span class="line">        <span class="comment">// éå†æ‰€æœ‰ä¼šè¯ï¼Œå¹¿æ’­æ¶ˆæ¯</span></span><br><span class="line">        sessions.forEach(s -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                s.getBasicRemote().sendText(message);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å½“è¿æ¥å…³é—­æ—¶è°ƒç”¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnClose</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClose</span><span class="params">(Session session)</span> &#123;</span><br><span class="line">        sessions.remove(session); <span class="comment">// ç§»é™¤ä¼šè¯</span></span><br><span class="line">        System.out.println(<span class="string">&quot;è¿æ¥å…³é—­ï¼š&quot;</span> + session.getId());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å½“å‘ç”Ÿé”™è¯¯æ—¶è°ƒç”¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnError</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onError</span><span class="params">(Session session, Throwable throwable)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;è¿æ¥å‘ç”Ÿé”™è¯¯ï¼š&quot;</span> + session.getId());</span><br><span class="line">        throwable.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="ç¤ºä¾‹äºŒï¼šå®æ—¶è‚¡ç¥¨è¡Œæƒ…æˆ–æ•°æ®çœ‹æ¿"><a href="#ç¤ºä¾‹äºŒï¼šå®æ—¶è‚¡ç¥¨è¡Œæƒ…æˆ–æ•°æ®çœ‹æ¿" class="headerlink" title="ç¤ºä¾‹äºŒï¼šå®æ—¶è‚¡ç¥¨è¡Œæƒ…æˆ–æ•°æ®çœ‹æ¿"></a>ç¤ºä¾‹äºŒï¼šå®æ—¶è‚¡ç¥¨è¡Œæƒ…æˆ–æ•°æ®çœ‹æ¿</h3><h4 id="åº”ç”¨åœºæ™¯ï¼š-1"><a href="#åº”ç”¨åœºæ™¯ï¼š-1" class="headerlink" title="åº”ç”¨åœºæ™¯ï¼š"></a><strong>åº”ç”¨åœºæ™¯</strong>ï¼š</h4><p>å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨å®šæœŸæˆ–åœ¨æ•°æ®æ›´æ–°æ—¶ï¼Œå‘æ‰€æœ‰è¿æ¥çš„å®¢æˆ·ç«¯æ¨é€æœ€æ–°çš„è‚¡ç¥¨ä»·æ ¼æˆ–ç›‘æ§æ•°æ®ã€‚</p><h4 id="æ ¸å¿ƒé€»è¾‘ï¼š-1"><a href="#æ ¸å¿ƒé€»è¾‘ï¼š-1" class="headerlink" title="æ ¸å¿ƒé€»è¾‘ï¼š"></a><strong>æ ¸å¿ƒé€»è¾‘</strong>ï¼š</h4><ul><li><strong>å®¢æˆ·ç«¯</strong>ï¼šåªç›‘å¬ <code>onmessage</code> äº‹ä»¶ï¼Œè¢«åŠ¨æ¥æ”¶æœåŠ¡å™¨æ¨é€çš„æ•°æ®ã€‚</li><li><strong>æœåŠ¡å™¨</strong>ï¼šåœ¨åå°å¯åŠ¨ä¸€ä¸ªå®šæ—¶ä»»åŠ¡æˆ–æ•°æ®ç›‘å¬å™¨ã€‚å½“æ•°æ®å˜åŒ–æ—¶ï¼Œä¸»åŠ¨é€šè¿‡ WebSocket è¿æ¥å°†æ–°æ•°æ®å‘é€ç»™å®¢æˆ·ç«¯ã€‚</li></ul><h4 id="ä»£ç ç¤ºä¾‹ï¼š-1"><a href="#ä»£ç ç¤ºä¾‹ï¼š-1" class="headerlink" title="ä»£ç ç¤ºä¾‹ï¼š"></a><strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</h4><p><strong>1. å®¢æˆ·ç«¯ (JavaScript)</strong></p><p>JavaScript</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WebSocket</span>(<span class="string">&#x27;ws://localhost:8080/stock&#x27;</span>);</span><br><span class="line"></span><br><span class="line">socket.onopen = function(event) &#123;</span><br><span class="line">  console.log(<span class="string">&quot;è‚¡ç¥¨è¡Œæƒ…è¿æ¥å·²å»ºç«‹&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">socket.onmessage = function(event) &#123;</span><br><span class="line">  <span class="comment">// å‡è®¾æœåŠ¡å™¨å‘é€çš„æ˜¯JSONæ ¼å¼çš„è‚¡ç¥¨æ•°æ®</span></span><br><span class="line">  <span class="type">const</span> <span class="variable">stockData</span> <span class="operator">=</span> JSON.parse(event.data);</span><br><span class="line">  <span class="type">const</span> <span class="variable">stockPriceElement</span> <span class="operator">=</span> document.getElementById(<span class="string">&#x27;stock-price&#x27;</span>);</span><br><span class="line">  stockPriceElement.innerText = `å½“å‰ä»·æ ¼: $&#123;stockData.price&#125;`;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ— éœ€ sendMessage å‡½æ•°ï¼Œå› ä¸ºæ˜¯å•å‘è¢«åŠ¨æ¥æ”¶</span></span><br></pre></td></tr></table></figure><p><strong>2. æœåŠ¡å™¨ç«¯ (Java&#x2F;Spring Boot)</strong></p><p>Java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Scheduled;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> javax.websocket.*;</span><br><span class="line"><span class="keyword">import</span> javax.websocket.server.ServerEndpoint;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CopyOnWriteArraySet;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ServerEndpoint(&quot;/stock&quot;)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StockWebSocketEndpoint</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> CopyOnWriteArraySet&lt;Session&gt; sessions = <span class="keyword">new</span> <span class="title class_">CopyOnWriteArraySet</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnOpen</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onOpen</span><span class="params">(Session session)</span> &#123;</span><br><span class="line">        sessions.add(session);</span><br><span class="line">        System.out.println(<span class="string">&quot;æ–°è‚¡ç¥¨è¡Œæƒ…è®¢é˜…è€…ï¼š&quot;</span> + session.getId());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnClose</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClose</span><span class="params">(Session session)</span> &#123;</span><br><span class="line">        sessions.remove(session);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‡è®¾è¿™æ˜¯ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œæ¯éš”5ç§’å‘æ‰€æœ‰å®¢æˆ·ç«¯æ¨é€æ•°æ®</span></span><br><span class="line">    <span class="meta">@Scheduled(fixedRate = 5000)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pushStockData</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿè·å–æœ€æ–°è‚¡ç¥¨ä»·æ ¼</span></span><br><span class="line">        <span class="type">double</span> <span class="variable">price</span> <span class="operator">=</span> Math.random() * <span class="number">100</span> + <span class="number">100</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;price\&quot;: &quot;</span> + String.format(<span class="string">&quot;%.2f&quot;</span>, price) + <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// éå†æ‰€æœ‰ä¼šè¯ï¼Œæ¨é€æ•°æ®</span></span><br><span class="line">        sessions.forEach(session -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (session.isOpen()) &#123;</span><br><span class="line">                    session.getBasicRemote().sendText(json);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸¤ä¸ªä¾‹å­æ¸…æ¥šåœ°å±•ç¤ºäº† WebSocket å¦‚ä½•é€šè¿‡<strong>æŒä¹…è¿æ¥</strong>å’Œ<strong>åŒå‘é€šä¿¡</strong>æ¥è§£å†³å®æ—¶åº”ç”¨ä¸­çš„æ ¸å¿ƒç—›ç‚¹ã€‚</p><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬è¯¦ç»†ã€æ¸…æ™°åœ°è§£é‡Š<strong>é™æ€èµ„æº</strong>å’Œ<strong>åŠ¨æ€èµ„æº</strong>çš„æ¦‚å¿µï¼Œä»¥åŠä¸ºä»€ä¹ˆæŸäº›æœåŠ¡å™¨æˆ–å·¥å…·åªèƒ½å¤„ç†é™æ€èµ„æºã€‚</p><hr><h3 id="ä¸€ã€é™æ€èµ„æº-Static-Resources"><a href="#ä¸€ã€é™æ€èµ„æº-Static-Resources" class="headerlink" title="ä¸€ã€é™æ€èµ„æº (Static Resources)"></a>ä¸€ã€é™æ€èµ„æº (Static Resources)</h3><h4 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h4><p><strong>é™æ€èµ„æº</strong>æ˜¯æŒ‡åœ¨æœåŠ¡å™¨ç«¯<strong>ä¸éœ€è¦ç»è¿‡ä»»ä½•å¤„ç†æˆ–è®¡ç®—</strong>ï¼Œå°±èƒ½ç›´æ¥è¿”å›ç»™å®¢æˆ·ç«¯çš„èµ„æºã€‚å®ƒä»¬çš„<strong>å†…å®¹æ˜¯å›ºå®šä¸å˜</strong>çš„ï¼Œæ— è®ºä½•æ—¶ã€è¢«è°è¯·æ±‚ï¼ŒæœåŠ¡å™¨è¿”å›çš„éƒ½æ˜¯åŒä¸€ä¸ªæ–‡ä»¶ã€‚</p><h4 id="å¸¸è§ç±»å‹"><a href="#å¸¸è§ç±»å‹" class="headerlink" title="å¸¸è§ç±»å‹"></a>å¸¸è§ç±»å‹</h4><ul><li><strong>HTML æ–‡ä»¶</strong> (<code>.html</code>)ï¼šçº¯ HTML ä»£ç ï¼Œæµè§ˆå™¨ç›´æ¥æ¸²æŸ“ã€‚</li><li><strong>CSS æ ·å¼è¡¨</strong> (<code>.css</code>)ï¼šå®šä¹‰ç½‘é¡µæ ·å¼ã€‚</li><li><strong>JavaScript è„šæœ¬</strong> (<code>.js</code>)ï¼šç”¨äºç½‘é¡µäº¤äº’ã€‚</li><li><strong>å›¾ç‰‡</strong> (<code>.jpg</code>, <code>.png</code>, <code>.gif</code>)ï¼šå›¾åƒæ–‡ä»¶ã€‚</li><li><strong>å­—ä½“æ–‡ä»¶</strong> (<code>.woff</code>, <code>.ttf</code>)ï¼šç½‘é¡µå­—ä½“ã€‚</li><li><strong>è§†é¢‘</strong> (<code>.mp4</code>, <code>.webm</code>)ï¼šè§†é¢‘æ–‡ä»¶ã€‚</li></ul><h4 id="å·¥ä½œæµç¨‹"><a href="#å·¥ä½œæµç¨‹" class="headerlink" title="å·¥ä½œæµç¨‹"></a>å·¥ä½œæµç¨‹</h4><ol><li>å®¢æˆ·ç«¯å‘æœåŠ¡å™¨è¯·æ±‚ä¸€ä¸ª URLï¼Œä¾‹å¦‚ <code>http://example.com/styles.css</code>ã€‚</li><li>æœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚ï¼Œç›´æ¥ä»<strong>æ–‡ä»¶ç³»ç»Ÿ</strong>ä¸­æ‰¾åˆ°åä¸º <code>styles.css</code> çš„æ–‡ä»¶ã€‚</li><li>æœåŠ¡å™¨å°† <code>styles.css</code> çš„å†…å®¹åŸå°ä¸åŠ¨åœ°è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li></ol><h4 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h4><ul><li><strong>é«˜æ•ˆ</strong>ï¼šæ— éœ€æœåŠ¡å™¨è®¡ç®—ï¼Œç›´æ¥è¯»å–æ–‡ä»¶ï¼Œå“åº”é€Ÿåº¦æå¿«ã€‚</li><li><strong>å¯ç¼“å­˜</strong>ï¼šç”±äºå†…å®¹ä¸å˜ï¼Œæµè§ˆå™¨ã€ä»£ç†æœåŠ¡å™¨éƒ½å¯ä»¥å¯¹é™æ€èµ„æºè¿›è¡Œç¼“å­˜ï¼Œè¿›ä¸€æ­¥å‡å°‘ç½‘ç»œä¼ è¾“ã€‚</li><li><strong>éƒ¨ç½²ç®€å•</strong>ï¼šåªéœ€å°†æ–‡ä»¶æ”¾åœ¨æœåŠ¡å™¨çš„ç‰¹å®šç›®å½•ä¸‹å³å¯ã€‚</li></ul><h3 id="äºŒã€åŠ¨æ€èµ„æº-Dynamic-Resources"><a href="#äºŒã€åŠ¨æ€èµ„æº-Dynamic-Resources" class="headerlink" title="äºŒã€åŠ¨æ€èµ„æº (Dynamic Resources)"></a>äºŒã€åŠ¨æ€èµ„æº (Dynamic Resources)</h3><h4 id="æ¦‚å¿µ-1"><a href="#æ¦‚å¿µ-1" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h4><p><strong>åŠ¨æ€èµ„æº</strong>æ˜¯æŒ‡æœåŠ¡å™¨ç«¯<strong>éœ€è¦ç»è¿‡å¤„ç†ã€è®¡ç®—æˆ–æŸ¥è¯¢æ•°æ®åº“</strong>ï¼Œæ‰èƒ½ç”Ÿæˆå¹¶è¿”å›ç»™å®¢æˆ·ç«¯çš„èµ„æºã€‚å®ƒä»¬çš„å†…å®¹æ˜¯<strong>å¯å˜</strong>çš„ï¼Œä¸åŒçš„è¯·æ±‚ã€ä¸åŒçš„æ—¶é—´ï¼Œè¿”å›çš„å†…å®¹å¯èƒ½ä¸åŒã€‚</p><h4 id="å¸¸è§ç±»å‹-1"><a href="#å¸¸è§ç±»å‹-1" class="headerlink" title="å¸¸è§ç±»å‹"></a>å¸¸è§ç±»å‹</h4><ul><li><strong>Servlet&#x2F;JSP</strong>ï¼šJava åç«¯é€šè¿‡ Servlet æˆ– JSP åŠ¨æ€ç”Ÿæˆ HTMLã€‚</li><li><strong>PHP è„šæœ¬</strong> (<code>.php</code>)ï¼šPHP åç«¯ç”Ÿæˆ HTMLã€‚</li><li><strong>Python&#x2F;Django è§†å›¾</strong>ï¼šPython åç«¯å¤„ç†è¯·æ±‚å¹¶è¿”å›æ•°æ®ã€‚</li><li><strong>RESTful API</strong>ï¼šè¿”å› JSONã€XML ç­‰æ ¼å¼çš„æ•°æ®ã€‚</li></ul><h4 id="å·¥ä½œæµç¨‹-1"><a href="#å·¥ä½œæµç¨‹-1" class="headerlink" title="å·¥ä½œæµç¨‹"></a>å·¥ä½œæµç¨‹</h4><ol><li>å®¢æˆ·ç«¯å‘æœåŠ¡å™¨è¯·æ±‚ä¸€ä¸ª URLï¼Œä¾‹å¦‚ <code>http://example.com/user/profile?id=123</code>ã€‚</li><li>æœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚ï¼Œå°†è¯·æ±‚è½¬å‘ç»™<strong>åç«¯ç¨‹åº</strong>ï¼ˆå¦‚ Servlet å®¹å™¨ï¼‰ã€‚</li><li>åç«¯ç¨‹åºæ¥æ”¶è¯·æ±‚ï¼Œæ ¹æ®è¯·æ±‚å‚æ•° <code>id=123</code> æŸ¥è¯¢æ•°æ®åº“ï¼Œè·å–è¯¥ç”¨æˆ·çš„ä¿¡æ¯ã€‚</li><li>åç«¯ç¨‹åºå°†æ•°æ®æ¸²æŸ“åˆ° HTML æ¨¡æ¿ä¸­ï¼Œæˆ–è€…å°†æ•°æ®å°è£…æˆ JSON æ ¼å¼ã€‚</li><li>åç«¯ç¨‹åºå°†<strong>åŠ¨æ€ç”Ÿæˆçš„å†…å®¹</strong>ä½œä¸ºå“åº”è¿”å›ç»™æœåŠ¡å™¨ã€‚</li><li>æœåŠ¡å™¨å°†è¯¥å“åº”å‘é€ç»™å®¢æˆ·ç«¯ã€‚</li></ol><h4 id="ç‰¹ç‚¹-1"><a href="#ç‰¹ç‚¹-1" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h4><ul><li><strong>çµæ´»</strong>ï¼šå¯ä»¥æ ¹æ®ä¸šåŠ¡é€»è¾‘ç”Ÿæˆä¸ªæ€§åŒ–å†…å®¹ã€‚</li><li><strong>æ¶ˆè€—èµ„æº</strong>ï¼šéœ€è¦æ¶ˆè€— CPUã€å†…å­˜ã€æ•°æ®åº“è¿æ¥ç­‰èµ„æºè¿›è¡Œè®¡ç®—ã€‚</li><li><strong>ä¸å¯ç›´æ¥ç¼“å­˜</strong>ï¼šç”±äºå†…å®¹å¯å˜ï¼Œé€šå¸¸æ— æ³•åƒé™æ€èµ„æºé‚£æ ·ç›´æ¥ç¼“å­˜ã€‚</li></ul><h3 id="ä¸‰ã€æ˜¯ä»€ä¹ˆä¸œè¥¿åªèƒ½è§£æé™æ€èµ„æºï¼Ÿ"><a href="#ä¸‰ã€æ˜¯ä»€ä¹ˆä¸œè¥¿åªèƒ½è§£æé™æ€èµ„æºï¼Ÿ" class="headerlink" title="ä¸‰ã€æ˜¯ä»€ä¹ˆä¸œè¥¿åªèƒ½è§£æé™æ€èµ„æºï¼Ÿ"></a>ä¸‰ã€æ˜¯ä»€ä¹ˆä¸œè¥¿åªèƒ½è§£æé™æ€èµ„æºï¼Ÿ</h3><p>è¿™ä¸ªé—®é¢˜çš„æ ¸å¿ƒåœ¨äº**â€œè§£æâ€<strong>è¿™ä¸ªè¯ã€‚èƒ½â€œè§£æâ€é™æ€èµ„æºçš„ï¼Œé€šå¸¸æŒ‡çš„æ˜¯</strong>Web æœåŠ¡å™¨**ã€‚</p><ul><li><strong>Web æœåŠ¡å™¨</strong>ï¼šä¸€ç§è½¯ä»¶ï¼Œå®ƒçš„ä¸»è¦èŒè´£æ˜¯å¤„ç† HTTP è¯·æ±‚å¹¶è¿”å›æ–‡ä»¶ã€‚</li></ul><h4 id="1-çº¯é™æ€-Web-æœåŠ¡å™¨-Static-Web-Server"><a href="#1-çº¯é™æ€-Web-æœåŠ¡å™¨-Static-Web-Server" class="headerlink" title="1. çº¯é™æ€ Web æœåŠ¡å™¨ (Static Web Server)"></a>1. çº¯é™æ€ Web æœåŠ¡å™¨ (Static Web Server)</h4><p><strong>è¿™ç±»æœåŠ¡å™¨çš„æ ¸å¿ƒåŠŸèƒ½å°±æ˜¯æä¾›é™æ€æ–‡ä»¶æœåŠ¡ã€‚</strong> å®ƒä»¬åªçŸ¥é“å¦‚ä½•æ ¹æ® URL è·¯å¾„ï¼Œå»æ–‡ä»¶ç³»ç»Ÿæ‰¾åˆ°å¯¹åº”çš„æ–‡ä»¶ï¼Œç„¶åè¿”å›ã€‚</p><ul><li><strong>å·¥ä½œåŸç†</strong>ï¼šå®ƒä»¬æ²¡æœ‰å†…ç½®çš„åç«¯è¯­è¨€è§£æå™¨ï¼ˆå¦‚ Java è™šæ‹Ÿæœºã€PHP è§£é‡Šå™¨ï¼‰ã€‚å½“å®ƒä»¬æ”¶åˆ°ä¸€ä¸ªè¯·æ±‚æ—¶ï¼Œåªä¼šå°† URL æ˜ å°„åˆ°æ–‡ä»¶ç›®å½•ã€‚å¦‚æœæ–‡ä»¶å­˜åœ¨ï¼Œå°±è¿”å›ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œå°±è¿”å› 404 é”™è¯¯ã€‚</li><li><strong>ä»£è¡¨</strong>ï¼š<strong>Nginx</strong>ï¼ˆä½œä¸ºåå‘ä»£ç†æˆ–é™æ€æ–‡ä»¶æœåŠ¡å™¨æ—¶ï¼‰ã€<strong>Apache HTTP Server</strong>ï¼ˆä½œä¸ºé™æ€æ–‡ä»¶æœåŠ¡å™¨æ—¶ï¼‰ã€‚</li></ul><p><strong>ä¸ºä»€ä¹ˆå®ƒä»¬ä¸èƒ½è§£æåŠ¨æ€èµ„æºï¼Ÿ</strong></p><p>å› ä¸ºå®ƒä»¬<strong>ä¸å…·å¤‡</strong>æ‰§è¡Œåç«¯ä»£ç çš„èƒ½åŠ›ã€‚ä¾‹å¦‚ï¼Œå½“ Nginx æ”¶åˆ°ä¸€ä¸ªå¯¹ <code>.jsp</code> æ–‡ä»¶çš„è¯·æ±‚æ—¶ï¼Œå®ƒä¸çŸ¥é“å¦‚ä½•è¿è¡Œ Java ä»£ç æ¥ç”Ÿæˆ HTMLã€‚å®ƒåªä¼šæŠŠ <code>.jsp</code> æ–‡ä»¶å½“ä½œä¸€ä¸ªæ™®é€šçš„æ–‡æœ¬æ–‡ä»¶è¿”å›ç»™æµè§ˆå™¨ï¼Œæµè§ˆå™¨ä¹Ÿæ— æ³•æ­£ç¡®åœ°è§£æã€‚</p><h4 id="2-åŠ¨æ€-Web-æœåŠ¡å™¨-Dynamic-Web-Server"><a href="#2-åŠ¨æ€-Web-æœåŠ¡å™¨-Dynamic-Web-Server" class="headerlink" title="2. åŠ¨æ€ Web æœåŠ¡å™¨ (Dynamic Web Server)"></a>2. åŠ¨æ€ Web æœåŠ¡å™¨ (Dynamic Web Server)</h4><p>è¿™ç±»æœåŠ¡å™¨é€šå¸¸è¢«ç§°ä¸º <strong>â€œåº”ç”¨æœåŠ¡å™¨â€</strong>ï¼Œå®ƒä»¬åœ¨ Web æœåŠ¡å™¨çš„åŠŸèƒ½ä¸Šï¼Œ<strong>å†…ç½®äº†åç«¯è¯­è¨€çš„è¿è¡Œç¯å¢ƒ</strong>ã€‚</p><ul><li><strong>å·¥ä½œåŸç†</strong>ï¼š<ul><li>å½“å®ƒä»¬æ”¶åˆ°é™æ€èµ„æºè¯·æ±‚æ—¶ï¼Œè¡Œä¸ºä¸é™æ€æœåŠ¡å™¨ç›¸åŒï¼šç›´æ¥è¿”å›æ–‡ä»¶ã€‚</li><li>å½“å®ƒä»¬æ”¶åˆ°åŠ¨æ€èµ„æºè¯·æ±‚æ—¶ï¼Œä¼šå°†è¯·æ±‚è½¬å‘ç»™å†…ç½®çš„<strong>åç«¯ç¨‹åºè¿è¡Œç¯å¢ƒ</strong>ã€‚ä¾‹å¦‚ï¼ŒTomcat ä¼šå°† <code>.jsp</code> æ–‡ä»¶äº¤ç»™ JSP å¼•æ“æ¥ç¼–è¯‘å’Œæ‰§è¡Œã€‚</li></ul></li><li><strong>ä»£è¡¨</strong>ï¼š<strong>Apache Tomcat</strong>ã€<strong>Jetty</strong>ã€‚</li></ul><p>å› æ­¤ï¼Œåœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬ç»å¸¸é‡‡ç”¨<strong>åŠ¨é™åˆ†ç¦»</strong>çš„æ¶æ„ï¼š</p><ul><li><strong>é™æ€èµ„æº</strong>ï¼ˆ<code>index.html</code>ã€<code>style.css</code> ç­‰ï¼‰äº¤ç»™ <strong>Nginx</strong> è¿™æ ·çš„é«˜æ•ˆé™æ€æœåŠ¡å™¨å¤„ç†ã€‚</li><li><strong>åŠ¨æ€èµ„æº</strong>ï¼ˆ<code>api/user</code>, <code>.jsp</code> ç­‰ï¼‰äº¤ç»™ <strong>Tomcat</strong> è¿™æ ·çš„åº”ç”¨æœåŠ¡å™¨å¤„ç†ã€‚</li></ul><p>è¿™æ ·åšçš„ç›®çš„æ˜¯ï¼Œè®©ä¸“ä¸šçš„å·¥å…·åšä¸“ä¸šçš„äº‹ï¼šNginx æ“…é•¿é«˜å¹¶å‘çš„é™æ€æ–‡ä»¶æœåŠ¡ï¼Œè€Œ Tomcat åˆ™ä¸“æ³¨äºå¤æ‚çš„åŠ¨æ€ä¸šåŠ¡é€»è¾‘ã€‚</p><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ¥ç³»ç»Ÿã€å…¨é¢åœ°æ¢³ç†å‰ç«¯çš„æ ¸å¿ƒçŸ¥è¯†ï¼Œè¿™ä¸ä»…æ˜¯å‰ç«¯å·¥ç¨‹å¸ˆçš„å¿…å¤‡æŠ€èƒ½ï¼Œä¹Ÿæ˜¯åç«¯å¼€å‘è€…ç†è§£æ•´ä¸ª Web åº”ç”¨æ¶æ„çš„å…³é”®ã€‚</p><h3 id="ä¸€ã€åŸºç¡€ä¸‰å‰‘å®¢ï¼šæ„å»ºç½‘é¡µçš„åŸºçŸ³"><a href="#ä¸€ã€åŸºç¡€ä¸‰å‰‘å®¢ï¼šæ„å»ºç½‘é¡µçš„åŸºçŸ³" class="headerlink" title="ä¸€ã€åŸºç¡€ä¸‰å‰‘å®¢ï¼šæ„å»ºç½‘é¡µçš„åŸºçŸ³"></a>ä¸€ã€åŸºç¡€ä¸‰å‰‘å®¢ï¼šæ„å»ºç½‘é¡µçš„åŸºçŸ³</h3><p>è¿™ä¸‰è€…æ˜¯æ‰€æœ‰å‰ç«¯æŠ€æœ¯çš„åŸºç¡€ï¼Œå°±åƒå»ºç­‘çš„é’¢ç­‹ã€æ°´æ³¥å’Œæ°´ç”µã€‚</p><h4 id="1-HTML-HyperText-Markup-Language"><a href="#1-HTML-HyperText-Markup-Language" class="headerlink" title="1. HTML (HyperText Markup Language)"></a>1. HTML (HyperText Markup Language)</h4><ul><li><strong>æ˜¯ä»€ä¹ˆ</strong>ï¼šè¶…æ–‡æœ¬æ ‡è®°è¯­è¨€ï¼Œç”¨äº<strong>å®šä¹‰ç½‘é¡µçš„ç»“æ„å’Œå†…å®¹</strong>ã€‚å®ƒç”±ä¸€ç³»åˆ—æ ‡ç­¾ï¼ˆtagï¼‰ç»„æˆï¼Œè¿™äº›æ ‡ç­¾å‘Šè¯‰æµè§ˆå™¨å¦‚ä½•ç»„ç»‡é¡µé¢å†…å®¹ï¼Œå¦‚æ®µè½ã€æ ‡é¢˜ã€å›¾ç‰‡ã€é“¾æ¥ç­‰ã€‚</li><li><strong>æ ¸å¿ƒæ¦‚å¿µ</strong>ï¼š<ul><li><strong>æ ‡ç­¾ï¼ˆTagsï¼‰</strong>ï¼šå¦‚ <code>&lt;p&gt;</code> (æ®µè½), <code>&lt;h1&gt;</code> (ä¸€çº§æ ‡é¢˜), <code>&lt;img&gt;</code> (å›¾ç‰‡), <code>&lt;a&gt;</code> (è¶…é“¾æ¥)ã€‚</li><li><strong>å…ƒç´ ï¼ˆElementsï¼‰</strong>ï¼šç”±å¼€å§‹æ ‡ç­¾ã€å†…å®¹å’Œç»“æŸæ ‡ç­¾ç»„æˆï¼Œä¾‹å¦‚ <code>&lt;p&gt;è¿™æ˜¯ä¸€ä¸ªæ®µè½ã€‚&lt;/p&gt;</code>ã€‚</li><li><strong>å±æ€§ï¼ˆAttributesï¼‰</strong>ï¼šæä¾›å…³äºå…ƒç´ çš„é¢å¤–ä¿¡æ¯ï¼Œå¦‚ <code>&lt;img src=&quot;image.jpg&quot; alt=&quot;æè¿°&quot;&gt;</code> ä¸­çš„ <code>src</code> å’Œ <code>alt</code>ã€‚</li><li><strong>è¯­ä¹‰åŒ–ï¼ˆSemantic HTMLï¼‰</strong>ï¼šä½¿ç”¨æ°å½“çš„æ ‡ç­¾æ¥è¡¨è¾¾å†…å®¹çš„å«ä¹‰ï¼Œå¦‚ <code>&lt;header&gt;</code>, <code>&lt;nav&gt;</code>, <code>&lt;article&gt;</code>, <code>&lt;footer&gt;</code>ï¼Œè¿™æœ‰åŠ©äºæœç´¢å¼•æ“ä¼˜åŒ–ï¼ˆSEOï¼‰å’Œæ— éšœç¢è®¿é—®ã€‚</li></ul></li></ul><h4 id="2-CSS-Cascading-Style-Sheets"><a href="#2-CSS-Cascading-Style-Sheets" class="headerlink" title="2. CSS (Cascading Style Sheets)"></a>2. CSS (Cascading Style Sheets)</h4><ul><li><strong>æ˜¯ä»€ä¹ˆ</strong>ï¼šå±‚å æ ·å¼è¡¨ï¼Œç”¨äº<strong>å®šä¹‰ç½‘é¡µçš„æ ·å¼å’Œè¡¨ç°</strong>ã€‚å®ƒå‘Šè¯‰æµè§ˆå™¨å¦‚ä½•æ˜¾ç¤º HTML å…ƒç´ ï¼Œå¦‚é¢œè‰²ã€å­—ä½“ã€å¸ƒå±€ã€å¤§å°ç­‰ã€‚</li><li><strong>æ ¸å¿ƒæ¦‚å¿µ</strong>ï¼š<ul><li><strong>é€‰æ‹©å™¨ï¼ˆSelectorsï¼‰</strong>ï¼šç”¨äºé€‰ä¸­è¦åº”ç”¨æ ·å¼çš„ HTML å…ƒç´ ï¼Œå¦‚ <code>h1</code> (æ ‡ç­¾é€‰æ‹©å™¨), <code>.my-class</code> (ç±»é€‰æ‹©å™¨), <code>#my-id</code> (ID é€‰æ‹©å™¨)ã€‚</li><li><strong>ç›’æ¨¡å‹ï¼ˆBox Modelï¼‰</strong>ï¼šæ¯ä¸ª HTML å…ƒç´ éƒ½è¢«è§†ä¸ºä¸€ä¸ªçŸ©å½¢ç›’å­ï¼ŒåŒ…å« <code>content</code>ï¼ˆå†…å®¹ï¼‰ã€<code>padding</code>ï¼ˆå†…è¾¹è·ï¼‰ã€<code>border</code>ï¼ˆè¾¹æ¡†ï¼‰å’Œ <code>margin</code>ï¼ˆå¤–è¾¹è·ï¼‰ã€‚</li><li><strong>å¸ƒå±€ï¼ˆLayoutï¼‰</strong>ï¼š<ul><li><strong>ä¼ ç»Ÿå¸ƒå±€</strong>ï¼š<code>float</code>, <code>position</code>, <code>display</code>ã€‚</li><li><strong>ç°ä»£å¸ƒå±€</strong>ï¼š<strong>Flexbox</strong> (å¼¹æ€§ç›’å­ï¼Œç”¨äºä¸€ç»´å¸ƒå±€) å’Œ <strong>Grid</strong> (ç½‘æ ¼ç³»ç»Ÿï¼Œç”¨äºäºŒç»´å¸ƒå±€)ã€‚è¿™ä¸¤ç§æ˜¯ç›®å‰æœ€ä¸»æµçš„å¸ƒå±€æ–¹å¼ã€‚</li></ul></li><li><strong>å“åº”å¼è®¾è®¡ï¼ˆResponsive Designï¼‰</strong>ï¼šä½¿ç”¨ <code>@media</code> æŸ¥è¯¢æ¥æ ¹æ®è®¾å¤‡å±å¹•å¤§å°è°ƒæ•´æ ·å¼ï¼Œä½¿ç½‘é¡µåœ¨ä¸åŒè®¾å¤‡ä¸Šéƒ½èƒ½è‰¯å¥½æ˜¾ç¤ºã€‚</li></ul></li></ul><h4 id="3-JavaScript-JS"><a href="#3-JavaScript-JS" class="headerlink" title="3. JavaScript (JS)"></a>3. JavaScript (JS)</h4><ul><li><strong>æ˜¯ä»€ä¹ˆ</strong>ï¼šä¸€ç§é«˜çº§ç¼–ç¨‹è¯­è¨€ï¼Œç”¨äº<strong>å®ç°ç½‘é¡µçš„åŠ¨æ€è¡Œä¸ºå’Œäº¤äº’</strong>ã€‚å®ƒå¯ä»¥æ“ä½œ HTML å’Œ CSSï¼Œå¤„ç†ç”¨æˆ·äº‹ä»¶ï¼Œå¹¶ä¸æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ã€‚</li><li><strong>æ ¸å¿ƒæ¦‚å¿µ</strong>ï¼š<ul><li><strong>DOM (Document Object Model) æ“ä½œ</strong>ï¼šé€šè¿‡ <code>document</code> å¯¹è±¡ï¼ŒJS å¯ä»¥è·å–ã€ä¿®æ”¹ã€æ·»åŠ æˆ–åˆ é™¤é¡µé¢ä¸Šçš„ HTML å…ƒç´ ã€‚ä¾‹å¦‚ <code>document.getElementById(&#39;myId&#39;)</code>ã€‚</li><li><strong>äº‹ä»¶å¤„ç†ï¼ˆEvent Handlingï¼‰</strong>ï¼šå“åº”ç”¨æˆ·çš„è¡Œä¸ºï¼Œå¦‚ç‚¹å‡»ã€è¾“å…¥ã€é¼ æ ‡ç§»åŠ¨ç­‰ã€‚ä¾‹å¦‚ <code>element.addEventListener(&#39;click&#39;, function() &#123; ... &#125;)</code>ã€‚</li><li><strong>å¼‚æ­¥ç¼–ç¨‹ï¼ˆAsynchronous Programmingï¼‰</strong>ï¼šå¤„ç†è€—æ—¶æ“ä½œï¼Œå¦‚ç½‘ç»œè¯·æ±‚ã€‚<ul><li><strong>Callback (å›è°ƒå‡½æ•°)</strong>ï¼šä¼ ç»Ÿæ–¹å¼ã€‚</li><li><strong>Promise</strong>ï¼šES6 å¼•å…¥ï¼Œè§£å†³äº†å›è°ƒåœ°ç‹±é—®é¢˜ã€‚</li><li><strong>async&#x2F;await</strong>ï¼šåŸºäº <code>Promise</code> çš„è¯­æ³•ç³–ï¼Œä½¿å¼‚æ­¥ä»£ç çœ‹èµ·æ¥åƒåŒæ­¥ä»£ç ï¼Œæ›´æ˜“è¯»ã€‚</li></ul></li><li><strong>AJAX (Asynchronous JavaScript and XML)</strong>ï¼šåœ¨ä¸é‡æ–°åŠ è½½æ•´ä¸ªé¡µé¢çš„æƒ…å†µä¸‹ï¼Œä¸æœåŠ¡å™¨è¿›è¡Œå¼‚æ­¥é€šä¿¡ã€‚ç°ä»£åº”ç”¨ä¸­é€šå¸¸ä½¿ç”¨ <code>fetch()</code> API æˆ– <code>Axios</code> åº“æ¥å‘é€ JSON æ•°æ®ã€‚</li></ul></li></ul><hr><h3 id="äºŒã€ç°ä»£å‰ç«¯æ¡†æ¶ï¼šæå‡å¼€å‘æ•ˆç‡"><a href="#äºŒã€ç°ä»£å‰ç«¯æ¡†æ¶ï¼šæå‡å¼€å‘æ•ˆç‡" class="headerlink" title="äºŒã€ç°ä»£å‰ç«¯æ¡†æ¶ï¼šæå‡å¼€å‘æ•ˆç‡"></a>äºŒã€ç°ä»£å‰ç«¯æ¡†æ¶ï¼šæå‡å¼€å‘æ•ˆç‡</h3><p>ä¸ºäº†å¤„ç†æ—¥ç›Šå¤æ‚çš„ Web åº”ç”¨ï¼Œå¼€å‘è€…é€šå¸¸ä¼šä½¿ç”¨ä»¥ä¸‹æ¡†æ¶ã€‚</p><ul><li><strong>React</strong>ï¼šç”± Facebook å¼€å‘ï¼Œ<strong>ç»„ä»¶åŒ–</strong>ã€<strong>å£°æ˜å¼</strong>çš„ UI åº“ã€‚<ul><li><strong>æ ¸å¿ƒ</strong>ï¼š<strong>ç»„ä»¶ï¼ˆComponentsï¼‰</strong>ï¼Œå°† UI æ‹†åˆ†æˆç‹¬ç«‹ã€å¯å¤ç”¨çš„éƒ¨åˆ†ã€‚</li><li><strong>å·¥ä½œåŸç†</strong>ï¼šä½¿ç”¨<strong>è™šæ‹Ÿ DOM (Virtual DOM)</strong>ï¼Œåœ¨å†…å­˜ä¸­è¿›è¡Œè®¡ç®—ï¼Œç„¶ååªæ›´æ–°å®é™…æ”¹å˜çš„éƒ¨åˆ†ï¼Œæé«˜äº†æ€§èƒ½ã€‚</li><li><strong>ç”Ÿæ€</strong>ï¼šåºå¤§è€Œæ´»è·ƒï¼Œæœ‰æˆç†Ÿçš„çŠ¶æ€ç®¡ç†ï¼ˆRedux, Zustandï¼‰ã€è·¯ç”±ï¼ˆReact Routerï¼‰ç­‰è§£å†³æ–¹æ¡ˆã€‚</li></ul></li><li><strong>Vue.js</strong>ï¼šç”±å°¤é›¨æºªå¼€å‘ï¼Œæ˜“å­¦æ˜“ç”¨ï¼Œ<strong>æ¸è¿›å¼</strong>æ¡†æ¶ã€‚<ul><li><strong>æ ¸å¿ƒ</strong>ï¼š<strong>å“åº”å¼æ•°æ®ç»‘å®š</strong>ï¼Œæ•°æ®æ”¹å˜ï¼Œè§†å›¾è‡ªåŠ¨æ›´æ–°ã€‚</li><li><strong>ç‰¹ç‚¹</strong>ï¼šä¸Šæ‰‹å¿«ï¼Œæ–‡æ¡£å‹å¥½ï¼Œç¤¾åŒºç”Ÿæ€å®Œå–„ã€‚</li></ul></li><li><strong>Angular</strong>ï¼šç”± Google å¼€å‘ï¼Œ<strong>å…¨èƒ½å‹</strong>æ¡†æ¶ã€‚<ul><li><strong>æ ¸å¿ƒ</strong>ï¼šæä¾›äº†å®Œæ•´çš„è§£å†³æ–¹æ¡ˆï¼ŒåŒ…æ‹¬è·¯ç”±ã€ä¾èµ–æ³¨å…¥ã€çŠ¶æ€ç®¡ç†ç­‰ã€‚</li><li><strong>ç‰¹ç‚¹</strong>ï¼šé€‚åˆå¤§å‹ä¼ä¸šçº§åº”ç”¨ï¼Œå­¦ä¹ æ›²çº¿ç›¸å¯¹é™¡å³­ã€‚</li></ul></li></ul><hr><h3 id="ä¸‰ã€å·¥ç¨‹åŒ–ï¼šé«˜æ•ˆåä½œå’Œè‡ªåŠ¨åŒ–"><a href="#ä¸‰ã€å·¥ç¨‹åŒ–ï¼šé«˜æ•ˆåä½œå’Œè‡ªåŠ¨åŒ–" class="headerlink" title="ä¸‰ã€å·¥ç¨‹åŒ–ï¼šé«˜æ•ˆåä½œå’Œè‡ªåŠ¨åŒ–"></a>ä¸‰ã€å·¥ç¨‹åŒ–ï¼šé«˜æ•ˆåä½œå’Œè‡ªåŠ¨åŒ–</h3><p>ç°ä»£å‰ç«¯å¼€å‘å·²ç»ä¸ä»…ä»…æ˜¯å†™ä»£ç ï¼Œè¿˜éœ€è¦ä½¿ç”¨ä¸€ç³»åˆ—å·¥å…·æ¥æé«˜æ•ˆç‡ã€‚</p><ul><li><strong>åŒ…ç®¡ç†å™¨</strong>ï¼š<code>npm</code>, <code>yarn</code>, <code>pnpm</code>ã€‚ç”¨äºç®¡ç†é¡¹ç›®ä¾èµ–ã€‚</li><li><strong>æ„å»ºå·¥å…·</strong>ï¼š<ul><li><strong>Webpack</strong>ï¼šå°†å¤šä¸ªæ¨¡å—æ‰“åŒ…æˆä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶ï¼Œå¹¶èƒ½å¤„ç†èµ„æºä¾èµ–ã€ä»£ç å‹ç¼©ç­‰ã€‚</li><li><strong>Vite</strong>ï¼šåŸºäº ES Modules çš„æ–°ä¸€ä»£æ„å»ºå·¥å…·ï¼Œå¼€å‘æ¨¡å¼ä¸‹é€Ÿåº¦æå¿«ã€‚</li></ul></li><li><strong>è½¬è¯‘å·¥å…·</strong>ï¼š<strong>Babel</strong>ã€‚å°† ES6+ çš„ä»£ç è½¬è¯‘ä¸ºæµè§ˆå™¨å…¼å®¹çš„ ES5 ä»£ç ã€‚</li><li><strong>ä»£ç è§„èŒƒ</strong>ï¼š<strong>ESLint</strong> (ä»£ç é£æ ¼æ£€æŸ¥), <strong>Prettier</strong> (ä»£ç æ ¼å¼åŒ–)ã€‚</li><li><strong>ç‰ˆæœ¬æ§åˆ¶</strong>ï¼š<strong>Git</strong>ã€‚ç”¨äºå›¢é˜Ÿåä½œå’Œä»£ç ç‰ˆæœ¬ç®¡ç†ã€‚</li></ul><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬è¯¦ç»†ã€å…¨é¢åœ°ä»‹ç» CSS é€‰æ‹©å™¨ã€‚é€‰æ‹©å™¨æ˜¯ CSS çš„æ ¸å¿ƒï¼ŒæŒæ¡å®ƒæ‰èƒ½ç²¾ç¡®åœ°æ§åˆ¶ç½‘é¡µæ ·å¼ã€‚æˆ‘ä»¬å°†ä»åŸºç¡€åˆ°é«˜çº§ï¼Œç³»ç»Ÿåœ°æ¢³ç†ä¸åŒç±»å‹çš„é€‰æ‹©å™¨åŠå…¶ç”¨æ³•ã€‚</p><hr><h3 id="ä¸€ã€åŸºç¡€é€‰æ‹©å™¨-Basic-Selectors"><a href="#ä¸€ã€åŸºç¡€é€‰æ‹©å™¨-Basic-Selectors" class="headerlink" title="ä¸€ã€åŸºç¡€é€‰æ‹©å™¨ (Basic Selectors)"></a>ä¸€ã€åŸºç¡€é€‰æ‹©å™¨ (Basic Selectors)</h3><p>è¿™äº›æ˜¯ CSS ä¸­æœ€ç®€å•ã€æœ€å¸¸ç”¨çš„é€‰æ‹©å™¨ï¼Œç”¨äºç›´æ¥é€‰ä¸­å…ƒç´ ã€‚</p><h4 id="1-å…ƒç´ é€‰æ‹©å™¨-Type-Selector"><a href="#1-å…ƒç´ é€‰æ‹©å™¨-Type-Selector" class="headerlink" title="1. å…ƒç´ é€‰æ‹©å™¨ (Type Selector)"></a>1. å…ƒç´ é€‰æ‹©å™¨ (Type Selector)</h4><ul><li><strong>ä½œç”¨</strong>ï¼šæ ¹æ®å…ƒç´ çš„æ ‡ç­¾åæ¥é€‰æ‹©å…ƒç´ ã€‚</li><li><strong>è¯­æ³•</strong>ï¼š<code>element_name &#123; ... &#125;</code></li><li><strong>ç¤ºä¾‹</strong>ï¼š<ul><li><code>p &#123; color: blue; &#125;</code>ï¼šé€‰ä¸­æ‰€æœ‰ <code>&lt;p&gt;</code> å…ƒç´ ã€‚</li><li><code>h1 &#123; font-size: 24px; &#125;</code>ï¼šé€‰ä¸­æ‰€æœ‰ <code>&lt;h1&gt;</code> å…ƒç´ ã€‚</li></ul></li></ul><h4 id="2-ç±»é€‰æ‹©å™¨-Class-Selector"><a href="#2-ç±»é€‰æ‹©å™¨-Class-Selector" class="headerlink" title="2. ç±»é€‰æ‹©å™¨ (Class Selector)"></a>2. ç±»é€‰æ‹©å™¨ (Class Selector)</h4><ul><li><strong>ä½œç”¨</strong>ï¼šæ ¹æ®å…ƒç´ çš„ <code>class</code> å±æ€§æ¥é€‰æ‹©å…ƒç´ ã€‚</li><li><strong>è¯­æ³•</strong>ï¼š<code>.class_name &#123; ... &#125;</code></li><li><strong>ç‰¹ç‚¹</strong>ï¼šä¸€ä¸ªå…ƒç´ å¯ä»¥æœ‰å¤šä¸ªç±»åï¼Œç±»åå¯ä»¥é‡å¤ä½¿ç”¨ï¼Œéå¸¸çµæ´»ã€‚</li><li><strong>ç¤ºä¾‹</strong>ï¼š<ul><li><code>.highlight &#123; background-color: yellow; &#125;</code>ï¼šé€‰ä¸­æ‰€æœ‰ <code>class</code> å±æ€§ä¸­åŒ…å« <code>highlight</code> çš„å…ƒç´ ã€‚</li></ul></li></ul><h4 id="3-ID-é€‰æ‹©å™¨-ID-Selector"><a href="#3-ID-é€‰æ‹©å™¨-ID-Selector" class="headerlink" title="3. ID é€‰æ‹©å™¨ (ID Selector)"></a>3. ID é€‰æ‹©å™¨ (ID Selector)</h4><ul><li><strong>ä½œç”¨</strong>ï¼šæ ¹æ®å…ƒç´ çš„ <code>id</code> å±æ€§æ¥é€‰æ‹©å…ƒç´ ã€‚</li><li><strong>è¯­æ³•</strong>ï¼š<code>#id_name &#123; ... &#125;</code></li><li><strong>ç‰¹ç‚¹</strong>ï¼šåœ¨ HTML æ–‡æ¡£ä¸­ï¼Œä¸€ä¸ª <code>id</code> å±æ€§çš„å€¼å¿…é¡»æ˜¯<strong>å”¯ä¸€çš„</strong>ã€‚</li><li><strong>ç¤ºä¾‹</strong>ï¼š<ul><li><code>#header &#123; height: 100px; &#125;</code>ï¼šé€‰ä¸­ <code>id</code> ä¸º <code>header</code> çš„å”¯ä¸€å…ƒç´ ã€‚</li></ul></li></ul><h4 id="4-é€šç”¨é€‰æ‹©å™¨-Universal-Selector"><a href="#4-é€šç”¨é€‰æ‹©å™¨-Universal-Selector" class="headerlink" title="4. é€šç”¨é€‰æ‹©å™¨ (Universal Selector)"></a>4. é€šç”¨é€‰æ‹©å™¨ (Universal Selector)</h4><ul><li><strong>ä½œç”¨</strong>ï¼šé€‰æ‹©é¡µé¢ä¸Šçš„æ‰€æœ‰å…ƒç´ ã€‚</li><li><strong>è¯­æ³•</strong>ï¼š<code>* &#123; ... &#125;</code></li><li><strong>ç¤ºä¾‹</strong>ï¼š<ul><li><code>* &#123; margin: 0; padding: 0; &#125;</code>ï¼šæ¸…é™¤æ‰€æœ‰å…ƒç´ çš„é»˜è®¤å¤–è¾¹è·å’Œå†…è¾¹è·ï¼Œå¸¸ç”¨äº CSS é‡ç½®ã€‚</li></ul></li></ul><hr><h3 id="äºŒã€ç»„åˆé€‰æ‹©å™¨-Combinators"><a href="#äºŒã€ç»„åˆé€‰æ‹©å™¨-Combinators" class="headerlink" title="äºŒã€ç»„åˆé€‰æ‹©å™¨ (Combinators)"></a>äºŒã€ç»„åˆé€‰æ‹©å™¨ (Combinators)</h3><p>è¿™äº›é€‰æ‹©å™¨ç”¨äºæ ¹æ®å…ƒç´ ä¹‹é—´çš„å…³ç³»æ¥é€‰æ‹©å…ƒç´ ï¼Œå¦‚çˆ¶å­å…³ç³»ã€å…„å¼Ÿå…³ç³»ç­‰ã€‚</p><h4 id="1-åä»£é€‰æ‹©å™¨-Descendant-Selector"><a href="#1-åä»£é€‰æ‹©å™¨-Descendant-Selector" class="headerlink" title="1. åä»£é€‰æ‹©å™¨ (Descendant Selector)"></a>1. åä»£é€‰æ‹©å™¨ (Descendant Selector)</h4><ul><li><strong>ä½œç”¨</strong>ï¼šé€‰æ‹©æŸä¸ªå…ƒç´ å†…éƒ¨çš„<strong>æ‰€æœ‰</strong>åä»£å…ƒç´ ï¼ˆåŒ…æ‹¬å­å…ƒç´ ã€å­™å­å…ƒç´ ç­‰ï¼‰ã€‚</li><li><strong>è¯­æ³•</strong>ï¼š<code>ancestor descendant &#123; ... &#125;</code>ï¼Œç”¨<strong>ç©ºæ ¼</strong>åˆ†éš”ã€‚</li><li><strong>ç¤ºä¾‹</strong>ï¼š<ul><li><code>ul li &#123; list-style-type: none; &#125;</code>ï¼šé€‰ä¸­æ‰€æœ‰ <code>&lt;ul&gt;</code> å†…éƒ¨çš„ <code>&lt;li&gt;</code> å…ƒç´ ã€‚</li></ul></li></ul><h4 id="2-å­é€‰æ‹©å™¨-Child-Selector"><a href="#2-å­é€‰æ‹©å™¨-Child-Selector" class="headerlink" title="2. å­é€‰æ‹©å™¨ (Child Selector)"></a>2. å­é€‰æ‹©å™¨ (Child Selector)</h4><ul><li><strong>ä½œç”¨</strong>ï¼šé€‰æ‹©æŸä¸ªå…ƒç´ çš„<strong>ç›´æ¥å­å…ƒç´ </strong>ã€‚</li><li><strong>è¯­æ³•</strong>ï¼š<code>parent &gt; child &#123; ... &#125;</code>ï¼Œç”¨ <code>&gt;</code> åˆ†éš”ã€‚</li><li><strong>ç¤ºä¾‹</strong>ï¼š<ul><li><code>ul &gt; li &#123; list-style-type: none; &#125;</code>ï¼šåªé€‰ä¸­ <code>&lt;ul&gt;</code> çš„ç›´æ¥å­å…ƒç´  <code>&lt;li&gt;</code>ã€‚</li><li><strong>åŒºåˆ«</strong>ï¼šä¸åä»£é€‰æ‹©å™¨ç›¸æ¯”ï¼Œæ›´åŠ ç²¾ç¡®ï¼Œæ€§èƒ½ä¹Ÿæ›´å¥½ã€‚</li></ul></li></ul><h4 id="3-ç›¸é‚»å…„å¼Ÿé€‰æ‹©å™¨-Adjacent-Sibling-Selector"><a href="#3-ç›¸é‚»å…„å¼Ÿé€‰æ‹©å™¨-Adjacent-Sibling-Selector" class="headerlink" title="3. ç›¸é‚»å…„å¼Ÿé€‰æ‹©å™¨ (Adjacent Sibling Selector)"></a>3. ç›¸é‚»å…„å¼Ÿé€‰æ‹©å™¨ (Adjacent Sibling Selector)</h4><ul><li><strong>ä½œç”¨</strong>ï¼šé€‰æ‹©ç´§æ¥åœ¨å¦ä¸€ä¸ªå…ƒç´ åé¢çš„<strong>å…„å¼Ÿå…ƒç´ </strong>ã€‚</li><li><strong>è¯­æ³•</strong>ï¼š<code>element + adjacent_element &#123; ... &#125;</code>ï¼Œç”¨ <code>+</code> åˆ†éš”ã€‚</li><li><strong>ç¤ºä¾‹</strong>ï¼š<ul><li><code>h1 + p &#123; margin-top: 0; &#125;</code>ï¼šé€‰ä¸­ç´§è·Ÿåœ¨ <code>&lt;h1&gt;</code> åçš„ç¬¬ä¸€ä¸ª <code>&lt;p&gt;</code> å…ƒç´ ã€‚</li></ul></li></ul><h4 id="4-é€šç”¨å…„å¼Ÿé€‰æ‹©å™¨-General-Sibling-Selector"><a href="#4-é€šç”¨å…„å¼Ÿé€‰æ‹©å™¨-General-Sibling-Selector" class="headerlink" title="4. é€šç”¨å…„å¼Ÿé€‰æ‹©å™¨ (General Sibling Selector)"></a>4. é€šç”¨å…„å¼Ÿé€‰æ‹©å™¨ (General Sibling Selector)</h4><ul><li><strong>ä½œç”¨</strong>ï¼šé€‰æ‹©æŸä¸ªå…ƒç´ åé¢<strong>æ‰€æœ‰</strong>çš„å…„å¼Ÿå…ƒç´ ï¼ˆä¸é™äºç´§é‚»çš„ï¼‰ã€‚</li><li><strong>è¯­æ³•</strong>ï¼š<code>element ~ sibling &#123; ... &#125;</code>ï¼Œç”¨ <code>~</code> åˆ†éš”ã€‚</li><li><strong>ç¤ºä¾‹</strong>ï¼š<ul><li><code>h1 ~ p &#123; margin-top: 0; &#125;</code>ï¼šé€‰ä¸­ <code>&lt;h1&gt;</code> åçš„æ‰€æœ‰ <code>&lt;p&gt;</code> å…ƒç´ ã€‚</li></ul></li></ul><hr><h3 id="ä¸‰ã€å±æ€§é€‰æ‹©å™¨-Attribute-Selectors"><a href="#ä¸‰ã€å±æ€§é€‰æ‹©å™¨-Attribute-Selectors" class="headerlink" title="ä¸‰ã€å±æ€§é€‰æ‹©å™¨ (Attribute Selectors)"></a>ä¸‰ã€å±æ€§é€‰æ‹©å™¨ (Attribute Selectors)</h3><p>è¿™äº›é€‰æ‹©å™¨æ ¹æ®å…ƒç´ çš„å±æ€§åŠå…¶å€¼æ¥é€‰æ‹©å…ƒç´ ã€‚</p><ul><li><strong>[attribute]</strong>ï¼šé€‰æ‹©å…·æœ‰è¯¥å±æ€§çš„å…ƒç´ ã€‚<ul><li><code>[title] &#123; ... &#125;</code>ï¼šé€‰ä¸­æ‰€æœ‰å…·æœ‰ <code>title</code> å±æ€§çš„å…ƒç´ ã€‚</li></ul></li><li><strong>[attribute&#x3D;â€valueâ€]</strong>ï¼šé€‰æ‹©å…·æœ‰ç‰¹å®šå±æ€§å’Œå€¼çš„å…ƒç´ ã€‚<ul><li><code>input[type=&quot;text&quot;] &#123; ... &#125;</code>ï¼šé€‰ä¸­æ‰€æœ‰ <code>type</code> å±æ€§å€¼ä¸º <code>text</code> çš„ <code>&lt;input&gt;</code> å…ƒç´ ã€‚</li></ul></li><li><strong>[attribute~&#x3D;â€valueâ€]</strong>ï¼šé€‰æ‹©å±æ€§å€¼ä¸­åŒ…å«ç‰¹å®š<strong>ç‹¬ç«‹å•è¯</strong>çš„å…ƒç´ ã€‚<ul><li><code>[class~=&quot;box&quot;] &#123; ... &#125;</code>ï¼šé€‰ä¸­æ‰€æœ‰ <code>class</code> å±æ€§ä¸­åŒ…å« <code>box</code> è¿™ä¸ªç‹¬ç«‹å•è¯çš„å…ƒç´ ï¼ˆå¦‚ <code>class=&quot;card box&quot;</code>ï¼‰ã€‚</li></ul></li><li><strong>[attribute|&#x3D;â€valueâ€]</strong>ï¼šé€‰æ‹©å±æ€§å€¼ä»¥ç‰¹å®šå­—ç¬¦ä¸²å¼€å¤´ï¼ˆåè·Ÿè¿å­—ç¬¦ <code>-</code>ï¼‰çš„å…ƒç´ ã€‚<ul><li><code>[lang|=&quot;en&quot;] &#123; ... &#125;</code>ï¼šé€‰ä¸­ <code>lang</code> å±æ€§å€¼ä¸º <code>en</code> æˆ– <code>en-us</code> ç­‰çš„å…ƒç´ ã€‚</li></ul></li><li><strong>[attribute^&#x3D;â€valueâ€]</strong>ï¼šé€‰æ‹©å±æ€§å€¼ä»¥ç‰¹å®šå­—ç¬¦ä¸²å¼€å¤´çš„å…ƒç´ ã€‚<ul><li><code>a[href^=&quot;https&quot;] &#123; ... &#125;</code>ï¼šé€‰ä¸­æ‰€æœ‰ <code>href</code> å±æ€§ä»¥ <code>https</code> å¼€å¤´çš„ <code>&lt;a&gt;</code> å…ƒç´ ã€‚</li></ul></li><li><strong>[attribute$&#x3D;â€valueâ€]</strong>ï¼šé€‰æ‹©å±æ€§å€¼ä»¥ç‰¹å®šå­—ç¬¦ä¸²ç»“å°¾çš„å…ƒç´ ã€‚<ul><li><code>img[src$=&quot;.png&quot;] &#123; ... &#125;</code>ï¼šé€‰ä¸­æ‰€æœ‰ <code>src</code> å±æ€§ä»¥ <code>.png</code> ç»“å°¾çš„ <code>&lt;img&gt;</code> å…ƒç´ ã€‚</li></ul></li><li><strong>[attribute*&#x3D;â€valueâ€]</strong>ï¼šé€‰æ‹©å±æ€§å€¼ä¸­åŒ…å«ç‰¹å®šå­—ç¬¦ä¸²çš„å…ƒç´ ã€‚<ul><li><code>[title*=&quot;hello&quot;] &#123; ... &#125;</code>ï¼šé€‰ä¸­æ‰€æœ‰ <code>title</code> å±æ€§å€¼ä¸­åŒ…å« <code>hello</code> çš„å…ƒç´ ã€‚</li></ul></li></ul><hr><h3 id="å››ã€ä¼ªç±»é€‰æ‹©å™¨-Pseudo-class-Selectors"><a href="#å››ã€ä¼ªç±»é€‰æ‹©å™¨-Pseudo-class-Selectors" class="headerlink" title="å››ã€ä¼ªç±»é€‰æ‹©å™¨ (Pseudo-class Selectors)"></a>å››ã€ä¼ªç±»é€‰æ‹©å™¨ (Pseudo-class Selectors)</h3><p>ä¼ªç±»ç”¨äºé€‰æ‹©å…ƒç´ çš„<strong>ç‰¹å®šçŠ¶æ€</strong>ã€‚</p><ul><li><strong>a:link</strong>ï¼šæœªè®¿é—®çš„é“¾æ¥ã€‚</li><li><strong>a:visited</strong>ï¼šå·²è®¿é—®çš„é“¾æ¥ã€‚</li><li><strong>a:hover</strong>ï¼šé¼ æ ‡æ‚¬åœåœ¨å…ƒç´ ä¸Šã€‚</li><li><strong>a:active</strong>ï¼šå…ƒç´ è¢«ç‚¹å‡»æ—¶ã€‚</li><li><strong>element:focus</strong>ï¼šå…ƒç´ è·å¾—ç„¦ç‚¹æ—¶ï¼ˆå¸¸ç”¨äºè¡¨å•ï¼‰ã€‚</li><li><strong>:nth-child(n)</strong>ï¼šé€‰æ‹©å±äºå…¶çˆ¶å…ƒç´ çš„ç¬¬ n ä¸ªå­å…ƒç´ ã€‚</li><li><strong>:first-child</strong>ï¼šé€‰æ‹©å±äºå…¶çˆ¶å…ƒç´ çš„ç¬¬ä¸€ä¸ªå­å…ƒç´ ã€‚</li><li><strong>:last-child</strong>ï¼šé€‰æ‹©å±äºå…¶çˆ¶å…ƒç´ çš„æœ€åä¸€ä¸ªå­å…ƒç´ ã€‚</li><li><strong>:not(selector)</strong>ï¼šé€‰æ‹©ä¸åŒ¹é…æŒ‡å®šé€‰æ‹©å™¨çš„å…ƒç´ ã€‚</li><li><strong>:empty</strong>ï¼šé€‰æ‹©æ²¡æœ‰å­å…ƒç´ æˆ–æ–‡æœ¬å†…å®¹çš„å…ƒç´ ã€‚</li></ul><hr><h3 id="äº”ã€ä¼ªå…ƒç´ é€‰æ‹©å™¨-Pseudo-element-Selectors"><a href="#äº”ã€ä¼ªå…ƒç´ é€‰æ‹©å™¨-Pseudo-element-Selectors" class="headerlink" title="äº”ã€ä¼ªå…ƒç´ é€‰æ‹©å™¨ (Pseudo-element Selectors)"></a>äº”ã€ä¼ªå…ƒç´ é€‰æ‹©å™¨ (Pseudo-element Selectors)</h3><p>ä¼ªå…ƒç´ ç”¨äºé€‰æ‹©å…ƒç´ çš„<strong>ç‰¹å®šéƒ¨åˆ†</strong>ã€‚</p><ul><li><strong>::first-line</strong>ï¼šé€‰æ‹©å…ƒç´ çš„ç¬¬ä¸€è¡Œã€‚</li><li><strong>::first-letter</strong>ï¼šé€‰æ‹©å…ƒç´ çš„é¦–ä¸ªå­—æ¯ã€‚</li><li><strong>::before</strong>ï¼šåœ¨å…ƒç´ çš„å†…å®¹å‰é¢æ’å…¥ç”Ÿæˆçš„å†…å®¹ã€‚</li><li><strong>::after</strong>ï¼šåœ¨å…ƒç´ çš„å†…å®¹åé¢æ’å…¥ç”Ÿæˆçš„å†…å®¹ã€‚</li></ul><hr><h3 id="ä¼˜å…ˆçº§ä¸å±‚å "><a href="#ä¼˜å…ˆçº§ä¸å±‚å " class="headerlink" title="ä¼˜å…ˆçº§ä¸å±‚å "></a>ä¼˜å…ˆçº§ä¸å±‚å </h3><p>å½“å¤šä¸ªé€‰æ‹©å™¨é€‰ä¸­åŒä¸€ä¸ªå…ƒç´ å¹¶åº”ç”¨ä¸åŒçš„æ ·å¼æ—¶ï¼Œæµè§ˆå™¨ä¼šæ ¹æ®**ä¼˜å…ˆçº§ï¼ˆSpecificityï¼‰**æ¥å†³å®šæœ€ç»ˆæ ·å¼ã€‚</p><ul><li><strong>ä¼˜å…ˆçº§è®¡ç®—</strong>ï¼š<ul><li><code>!important</code>ï¼šæœ€é«˜ä¼˜å…ˆçº§ã€‚</li><li><strong>è¡Œå†…æ ·å¼</strong>ï¼š1000</li><li><strong>ID é€‰æ‹©å™¨</strong>ï¼š100</li><li><strong>ç±»ã€å±æ€§ã€ä¼ªç±»é€‰æ‹©å™¨</strong>ï¼š10</li><li><strong>å…ƒç´ ã€ä¼ªå…ƒç´ é€‰æ‹©å™¨</strong>ï¼š1</li><li><strong>é€šç”¨é€‰æ‹©å™¨</strong>ï¼š0</li></ul></li><li><strong>ä¸¾ä¾‹</strong>ï¼š<ul><li><code>p &#123; color: red; &#125;</code>ï¼ˆä¼˜å…ˆçº§ 1ï¼‰</li><li><code>.highlight &#123; color: blue; &#125;</code>ï¼ˆä¼˜å…ˆçº§ 10ï¼‰</li><li><code>#main p &#123; color: green; &#125;</code>ï¼ˆä¼˜å…ˆçº§ 101ï¼‰</li></ul></li></ul><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå³ä½¿ <code>p</code> çš„æ ·å¼æœ€å…ˆå£°æ˜ï¼Œä½† <code>main p</code> çš„ä¼˜å…ˆçº§æœ€é«˜ï¼Œå› æ­¤ <code>&lt;p id=&quot;main&quot;&gt;</code> çš„å­—ä½“é¢œè‰²æœ€ç»ˆä¼šæ˜¯ç»¿è‰²ã€‚</p><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ¥å…¨é¢ã€æ·±å…¥åœ°ä»‹ç» Mavenï¼Œå¹¶å‰–æä¸€äº›å…³é”®ç»†èŠ‚ä»¥åŠé¢è¯•ä¸­å¯èƒ½é‡åˆ°çš„é—®é¢˜ã€‚</p><hr><h3 id="ä¸€ã€Maven-æ ¸å¿ƒæ¦‚å¿µ"><a href="#ä¸€ã€Maven-æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="ä¸€ã€Maven æ ¸å¿ƒæ¦‚å¿µ"></a>ä¸€ã€Maven æ ¸å¿ƒæ¦‚å¿µ</h3><h4 id="1-ä»€ä¹ˆæ˜¯-Mavenï¼Ÿ"><a href="#1-ä»€ä¹ˆæ˜¯-Mavenï¼Ÿ" class="headerlink" title="1. ä»€ä¹ˆæ˜¯ Mavenï¼Ÿ"></a>1. ä»€ä¹ˆæ˜¯ Mavenï¼Ÿ</h4><p>Maven æ˜¯ä¸€ä¸ª<strong>é¡¹ç›®ç®¡ç†å’Œæ„å»ºè‡ªåŠ¨åŒ–å·¥å…·</strong>ã€‚å®ƒæä¾›äº†ä¸€å¥—æ ‡å‡†åŒ–çš„é¡¹ç›®ç»“æ„ã€ç»Ÿä¸€çš„æ„å»ºç”Ÿå‘½å‘¨æœŸï¼Œå¹¶ä¾èµ–äºä¸€ä¸ª<strong>ä¸­å¤®ä»“åº“</strong>æ¥ç®¡ç†é¡¹ç›®æ‰€éœ€çš„ä¾èµ–ã€‚</p><p>å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯**â€œçº¦å®šä¼˜äºé…ç½®â€ï¼ˆConvention over Configurationï¼‰**ï¼Œè¿™æ„å‘³ç€å®ƒæœ‰ä¸€å¥—é»˜è®¤çš„é¡¹ç›®ç›®å½•ç»“æ„å’Œæ„å»ºæµç¨‹ã€‚åªè¦ä½ éµå¾ªè¿™äº›çº¦å®šï¼Œå°±å¯ä»¥ç”¨å¾ˆå°‘çš„é…ç½®å®Œæˆå¤æ‚çš„æ„å»ºä»»åŠ¡ã€‚</p><h4 id="2-ä¸ºä»€ä¹ˆéœ€è¦-Mavenï¼Ÿ"><a href="#2-ä¸ºä»€ä¹ˆéœ€è¦-Mavenï¼Ÿ" class="headerlink" title="2. ä¸ºä»€ä¹ˆéœ€è¦ Mavenï¼Ÿ"></a>2. ä¸ºä»€ä¹ˆéœ€è¦ Mavenï¼Ÿ</h4><p>åœ¨ Maven å‡ºç°ä¹‹å‰ï¼ŒJava é¡¹ç›®çš„æ„å»ºéå¸¸æ··ä¹±ï¼š</p><ul><li><strong>é¡¹ç›®ç»“æ„ä¸ç»Ÿä¸€</strong>ï¼šæ¯ä¸ªé¡¹ç›®éƒ½æœ‰è‡ªå·±çš„ç›®å½•ç»“æ„ï¼Œæ–°æˆå‘˜éœ€è¦èŠ±æ—¶é—´ç†Ÿæ‚‰ã€‚</li><li><strong>ä¾èµ–ç®¡ç†æ··ä¹±</strong>ï¼šéœ€è¦æ‰‹åŠ¨ä¸‹è½½æ‰€æœ‰ JAR åŒ…ï¼Œå¹¶æ·»åŠ åˆ°é¡¹ç›®ä¸­ï¼Œéå¸¸å®¹æ˜“å‡ºé”™ã€‚</li><li><strong>æ„å»ºè¿‡ç¨‹ä¸ç»Ÿä¸€</strong>ï¼šç¼–è¯‘ã€æµ‹è¯•ã€æ‰“åŒ…ç­‰æ“ä½œéœ€è¦æ‰‹åŠ¨æ‰§è¡Œè„šæœ¬ï¼Œæ•ˆç‡ä½ä¸‹ã€‚</li></ul><p>Maven é€šè¿‡<strong>æ ‡å‡†åŒ–</strong>è§£å†³äº†è¿™äº›é—®é¢˜ï¼š</p><ul><li><strong>æ ‡å‡†åŒ–çš„é¡¹ç›®ç»“æ„</strong>ï¼šæ‰€æœ‰ Maven é¡¹ç›®éƒ½éµå¾ªç›¸åŒçš„ç›®å½•ç»“æ„ï¼Œå¦‚ <code>src/main/java</code>ã€<code>src/test/java</code> ç­‰ã€‚</li><li><strong>ç»Ÿä¸€çš„ä¾èµ–ç®¡ç†</strong>ï¼šé€šè¿‡åœ¨ <code>pom.xml</code> ä¸­å£°æ˜ä¾èµ–ï¼ŒMaven ä¼šè‡ªåŠ¨ä»ä»“åº“ä¸‹è½½å¹¶ç®¡ç†ã€‚</li><li><strong>æ ‡å‡†åŒ–çš„æ„å»ºç”Ÿå‘½å‘¨æœŸ</strong>ï¼šå®šä¹‰äº†ä¸€ç³»åˆ—æ ‡å‡†çš„æ„å»ºé˜¶æ®µï¼ˆå¦‚ <code>compile</code>, <code>test</code>, <code>package</code>ï¼‰ï¼Œå¯ä»¥ä¸€é”®æ‰§è¡Œã€‚</li></ul><hr><h3 id="äºŒã€Maven-çš„æ ¸å¿ƒç»„æˆéƒ¨åˆ†"><a href="#äºŒã€Maven-çš„æ ¸å¿ƒç»„æˆéƒ¨åˆ†" class="headerlink" title="äºŒã€Maven çš„æ ¸å¿ƒç»„æˆéƒ¨åˆ†"></a>äºŒã€Maven çš„æ ¸å¿ƒç»„æˆéƒ¨åˆ†</h3><h4 id="1-POM-Project-Object-Model"><a href="#1-POM-Project-Object-Model" class="headerlink" title="1. POM (Project Object Model)"></a>1. POM (Project Object Model)</h4><ul><li><strong>æ¦‚å¿µ</strong>ï¼š<code>pom.xml</code> æ–‡ä»¶æ˜¯ Maven é¡¹ç›®çš„<strong>æ ¸å¿ƒé…ç½®æ–‡ä»¶</strong>ã€‚å®ƒå®šä¹‰äº†é¡¹ç›®çš„å…ƒæ•°æ®ã€ä¾èµ–ã€æ’ä»¶ã€æ„å»ºé…ç½®ç­‰æ‰€æœ‰ä¿¡æ¯ã€‚</li><li><strong>é‡è¦æ ‡ç­¾</strong>ï¼š<ul><li><code>&lt;project&gt;</code>ï¼šæ ¹å…ƒç´ ã€‚</li><li><code>&lt;groupId&gt;</code>, <code>&lt;artifactId&gt;</code>, <code>&lt;version&gt;</code>ï¼šé¡¹ç›®çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œé€šå¸¸ç§°ä¸º <strong>GAV åæ ‡</strong>ã€‚</li><li><code>&lt;packaging&gt;</code>ï¼šæ‰“åŒ…ç±»å‹ï¼Œå¦‚ <code>jar</code>, <code>war</code>, <code>pom</code>ã€‚</li><li><code>&lt;dependencies&gt;</code>ï¼šå®šä¹‰é¡¹ç›®æ‰€éœ€çš„ä¾èµ–ã€‚</li><li><code>&lt;parent&gt;</code>ï¼šç»§æ‰¿çˆ¶ POMï¼Œå®ç°ä¾èµ–çš„ç»Ÿä¸€ç®¡ç†ã€‚</li><li><code>&lt;build&gt;</code>ï¼šå®šä¹‰æ„å»ºè¿‡ç¨‹ï¼Œå¦‚æ’ä»¶é…ç½®ã€‚</li></ul></li></ul><h4 id="2-ä¾èµ–ç®¡ç†-Dependency-Management"><a href="#2-ä¾èµ–ç®¡ç†-Dependency-Management" class="headerlink" title="2. ä¾èµ–ç®¡ç† (Dependency Management)"></a>2. ä¾èµ–ç®¡ç† (Dependency Management)</h4><ul><li><strong>æ¦‚å¿µ</strong>ï¼šé€šè¿‡åœ¨ <code>&lt;dependencies&gt;</code> ä¸­å®šä¹‰ GAV åæ ‡ï¼ŒMaven ä¼šè‡ªåŠ¨ä»æœ¬åœ°æˆ–è¿œç¨‹ä»“åº“ä¸‹è½½ä¾èµ–ã€‚</li><li><strong>ä¼ é€’æ€§ä¾èµ–</strong>ï¼šå¦‚æœä½ çš„é¡¹ç›®ä¾èµ– Aï¼ŒA åˆä¾èµ– Bï¼ŒMaven ä¼šè‡ªåŠ¨å°† B ä¹Ÿä¸‹è½½ä¸‹æ¥ã€‚è¿™æ˜¯å…¶å¼ºå¤§çš„åœ°æ–¹ï¼Œä½†æœ‰æ—¶ä¹Ÿå¯èƒ½å¯¼è‡´ç‰ˆæœ¬å†²çªã€‚</li><li><strong><dependencyManagement></strong>ï¼šè¿™æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„æ ‡ç­¾ï¼Œé€šå¸¸åœ¨<strong>çˆ¶ POM</strong> ä¸­ä½¿ç”¨ã€‚å®ƒåªå®šä¹‰ä¾èµ–çš„ç‰ˆæœ¬ï¼Œä½†<strong>ä¸å®é™…å¼•å…¥</strong>ã€‚å­é¡¹ç›®ç»§æ‰¿åï¼Œåªéœ€å£°æ˜ <code>&lt;artifactId&gt;</code> å’Œ <code>&lt;groupId&gt;</code>ï¼Œç‰ˆæœ¬å·ä¼šè‡ªåŠ¨ç»§æ‰¿ï¼Œè¿™èƒ½ç¡®ä¿æ•´ä¸ªé¡¹ç›®æ‰€æœ‰æ¨¡å—çš„ä¾èµ–ç‰ˆæœ¬ä¸€è‡´ã€‚</li></ul><h4 id="3-ä»“åº“-Repositories"><a href="#3-ä»“åº“-Repositories" class="headerlink" title="3. ä»“åº“ (Repositories)"></a>3. ä»“åº“ (Repositories)</h4><p>Maven ä»“åº“æ˜¯ç”¨æ¥å­˜æ”¾æ‰€æœ‰ä¾èµ– JAR åŒ…çš„åœ°æ–¹ã€‚å®ƒåˆ†ä¸ºä¸‰ç§ï¼š</p><ul><li><strong>æœ¬åœ°ä»“åº“ (Local Repository)</strong>ï¼š<code>~/.m2/repository</code>ï¼Œé¦–æ¬¡ä¸‹è½½çš„ä¾èµ–ä¼šå­˜æ”¾åœ¨è¿™é‡Œï¼Œåç»­æ„å»ºæ—¶ä¼šä¼˜å…ˆä»è¿™é‡Œè¯»å–ã€‚</li><li><strong>è¿œç¨‹ä»“åº“ (Remote Repository)</strong>ï¼š<ul><li><strong>ä¸­å¤®ä»“åº“ (Central Repository)</strong>ï¼šMaven å®˜æ–¹ç»´æŠ¤çš„å…¬å…±ä»“åº“ï¼ŒåŒ…å«äº†ç»å¤§å¤šæ•°å¸¸ç”¨çš„å¼€æºåº“ã€‚</li><li><strong>ç§æœ (Private Repository)</strong>ï¼šä¼ä¸šå†…éƒ¨æ­å»ºçš„ä»“åº“ï¼Œç”¨äºå­˜æ”¾å…¬å¸å†…éƒ¨çš„ JAR åŒ…æˆ–ä½œä¸ºä¸­å¤®ä»“åº“çš„ä»£ç†ï¼ŒåŠ å¿«ä¸‹è½½é€Ÿåº¦ã€‚</li></ul></li></ul><h4 id="4-ç”Ÿå‘½å‘¨æœŸä¸é˜¶æ®µ-Lifecycle-Phases"><a href="#4-ç”Ÿå‘½å‘¨æœŸä¸é˜¶æ®µ-Lifecycle-Phases" class="headerlink" title="4. ç”Ÿå‘½å‘¨æœŸä¸é˜¶æ®µ (Lifecycle &amp; Phases)"></a>4. ç”Ÿå‘½å‘¨æœŸä¸é˜¶æ®µ (Lifecycle &amp; Phases)</h4><p>Maven æœ‰ä¸€å¥—æ ‡å‡†çš„æ„å»ºç”Ÿå‘½å‘¨æœŸï¼Œåˆ†ä¸ºä¸‰ä¸ªï¼š</p><ul><li><strong>clean</strong>ï¼šæ¸…ç†é¡¹ç›®ã€‚<ul><li><code>clean</code>ï¼šåˆ é™¤ <code>target</code> ç›®å½•ã€‚</li></ul></li><li><strong>default</strong>ï¼šæ„å»ºé¡¹ç›®ã€‚<ul><li><code>validate</code></li><li><code>compile</code>ï¼šç¼–è¯‘æºä»£ç ã€‚</li><li><code>test</code>ï¼šè¿è¡Œæµ‹è¯•ã€‚</li><li><code>package</code>ï¼šæ‰“åŒ…ã€‚</li><li><code>install</code>ï¼šå®‰è£…åˆ°æœ¬åœ°ä»“åº“ã€‚</li><li><code>deploy</code>ï¼šéƒ¨ç½²åˆ°è¿œç¨‹ä»“åº“ã€‚</li></ul></li><li><strong>site</strong>ï¼šç”Ÿæˆé¡¹ç›®ç«™ç‚¹ã€‚</li></ul><p><strong>é‡è¦è§„åˆ™</strong>ï¼šæ‰§è¡ŒæŸä¸ªé˜¶æ®µæ—¶ï¼Œå®ƒä¹‹å‰çš„æ‰€æœ‰é˜¶æ®µéƒ½ä¼šæŒ‰é¡ºåºæ‰§è¡Œã€‚ä¾‹å¦‚ï¼Œ<code>mvn package</code> ä¼šè‡ªåŠ¨æ‰§è¡Œ <code>compile</code> å’Œ <code>test</code>ã€‚</p><hr><h3 id="ä¸‰ã€é¢è¯•å¸¸è§é—®é¢˜ä¸å›ç­”æŠ€å·§"><a href="#ä¸‰ã€é¢è¯•å¸¸è§é—®é¢˜ä¸å›ç­”æŠ€å·§" class="headerlink" title="ä¸‰ã€é¢è¯•å¸¸è§é—®é¢˜ä¸å›ç­”æŠ€å·§"></a>ä¸‰ã€é¢è¯•å¸¸è§é—®é¢˜ä¸å›ç­”æŠ€å·§</h3><h4 id="1-Maven-çš„-GAV-åæ ‡æ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ"><a href="#1-Maven-çš„-GAV-åæ ‡æ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ" class="headerlink" title="1. Maven çš„ GAV åæ ‡æ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ"></a>1. Maven çš„ GAV åæ ‡æ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</h4><ul><li><strong>å›ç­”</strong>ï¼šGAV åæ ‡æ˜¯ Maven é¡¹ç›®çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç”± <code>&lt;groupId&gt;</code>, <code>&lt;artifactId&gt;</code>, å’Œ <code>&lt;version&gt;</code> ä¸‰ä¸ªå…ƒç´ ç»„æˆã€‚</li><li><strong>ä½œç”¨</strong>ï¼š<ul><li><strong>å”¯ä¸€æ€§</strong>ï¼šç¡®ä¿æ¯ä¸ªé¡¹ç›®å’Œæ¯ä¸ªç‰ˆæœ¬çš„ä¾èµ–åœ¨ä»“åº“ä¸­éƒ½æ˜¯å”¯ä¸€çš„ã€‚</li><li><strong>å®šä½</strong>ï¼šMaven é€šè¿‡ GAV åæ ‡æ¥æŸ¥æ‰¾å’Œä¸‹è½½ä¾èµ–ã€‚</li><li><strong>ä¼ é€’æ€§</strong>ï¼šåœ¨ä¼ é€’æ€§ä¾èµ–ä¸­ï¼Œé€šè¿‡ GAV åæ ‡æ¥è¯†åˆ«å’Œå¤„ç†ä¾èµ–å…³ç³»ã€‚</li></ul></li></ul><h4 id="2-å’Œ-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#2-å’Œ-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="2. &lt;dependencyManagement&gt; å’Œ &lt;dependencies&gt; æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>2. <code>&lt;dependencyManagement&gt;</code> å’Œ <code>&lt;dependencies&gt;</code> æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h4><ul><li><strong>å›ç­”</strong>ï¼šè¿™æ˜¯é¢è¯•é«˜é¢‘é—®é¢˜ï¼Œéœ€è¦æ¸…æ™°åœ°è¯´æ˜ä¸¤è€…çš„èŒè´£ã€‚</li><li><strong><dependencies></strong>ï¼š<strong>å®é™…å¼•å…¥</strong>ä¾èµ–ã€‚å®ƒç”¨äºåœ¨å½“å‰é¡¹ç›®ä¸­æ·»åŠ ä¸€ä¸ªå…·ä½“çš„ä¾èµ–ï¼ŒMaven ä¼šç«‹å³ä¸‹è½½å¹¶ä½¿ç”¨å®ƒã€‚</li><li><strong><dependencyManagement></strong>ï¼š<strong>åªå®šä¹‰ç‰ˆæœ¬</strong>ã€‚å®ƒåªå£°æ˜ä¾èµ–çš„ç‰ˆæœ¬ï¼Œä½†<strong>ä¸å®é™…å¼•å…¥</strong>ã€‚å…¶ä¸»è¦ç›®çš„æ˜¯<strong>ç»Ÿä¸€ç®¡ç†å­æ¨¡å—çš„ä¾èµ–ç‰ˆæœ¬</strong>ã€‚å­æ¨¡å—ç»§æ‰¿çˆ¶ POM åï¼Œåªéœ€åœ¨è‡ªå·±çš„ <code>&lt;dependencies&gt;</code> ä¸­å£°æ˜ <code>&lt;groupId&gt;</code> å’Œ <code>&lt;artifactId&gt;</code>ï¼Œç‰ˆæœ¬å·ä¼šè‡ªåŠ¨ä»çˆ¶ POM ä¸­ç»§æ‰¿ï¼Œè¿™é¿å…äº†ç‰ˆæœ¬ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</li></ul><h4 id="3-ä»€ä¹ˆæ˜¯-Maven-çš„ç”Ÿå‘½å‘¨æœŸï¼Ÿmvn-install-å’Œ-mvn-deploy-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#3-ä»€ä¹ˆæ˜¯-Maven-çš„ç”Ÿå‘½å‘¨æœŸï¼Ÿmvn-install-å’Œ-mvn-deploy-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="3. ä»€ä¹ˆæ˜¯ Maven çš„ç”Ÿå‘½å‘¨æœŸï¼Ÿmvn install å’Œ mvn deploy æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>3. ä»€ä¹ˆæ˜¯ Maven çš„ç”Ÿå‘½å‘¨æœŸï¼Ÿ<code>mvn install</code> å’Œ <code>mvn deploy</code> æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h4><ul><li><strong>å›ç­”</strong>ï¼š</li><li><strong>ç”Ÿå‘½å‘¨æœŸ</strong>ï¼šMaven æœ‰ä¸‰ä¸ªæ ‡å‡†çš„ç”Ÿå‘½å‘¨æœŸï¼š<code>clean</code>ã€<code>default</code> å’Œ <code>site</code>ã€‚å…¶ä¸­ <code>default</code> åŒ…å«äº†ä»ç¼–è¯‘åˆ°éƒ¨ç½²çš„æ‰€æœ‰é˜¶æ®µã€‚</li><li><strong>mvn install</strong>ï¼šæ‰§è¡Œ <code>default</code> ç”Ÿå‘½å‘¨æœŸåˆ° <code>install</code> é˜¶æ®µã€‚å®ƒä¼šå°†é¡¹ç›®æ‰“åŒ…ï¼Œå¹¶å®‰è£…åˆ°<strong>æœ¬åœ°ä»“åº“</strong>ã€‚è¿™æ ·ï¼Œå…¶ä»–æœ¬åœ°é¡¹ç›®å°±å¯ä»¥ä¾èµ–è¿™ä¸ªåŒ…ã€‚</li><li><strong>mvn deploy</strong>ï¼šæ‰§è¡Œ <code>default</code> ç”Ÿå‘½å‘¨æœŸåˆ° <code>deploy</code> é˜¶æ®µã€‚å®ƒä¼šå°†é¡¹ç›®æ‰“åŒ…ï¼Œå¹¶éƒ¨ç½²åˆ°<strong>è¿œç¨‹ä»“åº“</strong>ï¼ˆç§æœæˆ–ä¸­å¤®ä»“åº“ï¼‰ã€‚è¿™ä½¿å¾—å…¶ä»–å›¢é˜Ÿæˆå‘˜æˆ–é¡¹ç›®å¯ä»¥ä»è¿œç¨‹ä»“åº“è·å–å¹¶ä½¿ç”¨è¿™ä¸ªåŒ…ã€‚</li></ul><h4 id="4-Maven-ä¾èµ–å†²çªå¦‚ä½•è§£å†³ï¼Ÿ"><a href="#4-Maven-ä¾èµ–å†²çªå¦‚ä½•è§£å†³ï¼Ÿ" class="headerlink" title="4. Maven ä¾èµ–å†²çªå¦‚ä½•è§£å†³ï¼Ÿ"></a>4. Maven ä¾èµ–å†²çªå¦‚ä½•è§£å†³ï¼Ÿ</h4><ul><li><strong>å›ç­”</strong>ï¼šå½“å¤šä¸ªä¾èµ–é—´æ¥å¼•å…¥äº†åŒä¸€ä¸ªåº“çš„ä¸åŒç‰ˆæœ¬æ—¶ï¼Œå°±ä¼šå‘ç”Ÿä¾èµ–å†²çªã€‚</li><li><strong>è§£å†³ç­–ç•¥</strong>ï¼š<ul><li><strong>ä¾èµ–è°ƒè§£ï¼ˆDependency Mediationï¼‰</strong>ï¼šMaven çš„é»˜è®¤è§„åˆ™æ˜¯â€œ<strong>è·¯å¾„æœ€çŸ­è€…ä¼˜å…ˆ</strong>â€ã€‚å³åœ¨ä¾èµ–æ ‘ä¸­ï¼Œè·¯å¾„æœ€çŸ­çš„é‚£ä¸ªç‰ˆæœ¬ä¼šè¢«é€‰ä¸­ã€‚</li><li><strong>æ‰‹åŠ¨æ’é™¤ï¼ˆExclusionï¼‰</strong>ï¼šå¦‚æœé»˜è®¤è§„åˆ™ä¸èƒ½è§£å†³é—®é¢˜ï¼Œå¯ä»¥åœ¨ <code>&lt;dependency&gt;</code> æ ‡ç­¾å†…ä½¿ç”¨ <code>&lt;exclusions&gt;</code> æ ‡ç­¾æ‰‹åŠ¨æ’é™¤æœ‰é—®é¢˜çš„ä¼ é€’æ€§ä¾èµ–ã€‚</li><li><strong>æ‰‹åŠ¨å¼•å…¥ï¼ˆDeclarationï¼‰</strong>ï¼šåœ¨ <code>&lt;dependencies&gt;</code> ä¸­æ˜ç¡®å£°æ˜éœ€è¦ä½¿ç”¨çš„ç‰ˆæœ¬ã€‚Maven çš„å¦ä¸€ä¸ªè§„åˆ™æ˜¯â€œ<strong>æœ€è¿‘å£°æ˜è€…ä¼˜å…ˆ</strong>â€ï¼Œå³å¦‚æœä¸¤ä¸ªä¾èµ–è·¯å¾„é•¿åº¦ç›¸åŒï¼Œå…ˆå£°æ˜çš„é‚£ä¸ªä¼šè¢«ä½¿ç”¨ã€‚ä½†æ›´å¥½çš„åšæ³•æ˜¯ç›´æ¥åœ¨çˆ¶ POM çš„ <code>&lt;dependencyManagement&gt;</code> ä¸­ç»Ÿä¸€ç‰ˆæœ¬ã€‚</li></ul></li></ul><p>å¥½çš„ï¼Œæˆ‘ä»¬æ¥è¯¦ç»†æ¢³ç†ä½ æä¾›çš„è¿™ä»½å…³äºä¼šè¯æŠ€æœ¯çš„ç¬”è®°ï¼Œå¹¶æŒ‰ç…§ä½ è¦æ±‚çš„é€»è¾‘ï¼Œä»¥ä¸€ç§æ›´æ¸…æ™°ã€æ›´ä¸“ä¸šçš„é¢è¯•å›ç­”æˆ–æŠ€æœ¯è®²è§£çš„æ–¹å¼è¿›è¡Œé‡æ–°ç»„ç»‡å’Œè¡¥å……ã€‚</p><hr><h3 id="ä¸€ã€ä¼šè¯æŠ€æœ¯æ¦‚è¿°ï¼šè§£å†³-HTTP-æ— çŠ¶æ€é—®é¢˜"><a href="#ä¸€ã€ä¼šè¯æŠ€æœ¯æ¦‚è¿°ï¼šè§£å†³-HTTP-æ— çŠ¶æ€é—®é¢˜" class="headerlink" title="ä¸€ã€ä¼šè¯æŠ€æœ¯æ¦‚è¿°ï¼šè§£å†³ HTTP æ— çŠ¶æ€é—®é¢˜"></a>ä¸€ã€ä¼šè¯æŠ€æœ¯æ¦‚è¿°ï¼šè§£å†³ HTTP æ— çŠ¶æ€é—®é¢˜</h3><p>HTTP åè®®æœ¬èº«æ˜¯æ— çŠ¶æ€çš„ï¼Œå®ƒä¸è®°å¾—ä¸Šä¸€æ¬¡è¯·æ±‚çš„ä»»ä½•ä¿¡æ¯ã€‚ä¸ºäº†åœ¨å¤šæ¬¡è¯·æ±‚ä¹‹é—´å…±äº«æ•°æ®å¹¶è¯†åˆ«ç”¨æˆ·ï¼Œå¼•å…¥äº†ä¸¤ç§æ ¸å¿ƒçš„ä¼šè¯æŠ€æœ¯ï¼šå®¢æˆ·ç«¯ä¼šè¯ï¼ˆCookieï¼‰å’ŒæœåŠ¡å™¨ç«¯ä¼šè¯ï¼ˆSessionï¼‰ã€‚</p><h3 id="äºŒã€å®¢æˆ·ç«¯ä¼šè¯ï¼šCookie"><a href="#äºŒã€å®¢æˆ·ç«¯ä¼šè¯ï¼šCookie" class="headerlink" title="äºŒã€å®¢æˆ·ç«¯ä¼šè¯ï¼šCookie"></a>äºŒã€å®¢æˆ·ç«¯ä¼šè¯ï¼šCookie</h3><p><strong>æ ¸å¿ƒæ¦‚å¿µ</strong>ï¼šCookie æ˜¯æœåŠ¡å™¨å‘é€ç»™æµè§ˆå™¨å¹¶å­˜å‚¨åœ¨å®¢æˆ·ç«¯çš„ä¸€å°æ®µæ–‡æœ¬ä¿¡æ¯ã€‚æµè§ˆå™¨åœ¨ä¸‹æ¬¡è®¿é—®åŒä¸€æœåŠ¡å™¨æ—¶ä¼šè‡ªåŠ¨å°†è¯¥ Cookie æºå¸¦åœ¨è¯·æ±‚ä¸­ã€‚</p><h4 id="1-å…³äº-Cookie-çš„å‡ ä¸ªå¸¸è§é—®é¢˜"><a href="#1-å…³äº-Cookie-çš„å‡ ä¸ªå¸¸è§é—®é¢˜" class="headerlink" title="1. å…³äº Cookie çš„å‡ ä¸ªå¸¸è§é—®é¢˜"></a>1. å…³äº Cookie çš„å‡ ä¸ªå¸¸è§é—®é¢˜</h4><ul><li><strong>ä¸€æ¬¡è¯·æ±‚å“åº”å¯ä»¥å‘é€å¤šä¸ª Cookie å—ï¼Ÿ</strong><ul><li><strong>å›ç­”</strong>ï¼š<strong>å¯ä»¥</strong>ã€‚æœåŠ¡å™¨å¯ä»¥åœ¨ä¸€ä¸ªå“åº”ä¸­é€šè¿‡å¤šä¸ª <code>Set-Cookie</code> å“åº”å¤´æ¥è®¾ç½®å¤šä¸ª Cookieã€‚æµè§ˆå™¨ä¼šåˆ†åˆ«å­˜å‚¨è¿™äº› Cookieï¼Œå¹¶åœ¨åç»­è¯·æ±‚ä¸­å°†å®ƒä»¬å…¨éƒ¨å‘é€ç»™æœåŠ¡å™¨ã€‚</li></ul></li><li><strong>Cookie æ”¯æŒä¸­æ–‡ä¼ è¾“å—ï¼Ÿ</strong><ul><li><strong>å›ç­”</strong>ï¼š<strong>åœ¨å¤§å¤šæ•°ç°ä»£æœåŠ¡å™¨å’Œæµè§ˆå™¨ä¸­éƒ½æ”¯æŒã€‚</strong> åœ¨æ—©æœŸçš„ Servlet å®¹å™¨ï¼ˆå¦‚ Tomcat 8.0 ä¹‹å‰ï¼‰ï¼ŒCookie ä¸èƒ½ç›´æ¥å­˜å‚¨ä¸­æ–‡ï¼Œéœ€è¦æ‰‹åŠ¨è¿›è¡Œ URL ç¼–ç ï¼ˆ<code>URLEncoder</code>ï¼‰å’Œè§£ç ï¼ˆ<code>URLDecoder</code>ï¼‰ã€‚<strong>åœ¨ Tomcat 8.0 åŠä»¥åç‰ˆæœ¬</strong>ï¼Œå®¹å™¨é»˜è®¤æ”¯æŒ UTF-8 ç¼–ç ï¼Œå¯ä»¥ç›´æ¥å­˜å‚¨ä¸­æ–‡ã€‚</li></ul></li><li><strong>Cookie çš„è¿‡æœŸæ—¶é—´å¦‚ä½•è®¾ç½®ï¼Ÿ</strong><ul><li><strong>å›ç­”</strong>ï¼šé€šè¿‡ <code>response.addCookie(cookie)</code> æ–¹æ³•ï¼Œå¹¶è°ƒç”¨ <code>cookie.setMaxAge(int expiry)</code> æ–¹æ³•æ¥è®¾ç½®ã€‚<ul><li><code>expiry &gt; 0</code>ï¼šè¡¨ç¤º Cookie å°†è¢«<strong>æŒä¹…åŒ–</strong>åˆ°å®¢æˆ·ç«¯ç¡¬ç›˜ï¼Œæœ‰æ•ˆæœŸä¸º <code>expiry</code> ç§’ã€‚å³ä½¿æµè§ˆå™¨å…³é—­ï¼ŒCookie ä¾ç„¶å­˜åœ¨ï¼Œç›´åˆ°è¿‡æœŸã€‚</li><li><code>expiry = 0</code>ï¼šè¡¨ç¤º<strong>ç«‹å³åˆ é™¤</strong>è¯¥ Cookieã€‚å¸¸ç”¨äºé€€å‡ºç™»å½•åŠŸèƒ½ã€‚</li><li><code>expiry &lt; 0</code>ï¼š<strong>é»˜è®¤å€¼</strong>ã€‚è¡¨ç¤º Cookie åªåœ¨å†…å­˜ä¸­å­˜åœ¨ï¼Œå½“<strong>æµè§ˆå™¨å…³é—­æ—¶</strong>ï¼Œè¯¥ Cookie å°±ä¼šè¢«åˆ é™¤ã€‚</li></ul></li></ul></li></ul><h4 id="2-Cookie-çš„ç‰¹ç‚¹"><a href="#2-Cookie-çš„ç‰¹ç‚¹" class="headerlink" title="2. Cookie çš„ç‰¹ç‚¹"></a>2. Cookie çš„ç‰¹ç‚¹</h4><ul><li><strong>å­˜å‚¨ä½ç½®</strong>ï¼šå­˜å‚¨åœ¨å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰ã€‚</li><li><strong>å¤§å°é™åˆ¶</strong>ï¼šå•ä¸ª Cookie æœ€å¤§çº¦ 4KBã€‚</li><li><strong>æ•°é‡é™åˆ¶</strong>ï¼šä¸€ä¸ªæœåŠ¡å™¨æœ€å¤šå¯ä»¥å‘ä¸€ä¸ªæµè§ˆå™¨ä¿å­˜ 20 ä¸ª Cookieï¼Œä¸€ä¸ªæµè§ˆå™¨æœ€å¤šå¯ä»¥ä¿å­˜ 300 ä¸ª Cookieï¼ˆè¿™äº›æ˜¯æ—©æœŸçš„è§„èŒƒï¼Œç°ä»£æµè§ˆå™¨å·²æ”¾å®½ï¼Œä½†ä»æœ‰é™åˆ¶ï¼‰ã€‚</li><li><strong>å®‰å…¨æ€§</strong>ï¼šæ•°æ®ä»¥æ˜æ–‡å½¢å¼å­˜å‚¨ï¼Œä¸”å®¹æ˜“è¢«ç”¨æˆ·ä¿®æ”¹ï¼Œå®‰å…¨æ€§è¾ƒå·®ã€‚</li></ul><h4 id="3-Cookie-æ¡ˆä¾‹ï¼šè·å–ä¸Šä¸€æ¬¡è®¿é—®æ—¶é—´"><a href="#3-Cookie-æ¡ˆä¾‹ï¼šè·å–ä¸Šä¸€æ¬¡è®¿é—®æ—¶é—´" class="headerlink" title="3. Cookie æ¡ˆä¾‹ï¼šè·å–ä¸Šä¸€æ¬¡è®¿é—®æ—¶é—´"></a>3. Cookie æ¡ˆä¾‹ï¼šè·å–ä¸Šä¸€æ¬¡è®¿é—®æ—¶é—´</h4><p>è¿™ä¸ªæ¡ˆä¾‹æ˜¯ç»å…¸çš„ Cookie ç”¨æ³•ã€‚</p><ul><li><strong>é¦–æ¬¡è®¿é—®</strong>ï¼šæœåŠ¡å™¨æ¥æ”¶è¯·æ±‚ï¼Œåˆ¤æ–­ Cookie ä¸­æ²¡æœ‰è®°å½•ä¸Šæ¬¡è®¿é—®æ—¶é—´ã€‚æœåŠ¡å™¨åˆ›å»ºä¸€ä¸ªæ–°çš„ Cookieï¼Œå­˜å‚¨å½“å‰æ—¶é—´ï¼Œå¹¶å°†å…¶å‘é€ç»™æµè§ˆå™¨ã€‚</li><li><strong>å†æ¬¡è®¿é—®</strong>ï¼šæµè§ˆå™¨è‡ªåŠ¨å°†ä¸Šæ¬¡å­˜å‚¨çš„ Cookie å‘é€ç»™æœåŠ¡å™¨ã€‚æœåŠ¡å™¨è¯»å– Cookieï¼Œè·å–ä¸Šæ¬¡è®¿é—®æ—¶é—´ï¼Œå¹¶å°†å…¶æ˜¾ç¤ºç»™ç”¨æˆ·ã€‚ç„¶åï¼ŒæœåŠ¡å™¨å¯ä»¥æ›´æ–° Cookie çš„æ—¶é—´ï¼Œå†æ¬¡å‘é€ç»™æµè§ˆå™¨ã€‚</li></ul><h3 id="ä¸‰ã€æœåŠ¡å™¨ç«¯ä¼šè¯ï¼šHttpSession"><a href="#ä¸‰ã€æœåŠ¡å™¨ç«¯ä¼šè¯ï¼šHttpSession" class="headerlink" title="ä¸‰ã€æœåŠ¡å™¨ç«¯ä¼šè¯ï¼šHttpSession"></a>ä¸‰ã€æœåŠ¡å™¨ç«¯ä¼šè¯ï¼šHttpSession</h3><p><strong>æ ¸å¿ƒæ¦‚å¿µ</strong>ï¼šSession æ˜¯æœåŠ¡å™¨ç«¯ä¸ºæ¯ä¸ªå®¢æˆ·ç«¯åˆ›å»ºçš„ä¸€ä¸ªå¯¹è±¡ï¼Œç”¨äºåœ¨ä¸€æ¬¡ä¼šè¯çš„å¤šä¸ªè¯·æ±‚ä¹‹é—´å­˜å‚¨å’Œå…±äº«æ•°æ®ã€‚</p><h4 id="1-Session-çš„å¿«é€Ÿä½¿ç”¨"><a href="#1-Session-çš„å¿«é€Ÿä½¿ç”¨" class="headerlink" title="1. Session çš„å¿«é€Ÿä½¿ç”¨"></a>1. Session çš„å¿«é€Ÿä½¿ç”¨</h4><ul><li><strong>è·å–å¯¹è±¡</strong>ï¼šé€šè¿‡ <code>HttpServletRequest</code> å¯¹è±¡çš„ <code>getSession()</code> æ–¹æ³•æ¥è·å– <code>HttpSession</code> å¯¹è±¡ã€‚</li><li><strong>ä½¿ç”¨å¯¹è±¡ï¼ˆåŸŸå¯¹è±¡ï¼‰</strong>ï¼šSession æ˜¯ä¸€ä¸ª<strong>åŸŸå¯¹è±¡</strong>ï¼Œæä¾›äº†ä»¥ä¸‹æ–¹æ³•ï¼š<ul><li><code>void setAttribute(String name, Object value)</code>ï¼šå°†æ•°æ®ä»¥é”®å€¼å¯¹å½¢å¼å­˜å‚¨åˆ° Session ä¸­ã€‚</li><li><code>Object getAttribute(String name)</code>ï¼šæ ¹æ®é”®åè·å–å­˜å‚¨çš„æ•°æ®ã€‚</li><li><code>void removeAttribute(String name)</code>ï¼šæ ¹æ®é”®ååˆ é™¤å­˜å‚¨çš„æ•°æ®ã€‚</li></ul></li></ul><h4 id="2-Session-çš„å¤±æ•ˆæ—¶é—´"><a href="#2-Session-çš„å¤±æ•ˆæ—¶é—´" class="headerlink" title="2. Session çš„å¤±æ•ˆæ—¶é—´"></a>2. Session çš„å¤±æ•ˆæ—¶é—´</h4><ul><li><p><strong>æœåŠ¡å™¨å…³é—­</strong>ï¼šå½“æœåŠ¡å™¨å…³é—­æ—¶ï¼Œæ‰€æœ‰ Session å¯¹è±¡éƒ½ä¼šè¢«é”€æ¯ã€‚</p></li><li><p><strong>æ‰‹åŠ¨å¤±æ•ˆ</strong>ï¼šè°ƒç”¨ <code>session.invalidate()</code> æ–¹æ³•ï¼Œå¯ä»¥ç«‹å³å¼ºåˆ¶ Session å¤±æ•ˆã€‚å¸¸ç”¨äºç”¨æˆ·é€€å‡ºç™»å½•ã€‚</p></li><li><p><strong>é»˜è®¤å¤±æ•ˆæ—¶é—´</strong>ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼ŒSession æœ‰ä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œé€šå¸¸æ˜¯ 30 åˆ†é’Ÿã€‚å¦‚æœå®¢æˆ·ç«¯åœ¨ 30 åˆ†é’Ÿå†…æ²¡æœ‰å‘æœåŠ¡å™¨å‘é€ä»»ä½•è¯·æ±‚ï¼ŒSession å°±ä¼šè‡ªåŠ¨å¤±æ•ˆã€‚è¿™ä¸ªæ—¶é—´å¯ä»¥åœ¨ <code>web.xml</code> ä¸­é…ç½®ã€‚</p></li><li><p>å¯¹çš„ ğŸ‘ï¼Œåœ¨ **Java Web åº”ç”¨ï¼ˆServlet å®¹å™¨ï¼Œæ¯”å¦‚ Tomcatï¼‰**é‡Œï¼Œ<code>Session</code> çš„é»˜è®¤å¤±æ•ˆæ—¶é—´é€šå¸¸æ˜¯ <strong>30 åˆ†é’Ÿ</strong>ã€‚</p><p>è¦ä¿®æ”¹å®ƒï¼Œå¯ä»¥åœ¨ <code>web.xml</code> ä¸­é…ç½® <code>&lt;session-config&gt;</code>ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">...</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- session è¿‡æœŸæ—¶é—´è®¾ç½®ï¼ˆå•ä½ï¼šåˆ†é’Ÿï¼‰ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">session-config</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">session-timeout</span>&gt;</span>60<span class="tag">&lt;/<span class="name">session-timeout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">session-config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul><p>ğŸ“Œ è¯´æ˜ï¼š</p><ul><li><code>60</code> è¡¨ç¤º Session åœ¨ <strong>60 åˆ†é’Ÿ</strong>æ— è¯·æ±‚æ—¶ä¼šè‡ªåŠ¨å¤±æ•ˆã€‚</li><li>é»˜è®¤å€¼æ˜¯ <strong>30</strong> åˆ†é’Ÿï¼Œå¦‚æœä¸é…ç½®ï¼Œå°±èµ°é»˜è®¤ã€‚</li><li>è¿™ä¸ªé…ç½®å¯¹æ‰€æœ‰ç”¨æˆ· Session éƒ½ç”Ÿæ•ˆã€‚</li></ul><h3 id="ğŸ”§-åœ¨ä»£ç é‡ŒåŠ¨æ€è®¾ç½®ï¼ˆå•ä¸ª-Sessionï¼‰"><a href="#ğŸ”§-åœ¨ä»£ç é‡ŒåŠ¨æ€è®¾ç½®ï¼ˆå•ä¸ª-Sessionï¼‰" class="headerlink" title="ğŸ”§ åœ¨ä»£ç é‡ŒåŠ¨æ€è®¾ç½®ï¼ˆå•ä¸ª Sessionï¼‰"></a>ğŸ”§ åœ¨ä»£ç é‡ŒåŠ¨æ€è®¾ç½®ï¼ˆå•ä¸ª Sessionï¼‰</h3><p>é™¤äº†åœ¨ <code>web.xml</code> é‡Œå…¨å±€é…ç½®ï¼Œè¿˜å¯ä»¥é’ˆå¯¹æŸä¸ªç”¨æˆ·çš„ Session åŠ¨æ€ä¿®æ”¹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">session.setMaxInactiveInterval(<span class="number">120</span> * <span class="number">60</span>); <span class="comment">// å•ä½ï¼šç§’ï¼Œè¿™é‡Œæ˜¯ 2 å°æ—¶</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><h3 id="ğŸ”§-ç‰¹æ®Šæƒ…å†µ"><a href="#ğŸ”§-ç‰¹æ®Šæƒ…å†µ" class="headerlink" title="ğŸ”§ ç‰¹æ®Šæƒ…å†µ"></a>ğŸ”§ ç‰¹æ®Šæƒ…å†µ</h3><ul><li>å¦‚æœ <code>session-timeout</code> è®¾ç½®ä¸º <strong>0</strong> â†’ Session æ°¸ä¸è¶…æ—¶ï¼ˆå±é™© âš ï¸ï¼Œå®¹æ˜“å¯¼è‡´å†…å­˜æ³„éœ²ï¼‰ã€‚</li><li>å¦‚æœè®¾ç½®ä¸º <strong>è´Ÿæ•°</strong>ï¼ˆå¦‚ -1ï¼‰ â†’ è¡¨ç¤º Session ä»…åœ¨æµè§ˆå™¨å…³é—­æ—¶é”€æ¯ï¼ˆæœ‰äº›å®¹å™¨æ”¯æŒï¼Œæœ‰äº›ä¸æ”¯æŒã€‚</li></ul><h4 id="3-Session-çš„ç‰¹ç‚¹"><a href="#3-Session-çš„ç‰¹ç‚¹" class="headerlink" title="3. Session çš„ç‰¹ç‚¹"></a>3. Session çš„ç‰¹ç‚¹</h4><ul><li><strong>å­˜å‚¨ä½ç½®</strong>ï¼šå­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯ã€‚</li><li><strong>å¤§å°é™åˆ¶</strong>ï¼šå¯ä»¥å­˜å‚¨ä»»æ„ç±»å‹ã€ä»»æ„å¤§å°çš„æ•°æ®ï¼ˆå—é™äºæœåŠ¡å™¨å†…å­˜ï¼‰ã€‚</li><li><strong>å®‰å…¨æ€§</strong>ï¼šç”±äºæ•°æ®å­˜å‚¨åœ¨æœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯åªä¼ é€’ä¸€ä¸ª Session IDï¼Œå®‰å…¨æ€§ç›¸å¯¹è¾ƒé«˜ã€‚</li></ul><h4 id="4-é¢è¯•é¢˜ï¼šCookie-å’Œ-Session-çš„åŒºåˆ«ï¼Ÿ"><a href="#4-é¢è¯•é¢˜ï¼šCookie-å’Œ-Session-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="4. é¢è¯•é¢˜ï¼šCookie å’Œ Session çš„åŒºåˆ«ï¼Ÿ"></a>4. é¢è¯•é¢˜ï¼šCookie å’Œ Session çš„åŒºåˆ«ï¼Ÿ</h4><ul><li><strong>å­˜å‚¨ä½ç½®</strong>ï¼šCookie å­˜å‚¨åœ¨<strong>å®¢æˆ·ç«¯</strong>ï¼ŒSession å­˜å‚¨åœ¨<strong>æœåŠ¡å™¨ç«¯</strong>ã€‚</li><li><strong>æ•°æ®å¤§å°</strong>ï¼šCookie çš„å¤§å°<strong>æœ‰é™åˆ¶</strong>ï¼ˆçº¦ 4KBï¼‰ï¼ŒSession çš„å¤§å°<strong>æ²¡æœ‰é™åˆ¶</strong>ã€‚</li><li><strong>å®‰å…¨æ€§</strong>ï¼šSession <strong>ç›¸å¯¹å®‰å…¨</strong>ï¼ŒCookie <strong>ç›¸å¯¹ä¸å®‰å…¨</strong>ã€‚å› ä¸º Session ID éš¾ä»¥è¢«çŒœæµ‹ï¼Œè€Œ Cookie å­˜å‚¨çš„æ•°æ®æ˜¯æ˜æ–‡ã€‚</li><li><strong>æœåŠ¡å™¨å¼€é”€</strong>ï¼šSession ä¼šå ç”¨æœåŠ¡å™¨å†…å­˜ï¼Œåœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹å¯èƒ½æˆä¸ºæ€§èƒ½ç“¶é¢ˆï¼›è€Œ Cookie ä¸å ç”¨æœåŠ¡å™¨èµ„æºã€‚</li></ul><h3 id="å››ã€Servlet-ä¸‰å¤§åŸŸå¯¹è±¡çš„å…³ç³»ï¼ˆæŒ‰ç…§ä½ çš„é€»è¾‘ï¼‰"><a href="#å››ã€Servlet-ä¸‰å¤§åŸŸå¯¹è±¡çš„å…³ç³»ï¼ˆæŒ‰ç…§ä½ çš„é€»è¾‘ï¼‰" class="headerlink" title="å››ã€Servlet ä¸‰å¤§åŸŸå¯¹è±¡çš„å…³ç³»ï¼ˆæŒ‰ç…§ä½ çš„é€»è¾‘ï¼‰"></a>å››ã€Servlet ä¸‰å¤§åŸŸå¯¹è±¡çš„å…³ç³»ï¼ˆæŒ‰ç…§ä½ çš„é€»è¾‘ï¼‰</h3><p><strong>åŸŸå¯¹è±¡</strong>ï¼ˆScope Objectï¼‰æ˜¯æŒ‡é‚£äº›å¯ä»¥ç”¨æ¥åœ¨ä¸åŒç»„ä»¶ä¹‹é—´å…±äº«æ•°æ®çš„å¯¹è±¡ã€‚Servlet è§„èŒƒæä¾›äº†ä¸‰ä¸ªè¿™æ ·çš„å¯¹è±¡ï¼Œå®ƒä»¬çš„ç”Ÿå‘½å‘¨æœŸä¸åŒï¼Œä»è€Œå†³å®šäº†æ•°æ®çš„å…±äº«èŒƒå›´ã€‚</p><ul><li><strong>request åŸŸ</strong>ï¼šç”Ÿå‘½å‘¨æœŸæœ€çŸ­ã€‚æ•°æ®åªèƒ½åœ¨<strong>ä¸€æ¬¡è¯·æ±‚-å“åº”</strong>çš„å‘¨æœŸå†…å…±äº«ã€‚å³ä½¿è¯·æ±‚è¢«è½¬å‘ï¼ˆforwardï¼‰ï¼Œæ•°æ®ä¹Ÿä¾ç„¶å¯è§ã€‚</li><li><strong>session åŸŸ</strong>ï¼šç”Ÿå‘½å‘¨æœŸä¸­ç­‰ã€‚æ•°æ®å¯ä»¥åœ¨<strong>ä¸€æ¬¡ä¼šè¯</strong>ï¼ˆå¤šä¸ªè¯·æ±‚ï¼‰ä¹‹é—´å…±äº«ã€‚åªè¦æµè§ˆå™¨ä¸å…³é—­ï¼Œä¸” Session æœªè¶…æ—¶æˆ–å¤±æ•ˆï¼Œæ•°æ®å°±ä¸€ç›´å­˜åœ¨ã€‚</li><li><strong>servletContext åŸŸ</strong>ï¼šç”Ÿå‘½å‘¨æœŸæœ€é•¿ã€‚æ•°æ®å¯ä»¥åœ¨<strong>æ•´ä¸ª Web åº”ç”¨</strong>ä¸­å…±äº«ã€‚ä» Web åº”ç”¨å¯åŠ¨åˆ°å…³é—­ï¼Œæ•°æ®éƒ½ä¸€ç›´å­˜åœ¨ã€‚</li></ul><p><strong>ä¸‰å¤§åŸŸå¯¹è±¡ä¹‹é—´çš„å…³ç³»æ˜¯åŒ…å«å…³ç³»ï¼Œå³ request &lt; session &lt; servletContextã€‚</strong></p><ul><li><strong>request åŒ…å«äº session</strong>ï¼šä¸€ä¸ª Session ä¸­å¯ä»¥æœ‰å¤šä¸ªè¯·æ±‚ã€‚</li><li><strong>session åŒ…å«äº servletContext</strong>ï¼šä¸€ä¸ª Web åº”ç”¨ï¼ˆServletContextï¼‰ä¸­å¯ä»¥æœ‰å¤šä¸ª Sessionã€‚</li></ul><p>è¿™ä¸ªå…³ç³»å›¾æ¸…æ™°åœ°å±•ç¤ºäº†å®ƒä»¬å„è‡ªçš„ç”Ÿå‘½å‘¨æœŸå’Œæ•°æ®å…±äº«èŒƒå›´ï¼Œæ˜¯ç†è§£ Servlet åŸŸå¯¹è±¡çš„å…³é”®ã€‚</p><p>å•Šå“ˆï½ä½ è¿™ä¸ªåœºæ™¯å°±æ˜¯ <strong>åŒä¸€ä¸ªåº“çš„ä¸¤ä¸ªç‰ˆæœ¬å¿…é¡»å…±å­˜</strong>ï¼Œå…¸å‹çš„ â€œæ·±åº¦ JAR hellâ€ ğŸš¨ã€‚<br> æ¯”å¦‚ï¼š</p><ul><li>ä½ çš„ç³»ç»Ÿç”¨åˆ° <strong>è€ç‰ˆæœ¬ log4j</strong>ï¼Œ</li><li>ä½†æŸä¸ªç¬¬ä¸‰æ–¹åº“ç¡¬æ€§ä¾èµ– <strong>æ–°ç‰ˆæœ¬ log4j</strong>ã€‚</li></ul><p>è¿™æ—¶å€™å¦‚æœæ”¾åˆ°åŒä¸€ä¸ª classpath é‡Œï¼Œè‚¯å®šä¼šå†²çªã€‚è§£å†³æ€è·¯ä¸»è¦æœ‰ä¸‰ç±»ï¼š</p><hr><h2 id="âœ…-ä¸¤ä¸ªç‰ˆæœ¬-JAR-å…±å­˜çš„è§£å†³æ–¹æ¡ˆ"><a href="#âœ…-ä¸¤ä¸ªç‰ˆæœ¬-JAR-å…±å­˜çš„è§£å†³æ–¹æ¡ˆ" class="headerlink" title="âœ… ä¸¤ä¸ªç‰ˆæœ¬ JAR å…±å­˜çš„è§£å†³æ–¹æ¡ˆ"></a>âœ… ä¸¤ä¸ªç‰ˆæœ¬ JAR å…±å­˜çš„è§£å†³æ–¹æ¡ˆ</h2><h3 id="1-ClassLoader-éš”ç¦»ï¼ˆæ¨èæ–¹å¼ï¼‰"><a href="#1-ClassLoader-éš”ç¦»ï¼ˆæ¨èæ–¹å¼ï¼‰" class="headerlink" title="1. ClassLoader éš”ç¦»ï¼ˆæ¨èæ–¹å¼ï¼‰"></a>1. <strong>ClassLoader éš”ç¦»</strong>ï¼ˆæ¨èæ–¹å¼ï¼‰</h3><p>åˆ©ç”¨ <strong>ä¸åŒçš„ç±»åŠ è½½å™¨</strong> æ¥éš”ç¦»ä¸¤ä¸ªç‰ˆæœ¬çš„ä¾èµ–ï¼Œè®©å®ƒä»¬äº’ä¸å¹²æ‰°ã€‚</p><ul><li><p><strong>Web å®¹å™¨éš”ç¦»</strong>ï¼š</p><ul><li>æŠŠä¸€ä¸ªç‰ˆæœ¬æ”¾åœ¨ <code>WEB-INF/lib</code>ï¼Œå¦ä¸€ä¸ªæ”¾åœ¨å…¨å±€ <code>lib/ext</code>ã€‚</li><li>é€šè¿‡ parent-first &#x2F; parent-last ç­–ç•¥æ§åˆ¶åŠ è½½ã€‚</li></ul></li><li><p><strong>è‡ªå®šä¹‰ ClassLoader</strong>ï¼š</p><ul><li><p>ç”¨ <code>URLClassLoader</code> æŒ‡å®šä¸åŒç‰ˆæœ¬ JAR çš„è·¯å¾„ã€‚</p></li><li><p>å“ªä¸ªæ¨¡å—éœ€è¦å“ªä¸ªç‰ˆæœ¬ï¼Œå°±ç”¨å“ªä¸ª ClassLoaderã€‚</p></li><li><p>ç¤ºä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">URLClassLoader loaderV1 = new URLClassLoader(</span><br><span class="line">    new URL[]&#123; new File(&quot;lib/lib-old.jar&quot;).toURI().toURL() &#125;,</span><br><span class="line">    null // ä¸å§”æ‰˜çˆ¶åŠ è½½å™¨</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">URLClassLoader loaderV2 = new URLClassLoader(</span><br><span class="line">    new URL[]&#123; new File(&quot;lib/lib-new.jar&quot;).toURI().toURL() &#125;,</span><br><span class="line">    null</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">Class&lt;?&gt; clazz1 = loaderV1.loadClass(&quot;com.example.MyClass&quot;);</span><br><span class="line">Class&lt;?&gt; clazz2 = loaderV2.loadClass(&quot;com.example.MyClass&quot;);</span><br></pre></td></tr></table></figure></li></ul></li></ul><p>ğŸ‘‰ OSGiã€Spring Boot çš„ <strong>ClassLoader å±‚çº§</strong>å°±æ˜¯ç”¨è¿™ç§æ–¹æ³•è§£å†³å¤šç‰ˆæœ¬ä¾èµ–çš„ã€‚</p><hr><h3 id="2-åŒ…é‡å®šä½ï¼ˆShading-Relocationï¼‰"><a href="#2-åŒ…é‡å®šä½ï¼ˆShading-Relocationï¼‰" class="headerlink" title="2. åŒ…é‡å®šä½ï¼ˆShading &#x2F; Relocationï¼‰"></a>2. <strong>åŒ…é‡å®šä½ï¼ˆShading &#x2F; Relocationï¼‰</strong></h3><p>æŠŠå…¶ä¸­ä¸€ä¸ªç‰ˆæœ¬çš„åŒ…è·¯å¾„ <strong>æ”¹å</strong>ï¼Œè®© JVM è®¤ä¸ºå®ƒæ˜¯å®Œå…¨ä¸åŒçš„ç±»åº“ã€‚</p><ul><li><p>å·¥å…·ï¼š</p><ul><li><code>jarjar</code></li><li>Maven Shadeï¼ˆå³ä½¿ä½ ä¸ç”¨ Mavenï¼Œä¹Ÿå¯ä»¥å•ç‹¬è·‘æ’ä»¶ï¼‰</li><li>Gradle Shadow</li></ul></li><li><p>åŸç†ï¼šè‡ªåŠ¨æŠŠ <code>org.apache.commons</code> æ”¹æˆ <code>myproject.shaded.org.apache.commons</code>ã€‚</p></li><li><p>ç¤ºä¾‹ï¼ˆJarJar è§„åˆ™ï¼‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rule org.apache.log4j.** com.myapp.shaded.log4j.@1</span><br></pre></td></tr></table></figure></li></ul><p>è¿™æ ·ï¼Œé¡¹ç›®å°±èƒ½åŒæ—¶ç”¨ <code>log4j-1.2</code> å’Œ <code>log4j-2.x</code>ã€‚</p><hr><h3 id="3-æœåŠ¡è§£è€¦-æ¨¡å—åŒ–"><a href="#3-æœåŠ¡è§£è€¦-æ¨¡å—åŒ–" class="headerlink" title="3. æœåŠ¡è§£è€¦ &#x2F; æ¨¡å—åŒ–"></a>3. <strong>æœåŠ¡è§£è€¦ &#x2F; æ¨¡å—åŒ–</strong></h3><p>å¦‚æœä¸¤ä¸ªç‰ˆæœ¬éƒ½è¦åœ¨ <strong>åŒä¸€ä¸ª JVM é‡Œç”¨</strong>ï¼Œä½† ClassLoader å¤ªéº»çƒ¦ï¼š</p><ul><li><strong>æ‹†åˆ†æˆå¾®æœåŠ¡ &#x2F; å­è¿›ç¨‹</strong>ï¼Œè®©ä¸åŒè¿›ç¨‹ä½¿ç”¨ä¸åŒç‰ˆæœ¬çš„ä¾èµ–ã€‚</li><li>æˆ–è€…åœ¨ <strong>Java 9+ æ¨¡å—ç³»ç»Ÿ (JPMS)</strong> ä¸‹ï¼Œç»™ä¸åŒæ¨¡å—å£°æ˜ä¸åŒä¾èµ–ï¼Œé¿å…ç›´æ¥å†²çªã€‚</li></ul><hr><h2 id="ğŸš€-å®é™…å»ºè®®"><a href="#ğŸš€-å®é™…å»ºè®®" class="headerlink" title="ğŸš€ å®é™…å»ºè®®"></a>ğŸš€ å®é™…å»ºè®®</h2><ul><li>å¦‚æœä½ æ˜¯ <strong>è‡ªå·±å¼€å‘çš„é¡¹ç›®</strong> â†’ ç”¨ <strong>åŒ…é‡å®šä½</strong> æ¯”è¾ƒç®€å•ã€‚</li><li>å¦‚æœæ˜¯ <strong>æ’ä»¶å¼ç³»ç»Ÿ &#x2F; å®¹å™¨è¿è¡Œ</strong> â†’ ç”¨ <strong>ClassLoader éš”ç¦»</strong>ã€‚</li><li>å¦‚æœæ˜¯ <strong>é‡é‡çº§ç³»ç»Ÿ</strong>ï¼ˆæ¯”å¦‚éœ€è¦ä¸åŒç‰ˆæœ¬çš„ JDBC é©±åŠ¨ï¼‰ â†’ æ‹†è¿›ç¨‹æ›´å¹²å‡€ã€‚</li></ul><hr><p>è¦ä¸è¦æˆ‘å¸®ä½ å†™ä¸€ä¸ª <strong>æœ€å°å¯è¿è¡Œçš„ Java Demo</strong>ï¼ˆä¸¤ä¸ªç‰ˆæœ¬ JAR åŒæ—¶è¿è¡Œï¼Œé€šè¿‡ ClassLoader éš”ç¦»ï¼‰ï¼Ÿè¿™æ ·ä½ å¯ä»¥ç›´æ¥è·‘èµ·æ¥çœ‹çœ‹æ•ˆæœã€‚</p><p>å¥½çš„ï¼Œæˆ‘å°†æ ¹æ®æ‚¨æä¾›çš„è¿™ä»½è¯¦å°½çš„ç¬”è®°ï¼Œä»¥æ›´ä¸“ä¸šã€æ›´ç³»ç»Ÿçš„æ–¹å¼ï¼Œå¯¹å…¶è¿›è¡Œé‡æ–°ç»„ç»‡ã€è¡¥å……å’Œæ·±å…¥è§£æï¼Œä½¿å…¶æˆä¸ºä¸€ä»½é«˜è´¨é‡çš„æŠ€æœ¯è®²è§£æˆ–é¢è¯•å›ç­”ã€‚</p><hr><h3 id="ä¸€ã€CSS-é€‰æ‹©å™¨æ¦‚è¿°ï¼šç²¾å‡†å®šä½ç½‘é¡µå…ƒç´ "><a href="#ä¸€ã€CSS-é€‰æ‹©å™¨æ¦‚è¿°ï¼šç²¾å‡†å®šä½ç½‘é¡µå…ƒç´ " class="headerlink" title="ä¸€ã€CSS é€‰æ‹©å™¨æ¦‚è¿°ï¼šç²¾å‡†å®šä½ç½‘é¡µå…ƒç´ "></a>ä¸€ã€CSS é€‰æ‹©å™¨æ¦‚è¿°ï¼šç²¾å‡†å®šä½ç½‘é¡µå…ƒç´ </h3><p><strong>é€‰æ‹©å™¨</strong>æ˜¯ CSS çš„æ ¸å¿ƒï¼Œå®ƒç”¨äº<strong>ç²¾ç¡®åœ°é€‰æ‹© HTML æ–‡æ¡£ä¸­çš„å…ƒç´ </strong>ï¼Œå¹¶ä¸ºå…¶åº”ç”¨æ ·å¼ã€‚æŒæ¡ä¸åŒç±»å‹çš„é€‰æ‹©å™¨åŠå…¶ç»„åˆï¼Œæ˜¯é«˜æ•ˆç¼–å†™ CSS ä»£ç çš„å…³é”®ã€‚</p><h3 id="äºŒã€åŸºç¡€é€‰æ‹©å™¨-Basic-Selectors"><a href="#äºŒã€åŸºç¡€é€‰æ‹©å™¨-Basic-Selectors" class="headerlink" title="äºŒã€åŸºç¡€é€‰æ‹©å™¨ (Basic Selectors)"></a>äºŒã€åŸºç¡€é€‰æ‹©å™¨ (Basic Selectors)</h3><p>åŸºç¡€é€‰æ‹©å™¨ç”¨äºæ ¹æ®æœ€åŸºæœ¬çš„å±æ€§ï¼ˆæ ‡ç­¾ã€ç±»ã€IDï¼‰æ¥é€‰æ‹©å…ƒç´ ã€‚</p><h4 id="1-æ ‡ç­¾é€‰æ‹©å™¨-Type-Selector"><a href="#1-æ ‡ç­¾é€‰æ‹©å™¨-Type-Selector" class="headerlink" title="1. æ ‡ç­¾é€‰æ‹©å™¨ (Type Selector)"></a>1. æ ‡ç­¾é€‰æ‹©å™¨ (Type Selector)</h4><ul><li><p><strong>åŸç†</strong>ï¼šæ ¹æ®å…ƒç´ çš„<strong>æ ‡ç­¾åç§°</strong>æ¥åŒ¹é…ã€‚</p></li><li><p><strong>ä¼˜ç‚¹</strong>ï¼šç®€å•ã€ç›´æ¥ï¼Œå¯ä»¥ä¸€æ¬¡æ€§é€‰ä¸­æ‰€æœ‰åŒç±»å‹çš„å…ƒç´ ã€‚</p></li><li><p><strong>ç¼ºç‚¹</strong>ï¼šè¿‡äºç¬¼ç»Ÿï¼Œæ— æ³•å¯¹ä¸ªåˆ«å…ƒç´ è¿›è¡Œç²¾ç¡®æ§åˆ¶ã€‚</p></li><li><p><strong>ç¤ºä¾‹</strong>ï¼š</p><p>CSS</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">div &#123; color: red; &#125; /* æ‰€æœ‰&lt;div&gt;æ ‡ç­¾çš„å­—ä½“é¢œè‰²éƒ½ä¸ºçº¢è‰² */</span><br></pre></td></tr></table></figure></li></ul><h4 id="2-ç±»é€‰æ‹©å™¨-Class-Selector-1"><a href="#2-ç±»é€‰æ‹©å™¨-Class-Selector-1" class="headerlink" title="2. ç±»é€‰æ‹©å™¨ (Class Selector)"></a>2. ç±»é€‰æ‹©å™¨ (Class Selector)</h4><ul><li><p><strong>åŸç†</strong>ï¼šæ ¹æ®å…ƒç´ çš„ <code>class</code> å±æ€§å€¼æ¥åŒ¹é…ã€‚</p></li><li><p><strong>ä¼˜ç‚¹</strong>ï¼š</p><ul><li><strong>é«˜åº¦å¤ç”¨</strong>ï¼šå¯ä»¥åœ¨å¤šä¸ªå…ƒç´ ä¸Šä½¿ç”¨åŒä¸€ä¸ªç±»åã€‚</li><li><strong>çµæ´»</strong>ï¼šä¸€ä¸ªå…ƒç´ å¯ä»¥æ‹¥æœ‰å¤šä¸ªç±»åï¼Œç”¨ç©ºæ ¼åˆ†éš”ã€‚</li></ul></li><li><p><strong>ç¤ºä¾‹</strong>ï¼š</p><p>CSS</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.cl1 &#123; color: red; &#125; /* æ‰€æœ‰classå±æ€§åŒ…å«cl1çš„å…ƒç´ ï¼Œå­—ä½“é¢œè‰²ä¸ºçº¢è‰² */</span><br></pre></td></tr></table></figure></li></ul><h4 id="3-ID-é€‰æ‹©å™¨-ID-Selector-1"><a href="#3-ID-é€‰æ‹©å™¨-ID-Selector-1" class="headerlink" title="3. ID é€‰æ‹©å™¨ (ID Selector)"></a>3. ID é€‰æ‹©å™¨ (ID Selector)</h4><ul><li><p><strong>åŸç†</strong>ï¼šæ ¹æ®å…ƒç´ çš„ <code>id</code> å±æ€§å€¼æ¥åŒ¹é…ã€‚</p></li><li><p><strong>ä¼˜ç‚¹</strong>ï¼š<strong>å”¯ä¸€æ€§</strong>ï¼Œç²¾ç¡®åœ°é€‰ä¸­æ–‡æ¡£ä¸­å”¯ä¸€çš„å…ƒç´ ã€‚</p></li><li><p><strong>ç¼ºç‚¹</strong>ï¼šä¸å…·å¤ç”¨æ€§ï¼Œä¸€ä¸ª ID åœ¨æ–‡æ¡£ä¸­åªèƒ½å‡ºç°ä¸€æ¬¡ã€‚</p></li><li><p><strong>ç¤ºä¾‹</strong>ï¼š</p><p>CSS</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#p1 &#123; color: red; &#125; /* idä¸ºp1çš„å”¯ä¸€å…ƒç´ ï¼Œå­—ä½“é¢œè‰²ä¸ºçº¢è‰² */</span><br></pre></td></tr></table></figure></li></ul><h4 id="4-é€šé…ç¬¦é€‰æ‹©å™¨-Universal-Selector"><a href="#4-é€šé…ç¬¦é€‰æ‹©å™¨-Universal-Selector" class="headerlink" title="4. é€šé…ç¬¦é€‰æ‹©å™¨ (Universal Selector)"></a>4. é€šé…ç¬¦é€‰æ‹©å™¨ (Universal Selector)</h4><ul><li><p><strong>åŸç†</strong>ï¼šåŒ¹é…æ–‡æ¡£ä¸­<strong>æ‰€æœ‰</strong>çš„å…ƒç´ ã€‚</p></li><li><p><strong>ä¼˜ç‚¹</strong>ï¼šå¯ä»¥å¿«é€Ÿè®¾ç½®å…¨å±€æ ·å¼ï¼Œå¸¸ç”¨äºé‡ç½®æµè§ˆå™¨é»˜è®¤æ ·å¼ã€‚</p></li><li><p><strong>ç¼ºç‚¹</strong>ï¼šæ€§èƒ½å¼€é”€å¤§ï¼Œå› ä¸ºæµè§ˆå™¨éœ€è¦éå†æ‰€æœ‰å…ƒç´ ï¼Œåº”è°¨æ…ä½¿ç”¨ã€‚</p></li><li><p><strong>ç¤ºä¾‹</strong>ï¼š</p><p>CSS</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* &#123; margin: 0; padding: 0; &#125; /* æ¸…é™¤æ‰€æœ‰å…ƒç´ çš„å†…å¤–è¾¹è· */</span><br></pre></td></tr></table></figure></li></ul><hr><h3 id="ä¸‰ã€ç»„åˆé€‰æ‹©å™¨-Combinators"><a href="#ä¸‰ã€ç»„åˆé€‰æ‹©å™¨-Combinators" class="headerlink" title="ä¸‰ã€ç»„åˆé€‰æ‹©å™¨ (Combinators)"></a>ä¸‰ã€ç»„åˆé€‰æ‹©å™¨ (Combinators)</h3><p>ç»„åˆé€‰æ‹©å™¨é€šè¿‡ç¬¦å·è¿æ¥å¤šä¸ªé€‰æ‹©å™¨ï¼Œæ ¹æ®å…ƒç´ ä¹‹é—´çš„å…³ç³»æ¥åŒ¹é…ã€‚</p><h4 id="1-äº¤é›†é€‰æ‹©å™¨-Intersection-Selector"><a href="#1-äº¤é›†é€‰æ‹©å™¨-Intersection-Selector" class="headerlink" title="1. äº¤é›†é€‰æ‹©å™¨ (Intersection Selector)"></a>1. äº¤é›†é€‰æ‹©å™¨ (Intersection Selector)</h4><ul><li><p><strong>åŸç†</strong>ï¼šåŒæ—¶æ»¡è¶³å¤šä¸ªé€‰æ‹©å™¨æ¡ä»¶çš„å…ƒç´ ã€‚</p></li><li><p><strong>è¯­æ³•</strong>ï¼š<code>selector1selector2 &#123; ... &#125;</code>ï¼Œä¸­é—´<strong>æ²¡æœ‰ç©ºæ ¼</strong>ã€‚</p></li><li><p><strong>ç¤ºä¾‹</strong>ï¼š</p><p>CSS</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">div.cl1 &#123; color: red; &#125; /* æ—¢æ˜¯&lt;div&gt;æ ‡ç­¾ï¼Œåˆæ‹¥æœ‰cl1è¿™ä¸ªclassçš„å…ƒç´  */</span><br></pre></td></tr></table></figure></li></ul><h4 id="2-å¹¶é›†é€‰æ‹©å™¨-Union-Selector"><a href="#2-å¹¶é›†é€‰æ‹©å™¨-Union-Selector" class="headerlink" title="2. å¹¶é›†é€‰æ‹©å™¨ (Union Selector)"></a>2. å¹¶é›†é€‰æ‹©å™¨ (Union Selector)</h4><ul><li><p><strong>åŸç†</strong>ï¼šåŒ¹é…æ‰€æœ‰æ»¡è¶³å…¶ä¸­ä»»æ„ä¸€ä¸ªé€‰æ‹©å™¨æ¡ä»¶çš„å…ƒç´ ã€‚</p></li><li><p><strong>è¯­æ³•</strong>ï¼š<code>selector1, selector2 &#123; ... &#125;</code>ï¼Œä»¥<strong>é€—å·</strong>åˆ†éš”ã€‚</p></li><li><p><strong>ç¤ºä¾‹</strong>ï¼š</p><p>CSS</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a, p &#123; color: red; &#125; /* æ‰€æœ‰&lt;a&gt;æ ‡ç­¾å’Œæ‰€æœ‰&lt;p&gt;æ ‡ç­¾çš„å­—ä½“é¢œè‰²éƒ½ä¸ºçº¢è‰² */</span><br></pre></td></tr></table></figure></li></ul><h4 id="3-å­é€‰æ‹©å™¨-Child-Selector"><a href="#3-å­é€‰æ‹©å™¨-Child-Selector" class="headerlink" title="3. å­é€‰æ‹©å™¨ (Child Selector)"></a>3. å­é€‰æ‹©å™¨ (Child Selector)</h4><ul><li><p><strong>åŸç†</strong>ï¼šåŒ¹é…<strong>ç›´æ¥</strong>å­å…ƒç´ ã€‚</p></li><li><p><strong>è¯­æ³•</strong>ï¼š<code>parent &gt; child &#123; ... &#125;</code>ï¼Œä»¥ <code>&gt;</code> ç¬¦å·åˆ†éš”ã€‚</p></li><li><p><strong>ç¤ºä¾‹</strong>ï¼š</p><p>CSS</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#outer &gt; span &#123; color: red; &#125; /* åªé€‰ä¸­idä¸ºouterçš„&lt;div&gt;çš„ç›´æ¥å­å…ƒç´ &lt;span&gt; */</span><br></pre></td></tr></table></figure></li></ul><h4 id="4-åä»£é€‰æ‹©å™¨-Descendant-Selector"><a href="#4-åä»£é€‰æ‹©å™¨-Descendant-Selector" class="headerlink" title="4. åä»£é€‰æ‹©å™¨ (Descendant Selector)"></a>4. åä»£é€‰æ‹©å™¨ (Descendant Selector)</h4><ul><li><p><strong>åŸç†</strong>ï¼šåŒ¹é…æ‰€æœ‰ä½äºç¥–å…ˆå…ƒç´ å†…éƒ¨çš„<strong>æ‰€æœ‰åä»£</strong>å…ƒç´ ã€‚</p></li><li><p><strong>è¯­æ³•</strong>ï¼š<code>ancestor descendant &#123; ... &#125;</code>ï¼Œä»¥<strong>ç©ºæ ¼</strong>åˆ†éš”ã€‚</p></li><li><p><strong>ç¤ºä¾‹</strong>ï¼š</p><p>CSS</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#outer span &#123; color: red; &#125; /* é€‰ä¸­idä¸ºouterçš„&lt;div&gt;å†…éƒ¨çš„æ‰€æœ‰&lt;span&gt;ï¼Œæ— è®ºåµŒå¥—å¤šæ·± */</span><br></pre></td></tr></table></figure></li></ul><hr><h3 id="å››ã€å±æ€§é€‰æ‹©å™¨-Attribute-Selectors"><a href="#å››ã€å±æ€§é€‰æ‹©å™¨-Attribute-Selectors" class="headerlink" title="å››ã€å±æ€§é€‰æ‹©å™¨ (Attribute Selectors)"></a>å››ã€å±æ€§é€‰æ‹©å™¨ (Attribute Selectors)</h3><p>å±æ€§é€‰æ‹©å™¨æ ¹æ®å…ƒç´ çš„å±æ€§åŠå…¶å€¼æ¥åŒ¹é…ã€‚</p><ul><li><strong>[attribute]</strong>ï¼šåŒ¹é…å…·æœ‰è¯¥å±æ€§çš„å…ƒç´ ã€‚<ul><li>ç¤ºä¾‹ï¼š<code>[class]</code> åŒ¹é…æ‰€æœ‰å…·æœ‰ <code>class</code> å±æ€§çš„å…ƒç´ ã€‚</li></ul></li><li><strong>[attribute&#x3D;â€valueâ€]</strong>ï¼šåŒ¹é…å±æ€§å€¼å®Œå…¨ç›¸ç­‰çš„å…ƒç´ ã€‚<ul><li>ç¤ºä¾‹ï¼š<code>[type=&quot;text&quot;]</code> åŒ¹é… <code>type</code> å±æ€§å€¼æ°å¥½ä¸º <code>&quot;text&quot;</code> çš„å…ƒç´ ã€‚</li></ul></li><li><strong>[attribute~&#x3D;â€valueâ€]</strong>ï¼šåŒ¹é…å±æ€§å€¼ä¸­åŒ…å«è¯¥<strong>ç‹¬ç«‹å•è¯</strong>çš„å…ƒç´ ã€‚</li><li><strong>[attribute^&#x3D;â€valueâ€]</strong>ï¼šåŒ¹é…å±æ€§å€¼ä»¥è¯¥å­—ç¬¦ä¸²<strong>å¼€å¤´</strong>çš„å…ƒç´ ã€‚</li><li><strong>[attribute$&#x3D;â€valueâ€]</strong>ï¼šåŒ¹é…å±æ€§å€¼ä»¥è¯¥å­—ç¬¦ä¸²<strong>ç»“å°¾</strong>çš„å…ƒç´ ã€‚</li><li><strong>[attribute*&#x3D;â€valueâ€]</strong>ï¼šåŒ¹é…å±æ€§å€¼ä¸­åŒ…å«è¯¥å­—ç¬¦ä¸²çš„<strong>ä»»æ„ä½ç½®</strong>çš„å…ƒç´ ã€‚</li></ul><hr><h3 id="äº”ã€ä¼ªç±»ä¸ä¼ªå…ƒç´ é€‰æ‹©å™¨-Pseudo-class-Pseudo-element-Selectors"><a href="#äº”ã€ä¼ªç±»ä¸ä¼ªå…ƒç´ é€‰æ‹©å™¨-Pseudo-class-Pseudo-element-Selectors" class="headerlink" title="äº”ã€ä¼ªç±»ä¸ä¼ªå…ƒç´ é€‰æ‹©å™¨ (Pseudo-class &amp; Pseudo-element Selectors)"></a>äº”ã€ä¼ªç±»ä¸ä¼ªå…ƒç´ é€‰æ‹©å™¨ (Pseudo-class &amp; Pseudo-element Selectors)</h3><ul><li><strong>ä¼ªç±»</strong>ï¼šç”¨<strong>ä¸€ä¸ªå†’å· :</strong>ï¼Œè¡¨ç¤ºå…ƒç´ åœ¨<strong>ç‰¹å®šçŠ¶æ€</strong>ä¸‹çš„æ ·å¼ã€‚<ul><li><strong>:link</strong>ï¼šæœªè®¿é—®çš„é“¾æ¥ã€‚</li><li><strong>:visited</strong>ï¼šå·²è®¿é—®çš„é“¾æ¥ã€‚</li><li><strong>:hover</strong>ï¼šé¼ æ ‡æ‚¬åœçŠ¶æ€ã€‚</li><li><strong>:active</strong>ï¼šè¢«ç‚¹å‡»çŠ¶æ€ã€‚</li><li><strong>:focus</strong>ï¼šè·å¾—ç„¦ç‚¹çŠ¶æ€ï¼ˆå¸¸ç”¨äºè¡¨å•ï¼‰ã€‚</li></ul></li><li><strong>ä¼ªå…ƒç´ </strong>ï¼šç”¨<strong>ä¸¤ä¸ªå†’å· ::</strong>ï¼Œè¡¨ç¤ºå…ƒç´ çš„<strong>ç‰¹å®šéƒ¨åˆ†</strong>ã€‚<ul><li><strong>::before</strong> å’Œ <strong>::after</strong>ï¼šåœ¨å…ƒç´ å†…å®¹çš„å‰åæ’å…¥å†…å®¹ã€‚</li><li><strong>::first-line</strong>ï¼šå…ƒç´ çš„æ–‡æœ¬ç¬¬ä¸€è¡Œã€‚</li><li><strong>::first-letter</strong>ï¼šå…ƒç´ çš„æ–‡æœ¬ç¬¬ä¸€ä¸ªå­—æ¯ã€‚</li></ul></li></ul><hr><h3 id="å…­ã€é€‰æ‹©å™¨ä¼˜å…ˆçº§-Specificity"><a href="#å…­ã€é€‰æ‹©å™¨ä¼˜å…ˆçº§-Specificity" class="headerlink" title="å…­ã€é€‰æ‹©å™¨ä¼˜å…ˆçº§ (Specificity)"></a>å…­ã€é€‰æ‹©å™¨ä¼˜å…ˆçº§ (Specificity)</h3><p>è¿™æ˜¯ CSS çš„æ ¸å¿ƒæœºåˆ¶ï¼Œå†³å®šäº†å½“å¤šä¸ªè§„åˆ™åº”ç”¨åˆ°åŒä¸€ä¸ªå…ƒç´ æ—¶ï¼Œå“ªä¸€ä¸ªä¼šç”Ÿæ•ˆã€‚</p><ul><li><strong>è®¡ç®—è§„åˆ™</strong>ï¼šä¼˜å…ˆçº§ç”±<strong>é€‰æ‹©å™¨çš„ç±»å‹</strong>å’Œ<strong>æ•°é‡</strong>å†³å®šã€‚<ol><li><strong>è¡Œå†…æ ·å¼</strong>ï¼šä¼˜å…ˆçº§æœ€é«˜ï¼Œä¸º <code>1000</code>ã€‚</li><li><strong>ID é€‰æ‹©å™¨</strong>ï¼šä¼˜å…ˆçº§ä¸º <code>100</code>ã€‚</li><li><strong>ç±»ã€å±æ€§ã€ä¼ªç±»é€‰æ‹©å™¨</strong>ï¼šä¼˜å…ˆçº§ä¸º <code>10</code>ã€‚</li><li><strong>å…ƒç´ ã€ä¼ªå…ƒç´ é€‰æ‹©å™¨</strong>ï¼šä¼˜å…ˆçº§ä¸º <code>1</code>ã€‚</li><li><strong>é€šç”¨é€‰æ‹©å™¨ *</strong>ï¼šä¼˜å…ˆçº§ä¸º <code>0</code>ã€‚</li></ol></li><li><strong>!important</strong>ï¼šæœ€é«˜ä¼˜å…ˆçº§ï¼Œä½†ä¼šç ´åå±‚å æœºåˆ¶ï¼Œåº”<strong>é¿å…ä½¿ç”¨</strong>ã€‚</li></ul><p>å¦‚ä½•è®¡ç®—ï¼š</p><p>å°†æ¯ä¸ªé€‰æ‹©å™¨çš„ä¼˜å…ˆçº§æ•°å­—ç›¸åŠ ï¼Œå¾—åˆ°ä¸€ä¸ªæœ€ç»ˆçš„æƒé‡å€¼ã€‚æƒé‡å€¼è¶Šé«˜çš„è§„åˆ™è¶Šä¼˜å…ˆã€‚</p><ul><li>ç¤ºä¾‹ï¼š<ul><li><code>p</code>ï¼šæƒé‡ <code>1</code>ã€‚</li><li><code>.cl1</code>ï¼šæƒé‡ <code>10</code>ã€‚</li><li><code>div.cl1</code>ï¼šæƒé‡ <code>1 + 10 = 11</code>ã€‚</li><li><code>#p1</code>ï¼šæƒé‡ <code>100</code>ã€‚</li><li><code>#outer span</code>ï¼šæƒé‡ <code>100 + 1 = 101</code>ã€‚</li></ul></li></ul><p><strong>!important</strong> ä¼šå‡Œé©¾äºæ‰€æœ‰è¿™äº›è§„åˆ™ä¹‹ä¸Šã€‚å½“ä½ é‡åˆ°æ ·å¼ä¸ç”Ÿæ•ˆçš„é—®é¢˜æ—¶ï¼Œé¦–å…ˆè¦æ£€æŸ¥ä¼˜å…ˆçº§ï¼Œå…¶æ¬¡æ˜¯æ˜¯å¦æœ‰ <code>!important</code> çš„å­˜åœ¨ã€‚</p><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ¥è¯¦ç»†ã€æ·±å…¥åœ°è§£é‡Š <strong>BOM</strong> å’Œ <strong>DOM</strong> è¿™ä¸¤ä¸ª JavaScript åœ¨æµè§ˆå™¨ä¸­æ“ä½œç½‘é¡µçš„æ ¸å¿ƒæ¦‚å¿µã€‚</p><hr><h3 id="BOM-Browser-Object-Model"><a href="#BOM-Browser-Object-Model" class="headerlink" title="BOM (Browser Object Model)"></a>BOM (Browser Object Model)</h3><h4 id="1-æ¦‚å¿µ"><a href="#1-æ¦‚å¿µ" class="headerlink" title="1. æ¦‚å¿µ"></a>1. æ¦‚å¿µ</h4><p><strong>BOM</strong>ï¼Œå³<strong>æµè§ˆå™¨å¯¹è±¡æ¨¡å‹</strong>ï¼Œæ˜¯ JavaScript ç”¨äº<strong>æ“ä½œæµè§ˆå™¨çª—å£</strong>çš„ä¸€å¥— APIã€‚å®ƒæ²¡æœ‰ç»Ÿä¸€çš„æ ‡å‡†ï¼Œè€Œæ˜¯ç”±å„ä¸ªæµè§ˆå™¨å‚å•†å„è‡ªå®ç°çš„ã€‚BOM çš„æ ¸å¿ƒæ˜¯ <code>window</code> å¯¹è±¡ï¼Œå®ƒæ—¢ä»£è¡¨äº†æµè§ˆå™¨çª—å£æœ¬èº«ï¼Œä¹Ÿæ˜¯ JavaScript å…¨å±€ä½œç”¨åŸŸçš„å”¯ä¸€å¯¹è±¡ã€‚</p><h4 id="2-BOM-çš„æ ¸å¿ƒå¯¹è±¡ä¸åŠŸèƒ½"><a href="#2-BOM-çš„æ ¸å¿ƒå¯¹è±¡ä¸åŠŸèƒ½" class="headerlink" title="2. BOM çš„æ ¸å¿ƒå¯¹è±¡ä¸åŠŸèƒ½"></a>2. BOM çš„æ ¸å¿ƒå¯¹è±¡ä¸åŠŸèƒ½</h4><p>BOM æä¾›äº†ä»¥ä¸‹å…³é”®å¯¹è±¡ï¼Œç”¨äºä¸æµè§ˆå™¨è¿›è¡Œäº¤äº’ï¼š</p><ul><li><strong>window å¯¹è±¡</strong>ï¼š<ul><li><strong>å…¨å±€å¯¹è±¡</strong>ï¼š<code>window</code> æ˜¯ JavaScript çš„å…¨å±€å¯¹è±¡ï¼Œæ‰€æœ‰å…¨å±€å˜é‡å’Œå‡½æ•°éƒ½æ˜¯ <code>window</code> å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•ã€‚</li><li><strong>çª—å£æ§åˆ¶</strong>ï¼š<code>window.open()</code> (æ‰“å¼€æ–°çª—å£), <code>window.close()</code> (å…³é—­å½“å‰çª—å£)ã€‚</li><li><strong>å®šæ—¶å™¨</strong>ï¼š<code>setTimeout()</code> å’Œ <code>setInterval()</code>ï¼Œç”¨äºå»¶è¿Ÿæˆ–é‡å¤æ‰§è¡Œä»£ç ã€‚</li><li><strong>å¯¼èˆªä¸ä½ç½®</strong>ï¼š<code>window.location</code>ï¼Œç”¨äºè·å–å’Œä¿®æ”¹å½“å‰é¡µé¢çš„ URLã€‚</li></ul></li><li><strong>location å¯¹è±¡</strong>ï¼š<ul><li><strong>URL ä¿¡æ¯</strong>ï¼šæä¾›äº†å½“å‰ URL çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚ <code>location.href</code> (å®Œæ•´ URL), <code>location.protocol</code> (åè®®), <code>location.hostname</code> (ä¸»æœºå), <code>location.pathname</code> (è·¯å¾„)ã€‚</li><li><strong>é¡µé¢è·³è½¬</strong>ï¼š<code>location.href = &#39;new_url&#39;</code> æˆ– <code>location.assign(&#39;new_url&#39;)</code> (æœ‰å†å²è®°å½•), <code>location.replace(&#39;new_url&#39;)</code> (ä¸ç•™å†å²è®°å½•), <code>location.reload()</code> (åˆ·æ–°é¡µé¢)ã€‚</li></ul></li><li><strong>history å¯¹è±¡</strong>ï¼š<ul><li><strong>å†å²è®°å½•</strong>ï¼šæä¾›äº†å¯¹æµè§ˆå™¨å†å²è®°å½•çš„è®¿é—®ã€‚</li><li><strong>å¯¼èˆª</strong>ï¼š<code>history.back()</code> (åé€€), <code>history.forward()</code> (å‰è¿›), <code>history.go(n)</code> (å‰è¿›æˆ–åé€€ n é¡µ)ã€‚</li></ul></li><li><strong>navigator å¯¹è±¡</strong>ï¼š<ul><li><strong>æµè§ˆå™¨ä¿¡æ¯</strong>ï¼šæä¾›äº†å…³äºæµè§ˆå™¨æœ¬èº«çš„ä¿¡æ¯ï¼Œå¦‚ <code>navigator.userAgent</code> (ç”¨æˆ·ä»£ç†å­—ç¬¦ä¸²), <code>navigator.platform</code> (æ“ä½œç³»ç»Ÿ), <code>navigator.onLine</code> (æ˜¯å¦åœ¨çº¿)ã€‚</li></ul></li><li><strong>screen å¯¹è±¡</strong>ï¼š<ul><li><strong>å±å¹•ä¿¡æ¯</strong>ï¼šæä¾›äº†å…³äºç”¨æˆ·å±å¹•çš„ä¿¡æ¯ï¼Œå¦‚ <code>screen.width</code> (å±å¹•å®½åº¦), <code>screen.height</code> (å±å¹•é«˜åº¦)ã€‚</li></ul></li></ul><h4 id="3-BOM-çš„ç‰¹ç‚¹"><a href="#3-BOM-çš„ç‰¹ç‚¹" class="headerlink" title="3. BOM çš„ç‰¹ç‚¹"></a>3. BOM çš„ç‰¹ç‚¹</h4><ul><li><strong>æ²¡æœ‰æ ‡å‡†</strong>ï¼šBOM æ²¡æœ‰ W3C çš„æ­£å¼æ ‡å‡†ï¼Œä¸åŒæµè§ˆå™¨å¯èƒ½åœ¨å®ç°ä¸Šå­˜åœ¨å·®å¼‚ã€‚</li><li><strong>ä»¥ window ä¸ºæ ¸å¿ƒ</strong>ï¼šæ‰€æœ‰ BOM å¯¹è±¡éƒ½æ˜¯ <code>window</code> å¯¹è±¡çš„å±æ€§ã€‚</li></ul><hr><h3 id="DOM-Document-Object-Model"><a href="#DOM-Document-Object-Model" class="headerlink" title="DOM (Document Object Model)"></a>DOM (Document Object Model)</h3><h4 id="1-æ¦‚å¿µ-1"><a href="#1-æ¦‚å¿µ-1" class="headerlink" title="1. æ¦‚å¿µ"></a>1. æ¦‚å¿µ</h4><p><strong>DOM</strong>ï¼Œå³<strong>æ–‡æ¡£å¯¹è±¡æ¨¡å‹</strong>ï¼Œæ˜¯ JavaScript ç”¨äº<strong>æ“ä½œ HTML æˆ– XML æ–‡æ¡£</strong>çš„ä¸€å¥— APIã€‚å®ƒå°†æ•´ä¸ª HTML æ–‡æ¡£è§£æä¸ºä¸€ä¸ª<strong>æ ‘å½¢ç»“æ„</strong>ï¼Œæ¯ä¸ª HTML æ ‡ç­¾ã€å±æ€§å’Œæ–‡æœ¬éƒ½æˆä¸ºäº†æ ‘ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆNodeï¼‰ã€‚DOM æ˜¯ä¸€ä¸ªç”± W3C åˆ¶å®šçš„æ ‡å‡†ã€‚</p><h4 id="2-DOM-çš„æ ¸å¿ƒå¯¹è±¡ä¸åŠŸèƒ½"><a href="#2-DOM-çš„æ ¸å¿ƒå¯¹è±¡ä¸åŠŸèƒ½" class="headerlink" title="2. DOM çš„æ ¸å¿ƒå¯¹è±¡ä¸åŠŸèƒ½"></a>2. DOM çš„æ ¸å¿ƒå¯¹è±¡ä¸åŠŸèƒ½</h4><p>DOM çš„æ ¸å¿ƒæ˜¯ <code>document</code> å¯¹è±¡ï¼Œå®ƒæ˜¯æ•´ä¸ªæ–‡æ¡£çš„å…¥å£ã€‚</p><ul><li><strong>document å¯¹è±¡</strong>ï¼š<ul><li><strong>DOM æ ‘çš„æ ¹èŠ‚ç‚¹</strong>ï¼šä»£è¡¨æ•´ä¸ª HTML æ–‡æ¡£ã€‚</li><li><strong>å…ƒç´ è·å–</strong>ï¼šæä¾›äº†å¤šç§æ–¹æ³•æ¥è·å–é¡µé¢ä¸Šçš„å…ƒç´ ï¼š<ul><li><code>document.getElementById(&#39;id&#39;)</code>ï¼šé€šè¿‡ ID è·å–å•ä¸ªå…ƒç´ ã€‚</li><li><code>document.getElementsByClassName(&#39;class&#39;)</code>ï¼šé€šè¿‡ç±»åè·å–å…ƒç´ é›†åˆã€‚</li><li><code>document.getElementsByTagName(&#39;tag&#39;)</code>ï¼šé€šè¿‡æ ‡ç­¾åè·å–å…ƒç´ é›†åˆã€‚</li><li><code>document.querySelector(&#39;css_selector&#39;)</code>ï¼šé€šè¿‡ CSS é€‰æ‹©å™¨è·å–ç¬¬ä¸€ä¸ªåŒ¹é…çš„å…ƒç´ ã€‚</li><li><code>document.querySelectorAll(&#39;css_selector&#39;)</code>ï¼šé€šè¿‡ CSS é€‰æ‹©å™¨è·å–æ‰€æœ‰åŒ¹é…çš„å…ƒç´ ã€‚</li></ul></li></ul></li><li><strong>å…ƒç´ èŠ‚ç‚¹ï¼ˆElement Nodesï¼‰</strong>ï¼š<ul><li><strong>æ“ä½œå…ƒç´ </strong>ï¼šæä¾›äº†æ“ä½œ HTML å…ƒç´ çš„æ–¹æ³•å’Œå±æ€§ï¼š<ul><li><code>element.innerHTML</code>ï¼šè·å–æˆ–è®¾ç½®å…ƒç´ çš„ HTML å†…å®¹ã€‚</li><li><code>element.style.color</code>ï¼šä¿®æ”¹å…ƒç´ çš„è¡Œå†…æ ·å¼ã€‚</li><li><code>element.setAttribute(&#39;attr&#39;, &#39;val&#39;)</code>ï¼šè®¾ç½®å…ƒç´ çš„å±æ€§ã€‚</li><li><code>element.addEventListener(&#39;event&#39;, handler)</code>ï¼šæ·»åŠ äº‹ä»¶ç›‘å¬å™¨ã€‚</li></ul></li></ul></li><li><strong>DOM æ ‘æ“ä½œ</strong>ï¼š<ul><li><strong>åˆ›å»º</strong>ï¼š<code>document.createElement(&#39;tag&#39;)</code> (åˆ›å»ºæ–°å…ƒç´ )ã€‚</li><li><strong>æ·»åŠ </strong>ï¼š<code>parent.appendChild(child)</code> (æ·»åŠ å­å…ƒç´ )ã€‚</li><li><strong>åˆ é™¤</strong>ï¼š<code>parent.removeChild(child)</code> (åˆ é™¤å­å…ƒç´ )ã€‚</li><li><strong>æ›¿æ¢</strong>ï¼š<code>parent.replaceChild(newChild, oldChild)</code> (æ›¿æ¢å­å…ƒç´ )ã€‚</li></ul></li></ul><h4 id="3-DOM-çš„ç‰¹ç‚¹"><a href="#3-DOM-çš„ç‰¹ç‚¹" class="headerlink" title="3. DOM çš„ç‰¹ç‚¹"></a>3. DOM çš„ç‰¹ç‚¹</h4><ul><li><strong>æœ‰æ ‡å‡†</strong>ï¼šDOM æ˜¯ç”± W3C åˆ¶å®šçš„æ ‡å‡†ï¼Œå› æ­¤åœ¨ä¸åŒæµè§ˆå™¨ä¸­çš„å®ç°å·®å¼‚è¾ƒå°ã€‚</li><li><strong>æ ‘å½¢ç»“æ„</strong>ï¼šå°† HTML æ–‡æ¡£æŠ½è±¡ä¸ºæ ‘å½¢ç»“æ„ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥é€šè¿‡ç¼–ç¨‹çš„æ–¹å¼åƒæ“ä½œæ ‘ä¸€æ ·æ“ä½œç½‘é¡µã€‚</li></ul><hr><h3 id="BOM-å’Œ-DOM-çš„æ ¸å¿ƒåŒºåˆ«ä¸è”ç³»"><a href="#BOM-å’Œ-DOM-çš„æ ¸å¿ƒåŒºåˆ«ä¸è”ç³»" class="headerlink" title="BOM å’Œ DOM çš„æ ¸å¿ƒåŒºåˆ«ä¸è”ç³»"></a>BOM å’Œ DOM çš„æ ¸å¿ƒåŒºåˆ«ä¸è”ç³»</h3><table><thead><tr><th>ç‰¹æ€§</th><th>BOM (Browser Object Model)</th><th>DOM (Document Object Model)</th></tr></thead><tbody><tr><td><strong>ä¸»è¦åŠŸèƒ½</strong></td><td><strong>æ“ä½œæµè§ˆå™¨çª—å£</strong></td><td><strong>æ“ä½œç½‘é¡µæ–‡æ¡£å†…å®¹</strong></td></tr><tr><td><strong>æ ¸å¿ƒå¯¹è±¡</strong></td><td><code>window</code></td><td><code>document</code></td></tr><tr><td><strong>æ ‡å‡†åŒ–</strong></td><td>æ— ç»Ÿä¸€æ ‡å‡†ï¼ˆå„æµè§ˆå™¨å®ç°ä¸åŒï¼‰</td><td>æœ‰ W3C æ ‡å‡†</td></tr><tr><td><strong>å±‚çº§å…³ç³»</strong></td><td><code>window</code> åŒ…å«äº† <code>location</code>, <code>history</code>, <code>navigator</code> ç­‰ï¼Œ<strong>ä¹ŸåŒ…å«äº† document å¯¹è±¡</strong>ã€‚</td><td><code>document</code> åŒ…å«äº† HTML å…ƒç´ çš„æ ‘å½¢ç»“æ„ã€‚</td></tr></tbody></table><p>å®ƒä»¬çš„å…³ç³»ï¼š</p><p>BOM æ˜¯ DOM çš„è¶…é›†ã€‚window å¯¹è±¡æ˜¯æ‰€æœ‰ JavaScript å¯¹è±¡çš„å…¨å±€å¯¹è±¡ï¼Œå®ƒåŒ…å«äº† document å¯¹è±¡ã€‚æ¢å¥è¯è¯´ï¼Œwindow.document å°±æ˜¯ documentã€‚å› æ­¤ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ document å¯¹è±¡æ¥æ“ä½œç½‘é¡µæ—¶ï¼Œå®é™…ä¸Šæ˜¯é€šè¿‡ window å¯¹è±¡æ¥è®¿é—®çš„ã€‚</p><p>è¿™ä¸ªå…³ç³»å¯ä»¥ç†è§£ä¸ºï¼š</p><p>window -&gt; æµè§ˆå™¨çª—å£</p><p>document -&gt; çª—å£ä¸­åŠ è½½çš„æ–‡æ¡£</p><p>æŒæ¡ BOM å’Œ DOM æ˜¯æˆä¸ºä¸€ä¸ªåˆæ ¼å‰ç«¯å·¥ç¨‹å¸ˆçš„åŸºç¡€ï¼Œå®ƒä»¬æ˜¯ JavaScript é©±åŠ¨ Web é¡µé¢äº¤äº’çš„ä¸¤ä¸ªæœ€é‡è¦çš„å·¥å…·ã€‚</p><p>å¥½çš„ï¼Œæˆ‘å°†æ ¹æ®æ‚¨æä¾›çš„è¿™ä»½ JS å­¦ä¹ ç¬”è®°ï¼Œä»¥ä¸€ç§æ›´æ·±å…¥ã€æ›´æ¡ç†åŒ–çš„æ–¹å¼ï¼Œé€ä¸€è¿›è¡Œè¯¦ç»†çš„å±•å¼€å’Œè¡¥å……ã€‚è¿™ä¸ä»…æ˜¯å¯¹çŸ¥è¯†ç‚¹çš„æ¢³ç†ï¼Œä¹ŸåŒ…å«äº†å…¶èƒŒåçš„åŸç†å’Œä¸€äº›è¿›é˜¶ç”¨æ³•ï¼Œä½¿å…¶æ›´å…·é¢è¯•å’Œå®æˆ˜ä»·å€¼ã€‚</p><hr><h3 id="ä¸€ã€JavaScript-ä¸­çš„æ•°æ®ç±»å‹"><a href="#ä¸€ã€JavaScript-ä¸­çš„æ•°æ®ç±»å‹" class="headerlink" title="ä¸€ã€JavaScript ä¸­çš„æ•°æ®ç±»å‹"></a>ä¸€ã€JavaScript ä¸­çš„æ•°æ®ç±»å‹</h3><h4 id="1-åŸºç¡€æ•°æ®ç±»å‹ï¼ˆåŸå§‹æ•°æ®ç±»å‹ï¼‰"><a href="#1-åŸºç¡€æ•°æ®ç±»å‹ï¼ˆåŸå§‹æ•°æ®ç±»å‹ï¼‰" class="headerlink" title="1. åŸºç¡€æ•°æ®ç±»å‹ï¼ˆåŸå§‹æ•°æ®ç±»å‹ï¼‰"></a>1. åŸºç¡€æ•°æ®ç±»å‹ï¼ˆåŸå§‹æ•°æ®ç±»å‹ï¼‰</h4><ul><li><p><strong>number ç±»å‹</strong>ï¼š</p><ul><li><strong>æ·±å…¥</strong>ï¼šJS é‡‡ç”¨ IEEE 754 æ ‡å‡†çš„åŒç²¾åº¦ 64 ä½æµ®ç‚¹æ•°æ¥è¡¨ç¤ºæ‰€æœ‰æ•°å­—ã€‚è¿™æ„å‘³ç€å®ƒ<strong>æ²¡æœ‰å•ç‹¬çš„æ•´æ•°ç±»å‹</strong>ï¼Œæ‰€æœ‰æ•°å­—éƒ½æ˜¯æµ®ç‚¹æ•°ã€‚</li><li><code>NaN</code> (Not a Number)ï¼šè¡¨ç¤ºéæ•°å­—å€¼ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>typeof NaN</code> ç»“æœæ˜¯ <code>number</code>ã€‚<code>NaN</code> ä¸ç­‰äºè‡ªèº«ï¼Œ<code>NaN === NaN</code> ç»“æœä¸º <code>false</code>ã€‚</li><li><code>Infinity</code>ï¼šè¡¨ç¤ºæ­£æ— ç©·å¤§ï¼Œ<code>+Infinity</code> å’Œ <code>-Infinity</code> åˆ†åˆ«è¡¨ç¤ºæ­£è´Ÿæ— ç©·å¤§ã€‚</li><li><code>0.1 + 0.2 !== 0.3</code>ï¼šç”±äºæµ®ç‚¹æ•°è¡¨ç¤ºçš„ç²¾åº¦é—®é¢˜ï¼Œè¿™ä¸ªç»å…¸é—®é¢˜éœ€è¦æ³¨æ„ã€‚</li></ul></li><li><p><strong>boolean ç±»å‹</strong>ï¼š</p><ul><li><strong>æ·±å…¥</strong>ï¼š<code>true</code> å’Œ <code>false</code>ã€‚åœ¨æ¡ä»¶åˆ¤æ–­ä¸­ï¼Œæ‰€æœ‰æ•°æ®ç±»å‹éƒ½ä¼šè¢«éšå¼è½¬æ¢ä¸ºå¸ƒå°”å€¼ã€‚</li></ul></li><li><p><strong>undefined ç±»å‹</strong>ï¼š</p><ul><li><strong>æ·±å…¥</strong>ï¼šè¡¨ç¤ºä¸€ä¸ª<strong>æœªå®šä¹‰</strong>çš„å˜é‡æˆ–å˜é‡<strong>æœªè¢«èµ‹å€¼</strong>ã€‚<code>typeof undefined</code> ç»“æœä¸º <code>undefined</code>ã€‚å®ƒæ˜¯ä¸€ä¸ªå€¼ä¹Ÿæ˜¯ä¸€ä¸ªç±»å‹ã€‚</li><li><code>null</code>ï¼šä¸ <code>undefined</code> çš„åŒºåˆ«åœ¨äºï¼Œ<code>null</code> æ˜¯ä¸€ç§<strong>æ„å›¾</strong>ï¼Œè¡¨ç¤ºå˜é‡è¢«æ˜¾å¼åœ°èµ‹äºˆäº†â€œç©ºâ€å€¼ã€‚<code>typeof null</code> ç»“æœä¸º <code>object</code>ï¼Œè¿™æ˜¯ä¸€ä¸ªå†å²é—ç•™çš„ bugã€‚</li></ul></li><li><p><strong>string ç±»å‹</strong>ï¼š</p><ul><li><p><strong>æ·±å…¥</strong>ï¼šJS ä¸­<strong>æ²¡æœ‰å­—ç¬¦ç±»å‹</strong>ã€‚å­—ç¬¦ä¸²æ˜¯ä¸å¯å˜çš„ï¼Œä¸€æ—¦åˆ›å»ºå°±ä¸èƒ½ä¿®æ”¹ã€‚</p></li><li><p><strong>åå¼•å·ï¼ˆ     ï¼‰</strong>ï¼šES6 å¼•å…¥ï¼Œæ”¯æŒ<strong>æ¨¡æ¿å­—é¢é‡</strong>ã€‚å®ƒå…è®¸åœ¨å­—ç¬¦ä¸²ä¸­åµŒå…¥å˜é‡å’Œè¡¨è¾¾å¼ï¼Œå¹¶æ”¯æŒå¤šè¡Œä¹¦å†™ï¼Œæå¤§æå‡äº†å­—ç¬¦ä¸²æ‹¼æ¥çš„ä¾¿åˆ©æ€§ã€‚</p><p>JavaScript</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const name = &quot;å¼ ä¸‰&quot;;</span><br><span class="line">console.log(`ä½ å¥½ï¼Œæˆ‘çš„åå­—æ˜¯$&#123;name&#125;ã€‚`);</span><br></pre></td></tr></table></figure></li></ul></li></ul><h4 id="2-æ•°æ®ç±»å‹è½¬æ¢"><a href="#2-æ•°æ®ç±»å‹è½¬æ¢" class="headerlink" title="2. æ•°æ®ç±»å‹è½¬æ¢"></a>2. æ•°æ®ç±»å‹è½¬æ¢</h4><ul><li><p><strong>è½¬æ¢ä¸º number</strong>ï¼š<code>Number(value)</code></p><ul><li><strong>æ·±å…¥</strong>ï¼šä¼šå°è¯•å°†å‚æ•°è½¬æ¢ä¸ºæ•°å­—ã€‚éæ•°å­—å­—ç¬¦ä¸²ä¼šè¿”å› <code>NaN</code>ã€‚<code>null</code> è½¬ä¸º <code>0</code>ï¼Œ<code>undefined</code> è½¬ä¸º <code>NaN</code>ã€‚</li></ul></li><li><p><strong>è½¬æ¢ä¸º boolean</strong>ï¼š<code>Boolean(value)</code></p><ul><li><strong>æ·±å…¥</strong>ï¼šæ‰€æœ‰èƒ½è¢«è½¬æ¢ä¸º <code>false</code> çš„å€¼è¢«ç§°ä¸º<strong>å‡å€¼ï¼ˆFalsy Valueï¼‰</strong>ã€‚</li><li><strong>å‡å€¼åˆ—è¡¨</strong>ï¼š<code>0</code>, <code>-0</code>, <code>null</code>, <code>false</code>, <code>NaN</code>, <code>undefined</code>, <code>&#39;&#39;</code> (ç©ºå­—ç¬¦ä¸²)ã€‚</li><li><strong>çœŸå€¼ï¼ˆTruthy Valueï¼‰</strong>ï¼šé™¤ä¸Šè¿°å‡å€¼å¤–ï¼Œæ‰€æœ‰å€¼éƒ½æ˜¯çœŸå€¼ï¼ŒåŒ…æ‹¬ç©ºæ•°ç»„ <code>[]</code> å’Œç©ºå¯¹è±¡ <code>&#123;&#125;</code>ã€‚</li></ul></li><li><p><strong>è½¬æ¢ä¸º string</strong>ï¼š<code>String(value)</code> æˆ– <code>value + &#39;&#39;</code></p><ul><li><strong>æ·±å…¥</strong>ï¼š<code>value + &#39;&#39;</code> æ˜¯æœ€å¸¸ç”¨çš„æŠ€å·§ï¼Œåˆ©ç”¨äº† JS çš„éšå¼ç±»å‹è½¬æ¢ã€‚</li></ul></li><li><p><strong>parseInt å’Œ parseFloat</strong>ï¼š</p><ul><li><p><strong>æ·±å…¥</strong>ï¼šè¿™ä¸¤ä¸ªå‡½æ•°ä¸“é—¨ç”¨äºä»<strong>å­—ç¬¦ä¸²å¼€å¤´</strong>è§£æå‡ºæ•°å­—ã€‚</p></li><li><p><code>parseInt</code>ï¼šè§£æ<strong>æ•´æ•°</strong>ã€‚é‡åˆ°ç¬¬ä¸€ä¸ªéæ•°å­—å­—ç¬¦å°±åœæ­¢è§£æã€‚</p><p>JavaScript</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">parseInt(&quot;100px&quot;); // 100</span><br><span class="line">parseInt(&quot;a100&quot;);  // NaN</span><br></pre></td></tr></table></figure></li><li><p><code>parseFloat</code>ï¼šè§£æ<strong>æµ®ç‚¹æ•°</strong>ã€‚é‡åˆ°ç¬¬ä¸€ä¸ªéæ•°å­—å­—ç¬¦ï¼ˆé™¤äº†å°æ•°ç‚¹ï¼‰å°±åœæ­¢è§£æã€‚</p></li></ul></li></ul><h3 id="äºŒã€JavaScript-ä¸­çš„å¼¹å‡ºæ¡†"><a href="#äºŒã€JavaScript-ä¸­çš„å¼¹å‡ºæ¡†" class="headerlink" title="äºŒã€JavaScript ä¸­çš„å¼¹å‡ºæ¡†"></a>äºŒã€JavaScript ä¸­çš„å¼¹å‡ºæ¡†</h3><p>è¿™äº›æ˜¯æµè§ˆå™¨æä¾›çš„ BOM APIã€‚</p><ul><li><code>alert(message)</code>ï¼š<strong>è­¦å‘Šæ¡†</strong>ã€‚é˜»å¡å¼ï¼Œæ˜¾ç¤ºä¸€æ¡æ¶ˆæ¯ï¼Œä¸è¿”å›ä»»ä½•å€¼ã€‚</li><li><code>prompt(message, default_value)</code>ï¼š<strong>è¯¢é—®æ¡†</strong>ã€‚è¿”å›ç”¨æˆ·è¾“å…¥çš„å­—ç¬¦ä¸²ï¼Œå¦‚æœç‚¹å‡»â€œå–æ¶ˆâ€åˆ™è¿”å› <code>null</code>ã€‚</li><li><code>confirm(message)</code>ï¼š<strong>ç¡®è®¤æ¡†</strong>ã€‚è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œç”¨æˆ·ç‚¹å‡»â€œç¡®å®šâ€è¿”å› <code>true</code>ï¼Œç‚¹å‡»â€œå–æ¶ˆâ€è¿”å› <code>false</code>ã€‚</li></ul><h3 id="ä¸‰ã€æ¡ä»¶è¿ç®—ç¬¦ï¼š-å’Œ"><a href="#ä¸‰ã€æ¡ä»¶è¿ç®—ç¬¦ï¼š-å’Œ" class="headerlink" title="ä¸‰ã€æ¡ä»¶è¿ç®—ç¬¦ï¼š== å’Œ ==="></a>ä¸‰ã€æ¡ä»¶è¿ç®—ç¬¦ï¼š<code>==</code> å’Œ <code>===</code></h3><ul><li><p><strong>&#x3D;&#x3D;ï¼ˆå®½æ¾ç›¸ç­‰ï¼‰</strong>ï¼šåªæ¯”è¾ƒ<strong>å€¼</strong>ï¼Œä¸æ¯”è¾ƒç±»å‹ã€‚å®ƒåœ¨æ¯”è¾ƒå‰ä¼šè¿›è¡Œ<strong>éšå¼ç±»å‹è½¬æ¢</strong>ã€‚</p><p>JavaScript</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">5 == &quot;5&quot;;     // true</span><br><span class="line">null == undefined; // true</span><br></pre></td></tr></table></figure></li><li><p><strong>&#x3D;&#x3D;&#x3D;ï¼ˆä¸¥æ ¼ç›¸ç­‰ï¼‰</strong>ï¼šæ—¢æ¯”è¾ƒ<strong>å€¼</strong>ï¼Œä¹Ÿæ¯”è¾ƒ<strong>ç±»å‹</strong>ã€‚ä¸ä¼šè¿›è¡Œç±»å‹è½¬æ¢ã€‚</p><p>JavaScript</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">5 === &quot;5&quot;;    // false</span><br><span class="line">null === undefined; // false</span><br></pre></td></tr></table></figure></li><li><p><strong>é¢è¯•å»ºè®®</strong>ï¼šåœ¨å®é™…å¼€å‘ä¸­ï¼Œ<strong>å¼ºçƒˆå»ºè®®ä½¿ç”¨ &#x3D;&#x3D;&#x3D;</strong>ï¼Œä»¥é¿å…ä¸å¿…è¦çš„ç±»å‹è½¬æ¢å¸¦æ¥çš„ bugã€‚</p></li></ul><h3 id="å››ã€å­—ç¬¦ä¸²å’Œæ•°ç»„"><a href="#å››ã€å­—ç¬¦ä¸²å’Œæ•°ç»„" class="headerlink" title="å››ã€å­—ç¬¦ä¸²å’Œæ•°ç»„"></a>å››ã€å­—ç¬¦ä¸²å’Œæ•°ç»„</h3><ul><li><strong>å­—ç¬¦ä¸²</strong>ï¼š<ul><li><strong>æ·±å…¥</strong>ï¼š<code>string</code> æ˜¯ä¸€ä¸ª<strong>å¯¹è±¡</strong>ï¼Œæ‹¥æœ‰ <code>length</code> å±æ€§å’Œè®¸å¤šæ–¹æ³•ï¼ˆå¦‚ <code>split()</code>, <code>slice()</code>, <code>indexOf()</code> ç­‰ï¼‰ï¼Œä½†å®ƒ<strong>ä¸å¯å˜</strong>ã€‚</li></ul></li><li><strong>æ•°ç»„</strong>ï¼š<ul><li><strong>ç‰¹ç‚¹</strong>ï¼š<ol><li><strong>åŠ¨æ€é•¿åº¦</strong>ï¼šJS æ•°ç»„çš„é•¿åº¦æ˜¯å¯å˜çš„ï¼Œä½ å¯ä»¥éšæ—¶æ·»åŠ æˆ–åˆ é™¤å…ƒç´ ã€‚</li><li><strong>å¼‚æ„æ€§</strong>ï¼šä¸€ä¸ªæ•°ç»„å¯ä»¥å­˜æ”¾ä¸åŒæ•°æ®ç±»å‹çš„å…ƒç´ ï¼Œå¦‚ <code>[1, &quot;hello&quot;, true]</code>ã€‚</li></ol></li><li><strong>æ–¹æ³•</strong>ï¼š<ul><li><code>push()</code>, <code>pop()</code>ï¼šåœ¨æ•°ç»„<strong>æœ«å°¾</strong>æ·»åŠ å’Œåˆ é™¤ã€‚</li><li><code>unshift()</code>, <code>shift()</code>ï¼šåœ¨æ•°ç»„<strong>å¼€å¤´</strong>æ·»åŠ å’Œåˆ é™¤ã€‚</li><li><code>splice()</code>ï¼šåŠŸèƒ½å¼ºå¤§çš„æ–¹æ³•ï¼Œç”¨äºåˆ é™¤ã€æ›¿æ¢æˆ–æ·»åŠ å…ƒç´ ã€‚</li><li><code>forEach()</code>, <code>map()</code>, <code>filter()</code>ï¼šå¸¸ç”¨çš„éå†æ–¹æ³•ã€‚</li></ul></li></ul></li></ul><h3 id="äº”ã€å‡½æ•°å’Œå¯¹è±¡"><a href="#äº”ã€å‡½æ•°å’Œå¯¹è±¡" class="headerlink" title="äº”ã€å‡½æ•°å’Œå¯¹è±¡"></a>äº”ã€å‡½æ•°å’Œå¯¹è±¡</h3><ul><li><strong>å‡½æ•°</strong>ï¼š<ul><li><strong>æ·±å…¥</strong>ï¼šåœ¨ JS ä¸­ï¼Œå‡½æ•°æ˜¯<strong>ä¸€ç­‰å…¬æ°‘ï¼ˆFirst-Class Citizensï¼‰</strong>ã€‚è¿™æ„å‘³ç€å‡½æ•°å¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’ã€ä½œä¸ºè¿”å›å€¼ï¼Œä¹Ÿå¯ä»¥èµ‹å€¼ç»™å˜é‡ã€‚</li></ul></li><li><strong>å¯¹è±¡</strong>ï¼š<ul><li><strong>æ·±å…¥</strong>ï¼šJS å¯¹è±¡æ˜¯<strong>é”®å€¼å¯¹</strong>çš„é›†åˆã€‚é”®æ˜¯å­—ç¬¦ä¸²ï¼Œå€¼å¯ä»¥æ˜¯ä»»æ„ç±»å‹ã€‚</li><li><strong>è®¿é—®å±æ€§</strong>ï¼š<ul><li>ç‚¹è¯­æ³•ï¼š<code>obj.prop</code>ã€‚</li><li>ä¸­æ‹¬å·è¯­æ³•ï¼š<code>obj[&#39;prop&#39;]</code>ã€‚åè€…é€‚ç”¨äºé”®ååŒ…å«ç‰¹æ®Šå­—ç¬¦æˆ–åŠ¨æ€é”®åçš„æƒ…å†µã€‚</li></ul></li></ul></li></ul><h3 id="å…­ã€å®šæ—¶å™¨"><a href="#å…­ã€å®šæ—¶å™¨" class="headerlink" title="å…­ã€å®šæ—¶å™¨"></a>å…­ã€å®šæ—¶å™¨</h3><ul><li><strong>setTimeout(callback, delay)</strong>ï¼š<ul><li><strong>ç”¨é€”</strong>ï¼šåªæ‰§è¡Œ<strong>ä¸€æ¬¡</strong>ã€‚</li><li><strong>æ·±å…¥</strong>ï¼š<code>delay</code> å‚æ•°æ˜¯<strong>æœ€å°å»¶è¿Ÿæ—¶é—´</strong>ã€‚ç”±äº JS æ˜¯å•çº¿ç¨‹çš„ï¼Œå¦‚æœä¸»çº¿ç¨‹è¢«é˜»å¡ï¼Œ<code>callback</code> çš„æ‰§è¡Œä¼šå»¶è¿Ÿã€‚</li></ul></li><li><strong>setInterval(callback, delay)</strong>ï¼š<ul><li><strong>ç”¨é€”</strong>ï¼š<strong>é‡å¤</strong>æ‰§è¡Œã€‚</li><li><strong>æ·±å…¥</strong>ï¼šæ¯æ¬¡æ‰§è¡Œå®Œå›è°ƒå‡½æ•°åï¼Œ<code>setInterval</code> éƒ½ä¼šå°†ä¸‹ä¸€ä¸ªå›è°ƒä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—ã€‚</li></ul></li></ul><h3 id="ä¸ƒã€ES6-æ–°ç‰¹æ€§ï¼ˆé‡è¦ï¼‰"><a href="#ä¸ƒã€ES6-æ–°ç‰¹æ€§ï¼ˆé‡è¦ï¼‰" class="headerlink" title="ä¸ƒã€ES6 æ–°ç‰¹æ€§ï¼ˆé‡è¦ï¼‰"></a>ä¸ƒã€ES6 æ–°ç‰¹æ€§ï¼ˆé‡è¦ï¼‰</h3><ul><li><strong>let å’Œ const</strong>ï¼š<ul><li><strong>var çš„é—®é¢˜</strong>ï¼šå…¨å±€ä½œç”¨åŸŸï¼Œå¯ä»¥è¢«é‡å¤å£°æ˜ï¼Œæœ‰å˜é‡æå‡ã€‚</li><li><strong>let</strong>ï¼š<strong>å—çº§ä½œç”¨åŸŸ</strong>ï¼ˆ<code>&#123;&#125;</code> å†…ï¼‰ï¼Œä¸èƒ½é‡å¤å£°æ˜ï¼Œæ²¡æœ‰å˜é‡æå‡ã€‚</li><li><strong>const</strong>ï¼š<strong>å—çº§ä½œç”¨åŸŸ</strong>ï¼Œç”¨äºå£°æ˜<strong>å¸¸é‡</strong>ã€‚ä¸€æ—¦å£°æ˜ï¼Œå…¶å¼•ç”¨åœ°å€ä¸èƒ½æ”¹å˜ã€‚</li></ul></li><li><strong>å­—ç¬¦ä¸²æ¨¡æ¿å­—é¢é‡</strong>ï¼šä½¿ç”¨åå¼•å·ï¼ˆ<code>     </code>ï¼‰åˆ›å»ºå¤šè¡Œå­—ç¬¦ä¸²å’ŒåµŒå…¥å˜é‡ã€‚</li><li><strong>ç®­å¤´å‡½æ•°</strong>ï¼š<ul><li><strong>è¯­æ³•</strong>ï¼š<code>const func = (param) =&gt; &#123; ... &#125;</code>ã€‚</li><li><strong>this æŒ‡å‘</strong>ï¼šç®­å¤´å‡½æ•°<strong>æ²¡æœ‰è‡ªå·±çš„ this</strong>ï¼Œå®ƒä¼šæ•è·å…¶æ‰€åœ¨ä¸Šä¸‹æ–‡çš„ <code>this</code> å€¼ã€‚è¿™è§£å†³äº†ä¼ ç»Ÿå‡½æ•°ä¸­ <code>this</code> ç»‘å®šå¤æ‚çš„é—®é¢˜ã€‚</li></ul></li><li><strong>å¯å˜å‚æ•°</strong>ï¼š<code>...args</code>ï¼Œç”¨äºå‡½æ•°æ¥æ”¶ä¸ç¡®å®šæ•°é‡çš„å‚æ•°ã€‚</li></ul><h3 id="å…«ã€DOM"><a href="#å…«ã€DOM" class="headerlink" title="å…«ã€DOM"></a>å…«ã€DOM</h3><ul><li><strong>ä»€ä¹ˆæ˜¯ DOM</strong>ï¼š<ul><li><strong>æ·±å…¥</strong>ï¼šDOM æ˜¯æµè§ˆå™¨å°† HTML æ–‡æ¡£è§£æåç”Ÿæˆçš„<strong>æ ‘å½¢ç»“æ„</strong>ï¼Œæ˜¯ JavaScript æ“ä½œç½‘é¡µçš„æ¥å£ã€‚HTML æ–‡ä»¶æ˜¯æ–‡æœ¬ï¼ŒDOM æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥è¢« JS ç¼–ç¨‹æ§åˆ¶ã€‚</li></ul></li><li><strong>DOM æ“ä½œ</strong>ï¼š<ul><li><strong>è·å–æ ‡ç­¾å¯¹è±¡</strong>ï¼š<ul><li><code>document.getElementById()</code></li><li><code>document.getElementsByClassName()</code></li><li><code>document.querySelector()</code> (æ›´å¸¸ç”¨)</li></ul></li><li><strong>æ“ä½œå±æ€§</strong>ï¼š<ul><li><code>element.attribute = &#39;...&#39;</code> (ä¾‹å¦‚ <code>element.style.color = &#39;red&#39;</code>)</li><li><code>element.setAttribute(&#39;attr&#39;, &#39;value&#39;)</code></li></ul></li><li><strong>æ“ä½œå†…å®¹</strong>ï¼š<ul><li><code>element.innerHTML</code>ï¼šè·å–æˆ–è®¾ç½®å…ƒç´ çš„ HTML å†…å®¹ï¼ˆåŒ…æ‹¬å­æ ‡ç­¾ï¼‰ã€‚</li><li><code>element.textContent</code>ï¼šè·å–æˆ–è®¾ç½®å…ƒç´ çš„æ–‡æœ¬å†…å®¹ï¼ˆä¸å« HTMLï¼‰ã€‚</li></ul></li></ul></li></ul><p>å¥½çš„ï¼Œæˆ‘å°†æ ¹æ®æ‚¨æä¾›çš„è¿™ä»½è¯¦å°½çš„ Web æŠ€æœ¯ç¬”è®°ï¼Œä»¥ä¸€ç§æ›´ä¸“ä¸šã€æ›´ç³»ç»Ÿçš„æ–¹å¼ï¼Œå¯¹å…¶è¿›è¡Œé‡æ–°ç»„ç»‡ã€è¡¥å……å’Œæ·±å…¥è§£æï¼Œä½¿å…¶æˆä¸ºä¸€ä»½é«˜è´¨é‡çš„æŠ€æœ¯è®²è§£æˆ–é¢è¯•å›ç­”ã€‚</p><hr><h3 id="ä¸€ã€Web-æ¶æ„ä¸ç½‘ç»œåŸºç¡€"><a href="#ä¸€ã€Web-æ¶æ„ä¸ç½‘ç»œåŸºç¡€" class="headerlink" title="ä¸€ã€Web æ¶æ„ä¸ç½‘ç»œåŸºç¡€"></a>ä¸€ã€Web æ¶æ„ä¸ç½‘ç»œåŸºç¡€</h3><h4 id="1-å¸¸è§çš„è½¯ä»¶æ¶æ„"><a href="#1-å¸¸è§çš„è½¯ä»¶æ¶æ„" class="headerlink" title="1. å¸¸è§çš„è½¯ä»¶æ¶æ„"></a>1. å¸¸è§çš„è½¯ä»¶æ¶æ„</h4><ul><li><strong>B&#x2F;S æ¶æ„ (Browser&#x2F;Server)</strong>ï¼š<ul><li><strong>æ¦‚å¿µ</strong>ï¼šæµè§ˆå™¨å’ŒæœåŠ¡å™¨æ¶æ„ã€‚å®¢æˆ·ç«¯åªéœ€å®‰è£…ä¸€ä¸ªé€šç”¨çš„æµè§ˆå™¨ï¼Œä¸šåŠ¡é€»è¾‘å’Œæ•°æ®éƒ½å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯ã€‚</li><li><strong>ä¼˜ç‚¹</strong>ï¼šæ˜“äºç»´æŠ¤å’Œå‡çº§ï¼Œè·¨å¹³å°æ€§å¥½ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šå¯¹ç½‘ç»œä¾èµ–æ€§å¼ºï¼Œç”¨æˆ·ä½“éªŒå¯èƒ½ä¸å¦‚ C&#x2F;S æ¶æ„ã€‚</li></ul></li><li><strong>C&#x2F;S æ¶æ„ (Client&#x2F;Server)</strong>ï¼š<ul><li><strong>æ¦‚å¿µ</strong>ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨æ¶æ„ã€‚å®¢æˆ·ç«¯éœ€è¦å®‰è£…ä¸“ç”¨çš„åº”ç”¨ç¨‹åºï¼Œä¾‹å¦‚æ¡Œé¢ QQã€å¾®ä¿¡ç­‰ã€‚</li><li><strong>ä¼˜ç‚¹</strong>ï¼šç”¨æˆ·ä½“éªŒå¥½ï¼Œå“åº”é€Ÿåº¦å¿«ï¼Œå¯ä»¥ç¦»çº¿ä½¿ç”¨ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šç»´æŠ¤å’Œå‡çº§å¤æ‚ï¼Œéœ€è¦ä¸ºä¸åŒå¹³å°å¼€å‘ä¸åŒç‰ˆæœ¬ã€‚</li></ul></li></ul><h4 id="2-ç½‘ç»œç¼–ç¨‹ä¸‰è¦ç´ "><a href="#2-ç½‘ç»œç¼–ç¨‹ä¸‰è¦ç´ " class="headerlink" title="2. ç½‘ç»œç¼–ç¨‹ä¸‰è¦ç´ "></a>2. ç½‘ç»œç¼–ç¨‹ä¸‰è¦ç´ </h4><p>è¿™æ˜¯æ‰€æœ‰ç½‘ç»œé€šä¿¡çš„åŸºç¡€ï¼Œç†è§£è¿™ä¸‰ç‚¹è‡³å…³é‡è¦ã€‚</p><ul><li><strong>IP åœ°å€</strong>ï¼šè®¾å¤‡åœ¨ç½‘ç»œä¸Šçš„å”¯ä¸€æ ‡è¯†ï¼Œç±»ä¼¼äºä½ çš„å®¶åº­ä½å€ã€‚å®ƒç”¨äºåœ¨ç½‘ç»œä¸­å®šä½åˆ°ä¸€å°å…·ä½“çš„è®¡ç®—æœºã€‚</li><li><strong>ç«¯å£å·</strong>ï¼šåº”ç”¨ç¨‹åºåœ¨è®¡ç®—æœºä¸Šçš„å”¯ä¸€æ ‡è¯†ï¼Œç±»ä¼¼äºä½ å®¶é‡Œçš„ç”µè¯å·ç æˆ–é—¨ç‰Œå·ã€‚ä¸€å°è®¡ç®—æœºä¸Šå¯ä»¥è¿è¡Œå¤šä¸ªåº”ç”¨ç¨‹åºï¼Œç«¯å£å·ç”¨äºåŒºåˆ†å®ƒä»¬ã€‚</li><li><strong>åè®®</strong>ï¼šé€šä¿¡è§„åˆ™ã€‚å°±åƒäººä¸äººäº¤æµéœ€è¦éµå¾ªå…±åŒçš„è¯­è¨€ä¸€æ ·ï¼Œç½‘ç»œè®¾å¤‡ä¹‹é—´é€šä¿¡ä¹Ÿéœ€è¦éµå¾ªç‰¹å®šçš„åè®®ï¼Œå¦‚ HTTPã€FTPã€TCP ç­‰ã€‚</li></ul><h4 id="3-èµ„æºçš„åˆ†ç±»"><a href="#3-èµ„æºçš„åˆ†ç±»" class="headerlink" title="3. èµ„æºçš„åˆ†ç±»"></a>3. èµ„æºçš„åˆ†ç±»</h4><ul><li><strong>é™æ€èµ„æº</strong>ï¼š<ul><li><strong>ç‰¹ç‚¹</strong>ï¼šå†…å®¹å›ºå®šï¼Œæ— éœ€æœåŠ¡å™¨ç«¯å¤„ç†ï¼Œå¯ç”±æµè§ˆå™¨ç›´æ¥è§£æã€‚</li><li><strong>åŸç†</strong>ï¼šå½“æµè§ˆå™¨è¯·æ±‚é™æ€èµ„æºæ—¶ï¼ŒWeb æœåŠ¡å™¨ç›´æ¥ä»æ–‡ä»¶ç³»ç»Ÿä¸­è¯»å–æ–‡ä»¶å¹¶è¿”å›ã€‚</li><li><strong>ç¤ºä¾‹</strong>ï¼šHTMLã€CSSã€JSã€å›¾ç‰‡ç­‰ã€‚</li></ul></li><li><strong>åŠ¨æ€èµ„æº</strong>ï¼š<ul><li><strong>ç‰¹ç‚¹</strong>ï¼šå†…å®¹åŠ¨æ€ç”Ÿæˆï¼Œéœ€è¦æœåŠ¡å™¨ç«¯å¤„ç†åæ‰èƒ½è¿”å›ç»™æµè§ˆå™¨ã€‚</li><li><strong>åŸç†</strong>ï¼šå½“æµè§ˆå™¨è¯·æ±‚åŠ¨æ€èµ„æºæ—¶ï¼ŒWeb æœåŠ¡å™¨å°†è¯·æ±‚äº¤ç»™<strong>åå°ç¨‹åº</strong>ï¼ˆå¦‚ Servlet å®¹å™¨ï¼‰ï¼Œåå°ç¨‹åºæ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼Œç”Ÿæˆé™æ€å†…å®¹ï¼ˆå¦‚ HTMLã€JSON ç­‰ï¼‰ï¼Œç„¶åè¿”å›ç»™æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨å†è¿”å›ç»™æµè§ˆå™¨ã€‚</li><li><strong>ç¤ºä¾‹</strong>ï¼šServletã€JSPã€PHPã€ASP ç­‰ã€‚</li></ul></li></ul><h3 id="äºŒã€Web-æœåŠ¡å™¨"><a href="#äºŒã€Web-æœåŠ¡å™¨" class="headerlink" title="äºŒã€Web æœåŠ¡å™¨"></a>äºŒã€Web æœåŠ¡å™¨</h3><h4 id="1-ä½œç”¨"><a href="#1-ä½œç”¨" class="headerlink" title="1. ä½œç”¨"></a>1. ä½œç”¨</h4><p>Web æœåŠ¡å™¨ï¼ˆä¹Ÿç§°ä¸º <strong>Web å®¹å™¨</strong>ï¼‰æ˜¯ä¸€ä¸ªè½¯ä»¶ï¼Œå®ƒè´Ÿè´£å¤„ç† HTTP è¯·æ±‚ï¼Œå¹¶æä¾›é™æ€èµ„æºå’ŒåŠ¨æ€èµ„æºã€‚å®ƒä¸ºåŠ¨æ€èµ„æºï¼ˆå¦‚ Servletï¼‰æä¾›äº†ä¸€ä¸ªè¿è¡Œç¯å¢ƒã€‚</p><h4 id="2-å¸¸è§çš„-Web-æœåŠ¡å™¨"><a href="#2-å¸¸è§çš„-Web-æœåŠ¡å™¨" class="headerlink" title="2. å¸¸è§çš„ Web æœåŠ¡å™¨"></a>2. å¸¸è§çš„ Web æœåŠ¡å™¨</h4><ul><li><strong>Tomcat</strong>ï¼šApache åŸºé‡‘ç»„ç»‡å¼€å‘ï¼Œ<strong>ä¸­å°å‹çš„ JavaEE æœåŠ¡å™¨</strong>ï¼Œ<strong>å…è´¹</strong>ä¸”å¼€æºã€‚å®ƒæ˜¯ä¸€ä¸ª<strong>Servlet å®¹å™¨</strong>ï¼Œèƒ½å¤Ÿè¿è¡Œ Servlet å’Œ JSPã€‚</li><li><strong>WebSphere</strong>ï¼šIBM å…¬å¸å¼€å‘ï¼Œ<strong>å¤§å‹çš„ JavaEE æœåŠ¡å™¨</strong>ï¼Œ<strong>æ”¶è´¹</strong>ã€‚åŠŸèƒ½å¼ºå¤§ï¼Œæ”¯æŒå®Œæ•´çš„ JavaEE è§„èŒƒã€‚</li><li><strong>WebLogic</strong>ï¼šOracle å…¬å¸å¼€å‘ï¼Œ<strong>å¤§å‹çš„ JavaEE æœåŠ¡å™¨</strong>ï¼Œ<strong>æ”¶è´¹</strong>ã€‚</li><li><strong>JBoss&#x2F;WildFly</strong>ï¼šå¼€æºï¼Œä½†å…¶å•†ä¸šç‰ˆæ”¶è´¹ã€‚</li></ul><h3 id="ä¸‰ã€Tomcat-çš„ä½¿ç”¨ä¸é…ç½®"><a href="#ä¸‰ã€Tomcat-çš„ä½¿ç”¨ä¸é…ç½®" class="headerlink" title="ä¸‰ã€Tomcat çš„ä½¿ç”¨ä¸é…ç½®"></a>ä¸‰ã€Tomcat çš„ä½¿ç”¨ä¸é…ç½®</h3><ul><li><strong>å®‰è£…ä¸å¯åŠ¨</strong>ï¼šTomcat æ˜¯å…å®‰è£…çš„ï¼Œè§£å‹å³å¯ã€‚å¯åŠ¨å‰éœ€è¦é…ç½® <code>JAVA_HOME</code> ç¯å¢ƒå˜é‡ã€‚å¯åŠ¨åï¼Œé»˜è®¤ç›‘å¬ <code>8080</code> ç«¯å£ã€‚</li><li><strong>ç«¯å£å·ä¿®æ”¹</strong>ï¼š<ul><li><strong>é¢è¯•é¢˜</strong>ï¼šä¿®æ”¹ Tomcat ç«¯å£å·åœ¨å“ªä¸ªæ–‡ä»¶ï¼Ÿ</li><li><strong>å›ç­”</strong>ï¼šåœ¨ Tomcat çš„ <code>conf</code> ç›®å½•ä¸‹çš„ <code>server.xml</code> æ–‡ä»¶ä¸­ï¼Œä¿®æ”¹ <code>&lt;Connector&gt;</code> æ ‡ç­¾çš„ <code>port</code> å±æ€§ã€‚</li><li><strong>æ³¨æ„</strong>ï¼šHTTP åè®®çš„é»˜è®¤ç«¯å£å·æ˜¯ <code>80</code>ã€‚å¦‚æœå°† Tomcat ç«¯å£å·æ”¹ä¸º <code>80</code>ï¼Œé‚£ä¹ˆè®¿é—®æ—¶å°±å¯ä»¥çœç•¥ç«¯å£å·ï¼Œä¾‹å¦‚ <code>http://localhost/</code>ã€‚</li></ul></li><li><strong>é¡¹ç›®éƒ¨ç½²</strong>ï¼š<ul><li><strong>é™æ€é¡¹ç›®</strong>ï¼šå°† HTMLã€CSSã€JS ç­‰æ–‡ä»¶ç›´æ¥æ”¾åˆ° <code>webapps</code> ç›®å½•ä¸‹çš„æ–‡ä»¶å¤¹ä¸­ã€‚</li><li><strong>åŠ¨æ€é¡¹ç›®</strong>ï¼šå°†åŒ…å« <code>WEB-INF</code> æ–‡ä»¶å¤¹çš„æ•´ä¸ªé¡¹ç›®ç›®å½•æ”¾åˆ° <code>webapps</code> ç›®å½•ä¸‹ã€‚</li><li><strong>WEB-INF</strong>ï¼šè¿™æ˜¯åŠ¨æ€é¡¹ç›®çš„æ ¸å¿ƒç›®å½•ï¼Œå…·æœ‰ç‰¹æ®Šä½œç”¨ï¼Œå¤–éƒ¨æ— æ³•ç›´æ¥é€šè¿‡ URL è®¿é—®è¯¥ç›®å½•ä¸‹çš„èµ„æºï¼Œä¿è¯äº†é¡¹ç›®çš„å®‰å…¨æ€§ã€‚<ul><li><code>classes</code>ï¼šå­˜æ”¾æ‰€æœ‰ç¼–è¯‘åçš„ <code>.class</code> å­—èŠ‚ç æ–‡ä»¶ã€‚</li><li><code>lib</code>ï¼šå­˜æ”¾é¡¹ç›®ä¾èµ–çš„ç¬¬ä¸‰æ–¹ <code>.jar</code> åŒ…ã€‚</li><li><code>web.xml</code>ï¼šWeb é¡¹ç›®çš„<strong>æ ¸å¿ƒé…ç½®æ–‡ä»¶</strong>ï¼Œç”¨äºé…ç½® Servletã€ç›‘å¬å™¨ã€è¿‡æ»¤å™¨ç­‰ã€‚</li></ul></li></ul></li></ul><h3 id="å››ã€Servlet-æ·±å…¥è§£æ"><a href="#å››ã€Servlet-æ·±å…¥è§£æ" class="headerlink" title="å››ã€Servlet æ·±å…¥è§£æ"></a>å››ã€Servlet æ·±å…¥è§£æ</h3><h4 id="1-Servlet-çš„æ¦‚å¿µå’Œæœ¬è´¨"><a href="#1-Servlet-çš„æ¦‚å¿µå’Œæœ¬è´¨" class="headerlink" title="1. Servlet çš„æ¦‚å¿µå’Œæœ¬è´¨"></a>1. Servlet çš„æ¦‚å¿µå’Œæœ¬è´¨</h4><ul><li><strong>æ¦‚å¿µ</strong>ï¼šServlet æ˜¯è¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„ Java ç¨‹åºï¼Œç”¨äºå¤„ç†å®¢æˆ·ç«¯è¯·æ±‚å¹¶ç”ŸæˆåŠ¨æ€å“åº”ã€‚å®ƒä¸æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ç¨‹åºï¼Œ<strong>å¿…é¡»éƒ¨ç½²åˆ°æ”¯æŒ Servlet çš„å®¹å™¨ä¸­</strong>ï¼ˆå¦‚ Tomcatï¼‰æ‰èƒ½è¿è¡Œã€‚</li><li><strong>æœ¬è´¨</strong>ï¼šServlet çš„æœ¬è´¨æ˜¯ä¸€ä¸ª<strong>æ¥å£</strong>ã€‚æ‰€æœ‰è‡ªå®šä¹‰çš„ Servlet ç±»éƒ½å¿…é¡»<strong>å®ç° javax.servlet.Servlet æ¥å£</strong>ã€‚</li></ul><h4 id="2-Servlet-çš„æ‰§è¡ŒåŸç†ï¼ˆè¯¦ç»†è§£é‡Šï¼‰"><a href="#2-Servlet-çš„æ‰§è¡ŒåŸç†ï¼ˆè¯¦ç»†è§£é‡Šï¼‰" class="headerlink" title="2. Servlet çš„æ‰§è¡ŒåŸç†ï¼ˆè¯¦ç»†è§£é‡Šï¼‰"></a>2. Servlet çš„æ‰§è¡ŒåŸç†ï¼ˆè¯¦ç»†è§£é‡Šï¼‰</h4><p>è¿™æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„é¢è¯•ç‚¹ï¼Œéœ€è¦ä»è¯·æ±‚-å“åº”çš„æ•´ä¸ªæµç¨‹æ¥è¯¦ç»†é˜è¿°ã€‚</p><ol><li><strong>å®¢æˆ·ç«¯è¯·æ±‚</strong>ï¼šç”¨æˆ·åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ URLï¼Œå‘æœåŠ¡å™¨å‘é€ä¸€ä¸ª HTTP è¯·æ±‚ã€‚</li><li><strong>Web æœåŠ¡å™¨æ¥æ”¶è¯·æ±‚</strong>ï¼šWeb æœåŠ¡å™¨ï¼ˆTomcatï¼‰æ¥æ”¶åˆ°è¿™ä¸ªè¯·æ±‚ã€‚</li><li><strong>Servlet å®¹å™¨å¤„ç†</strong>ï¼šTomcat ä¼šæ ¹æ®è¯·æ±‚ URLï¼Œåœ¨ <code>web.xml</code> æˆ–é€šè¿‡æ³¨è§£ï¼ˆå¦‚ <code>@WebServlet</code>ï¼‰æŸ¥æ‰¾åŒ¹é…çš„ Servletã€‚</li><li><strong>Servlet å®ä¾‹åˆ›å»º</strong>ï¼š<ul><li>å¦‚æœæ˜¯<strong>ç¬¬ä¸€æ¬¡</strong>è®¿é—®è¯¥ Servletï¼ŒServlet å®¹å™¨ä¼šåˆ›å»ºä¸€ä¸ªè¯¥ Servlet çš„å®ä¾‹ã€‚</li><li><strong>é¢è¯•ç‚¹</strong>ï¼šServlet æ˜¯<strong>å•ä¾‹çš„</strong>ï¼Œä¸€ä¸ª Servlet åœ¨å®¹å™¨ä¸­åªä¼šè¢«åˆ›å»ºä¸€æ¬¡ã€‚</li></ul></li><li><strong>init() æ–¹æ³•æ‰§è¡Œ</strong>ï¼š<ul><li>åœ¨ Servlet å®ä¾‹åˆ›å»ºåï¼Œå®¹å™¨ä¼šç«‹å³è°ƒç”¨å®ƒçš„ <code>init()</code> æ–¹æ³•ã€‚</li><li><code>init()</code> æ–¹æ³•åªåœ¨ Servlet çš„<strong>ç”Ÿå‘½å‘¨æœŸä¸­æ‰§è¡Œä¸€æ¬¡</strong>ï¼Œç”¨äºå®Œæˆä¸€äº›åˆå§‹åŒ–å·¥ä½œï¼Œå¦‚åŠ è½½é…ç½®æ–‡ä»¶ã€æ•°æ®åº“è¿æ¥ç­‰ã€‚</li></ul></li><li><strong>service() æ–¹æ³•æ‰§è¡Œ</strong>ï¼š<ul><li>æ¯æ¬¡å®¢æˆ·ç«¯è¯·æ±‚è¯¥ Servlet æ—¶ï¼Œå®¹å™¨éƒ½ä¼šè°ƒç”¨å®ƒçš„ <code>service()</code> æ–¹æ³•ã€‚</li><li><code>service()</code> æ–¹æ³•æ ¹æ®è¯·æ±‚çš„ HTTP æ–¹æ³•ï¼ˆGETã€POST ç­‰ï¼‰ï¼Œå°†è¯·æ±‚åˆ†å‘ç»™ç›¸åº”çš„ <code>doGet()</code> æˆ– <code>doPost()</code> æ–¹æ³•ã€‚</li><li><strong>é¢è¯•ç‚¹</strong>ï¼š<code>service()</code> æ–¹æ³•æ˜¯å¤„ç†è¯·æ±‚çš„æ ¸å¿ƒæ–¹æ³•ï¼Œå®ƒæ˜¯<strong>å¤šçº¿ç¨‹çš„</strong>ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½ä¼šåœ¨æ–°çº¿ç¨‹ä¸­æ‰§è¡Œ <code>service()</code> æ–¹æ³•ã€‚</li></ul></li><li><strong>destroy() æ–¹æ³•æ‰§è¡Œ</strong>ï¼š<ul><li>å½“ Servlet å®¹å™¨å…³é—­ï¼Œæˆ–è€…å†³å®šå¸è½½è¯¥ Servlet æ—¶ï¼Œä¼šè°ƒç”¨å…¶ <code>destroy()</code> æ–¹æ³•ã€‚</li><li><code>destroy()</code> æ–¹æ³•ä¹Ÿåªæ‰§è¡Œä¸€æ¬¡ï¼Œç”¨äºé‡Šæ”¾èµ„æºï¼Œå¦‚å…³é—­æ•°æ®åº“è¿æ¥æ± ã€‚</li></ul></li></ol><p><strong>æ€»ç»“</strong>ï¼šServlet çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ï¼š<strong>åˆ›å»ºå®ä¾‹</strong> -&gt; <strong>è°ƒç”¨ init()</strong> (åªä¸€æ¬¡) -&gt; <strong>è°ƒç”¨ service()</strong> (å¤šæ¬¡) -&gt; <strong>è°ƒç”¨ destroy()</strong> (åªä¸€æ¬¡) -&gt; <strong>é”€æ¯å®ä¾‹</strong>ã€‚</p><p>å¥½çš„ï¼Œæˆ‘ä»¬æ¥å°†â€œç½‘ç»œç¼–ç¨‹ä¸‰è¦ç´ â€è¿™ä¸€éƒ¨åˆ†è¿›è¡Œæ›´æ·±å…¥ã€æ›´è¯¦ç»†çš„å±•å¼€ï¼Œå¹¶è¡¥å……å¸¸è§åº”ç”¨çš„é»˜è®¤ç«¯å£å·ï¼Œä½¿å…¶æ›´å…·å®ç”¨æ€§å’Œé¢è¯•ä»·å€¼ã€‚</p><hr><h3 id="ä¸€ã€ç½‘ç»œç¼–ç¨‹ä¸‰è¦ç´ ï¼šæ·±å…¥è§£æ"><a href="#ä¸€ã€ç½‘ç»œç¼–ç¨‹ä¸‰è¦ç´ ï¼šæ·±å…¥è§£æ" class="headerlink" title="ä¸€ã€ç½‘ç»œç¼–ç¨‹ä¸‰è¦ç´ ï¼šæ·±å…¥è§£æ"></a>ä¸€ã€ç½‘ç»œç¼–ç¨‹ä¸‰è¦ç´ ï¼šæ·±å…¥è§£æ</h3><p>ç½‘ç»œç¼–ç¨‹çš„æœ¬è´¨å°±æ˜¯è®©ä¸åŒçš„è®¡ç®—æœºä¸Šçš„åº”ç”¨ç¨‹åºèƒ½å¤Ÿè¿›è¡Œé€šä¿¡ã€‚è¦å®ç°è¿™ä¸€ç‚¹ï¼Œå¿…é¡»è§£å†³ä¸‰ä¸ªæ ¸å¿ƒé—®é¢˜ï¼š</p><ol><li><strong>æ‰¾åˆ°å¯¹æ–¹è®¡ç®—æœº</strong>ï¼šIP åœ°å€</li><li><strong>æ‰¾åˆ°å¯¹æ–¹è®¡ç®—æœºä¸Šçš„åº”ç”¨ç¨‹åº</strong>ï¼šç«¯å£å·</li><li><strong>ä»¥ä»€ä¹ˆæ ·çš„è§„åˆ™è¿›è¡Œé€šä¿¡</strong>ï¼šåè®®</li></ol><p>è¿™ä¸‰è€…ç¼ºä¸€ä¸å¯ã€‚</p><h4 id="1-IP-åœ°å€-Internet-Protocol-Address"><a href="#1-IP-åœ°å€-Internet-Protocol-Address" class="headerlink" title="1. IP åœ°å€ (Internet Protocol Address)"></a>1. IP åœ°å€ (Internet Protocol Address)</h4><ul><li><strong>æ¦‚å¿µ</strong>ï¼šIP åœ°å€æ˜¯åˆ†é…ç»™è¿æ¥åˆ°ç½‘ç»œä¸­çš„è®¾å¤‡ï¼ˆå¦‚è®¡ç®—æœºã€æ‰‹æœºã€æœåŠ¡å™¨ï¼‰çš„ä¸€ä¸²æ•°å­—æ ‡è¯†ã€‚</li><li><strong>ä½œç”¨</strong>ï¼šå®ƒç”¨äº<strong>å”¯ä¸€åœ°æ ‡è¯†ç½‘ç»œä¸Šçš„ä¸€ä¸ªè®¾å¤‡</strong>ã€‚æ•°æ®åŒ…åœ¨ç½‘ç»œä¸­ä¼ è¾“æ—¶ï¼Œå°±æ˜¯æ ¹æ® IP åœ°å€æ¥è·¯ç”±å’Œå¯»å€çš„ã€‚</li><li><strong>ç‰ˆæœ¬</strong>ï¼š<ul><li><strong>IPv4</strong>ï¼šç”± 32 ä½äºŒè¿›åˆ¶æ•°ç»„æˆï¼Œé€šå¸¸è¡¨ç¤ºä¸ºå››ä¸ªåè¿›åˆ¶æ•°ï¼Œç”¨ç‚¹åˆ†éš”ï¼ˆä¾‹å¦‚ <code>192.168.1.1</code>ï¼‰ã€‚ç”±äºåœ°å€èµ„æºæ¯ç«­ï¼Œç°åœ¨å·²ç»ä¸å¤Ÿç”¨ã€‚</li><li><strong>IPv6</strong>ï¼šç”± 128 ä½äºŒè¿›åˆ¶æ•°ç»„æˆï¼Œåœ°å€ç©ºé—´å·¨å¤§ï¼Œè¶³ä»¥æ»¡è¶³æœªæ¥éœ€æ±‚ã€‚</li></ul></li><li><strong>ç±»å‹</strong>ï¼š<ul><li><strong>å…¬ç½‘ IP</strong>ï¼šåœ¨äº’è”ç½‘ä¸Šæ˜¯å”¯ä¸€çš„ï¼Œå¯ä»¥ç›´æ¥è®¿é—®ã€‚</li><li><strong>å†…ç½‘ IP</strong>ï¼šåœ¨å±€åŸŸç½‘å†…æ˜¯å”¯ä¸€çš„ï¼Œä¸èƒ½ç›´æ¥åœ¨äº’è”ç½‘ä¸Šè®¿é—®ã€‚ä¾‹å¦‚ <code>192.168.x.x</code>ã€<code>10.x.x.x</code>ã€‚</li></ul></li></ul><h4 id="2-ç«¯å£å·-Port-Number"><a href="#2-ç«¯å£å·-Port-Number" class="headerlink" title="2. ç«¯å£å· (Port Number)"></a>2. ç«¯å£å· (Port Number)</h4><ul><li><strong>æ¦‚å¿µ</strong>ï¼šç«¯å£å·æ˜¯ç”¨äº<strong>åŒºåˆ†ä¸€å°è®¡ç®—æœºä¸Šä¸åŒåº”ç”¨ç¨‹åº</strong>çš„æ•°å­—æ ‡è¯†ã€‚å®ƒçš„èŒƒå›´æ˜¯ä» <code>0</code> åˆ° <code>65535</code>ã€‚</li><li><strong>ä½œç”¨</strong>ï¼šå½“ä¸€ä¸ªæ•°æ®åŒ…åˆ°è¾¾ä¸€å°è®¡ç®—æœºæ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šæ£€æŸ¥å…¶ç›®çš„ç«¯å£å·ï¼Œç„¶åå°†æ•°æ®åŒ…äº¤ç»™ç›‘å¬è¯¥ç«¯å£å·çš„ç›¸åº”åº”ç”¨ç¨‹åºã€‚</li><li><strong>ä¸ IP åœ°å€çš„å…³ç³»</strong>ï¼šIP åœ°å€è§£å†³äº†â€œæ•°æ®åŒ…å‘é€åˆ°å“ªå°è®¡ç®—æœºâ€çš„é—®é¢˜ï¼Œè€Œç«¯å£å·åˆ™è§£å†³äº†â€œæ•°æ®åŒ…å‘é€åˆ°è¿™å°è®¡ç®—æœºä¸Šçš„å“ªä¸ªåº”ç”¨ç¨‹åºâ€çš„é—®é¢˜ã€‚ä¸¤è€…ç»“åˆèµ·æ¥æ‰èƒ½å”¯ä¸€ç¡®å®šä¸€ä¸ªç½‘ç»œè¿æ¥çš„ç«¯ç‚¹ã€‚</li></ul><h4 id="3-åè®®-Protocol"><a href="#3-åè®®-Protocol" class="headerlink" title="3. åè®® (Protocol)"></a>3. åè®® (Protocol)</h4><ul><li><strong>æ¦‚å¿µ</strong>ï¼šåè®®æ˜¯ç½‘ç»œé€šä¿¡ä¸­<strong>æ•°æ®ä¼ è¾“çš„è§„åˆ™å’Œçº¦å®š</strong>ã€‚å®ƒå®šä¹‰äº†æ•°æ®å¦‚ä½•æ‰“åŒ…ã€ä¼ è¾“ã€è·¯ç”±å’Œæ¥æ”¶ã€‚</li><li><strong>ä½œç”¨</strong>ï¼šç¡®ä¿é€šä¿¡åŒæ–¹èƒ½å¤Ÿç†è§£å½¼æ­¤å‘é€çš„æ•°æ®ã€‚æ²¡æœ‰åè®®ï¼Œæ•°æ®åŒ…å°±æ˜¯ä¸€å †æ— æ„ä¹‰çš„å­—èŠ‚ã€‚</li><li><strong>åˆ†å±‚</strong>ï¼šç½‘ç»œåè®®é€šå¸¸æ˜¯åˆ†å±‚çš„ï¼Œæœ€ç»å…¸çš„æ˜¯ <strong>TCP&#x2F;IP åè®®æ ˆ</strong>ã€‚<ul><li><strong>åº”ç”¨å±‚</strong>ï¼š<strong>å†³å®šæ•°æ®å†…å®¹</strong>ï¼Œå¦‚ HTTPã€FTPã€SMTPã€‚</li><li><strong>ä¼ è¾“å±‚</strong>ï¼š<strong>å†³å®šæ•°æ®å¦‚ä½•ä¼ è¾“</strong>ï¼Œå¦‚ TCP å’Œ UDPã€‚<ul><li><strong>TCP (Transmission Control Protocol)</strong>ï¼šé¢å‘è¿æ¥ã€å¯é ã€æœ‰åºã€‚é€‚ç”¨äºå¯¹æ•°æ®å®Œæ•´æ€§è¦æ±‚é«˜çš„åœºæ™¯ï¼Œå¦‚æ–‡ä»¶ä¼ è¾“ã€ç½‘é¡µæµè§ˆã€‚</li><li><strong>UDP (User Datagram Protocol)</strong>ï¼šæ— è¿æ¥ã€ä¸å¯é ã€é€Ÿåº¦å¿«ã€‚é€‚ç”¨äºå¯¹å®æ—¶æ€§è¦æ±‚é«˜çš„åœºæ™¯ï¼Œå¦‚åœ¨çº¿è§†é¢‘ã€æ¸¸æˆã€‚</li></ul></li><li><strong>ç½‘ç»œå±‚</strong>ï¼š<strong>å†³å®šæ•°æ®å¦‚ä½•è·¯ç”±</strong>ï¼Œå¦‚ IP åè®®ã€‚</li><li><strong>æ•°æ®é“¾è·¯å±‚&#x2F;ç‰©ç†å±‚</strong>ï¼šè´Ÿè´£ç‰©ç†è®¾å¤‡çš„é€šä¿¡ã€‚</li></ul></li></ul><hr><h3 id="äºŒã€å¸¸è§åº”ç”¨çš„é»˜è®¤ç«¯å£å·"><a href="#äºŒã€å¸¸è§åº”ç”¨çš„é»˜è®¤ç«¯å£å·" class="headerlink" title="äºŒã€å¸¸è§åº”ç”¨çš„é»˜è®¤ç«¯å£å·"></a>äºŒã€å¸¸è§åº”ç”¨çš„é»˜è®¤ç«¯å£å·</h3><p>äº†è§£è¿™äº›é»˜è®¤ç«¯å£å·ï¼Œå¯ä»¥å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£ç½‘ç»œåè®®å’ŒæœåŠ¡ã€‚</p><ul><li><strong>Web æœåŠ¡</strong><ul><li><strong>HTTP</strong> (HyperText Transfer Protocol)ï¼š<strong>80</strong></li><li><strong>HTTPS</strong> (HTTP Secure)ï¼š<strong>443</strong></li><li><strong>Tomcat</strong> (é»˜è®¤)ï¼š<strong>8080</strong></li><li><strong>WebLogic</strong> (é»˜è®¤)ï¼š<strong>7001</strong></li></ul></li><li><strong>æ–‡ä»¶ä¼ è¾“</strong><ul><li><strong>FTP</strong> (File Transfer Protocol)ï¼š<strong>21</strong> (æ§åˆ¶è¿æ¥)</li><li><strong>SFTP</strong> (SSH File Transfer Protocol)ï¼š<strong>22</strong></li></ul></li><li><strong>è¿œç¨‹ç™»å½•ä¸ç®¡ç†</strong><ul><li><strong>SSH</strong> (Secure Shell)ï¼š<strong>22</strong></li><li><strong>Telnet</strong>ï¼š<strong>23</strong></li><li><strong>RDP</strong> (Remote Desktop Protocol)ï¼š<strong>3389</strong></li></ul></li><li><strong>æ•°æ®åº“æœåŠ¡</strong><ul><li><strong>MySQL</strong>ï¼š<strong>3306</strong></li><li><strong>PostgreSQL</strong>ï¼š<strong>5432</strong></li><li><strong>SQL Server</strong>ï¼š<strong>1433</strong></li><li><strong>Oracle</strong>ï¼š<strong>1521</strong></li></ul></li><li><strong>é‚®ä»¶æœåŠ¡</strong><ul><li><strong>SMTP</strong> (Simple Mail Transfer Protocol)ï¼š<strong>25</strong> (å‘é€é‚®ä»¶)</li><li><strong>POP3</strong> (Post Office Protocol 3)ï¼š<strong>110</strong> (æ¥æ”¶é‚®ä»¶)</li><li><strong>IMAP</strong> (Internet Message Access Protocol)ï¼š<strong>143</strong> (æ¥æ”¶é‚®ä»¶)</li></ul></li><li><strong>å…¶ä»–å¸¸è§æœåŠ¡</strong><ul><li><strong>DNS</strong> (Domain Name System)ï¼š<strong>53</strong></li><li><strong>Redis</strong>ï¼š<strong>6379</strong></li><li><strong>MongoDB</strong>ï¼š<strong>27017</strong></li><li><strong>Kafka</strong>ï¼š<strong>9092</strong></li></ul></li></ul><p>ä¸ºä»€ä¹ˆéœ€è¦é»˜è®¤ç«¯å£å·ï¼Ÿ</p><p>ä¸ºäº†æ–¹ä¾¿ç”¨æˆ·ã€‚å½“ä½ åœ¨æµè§ˆå™¨ä¸­è®¿é—® <a href="http://www.example.com/">www.example.com</a> æ—¶ï¼Œä½ ä¸éœ€è¦æ‰‹åŠ¨è¾“å…¥ <a href="http://www.example.com:80ï¼Œå› ä¸ºæµè§ˆå™¨çŸ¥é“">www.example.com:80ï¼Œå› ä¸ºæµè§ˆå™¨çŸ¥é“</a> HTTP åè®®çš„é»˜è®¤ç«¯å£å°±æ˜¯ 80ã€‚å¦‚æœæœåŠ¡å™¨çš„ç«¯å£ä¸æ˜¯é»˜è®¤ç«¯å£ï¼Œä½ å°±å¿…é¡»æ‰‹åŠ¨æŒ‡å®šï¼Œæ¯”å¦‚ <a href="http://www.example.com:8080ã€‚">www.example.com:8080ã€‚</a></p><p>å¥½çš„ï¼Œæˆ‘å°†æ ¹æ®æ‚¨æä¾›çš„è¿™ä»½è¯¦å°½çš„ Web æŠ€æœ¯ç¬”è®°ï¼Œä»¥ä¸€ç§æ›´ä¸“ä¸šã€æ›´ç³»ç»Ÿçš„æ–¹å¼ï¼Œå¯¹å…¶è¿›è¡Œé‡æ–°ç»„ç»‡ã€è¡¥å……å’Œæ·±å…¥è§£æï¼Œä½¿å…¶æˆä¸ºä¸€ä»½é«˜è´¨é‡çš„æŠ€æœ¯è®²è§£æˆ–é¢è¯•å›ç­”ã€‚</p><hr><h3 id="ä¸€ã€Servlet-å‰©ä½™éƒ¨åˆ†"><a href="#ä¸€ã€Servlet-å‰©ä½™éƒ¨åˆ†" class="headerlink" title="ä¸€ã€Servlet å‰©ä½™éƒ¨åˆ†"></a>ä¸€ã€Servlet å‰©ä½™éƒ¨åˆ†</h3><h4 id="1-Servlet-çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•"><a href="#1-Servlet-çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•" class="headerlink" title="1. Servlet çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•"></a>1. Servlet çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•</h4><p>è¿™æ˜¯ç†è§£ Servlet å·¥ä½œåŸç†çš„æ ¸å¿ƒã€‚</p><ul><li><strong>init() æ–¹æ³•</strong>ï¼š<ul><li><strong>ç‰¹ç‚¹</strong>ï¼šåªæ‰§è¡Œ<strong>ä¸€æ¬¡</strong>ï¼Œç”¨äºåˆå§‹åŒ– Servlet å®ä¾‹ã€‚</li><li><strong>æ‰§è¡Œæ—¶æœº</strong>ï¼š<ul><li><strong>é»˜è®¤ï¼ˆæ‡’åŠ è½½ï¼‰</strong>ï¼šç¬¬ä¸€æ¬¡è¢«è®¿é—®æ—¶æ‰§è¡Œã€‚è¿™æ˜¯ä¸€ç§â€œæŒ‰éœ€åŠ è½½â€çš„ç­–ç•¥ï¼ŒèŠ‚çœäº†æœåŠ¡å™¨å¯åŠ¨æ—¶çš„èµ„æºã€‚</li><li><strong>é¢„åŠ è½½</strong>ï¼šå¯ä»¥åœ¨ <code>web.xml</code> ä¸­é€šè¿‡ <code>&lt;load-on-startup&gt;</code> æ ‡ç­¾æ¥è®¾ç½®ã€‚å¦‚æœå€¼ä¸ºéè´Ÿæ•´æ•°ï¼ˆ<code>0</code>æˆ–æ­£æ•°ï¼‰ï¼ŒServlet å®¹å™¨å°†åœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶ç«‹å³åˆ›å»ºå¹¶åˆå§‹åŒ–è¯¥ Servletã€‚è¿™é€‚ç”¨äºéœ€è¦ç«‹å³æä¾›æœåŠ¡ã€å¯åŠ¨è€—æ—¶è¾ƒé•¿çš„ Servletã€‚</li></ul></li></ul></li><li><strong>service() æ–¹æ³•</strong>ï¼š<ul><li><strong>ç‰¹ç‚¹</strong>ï¼šæ¯æ¬¡å®¢æˆ·ç«¯è¯·æ±‚è¯¥ Servlet æ—¶ï¼Œéƒ½ä¼šæ‰§è¡Œä¸€æ¬¡ã€‚</li><li><strong>åŸç†</strong>ï¼šå®ƒæ˜¯ Servlet æ¥å£çš„æ ¸å¿ƒæ–¹æ³•ï¼Œç”¨äºå¤„ç†è¯·æ±‚ã€‚å¯¹äº <code>HttpServlet</code> æ¥è¯´ï¼Œå®ƒä¼šæ ¹æ® HTTP è¯·æ±‚æ–¹æ³•ï¼ˆGETã€POST ç­‰ï¼‰æ¥åˆ†å‘è¯·æ±‚ç»™ç›¸åº”çš„ <code>doGet()</code> æˆ– <code>doPost()</code> æ–¹æ³•ã€‚</li><li><strong>é‡è¦æ€§</strong>ï¼š<strong>service() æ–¹æ³•æ˜¯å¤šçº¿ç¨‹çš„</strong>ã€‚Servlet å®¹å™¨ä¼šä¸ºæ¯ä¸ªè¯·æ±‚åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹æ¥æ‰§è¡Œ <code>service()</code> æ–¹æ³•ï¼Œç¡®ä¿å¹¶å‘è®¿é—®æ—¶äº’ä¸å½±å“ã€‚</li></ul></li><li><strong>destroy() æ–¹æ³•</strong>ï¼š<ul><li><strong>ç‰¹ç‚¹</strong>ï¼šåªæ‰§è¡Œ<strong>ä¸€æ¬¡</strong>ï¼Œåœ¨ Servlet å®ä¾‹æ­£å¸¸é”€æ¯æ—¶è°ƒç”¨ã€‚</li><li><strong>æ‰§è¡Œæ—¶æœº</strong>ï¼šé€šå¸¸åœ¨ Web åº”ç”¨å…³é—­æˆ– Servlet å®¹å™¨å…³é—­æ—¶ã€‚ç”¨äºé‡Šæ”¾èµ„æºï¼Œå¦‚å…³é—­æ•°æ®åº“è¿æ¥ã€æ–‡ä»¶å¥æŸ„ç­‰ã€‚</li></ul></li></ul><h4 id="2-Servlet-çš„å®ç°æ–¹å¼ï¼šXML-vs-æ³¨è§£"><a href="#2-Servlet-çš„å®ç°æ–¹å¼ï¼šXML-vs-æ³¨è§£" class="headerlink" title="2. Servlet çš„å®ç°æ–¹å¼ï¼šXML vs. æ³¨è§£"></a>2. Servlet çš„å®ç°æ–¹å¼ï¼šXML vs. æ³¨è§£</h4><ul><li><p><strong>XML é…ç½®æ–¹å¼</strong>ï¼šåœ¨ <code>web.xml</code> æ–‡ä»¶ä¸­ï¼Œé€šè¿‡ <code>&lt;servlet&gt;</code> å’Œ <code>&lt;servlet-mapping&gt;</code> æ ‡ç­¾æ¥é…ç½® Servlet çš„åç§°ã€ç±»å’Œè®¿é—®è·¯å¾„ã€‚è¿™æ˜¯ Servlet 2.x åŠä»¥å‰ç‰ˆæœ¬çš„ä¸»æµæ–¹å¼ã€‚</p></li><li><p><strong>æ³¨è§£æ–¹å¼</strong>ï¼šè‡ª Servlet 3.0 å¼€å§‹å¼•å…¥ï¼Œå¯ä»¥ä½¿ç”¨ <code>@WebServlet</code> æ³¨è§£æ¥ä»£æ›¿ XML é…ç½®ã€‚</p><ul><li><strong>ä¼˜ç‚¹</strong>ï¼šç®€åŒ–äº†é…ç½®ï¼Œä»£ç å’Œé…ç½®æ›´é›†ä¸­ï¼Œæé«˜äº†å¼€å‘æ•ˆç‡ã€‚</li><li><strong>ç¤ºä¾‹</strong>ï¼š</li></ul><p>Java</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@WebServlet(&quot;/demo&quot;)</span><br><span class="line">public class MyServlet extends HttpServlet &#123; ... &#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="3-Servlet-çš„ä½“ç³»ç»“æ„"><a href="#3-Servlet-çš„ä½“ç³»ç»“æ„" class="headerlink" title="3. Servlet çš„ä½“ç³»ç»“æ„"></a>3. Servlet çš„ä½“ç³»ç»“æ„</h4><ul><li><code>Servlet</code> <strong>æ¥å£</strong>ï¼šæ‰€æœ‰ Servlet çš„é¡¶å±‚æ¥å£ï¼Œå®šä¹‰äº† <code>init()</code>, <code>service()</code>, <code>destroy()</code> ç­‰æ ¸å¿ƒæ–¹æ³•ã€‚</li><li><code>GenericServlet</code> <strong>æŠ½è±¡ç±»</strong>ï¼šå®ç°äº† <code>Servlet</code> æ¥å£ï¼Œå¹¶æä¾›äº† <code>init()</code>, <code>destroy()</code> çš„ç©ºå®ç°ï¼Œä»¥åŠä¸€äº›é€šç”¨æ–¹æ³•ã€‚å¼€å‘è€…å¯ä»¥ç»§æ‰¿å®ƒæ¥ç¼–å†™åè®®æ— å…³çš„ Servletã€‚</li><li><code>HttpServlet</code> <strong>æŠ½è±¡ç±»</strong>ï¼šç»§æ‰¿è‡ª <code>GenericServlet</code>ï¼Œä¸“é—¨ç”¨äºå¤„ç† <strong>HTTP è¯·æ±‚</strong>ã€‚å®ƒé‡å†™äº† <code>service()</code> æ–¹æ³•ï¼Œå¹¶æ ¹æ®è¯·æ±‚æ–¹æ³•åˆ†å‘ç»™ <code>doGet()</code>, <code>doPost()</code> ç­‰å…·ä½“æ–¹æ³•ã€‚</li><li><strong>æ€»ç»“</strong>ï¼šåœ¨ Web é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å‡ ä¹æ€»æ˜¯å¤„ç† HTTP è¯·æ±‚ï¼Œå› æ­¤<strong>ç»§æ‰¿ HttpServlet æ˜¯æœ€å¸¸ç”¨ã€æœ€æ¨èçš„æ–¹å¼</strong>ã€‚</li></ul><hr><h3 id="äºŒã€HTTP-åè®®"><a href="#äºŒã€HTTP-åè®®" class="headerlink" title="äºŒã€HTTP åè®®"></a>äºŒã€HTTP åè®®</h3><h4 id="1-æ¦‚å¿µä¸ç‰¹ç‚¹"><a href="#1-æ¦‚å¿µä¸ç‰¹ç‚¹" class="headerlink" title="1. æ¦‚å¿µä¸ç‰¹ç‚¹"></a>1. æ¦‚å¿µä¸ç‰¹ç‚¹</h4><ul><li><strong>æ¦‚å¿µ</strong>ï¼š<strong>è¶…æ–‡æœ¬ä¼ è¾“åè®®</strong>ï¼Œæ˜¯ Web åº”ç”¨å±‚åè®®ï¼ŒåŸºäº TCP&#x2F;IPã€‚å®ƒè§„å®šäº†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡æ ¼å¼ã€‚</li><li><strong>ç‰¹ç‚¹</strong>ï¼š<ul><li><strong>åŸºäº TCP&#x2F;IP</strong>ï¼šå®ƒä½äº TCP&#x2F;IP åè®®æ ˆçš„åº”ç”¨å±‚ï¼Œåˆ©ç”¨äº† TCP çš„å¯é ä¼ è¾“ç‰¹æ€§ã€‚</li><li><strong>è¯·æ±‚&#x2F;å“åº”æ¨¡å‹</strong>ï¼šå®¢æˆ·ç«¯å‘é€è¯·æ±‚ï¼ŒæœåŠ¡å™¨è¿”å›å“åº”ï¼Œä¸€æ¬¡è¯·æ±‚åªå¯¹åº”ä¸€æ¬¡å“åº”ã€‚</li><li><strong>æ— çŠ¶æ€</strong>ï¼šè¿™æ˜¯ HTTP çš„æ ¸å¿ƒç‰¹å¾ã€‚æœåŠ¡å™¨ä¸ä¿ç•™ä»»ä½•å…³äºå®¢æˆ·ç«¯è¿‡å»è¯·æ±‚çš„ä¿¡æ¯ã€‚æ¯ä¸ªè¯·æ±‚éƒ½æ˜¯ç‹¬ç«‹çš„ã€‚</li><li><strong>æ— çŠ¶æ€å¸¦æ¥çš„é—®é¢˜</strong>ï¼šæœåŠ¡å™¨æ— æ³•è¯†åˆ«å¤šä¸ªè¯·æ±‚æ˜¯å¦æ¥è‡ªåŒä¸€ä¸ªç”¨æˆ·ï¼Œå› æ­¤éœ€è¦å¼•å…¥<strong>ä¼šè¯æŠ€æœ¯</strong>ï¼ˆå¦‚ Cookie å’Œ Sessionï¼‰æ¥è§£å†³ã€‚</li></ul></li></ul><h4 id="2-HTTP-åè®®çš„æ•°æ®æ ¼å¼"><a href="#2-HTTP-åè®®çš„æ•°æ®æ ¼å¼" class="headerlink" title="2. HTTP åè®®çš„æ•°æ®æ ¼å¼"></a>2. HTTP åè®®çš„æ•°æ®æ ¼å¼</h4><p>HTTP åè®®æ˜¯æ–‡æœ¬æ ¼å¼ï¼Œç”±<strong>è¯·æ±‚æ ¼å¼</strong>å’Œ<strong>å“åº”æ ¼å¼</strong>ä¸¤éƒ¨åˆ†ç»„æˆã€‚</p><ul><li><strong>è¯·æ±‚æ ¼å¼</strong>ï¼š<ol><li><strong>è¯·æ±‚è¡Œ</strong>ï¼š<code>è¯·æ±‚æ–¹å¼ è™šæ‹Ÿè·¯å¾„/èµ„æºè·¯å¾„[?å‚æ•°] è¯·æ±‚åè®®/ç‰ˆæœ¬</code>ã€‚</li><li><strong>è¯·æ±‚å¤´</strong>ï¼šé”®å€¼å¯¹å½¢å¼ï¼Œæä¾›é¢å¤–ä¿¡æ¯ã€‚<ul><li><code>Host</code>ï¼šç›®æ ‡ä¸»æœºåã€‚</li><li><code>User-Agent</code>ï¼šæµè§ˆå™¨ç±»å‹å’Œç‰ˆæœ¬ã€‚</li><li><code>Referer</code>ï¼šè¯·æ±‚æ¥æºåœ°å€ï¼Œå¸¸ç”¨äºé˜²ç›—é“¾ã€‚</li></ul></li><li><strong>è¯·æ±‚ç©ºè¡Œ</strong>ï¼šä¸€ä¸ªç©ºè¡Œï¼Œç”¨äºåˆ†éš”è¯·æ±‚å¤´å’Œè¯·æ±‚ä½“ã€‚</li><li><strong>è¯·æ±‚ä½“</strong>ï¼š<strong>åªæœ‰ POST è¯·æ±‚æ‰æœ‰</strong>ï¼Œç”¨äºå°è£…è¯·æ±‚å‚æ•°ã€‚</li></ol></li></ul><h4 id="3-ServletRequest-å¯¹è±¡"><a href="#3-ServletRequest-å¯¹è±¡" class="headerlink" title="3. ServletRequest å¯¹è±¡"></a>3. <code>ServletRequest</code> å¯¹è±¡</h4><p><code>ServletRequest</code> æ˜¯ Servlet å®¹å™¨åœ¨æ¥æ”¶åˆ°è¯·æ±‚åï¼Œå°è£…è¯·æ±‚ä¿¡æ¯çš„å¯¹è±¡ã€‚</p><ul><li><strong>è·å–è¯·æ±‚è¡Œä¿¡æ¯</strong>ï¼š<ul><li><code>getMethod()</code>ï¼šè·å–è¯·æ±‚æ–¹å¼ï¼ˆGET&#x2F;POSTï¼‰ã€‚</li><li><code>getContextPath()</code>ï¼šè·å–è™šæ‹Ÿè·¯å¾„ã€‚</li><li><code>getRequestURI()</code>ï¼šè·å– URIï¼Œå¦‚ <code>/web02/demo4</code>ã€‚</li><li><code>getRequestURL()</code>ï¼šè·å– URLï¼Œå¦‚ <code>http://localhost:8080/web02/demo4</code>ã€‚</li></ul></li><li><strong>è·å–è¯·æ±‚å¤´ä¿¡æ¯</strong>ï¼š<ul><li><code>getHeader(name)</code>ï¼šæ ¹æ®è¯·æ±‚å¤´åè·å–å€¼ã€‚</li><li><code>getHeaderNames()</code>ï¼šè·å–æ‰€æœ‰è¯·æ±‚å¤´åã€‚</li></ul></li><li><strong>è·å–è¯·æ±‚ä½“ä¿¡æ¯</strong>ï¼š<ul><li><code>getReader()</code> (å­—ç¬¦æµ) å’Œ <code>getInputStream()</code> (å­—èŠ‚æµ)ï¼Œç”¨äºè¯»å– POST è¯·æ±‚çš„è¯·æ±‚ä½“å†…å®¹ã€‚</li></ul></li><li><strong>è·å–è¯·æ±‚å‚æ•°ï¼ˆé€šç”¨ï¼‰</strong>ï¼š<ul><li><code>getParameter(name)</code>ï¼šè·å–å•ä¸ªå‚æ•°å€¼ã€‚</li><li><code>getParameterValues(name)</code>ï¼šè·å–å‚æ•°å€¼æ•°ç»„ï¼Œç”¨äºå¤é€‰æ¡†ç­‰ã€‚</li></ul></li><li><strong>ä¸­æ–‡ä¹±ç </strong>ï¼š<ul><li><strong>GET è¯·æ±‚</strong>ï¼šåœ¨ Tomcat 8.x åŠä»¥åç‰ˆæœ¬ï¼Œé»˜è®¤å·²è§£å†³ã€‚</li><li><strong>POST è¯·æ±‚</strong>ï¼šéœ€è¦æ‰‹åŠ¨è®¾ç½®ç¼–ç ï¼Œ<code>request.setCharacterEncoding(&quot;UTF-8&quot;);</code>ã€‚</li></ul></li></ul><h4 id="4-request-è¯·æ±‚è½¬å‘"><a href="#4-request-è¯·æ±‚è½¬å‘" class="headerlink" title="4. request è¯·æ±‚è½¬å‘"></a>4. <code>request</code> è¯·æ±‚è½¬å‘</h4><ul><li><strong>æ¦‚å¿µ</strong>ï¼šæ˜¯ä¸€ç§<strong>æœåŠ¡å™¨å†…éƒ¨</strong>çš„èµ„æºè·³è½¬æ–¹å¼ã€‚è¯·æ±‚ä»ä¸€ä¸ª Servlet è½¬å‘åˆ°å¦ä¸€ä¸ª Servlet æˆ– JSPï¼Œ<strong>æµè§ˆå™¨åœ°å€æ ä¸ä¼šå‘ç”Ÿæ”¹å˜</strong>ã€‚</li><li><strong>ç‰¹ç‚¹</strong>ï¼š<ol><li><strong>åœ°å€æ ä¸å˜</strong>ï¼šç”¨æˆ·ä¸çŸ¥é“å‘ç”Ÿäº†è·³è½¬ã€‚</li><li><strong>ä¸€æ¬¡è¯·æ±‚&#x2F;å“åº”</strong>ï¼šæ•´ä¸ªè½¬å‘è¿‡ç¨‹å‘ç”Ÿåœ¨ä¸€æ¬¡ HTTP è¯·æ±‚å’Œä¸€æ¬¡ HTTP å“åº”ä¸­ã€‚</li><li><strong>å…±äº«æ•°æ®</strong>ï¼šç”±äºæ˜¯åŒä¸€æ¬¡è¯·æ±‚ï¼Œ<code>request</code> å¯¹è±¡ä¸­çš„æ•°æ®åœ¨è½¬å‘å‰åæ˜¯å…±äº«çš„ã€‚</li></ol></li></ul><h4 id="5-request-ä½œä¸ºåŸŸå¯¹è±¡"><a href="#5-request-ä½œä¸ºåŸŸå¯¹è±¡" class="headerlink" title="5. request ä½œä¸ºåŸŸå¯¹è±¡"></a>5. <code>request</code> ä½œä¸ºåŸŸå¯¹è±¡</h4><ul><li><strong>æ¦‚å¿µ</strong>ï¼š<code>request</code> æ˜¯ä¸€ç§<strong>åŸŸå¯¹è±¡</strong>ï¼Œå…¶ä½œç”¨èŒƒå›´æ˜¯<strong>ä¸€æ¬¡è¯·æ±‚-å“åº”çš„ç”Ÿå‘½å‘¨æœŸ</strong>ã€‚</li><li><strong>å…±äº«æ•°æ®</strong>ï¼šå¯ä»¥ä½¿ç”¨ <code>setAttribute()</code>, <code>getAttribute()</code>, <code>removeAttribute()</code> æ–¹æ³•åœ¨è¿™æ¬¡è¯·æ±‚çš„ç”Ÿå‘½å‘¨æœŸå†…å…±äº«æ•°æ®ã€‚</li><li><strong>åº”ç”¨åœºæ™¯</strong>ï¼šå¸¸ç”¨äºåœ¨ Servlet å’Œ JSP ä¹‹é—´ä¼ é€’æ•°æ®ã€‚</li><li><strong>ä¸ä¼šè¯æŠ€æœ¯çš„è”ç³»</strong>ï¼š<code>request</code> æ˜¯ä¸‰å¤§åŸŸå¯¹è±¡ï¼ˆ<code>request</code>, <code>session</code>, <code>servletContext</code>ï¼‰ä¸­ä½œç”¨èŒƒå›´æœ€å°çš„ä¸€ä¸ªã€‚</li></ul><p>å¥½çš„ï¼Œæˆ‘å°†æ ¹æ®æ‚¨æä¾›çš„è¿™ä»½è¯¦å°½çš„ Web æŠ€æœ¯ç¬”è®°ï¼Œä»¥ä¸€ç§æ›´ä¸“ä¸šã€æ›´ç³»ç»Ÿçš„æ–¹å¼ï¼Œå¯¹å…¶è¿›è¡Œé‡æ–°ç»„ç»‡ã€è¡¥å……å’Œæ·±å…¥è§£æï¼Œä½¿å…¶æˆä¸ºä¸€ä»½é«˜è´¨é‡çš„æŠ€æœ¯è®²è§£æˆ–é¢è¯•å›ç­”ã€‚</p><hr><h3 id="ä¸€ã€HTTP-åè®®çš„å“åº”æ ¼å¼"><a href="#ä¸€ã€HTTP-åè®®çš„å“åº”æ ¼å¼" class="headerlink" title="ä¸€ã€HTTP åè®®çš„å“åº”æ ¼å¼"></a>ä¸€ã€HTTP åè®®çš„å“åº”æ ¼å¼</h3><h4 id="1-å“åº”æ ¼å¼ç»„æˆ"><a href="#1-å“åº”æ ¼å¼ç»„æˆ" class="headerlink" title="1. å“åº”æ ¼å¼ç»„æˆ"></a>1. å“åº”æ ¼å¼ç»„æˆ</h4><p>HTTP å“åº”æ ¼å¼ç”±å››éƒ¨åˆ†ç»„æˆï¼š<code>å“åº”è¡Œ</code>ã€<code>å“åº”å¤´</code>ã€<code>å“åº”ç©ºè¡Œ</code>ã€<code>å“åº”ä½“</code>ã€‚è¿™ä¸ HTTP è¯·æ±‚æ ¼å¼ç›¸å‘¼åº”ã€‚</p><h4 id="2-å“åº”è¡Œ"><a href="#2-å“åº”è¡Œ" class="headerlink" title="2. å“åº”è¡Œ"></a>2. å“åº”è¡Œ</h4><ul><li><strong>æ ¼å¼</strong>ï¼š<code>åè®®/ç‰ˆæœ¬å· çŠ¶æ€ç  çŠ¶æ€æè¿°</code>ã€‚ä¾‹å¦‚ï¼š<code>HTTP/1.1 200 OK</code>ã€‚</li><li><strong>çŠ¶æ€ç </strong>ï¼šä¸€ä¸ªä¸‰ä½æ•°çš„æ•°å­—ï¼ŒæœåŠ¡å™¨ç”¨äºå‘Šè¯‰æµè§ˆå™¨æœ¬æ¬¡å“åº”çš„çŠ¶æ€ã€‚<ul><li><strong>2xx æˆåŠŸ</strong>ï¼š<ul><li><strong>200 OK</strong>ï¼šè¯·æ±‚æˆåŠŸï¼Œä¸€åˆ‡æ­£å¸¸ã€‚</li></ul></li><li><strong>3xx é‡å®šå‘</strong>ï¼š<ul><li><strong>302 Found</strong>ï¼šé‡å®šå‘ã€‚æœåŠ¡å™¨å‘Šè¯‰æµè§ˆå™¨ï¼Œèµ„æºä¸´æ—¶ç§»åŠ¨åˆ°å¦ä¸€ä¸ªä½ç½®ï¼Œè¯·é‡æ–°å‘èµ·è¯·æ±‚ã€‚</li><li><strong>304 Not Modified</strong>ï¼šè®¿é—®ç¼“å­˜ã€‚æœåŠ¡å™¨å‘Šè¯‰æµè§ˆå™¨ï¼Œè¯·æ±‚çš„èµ„æºæ²¡æœ‰æ›´æ–°ï¼Œå¯ä»¥ä½¿ç”¨æµè§ˆå™¨æœ¬åœ°çš„ç¼“å­˜å‰¯æœ¬ã€‚</li></ul></li><li><strong>4xx å®¢æˆ·ç«¯é”™è¯¯</strong>ï¼š<ul><li><strong>404 Not Found</strong>ï¼šæ‰¾ä¸åˆ°èµ„æºã€‚è¯·æ±‚çš„è·¯å¾„æ²¡æœ‰å¯¹åº”çš„èµ„æºã€‚</li><li><strong>405 Method Not Allowed</strong>ï¼šè¯·æ±‚æ–¹æ³•ä¸è¢«å…è®¸ã€‚ä¾‹å¦‚ï¼Œå®¢æˆ·ç«¯ç”¨ POST è¯·æ±‚è®¿é—®äº†åªæ”¯æŒ GET æ–¹æ³•çš„ Servletã€‚</li></ul></li><li><strong>5xx æœåŠ¡å™¨ç«¯é”™è¯¯</strong>ï¼š<ul><li><strong>500 Internal Server Error</strong>ï¼šæœåŠ¡å™¨å†…éƒ¨é”™è¯¯ã€‚é€šå¸¸æ˜¯æœåŠ¡å™¨ç«¯çš„ä»£ç å‡ºç°äº†å¼‚å¸¸ã€‚</li></ul></li></ul></li><li><strong>é¢è¯•é¢˜</strong>ï¼šåˆ—ä¸¾ 5 ä¸ªå¸¸è§çš„çŠ¶æ€ç ï¼š200ã€302ã€304ã€404ã€405ã€500ã€‚</li></ul><h4 id="3-å“åº”å¤´"><a href="#3-å“åº”å¤´" class="headerlink" title="3. å“åº”å¤´"></a>3. å“åº”å¤´</h4><ul><li><strong>ä½œç”¨</strong>ï¼šä»¥é”®å€¼å¯¹å½¢å¼æä¾›å…³äºå“åº”çš„é¢å¤–ä¿¡æ¯ã€‚</li><li><strong>å¸¸è§å“åº”å¤´</strong>ï¼š<ul><li><strong>Content-Type</strong>ï¼šå‘Šè¯‰æµè§ˆå™¨å“åº”ä½“çš„æ•°æ®ç±»å‹å’Œå­—ç¬¦ç¼–ç ï¼Œä¾‹å¦‚ <code>text/html;charset=utf-8</code>ã€‚</li><li><strong>Content-disposition</strong>ï¼š<ul><li><strong>inline</strong> (é»˜è®¤)ï¼šæµè§ˆå™¨åœ¨å½“å‰é¡µé¢å†…ç›´æ¥æ‰“å¼€ã€‚</li><li><strong>attachment;filename&#x3D;xxx</strong>ï¼šæµè§ˆå™¨å°†æ•°æ®ä½œä¸ºé™„ä»¶ä¸‹è½½ã€‚</li></ul></li><li><strong>Location</strong>ï¼šä¸ <code>3xx</code> çŠ¶æ€ç é…åˆä½¿ç”¨ï¼Œç”¨äºå‘Šè¯‰æµè§ˆå™¨é‡å®šå‘åˆ°å“ªä¸ª URLã€‚</li></ul></li></ul><h3 id="äºŒã€ServletResponse-response"><a href="#äºŒã€ServletResponse-response" class="headerlink" title="äºŒã€ServletResponse (response)"></a>äºŒã€ServletResponse (response)</h3><ul><li><strong>ç®€ä»‹</strong>ï¼š<code>ServletResponse</code> å¯¹è±¡ç”± Tomcat åˆ›å»ºï¼Œå°è£…äº†æœåŠ¡å™¨å‘é€ç»™å®¢æˆ·ç«¯çš„å“åº”æ¶ˆæ¯ã€‚</li><li><strong>ç›¸å…³æ–¹æ³•</strong>ï¼š<ul><li><strong>è®¾ç½®å“åº”è¡Œ</strong>ï¼š<code>setStatus(int sc)</code></li><li><strong>è®¾ç½®å“åº”å¤´</strong>ï¼š<code>setHeader(String name, String value)</code></li><li><strong>è®¾ç½®å“åº”ä½“</strong>ï¼š<ul><li><code>getWriter()</code>ï¼šè·å–å­—ç¬¦è¾“å‡ºæµï¼Œç”¨äºå‘é€<strong>æ–‡æœ¬</strong>æ•°æ®ã€‚</li><li><code>getOutputStream()</code>ï¼šè·å–å­—èŠ‚è¾“å‡ºæµï¼Œç”¨äºå‘é€<strong>å­—èŠ‚</strong>æ•°æ®ï¼ˆå¦‚å›¾ç‰‡ã€è§†é¢‘ï¼‰ã€‚</li></ul></li></ul></li></ul><h3 id="ä¸‰ã€è½¬å‘ï¼ˆForwardï¼‰å’Œé‡å®šå‘ï¼ˆRedirectï¼‰çš„åŒºåˆ«"><a href="#ä¸‰ã€è½¬å‘ï¼ˆForwardï¼‰å’Œé‡å®šå‘ï¼ˆRedirectï¼‰çš„åŒºåˆ«" class="headerlink" title="ä¸‰ã€è½¬å‘ï¼ˆForwardï¼‰å’Œé‡å®šå‘ï¼ˆRedirectï¼‰çš„åŒºåˆ«"></a>ä¸‰ã€è½¬å‘ï¼ˆForwardï¼‰å’Œé‡å®šå‘ï¼ˆRedirectï¼‰çš„åŒºåˆ«</h3><p>è¿™æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„é¢è¯•é¢˜ï¼Œéœ€è¦ä»å¤šä¸ªè§’åº¦è¿›è¡Œå¯¹æ¯”ã€‚</p><table><thead><tr><th>ç‰¹æ€§</th><th>è½¬å‘ï¼ˆForwardï¼‰</th><th>é‡å®šå‘ï¼ˆRedirectï¼‰</th></tr></thead><tbody><tr><td><strong>å‘ç”Ÿæ–¹</strong></td><td>æœåŠ¡å™¨å†…éƒ¨</td><td>æµè§ˆå™¨</td></tr><tr><td><strong>åœ°å€æ </strong></td><td><strong>ä¸å˜</strong></td><td><strong>ä¼šæ”¹å˜</strong></td></tr><tr><td><strong>è¯·æ±‚æ¬¡æ•°</strong></td><td><strong>ä¸€æ¬¡</strong>è¯·æ±‚ï¼Œä¸€æ¬¡å“åº”</td><td><strong>ä¸¤æ¬¡</strong>è¯·æ±‚ï¼Œä¸¤æ¬¡å“åº”</td></tr><tr><td><strong>å…±äº«æ•°æ®</strong></td><td><code>request</code> å¯¹è±¡å…±äº«æ•°æ®</td><td><code>request</code> å¯¹è±¡ä¸å…±äº«æ•°æ®</td></tr><tr><td><strong>è·³è½¬èŒƒå›´</strong></td><td><strong>åªèƒ½</strong>åœ¨å½“å‰ Web é¡¹ç›®å†…éƒ¨</td><td>å¯ä»¥è·³å‡ºé¡¹ç›®ï¼Œè®¿é—®å¤–éƒ¨èµ„æº</td></tr><tr><td><strong>è°ƒç”¨æ–¹</strong></td><td><code>RequestDispatcher</code> (<code>request</code>)</td><td><code>ServletResponse</code> (<code>response</code>)</td></tr><tr><td><strong>åº•å±‚å®ç°</strong></td><td><code>request.getRequestDispatcher().forward()</code></td><td><code>response.sendRedirect()</code></td></tr></tbody></table><ul><li><strong>é‡å®šå‘çš„å®ç°åŸç†</strong>ï¼š<ol><li>æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ï¼Œæ‰§è¡Œ <code>response.sendRedirect()</code>ï¼Œå¹¶å‘é€ <code>302</code> çŠ¶æ€ç å’Œ <code>Location</code> å“åº”å¤´ï¼ˆå€¼ä¸ºæ–°çš„ URLï¼‰ã€‚</li><li>æµè§ˆå™¨æ”¶åˆ°å“åº”ï¼Œè§£æåˆ° <code>302</code> å’Œ <code>Location</code> å¤´åï¼Œä¼š<strong>è‡ªåŠ¨</strong>å‘æ–°çš„ URL å‘èµ·<strong>ç¬¬äºŒæ¬¡</strong>è¯·æ±‚ã€‚</li></ol></li></ul><h3 id="å››ã€ServletContext"><a href="#å››ã€ServletContext" class="headerlink" title="å››ã€ServletContext"></a>å››ã€ServletContext</h3><h4 id="1-ç®€ä»‹ä¸ç‰¹ç‚¹"><a href="#1-ç®€ä»‹ä¸ç‰¹ç‚¹" class="headerlink" title="1. ç®€ä»‹ä¸ç‰¹ç‚¹"></a>1. ç®€ä»‹ä¸ç‰¹ç‚¹</h4><ul><li><strong>ä½œç”¨</strong>ï¼šä»£è¡¨<strong>æ•´ä¸ª Web åº”ç”¨</strong>ã€‚å¯ä»¥ç”¨æ¥å’ŒæœåŠ¡å™¨å®¹å™¨è¿›è¡Œé€šä¿¡ã€‚</li><li><strong>ç‰¹ç‚¹</strong>ï¼š<ul><li><strong>å•ä¾‹</strong>ï¼šä¸€ä¸ª Web åº”ç”¨åªæœ‰ä¸€ä¸ª <code>ServletContext</code> å¯¹è±¡ã€‚</li><li><strong>ä½œç”¨åŸŸ</strong>ï¼šæ˜¯<strong>æœ€å¤§çš„åŸŸå¯¹è±¡</strong>ï¼Œå…¶ä½œç”¨èŒƒå›´æ˜¯æ•´ä¸ª Web åº”ç”¨ï¼Œä»åº”ç”¨å¯åŠ¨åˆ°å…³é—­ã€‚</li></ul></li></ul><h4 id="2-è·å–-ServletContext-å¯¹è±¡"><a href="#2-è·å–-ServletContext-å¯¹è±¡" class="headerlink" title="2. è·å– ServletContext å¯¹è±¡"></a>2. è·å– <code>ServletContext</code> å¯¹è±¡</h4><ul><li><strong>é€šè¿‡ request</strong>ï¼š<code>request.getServletContext()</code></li><li><strong>é€šè¿‡ HttpServlet</strong>ï¼š<code>getServletContext()</code></li></ul><h4 id="3-ServletContext-çš„æ–¹æ³•"><a href="#3-ServletContext-çš„æ–¹æ³•" class="headerlink" title="3. ServletContext çš„æ–¹æ³•"></a>3. <code>ServletContext</code> çš„æ–¹æ³•</h4><ul><li><strong>è·å–æ–‡ä»¶ MIME ç±»å‹</strong>ï¼š<code>getMimeType(String file)</code>ï¼Œè¿”å›æ–‡ä»¶çš„ç±»å‹ï¼Œå¦‚ <code>image/jpeg</code>ã€‚</li><li><strong>ä½œä¸ºåŸŸå¯¹è±¡</strong>ï¼šæä¾›äº† <code>setAttribute()</code>, <code>getAttribute()</code>, <code>removeAttribute()</code> æ–¹æ³•ï¼Œç”¨äºåœ¨æ•´ä¸ª Web åº”ç”¨èŒƒå›´å†…å…±äº«æ•°æ®ã€‚<ul><li><strong>ç¤ºä¾‹</strong>ï¼šæ‚¨æä¾›çš„ä»£ç ç‰‡æ®µå®Œç¾åœ°å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ <code>ServletContext</code> æ¥ç»Ÿè®¡æœåŠ¡å™¨çš„è®¿é—®æ¬¡æ•°ã€‚è¿™æ˜¯ <code>ServletContext</code> ä½œä¸ºåŸŸå¯¹è±¡æœ€ç»å…¸çš„ç”¨æ³•ã€‚</li></ul></li><li><strong>è·å–æ–‡ä»¶çœŸå®è·¯å¾„</strong>ï¼š<code>getRealPath(String path)</code>ï¼Œå°†ç›¸å¯¹è·¯å¾„è½¬æ¢ä¸ºæœåŠ¡å™¨ä¸Šçš„ç»å¯¹è·¯å¾„ã€‚</li></ul><h3 id="äº”ã€ä¼šè¯ï¼ˆSessionï¼‰"><a href="#äº”ã€ä¼šè¯ï¼ˆSessionï¼‰" class="headerlink" title="äº”ã€ä¼šè¯ï¼ˆSessionï¼‰"></a>äº”ã€ä¼šè¯ï¼ˆSessionï¼‰</h3><h4 id="1-æ¦‚å¿µä¸ä½œç”¨"><a href="#1-æ¦‚å¿µä¸ä½œç”¨" class="headerlink" title="1. æ¦‚å¿µä¸ä½œç”¨"></a>1. æ¦‚å¿µä¸ä½œç”¨</h4><ul><li><strong>æ¦‚å¿µ</strong>ï¼šåœ¨ HTTP åè®®çš„æ— çŠ¶æ€ç‰¹æ€§åŸºç¡€ä¸Šï¼Œé€šè¿‡ä¼šè¯æŠ€æœ¯å°†å¤šæ¬¡è¯·æ±‚å’Œå“åº”è”ç³»èµ·æ¥ï¼Œå½¢æˆä¸€ä¸ªå®Œæ•´çš„ä¼šè¯ã€‚</li><li><strong>ä½œç”¨</strong>ï¼šåœ¨ä¸€æ¬¡ä¼šè¯èŒƒå›´å†…çš„å¤šæ¬¡è¯·æ±‚ä¹‹é—´<strong>å…±äº«æ•°æ®</strong>ï¼Œä»è€Œè¯†åˆ«ç”¨æˆ·ã€‚</li><li><strong>å®ç°æ–¹å¼</strong>ï¼š<ul><li><strong>å®¢æˆ·ç«¯ä¼šè¯ï¼ˆCookieï¼‰</strong>ï¼šæ•°æ®å­˜å‚¨åœ¨å®¢æˆ·ç«¯æµè§ˆå™¨ã€‚</li><li><strong>æœåŠ¡å™¨ç«¯ä¼šè¯ï¼ˆSessionï¼‰</strong>ï¼šæ•°æ®å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯ã€‚</li></ul></li></ul><h4 id="2-å®¢æˆ·ç«¯ä¼šè¯ï¼šCookie"><a href="#2-å®¢æˆ·ç«¯ä¼šè¯ï¼šCookie" class="headerlink" title="2. å®¢æˆ·ç«¯ä¼šè¯ï¼šCookie"></a>2. å®¢æˆ·ç«¯ä¼šè¯ï¼šCookie</h4><ul><li><strong>å¿«é€Ÿå¼€å§‹</strong>ï¼š<ol><li><strong>åˆ›å»º</strong>ï¼š<code>new Cookie(name, value)</code>ã€‚</li><li><strong>å‘é€</strong>ï¼š<code>response.addCookie(cookie)</code>ï¼Œå°† Cookie å‘é€ç»™æµè§ˆå™¨ã€‚</li><li><strong>è·å–</strong>ï¼š<code>request.getCookies()</code>ï¼Œä»è¯·æ±‚ä¸­è·å–æ‰€æœ‰ Cookieã€‚</li></ol></li><li><strong>ç‰¹ç‚¹</strong>ï¼šæ•°æ®å­˜å‚¨åœ¨å®¢æˆ·ç«¯ï¼Œæœ‰å¤§å°é™åˆ¶ï¼Œå®‰å…¨æ€§ä½ã€‚</li></ul><p>è¿™æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„é—®é¢˜ï¼Œå®ƒè§¦åŠäº† Web å¼€å‘ä¸­ä¸€ä¸ªå®¹æ˜“æ··æ·†ä½†è‡³å…³é‡è¦çš„æ¦‚å¿µã€‚<code>enctype</code> å’Œ <code>Content-Type</code> ç¡®å®æœ‰ç›¸ä¼¼ä¹‹å¤„ï¼Œä½†å®ƒä»¬çš„ä½œç”¨åŸŸå’Œè§’è‰²æ˜¯å®Œå…¨ä¸åŒçš„ã€‚</p><p>è®©æˆ‘æ¥è¯¦ç»†è§£é‡Šä¸€ä¸‹å®ƒä»¬çš„åŒºåˆ«ï¼š</p><hr><h3 id="ä¸€ã€enctype"><a href="#ä¸€ã€enctype" class="headerlink" title="ä¸€ã€enctype"></a>ä¸€ã€<code>enctype</code></h3><ul><li><strong>ä½œç”¨åŸŸ</strong>ï¼šHTML <code>&lt;form&gt;</code> æ ‡ç­¾çš„å±æ€§ã€‚</li><li><strong>è§’è‰²</strong>ï¼šå®¢æˆ·ç«¯<strong>è¡¨å•çš„ç¼–ç æ–¹å¼</strong>ã€‚</li><li><strong>æ¦‚å¿µ</strong>ï¼š<code>enctype</code> (Encoding Type) å‘Šè¯‰<strong>æµè§ˆå™¨</strong>å¦‚ä½•å°† <code>&lt;form&gt;</code> è¡¨å•ä¸­çš„æ•°æ®<strong>ç¼–ç </strong>æˆ HTTP è¯·æ±‚ä½“ä¸­çš„æ•°æ®ã€‚å®ƒåªä½œç”¨äº<strong>è¡¨å•æäº¤</strong>è¿™ä¸ªè¡Œä¸ºã€‚</li><li><strong>å¸¸è§å€¼</strong>ï¼š<ul><li><code>application/x-www-form-urlencoded</code>ï¼šé»˜è®¤å€¼ï¼Œç”¨äºæ–‡æœ¬æ•°æ®ã€‚</li><li><code>multipart/form-data</code>ï¼šç”¨äºæ–‡ä»¶ä¸Šä¼ ã€‚</li><li><code>text/plain</code>ï¼šç”¨äºçº¯æ–‡æœ¬æäº¤ã€‚</li></ul></li></ul><p><strong>ç®€å•æ¥è¯´ï¼Œenctype æ˜¯â€œè¡¨å•æ•°æ®åœ¨æµè§ˆå™¨ç«¯å¦‚ä½•æ‰“åŒ…â€çš„è§„åˆ™ã€‚</strong></p><h3 id="äºŒã€Content-Type"><a href="#äºŒã€Content-Type" class="headerlink" title="äºŒã€Content-Type"></a>äºŒã€<code>Content-Type</code></h3><ul><li><strong>ä½œç”¨åŸŸ</strong>ï¼šHTTP è¯·æ±‚å¤´æˆ–å“åº”å¤´ã€‚</li><li><strong>è§’è‰²</strong>ï¼š<strong>é€šä¿¡æ•°æ®çš„åª’ä½“ç±»å‹</strong>ã€‚</li><li><strong>æ¦‚å¿µ</strong>ï¼š<code>Content-Type</code> å‘Šè¯‰æ¥æ”¶æ–¹ï¼ˆæœåŠ¡å™¨æˆ–æµè§ˆå™¨ï¼‰è¯·æ±‚ä½“æˆ–å“åº”ä½“ä¸­çš„<strong>æ•°æ®æ˜¯ä»€ä¹ˆæ ¼å¼</strong>ã€‚å®ƒæ˜¯ä¸€ä¸ªé€šç”¨çš„ HTTP å¤´éƒ¨ï¼Œä¸ä»…é™äºè¡¨å•æäº¤ã€‚</li><li><strong>å¸¸è§å€¼</strong>ï¼š<ul><li><code>text/html</code>ï¼šHTML æ–‡æ¡£ã€‚</li><li><code>application/json</code>ï¼šJSON æ ¼å¼æ•°æ®ã€‚</li><li><code>image/jpeg</code>ï¼šJPEG å›¾ç‰‡ã€‚</li><li><code>application/xml</code>ï¼šXML æ–‡æ¡£ã€‚</li><li><code>text/plain</code>ï¼šçº¯æ–‡æœ¬ã€‚</li></ul></li></ul><p><strong>ç®€å•æ¥è¯´ï¼ŒContent-Type æ˜¯â€œæˆ‘å‘é€ç»™ä½ çš„æ•°æ®æ˜¯ä»€ä¹ˆç±»å‹â€çš„å£°æ˜ã€‚</strong></p><h3 id="ä¸‰ã€æ ¸å¿ƒåŒºåˆ«ä¸è”ç³»"><a href="#ä¸‰ã€æ ¸å¿ƒåŒºåˆ«ä¸è”ç³»" class="headerlink" title="ä¸‰ã€æ ¸å¿ƒåŒºåˆ«ä¸è”ç³»"></a>ä¸‰ã€æ ¸å¿ƒåŒºåˆ«ä¸è”ç³»</h3><table><thead><tr><th>ç‰¹æ€§</th><th><code>enctype</code></th><th><code>Content-Type</code></th></tr></thead><tbody><tr><td><strong>ä½ç½®</strong></td><td>HTML <code>&lt;form&gt;</code> æ ‡ç­¾çš„å±æ€§</td><td>HTTP è¯·æ±‚å¤´æˆ–å“åº”å¤´</td></tr><tr><td><strong>è°å®šä¹‰</strong></td><td>å¼€å‘è€…åœ¨ HTML ä¸­è®¾ç½®</td><td>å‘é€æ–¹ï¼ˆæµè§ˆå™¨æˆ–æœåŠ¡å™¨ï¼‰åœ¨ HTTP å¤´éƒ¨ä¸­è®¾ç½®</td></tr><tr><td><strong>ä½œç”¨</strong></td><td>å‘Šè¯‰<strong>æµè§ˆå™¨</strong>å¦‚ä½•<strong>æ‰“åŒ…</strong>è¡¨å•æ•°æ®</td><td>å‘Šè¯‰<strong>æ¥æ”¶æ–¹</strong>å¦‚ä½•<strong>è§£æ</strong>æ•°æ®</td></tr><tr><td><strong>å…³ç³»</strong></td><td><strong>enctype çš„å€¼å†³å®šäº† HTTP è¯·æ±‚å¤´ä¸­ Content-Type çš„å€¼ã€‚</strong></td><td><code>Content-Type</code> æ˜¯ HTTP åè®®çš„ä¸€éƒ¨åˆ†ï¼Œ<code>enctype</code> æ˜¯ HTML çš„ä¸€éƒ¨åˆ†ã€‚</td></tr></tbody></table><h3 id="ä¸¾ä¾‹è¯´æ˜"><a href="#ä¸¾ä¾‹è¯´æ˜" class="headerlink" title="ä¸¾ä¾‹è¯´æ˜"></a>ä¸¾ä¾‹è¯´æ˜</h3><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªåŒ…å«ç”¨æˆ·åå’Œå¤´åƒä¸Šä¼ çš„è¡¨å•ï¼š</p><p>HTML</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=&quot;/profile&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</span><br><span class="line">    &lt;input type=&quot;text&quot; name=&quot;username&quot;&gt;</span><br><span class="line">    &lt;input type=&quot;file&quot; name=&quot;avatar&quot;&gt;</span><br><span class="line">    &lt;button type=&quot;submit&quot;&gt;æäº¤&lt;/button&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure><p>å½“ç”¨æˆ·ç‚¹å‡»æäº¤æ—¶ï¼Œæµè§ˆå™¨ä¼šåšä¸¤ä»¶äº‹ï¼š</p><ol><li><p><strong>æ ¹æ® enctype&#x3D;â€multipart&#x2F;form-dataâ€ è§„åˆ™</strong>ï¼Œæµè§ˆå™¨ä¼šç”Ÿæˆä¸€ä¸ª**å¤šéƒ¨åˆ†ï¼ˆ<code>multipart</code>ï¼‰**çš„è¯·æ±‚ä½“ï¼ŒåŒ…å«ç”¨æˆ·åå’Œå¤´åƒæ–‡ä»¶çš„äºŒè¿›åˆ¶æ•°æ®ã€‚</p></li><li><p>åœ¨å‘é€ HTTP è¯·æ±‚æ—¶ï¼Œæµè§ˆå™¨ä¼šåœ¨è¯·æ±‚å¤´ä¸­è‡ªåŠ¨æ·»åŠ ä¸€ä¸ª <code>Content-Type</code> å­—æ®µï¼Œå…¶å€¼ä¸º<strong>ä¸ enctype åŒ¹é…çš„</strong> <code>multipart/form-data</code>ã€‚</p><p>HTTP</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST /profile HTTP/1.1</span><br><span class="line">Host: example.com</span><br><span class="line">Content-Type: multipart/form-data; boundary=----WebKitFormBoundary...</span><br><span class="line">...</span><br></pre></td></tr></table></figure></li></ol><p><strong>æ€»ç»“</strong>ï¼š</p><ul><li><strong>enctype æ˜¯ä¸€ä¸ªå‰ç«¯æ¦‚å¿µ</strong>ï¼Œå®ƒæ˜¯ HTML è¡¨å•çš„å±æ€§ï¼Œç”¨äºæŒ‡å¯¼æµè§ˆå™¨å¦‚ä½•æ„å»ºè¯·æ±‚ä½“ã€‚</li><li><strong>Content-Type æ˜¯ä¸€ä¸ª HTTP åè®®æ¦‚å¿µ</strong>ï¼Œå®ƒæ˜¯ HTTP å¤´éƒ¨çš„ä¸€ä¸ªå­—æ®µï¼Œç”¨äºå‘ŠçŸ¥æ•°æ®æ ¼å¼ã€‚</li><li>ä¸¤è€…ä¹‹é—´å­˜åœ¨<strong>è”åŠ¨å…³ç³»</strong>ï¼šä½ åœ¨ HTML ä¸­è®¾ç½®çš„ <code>enctype</code> å€¼ï¼Œä¼š<strong>æœ€ç»ˆå½±å“</strong>æµè§ˆå™¨åœ¨ HTTP è¯·æ±‚ä¸­è®¾ç½®çš„ <code>Content-Type</code> å¤´çš„å€¼ã€‚</li></ul><p>å¥½çš„ï¼Œæˆ‘æ¥ä¸ºä½ åˆ†åˆ«åˆ—å‡º <code>enctype</code> å’Œ <code>Content-Type</code> å„è‡ªå¸¸è§çš„å±æ€§å€¼ï¼Œå¹¶ç®€è¦è¯´æ˜å…¶ç”¨é€”ã€‚</p><hr><h3 id="ä¸€ã€enctype-çš„å¸¸è§å€¼"><a href="#ä¸€ã€enctype-çš„å¸¸è§å€¼" class="headerlink" title="ä¸€ã€enctype çš„å¸¸è§å€¼"></a>ä¸€ã€<code>enctype</code> çš„å¸¸è§å€¼</h3><p><code>enctype</code> æ˜¯ HTML <code>&lt;form&gt;</code> æ ‡ç­¾çš„å±æ€§ï¼Œç”¨äºå®šä¹‰è¡¨å•æ•°æ®æäº¤çš„ç¼–ç æ–¹å¼ã€‚</p><ol><li><strong>application&#x2F;x-www-form-urlencoded</strong><ul><li><strong>ç”¨é€”</strong>ï¼šè¿™æ˜¯ <code>enctype</code> çš„<strong>é»˜è®¤å€¼</strong>ã€‚å®ƒå°†è¡¨å•æ•°æ®ç¼–ç ä¸ºé”®å€¼å¯¹å­—ç¬¦ä¸²ï¼Œå…¶ä¸­æ‰€æœ‰ç‰¹æ®Šå­—ç¬¦éƒ½ä¼šè¢« URL ç¼–ç ï¼ˆä¾‹å¦‚ç©ºæ ¼è¢« <code>%20</code> æ›¿ä»£ï¼‰ã€‚</li><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šåªåŒ…å«æ–‡æœ¬æ•°æ®çš„æ™®é€šè¡¨å•æäº¤ã€‚</li></ul></li><li><strong>multipart&#x2F;form-data</strong><ul><li><strong>ç”¨é€”</strong>ï¼šå°†è¡¨å•æ•°æ®åˆ†å‰²æˆå¤šä¸ªéƒ¨åˆ†ï¼Œæ¯ä¸ªéƒ¨åˆ†éƒ½æœ‰ç‹¬ç«‹çš„ <code>Content-Type</code> å’Œ <code>Content-Disposition</code> å¤´éƒ¨ã€‚è¿™ç§æ ¼å¼èƒ½å¤Ÿ<strong>åŒæ—¶å¤„ç†æ–‡æœ¬å’ŒäºŒè¿›åˆ¶æ•°æ®</strong>ã€‚</li><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š<strong>æ–‡ä»¶ä¸Šä¼ </strong>ã€‚</li></ul></li><li><strong>text&#x2F;plain</strong><ul><li><strong>ç”¨é€”</strong>ï¼šå°†è¡¨å•æ•°æ®ä»¥çº¯æ–‡æœ¬æ ¼å¼å‘é€ï¼Œä¸è¿›è¡Œä»»ä½•ç¼–ç ã€‚æ•°æ®ä»¥é”®å€¼å¯¹çš„å½¢å¼ï¼Œç”¨æ¢è¡Œç¬¦åˆ†éš”ã€‚</li><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šä¸å¸¸ç”¨ï¼Œä¸»è¦ç”¨äºè°ƒè¯•ç›®çš„ã€‚</li></ul></li></ol><h3 id="äºŒã€Content-Type-çš„å¸¸è§å€¼"><a href="#äºŒã€Content-Type-çš„å¸¸è§å€¼" class="headerlink" title="äºŒã€Content-Type çš„å¸¸è§å€¼"></a>äºŒã€<code>Content-Type</code> çš„å¸¸è§å€¼</h3><p><code>Content-Type</code> æ˜¯ HTTP å¤´éƒ¨å­—æ®µï¼Œç”¨äºæŒ‡å®šæ¶ˆæ¯ä½“çš„åª’ä½“ç±»å‹ï¼ˆMIME ç±»å‹ï¼‰ã€‚</p><h4 id="1-æ–‡æœ¬ç±»å‹-text"><a href="#1-æ–‡æœ¬ç±»å‹-text" class="headerlink" title="1. æ–‡æœ¬ç±»å‹ (text/)"></a>1. æ–‡æœ¬ç±»å‹ (<code>text/</code>)</h4><ul><li><strong>text&#x2F;plain</strong>ï¼šçº¯æ–‡æœ¬ã€‚</li><li><strong>text&#x2F;html</strong>ï¼šHTML æ–‡æ¡£ã€‚è¿™æ˜¯æµè§ˆå™¨æ¸²æŸ“ç½‘é¡µçš„é»˜è®¤ç±»å‹ã€‚</li><li><strong>text&#x2F;css</strong>ï¼šCSS æ ·å¼è¡¨ã€‚</li><li><strong>text&#x2F;javascript</strong>ï¼šJavaScript ä»£ç ã€‚</li></ul><h4 id="2-åº”ç”¨ç±»å‹-application"><a href="#2-åº”ç”¨ç±»å‹-application" class="headerlink" title="2. åº”ç”¨ç±»å‹ (application/)"></a>2. åº”ç”¨ç±»å‹ (<code>application/</code>)</h4><ul><li><strong>application&#x2F;json</strong>ï¼šJSON æ ¼å¼çš„æ•°æ®ã€‚ç›®å‰æœ€å¸¸ç”¨çš„å‰åç«¯æ•°æ®äº¤äº’æ ¼å¼ã€‚</li><li><strong>application&#x2F;xml</strong>ï¼šXML æ ¼å¼çš„æ•°æ®ã€‚</li><li><strong>application&#x2F;pdf</strong>ï¼šPDF æ–‡æ¡£ã€‚</li><li><strong>application&#x2F;octet-stream</strong>ï¼šé€šç”¨çš„<strong>äºŒè¿›åˆ¶æµæ•°æ®</strong>ã€‚é€šå¸¸ç”¨äº<strong>å¼ºåˆ¶æµè§ˆå™¨ä¸‹è½½</strong>æœªçŸ¥ç±»å‹çš„æ–‡ä»¶ï¼Œå› ä¸ºå®ƒå‘Šè¯‰æµè§ˆå™¨â€œè¿™æ˜¯ä¸€ä¸ªåŸå§‹çš„å­—èŠ‚æµï¼Œè¯·ä¸è¦å°è¯•è§£æå®ƒâ€ã€‚</li><li><strong>application&#x2F;x-www-form-urlencoded</strong>ï¼šä¸ <code>enctype</code> çš„é»˜è®¤å€¼å¯¹åº”ï¼Œè¡¨æ˜è¯·æ±‚ä½“æ˜¯ URL ç¼–ç çš„é”®å€¼å¯¹ã€‚</li><li><strong>application&#x2F;javascript</strong>ï¼šä¸ <code>text/javascript</code> ç±»ä¼¼ï¼Œæ›´æ¨èä½¿ç”¨ã€‚</li></ul><h4 id="3-å›¾ç‰‡ç±»å‹-image"><a href="#3-å›¾ç‰‡ç±»å‹-image" class="headerlink" title="3. å›¾ç‰‡ç±»å‹ (image/)"></a>3. å›¾ç‰‡ç±»å‹ (<code>image/</code>)</h4><ul><li><strong>image&#x2F;jpeg</strong>ï¼šJPEG&#x2F;JPG æ ¼å¼çš„å›¾ç‰‡ã€‚</li><li><strong>image&#x2F;png</strong>ï¼šPNG æ ¼å¼çš„å›¾ç‰‡ã€‚</li><li><strong>image&#x2F;gif</strong>ï¼šGIF æ ¼å¼çš„å›¾ç‰‡ã€‚</li><li><strong>image&#x2F;svg+xml</strong>ï¼šSVG çŸ¢é‡å›¾ã€‚</li></ul><h4 id="4-éŸ³è§†é¢‘ç±»å‹"><a href="#4-éŸ³è§†é¢‘ç±»å‹" class="headerlink" title="4. éŸ³è§†é¢‘ç±»å‹"></a>4. éŸ³è§†é¢‘ç±»å‹</h4><ul><li><strong>audio&#x2F;mpeg</strong>ï¼šMP3 éŸ³é¢‘æ–‡ä»¶ã€‚</li><li><strong>video&#x2F;mp4</strong>ï¼šMP4 è§†é¢‘æ–‡ä»¶ã€‚</li></ul><h4 id="5-å¤šéƒ¨åˆ†ç±»å‹-multipart"><a href="#5-å¤šéƒ¨åˆ†ç±»å‹-multipart" class="headerlink" title="5. å¤šéƒ¨åˆ†ç±»å‹ (multipart/)"></a>5. å¤šéƒ¨åˆ†ç±»å‹ (<code>multipart/</code>)</h4><ul><li><strong>multipart&#x2F;form-data</strong>ï¼šç”¨äºæ–‡ä»¶ä¸Šä¼ ï¼Œä¸ <code>enctype</code> çš„å€¼å¯¹åº”ã€‚</li><li><strong>multipart&#x2F;byteranges</strong>ï¼šç”¨äºåˆ†å—ä¸‹è½½ï¼Œæ”¯æŒæ–­ç‚¹ç»­ä¼ ã€‚</li></ul><p>å¥½çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸ç»å…¸çš„é¢è¯•é¢˜ï¼Œä¹Ÿæ˜¯ç†è§£ Web åŸºç¡€çŸ¥è¯†çš„å…³é”®ã€‚æˆ‘ä¼šè¯¦ç»†ã€æ¸…æ™°åœ°è§£é‡Š URL å’Œ URIï¼Œå¹¶ç”¨é€šä¿—æ˜“æ‡‚çš„æ–¹å¼åŒºåˆ†å®ƒä»¬ã€‚</p><hr><h3 id="ä¸€ã€æ ¸å¿ƒæ¦‚å¿µ"><a href="#ä¸€ã€æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="ä¸€ã€æ ¸å¿ƒæ¦‚å¿µ"></a>ä¸€ã€æ ¸å¿ƒæ¦‚å¿µ</h3><ul><li><strong>URI (Uniform Resource Identifier) - ç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦</strong><ul><li><strong>æ¦‚å¿µ</strong>ï¼šURI æ˜¯ä¸€ä¸ªç”¨äº<strong>æ ‡è¯†</strong>äº’è”ç½‘ä¸Š<strong>ä»»ä½•èµ„æº</strong>çš„å­—ç¬¦ä¸²ã€‚å®ƒä¸ä»…ä»…èƒ½æ ‡è¯†ç½‘é¡µï¼Œè¿˜å¯ä»¥æ ‡è¯†æ–‡ä»¶ã€æœåŠ¡ã€ç”µå­é‚®ç®±ç­‰ã€‚</li><li><strong>ä½œç”¨</strong>ï¼š<strong>æ ‡è¯†</strong>ã€‚URI å°±åƒä¸€ä¸ªèµ„æºçš„â€œèº«ä»½è¯å·â€ï¼Œå®ƒèƒ½å”¯ä¸€åœ°è¯†åˆ«ä¸€ä¸ªèµ„æºï¼Œä½†<strong>ä¸ä¸€å®š</strong>å‘Šè¯‰æˆ‘ä»¬å¦‚ä½•è®¿é—®å®ƒã€‚</li></ul></li><li><strong>URL (Uniform Resource Locator) - ç»Ÿä¸€èµ„æºå®šä½ç¬¦</strong><ul><li><strong>æ¦‚å¿µ</strong>ï¼šURL æ˜¯ä¸€ä¸ªç”¨äº<strong>å®šä½</strong>äº’è”ç½‘ä¸Šèµ„æºçš„å­—ç¬¦ä¸²ã€‚å®ƒæ˜¯ URI çš„ä¸€ä¸ª<strong>å­é›†</strong>ã€‚</li><li><strong>ä½œç”¨</strong>ï¼š<strong>å®šä½</strong>ã€‚URL å°±åƒä¸€ä¸ªèµ„æºçš„â€œè¯¦ç»†åœ°å€â€ï¼Œå®ƒä¸ä»…æ ‡è¯†äº†èµ„æºï¼Œè¿˜æä¾›äº†<strong>å¦‚ä½•è®¿é—®è¯¥èµ„æº</strong>çš„å®Œæ•´ä¿¡æ¯ï¼ŒåŒ…æ‹¬åè®®ã€ä¸»æœºåã€ç«¯å£å·å’Œè·¯å¾„ç­‰ã€‚</li></ul></li></ul><h3 id="äºŒã€URL-å’Œ-URI-çš„å…³ç³»"><a href="#äºŒã€URL-å’Œ-URI-çš„å…³ç³»" class="headerlink" title="äºŒã€URL å’Œ URI çš„å…³ç³»"></a>äºŒã€URL å’Œ URI çš„å…³ç³»</h3><p>ç”¨ä¸€ä¸ªæ¯”å–»æ¥ç†è§£ï¼š</p><ul><li><strong>URI</strong> å°±åƒä¸€ä¸ªäººçš„<strong>åå­—</strong>ã€‚<code>å¼ ä¸‰</code>è¿™ä¸ªåå­—å¯ä»¥æ ‡è¯†è¿™ä¸ªäººï¼Œä½†ä½ ä¸çŸ¥é“ä»–åœ¨å“ªé‡Œã€æ€ä¹ˆæ‰¾åˆ°ä»–ã€‚</li><li><strong>URL</strong> å°±åƒä¸€ä¸ªäººçš„<strong>å®¶åº­ä½å€</strong>ã€‚<code>åŒ—äº¬å¸‚æµ·æ·€åŒºä¸­å…³æ‘å¤§è¡—1å·</code>ã€‚è¿™ä¸ªåœ°å€ä¸ä»…æ ‡è¯†äº†è¿™ä¸ªäººï¼Œè¿˜å‘Šè¯‰äº†ä½ å¦‚ä½•å®šä½ä»–ã€‚</li></ul><p><strong>å› æ­¤ï¼Œæ‰€æœ‰çš„ URL éƒ½æ˜¯ URIï¼Œä½†å¹¶éæ‰€æœ‰çš„ URI éƒ½æ˜¯ URLã€‚</strong></p><h3 id="ä¸‰ã€URL-å’Œ-URI-çš„å…·ä½“ç»“æ„"><a href="#ä¸‰ã€URL-å’Œ-URI-çš„å…·ä½“ç»“æ„" class="headerlink" title="ä¸‰ã€URL å’Œ URI çš„å…·ä½“ç»“æ„"></a>ä¸‰ã€URL å’Œ URI çš„å…·ä½“ç»“æ„</h3><h4 id="URI-çš„ç»“æ„ï¼š"><a href="#URI-çš„ç»“æ„ï¼š" class="headerlink" title="URI çš„ç»“æ„ï¼š"></a>URI çš„ç»“æ„ï¼š</h4><p>ä¸€ä¸ª URI é€šå¸¸ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š</p><p><code>scheme:[//authority][path][?query][#fragment]</code></p><ul><li><code>scheme</code>ï¼šåè®®ï¼Œå¦‚ <code>http</code>, <code>ftp</code>, <code>mailto</code>ã€‚</li><li><code>path</code>ï¼šèµ„æºè·¯å¾„ã€‚</li></ul><h4 id="URL-çš„ç»“æ„ï¼š"><a href="#URL-çš„ç»“æ„ï¼š" class="headerlink" title="URL çš„ç»“æ„ï¼š"></a>URL çš„ç»“æ„ï¼š</h4><p>URL åŒ…å«äº† URI çš„æ‰€æœ‰ç»„æˆéƒ¨åˆ†ï¼Œå¹¶åŠ å…¥äº†å®šä½ä¿¡æ¯ã€‚</p><p><code>scheme://host:port/path?query#fragment</code></p><ul><li><code>scheme</code>ï¼šåè®®ã€‚å¦‚ <code>http</code>, <code>https</code>, <code>ftp</code>ã€‚</li><li><code>host</code>ï¼šä¸»æœºåæˆ– IP åœ°å€ã€‚</li><li><code>port</code>ï¼šç«¯å£å·ï¼ˆå¯é€‰ï¼Œå¦‚æœä½¿ç”¨é»˜è®¤ç«¯å£åˆ™å¯ä»¥çœç•¥ï¼‰ã€‚</li><li><code>path</code>ï¼šèµ„æºè·¯å¾„ã€‚</li><li><code>query</code>ï¼šæŸ¥è¯¢å‚æ•°ï¼Œä»¥ <code>?</code> å¼€å§‹ã€‚</li><li><code>fragment</code>ï¼šç‰‡æ®µæ ‡è¯†ç¬¦ï¼Œä»¥ <code>#</code> å¼€å§‹ã€‚</li></ul><h3 id="å››ã€ä¸¾ä¾‹è¯´æ˜"><a href="#å››ã€ä¸¾ä¾‹è¯´æ˜" class="headerlink" title="å››ã€ä¸¾ä¾‹è¯´æ˜"></a>å››ã€ä¸¾ä¾‹è¯´æ˜</h3><table><thead><tr><th>å­—ç¬¦ä¸²</th><th>ç±»åˆ«</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td><code>https://www.google.com/search?q=url+uri</code></td><td><strong>URL</strong> å’Œ <strong>URI</strong></td><td>æ—¢æ˜¯ URIï¼ˆæ ‡è¯†ï¼‰ï¼Œä¹Ÿæ˜¯ URLï¼ˆå®šä½ï¼‰ï¼Œæä¾›äº†å®Œæ•´çš„è®¿é—®ä¿¡æ¯ã€‚</td></tr><tr><td><code>urn:isbn:0451450523</code></td><td><strong>URI</strong> ä½†<strong>ä¸æ˜¯ URL</strong></td><td><code>urn:isbn</code> æ˜¯ä¸€ä¸ª URN (Uniform Resource Name)ï¼Œå®ƒæ˜¯ URI çš„å¦ä¸€ç§ç±»å‹ï¼Œç”¨äºæ ‡è¯†ä¸€æœ¬ä¹¦ã€‚å®ƒæ ‡è¯†äº†èµ„æºï¼Œä½†æ²¡æœ‰æä¾›å¦‚ä½•è®¿é—®å®ƒçš„ä½ç½®ä¿¡æ¯ã€‚</td></tr><tr><td><code>/images/logo.png</code></td><td><strong>URI</strong> ä½†<strong>ä¸æ˜¯ URL</strong></td><td>è¿™æ˜¯ä¸€ä¸ªç›¸å¯¹è·¯å¾„ï¼Œå®ƒæ ‡è¯†äº†èµ„æºï¼Œä½†æ²¡æœ‰å®Œæ•´çš„å®šä½ä¿¡æ¯ï¼ˆå¦‚åè®®ã€ä¸»æœºåï¼‰ï¼Œéœ€è¦ç»“åˆå½“å‰é¡µé¢çš„ URL æ‰èƒ½ç¡®å®šå®Œæ•´ä½ç½®ã€‚</td></tr><tr><td><code>mailto:test@example.com</code></td><td><strong>URI</strong> ä½†<strong>ä¸æ˜¯ URL</strong></td><td>æ ‡è¯†äº†ä¸€ä¸ªé‚®ç®±èµ„æºï¼Œä½†æ— æ³•é€šè¿‡å®ƒæ¥å®šä½åˆ°å…·ä½“çš„æ–‡ä»¶æˆ–æœåŠ¡å™¨ã€‚</td></tr></tbody></table><h3 id="äº”ã€é¢è¯•å›ç­”æ€»ç»“"><a href="#äº”ã€é¢è¯•å›ç­”æ€»ç»“" class="headerlink" title="äº”ã€é¢è¯•å›ç­”æ€»ç»“"></a>äº”ã€é¢è¯•å›ç­”æ€»ç»“</h3><ol><li><p><strong>å¼€é—¨è§å±±</strong>ï¼šURL æ˜¯ URI çš„å­é›†ã€‚</p></li><li><p><strong>æ ¸å¿ƒåŒºåˆ«</strong>ï¼š</p><ul><li><strong>URI æ˜¯æ ‡è¯†ç¬¦</strong>ï¼Œå®ƒåªè´Ÿè´£<strong>æ ‡è¯†</strong>ä¸€ä¸ªèµ„æºï¼Œä¸æä¾›å¦‚ä½•è®¿é—®å®ƒçš„ä¿¡æ¯ã€‚</li><li><strong>URL æ˜¯å®šä½ç¬¦</strong>ï¼Œå®ƒåœ¨æ ‡è¯†èµ„æºçš„åŒæ—¶ï¼Œè¿˜æä¾›äº†<strong>å®šä½</strong>è¯¥èµ„æºçš„å®Œæ•´ä¿¡æ¯ï¼Œå¦‚åè®®ã€ä¸»æœºåç­‰ã€‚</li></ul></li><li><p><strong>ä¸¾ä¾‹</strong>ï¼š</p><ul><li>URLï¼š<code>https://www.example.com/index.html</code>ï¼ŒåŒ…å«äº†åè®®ã€ä¸»æœºã€è·¯å¾„ï¼Œå¯ä»¥æ˜ç¡®åœ°å®šä½ä¸€ä¸ªèµ„æºã€‚</li><li>URIï¼š<code>urn:isbn:0451450523</code>ï¼Œå®ƒæ ‡è¯†äº†ä¸€æœ¬ä¹¦ï¼Œä½†ä½ æ— æ³•é€šè¿‡å®ƒæ¥è®¿é—®è¿™æœ¬ä¹¦çš„ç”µå­ç‰ˆã€‚</li></ul></li><li><p><strong>å…³ç³»å›¾</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+-------------+</span><br><span class="line">|      URI    |</span><br><span class="line">|             |</span><br><span class="line">|  +----------+---------+</span><br><span class="line">|  |   URL    |   URN   |</span><br><span class="line">|  | (å®šä½)   |  (å‘½å) |</span><br><span class="line">|  +----------+---------+</span><br><span class="line">|             |</span><br><span class="line">+-------------+</span><br></pre></td></tr></table></figure><p>ç”¨è¿™ä¸ªå›¾èƒ½éå¸¸æ¸…æ™°åœ°å±•ç°å®ƒä»¬ä¹‹é—´çš„å…³ç³»ã€‚</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> servlet </tag>
            
            <tag> å‰ç«¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç®—æ³•</title>
      <link href="/2025/09/11/%E7%AE%97%E6%B3%95/"/>
      <url>/2025/09/11/%E7%AE%97%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<hr><h1 id="ğŸ”¥-å¸¸è§ç®—æ³•åˆ†ç±»-Javaå®ç°"><a href="#ğŸ”¥-å¸¸è§ç®—æ³•åˆ†ç±»-Javaå®ç°" class="headerlink" title="ğŸ”¥ å¸¸è§ç®—æ³•åˆ†ç±» + Javaå®ç°"></a>ğŸ”¥ å¸¸è§ç®—æ³•åˆ†ç±» + Javaå®ç°</h1><hr><h2 id="1-æ’åºç®—æ³•-Sorting"><a href="#1-æ’åºç®—æ³•-Sorting" class="headerlink" title="1. æ’åºç®—æ³• (Sorting)"></a>1. æ’åºç®—æ³• (Sorting)</h2><h3 id="1-1-å†’æ³¡æ’åº-Bubble-Sort"><a href="#1-1-å†’æ³¡æ’åº-Bubble-Sort" class="headerlink" title="1.1 å†’æ³¡æ’åº (Bubble Sort)"></a>1.1 å†’æ³¡æ’åº (Bubble Sort)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">bubbleSort</span><span class="params">(<span class="type">int</span>[] arr)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; arr.length - <span class="number">1</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; arr.length - <span class="number">1</span> - i; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (arr[j] &gt; arr[j+<span class="number">1</span>]) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">tmp</span> <span class="operator">=</span> arr[j];</span><br><span class="line">                arr[j] = arr[j+<span class="number">1</span>];</span><br><span class="line">                arr[j+<span class="number">1</span>] = tmp;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-2-é€‰æ‹©æ’åº-Selection-Sort"><a href="#1-2-é€‰æ‹©æ’åº-Selection-Sort" class="headerlink" title="1.2 é€‰æ‹©æ’åº (Selection Sort)"></a>1.2 é€‰æ‹©æ’åº (Selection Sort)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">selectionSort</span><span class="params">(<span class="type">int</span>[] arr)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; arr.length - <span class="number">1</span>; i++) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">minIndex</span> <span class="operator">=</span> i;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i + <span class="number">1</span>; j &lt; arr.length; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (arr[j] &lt; arr[minIndex]) minIndex = j;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">tmp</span> <span class="operator">=</span> arr[i]; arr[i] = arr[minIndex]; arr[minIndex] = tmp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-3-æ’å…¥æ’åº-Insertion-Sort"><a href="#1-3-æ’å…¥æ’åº-Insertion-Sort" class="headerlink" title="1.3 æ’å…¥æ’åº (Insertion Sort)"></a>1.3 æ’å…¥æ’åº (Insertion Sort)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">insertionSort</span><span class="params">(<span class="type">int</span>[] arr)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">key</span> <span class="operator">=</span> arr[i], j = i - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (j &gt;= <span class="number">0</span> &amp;&amp; arr[j] &gt; key) &#123;</span><br><span class="line">            arr[j+<span class="number">1</span>] = arr[j];</span><br><span class="line">            j--;</span><br><span class="line">        &#125;</span><br><span class="line">        arr[j+<span class="number">1</span>] = key;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-4-å½’å¹¶æ’åº-Merge-Sort"><a href="#1-4-å½’å¹¶æ’åº-Merge-Sort" class="headerlink" title="1.4 å½’å¹¶æ’åº (Merge Sort)"></a>1.4 å½’å¹¶æ’åº (Merge Sort)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">mergeSort</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> l, <span class="type">int</span> r)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (l &gt;= r) <span class="keyword">return</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> (l + r) / <span class="number">2</span>;</span><br><span class="line">    mergeSort(arr, l, mid);</span><br><span class="line">    mergeSort(arr, mid + <span class="number">1</span>, r);</span><br><span class="line">    merge(arr, l, mid, r);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">merge</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> l, <span class="type">int</span> mid, <span class="type">int</span> r)</span> &#123;</span><br><span class="line">    <span class="type">int</span>[] tmp = <span class="keyword">new</span> <span class="title class_">int</span>[r - l + <span class="number">1</span>];</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> l, j = mid + <span class="number">1</span>, k = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt;= mid &amp;&amp; j &lt;= r) &#123;</span><br><span class="line">        tmp[k++] = (arr[i] &lt;= arr[j]) ? arr[i++] : arr[j++];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (i &lt;= mid) tmp[k++] = arr[i++];</span><br><span class="line">    <span class="keyword">while</span> (j &lt;= r) tmp[k++] = arr[j++];</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; tmp.length; i++) arr[l + i] = tmp[i];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-5-å¿«é€Ÿæ’åº-Quick-Sort"><a href="#1-5-å¿«é€Ÿæ’åº-Quick-Sort" class="headerlink" title="1.5 å¿«é€Ÿæ’åº (Quick Sort)"></a>1.5 å¿«é€Ÿæ’åº (Quick Sort)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">quickSort</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> l, <span class="type">int</span> r)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (l &gt;= r) <span class="keyword">return</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">p</span> <span class="operator">=</span> partition(arr, l, r);</span><br><span class="line">    quickSort(arr, l, p - <span class="number">1</span>);</span><br><span class="line">    quickSort(arr, p + <span class="number">1</span>, r);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">partition</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> l, <span class="type">int</span> r)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">pivot</span> <span class="operator">=</span> arr[r], i = l - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> l; j &lt; r; j++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (arr[j] &lt;= pivot) &#123;</span><br><span class="line">            i++;</span><br><span class="line">            <span class="type">int</span> <span class="variable">tmp</span> <span class="operator">=</span> arr[i]; arr[i] = arr[j]; arr[j] = tmp;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">tmp</span> <span class="operator">=</span> arr[i+<span class="number">1</span>]; arr[i+<span class="number">1</span>] = arr[r]; arr[r] = tmp;</span><br><span class="line">    <span class="keyword">return</span> i + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="2-æŸ¥æ‰¾ç®—æ³•-Searching"><a href="#2-æŸ¥æ‰¾ç®—æ³•-Searching" class="headerlink" title="2. æŸ¥æ‰¾ç®—æ³• (Searching)"></a>2. æŸ¥æ‰¾ç®—æ³• (Searching)</h2><h3 id="2-1-é¡ºåºæŸ¥æ‰¾-Linear-Search"><a href="#2-1-é¡ºåºæŸ¥æ‰¾-Linear-Search" class="headerlink" title="2.1 é¡ºåºæŸ¥æ‰¾ (Linear Search)"></a>2.1 é¡ºåºæŸ¥æ‰¾ (Linear Search)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">linearSearch</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (arr[i] == target) <span class="keyword">return</span> i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-2-äºŒåˆ†æŸ¥æ‰¾-Binary-Search-ï¼ˆæ•°ç»„æœ‰åºï¼‰"><a href="#2-2-äºŒåˆ†æŸ¥æ‰¾-Binary-Search-ï¼ˆæ•°ç»„æœ‰åºï¼‰" class="headerlink" title="2.2 äºŒåˆ†æŸ¥æ‰¾ (Binary Search)ï¼ˆæ•°ç»„æœ‰åºï¼‰"></a>2.2 äºŒåˆ†æŸ¥æ‰¾ (Binary Search)ï¼ˆæ•°ç»„æœ‰åºï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">binarySearch</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> <span class="number">0</span>, r = arr.length - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (l &lt;= r) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> l + (r - l) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (arr[mid] == target) <span class="keyword">return</span> mid;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (arr[mid] &lt; target) l = mid + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> r = mid - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="3-åŒæŒ‡é’ˆç®—æ³•-Two-Pointers"><a href="#3-åŒæŒ‡é’ˆç®—æ³•-Two-Pointers" class="headerlink" title="3. åŒæŒ‡é’ˆç®—æ³• (Two Pointers)"></a>3. åŒæŒ‡é’ˆç®—æ³• (Two Pointers)</h2><h3 id="3-1-åè½¬æ•°ç»„"><a href="#3-1-åè½¬æ•°ç»„" class="headerlink" title="3.1 åè½¬æ•°ç»„"></a>3.1 åè½¬æ•°ç»„</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">reverse</span><span class="params">(<span class="type">int</span>[] arr)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> <span class="number">0</span>, r = arr.length - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (l &lt; r) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">tmp</span> <span class="operator">=</span> arr[l]; arr[l] = arr[r]; arr[r] = tmp;</span><br><span class="line">        l++; r--;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-2-ä¸‰æ•°ä¹‹å’Œ-LeetCode-15"><a href="#3-2-ä¸‰æ•°ä¹‹å’Œ-LeetCode-15" class="headerlink" title="3.2 ä¸‰æ•°ä¹‹å’Œ (LeetCode 15)"></a>3.2 ä¸‰æ•°ä¹‹å’Œ (LeetCode 15)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">threeSum</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    Arrays.sort(nums);</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length - <span class="number">2</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i &gt; <span class="number">0</span> &amp;&amp; nums[i] == nums[i-<span class="number">1</span>]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> i+<span class="number">1</span>, r = nums.length-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (l &lt; r) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> nums[i] + nums[l] + nums[r];</span><br><span class="line">            <span class="keyword">if</span> (sum == <span class="number">0</span>) &#123;</span><br><span class="line">                res.add(Arrays.asList(nums[i], nums[l], nums[r]));</span><br><span class="line">                <span class="keyword">while</span> (l &lt; r &amp;&amp; nums[l] == nums[l+<span class="number">1</span>]) l++;</span><br><span class="line">                <span class="keyword">while</span> (l &lt; r &amp;&amp; nums[r] == nums[r-<span class="number">1</span>]) r--;</span><br><span class="line">                l++; r--;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sum &lt; <span class="number">0</span>) l++;</span><br><span class="line">            <span class="keyword">else</span> r--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="4-åŠ¨æ€è§„åˆ’-Dynamic-Programming"><a href="#4-åŠ¨æ€è§„åˆ’-Dynamic-Programming" class="headerlink" title="4. åŠ¨æ€è§„åˆ’ (Dynamic Programming)"></a>4. åŠ¨æ€è§„åˆ’ (Dynamic Programming)</h2><h3 id="4-1-æ–æ³¢é‚£å¥‘æ•°åˆ—"><a href="#4-1-æ–æ³¢é‚£å¥‘æ•°åˆ—" class="headerlink" title="4.1 æ–æ³¢é‚£å¥‘æ•°åˆ—"></a>4.1 æ–æ³¢é‚£å¥‘æ•°åˆ—</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">fib</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (n &lt;= <span class="number">1</span>) <span class="keyword">return</span> n;</span><br><span class="line">    <span class="type">int</span>[] dp = <span class="keyword">new</span> <span class="title class_">int</span>[n+<span class="number">1</span>];</span><br><span class="line">    dp[<span class="number">0</span>] = <span class="number">0</span>; dp[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>; i &lt;= n; i++) dp[i] = dp[i-<span class="number">1</span>] + dp[i-<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">return</span> dp[n];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-2-çˆ¬æ¥¼æ¢¯-LeetCode-70"><a href="#4-2-çˆ¬æ¥¼æ¢¯-LeetCode-70" class="headerlink" title="4.2 çˆ¬æ¥¼æ¢¯ (LeetCode 70)"></a>4.2 çˆ¬æ¥¼æ¢¯ (LeetCode 70)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">climbStairs</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (n &lt;= <span class="number">2</span>) <span class="keyword">return</span> n;</span><br><span class="line">    <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">1</span>, b = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">3</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">tmp</span> <span class="operator">=</span> a + b;</span><br><span class="line">        a = b; b = tmp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-3-æœ€é•¿å…¬å…±å­åºåˆ—-LCS"><a href="#4-3-æœ€é•¿å…¬å…±å­åºåˆ—-LCS" class="headerlink" title="4.3 æœ€é•¿å…¬å…±å­åºåˆ— (LCS)"></a>4.3 æœ€é•¿å…¬å…±å­åºåˆ— (LCS)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">lcs</span><span class="params">(String s1, String s2)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> s1.length(), n = s2.length();</span><br><span class="line">    <span class="type">int</span>[][] dp = <span class="keyword">new</span> <span class="title class_">int</span>[m+<span class="number">1</span>][n+<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= m; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt;= n; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (s1.charAt(i-<span class="number">1</span>) == s2.charAt(j-<span class="number">1</span>))</span><br><span class="line">                dp[i][j] = dp[i-<span class="number">1</span>][j-<span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                dp[i][j] = Math.max(dp[i-<span class="number">1</span>][j], dp[i][j-<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[m][n];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="5-è´ªå¿ƒç®—æ³•-Greedy"><a href="#5-è´ªå¿ƒç®—æ³•-Greedy" class="headerlink" title="5. è´ªå¿ƒç®—æ³• (Greedy)"></a>5. è´ªå¿ƒç®—æ³• (Greedy)</h2><h3 id="5-1-è·³è·ƒæ¸¸æˆ-LeetCode-55"><a href="#5-1-è·³è·ƒæ¸¸æˆ-LeetCode-55" class="headerlink" title="5.1 è·³è·ƒæ¸¸æˆ (LeetCode 55)"></a>5.1 è·³è·ƒæ¸¸æˆ (LeetCode 55)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">canJump</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">farthest</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i &gt; farthest) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        farthest = Math.max(farthest, i + nums[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="6-åˆ†æ²»ç®—æ³•-Divide-Conquer"><a href="#6-åˆ†æ²»ç®—æ³•-Divide-Conquer" class="headerlink" title="6. åˆ†æ²»ç®—æ³• (Divide &amp; Conquer)"></a>6. åˆ†æ²»ç®—æ³• (Divide &amp; Conquer)</h2><h3 id="6-1-å½’å¹¶æ’åº-è§ä¸Š"><a href="#6-1-å½’å¹¶æ’åº-è§ä¸Š" class="headerlink" title="6.1 å½’å¹¶æ’åº (è§ä¸Š)"></a>6.1 å½’å¹¶æ’åº (è§ä¸Š)</h3><h3 id="6-2-å¿«é€Ÿæ’åº-è§ä¸Š"><a href="#6-2-å¿«é€Ÿæ’åº-è§ä¸Š" class="headerlink" title="6.2 å¿«é€Ÿæ’åº (è§ä¸Š)"></a>6.2 å¿«é€Ÿæ’åº (è§ä¸Š)</h3><hr><h2 id="7-å›æº¯ç®—æ³•-Backtracking"><a href="#7-å›æº¯ç®—æ³•-Backtracking" class="headerlink" title="7. å›æº¯ç®—æ³• (Backtracking)"></a>7. å›æº¯ç®—æ³• (Backtracking)</h2><h3 id="7-1-å…¨æ’åˆ—-LeetCode-46"><a href="#7-1-å…¨æ’åˆ—-LeetCode-46" class="headerlink" title="7.1 å…¨æ’åˆ— (LeetCode 46)"></a>7.1 å…¨æ’åˆ— (LeetCode 46)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">permute</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    backtrack(nums, <span class="keyword">new</span> <span class="title class_">boolean</span>[nums.length], <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(), res);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">backtrack</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">boolean</span>[] used, List&lt;Integer&gt; path, List&lt;List&lt;Integer&gt;&gt; res)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (path.size() == nums.length) &#123;</span><br><span class="line">        res.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(path));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (used[i]) <span class="keyword">continue</span>;</span><br><span class="line">        used[i] = <span class="literal">true</span>;</span><br><span class="line">        path.add(nums[i]);</span><br><span class="line">        backtrack(nums, used, path, res);</span><br><span class="line">        path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">        used[i] = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="8-å›¾ç®—æ³•-Graph-Algorithms"><a href="#8-å›¾ç®—æ³•-Graph-Algorithms" class="headerlink" title="8. å›¾ç®—æ³• (Graph Algorithms)"></a>8. å›¾ç®—æ³• (Graph Algorithms)</h2><h3 id="8-1-BFSï¼ˆæœ€çŸ­è·¯å¾„ï¼‰"><a href="#8-1-BFSï¼ˆæœ€çŸ­è·¯å¾„ï¼‰" class="headerlink" title="8.1 BFSï¼ˆæœ€çŸ­è·¯å¾„ï¼‰"></a>8.1 BFSï¼ˆæœ€çŸ­è·¯å¾„ï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">bfs</span><span class="params">(Map&lt;Integer, List&lt;Integer&gt;&gt; graph, <span class="type">int</span> start)</span> &#123;</span><br><span class="line">    Queue&lt;Integer&gt; q = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    Set&lt;Integer&gt; visited = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">    q.add(start); visited.add(start);</span><br><span class="line">    <span class="keyword">while</span> (!q.isEmpty()) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">node</span> <span class="operator">=</span> q.poll();</span><br><span class="line">        System.out.print(node + <span class="string">&quot; &quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> nei : graph.getOrDefault(node, <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;())) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!visited.contains(nei)) &#123;</span><br><span class="line">                visited.add(nei);</span><br><span class="line">                q.add(nei);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="8-2-DFS"><a href="#8-2-DFS" class="headerlink" title="8.2 DFS"></a>8.2 DFS</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">dfs</span><span class="params">(Map&lt;Integer, List&lt;Integer&gt;&gt; graph, <span class="type">int</span> start, Set&lt;Integer&gt; visited)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (visited.contains(start)) <span class="keyword">return</span>;</span><br><span class="line">    visited.add(start);</span><br><span class="line">    System.out.print(start + <span class="string">&quot; &quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> nei : graph.getOrDefault(start, <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;())) &#123;</span><br><span class="line">        dfs(graph, nei, visited);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="8-3-Dijkstra-æœ€çŸ­è·¯å¾„"><a href="#8-3-Dijkstra-æœ€çŸ­è·¯å¾„" class="headerlink" title="8.3 Dijkstra æœ€çŸ­è·¯å¾„"></a>8.3 Dijkstra æœ€çŸ­è·¯å¾„</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[] dijkstra(<span class="type">int</span>[][] graph, <span class="type">int</span> src) &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> graph.length;</span><br><span class="line">    <span class="type">int</span>[] dist = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">    <span class="type">boolean</span>[] visited = <span class="keyword">new</span> <span class="title class_">boolean</span>[n];</span><br><span class="line">    Arrays.fill(dist, Integer.MAX_VALUE);</span><br><span class="line">    dist[src] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">u</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!visited[j] &amp;&amp; (u == -<span class="number">1</span> || dist[j] &lt; dist[u])) u = j;</span><br><span class="line">        &#125;</span><br><span class="line">        visited[u] = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">v</span> <span class="operator">=</span> <span class="number">0</span>; v &lt; n; v++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (graph[u][v] != <span class="number">0</span> &amp;&amp; dist[u] + graph[u][v] &lt; dist[v]) &#123;</span><br><span class="line">                dist[v] = dist[u] + graph[u][v];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dist;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¡ç®—æœºåŸºç¡€é¢è¯•</title>
      <link href="/2025/09/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E9%9D%A2%E8%AF%95/"/>
      <url>/2025/09/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E9%9D%A2%E8%AF%95/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      <categories>
          
          <category> æœªåˆ†ç±» </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo, Markdown </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ†å¸ƒå¼</title>
      <link href="/2025/09/11/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
      <url>/2025/09/11/%E5%88%86%E5%B8%83%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h4 id="1-Spring-Cloud-ä½“ç³»"><a href="#1-Spring-Cloud-ä½“ç³»" class="headerlink" title="1. Spring Cloud ä½“ç³»"></a><strong>1. Spring Cloud ä½“ç³»</strong></h4><h5 id="æ ¸å¿ƒæ€æƒ³"><a href="#æ ¸å¿ƒæ€æƒ³" class="headerlink" title="æ ¸å¿ƒæ€æƒ³"></a><strong>æ ¸å¿ƒæ€æƒ³</strong></h5><p>Spring Cloud å¹¶éä¸€ä¸ªå…¨æ–°çš„æ¡†æ¶ï¼Œè€Œæ˜¯ä¸€å¥—ç”¨äºæ„å»ºå¾®æœåŠ¡æ¶æ„çš„<strong>è§„èŒƒå’Œè§£å†³æ–¹æ¡ˆçš„é›†åˆ</strong>ã€‚å®ƒå·§å¦™åœ°åˆ©ç”¨äº† Spring Boot çš„è‡ªåŠ¨é…ç½®å’Œå¿«é€Ÿå¼€å‘ç‰¹æ€§ï¼Œå°†ä¸šç•Œç»è¿‡å¹¿æ³›éªŒè¯çš„ä¼˜ç§€å¾®æœåŠ¡ç»„ä»¶ï¼ˆå¦‚ Netflix OSSã€Alibaba Nacosã€HashiCorp Consul ç­‰ï¼‰è¿›è¡Œå°è£…å’Œé›†æˆï¼Œä¸ºå¼€å‘è€…æä¾›äº†ä¸€ç«™å¼çš„åˆ†å¸ƒå¼ç³»ç»Ÿå¼€å‘å·¥å…·ç®±ï¼Œæ¶µç›–äº†æœåŠ¡æ²»ç†ã€é…ç½®ç®¡ç†ã€ç†”æ–­é™çº§ã€æ™ºèƒ½è·¯ç”±ã€æœåŠ¡è°ƒç”¨ç­‰æ–¹æ–¹é¢é¢ã€‚</p><h5 id="Netflix-OSS-å¸¸ç”¨ç»„ä»¶ï¼ˆéƒ¨åˆ†è¿›å…¥ç»´æŠ¤æ¨¡å¼ï¼‰"><a href="#Netflix-OSS-å¸¸ç”¨ç»„ä»¶ï¼ˆéƒ¨åˆ†è¿›å…¥ç»´æŠ¤æ¨¡å¼ï¼‰" class="headerlink" title="Netflix OSS å¸¸ç”¨ç»„ä»¶ï¼ˆéƒ¨åˆ†è¿›å…¥ç»´æŠ¤æ¨¡å¼ï¼‰"></a><strong>Netflix OSS å¸¸ç”¨ç»„ä»¶ï¼ˆéƒ¨åˆ†è¿›å…¥ç»´æŠ¤æ¨¡å¼ï¼‰</strong></h5><ul><li><strong>æœåŠ¡æ³¨å†Œä¸å‘ç° (Service Discovery): Eureka</strong><ul><li><strong>ä½œç”¨</strong>: æä¾›ä¸€ä¸ªæœåŠ¡æ³¨å†Œä¸­å¿ƒã€‚æ¯ä¸ªå¾®æœåŠ¡å¯åŠ¨æ—¶ï¼Œå°†è‡ªå·±çš„ç½‘ç»œåœ°å€ç­‰ä¿¡æ¯â€œæ³¨å†Œâ€åˆ° Eureka Serverã€‚å…¶ä»–æœåŠ¡ï¼ˆæ¶ˆè´¹è€…ï¼‰åˆ™ä» Eureka Server â€œå‘ç°â€å¹¶æ‹‰å–æ‰€éœ€æœåŠ¡æä¾›è€…çš„åœ°å€åˆ—è¡¨ï¼Œä»è€Œå®ç°æœåŠ¡é—´çš„åŠ¨æ€å¯»å€å’Œè°ƒç”¨ã€‚</li><li><strong>ä½¿ç”¨</strong>: æœåŠ¡ç«¯æ·»åŠ  <code>spring-cloud-starter-netflix-eureka-server</code> ä¾èµ–ï¼Œå¹¶ä½¿ç”¨ <code>@EnableEurekaServer</code> æ³¨è§£ã€‚å®¢æˆ·ç«¯æ·»åŠ  <code>spring-cloud-starter-netflix-eureka-client</code> ä¾èµ–ï¼Œå¹¶é…ç½® Eureka Server åœ°å€ã€‚</li></ul></li><li><strong>æœåŠ¡è°ƒç”¨ä¸è´Ÿè½½å‡è¡¡ (RPC &amp; Load Balancing): OpenFeign + Ribbon</strong><ul><li><strong>ä½œç”¨</strong>: Feign è®©è¿œç¨‹æœåŠ¡è°ƒç”¨å˜å¾—åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·ç®€å•ã€‚å¼€å‘è€…åªéœ€å®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œå¹¶ä½¿ç”¨ <code>@FeignClient</code> æ³¨è§£ï¼Œå³å¯å®Œæˆå¯¹è¿œç¨‹æœåŠ¡çš„è°ƒç”¨ã€‚Ribbonï¼ˆç°å·²è¢« Spring Cloud LoadBalancer æ›¿ä»£ï¼‰åˆ™æä¾›äº†å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡èƒ½åŠ›ï¼Œå½“ä» Eureka è·å–åˆ°å¤šä¸ªæœåŠ¡å®ä¾‹åœ°å€æ—¶ï¼ŒRibbon ä¼šæ ¹æ®é…ç½®çš„ç­–ç•¥ï¼ˆå¦‚è½®è¯¢ã€éšæœºï¼‰é€‰æ‹©ä¸€ä¸ªå®ä¾‹è¿›è¡Œè°ƒç”¨ã€‚</li><li><strong>ä½¿ç”¨</strong>: æ·»åŠ  <code>spring-cloud-starter-openfeign</code> ä¾èµ–ï¼Œåœ¨å¯åŠ¨ç±»ä¸ŠåŠ  <code>@EnableFeignClients</code>ï¼Œåˆ›å»ºæ¥å£å¹¶ä½¿ç”¨ <code>@FeignClient(&quot;service-name&quot;)</code> æ³¨è§£ã€‚</li></ul></li><li><strong>ç†”æ–­ä¸é™çº§ (Circuit Breaker): Hystrix</strong><ul><li><strong>ä½œç”¨</strong>: å½“æŸä¸ªä¸‹æ¸¸æœåŠ¡å‡ºç°æ•…éšœæˆ–å“åº”ç¼“æ…¢æ—¶ï¼Œä¸ºäº†é˜²æ­¢æ•…éšœåœ¨ç³»ç»Ÿä¸­è”“å»¶ï¼ˆå³â€œæœåŠ¡é›ªå´©â€ï¼‰ï¼Œç†”æ–­å™¨ä¼šå¿«é€Ÿå¤±è´¥ï¼Œæš‚æ—¶åˆ‡æ–­å¯¹è¯¥æœåŠ¡çš„è°ƒç”¨ã€‚åŒæ—¶ï¼Œå¯ä»¥æ‰§è¡Œä¸€ä¸ªé¢„å®šä¹‰çš„é™çº§é€»è¾‘ï¼ˆFallbackï¼‰ï¼Œä¾‹å¦‚è¿”å›ä¸€ä¸ªç¼“å­˜çš„ã€é»˜è®¤çš„æˆ–å‹å¥½çš„æç¤ºä¿¡æ¯ã€‚</li><li><strong>çŠ¶æ€</strong>: Hystrix å·²è¿›å…¥ç»´æŠ¤æ¨¡å¼ï¼Œå®˜æ–¹æ¨èä½¿ç”¨ Resilience4j æˆ–å…¶ä»–æ›¿ä»£æ–¹æ¡ˆã€‚</li></ul></li><li><strong>API ç½‘å…³ (API Gateway): Zuul</strong><ul><li><strong>ä½œç”¨</strong>: ä½œä¸ºç³»ç»Ÿçš„ç»Ÿä¸€å…¥å£ï¼ŒAPI ç½‘å…³è´Ÿè´£è¯·æ±‚è·¯ç”±ã€åè®®è½¬æ¢ã€æƒé™æ ¡éªŒã€æµé‡æ§åˆ¶ã€æ—¥å¿—ç›‘æ§ç­‰ã€‚æ‰€æœ‰å¤–éƒ¨è¯·æ±‚éƒ½å…ˆç»è¿‡ç½‘å…³ï¼Œå†ç”±ç½‘å…³åˆ†å‘åˆ°åç«¯çš„å„ä¸ªå¾®æœåŠ¡ã€‚</li><li><strong>çŠ¶æ€</strong>: Zuul 1.x å·²è¿›å…¥ç»´æŠ¤æ¨¡å¼ï¼Œå®˜æ–¹æ¨èä½¿ç”¨ Spring Cloud Gatewayã€‚</li></ul></li></ul><hr><h5 id="Spring-Cloud-Alibaba-è¯¦è§£"><a href="#Spring-Cloud-Alibaba-è¯¦è§£" class="headerlink" title="Spring Cloud Alibaba è¯¦è§£"></a><strong>Spring Cloud Alibaba è¯¦è§£</strong></h5><p>Spring Cloud Alibaba è‡´åŠ›äºæä¾›å¾®æœåŠ¡å¼€å‘çš„ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆï¼Œæ˜¯ Spring Cloud ä½“ç³»çš„é‡è¦å®ç°ã€‚å®ƒé›†æˆäº†é˜¿é‡Œå·´å·´å¼€æºçš„ä¼˜ç§€ç»„ä»¶ï¼Œä¸ºå¼€å‘è€…æä¾›äº†æ›´ç¬¦åˆå›½å†…æŠ€æœ¯ç”Ÿæ€çš„é€‰æ‹©ã€‚</p><ul><li><strong>æœåŠ¡æ³¨å†Œä¸å‘ç° &amp; åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒ: Nacos</strong><ul><li><strong>ä½œç”¨</strong>: Nacos (Naming and Configuration Service) æ˜¯ä¸€ä¸ªåŠŸèƒ½ä¸°å¯Œçš„å¹³å°ï¼Œå®Œç¾æ•´åˆäº†<strong>æœåŠ¡æ³¨å†Œå‘ç°</strong>å’Œ<strong>é…ç½®ç®¡ç†</strong>ä¸¤å¤§æ ¸å¿ƒåŠŸèƒ½ã€‚<ul><li><strong>æœåŠ¡å‘ç°</strong>: ä¸ Eureka ç±»ä¼¼ï¼Œæä¾›æœåŠ¡æ³¨å†Œã€å‘ç°å’Œå¥åº·æ£€æŸ¥ã€‚ä½† Nacos æ”¯æŒåŸºäº DNS å’Œ RPC çš„æœåŠ¡å‘ç°ï¼Œå¹¶æä¾›æ›´å®æ—¶çš„å¥åº·æ£€æŸ¥æœºåˆ¶ã€‚</li><li><strong>é…ç½®ç®¡ç†</strong>: å¯ä»¥ä½œä¸ºåˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒï¼Œå¯¹æ‰€æœ‰å¾®æœåŠ¡çš„é…ç½®è¿›è¡Œé›†ä¸­åŒ–ç®¡ç†ã€‚æ”¯æŒé…ç½®çš„çƒ­æ›´æ–°ï¼Œå³ä¿®æ”¹é…ç½®åæ— éœ€é‡å¯æœåŠ¡å³å¯ç”Ÿæ•ˆã€‚è¿˜æ”¯æŒé…ç½®çš„ç‰ˆæœ¬ç®¡ç†ã€ç°åº¦å‘å¸ƒç­‰é«˜çº§åŠŸèƒ½ã€‚</li></ul></li><li><strong>ä½¿ç”¨</strong>:<ol><li>å¼•å…¥ <code>spring-cloud-starter-alibaba-nacos-discovery</code> å’Œ <code>spring-cloud-starter-alibaba-nacos-config</code> ä¾èµ–ã€‚</li><li>åœ¨ <code>bootstrap.properties</code> (æˆ– <code>.yml</code>) æ–‡ä»¶ä¸­é…ç½® Nacos æœåŠ¡å™¨åœ°å€å’Œåº”ç”¨åã€‚</li><li>ä½¿ç”¨ <code>@Value</code> æˆ– <code>@ConfigurationProperties</code> æ³¨è§£å³å¯åŠ¨æ€è·å–å’Œåˆ·æ–°é…ç½®ã€‚</li></ol></li></ul></li><li><strong>ç†”æ–­ã€é™çº§ä¸æµé‡æ§åˆ¶: Sentinel</strong><ul><li><strong>ä½œç”¨</strong>: Sentinel æ˜¯é¢å‘åˆ†å¸ƒå¼æœåŠ¡æ¶æ„çš„â€œæµé‡çš„å®ˆæŠ¤è€…â€ï¼Œä»¥æµé‡ä¸ºåˆ‡å…¥ç‚¹ï¼Œä»<strong>æµé‡æ§åˆ¶ã€ç†”æ–­é™çº§ã€ç³»ç»Ÿè´Ÿè½½ä¿æŠ¤</strong>ç­‰å¤šä¸ªç»´åº¦ä¿æŠ¤æœåŠ¡çš„ç¨³å®šæ€§ã€‚ç›¸è¾ƒäº Hystrixï¼ŒSentinel åŠŸèƒ½æ›´å¼ºå¤§ï¼Œæä¾›äº†å¯è§†åŒ–çš„ç›‘æ§å’Œé…ç½®å¹³å°ï¼Œå¹¶ä¸”æ”¯æŒçƒ­ç‚¹å‚æ•°é™æµç­‰ç²¾ç»†åŒ–æ§åˆ¶ã€‚</li><li><strong>æ ¸å¿ƒæ¦‚å¿µ</strong>:<ul><li><strong>èµ„æº (Resource)</strong>: Sentinel ä¸­ä¸€åˆ‡çš†èµ„æºï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªæ–¹æ³•ã€ä¸€æ®µä»£ç æˆ–ä¸€ä¸ªæœåŠ¡ URLã€‚</li><li><strong>è§„åˆ™ (Rule)</strong>: å®šä¹‰å¦‚ä½•ä¿æŠ¤èµ„æºï¼ŒåŒ…æ‹¬æµæ§è§„åˆ™ã€é™çº§è§„åˆ™ã€ç³»ç»Ÿä¿æŠ¤è§„åˆ™ç­‰ã€‚</li></ul></li><li><strong>ä½¿ç”¨</strong>:<ol><li>å¼•å…¥ <code>spring-cloud-starter-alibaba-sentinel</code> ä¾èµ–ã€‚</li><li>é…ç½® Sentinel æ§åˆ¶å°åœ°å€ã€‚</li><li>é€šè¿‡ <code>@SentinelResource</code> æ³¨è§£æ¥å®šä¹‰èµ„æºï¼Œå¹¶æŒ‡å®š Fallback (é™çº§é€»è¾‘) å’Œ BlockHandler (æµæ§&#x2F;ç†”æ–­é€»è¾‘)ã€‚</li></ol></li></ul></li><li><strong>åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ: Seata</strong><ul><li><strong>ä½œç”¨</strong>: Seata æ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼Œæä¾›äº†é«˜æ€§èƒ½ä¸”æ˜“äºä½¿ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡æœåŠ¡ã€‚å®ƒæ”¯æŒå¤šç§äº‹åŠ¡æ¨¡å¼ï¼ŒåŒ…æ‹¬ ATï¼ˆè‡ªåŠ¨è¡¥å¿ï¼‰ã€TCCã€Saga å’Œ XA æ¨¡å¼ï¼Œæ—¨åœ¨è§£å†³å¾®æœåŠ¡æ¶æ„ä¸‹çš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚</li><li><strong>ä½¿ç”¨</strong>: å¼•å…¥ <code>spring-cloud-starter-alibaba-seata</code> ä¾èµ–ï¼Œé…ç½® Seata Server åœ°å€ï¼Œå¹¶ä½¿ç”¨ <code>@GlobalTransactional</code> æ³¨è§£å¼€å¯å…¨å±€äº‹åŠ¡ã€‚</li></ul></li></ul><hr><h4 id="2-åˆ†å¸ƒå¼IDï¼šé›ªèŠ±ç®—æ³•ï¼ˆSnowflakeï¼‰"><a href="#2-åˆ†å¸ƒå¼IDï¼šé›ªèŠ±ç®—æ³•ï¼ˆSnowflakeï¼‰" class="headerlink" title="2. åˆ†å¸ƒå¼IDï¼šé›ªèŠ±ç®—æ³•ï¼ˆSnowflakeï¼‰"></a><strong>2. åˆ†å¸ƒå¼IDï¼šé›ªèŠ±ç®—æ³•ï¼ˆSnowflakeï¼‰</strong></h4><h5 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a><strong>åŸç†</strong></h5><p>Snowflake æ˜¯ Twitter å¼€æºçš„ä¸€ç§åˆ†å¸ƒå¼ ID ç”Ÿæˆç®—æ³•ï¼Œå®ƒèƒ½ç”Ÿæˆä¸€ä¸ª 64 ä½çš„ <code>long</code> å‹æ•°å­—ä½œä¸ºå…¨å±€å”¯ä¸€ IDã€‚è¿™ä¸ª 64 ä½çš„ ID ç”±å››éƒ¨åˆ†æ„æˆï¼š</p><ul><li><strong>1ä½ç¬¦å·ä½</strong>: æœ€é«˜ä½ï¼Œå›ºå®šä¸º0ï¼Œè¡¨ç¤ºæ­£æ•°ï¼Œæ— å®é™…æ„ä¹‰ã€‚</li><li><strong>41ä½æ—¶é—´æˆ³ (Timestamp)</strong>: ç²¾ç¡®åˆ°æ¯«ç§’çº§ï¼Œæ˜¯ <code>(å½“å‰æ—¶é—´æˆ³ - èµ·å§‹æ—¶é—´æˆ³)</code> çš„å·®å€¼ã€‚41ä½å¯ä»¥è¡¨ç¤º (241âˆ’1) æ¯«ç§’ï¼Œå¤§çº¦å¯ä»¥ä½¿ç”¨ 69 å¹´ã€‚</li><li><strong>10ä½å·¥ä½œæœºå™¨ID (Worker ID)</strong>: è¿™ 10 ä½å¯ä»¥è¢«çµæ´»åˆ’åˆ†ï¼Œä¾‹å¦‚å‰ 5 ä½ä»£è¡¨æ•°æ®ä¸­å¿ƒ ID (Datacenter ID)ï¼Œå 5 ä½ä»£è¡¨æœºå™¨ ID (Machine ID)ã€‚è¿™æ ·æ€»å…±å¯ä»¥æ”¯æŒ 210&#x3D;1024 å°æœºå™¨ã€‚</li><li><strong>12ä½åºåˆ—å· (Sequence)</strong>: è¡¨ç¤ºåœ¨åŒä¸€æ¯«ç§’å†…ï¼ŒåŒä¸€å°æœºå™¨ä¸Šç”Ÿæˆçš„ ID åºåˆ—å·ã€‚12ä½æ„å‘³ç€æ¯å°æœºå™¨æ¯æ¯«ç§’å¯ä»¥ç”Ÿæˆ 212&#x3D;4096 ä¸ªä¸åŒçš„ IDã€‚</li></ul><h5 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a><strong>ä¼˜ç‚¹</strong></h5><ul><li><strong>å…¨å±€å”¯ä¸€</strong>: é€šè¿‡æ—¶é—´æˆ³ã€æœºå™¨ ID å’Œåºåˆ—å·çš„ç»„åˆï¼Œå¯ä»¥ä¿è¯åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„ ID å”¯ä¸€æ€§ã€‚</li><li><strong>è¶‹åŠ¿é€’å¢</strong>: ç”±äºæ—¶é—´æˆ³åœ¨é«˜ä½ï¼Œæ‰€ä»¥ç”Ÿæˆçš„ ID æ•´ä½“ä¸Šæ˜¯æŒ‰æ—¶é—´è¶‹åŠ¿é€’å¢çš„ï¼Œè¿™å¯¹äºæ•°æ®åº“ç´¢å¼•ï¼ˆç‰¹åˆ«æ˜¯ B+æ ‘ï¼‰éå¸¸å‹å¥½ï¼Œå¯ä»¥å‡å°‘é¡µåˆ†è£‚ï¼Œæé«˜æ’å…¥æ€§èƒ½ã€‚</li><li><strong>é«˜æ€§èƒ½</strong>: ID åœ¨æœ¬åœ°ç”Ÿæˆï¼Œä¸ä¾èµ–ä»»ä½•å¤–éƒ¨æœåŠ¡ï¼ˆå¦‚æ•°æ®åº“æˆ– Redisï¼‰ï¼Œç”Ÿæˆæ•ˆç‡æé«˜ã€‚</li><li><strong>é«˜å¯ç”¨</strong>: ç®—æ³•æœ¬èº«ä¸ä¾èµ–ç½‘ç»œï¼Œéƒ¨ç½²ç®€å•ï¼Œå…·æœ‰å¾ˆé«˜çš„å¯ç”¨æ€§ã€‚</li></ul><h5 id="é¢è¯•é¢˜ï¼šâ€œé›ªèŠ±ç®—æ³•æœ‰æ—¶é’Ÿå›æ‹¨é—®é¢˜ï¼Œå¦‚ä½•è§£å†³ï¼Ÿâ€"><a href="#é¢è¯•é¢˜ï¼šâ€œé›ªèŠ±ç®—æ³•æœ‰æ—¶é’Ÿå›æ‹¨é—®é¢˜ï¼Œå¦‚ä½•è§£å†³ï¼Ÿâ€" class="headerlink" title="é¢è¯•é¢˜ï¼šâ€œé›ªèŠ±ç®—æ³•æœ‰æ—¶é’Ÿå›æ‹¨é—®é¢˜ï¼Œå¦‚ä½•è§£å†³ï¼Ÿâ€"></a><strong>é¢è¯•é¢˜ï¼šâ€œé›ªèŠ±ç®—æ³•æœ‰æ—¶é’Ÿå›æ‹¨é—®é¢˜ï¼Œå¦‚ä½•è§£å†³ï¼Ÿâ€</strong></h5><p>å›ç­”è¦ç‚¹:</p><p>æ—¶é’Ÿå›æ‹¨æ˜¯æŒ‡æœåŠ¡å™¨æ—¶é—´è¢«åŒæ­¥åˆ°ä¸€ä¸ªè¿‡å»çš„æ—¶é—´ç‚¹ã€‚å¦‚æœç®—æ³•ä¸åšå¤„ç†ï¼Œå¯èƒ½ä¼šç”Ÿæˆé‡å¤çš„ IDã€‚è§£å†³æ–¹æ¡ˆé€šå¸¸æ˜¯ï¼šåœ¨ç”Ÿæˆ ID æ—¶ï¼Œè®°å½•ä¸Šä¸€æ¬¡ç”Ÿæˆ ID æ—¶æ‰€ä½¿ç”¨çš„æ—¶é—´æˆ³ã€‚å½“å‘ç°å½“å‰æ—¶é—´æˆ³å°äºä¸Šæ¬¡è®°å½•çš„æ—¶é—´æˆ³æ—¶ï¼Œå°±æ„å‘³ç€å‘ç”Ÿäº†æ—¶é’Ÿå›æ‹¨ã€‚</p><ul><li><strong>æ–¹æ¡ˆä¸€ï¼ˆæ‹’ç»æœåŠ¡ï¼‰</strong>: ç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œæ‹’ç»ç”Ÿæˆ IDï¼Œç­‰å¾…æ—¶é’Ÿæ¢å¤æ­£å¸¸ã€‚è¿™ç§æ–¹æ¡ˆç®€å•ï¼Œä½†ä¼šæš‚æ—¶å½±å“å¯ç”¨æ€§ï¼Œé€‚åˆå¯¹ ID è¿ç»­æ€§è¦æ±‚ä¸é«˜çš„åœºæ™¯ã€‚</li><li><strong>æ–¹æ¡ˆäºŒï¼ˆç­‰å¾…è¿½èµ¶ï¼‰</strong>: å¦‚æœå›æ‹¨å¹…åº¦å¾ˆå°ï¼ˆæ¯”å¦‚å‡ æ¯«ç§’ï¼‰ï¼Œç¨‹åºå¯ä»¥ <code>while(currentTime &lt; lastTimestamp)</code> è¿™æ ·è‡ªæ—‹ç­‰å¾…ï¼Œç›´åˆ°å½“å‰æ—¶é—´è¿½èµ¶ä¸Šä¸Šæ¬¡çš„æ—¶é—´æˆ³ã€‚è¿™ä¼šé€ æˆçŸ­æš‚çš„çº¿ç¨‹é˜»å¡ã€‚</li><li><strong>æ–¹æ¡ˆä¸‰ï¼ˆä½¿ç”¨å¤‡ç”¨ä½ï¼‰</strong>: ä¸€äº›æ”¹è¿›ç‰ˆçš„é›ªèŠ±ç®—æ³•ä¼šé¢„ç•™å‡ ä½ä½œä¸ºæ‰©å±•ä½ï¼Œå½“å‘ç”Ÿæ—¶é’Ÿå›æ‹¨æ—¶ï¼Œåœ¨è¿™å‡ ä½ä¸Šåšè‡ªå¢ï¼Œä»è€Œåœ¨çŸ­æ—¶é—´å›æ‹¨å†…ä»èƒ½ç”Ÿæˆä¸åŒçš„ IDã€‚ï¼ˆè¿™ç§æ–¹æ¡ˆå®ç°è¾ƒä¸ºå¤æ‚ï¼‰</li><li><strong>ä¸šç•Œå®è·µï¼ˆç¾å›¢ Leafï¼‰</strong>: åœ¨å‘ç”Ÿæ—¶é’Ÿå›æ‹¨æ—¶ï¼Œåˆ‡æ¢åˆ°å¦ä¸€ç§å¤‡ç”¨ ID ç”Ÿæˆç­–ç•¥ï¼ˆå¦‚å·æ®µæ¨¡å¼ï¼‰ï¼Œæˆ–è€…ç›´æ¥æŠ¥é”™ã€‚</li></ul><hr><h4 id="3-RBACï¼ˆåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼‰"><a href="#3-RBACï¼ˆåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼‰" class="headerlink" title="3. RBACï¼ˆåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼‰"></a><strong>3. RBACï¼ˆåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼‰</strong></h4><h5 id="åŸç†-1"><a href="#åŸç†-1" class="headerlink" title="åŸç†"></a><strong>åŸç†</strong></h5><p>RBAC (Role-Based Access Control) æ˜¯ä¸€ç§ä¸»æµä¸”çµæ´»çš„æƒé™ç®¡ç†æ¨¡å‹ã€‚å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯åœ¨ <strong>ç”¨æˆ· (User)</strong> å’Œ <strong>æƒé™ (Permission)</strong> ä¹‹é—´å¼•å…¥ä¸€ä¸ªä¸­é—´å±‚â€”â€”<strong>è§’è‰² (Role)</strong>ã€‚æƒé™ä¸å†ç›´æ¥æˆäºˆç”¨æˆ·ï¼Œè€Œæ˜¯æˆäºˆè§’è‰²ï¼›ç„¶åå°†è§’è‰²åˆ†é…ç»™ç”¨æˆ·ã€‚è¿™æ ·ï¼Œç”¨æˆ·ä¸æƒé™å®ç°äº†è§£è€¦ï¼Œå½“éœ€è¦ä¿®æ”¹å¤§é‡ç”¨æˆ·çš„æƒé™æ—¶ï¼Œåªéœ€ä¿®æ”¹ä»–ä»¬å…±åŒæ‹¥æœ‰çš„è§’è‰²çš„æƒé™å³å¯ï¼Œæå¤§åœ°ç®€åŒ–äº†æƒé™ç®¡ç†å’Œç»´æŠ¤ã€‚</p><h5 id="æ ¸å¿ƒä¸‰è¦ç´ "><a href="#æ ¸å¿ƒä¸‰è¦ç´ " class="headerlink" title="æ ¸å¿ƒä¸‰è¦ç´ "></a><strong>æ ¸å¿ƒä¸‰è¦ç´ </strong></h5><ul><li><strong>ç”¨æˆ· (User)</strong>: ç³»ç»Ÿæ“ä½œçš„ä¸»ä½“ã€‚</li><li><strong>è§’è‰² (Role)</strong>: æƒé™çš„é›†åˆï¼Œä»£è¡¨äº†ä¸€ç»„ç‰¹å®šçš„èŒè´£æˆ–èº«ä»½ï¼Œå¦‚â€œç®¡ç†å‘˜â€ã€â€œæ–‡ç« ç¼–è¾‘â€ã€â€œæ™®é€šä¼šå‘˜â€ã€‚</li><li><strong>æƒé™ (Permission)</strong>: å¯¹ç³»ç»Ÿä¸­ç‰¹å®šèµ„æºè¿›è¡Œç‰¹å®šæ“ä½œçš„è®¸å¯ã€‚é€šå¸¸ç”¨ä¸€ä¸ªå­—ç¬¦ä¸²è¡¨ç¤ºï¼Œå¦‚ <code>user:create</code>ã€<code>order:delete</code>ã€<code>article:publish</code>ã€‚</li></ul><h5 id="é¢è¯•é¢˜ï¼šâ€œè¯·è®¾è®¡ä¸€ä¸ª-RBAC-æƒé™ç®¡ç†ç³»ç»Ÿçš„æ•°æ®åº“è¡¨ç»“æ„ã€‚â€"><a href="#é¢è¯•é¢˜ï¼šâ€œè¯·è®¾è®¡ä¸€ä¸ª-RBAC-æƒé™ç®¡ç†ç³»ç»Ÿçš„æ•°æ®åº“è¡¨ç»“æ„ã€‚â€" class="headerlink" title="é¢è¯•é¢˜ï¼šâ€œè¯·è®¾è®¡ä¸€ä¸ª RBAC æƒé™ç®¡ç†ç³»ç»Ÿçš„æ•°æ®åº“è¡¨ç»“æ„ã€‚â€"></a><strong>é¢è¯•é¢˜ï¼šâ€œè¯·è®¾è®¡ä¸€ä¸ª RBAC æƒé™ç®¡ç†ç³»ç»Ÿçš„æ•°æ®åº“è¡¨ç»“æ„ã€‚â€</strong></h5><p>å›ç­”è¦ç‚¹:</p><p>ä¸€ä¸ªåŸºç¡€çš„ RBAC æ¨¡å‹è‡³å°‘éœ€è¦äº”å¼ è¡¨ï¼š</p><ul><li><strong>ç”¨æˆ·è¡¨ (t_user)</strong>: å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ã€‚<ul><li><code>user_id</code> (ä¸»é”®), <code>username</code>, <code>password</code>, â€¦</li></ul></li><li><strong>è§’è‰²è¡¨ (t_role)</strong>: å­˜å‚¨è§’è‰²ä¿¡æ¯ã€‚<ul><li><code>role_id</code> (ä¸»é”®), <code>role_name</code> (è§’è‰²å, å¦‚â€ç®¡ç†å‘˜â€), <code>role_key</code> (è§’è‰²æ ‡è¯†, å¦‚â€adminâ€), â€¦</li></ul></li><li><strong>æƒé™è¡¨ (t_permission)</strong>: å­˜å‚¨å…·ä½“çš„æƒé™ç‚¹ä¿¡æ¯ã€‚<ul><li><code>permission_id</code> (ä¸»é”®), <code>permission_name</code> (æƒé™åç§°, å¦‚â€œæ–°å¢ç”¨æˆ·â€), <code>permission_code</code> (æƒé™æ ‡è¯†, å¦‚ <code>user:add</code>), <code>parent_id</code> (ç”¨äºèœå•å±‚çº§), â€¦</li></ul></li><li><strong>ç”¨æˆ·-è§’è‰²å…³è”è¡¨ (t_user_role)</strong>: å­˜å‚¨ç”¨æˆ·å’Œè§’è‰²çš„å¤šå¯¹å¤šå…³ç³»ã€‚<ul><li><code>user_id</code> (å¤–é”®), <code>role_id</code> (å¤–é”®)ã€‚(ä¸»é”®æ˜¯ <code>user_id</code> å’Œ <code>role_id</code> çš„è”åˆä¸»é”®)</li></ul></li><li><strong>è§’è‰²-æƒé™å…³è”è¡¨ (t_role_permission)</strong>: å­˜å‚¨è§’è‰²å’Œæƒé™çš„å¤šå¯¹å¤šå…³ç³»ã€‚<ul><li><code>role_id</code> (å¤–é”®), <code>permission_id</code> (å¤–é”®)ã€‚(ä¸»é”®æ˜¯ <code>role_id</code> å’Œ <code>permission_id</code> çš„è”åˆä¸»é”®)</li></ul></li></ul><hr><h4 id="4-Redis-è¿›é˜¶è¯¦è§£"><a href="#4-Redis-è¿›é˜¶è¯¦è§£" class="headerlink" title="4. Redis è¿›é˜¶è¯¦è§£"></a><strong>4. Redis è¿›é˜¶è¯¦è§£</strong></h4><h5 id="æ ¸å¿ƒç‰¹ç‚¹"><a href="#æ ¸å¿ƒç‰¹ç‚¹" class="headerlink" title="æ ¸å¿ƒç‰¹ç‚¹"></a><strong>æ ¸å¿ƒç‰¹ç‚¹</strong></h5><ul><li><strong>åŸºäºå†…å­˜</strong>: Redis æ˜¯ä¸€ä¸ªå†…å­˜æ•°æ®ç»“æ„å­˜å‚¨ç³»ç»Ÿï¼Œæ‰€æœ‰æ•°æ®éƒ½å­˜æ”¾åœ¨å†…å­˜ä¸­ï¼Œå› æ­¤è¯»å†™é€Ÿåº¦æå¿«ã€‚</li><li><strong>å•çº¿ç¨‹æ¨¡å‹</strong>: Redis çš„æ ¸å¿ƒç½‘ç»œæ¨¡å‹å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚æ˜¯å•çº¿ç¨‹çš„ã€‚è¿™é¿å…äº†å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œé”ç«äº‰å¸¦æ¥çš„å¼€é”€ã€‚ï¼ˆæ³¨æ„ï¼šRedis 6.0 ä¹‹åå¼•å…¥äº†å¤šçº¿ç¨‹æ¥å¤„ç† I&#x2F;Oï¼Œä½†æ‰§è¡Œå‘½ä»¤çš„æ ¸å¿ƒä»ç„¶æ˜¯å•çº¿ç¨‹ï¼‰ã€‚</li><li><strong>IOå¤šè·¯å¤ç”¨</strong>: å•çº¿ç¨‹èƒ½å®ç°é«˜æ€§èƒ½çš„å…³é”®åœ¨äºå®ƒä½¿ç”¨äº† IO å¤šè·¯å¤ç”¨æŠ€æœ¯ï¼ˆå¦‚ Linux ä¸‹çš„ epollï¼‰ã€‚è¯¥æŠ€æœ¯å…è®¸å•ä¸ªçº¿ç¨‹åŒæ—¶ç›‘å¬å¤šä¸ªç½‘ç»œè¿æ¥ä¸Šçš„ IO äº‹ä»¶ï¼Œå½“æŸä¸ªè¿æ¥å‡†å¤‡å¥½è¯»æˆ–å†™æ—¶ï¼Œæ‰å»å¤„ç†å®ƒï¼Œæå¤§åœ°æé«˜äº†å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚</li><li><strong>ä¸°å¯Œçš„æ•°æ®ç±»å‹</strong>: æ”¯æŒ String, Hash, List, Set, Sorted Set, Bitmap, HyperLogLog, GEO ç­‰å¤šç§æ•°æ®ç»“æ„ã€‚</li></ul><h5 id="ç¼“å­˜ä¸‰å¤§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ"><a href="#ç¼“å­˜ä¸‰å¤§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ" class="headerlink" title="ç¼“å­˜ä¸‰å¤§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ"></a><strong>ç¼“å­˜ä¸‰å¤§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</strong></h5><ul><li><strong>ç¼“å­˜ç©¿é€</strong>:<ul><li><strong>é—®é¢˜</strong>: å®¢æˆ·ç«¯æŸ¥è¯¢ä¸€ä¸ªæ•°æ®åº“å’Œç¼“å­˜ä¸­<strong>éƒ½</strong>ä¸å­˜åœ¨çš„æ•°æ®ã€‚è¿™å¯¼è‡´æ¯æ¬¡è¯·æ±‚éƒ½ä¼šç»•è¿‡ç¼“å­˜ï¼Œç›´æ¥æ‰“åˆ°æ•°æ®åº“ä¸Šï¼Œå½“æœ‰å¤§é‡æ­¤ç±»è¯·æ±‚æ—¶ï¼Œä¼šç»™æ•°æ®åº“å¸¦æ¥å·¨å¤§å‹åŠ›ã€‚</li><li><strong>è§£å†³</strong>:<ol><li><strong>ç¼“å­˜ç©ºå¯¹è±¡</strong>: å½“ä»æ•°æ®åº“æŸ¥è¯¢ä¸åˆ°æ•°æ®æ—¶ï¼Œä¹Ÿåœ¨ç¼“å­˜ä¸­å­˜å…¥ä¸€ä¸ªç‰¹æ®Šçš„ç©ºå€¼ï¼ˆå¦‚ <code>null</code> æˆ–ç‰¹å®šå­—ç¬¦ä¸²ï¼‰ï¼Œå¹¶è®¾ç½®ä¸€ä¸ªè¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´ã€‚</li><li><strong>å¸ƒéš†è¿‡æ»¤å™¨ (Bloom Filter)</strong>: åœ¨è®¿é—®ç¼“å­˜ä¹‹å‰ï¼Œå…ˆé€šè¿‡å¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­ key æ˜¯å¦<strong>å¯èƒ½</strong>å­˜åœ¨ã€‚å¸ƒéš†è¿‡æ»¤å™¨å¯ä»¥é«˜æ•ˆåœ°åˆ¤æ–­ä¸€ä¸ªå…ƒç´ <strong>ä¸€å®šä¸å­˜åœ¨</strong>ï¼Œä»è€Œåœ¨ç¬¬ä¸€å±‚å°±æ‹¦æˆªæ‰å¤§é‡æ— æ•ˆè¯·æ±‚ã€‚</li></ol></li></ul></li><li><strong>ç¼“å­˜å‡»ç©¿</strong>:<ul><li><strong>é—®é¢˜</strong>: æŸä¸ª<strong>çƒ­ç‚¹ Key</strong> åœ¨æŸä¸€æ—¶åˆ»çªç„¶å¤±æ•ˆï¼Œè€Œæ­¤æ—¶æ°å¥½æœ‰å¤§é‡çš„å¹¶å‘è¯·æ±‚è®¿é—®è¿™ä¸ª Keyï¼Œè¿™äº›è¯·æ±‚ä¼šåŒæ—¶ç©¿é€ç¼“å­˜ï¼Œç›´æ¥æ‰“åˆ°æ•°æ®åº“ä¸Šï¼Œå¯èƒ½å¯¼è‡´æ•°æ®åº“ç¬é—´å´©æºƒã€‚</li><li><strong>è§£å†³</strong>:<ol><li><strong>è®¾ç½®çƒ­ç‚¹ Key æ°¸ä¸è¿‡æœŸ</strong>: å¯¹äºä¸€äº›è®¿é—®æå…¶é¢‘ç¹ä¸”æ•°æ®ç›¸å¯¹å›ºå®šçš„çƒ­ç‚¹æ•°æ®ï¼Œå¯ä»¥è€ƒè™‘ä¸è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œé€šè¿‡åå°ä»»åŠ¡å®šæ—¶æ›´æ–°ã€‚</li><li><strong>ä½¿ç”¨åˆ†å¸ƒå¼é”</strong>: åœ¨æŸ¥è¯¢æ•°æ®åº“ä¹‹å‰ï¼Œå…ˆè·å–ä¸€ä¸ªè¯¥ Key å¯¹åº”çš„åˆ†å¸ƒå¼é”ã€‚åªæœ‰ç¬¬ä¸€ä¸ªè·å–åˆ°é”çš„çº¿ç¨‹æ‰èƒ½å»æŸ¥è¯¢æ•°æ®åº“å¹¶å›å†™ç¼“å­˜ï¼Œå…¶ä»–çº¿ç¨‹åˆ™ç­‰å¾…æˆ–ç›´æ¥è¿”å›ã€‚</li></ol></li></ul></li><li><strong>ç¼“å­˜é›ªå´©</strong>:<ul><li><strong>é—®é¢˜</strong>: å¤§é‡çš„ç¼“å­˜ Key åœ¨<strong>åŒä¸€æ—¶é—´é›†ä¸­å¤±æ•ˆ</strong>ï¼ˆä¾‹å¦‚ï¼Œåœ¨åº”ç”¨å¯åŠ¨æ—¶ç¼“å­˜äº†å¤§é‡æ•°æ®ï¼Œå¹¶è®¾ç½®äº†ç›¸åŒçš„è¿‡æœŸæ—¶é—´ï¼‰ï¼Œå¯¼è‡´æ‰€æœ‰è¯·æ±‚éƒ½ç¬é—´æ¶Œå‘æ•°æ®åº“ï¼Œé€ æˆæ•°æ®åº“å‹åŠ›å‰§å¢ç”šè‡³å®•æœºã€‚</li><li><strong>è§£å†³</strong>:<ol><li><strong>è¿‡æœŸæ—¶é—´åŠ éšæœºå€¼</strong>: åœ¨è®¾ç½®ç¼“å­˜çš„è¿‡æœŸæ—¶é—´æ—¶ï¼Œåœ¨ä¸€ä¸ªåŸºç¡€æ—¶é—´ä¸Šå¢åŠ ä¸€ä¸ªéšæœºæ•°ï¼Œä½¿å¾— Key çš„å¤±æ•ˆæ—¶é—´ç‚¹å°½å¯èƒ½åˆ†æ•£ã€‚</li><li><strong>å¤šçº§ç¼“å­˜</strong>: å»ºç«‹å¤šçº§ç¼“å­˜ä½“ç³»ï¼Œå¦‚ Nginx ç¼“å­˜ + Redis ç¼“å­˜ + JVM æœ¬åœ°ç¼“å­˜ï¼ˆCaffeine&#x2F;Guava Cacheï¼‰ã€‚</li><li><strong>ç†”æ–­é™çº§</strong>: ä½¿ç”¨ Hystrix æˆ– Sentinel ç­‰ç»„ä»¶ï¼Œå½“æ£€æµ‹åˆ°æ•°æ®åº“å‹åŠ›è¿‡å¤§æ—¶ï¼Œè¿›è¡Œç†”æ–­æˆ–é™çº§å¤„ç†ï¼Œæš‚æ—¶ä¸è®¿é—®æ•°æ®åº“ï¼Œè¿”å›ä¸€ä¸ªé»˜è®¤å€¼æˆ–æç¤ºä¿¡æ¯ã€‚</li></ol></li></ul></li></ul><hr><h4 id="5-æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼‰"><a href="#5-æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼‰" class="headerlink" title="5. æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼‰"></a><strong>5. æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼‰</strong></h4><h5 id="æ ¸å¿ƒä½œç”¨"><a href="#æ ¸å¿ƒä½œç”¨" class="headerlink" title="æ ¸å¿ƒä½œç”¨"></a><strong>æ ¸å¿ƒä½œç”¨</strong></h5><ul><li><strong>å¼‚æ­¥ (Asynchronous)</strong>: å°†è€—æ—¶çš„æ“ä½œï¼ˆå¦‚å‘é€é‚®ä»¶ã€ç”ŸæˆæŠ¥è¡¨ï¼‰ä½œä¸ºæ¶ˆæ¯æ”¾å…¥ MQï¼Œä¸»æµç¨‹å¯ä»¥ç«‹å³è¿”å›ï¼Œæ— éœ€ç­‰å¾…è¿™äº›æ“ä½œå®Œæˆï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„å“åº”é€Ÿåº¦å’Œååé‡ã€‚</li><li><strong>è§£è€¦ (Decoupling)</strong>: ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´é€šè¿‡ MQ è¿›è¡Œé€šä¿¡ï¼Œæ— éœ€ç›´æ¥ç›¸äº’ä¾èµ–ã€‚ä»»ä½•ä¸€æ–¹çš„ä¿®æ”¹ã€å®•æœºæˆ–å‡çº§éƒ½ä¸ä¼šå½±å“åˆ°å¦ä¸€æ–¹ï¼Œå¢å¼ºäº†ç³»ç»Ÿçš„çµæ´»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</li><li><strong>å‰Šå³° (Peak Shaving)</strong>: åœ¨ç§’æ€ã€å¤§ä¿ƒç­‰é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œå°†ç¬æ—¶æ¶Œå…¥çš„å¤§é‡è¯·æ±‚æš‚å­˜åœ¨ MQ ä¸­ï¼Œä¸‹æ¸¸çš„æ¶ˆè´¹è€…ç³»ç»Ÿå¯ä»¥æŒ‰ç…§è‡ªå·±çš„å¤„ç†èƒ½åŠ›ï¼Œå¹³ç¨³åœ°ä» MQ ä¸­æ‹‰å–å¹¶å¤„ç†è¯·æ±‚ï¼Œé¿å…äº†æµé‡æ´ªå³°ç›´æ¥å†²å®ä¸‹æ¸¸æœåŠ¡ã€‚</li></ul><h5 id="é¢è¯•é¢˜ï¼šâ€œè¯·åˆ—ä¸¾ä½ ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—æ—¶å¯èƒ½é‡åˆ°çš„é—®é¢˜ï¼Œå¹¶ç»™å‡ºè§£å†³æ–¹æ¡ˆã€‚â€"><a href="#é¢è¯•é¢˜ï¼šâ€œè¯·åˆ—ä¸¾ä½ ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—æ—¶å¯èƒ½é‡åˆ°çš„é—®é¢˜ï¼Œå¹¶ç»™å‡ºè§£å†³æ–¹æ¡ˆã€‚â€" class="headerlink" title="é¢è¯•é¢˜ï¼šâ€œè¯·åˆ—ä¸¾ä½ ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—æ—¶å¯èƒ½é‡åˆ°çš„é—®é¢˜ï¼Œå¹¶ç»™å‡ºè§£å†³æ–¹æ¡ˆã€‚â€"></a><strong>é¢è¯•é¢˜ï¼šâ€œè¯·åˆ—ä¸¾ä½ ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—æ—¶å¯èƒ½é‡åˆ°çš„é—®é¢˜ï¼Œå¹¶ç»™å‡ºè§£å†³æ–¹æ¡ˆã€‚â€</strong></h5><p><strong>å›ç­”è¦ç‚¹</strong>:</p><ul><li><strong>æ¶ˆæ¯ä¸¢å¤± (Message Loss)</strong>:<ul><li><strong>é—®é¢˜</strong>: æ¶ˆæ¯ä»ç”Ÿäº§è€…å‘å‡ºåï¼Œç”±äºç½‘ç»œæˆ– MQ æœåŠ¡æ•…éšœï¼Œæœªèƒ½æˆåŠŸåˆ°è¾¾æ¶ˆè´¹è€…ã€‚</li><li><strong>è§£å†³</strong>:<ol><li><strong>ç”Ÿäº§è€…ç«¯</strong>: å¼€å¯ç”Ÿäº§è€…çš„ <code>confirm</code> æˆ– <code>ack</code> æœºåˆ¶ï¼Œç¡®ä¿æ¶ˆæ¯è¢« MQ æˆåŠŸæ¥æ”¶ã€‚å¦‚æœå‘é€å¤±è´¥ï¼Œå¯ä»¥è¿›è¡Œé‡è¯•ã€‚</li><li><strong>MQ æœåŠ¡ç«¯</strong>: å¯¹æ¶ˆæ¯è¿›è¡ŒæŒä¹…åŒ–ï¼Œé˜²æ­¢ MQ å®•æœºå¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ï¼ˆå¦‚ RabbitMQ çš„æŒä¹…åŒ–é˜Ÿåˆ—å’Œæ¶ˆæ¯ï¼ŒKafka çš„ç£ç›˜å­˜å‚¨ï¼‰ã€‚</li><li><strong>æ¶ˆè´¹è€…ç«¯</strong>: æ¶ˆè´¹è€…åœ¨å¤„ç†å®Œä¸šåŠ¡é€»è¾‘åï¼Œå†å‘ MQ å‘é€ç¡®è®¤åº”ç­”ï¼ˆ<code>ack</code>ï¼‰ã€‚å¦‚æœå¤„ç†è¿‡ç¨‹ä¸­æ¶ˆè´¹è€…å®•æœºï¼ŒMQ æ²¡æœ‰æ”¶åˆ° <code>ack</code>ï¼Œä¼šå°†è¯¥æ¶ˆæ¯é‡æ–°æŠ•é€’ç»™å…¶ä»–æ¶ˆè´¹è€…ã€‚</li></ol></li></ul></li><li><strong>é‡å¤æ¶ˆè´¹ (Duplicate Consumption)</strong>:<ul><li><strong>é—®é¢˜</strong>: ç”±äºç½‘ç»œæŠ–åŠ¨ã€æ¶ˆè´¹è€… <code>ack</code> è¶…æ—¶ç­‰åŸå› ï¼ŒMQ å¯èƒ½ä¼šé‡å¤æŠ•é€’åŒä¸€æ¡æ¶ˆæ¯ã€‚</li><li><strong>è§£å†³</strong>: æ ¸å¿ƒæ˜¯ä¿è¯æ¶ˆè´¹é€»è¾‘çš„<strong>å¹‚ç­‰æ€§ (Idempotence)</strong>ã€‚å³å¤šæ¬¡æ‰§è¡ŒåŒä¸€ä¸ªæ“ä½œï¼Œç»“æœéƒ½æ˜¯ç›¸åŒçš„ã€‚å®ç°æ–¹å¼æœ‰ï¼š<ol><li>åœ¨æ•°æ®åº“ä¸­ä¸ºä¸šåŠ¡æ“ä½œåˆ›å»ºä¸€ä¸ª<strong>å”¯ä¸€é”®</strong>ï¼Œæ¯æ¬¡æ“ä½œå‰å…ˆæ£€æŸ¥è¯¥å”¯ä¸€é”®æ˜¯å¦å­˜åœ¨ã€‚</li><li>ä½¿ç”¨ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„<strong>ä¸šåŠ¡ ID</strong>ï¼ˆå¦‚è®¢å•å·ï¼‰ï¼Œåœ¨å¤„ç†æ¶ˆæ¯å‰ï¼Œå…ˆæŸ¥è¯¢è¿™ä¸ª ID æ˜¯å¦å·²ç»è¢«å¤„ç†è¿‡ï¼ˆä¾‹å¦‚ï¼Œå­˜å…¥ Redis Set æˆ–æ•°æ®åº“ï¼‰ã€‚</li></ol></li></ul></li><li><strong>æ¶ˆæ¯å †ç§¯ (Message Backlog)</strong>:<ul><li><strong>é—®é¢˜</strong>: ç”Ÿäº§è€…çš„ç”Ÿäº§é€Ÿåº¦è¿œå¤§äºæ¶ˆè´¹è€…çš„æ¶ˆè´¹é€Ÿåº¦ï¼Œå¯¼è‡´å¤§é‡æ¶ˆæ¯åœ¨ MQ ä¸­ç§¯å‹ï¼Œå ç”¨èµ„æºå¹¶å¯èƒ½å¯¼è‡´æ¶ˆæ¯è¶…æ—¶ä¸¢å¤±ã€‚</li><li><strong>è§£å†³</strong>:<ol><li><strong>æ°´å¹³æ‰©å±•æ¶ˆè´¹è€…</strong>: å¢åŠ æ¶ˆè´¹è€…å®ä¾‹çš„æ•°é‡ï¼Œå¹¶è¡Œå¤„ç†æ¶ˆæ¯ã€‚è¿™æ˜¯æœ€å¸¸ç”¨çš„æ–¹æ³•ã€‚</li><li><strong>ä¼˜åŒ–æ¶ˆè´¹é€»è¾‘</strong>: æ£€æŸ¥æ¶ˆè´¹è€…ä»£ç ï¼Œçœ‹æ˜¯å¦æœ‰å¯ä»¥ä¼˜åŒ–çš„æ…¢æ“ä½œï¼ˆå¦‚ I&#x2F;O å¯†é›†å‹æ“ä½œï¼‰ã€‚</li><li><strong>æ¶ˆæ¯åˆ†ç‰‡&#x2F;åˆ†åŒº</strong>: å¯¹ Topic è¿›è¡Œåˆ†åŒºï¼ˆPartitioningï¼‰ï¼Œè®©ä¸åŒçš„æ¶ˆè´¹è€…ç»„å¤„ç†ä¸åŒçš„åˆ†åŒºï¼Œæé«˜å¹¶å‘åº¦ã€‚</li><li><strong>å¢åŠ é¢„è­¦ç›‘æ§</strong>: å¯¹æ¶ˆæ¯å †ç§¯æ•°é‡è®¾ç½®é˜ˆå€¼ï¼Œè¾¾åˆ°é˜ˆå€¼æ—¶åŠæ—¶å‘Šè­¦ï¼Œäººå·¥ä»‹å…¥ã€‚</li></ol></li></ul></li></ul><hr><h4 id="6-åˆ†å¸ƒå¼é”è¯¦è§£"><a href="#6-åˆ†å¸ƒå¼é”è¯¦è§£" class="headerlink" title="6. åˆ†å¸ƒå¼é”è¯¦è§£"></a><strong>6. åˆ†å¸ƒå¼é”è¯¦è§£</strong></h4><h5 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a><strong>ä½œç”¨</strong></h5><p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿç¯å¢ƒä¸‹ï¼Œå¤šä¸ªè¿›ç¨‹æˆ–æœåŠ¡å™¨ä¸Šçš„å¤šä¸ªçº¿ç¨‹éœ€è¦è®¿é—®åŒä¸€ä¸ªå…±äº«èµ„æºæ—¶ï¼Œä¸ºäº†ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§å’Œæ“ä½œçš„åŸå­æ€§ï¼Œéœ€è¦ä¸€ç§æœºåˆ¶æ¥ç¡®ä¿åœ¨åŒä¸€æ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯èƒ½å¤ŸæŒæœ‰é”å¹¶è®¿é—®è¯¥èµ„æºã€‚</p><h5 id="å®ç°æ–¹æ¡ˆå¯¹æ¯”"><a href="#å®ç°æ–¹æ¡ˆå¯¹æ¯”" class="headerlink" title="å®ç°æ–¹æ¡ˆå¯¹æ¯”"></a><strong>å®ç°æ–¹æ¡ˆå¯¹æ¯”</strong></h5><table><thead><tr><th>å®ç°æ–¹å¼</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>åŸºäºæ•°æ®åº“</strong></td><td>å®ç°ç®€å•ï¼Œç›´æ¥åˆ©ç”¨æ•°æ®åº“ï¼ˆå¦‚å”¯ä¸€ç´¢å¼•ã€æ‚²è§‚é” <code>for update</code>ï¼‰ã€‚</td><td>æ€§èƒ½å¼€é”€å¤§ï¼Œæœ‰é”åº“é”è¡¨çš„é£é™©ï¼Œä¸å¯é‡å…¥ï¼Œä¸æ˜¯é˜»å¡é”ï¼Œæ•°æ®åº“å•ç‚¹æ•…éšœé—®é¢˜ã€‚</td><td>å¹¶å‘åº¦ä¸é«˜çš„ç®€å•åœºæ™¯ã€‚</td></tr><tr><td><strong>åŸºäº ZooKeeper</strong></td><td>å¯é æ€§é«˜ï¼Œå¤©ç„¶æ”¯æŒé˜»å¡é”å’Œå¯é‡å…¥ï¼Œè§£å†³æ­»é”é—®é¢˜ï¼ˆä¸´æ—¶èŠ‚ç‚¹ï¼‰ï¼Œæ— é”è¿‡æœŸé—®é¢˜ï¼Œæ”¯æŒå…¬å¹³é”ã€‚</td><td>æ€§èƒ½ä¸å¦‚ Redisï¼Œå®ç°å¤æ‚ï¼Œä¾èµ– ZK é›†ç¾¤ã€‚</td><td>å¯¹å¯é æ€§è¦æ±‚æé«˜ï¼Œä¸”èƒ½å®¹å¿ä¸€å®šæ€§èƒ½æŸè€—çš„åœºæ™¯ï¼Œå¦‚åˆ†å¸ƒå¼åè°ƒã€‚</td></tr><tr><td><strong>åŸºäº Redis</strong></td><td>æ€§èƒ½æé«˜ï¼Œå®ç°ç›¸å¯¹ç®€å•ï¼Œæœ‰æˆç†Ÿçš„æ¡†æ¶ (Redisson) å¯ç”¨ã€‚</td><td>å¯é æ€§ç›¸å¯¹ ZK ç¨å·®ï¼Œéœ€è¦å¤„ç†é”è¿‡æœŸå’Œä¸šåŠ¡æœªæ‰§è¡Œå®Œçš„é—®é¢˜ï¼Œéå…¬å¹³é”ã€‚</td><td>äº’è”ç½‘é«˜å¹¶å‘ã€å¯¹æ€§èƒ½è¦æ±‚é«˜çš„ç»å¤§å¤šæ•°åœºæ™¯ã€‚</td></tr></tbody></table><h5 id="åŸºäº-Redis-çš„å®ç°è¿›é˜¶"><a href="#åŸºäº-Redis-çš„å®ç°è¿›é˜¶" class="headerlink" title="åŸºäº Redis çš„å®ç°è¿›é˜¶"></a><strong>åŸºäº Redis çš„å®ç°è¿›é˜¶</strong></h5><ul><li><p>åŠ é”çš„æ­£ç¡®å§¿åŠ¿:</p><p>ä½¿ç”¨ SET key value NX EX time å‘½ä»¤ã€‚</p><ul><li><p><code>SET key value</code>: è®¾ç½®é”®å€¼ã€‚<code>value</code> é€šå¸¸æ˜¯ä¸€ä¸ªå”¯ä¸€çš„éšæœºå­—ç¬¦ä¸²ï¼ˆå¦‚ UUIDï¼‰ï¼Œç”¨äºæ ‡è¯†é”çš„æŒæœ‰è€…ã€‚</p></li><li><p><code>NX</code>: (if Not eXists)ï¼Œç¡®ä¿åªæœ‰åœ¨ key ä¸å­˜åœ¨æ—¶æ‰èƒ½è®¾ç½®æˆåŠŸï¼Œå®ç°äº†â€œåŠ é”â€çš„åŸå­æ€§ã€‚</p></li><li><p>EX time: è®¾ç½®ä¸€ä¸ªè‡ªåŠ¨è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰ï¼Œé˜²æ­¢å› å®¢æˆ·ç«¯å®•æœºè€Œå¯¼è‡´æ­»é”ã€‚</p><p>è¿™ä¸‰ä¸ªå‚æ•°å¿…é¡»åœ¨ä¸€ä¸ªå‘½ä»¤ä¸­æ‰§è¡Œï¼Œä¿è¯åŸå­æ€§ã€‚</p></li></ul></li><li><p><strong>è§£é”çš„æ­£ç¡®å§¿åŠ¿ï¼šLua è„šæœ¬</strong></p><ul><li><p><strong>ä¸ºä»€ä¹ˆéœ€è¦ Lua</strong>: è§£é”æ“ä½œåŒ…å«â€œåˆ¤æ–­â€å’Œâ€œåˆ é™¤â€ä¸¤æ­¥ï¼š1. <code>GET</code> é”çš„ <code>value</code>ï¼Œåˆ¤æ–­æ˜¯å¦ä¸è‡ªå·±åŠ é”æ—¶è®¾ç½®çš„éšæœºå­—ç¬¦ä¸²ç›¸ç­‰ã€‚2. å¦‚æœç›¸ç­‰ï¼Œåˆ™ <code>DEL</code> é”ã€‚å¦‚æœä¸ç”¨ Lua è„šæœ¬ï¼Œåœ¨æ‰§è¡Œå®Œç¬¬ä¸€æ­¥åï¼Œè‹¥è¯¥çº¿ç¨‹é˜»å¡ï¼Œæ­¤æ—¶é”æ°å¥½è¿‡æœŸï¼Œå¦ä¸€ä¸ªçº¿ç¨‹è·å–äº†é”ï¼Œé‚£ä¹ˆå½“åŸçº¿ç¨‹æ¢å¤æ‰§è¡Œç¬¬äºŒæ­¥æ—¶ï¼Œå°±ä¼š<strong>è¯¯åˆ æ‰æ–°çº¿ç¨‹çš„é”</strong>ã€‚</p></li><li><p><strong>Lua è„šæœ¬ç¤ºä¾‹</strong>:</p><p>Lua</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-- è„šæœ¬æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šKEYS[1] æ˜¯é”çš„ keyï¼ŒARGV[1] æ˜¯åŠ é”æ—¶è®¾ç½®çš„å”¯ä¸€å€¼</span><br><span class="line">if redis.call(&#x27;get&#x27;, KEYS[1]) == ARGV[1] then</span><br><span class="line">    return redis.call(&#x27;del&#x27;, KEYS[1])</span><br><span class="line">else</span><br><span class="line">    return 0</span><br><span class="line">end</span><br></pre></td></tr></table></figure></li></ul><p>Lua è„šæœ¬å¯ä»¥ç¡®ä¿å¤šä¸ªå‘½ä»¤åœ¨ Redis æœåŠ¡ç«¯è¢«åŸå­æ€§åœ°æ‰§è¡Œï¼Œæœç»äº†ä¸Šè¿°é—®é¢˜ã€‚</p></li><li><p><strong>Redis ä¹è§‚é”ï¼šWATCH å‘½ä»¤</strong></p><ul><li><p><strong>ä½œç”¨</strong>: <code>WATCH</code> å‘½ä»¤å¯ä»¥ç›‘è§†ä¸€ä¸ªæˆ–å¤šä¸ª keyï¼Œå¦‚æœåœ¨äº‹åŠ¡ <code>EXEC</code> æ‰§è¡Œä¹‹å‰ï¼Œä»»ä½•ä¸€ä¸ªè¢«ç›‘è§†çš„ key è¢«å…¶ä»–å‘½ä»¤ä¿®æ”¹äº†ï¼Œé‚£ä¹ˆæ•´ä¸ªäº‹åŠ¡å°†è¢«å–æ¶ˆï¼Œ<code>EXEC</code> è¿”å› <code>nil</code>ã€‚</p></li><li><p><strong>åŸç†</strong>: è¿™æ˜¯ä¸€ç§<strong>æ£€æŸ¥åè®¾ç½® (Check-And-Set, CAS)</strong> çš„å®ç°ã€‚å®ƒä¸æ˜¯çœŸæ­£çš„åŠ é”ï¼Œè€Œæ˜¯åœ¨æ›´æ–°æ•°æ®æ—¶æ£€æŸ¥æ•°æ®æ˜¯å¦è¢«ä¿®æ”¹è¿‡ã€‚</p></li><li><p><strong>ä½¿ç”¨åœºæ™¯</strong>: é€‚ç”¨äº<strong>è¯»å¤šå†™å°‘</strong>çš„å¹¶å‘åœºæ™¯ï¼Œå¯ä»¥å‡å°‘é”çš„å¼€é”€ã€‚ä¾‹å¦‚ï¼Œæ›´æ–°å•†å“åº“å­˜ã€‚</p><ol><li><p><code>WATCH stock_key</code> &#x2F;&#x2F; ç›‘è§†åº“å­˜</p></li><li><p><code>current_stock = GET stock_key</code> &#x2F;&#x2F; è·å–å½“å‰åº“å­˜</p></li><li><p>(åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­åˆ¤æ–­ <code>current_stock</code> æ˜¯å¦è¶³å¤Ÿ)</p></li><li><p><code>MULTI</code> &#x2F;&#x2F; å¼€å¯äº‹åŠ¡</p></li><li><p><code>SET stock_key new_stock</code> &#x2F;&#x2F; å‡†å¤‡æ›´æ–°åº“å­˜</p></li><li><p>EXEC &#x2F;&#x2F; æ‰§è¡Œäº‹åŠ¡</p><p>å¦‚æœä» WATCH åˆ° EXEC ä¹‹é—´ stock_key è¢«å…¶ä»–å®¢æˆ·ç«¯ä¿®æ”¹ï¼ŒEXEC å°†å¤±è´¥ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯éœ€è¦é‡è¯•æ•´ä¸ªæ“ä½œã€‚</p></li></ol></li></ul></li></ul><h5 id="é¢è¯•é¢˜ï¼šâ€œRedis-åˆ†å¸ƒå¼é”é”è¿‡æœŸäº†ä½†ä¸šåŠ¡æ²¡æ‰§è¡Œå®Œæ€ä¹ˆåŠï¼Ÿâ€"><a href="#é¢è¯•é¢˜ï¼šâ€œRedis-åˆ†å¸ƒå¼é”é”è¿‡æœŸäº†ä½†ä¸šåŠ¡æ²¡æ‰§è¡Œå®Œæ€ä¹ˆåŠï¼Ÿâ€" class="headerlink" title="é¢è¯•é¢˜ï¼šâ€œRedis åˆ†å¸ƒå¼é”é”è¿‡æœŸäº†ä½†ä¸šåŠ¡æ²¡æ‰§è¡Œå®Œæ€ä¹ˆåŠï¼Ÿâ€"></a><strong>é¢è¯•é¢˜ï¼šâ€œRedis åˆ†å¸ƒå¼é”é”è¿‡æœŸäº†ä½†ä¸šåŠ¡æ²¡æ‰§è¡Œå®Œæ€ä¹ˆåŠï¼Ÿâ€</strong></h5><p>å›ç­”è¦ç‚¹:</p><p>è¿™æ˜¯åˆ†å¸ƒå¼é”çš„ä¸€ä¸ªç»å…¸é—®é¢˜ï¼Œè¢«ç§°ä¸ºé”çš„è¶…æ—¶ç»­æœŸé—®é¢˜ã€‚</p><ul><li><strong>é—®é¢˜æ ¹æº</strong>: æˆ‘ä»¬ç»™é”è®¾ç½®äº†ä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼Œæ¯”å¦‚ 30 ç§’ï¼Œä½†ä¸šåŠ¡æ‰§è¡Œäº† 35 ç§’ã€‚åœ¨ç¬¬ 30 ç§’æ—¶é”ä¼šè‡ªåŠ¨é‡Šæ”¾ï¼Œå…¶ä»–çº¿ç¨‹å°±èƒ½è·å–åˆ°é”ï¼Œå¯¼è‡´å¹¶å‘é—®é¢˜ã€‚</li><li><strong>è§£å†³æ–¹æ¡ˆï¼šâ€œçœ‹é—¨ç‹—â€(Watchdog)æœºåˆ¶</strong>ã€‚<ul><li><strong>åŸç†</strong>: æ¯”å¦‚ Java ä¸­çš„ Redisson æ¡†æ¶å°±å†…ç½®äº†çœ‹é—¨ç‹—ã€‚å½“ä¸€ä¸ªçº¿ç¨‹è·å–é”æˆåŠŸåï¼ŒRedisson ä¼šå¯åŠ¨ä¸€ä¸ªåå°çº¿ç¨‹ï¼ˆçœ‹é—¨ç‹—ï¼‰ï¼Œå®šæœŸï¼ˆä¾‹å¦‚æ¯ 10 ç§’ï¼‰æ£€æŸ¥è¯¥çº¿ç¨‹æ˜¯å¦è¿˜æŒæœ‰é”ã€‚å¦‚æœæŒæœ‰ï¼Œå¹¶ä¸”ä¸šåŠ¡ä»åœ¨æ‰§è¡Œï¼Œçœ‹é—¨ç‹—å°±ä¼šè‡ªåŠ¨ä¸ºè¿™ä¸ªé”<strong>å»¶é•¿è¿‡æœŸæ—¶é—´</strong>ï¼ˆç»­æœŸï¼‰ï¼Œæ¯”å¦‚å†ç»­ 30 ç§’ã€‚è¿™ä¸ªè¿‡ç¨‹ä¼šä¸€ç›´æŒç»­ï¼Œç›´åˆ°ä¸šåŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œçº¿ç¨‹ä¸»åŠ¨é‡Šæ”¾é”ï¼Œçœ‹é—¨ç‹—æ‰ä¼šåœæ­¢ã€‚</li><li><strong>æ€»ç»“</strong>: çœ‹é—¨ç‹—æœºåˆ¶é€šè¿‡åå°çº¿ç¨‹è‡ªåŠ¨ç»­æœŸï¼Œç¡®ä¿äº†åœ¨ä¸šåŠ¡æ‰§è¡Œå®Œæˆä¹‹å‰ï¼Œé”ä¸ä¼šå› ä¸ºè¶…æ—¶è€Œæå‰é‡Šæ”¾ï¼Œä»è€Œä¿è¯äº†é”çš„å¯é æ€§ã€‚</li></ul></li></ul><hr><h4 id="7-åˆ†å¸ƒå¼äº‹åŠ¡è¯¦è§£"><a href="#7-åˆ†å¸ƒå¼äº‹åŠ¡è¯¦è§£" class="headerlink" title="7. åˆ†å¸ƒå¼äº‹åŠ¡è¯¦è§£"></a><strong>7. åˆ†å¸ƒå¼äº‹åŠ¡è¯¦è§£</strong></h4><h5 id="ä½œç”¨-1"><a href="#ä½œç”¨-1" class="headerlink" title="ä½œç”¨"></a><strong>ä½œç”¨</strong></h5><p>åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œä¸€ä¸ªä¸šåŠ¡æ“ä½œå¯èƒ½éœ€è¦è°ƒç”¨å¤šä¸ªç‹¬ç«‹çš„æœåŠ¡æ¥å…±åŒå®Œæˆï¼ˆä¾‹å¦‚ï¼Œç”µå•†ä¸‹å•æ“ä½œéœ€è¦è°ƒç”¨è®¢å•æœåŠ¡ã€åº“å­˜æœåŠ¡ã€ç§¯åˆ†æœåŠ¡ï¼‰ã€‚åˆ†å¸ƒå¼äº‹åŠ¡æ—¨åœ¨ä¿è¯è¿™äº›è·¨æœåŠ¡çš„æ•°æ®åº“æ“ä½œèƒ½å¤Ÿéµå¾ª ACID åŸåˆ™ï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å›æ»šï¼Œä»¥ç¡®ä¿æ•°æ®çš„<strong>æœ€ç»ˆä¸€è‡´æ€§</strong>ã€‚</p><h5 id="è§£å†³æ–¹æ¡ˆæ·±å…¥åˆ†æ"><a href="#è§£å†³æ–¹æ¡ˆæ·±å…¥åˆ†æ" class="headerlink" title="è§£å†³æ–¹æ¡ˆæ·±å…¥åˆ†æ"></a><strong>è§£å†³æ–¹æ¡ˆæ·±å…¥åˆ†æ</strong></h5><ul><li><strong>XA (2PC&#x2F;3PC)</strong>: ä¸¤é˜¶æ®µ&#x2F;ä¸‰é˜¶æ®µæäº¤åè®®ã€‚<ul><li><strong>è§’è‰²</strong>: äº‹åŠ¡ç®¡ç†å™¨ (Transaction Manager, TM) å’Œ èµ„æºç®¡ç†å™¨ (Resource Manager, RM)ã€‚</li><li><strong>æµç¨‹ (2PC)</strong>:<ol><li><strong>å‡†å¤‡é˜¶æ®µ (Prepare)</strong>: TM é€šçŸ¥æ‰€æœ‰ RM å‡†å¤‡æäº¤ï¼ŒRM æ‰§è¡Œæœ¬åœ°äº‹åŠ¡å¹¶é”å®šèµ„æºï¼Œä½†ä¸æäº¤ï¼Œç„¶åå‘ TM æŠ¥å‘Šå‡†å¤‡å°±ç»ªã€‚</li><li><strong>æäº¤&#x2F;å›æ»šé˜¶æ®µ (Commit&#x2F;Rollback)</strong>: å¦‚æœæ‰€æœ‰ RM éƒ½å‡†å¤‡å°±ç»ªï¼ŒTM é€šçŸ¥æ‰€æœ‰ RM æäº¤ï¼›å¦åˆ™ï¼Œé€šçŸ¥æ‰€æœ‰ RM å›æ»šã€‚</li></ol></li><li><strong>è¯„ä»·</strong>: æ˜¯ä¸€ç§<strong>å¼ºä¸€è‡´æ€§</strong>çš„æ–¹æ¡ˆï¼Œä½†åè®®å¤æ‚ï¼Œæ€§èƒ½å·®ï¼ŒåŒæ­¥é˜»å¡æ¨¡å‹ä¼šé•¿æ—¶é—´é”å®šèµ„æºï¼Œä¸”åè°ƒå™¨å­˜åœ¨å•ç‚¹æ•…éšœé£é™©ï¼Œåœ¨äº’è”ç½‘é«˜å¹¶å‘åœºæ™¯ä¸‹<strong>å¾ˆå°‘ä½¿ç”¨</strong>ã€‚</li></ul></li><li><strong>TCC (Try-Confirm-Cancel)</strong>: è¡¥å¿å‹äº‹åŠ¡ã€‚<ul><li><strong>æ ¸å¿ƒ</strong>: æ˜¯ä¸€ç§<strong>ä¸šåŠ¡å±‚é¢</strong>çš„æŸ”æ€§äº‹åŠ¡æ–¹æ¡ˆï¼Œå¯¹ä»£ç ä¾µå…¥æ€§å¼ºã€‚</li><li><strong>æµç¨‹</strong>:<ol><li><strong>Try</strong>: å¯¹ä¸šåŠ¡èµ„æºè¿›è¡Œ<strong>æ£€æŸ¥å’Œé¢„ç•™</strong>ã€‚ä¾‹å¦‚ï¼Œæ‰£å‡åº“å­˜æ“ä½œï¼ŒTry é˜¶æ®µæ˜¯å†»ç»“åº“å­˜ã€‚</li><li><strong>Confirm</strong>: å¦‚æœæ‰€æœ‰æœåŠ¡çš„ Try é˜¶æ®µéƒ½æˆåŠŸï¼Œåˆ™æ‰§è¡Œæ‰€æœ‰æœåŠ¡çš„ <strong>Confirm</strong> æ“ä½œï¼ŒçœŸæ­£å®Œæˆä¸šåŠ¡ã€‚ä¾‹å¦‚ï¼Œå°†å†»ç»“çš„åº“å­˜çœŸå®æ‰£å‡ã€‚</li><li><strong>Cancel</strong>: å¦‚æœä»»ä½•ä¸€ä¸ªæœåŠ¡çš„ Try é˜¶æ®µå¤±è´¥ï¼Œåˆ™æ‰§è¡Œæ‰€æœ‰å·²æˆåŠŸæœåŠ¡çš„ <strong>Cancel</strong> æ“ä½œï¼Œé‡Šæ”¾é¢„ç•™çš„èµ„æºã€‚ä¾‹å¦‚ï¼Œè§£å†»ä¹‹å‰è¢«å†»ç»“çš„åº“å­˜ã€‚</li></ol></li><li><strong>è¯„ä»·</strong>: æ€§èƒ½è¾ƒå¥½ï¼Œæ•°æ®ä¸€è‡´æ€§é«˜äºå¯é æ¶ˆæ¯æ–¹æ¡ˆã€‚ä½†å¼€å‘æˆæœ¬æé«˜ï¼Œéœ€è¦ä¸ºæ¯ä¸ªæ“ä½œéƒ½ç¼–å†™ Try, Confirm, Cancel ä¸‰ä¸ªå¹‚ç­‰çš„æ–¹æ³•ã€‚</li></ul></li><li><strong>Saga æ¨¡å¼</strong>: é•¿äº‹åŠ¡è§£å†³æ–¹æ¡ˆã€‚<ul><li><strong>æ ¸å¿ƒ</strong>: å°†ä¸€ä¸ªå¤§çš„åˆ†å¸ƒå¼äº‹åŠ¡æ‹†åˆ†æˆå¤šä¸ª<strong>æœ¬åœ°äº‹åŠ¡</strong>ï¼Œæ¯ä¸ªæœ¬åœ°äº‹åŠ¡éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„<strong>è¡¥å¿æ“ä½œ</strong>ã€‚</li><li><strong>æµç¨‹</strong>:<ul><li><strong>æ­£å‘æ‰§è¡Œ</strong>: Saga åè°ƒå™¨æŒ‰é¡ºåºè°ƒç”¨ T1, T2, T3â€¦Tnã€‚</li><li><strong>åå‘è¡¥å¿</strong>: å¦‚æœ Ti å¤±è´¥ï¼ŒSaga ä¼šæŒ‰ç›¸åé¡ºåºè°ƒç”¨å‰é¢å·²æˆåŠŸäº‹åŠ¡çš„è¡¥å¿æ“ä½œ C(i-1)â€¦C2, C1ï¼Œè¿›è¡Œå›æ»šã€‚</li></ul></li><li><strong>ä¸ TCC å¯¹æ¯”</strong>:<ul><li>TCC æœ‰èµ„æº<strong>é¢„ç•™</strong>é˜¶æ®µï¼Œé”èµ„æºæ—¶é—´é•¿ï¼›Saga æ²¡æœ‰é¢„ç•™ï¼Œç›´æ¥æäº¤æœ¬åœ°äº‹åŠ¡ï¼Œé”èµ„æºæ—¶é—´çŸ­ã€‚</li><li>TCC çš„è¡¥å¿æ˜¯<strong>é€†å‘æ“ä½œ</strong> (Cancel)ï¼›Saga çš„è¡¥å¿æ˜¯<strong>åå‘æ“ä½œ</strong>ã€‚</li></ul></li><li><strong>è¯„ä»·</strong>: é€‚åˆäºä¸šåŠ¡æµç¨‹é•¿ã€éœ€è¦ä¿è¯æœ€ç»ˆä¸€è‡´æ€§çš„åœºæ™¯ã€‚åŒæ ·å¯¹ä»£ç æœ‰ä¾µå…¥æ€§ï¼Œéœ€è¦è®¾è®¡å¥½æ¯ä¸ªå­äº‹åŠ¡çš„è¡¥å¿é€»è¾‘ã€‚</li></ul></li><li><strong>åŸºäºå¯é æ¶ˆæ¯çš„æœ€ç»ˆä¸€è‡´æ€§ (å¸¸ç”¨)</strong>:<ul><li><strong>æ ¸å¿ƒ</strong>: è¿™æ˜¯å¾®æœåŠ¡æ¶æ„ä¸­<strong>æœ€å¸¸ç”¨</strong>çš„æŸ”æ€§äº‹åŠ¡æ–¹æ¡ˆã€‚</li><li><strong>åŸç†</strong>: æœåŠ¡ A åœ¨æ‰§è¡Œå®Œæœ¬åœ°äº‹åŠ¡åï¼Œå‘é€ä¸€æ¡æ¶ˆæ¯åˆ° MQã€‚æœåŠ¡ B è®¢é˜…è¯¥æ¶ˆæ¯ï¼Œæ¶ˆè´¹æ¶ˆæ¯å¹¶æ‰§è¡Œè‡ªå·±çš„æœ¬åœ°äº‹åŠ¡ã€‚</li><li><strong>å…³é”®é—®é¢˜</strong>: å¦‚ä½•ä¿è¯<strong>æœ¬åœ°äº‹åŠ¡æ‰§è¡Œ</strong>å’Œ<strong>æ¶ˆæ¯å‘é€</strong>çš„åŸå­æ€§ï¼Ÿ<ul><li><strong>äº‹åŠ¡æ¶ˆæ¯ (RocketMQ æ”¯æŒ)</strong>: ç”Ÿäº§è€…å…ˆå‘é€ä¸€æ¡â€œåŠæ¶ˆæ¯â€åˆ° MQï¼ŒMQ æ”¶åˆ°åä¸æŠ•é€’ã€‚ç„¶åç”Ÿäº§è€…æ‰§è¡Œæœ¬åœ°äº‹åŠ¡ã€‚å¦‚æœäº‹åŠ¡æˆåŠŸï¼Œåˆ™å‘ MQ å‘é€ç¡®è®¤ï¼ŒMQ æŠ•é€’è¯¥æ¶ˆæ¯ï¼›å¦‚æœäº‹åŠ¡å¤±è´¥ï¼Œåˆ™é€šçŸ¥ MQ åˆ é™¤è¯¥åŠæ¶ˆæ¯ã€‚</li><li><strong>æœ¬åœ°æ¶ˆæ¯è¡¨</strong>: ä¸šåŠ¡æ“ä½œå’Œâ€œå¾…å‘é€æ¶ˆæ¯â€è®°å½•åœ¨åŒä¸€æœ¬åœ°äº‹åŠ¡ä¸­ã€‚ä¸€ä¸ªåå°ä»»åŠ¡å®šæ—¶æ‰«æè¿™å¼ è¡¨ï¼Œå°†æ¶ˆæ¯å‘é€åˆ° MQï¼Œå‘é€æˆåŠŸåæ›´æ–°è¡¨çŠ¶æ€ã€‚</li></ul></li><li><strong>è¯„ä»·</strong>: å®ç°äº†æœåŠ¡é—´çš„è§£è€¦ï¼Œæ€§èƒ½é«˜ï¼Œååé‡å¤§ã€‚ä½†å®ƒä¸ä¿è¯æ•°æ®çš„å¼ºä¸€è‡´æ€§ï¼Œåªä¿è¯<strong>æœ€ç»ˆä¸€è‡´æ€§</strong>ï¼Œå­˜åœ¨ä¸€ä¸ªçŸ­æš‚çš„æ•°æ®ä¸ä¸€è‡´çŠ¶æ€çª—å£ã€‚éœ€è¦å¤„ç†å¥½æ¶ˆæ¯çš„å¯é æŠ•é€’å’Œå¹‚ç­‰æ¶ˆè´¹é—®é¢˜ã€‚</li></ul></li></ul><h3 id="Lua-è„šæœ¬è¯¦è§£-åœ¨-Redis-ä¸­çš„åº”ç”¨"><a href="#Lua-è„šæœ¬è¯¦è§£-åœ¨-Redis-ä¸­çš„åº”ç”¨" class="headerlink" title="Lua è„šæœ¬è¯¦è§£ (åœ¨ Redis ä¸­çš„åº”ç”¨)"></a><strong>Lua è„šæœ¬è¯¦è§£ (åœ¨ Redis ä¸­çš„åº”ç”¨)</strong></h3><h4 id="1-Lua-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#1-Lua-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1. Lua æ˜¯ä»€ä¹ˆï¼Ÿ"></a><strong>1. Lua æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h4><p>Lua æ˜¯ä¸€ç§è½»é‡çº§ã€å¯æ‰©å±•çš„è„šæœ¬è¯­è¨€ï¼Œè¢«è®¾è®¡ç”¨äºåµŒå…¥åˆ°å…¶ä»–åº”ç”¨ç¨‹åºä¸­ï¼Œä»è€Œä¸ºåº”ç”¨ç¨‹åºæä¾›çµæ´»çš„æ‰©å±•å’Œå®šåˆ¶åŠŸèƒ½ã€‚å®ƒä»¥å…¶ç®€æ´çš„è¯­æ³•ã€é«˜æ•ˆçš„æ‰§è¡Œæ€§èƒ½å’Œæå°çš„å†…å­˜å ç”¨è€Œé—»åã€‚</p><p>åœ¨ Redis çš„ä¸Šä¸‹æ–‡ä¸­ï¼ŒLua è„šæœ¬æä¾›äº†ä¸€ç§åœ¨ Redis æœåŠ¡å™¨ç«¯æ‰§è¡Œå¤æ‚é€»è¾‘çš„å¼ºå¤§èƒ½åŠ›ã€‚</p><h4 id="2-ä¸ºä»€ä¹ˆ-Redis-è¦æ”¯æŒ-Lua-è„šæœ¬ï¼Ÿ"><a href="#2-ä¸ºä»€ä¹ˆ-Redis-è¦æ”¯æŒ-Lua-è„šæœ¬ï¼Ÿ" class="headerlink" title="2. ä¸ºä»€ä¹ˆ Redis è¦æ”¯æŒ Lua è„šæœ¬ï¼Ÿ"></a><strong>2. ä¸ºä»€ä¹ˆ Redis è¦æ”¯æŒ Lua è„šæœ¬ï¼Ÿ</strong></h4><ul><li><strong>åŸå­æ€§ (Atomicity)</strong>: è¿™æ˜¯åœ¨ Redis ä¸­ä½¿ç”¨ Lua æœ€æ ¸å¿ƒçš„åŸå› ã€‚Redis ä¼šå°†æ•´ä¸ª Lua è„šæœ¬ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„å‘½ä»¤æ¥æ‰§è¡Œï¼Œ<strong>åœ¨è„šæœ¬æ‰§è¡ŒæœŸé—´ï¼Œä¸ä¼šæœ‰å…¶ä»–å®¢æˆ·ç«¯çš„å‘½ä»¤è¢«æ’å…¥æ‰§è¡Œ</strong>ã€‚è¿™å®Œç¾åœ°è§£å†³äº†éœ€è¦ç»„åˆå¤šä¸ª Redis å‘½ä»¤æ‰èƒ½å®Œæˆä¸€ä¸ªä¸šåŠ¡é€»è¾‘æ—¶ï¼Œå¯èƒ½å‡ºç°çš„ç«æ€æ¡ä»¶é—®é¢˜ã€‚ä¾‹å¦‚å‰é¢æåˆ°çš„â€œåˆ¤æ–­é”å¹¶åˆ é™¤é”â€çš„æ“ä½œï¼Œå¦‚æœåˆ†ä¸¤æ­¥æ‰§è¡Œï¼Œå°±ä¸æ˜¯åŸå­çš„ï¼Œè€Œå°è£…åœ¨ Lua è„šæœ¬ä¸­å°±æ˜¯åŸå­çš„ã€‚</li><li><strong>å‡å°‘ç½‘ç»œå¼€é”€</strong>: å¯¹äºéœ€è¦å¤šæ¬¡ä¸ Redis äº¤äº’çš„å¤æ‚æ“ä½œï¼Œå¯ä»¥å°†æ‰€æœ‰é€»è¾‘å°è£…åœ¨ä¸€ä¸ª Lua è„šæœ¬ä¸­ï¼Œä¸€æ¬¡æ€§å‘é€ç»™ Redis æœåŠ¡å™¨ã€‚å®¢æˆ·ç«¯åªéœ€å‘é€ä¸€æ¬¡è¯·æ±‚ï¼Œè€Œä¸æ˜¯å¤šæ¬¡ï¼Œè¿™æ˜¾è‘—å‡å°‘äº†å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„ç½‘ç»œå¾€è¿”æ—¶é—´ï¼ˆRTTï¼‰ï¼Œæå‡äº†æ€§èƒ½ã€‚</li><li><strong>ä»£ç å¤ç”¨</strong>: ç¼–å†™å¥½çš„ Lua è„šæœ¬å¯ä»¥è¢«ç¼“å­˜ï¼ˆé€šè¿‡ <code>SCRIPT LOAD</code> å‘½ä»¤ç”Ÿæˆä¸€ä¸ª SHA1 æ ¡éªŒå’Œï¼‰ï¼Œä¹‹åå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡è¿™ä¸ªç®€çŸ­çš„ SHA1 æ ¡éªŒå’Œï¼ˆä½¿ç”¨ <code>EVALSHA</code> å‘½ä»¤ï¼‰æ¥è°ƒç”¨è„šæœ¬ï¼Œé¿å…äº†æ¯æ¬¡éƒ½å‘é€å®Œæ•´çš„è„šæœ¬å†…å®¹ã€‚</li></ul><h4 id="3-å¦‚ä½•åœ¨-Redis-ä¸­ä½¿ç”¨-Lua-è„šæœ¬ï¼Ÿ"><a href="#3-å¦‚ä½•åœ¨-Redis-ä¸­ä½¿ç”¨-Lua-è„šæœ¬ï¼Ÿ" class="headerlink" title="3. å¦‚ä½•åœ¨ Redis ä¸­ä½¿ç”¨ Lua è„šæœ¬ï¼Ÿ"></a><strong>3. å¦‚ä½•åœ¨ Redis ä¸­ä½¿ç”¨ Lua è„šæœ¬ï¼Ÿ</strong></h4><p>é€šè¿‡ EVAL æˆ– EVALSHA å‘½ä»¤æ¥æ‰§è¡Œã€‚</p><p>EVAL script numkeys key [key â€¦] arg [arg â€¦]</p><ul><li><code>script</code>: è¦æ‰§è¡Œçš„ Lua è„šæœ¬å­—ç¬¦ä¸²ã€‚</li><li><code>numkeys</code>: åé¢è·Ÿçš„ <code>key</code> å‚æ•°çš„æ•°é‡ã€‚è¿™æœ‰åŠ©äº Redis æ­£ç¡®åœ°å°†å‚æ•°åŒºåˆ†ä¸ºé”®åï¼ˆ<code>KEYS</code>ï¼‰å’Œæ™®é€šå‚æ•°ï¼ˆ<code>ARGV</code>ï¼‰ï¼Œè¿™å¯¹äº Redis Cluster æ¨¡å¼ä¸‹çš„è·¯ç”±è‡³å…³é‡è¦ã€‚</li><li><code>key [key ...]</code>ï¼šè„šæœ¬ä¸­è¦æ“ä½œçš„ Redis é”®ï¼Œåœ¨ Lua è„šæœ¬ä¸­å¯ä»¥é€šè¿‡å…¨å±€å˜é‡ <code>KEYS</code> tableï¼ˆä¾‹å¦‚ <code>KEYS[1]</code>ï¼‰æ¥è®¿é—®ã€‚</li><li><code>arg [arg ...]</code>ï¼šä¼ é€’ç»™è„šæœ¬çš„é¢å¤–å‚æ•°ï¼Œåœ¨ Lua è„šæœ¬ä¸­å¯ä»¥é€šè¿‡å…¨å±€å˜é‡ <code>ARGV</code> tableï¼ˆä¾‹å¦‚ <code>ARGV[1]</code>ï¼‰æ¥è®¿é—®ã€‚</li></ul><p><strong>ç¤ºä¾‹ï¼šå®ç°ä¸€ä¸ªå®‰å…¨çš„åº“å­˜æ‰£å‡</strong></p><p>Lua</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">-- è„šæœ¬é€»è¾‘ï¼šæ£€æŸ¥åº“å­˜æ˜¯å¦å……è¶³ï¼Œå¦‚æœå……è¶³åˆ™æ‰£å‡å¹¶è¿”å›1ï¼Œå¦åˆ™è¿”å›0</span><br><span class="line">-- KEYS[1]: åº“å­˜çš„ keyï¼Œä¾‹å¦‚ &quot;product:1001:stock&quot;</span><br><span class="line">-- ARGV[1]: æœ¬æ¬¡è¦æ‰£å‡çš„æ•°é‡</span><br><span class="line"></span><br><span class="line">local stock = tonumber(redis.call(&#x27;get&#x27;, KEYS[1]))</span><br><span class="line">local quantity = tonumber(ARGV[1])</span><br><span class="line"></span><br><span class="line">if stock &gt;= quantity then</span><br><span class="line">    redis.call(&#x27;decrby&#x27;, KEYS[1], quantity)</span><br><span class="line">    return 1</span><br><span class="line">else</span><br><span class="line">    return 0</span><br><span class="line">end</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªè„šæœ¬ä¿è¯äº†â€œè¯»å–åº“å­˜â€å’Œâ€œæ‰£å‡åº“å­˜â€ä¸¤ä¸ªæ“ä½œçš„åŸå­æ€§ï¼Œé¿å…äº†åœ¨é«˜å¹¶å‘ä¸‹è¶…å–çš„é—®é¢˜ã€‚</p><hr><h3 id="Token-è®¤è¯æœºåˆ¶è¯¦è§£"><a href="#Token-è®¤è¯æœºåˆ¶è¯¦è§£" class="headerlink" title="Token è®¤è¯æœºåˆ¶è¯¦è§£"></a><strong>Token è®¤è¯æœºåˆ¶è¯¦è§£</strong></h3><h4 id="1-Token-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#1-Token-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1. Token æ˜¯ä»€ä¹ˆï¼Ÿ"></a><strong>1. Token æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h4><p>Tokenï¼ˆä»¤ç‰Œï¼‰æ˜¯åœ¨æœåŠ¡ç«¯ç”Ÿæˆçš„ä¸€ä¸²åŠ å¯†å­—ç¬¦ä¸²ï¼Œä½œä¸ºå®¢æˆ·ç«¯è¿›è¡Œè¯·æ±‚çš„ä¸€ä¸ªâ€œå‡­è¯â€ã€‚å½“ç”¨æˆ·ç¬¬ä¸€æ¬¡ç™»å½•æˆåŠŸåï¼ŒæœåŠ¡ç«¯ä¼šç”Ÿæˆä¸€ä¸ª Token å¹¶è¿”å›ç»™å®¢æˆ·ç«¯ã€‚ä¹‹åï¼Œå®¢æˆ·ç«¯åœ¨æ¯æ¬¡è¯·æ±‚éœ€è¦èº«ä»½è®¤è¯çš„æ¥å£æ—¶ï¼Œéƒ½éœ€è¦åœ¨è¯·æ±‚å¤´ï¼ˆé€šå¸¸æ˜¯ <code>Authorization</code> å­—æ®µï¼‰ä¸­æºå¸¦è¿™ä¸ª Tokenã€‚æœåŠ¡ç«¯æ¥æ”¶åˆ°è¯·æ±‚åï¼Œä¼šéªŒè¯ Token çš„æœ‰æ•ˆæ€§ï¼Œå¦‚æœéªŒè¯é€šè¿‡ï¼Œåˆ™å¤„ç†è¯¥è¯·æ±‚ï¼›å¦åˆ™ï¼Œæ‹’ç»è¯¥è¯·æ±‚ã€‚</p><p>ä¸€ä¸ªå…¸å‹çš„ Token æ˜¯ <strong>JWT (JSON Web Token)</strong>ï¼Œå®ƒç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œç”¨ <code>.</code> åˆ†éš”ï¼š</p><ul><li><strong>Header (å¤´éƒ¨)</strong>: åŒ…å«äº†ä»¤ç‰Œçš„ç±»å‹ï¼ˆ<code>typ</code>ï¼Œå³ JWTï¼‰å’Œæ‰€ä½¿ç”¨çš„ç­¾åç®—æ³•ï¼ˆ<code>alg</code>ï¼Œå¦‚ HMAC SHA256 æˆ– RSAï¼‰ã€‚</li><li><strong>Payload (è´Ÿè½½)</strong>: åŒ…å«äº†â€œå£°æ˜ (claims)â€ï¼Œæ˜¯å­˜æ”¾å®é™…éœ€è¦ä¼ é€’çš„æ•°æ®çš„åœ°æ–¹ã€‚ä¾‹å¦‚ç”¨æˆ·IDï¼ˆ<code>sub</code>ï¼‰ã€ç­¾å‘æ—¶é—´ï¼ˆ<code>iat</code>ï¼‰ã€è¿‡æœŸæ—¶é—´ï¼ˆ<code>exp</code>ï¼‰ä»¥åŠå…¶ä»–è‡ªå®šä¹‰çš„ç”¨æˆ·ä¿¡æ¯ã€‚<strong>æ³¨æ„ï¼šPayload éƒ¨åˆ†æ˜¯ Base64 ç¼–ç çš„ï¼Œå¹¶éåŠ å¯†ï¼Œå› æ­¤ä¸åº”å­˜æ”¾æ•æ„Ÿä¿¡æ¯ã€‚</strong></li><li><strong>Signature (ç­¾å)</strong>: å¯¹å‰ä¸¤éƒ¨åˆ†ï¼ˆHeader å’Œ Payloadï¼‰ä½¿ç”¨æŒ‡å®šçš„ç®—æ³•å’Œå­˜å‚¨åœ¨æœåŠ¡ç«¯çš„å¯†é’¥ï¼ˆsecretï¼‰è¿›è¡Œç­¾åã€‚è¿™ä¸ªç­¾åçš„ä½œç”¨æ˜¯<strong>é˜²æ­¢æ•°æ®è¢«ç¯¡æ”¹</strong>ã€‚æœåŠ¡ç«¯æ”¶åˆ° Token åï¼Œä¼šç”¨åŒæ ·çš„ç®—æ³•å’Œå¯†é’¥é‡æ–°è®¡ç®—ç­¾åï¼Œå¹¶ä¸ Token ä¸­çš„ç­¾åè¿›è¡Œæ¯”å¯¹ï¼Œè‹¥ä¸€è‡´ï¼Œåˆ™è¯´æ˜ Token æœªè¢«ç¯¡æ”¹ä¸”æ˜¯å¯ä¿¡çš„ã€‚</li></ul><h4 id="2-Token-è®¤è¯åŸç†ï¼ˆå·¥ä½œæµç¨‹ï¼‰"><a href="#2-Token-è®¤è¯åŸç†ï¼ˆå·¥ä½œæµç¨‹ï¼‰" class="headerlink" title="2. Token è®¤è¯åŸç†ï¼ˆå·¥ä½œæµç¨‹ï¼‰"></a><strong>2. Token è®¤è¯åŸç†ï¼ˆå·¥ä½œæµç¨‹ï¼‰</strong></h4><ol><li><strong>ç™»å½•</strong>: ç”¨æˆ·ä½¿ç”¨ç”¨æˆ·åå’Œå¯†ç å‘èµ·ç™»å½•è¯·æ±‚ã€‚</li><li><strong>éªŒè¯</strong>: æœåŠ¡ç«¯éªŒè¯ç”¨æˆ·çš„å‡­æ®æ˜¯å¦æ­£ç¡®ã€‚</li><li><strong>ç­¾å‘ Token</strong>: éªŒè¯æˆåŠŸåï¼ŒæœåŠ¡ç«¯æ ¹æ®ç”¨æˆ·IDã€è§’è‰²ç­‰ä¿¡æ¯ï¼Œç»“åˆå¯†é’¥ï¼ˆsecretï¼‰ï¼Œç”Ÿæˆä¸€ä¸ª Tokenã€‚</li><li><strong>è¿”å› Token</strong>: æœåŠ¡ç«¯å°†ç”Ÿæˆçš„ Token è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li><li><strong>å­˜å‚¨ Token</strong>: å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ã€Appï¼‰å°† Token å­˜å‚¨èµ·æ¥ï¼Œé€šå¸¸æ”¾åœ¨ <code>localStorage</code>ã€<code>sessionStorage</code> æˆ– <code>HttpOnly</code> çš„ Cookie ä¸­ã€‚</li><li><strong>æºå¸¦ Token è¯·æ±‚</strong>: å®¢æˆ·ç«¯åœ¨åç»­æ¯æ¬¡è¯·æ±‚å—ä¿æŠ¤çš„ API æ—¶ï¼Œéƒ½ä¼šåœ¨ HTTP è¯·æ±‚å¤´çš„ <code>Authorization</code> å­—æ®µä¸­é™„ä¸Š Tokenï¼Œæ ¼å¼é€šå¸¸ä¸º <code>Bearer &lt;token&gt;</code>ã€‚</li><li><strong>éªŒè¯ Token</strong>: æœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚åï¼Œä»è¯·æ±‚å¤´ä¸­è§£æå‡º Tokenï¼Œç„¶åï¼š<ul><li>éªŒè¯ç­¾åæ˜¯å¦æ­£ç¡®ï¼Œç¡®ä¿ Token æœªè¢«ç¯¡æ”¹ã€‚</li><li>æ£€æŸ¥ Token æ˜¯å¦åœ¨æœ‰æ•ˆæœŸå†…ï¼ˆ<code>exp</code> å£°æ˜ï¼‰ã€‚</li><li>å¦‚æœéªŒè¯é€šè¿‡ï¼Œåˆ™ä» Payload ä¸­è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œæ‰§è¡Œä¸šåŠ¡é€»è¾‘å¹¶è¿”å›ç»“æœã€‚</li><li>å¦‚æœéªŒè¯å¤±è´¥ï¼Œåˆ™è¿”å› <code>401 Unauthorized</code> é”™è¯¯ã€‚</li></ul></li></ol><h4 id="3-ä¸ºä»€ä¹ˆä½¿ç”¨-Tokenï¼Ÿï¼ˆä¸-Session-çš„åŒºåˆ«ï¼‰"><a href="#3-ä¸ºä»€ä¹ˆä½¿ç”¨-Tokenï¼Ÿï¼ˆä¸-Session-çš„åŒºåˆ«ï¼‰" class="headerlink" title="3. ä¸ºä»€ä¹ˆä½¿ç”¨ Tokenï¼Ÿï¼ˆä¸ Session çš„åŒºåˆ«ï¼‰"></a><strong>3. ä¸ºä»€ä¹ˆä½¿ç”¨ Tokenï¼Ÿï¼ˆä¸ Session çš„åŒºåˆ«ï¼‰</strong></h4><p>åœ¨ Web å¼€å‘æ—©æœŸï¼Œ<code>Session-Cookie</code> æœºåˆ¶æ˜¯ä¸»æµã€‚æœåŠ¡ç«¯åœ¨ç”¨æˆ·ç™»å½•ååˆ›å»ºä¸€ä¸ª Session å¯¹è±¡å­˜å‚¨åœ¨å†…å­˜æˆ– Redis ä¸­ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ª Session IDï¼Œé€šè¿‡ Cookie è¿”å›ç»™æµè§ˆå™¨ã€‚æµè§ˆå™¨åç»­è¯·æ±‚ä¼šè‡ªåŠ¨å¸¦ä¸Šè¿™ä¸ª Session IDï¼ŒæœåŠ¡ç«¯æ ¹æ® ID æ‰¾åˆ°å¯¹åº”çš„ Session ä¿¡æ¯æ¥è¯†åˆ«ç”¨æˆ·ã€‚</p><p><strong>Token æœºåˆ¶ç›¸æ¯” Session æœºåˆ¶ï¼Œæ ¸å¿ƒä¼˜åŠ¿åœ¨äºâ€œæ— çŠ¶æ€æ€§ (Statelessness)â€</strong>ï¼Œè¿™å¸¦æ¥äº†ä»¥ä¸‹å¥½å¤„ï¼š</p><table><thead><tr><th>ç‰¹æ€§å¯¹æ¯”</th><th>Session æœºåˆ¶</th><th>Token æœºåˆ¶</th><th>ä¼˜åŠ¿è¯´æ˜</th></tr></thead><tbody><tr><td><strong>çŠ¶æ€å­˜å‚¨</strong></td><td><strong>æœ‰çŠ¶æ€ (Stateful)</strong>ã€‚Session ä¿¡æ¯éœ€å­˜å‚¨åœ¨æœåŠ¡ç«¯ã€‚</td><td><strong>æ— çŠ¶æ€ (Stateless)</strong>ã€‚ç”¨æˆ·ä¿¡æ¯åŒ…å«åœ¨ Token çš„ Payload ä¸­ï¼ŒæœåŠ¡ç«¯æ— éœ€å­˜å‚¨ã€‚</td><td><strong>å‡è½»æœåŠ¡ç«¯å‹åŠ›</strong>ã€‚æœåŠ¡ç«¯ä¸éœ€è¦ä¸ºæ¯ä¸ªåœ¨çº¿ç”¨æˆ·ç»´æŠ¤ä¸€ä¸ª Session å¯¹è±¡ã€‚</td></tr><tr><td><strong>å¯æ‰©å±•æ€§</strong></td><td><strong>å·®</strong>ã€‚åœ¨åˆ†å¸ƒå¼æˆ–é›†ç¾¤ç¯å¢ƒä¸‹ï¼Œéœ€è¦è§£å†³ Session å…±äº«é—®é¢˜ï¼ˆå¦‚ Session Stickyã€Session Replicationã€é›†ä¸­å­˜å‚¨ï¼‰ã€‚</td><td><strong>å¥½</strong>ã€‚ç”±äºæœåŠ¡ç«¯ä¸å­˜å‚¨çŠ¶æ€ï¼Œä»»ä½•ä¸€å°æœåŠ¡å™¨åªè¦æœ‰ç›¸åŒçš„å¯†é’¥ï¼Œå°±èƒ½éªŒè¯ Tokenï¼Œå¤©ç„¶é€‚åˆåˆ†å¸ƒå¼å’Œå¾®æœåŠ¡æ¶æ„ã€‚</td><td><strong>è½»æ¾å®ç°æ°´å¹³æ‰©å±•</strong>ã€‚å¢åŠ æœåŠ¡å™¨èŠ‚ç‚¹æ— éœ€é¢å¤–é…ç½® Session å…±äº«ã€‚</td></tr><tr><td><strong>è·¨åŸŸæ”¯æŒ</strong></td><td><strong>æœ‰é™</strong>ã€‚åŸºäº Cookie çš„ Session æœºåˆ¶åœ¨è·¨åŸŸï¼ˆCORSï¼‰åœºæ™¯ä¸‹å¤„ç†èµ·æ¥æ¯”è¾ƒéº»çƒ¦ã€‚</td><td><strong>ä¼˜ç§€</strong>ã€‚Token å¯ä»¥é€šè¿‡ HTTP è¯·æ±‚å¤´å‘é€ï¼Œä¸å—åŒæºç­–ç•¥é™åˆ¶ï¼Œéå¸¸é€‚åˆå‰åç«¯åˆ†ç¦»å’Œè·¨åŸŸ API è°ƒç”¨ã€‚</td><td><strong>é€‚åº”ç°ä»£æ¶æ„</strong>ã€‚å®Œç¾æ”¯æŒ SPAï¼ˆå•é¡µåº”ç”¨ï¼‰ã€ç§»åŠ¨ App ç­‰å¤šç§å®¢æˆ·ç«¯ã€‚</td></tr><tr><td><strong>å®‰å…¨æ€§</strong></td><td>ä¾èµ– Cookie æœºåˆ¶ï¼Œå¯èƒ½é­å— CSRF æ”»å‡»ã€‚</td><td>å¦‚æœ Token å­˜å‚¨åœ¨ <code>localStorage</code>ï¼Œå¯èƒ½é­å— XSS æ”»å‡»ã€‚éœ€è¦ç»¼åˆè€ƒè™‘å­˜å‚¨æ–¹å¼ã€‚</td><td>ä¸¤è€…å„æœ‰å®‰å…¨é£é™©ç‚¹ï¼Œéœ€é…åˆå…¶ä»–å®‰å…¨ç­–ç•¥ã€‚Token æœºåˆ¶ä¸ä¾èµ– Cookieï¼Œæ›´çµæ´»ã€‚</td></tr><tr><td><strong>é€‚ç”¨æ€§</strong></td><td>é€‚åˆä¼ ç»Ÿçš„ã€ä¸€ä½“åŒ–çš„ Web åº”ç”¨ã€‚</td><td>é€‚åˆç°ä»£çš„ã€åˆ†å¸ƒå¼çš„ã€è·¨ç»ˆç«¯çš„ï¼ˆWeb, Mobile, IoTï¼‰åº”ç”¨æ¶æ„ã€‚</td><td>Token æ›´å…·é€šç”¨æ€§å’Œå‰ç»æ€§ã€‚</td></tr></tbody></table><h4 id="4-åŒä»¤ç‰Œç­–ç•¥-Access-Token-Refresh-Token"><a href="#4-åŒä»¤ç‰Œç­–ç•¥-Access-Token-Refresh-Token" class="headerlink" title="4. åŒä»¤ç‰Œç­–ç•¥ (Access Token + Refresh Token)"></a><strong>4. åŒä»¤ç‰Œç­–ç•¥ (Access Token + Refresh Token)</strong></h4><ul><li><strong>Q: ä¸ºä»€ä¹ˆä¸ç”¨å•ä¸ª Tokenï¼Ÿ</strong><ul><li><strong>å¦‚æœ Token æœ‰æ•ˆæœŸå¾ˆé•¿ï¼ˆå¦‚ä¸€ä¸ªæœˆï¼‰</strong>: å®‰å…¨é£é™©é«˜ã€‚ä¸€æ—¦ Token åœ¨æ­¤æœŸé—´è¢«çªƒå–ï¼Œæ”»å‡»è€…å¯ä»¥é•¿æ—¶é—´å†’å……ç”¨æˆ·èº«ä»½è¿›è¡Œæ“ä½œã€‚</li><li><strong>å¦‚æœ Token æœ‰æ•ˆæœŸå¾ˆçŸ­ï¼ˆå¦‚ 15 åˆ†é’Ÿï¼‰</strong>: ç”¨æˆ·ä½“éªŒå·®ã€‚ç”¨æˆ·éœ€è¦é¢‘ç¹åœ°é‡æ–°ç™»å½•ï¼Œè¿™æ˜¯æ— æ³•æ¥å—çš„ã€‚</li></ul></li><li><strong>A: åŒä»¤ç‰Œç­–ç•¥åº”è¿è€Œç”Ÿï¼Œå®Œç¾å¹³è¡¡äº†å®‰å…¨æ€§å’Œç”¨æˆ·ä½“éªŒã€‚</strong><ul><li><strong>Access Token (è®¿é—®ä»¤ç‰Œ)</strong>: å®ƒçš„æœ‰æ•ˆæœŸ<strong>éå¸¸çŸ­</strong>ï¼ˆå¦‚ 15 åˆ†é’Ÿåˆ° 1 å°æ—¶ï¼‰ã€‚å®ƒè¢«ç”¨äºè®¿é—®å—ä¿æŠ¤çš„èµ„æºï¼Œç”±äºå…¶ç”Ÿå‘½å‘¨æœŸçŸ­ï¼Œå³ä½¿è¢«çªƒå–ï¼Œæ”»å‡»è€…èƒ½é€ æˆçš„å±å®³ä¹Ÿæœ‰é™ã€‚</li><li><strong>Refresh Token (åˆ·æ–°ä»¤ç‰Œ)</strong>: å®ƒçš„æœ‰æ•ˆæœŸ<strong>å¾ˆé•¿</strong>ï¼ˆå¦‚ 7 å¤©æˆ– 30 å¤©ï¼‰ã€‚å®ƒçš„<strong>å”¯ä¸€ä½œç”¨</strong>æ˜¯ç”¨æ¥è·å–æ–°çš„ Access Tokenã€‚Refresh Token æœ¬èº«ä¸åŒ…å«ä»»ä½•æƒé™ä¿¡æ¯ï¼Œä¸èƒ½ç”¨äºç›´æ¥è®¿é—® APIã€‚</li></ul></li><li><strong>åŒä»¤ç‰Œå·¥ä½œæµç¨‹ï¼ˆé™é»˜åˆ·æ–°ï¼‰</strong><ol><li><strong>é¦–æ¬¡ç™»å½•</strong>: ç”¨æˆ·ç™»å½•æˆåŠŸï¼ŒæœåŠ¡ç«¯è¿”å›ä¸€ä¸ªçŸ­æœŸçš„ <code>Access Token</code> å’Œä¸€ä¸ªé•¿æœŸçš„ <code>Refresh Token</code>ã€‚å®¢æˆ·ç«¯å°†ä¸¤è€…éƒ½å­˜å‚¨èµ·æ¥ã€‚</li><li><strong>æ­£å¸¸è®¿é—®</strong>: å®¢æˆ·ç«¯ä½¿ç”¨ <code>Access Token</code> è®¿é—® APIã€‚æœåŠ¡ç«¯éªŒè¯ <code>Access Token</code> é€šè¿‡ï¼Œè¿”å›æ•°æ®ã€‚</li><li><strong>Access Token è¿‡æœŸ</strong>: å®¢æˆ·ç«¯å†æ¬¡ä½¿ç”¨è¿‡æœŸçš„ <code>Access Token</code> è®¿é—® APIï¼ŒæœåŠ¡ç«¯è¿”å› <code>401 Unauthorized</code> é”™è¯¯ï¼Œå¹¶å¯èƒ½å¸¦ä¸Šä¸€ä¸ªç‰¹å®šé”™è¯¯ç ï¼Œå‘ŠçŸ¥å®¢æˆ·ç«¯æ˜¯â€œä»¤ç‰Œè¿‡æœŸâ€è€Œéâ€œæ— æ•ˆä»¤ç‰Œâ€ã€‚</li><li><strong>é™é»˜åˆ·æ–°</strong>: å®¢æˆ·ç«¯çš„è¯·æ±‚æ‹¦æˆªå™¨æ•è·åˆ°è¿™ä¸ª <code>401</code> é”™è¯¯åï¼Œ<strong>ä¸ä¼šç«‹å³è·³è½¬åˆ°ç™»å½•é¡µ</strong>ã€‚è€Œæ˜¯è‡ªåŠ¨å‘èµ·ä¸€ä¸ªç‰¹æ®Šçš„è¯·æ±‚ï¼Œæºå¸¦é‚£ä¸ªé•¿æœŸçš„ <code>Refresh Token</code> å»è®¿é—®ä¸€ä¸ªä¸“é—¨çš„åˆ·æ–°æ¥å£ï¼ˆå¦‚ <code>/api/token/refresh</code>ï¼‰ã€‚</li><li><strong>ç­¾å‘æ–°ä»¤ç‰Œ</strong>: æœåŠ¡ç«¯éªŒè¯ <code>Refresh Token</code> çš„æœ‰æ•ˆæ€§ï¼ˆé€šå¸¸ä¼šå°†å…¶å­˜å‚¨åœ¨ Redis æˆ–æ•°æ®åº“ä¸­è¿›è¡Œæ¯”å¯¹ï¼Œä»¥å®ç°å¼ºåˆ¶ä¸‹çº¿åŠŸèƒ½ï¼‰ã€‚å¦‚æœéªŒè¯é€šè¿‡ï¼Œå°±ç”Ÿæˆä¸€ä¸ª<strong>æ–°çš„ Access Token</strong>ï¼ˆæœ‰æ—¶ä¹Ÿä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ <code>Refresh Token</code>ï¼Œè¿™è¢«ç§°ä¸ºåˆ·æ–°ä»¤ç‰Œæ»šåŠ¨ç­–ç•¥ï¼‰å¹¶è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li><li><strong>é‡è¯•è¯·æ±‚</strong>: å®¢æˆ·ç«¯æ”¶åˆ°æ–°çš„ <code>Access Token</code> åï¼Œç”¨å®ƒæ›¿æ¢æ‰æœ¬åœ°æ—§çš„ <code>Access Token</code>ï¼Œç„¶å<strong>è‡ªåŠ¨é‡æ–°å‘é€åˆšæ‰å› ä»¤ç‰Œè¿‡æœŸè€Œå¤±è´¥çš„é‚£ä¸ªè¯·æ±‚</strong>ã€‚</li><li><strong>æ— æ„Ÿä½“éªŒ</strong>: æ•´ä¸ªè¿‡ç¨‹å¯¹ç”¨æˆ·æ˜¯é€æ˜çš„ï¼Œç”¨æˆ·æ„Ÿè§‰ä¸åˆ°ä»¤ç‰Œå·²ç»è¿‡æœŸå¹¶è¢«åˆ·æ–°ï¼Œå®ç°äº†â€œé™é»˜åˆ·æ–°â€ï¼Œä½“éªŒéå¸¸æµç•…ã€‚</li><li><strong>Refresh Token è¿‡æœŸ</strong>: å¦‚æœ <code>Refresh Token</code> ä¹Ÿè¿‡æœŸäº†ï¼Œé‚£ä¹ˆåˆ·æ–°æ¥å£ä¼šè¿”å›é”™è¯¯ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯æ‰ä¼šçœŸæ­£æ¸…é™¤ç”¨æˆ·å‡­è¯å¹¶å¼•å¯¼ç”¨æˆ·é‡æ–°ç™»å½•ã€‚</li></ol></li></ul><h4 id="5-Token-ç›¸å…³åœºæ™¯ä¸é¢è¯•é¢˜"><a href="#5-Token-ç›¸å…³åœºæ™¯ä¸é¢è¯•é¢˜" class="headerlink" title="5. Token ç›¸å…³åœºæ™¯ä¸é¢è¯•é¢˜"></a><strong>5. Token ç›¸å…³åœºæ™¯ä¸é¢è¯•é¢˜</strong></h4><ul><li><strong>é¢è¯•é¢˜ 1ï¼šâ€œToken åº”è¯¥å­˜å‚¨åœ¨å“ªé‡Œï¼ŸlocalStorageã€sessionStorage è¿˜æ˜¯ Cookieï¼Ÿâ€</strong><ul><li><strong>å›ç­”è¦ç‚¹</strong>:<ul><li><strong>localStorage&#x2F;sessionStorage</strong>:<ul><li><strong>ä¼˜ç‚¹</strong>: æ–¹ä¾¿ JavaScript ç›´æ¥è¯»å†™ï¼Œå®¹é‡è¾ƒå¤§ï¼ˆ5MBï¼‰ã€‚</li><li><strong>ç¼ºç‚¹</strong>: å®¹æ˜“å—åˆ° <strong>XSS (è·¨ç«™è„šæœ¬æ”»å‡»)</strong>ã€‚å¦‚æœç½‘ç«™å­˜åœ¨ XSS æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥æ‰§è¡Œ JS ä»£ç ç›´æ¥çªƒå–å­˜å‚¨åœ¨å…¶ä¸­çš„ Tokenã€‚</li></ul></li><li><strong>Cookie (HttpOnly)</strong>:<ul><li><strong>ä¼˜ç‚¹</strong>: è®¾ç½®ä¸º <code>HttpOnly</code> åï¼ŒJavaScript å°†æ— æ³•è¯»å†™è¯¥ Cookieï¼Œå¯ä»¥æœ‰æ•ˆ<strong>é˜²å¾¡ XSS æ”»å‡»</strong>ã€‚æµè§ˆå™¨ä¼šè‡ªåŠ¨åœ¨åŒåŸŸè¯·æ±‚ä¸­æºå¸¦å®ƒã€‚</li><li><strong>ç¼ºç‚¹</strong>: å®¹æ˜“å—åˆ° <strong>CSRF (è·¨ç«™è¯·æ±‚ä¼ªé€ )</strong> æ”»å‡»ã€‚æ”»å‡»è€…å¯ä»¥è¯±å¯¼ç”¨æˆ·ç‚¹å‡»æ¶æ„é“¾æ¥ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨å¸¦ä¸Šç”¨æˆ·çš„ Cookie å»è¯·æ±‚ä½ çš„ç½‘ç«™ï¼Œæ‰§è¡Œéç”¨æˆ·æœ¬æ„çš„æ“ä½œã€‚éœ€è¦é…åˆ Anti-CSRF Token ç­‰æœºåˆ¶æ¥é˜²å¾¡ã€‚å®¹é‡è¾ƒå°ï¼ˆ4KBï¼‰ã€‚</li></ul></li><li><strong>æœ€ä½³å®è·µ&#x2F;ç»“è®º</strong>: æ²¡æœ‰ç»å¯¹å®Œç¾çš„é€‰æ‹©ï¼Œéœ€è¦æƒè¡¡ã€‚<ul><li><strong>é«˜å®‰å…¨æ€§æ–¹æ¡ˆ</strong>: å°† <code>Refresh Token</code> å­˜å‚¨åœ¨ <code>HttpOnly</code> çš„ Cookie ä¸­ï¼ˆé˜²æ­¢ XSSï¼‰ï¼Œå°† <code>Access Token</code> å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼ˆå˜é‡é‡Œï¼Œé¡µé¢åˆ·æ–°ä¸¢å¤±ï¼‰æˆ– <code>sessionStorage</code> ä¸­ã€‚åŒæ—¶ï¼Œåç«¯æ¥å£å¿…é¡»å®æ–½ CSRF é˜²å¾¡ç­–ç•¥ã€‚</li><li><strong>ä¸»æµå®è·µæ–¹æ¡ˆ (å‰åç«¯åˆ†ç¦»)</strong>: å°† Token å­˜å‚¨åœ¨ <code>localStorage</code> ä¸­ï¼Œå¹¶åœ¨ <code>Authorization</code> è¯·æ±‚å¤´ä¸­æºå¸¦ã€‚åŒæ—¶ï¼Œå‰ç«¯å¿…é¡»ä¸¥æ ¼åšå¥½è¾“å…¥è¿‡æ»¤å’Œå†…å®¹è½¬ä¹‰ï¼Œå°½æœ€å¤§åŠªåŠ›é˜²æ­¢ XSS æ¼æ´çš„å‡ºç°ã€‚</li></ul></li></ul></li></ul></li><li><strong>é¢è¯•é¢˜ 2ï¼šâ€œç”¨æˆ·ç‚¹å‡»â€œé€€å‡ºç™»å½•â€æ—¶ï¼ŒToken å¦‚ä½•å¤±æ•ˆï¼Ÿâ€</strong><ul><li><strong>å›ç­”è¦ç‚¹</strong>:<ul><li><strong>å¯¹äºæ— çŠ¶æ€çš„ JWT</strong>: ç”±äºæ‰€æœ‰ä¿¡æ¯éƒ½åœ¨ Token è‡ªèº«ï¼ŒæœåŠ¡ç«¯æ— æ³•ä¸»åŠ¨è®©å…¶å¤±æ•ˆã€‚å› æ­¤ï¼Œâ€œé€€å‡ºç™»å½•â€ä¸»è¦æ˜¯ä¸€ä¸ª<strong>å®¢æˆ·ç«¯è¡Œä¸º</strong>ã€‚<ul><li><strong>å®¢æˆ·ç«¯</strong>: åªéœ€ä» <code>localStorage</code> æˆ–å…¶ä»–å­˜å‚¨ä½ç½®æ¸…é™¤ Token å³å¯ã€‚ç”¨æˆ·å°†æ— æ³•å†å‘èµ·è®¤è¯è¯·æ±‚ã€‚</li></ul></li><li><strong>å¦‚ä½•å®ç°æœåŠ¡ç«¯å¼ºåˆ¶ä¸‹çº¿ï¼Ÿ</strong>: å¦‚æœéœ€è¦å®ç°â€œè¸¢äººä¸‹çº¿â€æˆ–â€œä¿®æ”¹å¯†ç åæ‰€æœ‰è®¾å¤‡å¼ºåˆ¶ä¸‹çº¿â€çš„åŠŸèƒ½ï¼Œå°±å¿…é¡»æ‰“ç ´çº¯ç²¹çš„æ— çŠ¶æ€ã€‚<ul><li><strong>é»‘åå•æœºåˆ¶</strong>: æœåŠ¡ç«¯å¯ä»¥å»ºç«‹ä¸€ä¸ª Token é»‘åå•ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨ Redis Setï¼‰ã€‚å½“ç”¨æˆ·é€€å‡ºç™»å½•æ—¶ï¼Œå°†è¯¥ Token çš„ <code>jti</code> (JWT ID) æˆ–æ•´ä¸ª Token æ”¾å…¥é»‘åå•ï¼Œå¹¶è®¾ç½®ä¸ Token å‰©ä½™æœ‰æ•ˆæœŸç›¸åŒçš„è¿‡æœŸæ—¶é—´ã€‚åœ¨æ¯æ¬¡éªŒè¯ Token æ—¶ï¼Œé™¤äº†å¸¸è§„éªŒè¯ï¼Œè¿˜éœ€æ£€æŸ¥è¯¥ Token æ˜¯å¦åœ¨é»‘åå•ä¸­ã€‚</li><li><strong>åŸºäº Refresh Token</strong>: åœ¨åŒä»¤ç‰Œæ¨¡å¼ä¸‹ï¼Œé€€å‡ºç™»å½•æ—¶åªéœ€è®©æœåŠ¡ç«¯çš„ <code>Refresh Token</code> å¤±æ•ˆï¼ˆä¾‹å¦‚ï¼Œä» Redis ä¸­åˆ é™¤ï¼‰ã€‚è¿™æ ·ç”¨æˆ·å°±æ— æ³•å†è·å–æ–°çš„ <code>Access Token</code>ï¼Œå½“æ—§çš„ <code>Access Token</code> è¿‡æœŸåï¼Œè‡ªç„¶å°±ä¸‹çº¿äº†ã€‚</li></ul></li></ul></li></ul></li><li><strong>é¢è¯•é¢˜ 3ï¼šâ€œè¯·ä½ è®¾è®¡ä¸€ä¸ªæ”¯æŒ Web ç«¯å’Œ App ç«¯ç»Ÿä¸€ç™»å½•çš„è®¤è¯ç³»ç»Ÿã€‚â€</strong><ul><li><strong>å›ç­”è¦ç‚¹</strong>:<ul><li>è¿™æ­£æ˜¯ Token è®¤è¯æœºåˆ¶çš„å…¸å‹åº”ç”¨åœºæ™¯ã€‚æˆ‘ä¼šé‡‡ç”¨åŸºäº <strong>OAuth 2.0&#x2F;OIDC</strong> æˆ–è‡ªå®šä¹‰çš„**åŒä»¤ç‰Œï¼ˆAccess&#x2F;Refresh Tokenï¼‰**æ–¹æ¡ˆã€‚</li><li><strong>ç»Ÿä¸€è®¤è¯ä¸­å¿ƒ (UAC)</strong>: å»ºç«‹ä¸€ä¸ªç‹¬ç«‹çš„è®¤è¯æœåŠ¡ï¼Œè´Ÿè´£å¤„ç†æ‰€æœ‰å®¢æˆ·ç«¯ï¼ˆWeb, iOS, Androidï¼‰çš„ç™»å½•ã€æ³¨å†Œã€Token ç­¾å‘å’Œåˆ·æ–°ã€‚</li><li><strong>API ç½‘å…³</strong>: æ‰€æœ‰ä¸šåŠ¡è¯·æ±‚éƒ½é€šè¿‡ API ç½‘å…³ã€‚ç½‘å…³çš„æ ¸å¿ƒèŒè´£ä¹‹ä¸€å°±æ˜¯<strong>ç»Ÿä¸€é‰´æƒ</strong>ã€‚å®ƒä¼šæ‹¦æˆªæ‰€æœ‰è¯·æ±‚ï¼Œè§£æ <code>Authorization</code> å¤´ä¸­çš„ <code>Access Token</code>ï¼Œè°ƒç”¨è®¤è¯ä¸­å¿ƒæˆ–è‡ªè¡ŒéªŒè¯ Token çš„æœ‰æ•ˆæ€§ã€‚éªŒè¯é€šè¿‡åï¼Œå¯ä»¥å°†è§£æå‡ºçš„ç”¨æˆ·ä¿¡æ¯ï¼ˆå¦‚ç”¨æˆ·IDï¼‰é™„åŠ åˆ°è¯·æ±‚å¤´ä¸­ï¼Œå†è½¬å‘ç»™åç«¯çš„ä¸šåŠ¡å¾®æœåŠ¡ã€‚</li><li><strong>ä¸šåŠ¡å¾®æœåŠ¡</strong>: ä¸šåŠ¡å¾®æœåŠ¡æœ¬èº«<strong>ä¸å†å…³å¿ƒ Token çš„éªŒè¯ç»†èŠ‚</strong>ï¼Œå®ƒä»¬ä¿¡ä»»æ¥è‡ªç½‘å…³çš„è¯·æ±‚ï¼Œç›´æ¥ä»è¯·æ±‚å¤´ä¸­è·å–ç”¨æˆ·ä¿¡æ¯è¿›è¡Œä¸šåŠ¡å¤„ç†ï¼Œå®ç°äº†ä¸šåŠ¡ä¸è®¤è¯çš„è§£è€¦ã€‚</li><li><strong>æµç¨‹</strong>:<ol><li>Web&#x2F;App å®¢æˆ·ç«¯å¼•å¯¼ç”¨æˆ·åˆ°è®¤è¯ä¸­å¿ƒè¿›è¡Œç™»å½•ã€‚</li><li>ç™»å½•æˆåŠŸåï¼Œè®¤è¯ä¸­å¿ƒè¿”å› <code>Access Token</code> å’Œ <code>Refresh Token</code>ã€‚</li><li>å®¢æˆ·ç«¯ä¿å­˜ä»¤ç‰Œï¼Œåç»­è®¿é—®ä¸šåŠ¡ API æ—¶ï¼Œåœ¨è¯·æ±‚å¤´æºå¸¦ <code>Access Token</code>ã€‚</li><li>API ç½‘å…³æ‹¦æˆªè¯·æ±‚ï¼ŒéªŒè¯ <code>Access Token</code>ã€‚</li><li><code>Access Token</code> è¿‡æœŸåï¼Œå®¢æˆ·ç«¯ä½¿ç”¨ <code>Refresh Token</code> å‘è®¤è¯ä¸­å¿ƒç”³è¯·æ–°ä»¤ç‰Œã€‚</li></ol></li><li>è¿™ä¸ªæ¶æ„å…·æœ‰é«˜å†…èšã€ä½è€¦åˆã€å¯æ‰©å±•æ€§å¼ºã€å®‰å…¨æ€§é«˜çš„ä¼˜ç‚¹ã€‚</li></ul></li></ul></li></ul><h1 id="Redis-è¯¦ç»†æŠ€æœ¯è§£æ"><a href="#Redis-è¯¦ç»†æŠ€æœ¯è§£æ" class="headerlink" title="Redis è¯¦ç»†æŠ€æœ¯è§£æ"></a>Redis è¯¦ç»†æŠ€æœ¯è§£æ</h1><h2 id="Redis-æ ¸å¿ƒæ¶æ„ä¸åŸç†"><a href="#Redis-æ ¸å¿ƒæ¶æ„ä¸åŸç†" class="headerlink" title="Redis æ ¸å¿ƒæ¶æ„ä¸åŸç†"></a>Redis æ ¸å¿ƒæ¶æ„ä¸åŸç†</h2><h3 id="å†…å­˜æ¨¡å‹ä¸æ•°æ®ç»“æ„"><a href="#å†…å­˜æ¨¡å‹ä¸æ•°æ®ç»“æ„" class="headerlink" title="å†…å­˜æ¨¡å‹ä¸æ•°æ®ç»“æ„"></a>å†…å­˜æ¨¡å‹ä¸æ•°æ®ç»“æ„</h3><p>Redisé‡‡ç”¨åŸºäºå†…å­˜çš„å­˜å‚¨æ¶æ„ï¼Œæ‰€æœ‰æ•°æ®éƒ½ä¿å­˜åœ¨RAMä¸­ï¼Œè¿™æ˜¯å…¶é«˜æ€§èƒ½çš„æ ¹æœ¬åŸå› ã€‚Redisä½¿ç”¨äº†å¤šç§åº•å±‚æ•°æ®ç»“æ„æ¥å®ç°ä¸Šå±‚çš„æŠ½è±¡æ•°æ®ç±»å‹ï¼š</p><p><strong>SDSï¼ˆSimple Dynamic Stringï¼‰</strong> Redisæ²¡æœ‰ç›´æ¥ä½¿ç”¨Cè¯­è¨€çš„å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯æ„å»ºäº†SDSã€‚SDSåœ¨å­—ç¬¦ä¸²å¤´éƒ¨è®°å½•äº†é•¿åº¦ä¿¡æ¯ï¼Œé¿å…äº†strlençš„O(n)å¤æ‚åº¦ï¼ŒåŒæ—¶é¢„åˆ†é…ç©ºé—´å‡å°‘å†…å­˜é‡åˆ†é…æ¬¡æ•°ã€‚</p><p><strong>è·³è·ƒè¡¨ï¼ˆSkip Listï¼‰</strong> æœ‰åºé›†åˆçš„åº•å±‚å®ç°ä¹‹ä¸€ï¼Œæ˜¯ä¸€ç§éšæœºåŒ–çš„æ•°æ®ç»“æ„ï¼Œé€šè¿‡å¤šå±‚é“¾è¡¨å®ç°O(log N)çš„æŸ¥æ‰¾å¤æ‚åº¦ã€‚ç›¸æ¯”çº¢é»‘æ ‘ï¼Œè·³è·ƒè¡¨å®ç°æ›´ç®€å•ï¼Œä¸”æ”¯æŒèŒƒå›´æŸ¥è¯¢ã€‚</p><p><strong>å‹ç¼©åˆ—è¡¨ï¼ˆZiplistï¼‰</strong> å½“å“ˆå¸Œã€åˆ—è¡¨ã€æœ‰åºé›†åˆå…ƒç´ è¾ƒå°‘æ—¶ä½¿ç”¨çš„ç´§å‡‘å­˜å‚¨ç»“æ„ï¼Œæ‰€æœ‰å…ƒç´ å­˜å‚¨åœ¨ä¸€å—è¿ç»­å†…å­˜ä¸­ï¼ŒèŠ‚çœå†…å­˜ä½†æ’å…¥åˆ é™¤æ•ˆç‡è¾ƒä½ã€‚</p><p><strong>å­—å…¸ï¼ˆDictï¼‰</strong> Redisçš„æ ¸å¿ƒæ•°æ®ç»“æ„ï¼Œä½¿ç”¨å¼€æ”¾å¯»å€æ³•è§£å†³å“ˆå¸Œå†²çªï¼Œæ”¯æŒæ¸è¿›å¼rehashã€‚å½“è´Ÿè½½å› å­è¿‡é«˜æ—¶ï¼Œä¼šåˆ›å»ºæ–°çš„å“ˆå¸Œè¡¨å¹¶é€æ­¥è¿ç§»æ•°æ®ã€‚</p><h3 id="å•çº¿ç¨‹æ¨¡å‹ä¸äº‹ä»¶å¾ªç¯"><a href="#å•çº¿ç¨‹æ¨¡å‹ä¸äº‹ä»¶å¾ªç¯" class="headerlink" title="å•çº¿ç¨‹æ¨¡å‹ä¸äº‹ä»¶å¾ªç¯"></a>å•çº¿ç¨‹æ¨¡å‹ä¸äº‹ä»¶å¾ªç¯</h3><p>Redis 6.0ä¹‹å‰é‡‡ç”¨å•çº¿ç¨‹æ¨¡å‹å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ï¼Œé€šè¿‡I&#x2F;Oå¤šè·¯å¤ç”¨ï¼ˆepoll&#x2F;kqueueï¼‰å®ç°é«˜å¹¶å‘ã€‚å•çº¿ç¨‹é¿å…äº†çº¿ç¨‹åˆ‡æ¢å¼€é”€å’Œå¹¶å‘æ§åˆ¶é—®é¢˜ï¼Œä½†ä¹Ÿé™åˆ¶äº†CPUåˆ©ç”¨ç‡ã€‚</p><p><strong>äº‹ä»¶å¾ªç¯æœºåˆ¶</strong> Redisä½¿ç”¨Reactoræ¨¡å¼çš„äº‹ä»¶å¾ªç¯ï¼Œåˆ†ä¸ºæ–‡ä»¶äº‹ä»¶å’Œæ—¶é—´äº‹ä»¶ï¼š</p><ul><li>æ–‡ä»¶äº‹ä»¶ï¼šå¤„ç†å®¢æˆ·ç«¯è¿æ¥ã€è¯»å†™è¯·æ±‚</li><li>æ—¶é—´äº‹ä»¶ï¼šå¤„ç†å®šæ—¶ä»»åŠ¡ï¼Œå¦‚è¿‡æœŸé”®åˆ é™¤ã€æŒä¹…åŒ–ç­‰</li></ul><p>Redis 6.0å¼•å…¥äº†å¤šçº¿ç¨‹I&#x2F;Oï¼Œä½†å‘½ä»¤æ‰§è¡Œä»æ˜¯å•çº¿ç¨‹ï¼Œå¤šçº¿ç¨‹åªç”¨äºç½‘ç»œI&#x2F;Oæ“ä½œçš„è¯»å†™ï¼Œè¿™æ ·æ—¢æé«˜äº†ç½‘ç»œå¤„ç†èƒ½åŠ›ï¼Œåˆä¿æŒäº†æ•°æ®æ“ä½œçš„åŸå­æ€§ã€‚</p><h2 id="æ•°æ®ç±»å‹è¯¦è§£ä¸åº”ç”¨åœºæ™¯"><a href="#æ•°æ®ç±»å‹è¯¦è§£ä¸åº”ç”¨åœºæ™¯" class="headerlink" title="æ•°æ®ç±»å‹è¯¦è§£ä¸åº”ç”¨åœºæ™¯"></a>æ•°æ®ç±»å‹è¯¦è§£ä¸åº”ç”¨åœºæ™¯</h2><h3 id="Stringç±»å‹"><a href="#Stringç±»å‹" class="headerlink" title="Stringç±»å‹"></a>Stringç±»å‹</h3><p>Stringæ˜¯Redisæœ€åŸºç¡€çš„æ•°æ®ç±»å‹ï¼Œåº•å±‚å¯ä»¥æ˜¯SDSã€æ•´æ•°æˆ–æµ®ç‚¹æ•°ã€‚</p><p><strong>å¸¸ç”¨å‘½ä»¤</strong>ï¼šSETã€GETã€INCRã€DECRã€APPENDã€GETRANGE <strong>åº”ç”¨åœºæ™¯</strong>ï¼š</p><ul><li>ç¼“å­˜ï¼šå­˜å‚¨ç”¨æˆ·ä¼šè¯ã€é…ç½®ä¿¡æ¯</li><li>è®¡æ•°å™¨ï¼šç½‘ç«™è®¿é—®é‡ã€ç‚¹èµæ•°ï¼ˆINCRåŸå­æ€§ä¿è¯ï¼‰</li><li>åˆ†å¸ƒå¼é”ï¼šSET key value NX EX seconds</li><li>é™æµï¼šç»“åˆEXPIREå®ç°æ»‘åŠ¨çª—å£é™æµ</li></ul><h3 id="Hashç±»å‹"><a href="#Hashç±»å‹" class="headerlink" title="Hashç±»å‹"></a>Hashç±»å‹</h3><p>Hashç±»å‹é€‚åˆå­˜å‚¨å¯¹è±¡ï¼Œé¿å…äº†å°†å¯¹è±¡åºåˆ—åŒ–ä¸ºJSONå­—ç¬¦ä¸²çš„å¼€é”€ã€‚</p><p><strong>åº•å±‚å®ç°</strong>ï¼šå…ƒç´ è¾ƒå°‘æ—¶ä½¿ç”¨ziplistï¼Œå…ƒç´ è¾ƒå¤šæ—¶ä½¿ç”¨hashtable <strong>åº”ç”¨åœºæ™¯</strong>ï¼š</p><ul><li>å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ï¼šHSET user:1001 name â€œå¼ ä¸‰â€ age 25</li><li>è´­ç‰©è½¦ï¼šHSET cart:1001 product:123 2</li><li>é…ç½®ç®¡ç†ï¼šåˆ†ç±»å­˜å‚¨ä¸åŒæ¨¡å—çš„é…ç½®</li></ul><h3 id="Listç±»å‹"><a href="#Listç±»å‹" class="headerlink" title="Listç±»å‹"></a>Listç±»å‹</h3><p>Listæ˜¯åŒå‘é“¾è¡¨å®ç°ï¼Œæ”¯æŒåœ¨ä¸¤ç«¯è¿›è¡ŒO(1)çš„æ’å…¥å’Œåˆ é™¤æ“ä½œã€‚</p><p><strong>å¸¸ç”¨å‘½ä»¤</strong>ï¼šLPUSHã€RPUSHã€LPOPã€RPOPã€LRANGEã€BLPOP <strong>åº”ç”¨åœºæ™¯</strong>ï¼š</p><ul><li>æ¶ˆæ¯é˜Ÿåˆ—ï¼šç”Ÿäº§è€…LPUSHï¼Œæ¶ˆè´¹è€…BRPOPå®ç°é˜»å¡é˜Ÿåˆ—</li><li>æœ€æ–°åˆ—è¡¨ï¼šæœ‹å‹åœˆåŠ¨æ€ã€å•†å“è¯„è®º</li><li>æ ˆå’Œé˜Ÿåˆ—ï¼šLPUSH+LPOPå®ç°æ ˆï¼ŒLPUSH+RPOPå®ç°é˜Ÿåˆ—</li></ul><h3 id="Setç±»å‹"><a href="#Setç±»å‹" class="headerlink" title="Setç±»å‹"></a>Setç±»å‹</h3><p>Setæ˜¯æ— åºé›†åˆï¼Œå…ƒç´ å”¯ä¸€ï¼Œåº•å±‚ä½¿ç”¨hashtableæˆ–intsetå®ç°ã€‚</p><p><strong>é›†åˆè¿ç®—</strong>ï¼šSINTERï¼ˆäº¤é›†ï¼‰ã€SUNIONï¼ˆå¹¶é›†ï¼‰ã€SDIFFï¼ˆå·®é›†ï¼‰ <strong>åº”ç”¨åœºæ™¯</strong>ï¼š</p><ul><li>å»é‡ï¼šç»Ÿè®¡ç½‘ç«™ç‹¬ç«‹è®¿å®¢</li><li>ç¤¾äº¤å…³ç³»ï¼šå…±åŒå¥½å‹ã€æ¨èç”¨æˆ·</li><li>æ ‡ç­¾ç³»ç»Ÿï¼šç”¨æˆ·æ ‡ç­¾ã€æ–‡ç« åˆ†ç±»</li><li>æŠ½å¥–ç³»ç»Ÿï¼šSRANDMEMBERéšæœºæŠ½å–</li></ul><h3 id="Sorted-Setç±»å‹"><a href="#Sorted-Setç±»å‹" class="headerlink" title="Sorted Setç±»å‹"></a>Sorted Setç±»å‹</h3><p>æœ‰åºé›†åˆï¼Œæ¯ä¸ªå…ƒç´ å…³è”ä¸€ä¸ªåˆ†æ•°ï¼ŒæŒ‰åˆ†æ•°æ’åºã€‚åº•å±‚ä½¿ç”¨è·³è·ƒè¡¨å’Œå“ˆå¸Œè¡¨ã€‚</p><p><strong>åº”ç”¨åœºæ™¯</strong>ï¼š</p><ul><li>æ’è¡Œæ¦œï¼šæ¸¸æˆç§¯åˆ†ã€çƒ­æœæ¦œ</li><li>å»¶æ—¶é˜Ÿåˆ—ï¼šåˆ†æ•°ä¸ºæ‰§è¡Œæ—¶é—´æˆ³</li><li>èŒƒå›´æŸ¥è¯¢ï¼šæŒ‰æ—¶é—´ã€æŒ‰åˆ†æ•°èŒƒå›´è·å–æ•°æ®</li></ul><h2 id="æŒä¹…åŒ–æœºåˆ¶æ·±åº¦è§£æ"><a href="#æŒä¹…åŒ–æœºåˆ¶æ·±åº¦è§£æ" class="headerlink" title="æŒä¹…åŒ–æœºåˆ¶æ·±åº¦è§£æ"></a>æŒä¹…åŒ–æœºåˆ¶æ·±åº¦è§£æ</h2><h3 id="RDBæŒä¹…åŒ–"><a href="#RDBæŒä¹…åŒ–" class="headerlink" title="RDBæŒä¹…åŒ–"></a>RDBæŒä¹…åŒ–</h3><p>RDBé€šè¿‡forkå­è¿›ç¨‹ï¼Œå°†å†…å­˜æ•°æ®å¿«ç…§å†™å…¥ç£ç›˜ã€‚</p><p><strong>ä¼˜ç‚¹</strong>ï¼š</p><ul><li>æ–‡ä»¶ç´§å‡‘ï¼Œé€‚åˆå¤‡ä»½å’Œç¾éš¾æ¢å¤</li><li>æ¢å¤é€Ÿåº¦å¿«</li><li>å¯¹Redisæ€§èƒ½å½±å“å°ï¼ˆå­è¿›ç¨‹æ“ä½œï¼‰</li></ul><p><strong>ç¼ºç‚¹</strong>ï¼š</p><ul><li>æ•°æ®ä¸¢å¤±é£é™©ï¼šä¸¤æ¬¡å¿«ç…§é—´çš„æ•°æ®å¯èƒ½ä¸¢å¤±</li><li>forkè¿‡ç¨‹ä¼šé˜»å¡ä¸»è¿›ç¨‹</li><li>å¤§æ•°æ®é›†forkè€—æ—¶è¾ƒé•¿</li></ul><p><strong>è§¦å‘æ¡ä»¶</strong>ï¼š</p><ul><li>æ‰‹åŠ¨æ‰§è¡ŒSAVEæˆ–BGSAVEå‘½ä»¤</li><li>é…ç½®è‡ªåŠ¨è§¦å‘ï¼šsave 900 1ï¼ˆ900ç§’å†…è‡³å°‘1ä¸ªé”®æ”¹å˜ï¼‰</li><li>ä¸»ä»å¤åˆ¶æ—¶è‡ªåŠ¨ç”ŸæˆRDB</li></ul><h3 id="AOFæŒä¹…åŒ–"><a href="#AOFæŒä¹…åŒ–" class="headerlink" title="AOFæŒä¹…åŒ–"></a>AOFæŒä¹…åŒ–</h3><p>AOFè®°å½•æ¯ä¸ªå†™å‘½ä»¤ï¼Œé€šè¿‡é‡æ”¾å‘½ä»¤æ¢å¤æ•°æ®ã€‚</p><p><strong>å†™å…¥æ—¶æœº</strong>ï¼š</p><ul><li>alwaysï¼šæ¯ä¸ªå†™å‘½ä»¤ç«‹å³åŒæ­¥ï¼Œå®‰å…¨ä½†æ€§èƒ½ä½</li><li>everysecï¼šæ¯ç§’åŒæ­¥ä¸€æ¬¡ï¼Œå¹³è¡¡å®‰å…¨æ€§å’Œæ€§èƒ½</li><li>noï¼šç”±æ“ä½œç³»ç»Ÿå†³å®šåŒæ­¥æ—¶æœºï¼Œæ€§èƒ½é«˜ä½†å®‰å…¨æ€§ä½</li></ul><p><strong>AOFé‡å†™</strong>ï¼š AOFæ–‡ä»¶ä¼šè¶Šæ¥è¶Šå¤§ï¼ŒRedisæä¾›é‡å†™æœºåˆ¶ä¼˜åŒ–ï¼š</p><ul><li>éå†å†…å­˜æ•°æ®ï¼Œç”¨æœ€å°‘å‘½ä»¤é‡å»ºAOFæ–‡ä»¶</li><li>é‡å†™æœŸé—´çš„æ–°å‘½ä»¤å†™å…¥AOFé‡å†™ç¼“å†²åŒº</li><li>åŸå­æ€§æ›¿æ¢æ—§AOFæ–‡ä»¶</li></ul><p><strong>æ··åˆæŒä¹…åŒ–</strong>ï¼š Redis 4.0å¼•å…¥RDB+AOFæ··åˆæ¨¡å¼ï¼Œé‡å†™æ—¶ä»¥RDBæ ¼å¼å†™å…¥åŸºç¡€æ•°æ®ï¼Œå¢é‡å‘½ä»¤ä»¥AOFæ ¼å¼è¿½åŠ ï¼Œå…¼é¡¾äº†æ¢å¤é€Ÿåº¦å’Œæ•°æ®å®‰å…¨ã€‚</p><h2 id="ç¼“å­˜é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ"><a href="#ç¼“å­˜é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ" class="headerlink" title="ç¼“å­˜é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ"></a>ç¼“å­˜é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</h2><h3 id="ç¼“å­˜ç©¿é€"><a href="#ç¼“å­˜ç©¿é€" class="headerlink" title="ç¼“å­˜ç©¿é€"></a>ç¼“å­˜ç©¿é€</h3><p>æŸ¥è¯¢ä¸å­˜åœ¨çš„æ•°æ®ï¼Œç¼“å­˜æ— æ³•ç”Ÿæ•ˆï¼Œè¯·æ±‚ç›´è¾¾æ•°æ®åº“ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><ol><li><strong>ç©ºå€¼ç¼“å­˜</strong>ï¼šæŸ¥è¯¢ç»“æœä¸ºç©ºæ—¶ä¹Ÿç¼“å­˜ï¼Œè®¾ç½®è¾ƒçŸ­è¿‡æœŸæ—¶é—´</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if (data == null) &#123;</span><br><span class="line">    redis.setex(key, 60, &quot;null&quot;);  // ç¼“å­˜ç©ºå€¼60ç§’</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li><strong>å¸ƒéš†è¿‡æ»¤å™¨</strong>ï¼šé¢„å…ˆå°†æ‰€æœ‰å¯èƒ½å­˜åœ¨çš„æ•°æ®å“ˆå¸Œåˆ°ä½æ•°ç»„</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">BloomFilter&lt;String&gt; filter = BloomFilter.create(Funnels.stringFunnel(Charset.defaultCharset()), 1000000, 0.01);</span><br><span class="line">// æŸ¥è¯¢å‰å…ˆæ£€æŸ¥å¸ƒéš†è¿‡æ»¤å™¨</span><br><span class="line">if (!filter.mightContain(key)) &#123;</span><br><span class="line">    return null;  // ä¸€å®šä¸å­˜åœ¨</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li><strong>å‚æ•°æ ¡éªŒ</strong>ï¼šåœ¨APIå±‚é¢è¿›è¡Œå‚æ•°åˆæ³•æ€§æ ¡éªŒ</li></ol><h3 id="ç¼“å­˜å‡»ç©¿"><a href="#ç¼“å­˜å‡»ç©¿" class="headerlink" title="ç¼“å­˜å‡»ç©¿"></a>ç¼“å­˜å‡»ç©¿</h3><p>çƒ­ç‚¹æ•°æ®è¿‡æœŸç¬é—´ï¼Œå¤§é‡å¹¶å‘è¯·æ±‚å‡»ç©¿ç¼“å­˜ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><ol><li><strong>äº’æ–¥é”</strong>ï¼šåªå…è®¸ä¸€ä¸ªçº¿ç¨‹æŸ¥è¯¢æ•°æ®åº“å¹¶é‡å»ºç¼“å­˜</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">public String getData(String key) &#123;</span><br><span class="line">    String data = redis.get(key);</span><br><span class="line">    if (data == null) &#123;</span><br><span class="line">        String lockKey = &quot;lock:&quot; + key;</span><br><span class="line">        if (redis.setnx(lockKey, &quot;1&quot;, 10)) &#123;  // è·å–é”</span><br><span class="line">            try &#123;</span><br><span class="line">                data = database.query(key);  // æŸ¥è¯¢æ•°æ®åº“</span><br><span class="line">                redis.setex(key, 3600, data);  // é‡å»ºç¼“å­˜</span><br><span class="line">            &#125; finally &#123;</span><br><span class="line">                redis.del(lockKey);  // é‡Šæ”¾é”</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            Thread.sleep(50);  // ç­‰å¾…å…¶ä»–çº¿ç¨‹é‡å»ºç¼“å­˜</span><br><span class="line">            return getData(key);  // é€’å½’é‡è¯•</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li><strong>çƒ­ç‚¹æ•°æ®æ°¸ä¸è¿‡æœŸ</strong>ï¼šé€»è¾‘ä¸Šè®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œç‰©ç†ä¸Šä¸è¿‡æœŸï¼Œå¼‚æ­¥æ›´æ–°</li><li><strong>é¢„çƒ­æœºåˆ¶</strong>ï¼šç³»ç»Ÿå¯åŠ¨æ—¶é¢„å…ˆåŠ è½½çƒ­ç‚¹æ•°æ®</li><li><strong>äºŒçº§ç¼“å­˜</strong>ï¼šL1ç¼“å­˜è¿‡æœŸåï¼Œå…ˆè¿”å›L2ç¼“å­˜æ•°æ®ï¼Œå¼‚æ­¥æ›´æ–°L1</li></ol><h3 id="ç¼“å­˜é›ªå´©"><a href="#ç¼“å­˜é›ªå´©" class="headerlink" title="ç¼“å­˜é›ªå´©"></a>ç¼“å­˜é›ªå´©</h3><p>å¤§é‡ç¼“å­˜åŒæ—¶è¿‡æœŸæˆ–Rediså®•æœºï¼Œè¯·æ±‚æ¶Œå‘æ•°æ®åº“ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><ol><li><strong>è¿‡æœŸæ—¶é—´éšæœºåŒ–</strong>ï¼šé¿å…åŒæ—¶è¿‡æœŸ</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">int randomExpire = baseExpire + new Random().nextInt(300);  // åŸºç¡€æ—¶é—´+éšæœºæ—¶é—´</span><br><span class="line">redis.setex(key, randomExpire, data);</span><br></pre></td></tr></table></figure><ol><li><strong>å¤šçº§ç¼“å­˜æ¶æ„</strong>ï¼š<ul><li>L1ï¼šæœ¬åœ°ç¼“å­˜ï¼ˆå¦‚Caffeineï¼‰</li><li>L2ï¼šRedisåˆ†å¸ƒå¼ç¼“å­˜</li><li>L3ï¼šæ•°æ®åº“</li></ul></li><li><strong>é™æµé™çº§</strong>ï¼šä½¿ç”¨Sentinelã€Hystrixç­‰ç»„ä»¶</li><li><strong>Redisé«˜å¯ç”¨</strong>ï¼šä¸»ä»å¤åˆ¶ã€å“¨å…µæ¨¡å¼ã€é›†ç¾¤éƒ¨ç½²</li></ol><h3 id="ç¼“å­˜é¢„çƒ­"><a href="#ç¼“å­˜é¢„çƒ­" class="headerlink" title="ç¼“å­˜é¢„çƒ­"></a>ç¼“å­˜é¢„çƒ­</h3><p>ç³»ç»Ÿå¯åŠ¨æ—¶é¢„å…ˆåŠ è½½çƒ­ç‚¹æ•°æ®åˆ°ç¼“å­˜ã€‚</p><p><strong>å®ç°æ–¹å¼</strong>ï¼š</p><ol><li><strong>å®šæ—¶ä»»åŠ¡é¢„çƒ­</strong>ï¼šå‡Œæ™¨ä½å³°æœŸæ‰§è¡Œ</li><li><strong>æ‰‹åŠ¨é¢„çƒ­</strong>ï¼šç®¡ç†åå°è§¦å‘é¢„çƒ­ä»»åŠ¡</li><li><strong>å®æ—¶é¢„çƒ­</strong>ï¼šç›‘æ§ç³»ç»Ÿå‘ç°çƒ­ç‚¹æ•°æ®è‡ªåŠ¨é¢„çƒ­</li></ol><h2 id="æ•°æ®ä¸€è‡´æ€§ä¿è¯"><a href="#æ•°æ®ä¸€è‡´æ€§ä¿è¯" class="headerlink" title="æ•°æ®ä¸€è‡´æ€§ä¿è¯"></a>æ•°æ®ä¸€è‡´æ€§ä¿è¯</h2><h3 id="Cache-Asideæ¨¡å¼ï¼ˆæ—è·¯ç¼“å­˜ï¼‰"><a href="#Cache-Asideæ¨¡å¼ï¼ˆæ—è·¯ç¼“å­˜ï¼‰" class="headerlink" title="Cache Asideæ¨¡å¼ï¼ˆæ—è·¯ç¼“å­˜ï¼‰"></a>Cache Asideæ¨¡å¼ï¼ˆæ—è·¯ç¼“å­˜ï¼‰</h3><p>åº”ç”¨ç¨‹åºè´Ÿè´£ç»´æŠ¤ç¼“å­˜å’Œæ•°æ®åº“çš„ä¸€è‡´æ€§ã€‚</p><p><strong>è¯»æ“ä½œ</strong>ï¼š</p><ol><li>å…ˆè¯»ç¼“å­˜ï¼Œå‘½ä¸­åˆ™è¿”å›</li><li>ç¼“å­˜ä¸å‘½ä¸­ï¼ŒæŸ¥è¯¢æ•°æ®åº“</li><li>å°†æ•°æ®å†™å…¥ç¼“å­˜å¹¶è¿”å›</li></ol><p><strong>å†™æ“ä½œ</strong>ï¼š</p><ol><li>å…ˆæ›´æ–°æ•°æ®åº“</li><li>åˆ é™¤ç¼“å­˜ï¼ˆè®©ä¸‹æ¬¡è¯»å–æ—¶é‡æ–°åŠ è½½ï¼‰</li></ol><p><strong>ä¸ºä»€ä¹ˆæ˜¯åˆ é™¤è€Œä¸æ˜¯æ›´æ–°ç¼“å­˜ï¼Ÿ</strong></p><ul><li>æ›´æ–°ç¼“å­˜å¯èƒ½å­˜åœ¨å¹¶å‘é—®é¢˜</li><li>å¤æ‚æŸ¥è¯¢çš„ç¼“å­˜æ›´æ–°æˆæœ¬é«˜</li><li>åˆ é™¤ç¼“å­˜æ›´ç®€å•å¯é </li></ul><h3 id="å»¶æ—¶åŒåˆ ç­–ç•¥"><a href="#å»¶æ—¶åŒåˆ ç­–ç•¥" class="headerlink" title="å»¶æ—¶åŒåˆ ç­–ç•¥"></a>å»¶æ—¶åŒåˆ ç­–ç•¥</h3><p>è§£å†³è¯»å†™å¹¶å‘å¯¼è‡´çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜ã€‚</p><p><strong>å®ç°æ­¥éª¤</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">public void updateData(String key, Object data) &#123;</span><br><span class="line">    // 1. åˆ é™¤ç¼“å­˜</span><br><span class="line">    redis.del(key);</span><br><span class="line">    </span><br><span class="line">    // 2. æ›´æ–°æ•°æ®åº“</span><br><span class="line">    database.update(data);</span><br><span class="line">    </span><br><span class="line">    // 3. å»¶æ—¶åˆ é™¤ç¼“å­˜ï¼ˆå¼‚æ­¥ï¼‰</span><br><span class="line">    CompletableFuture.runAsync(() -&gt; &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            Thread.sleep(500);  // å»¶æ—¶500ms</span><br><span class="line">            redis.del(key);     // å†æ¬¡åˆ é™¤ç¼“å­˜</span><br><span class="line">        &#125; catch (InterruptedException e) &#123;</span><br><span class="line">            log.error(&quot;å»¶æ—¶åˆ é™¤ç¼“å­˜å¤±è´¥&quot;, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å»¶æ—¶æ—¶é—´è®¾ç½®</strong>ï¼šé€šå¸¸ä¸ºä¸»ä»åŒæ­¥æ—¶é—´ + è¯»æ•°æ®åº“æ—¶é—´ + å‡ åæ¯«ç§’</p><h3 id="åŸºäºæ¶ˆæ¯é˜Ÿåˆ—çš„æœ€ç»ˆä¸€è‡´æ€§"><a href="#åŸºäºæ¶ˆæ¯é˜Ÿåˆ—çš„æœ€ç»ˆä¸€è‡´æ€§" class="headerlink" title="åŸºäºæ¶ˆæ¯é˜Ÿåˆ—çš„æœ€ç»ˆä¸€è‡´æ€§"></a>åŸºäºæ¶ˆæ¯é˜Ÿåˆ—çš„æœ€ç»ˆä¸€è‡´æ€§</h3><p>ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—å¼‚æ­¥å¤„ç†ç¼“å­˜æ›´æ–°ï¼Œä¿è¯æœ€ç»ˆä¸€è‡´æ€§ã€‚</p><p><strong>å®ç°æµç¨‹</strong>ï¼š</p><ol><li>æ›´æ–°æ•°æ®åº“ï¼Œå‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—</li><li>æ¶ˆæ¯æ¶ˆè´¹è€…åˆ é™¤ç›¸å…³ç¼“å­˜</li><li>æ¶ˆè´¹å¤±è´¥æ—¶é‡è¯•ï¼Œä¿è¯æœ€ç»ˆä¸€è‡´æ€§</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// å‘é€ç¼“å­˜åˆ é™¤æ¶ˆæ¯</span><br><span class="line">@Transactional</span><br><span class="line">public void updateUser(User user) &#123;</span><br><span class="line">    userDao.update(user);  // æ›´æ–°æ•°æ®åº“</span><br><span class="line">    </span><br><span class="line">    // å‘é€ç¼“å­˜åˆ é™¤æ¶ˆæ¯ï¼ˆäº‹åŠ¡æäº¤åå‘é€ï¼‰</span><br><span class="line">    TransactionSynchronizationManager.registerSynchronization(</span><br><span class="line">        new TransactionSynchronizationAdapter() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void afterCommit() &#123;</span><br><span class="line">                cacheDeleteMQ.send(&quot;user:&quot; + user.getId());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åˆ†å¸ƒå¼äº‹åŠ¡æ–¹æ¡ˆ"><a href="#åˆ†å¸ƒå¼äº‹åŠ¡æ–¹æ¡ˆ" class="headerlink" title="åˆ†å¸ƒå¼äº‹åŠ¡æ–¹æ¡ˆ"></a>åˆ†å¸ƒå¼äº‹åŠ¡æ–¹æ¡ˆ</h3><p>å¯¹äºå¼ºä¸€è‡´æ€§è¦æ±‚é«˜çš„åœºæ™¯ï¼Œå¯ä»¥ä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡ã€‚</p><p><strong>2PCï¼ˆä¸¤é˜¶æ®µæäº¤ï¼‰</strong>ï¼š</p><ul><li>å‡†å¤‡é˜¶æ®µï¼šåè°ƒè€…è¯¢é—®å‚ä¸è€…æ˜¯å¦å‡†å¤‡å¥½</li><li>æäº¤é˜¶æ®µï¼šæ‰€æœ‰å‚ä¸è€…éƒ½å‡†å¤‡å¥½åˆ™æäº¤ï¼Œå¦åˆ™å›æ»š</li></ul><p><strong>TCCï¼ˆTry-Confirm-Cancelï¼‰</strong>ï¼š</p><ul><li>Tryï¼šå°è¯•æ‰§è¡Œï¼Œé¢„ç•™èµ„æº</li><li>Confirmï¼šç¡®è®¤æäº¤</li><li>Cancelï¼šå–æ¶ˆæ‰§è¡Œï¼Œé‡Šæ”¾èµ„æº</li></ul><h2 id="åˆ†å¸ƒå¼é”å®ç°"><a href="#åˆ†å¸ƒå¼é”å®ç°" class="headerlink" title="åˆ†å¸ƒå¼é”å®ç°"></a>åˆ†å¸ƒå¼é”å®ç°</h2><h3 id="åŸºäºSETå‘½ä»¤çš„åˆ†å¸ƒå¼é”"><a href="#åŸºäºSETå‘½ä»¤çš„åˆ†å¸ƒå¼é”" class="headerlink" title="åŸºäºSETå‘½ä»¤çš„åˆ†å¸ƒå¼é”"></a>åŸºäºSETå‘½ä»¤çš„åˆ†å¸ƒå¼é”</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">public class RedisDistributedLock &#123;</span><br><span class="line">    private Jedis jedis;</span><br><span class="line">    </span><br><span class="line">    public boolean tryLock(String lockKey, String requestId, int expireTime) &#123;</span><br><span class="line">        String result = jedis.set(lockKey, requestId, &quot;NX&quot;, &quot;PX&quot;, expireTime);</span><br><span class="line">        return &quot;OK&quot;.equals(result);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public boolean releaseLock(String lockKey, String requestId) &#123;</span><br><span class="line">        String script = &quot;if redis.call(&#x27;get&#x27;, KEYS[1]) == ARGV[1] then &quot; +</span><br><span class="line">                       &quot;return redis.call(&#x27;del&#x27;, KEYS[1]) else return 0 end&quot;;</span><br><span class="line">        Object result = jedis.eval(script, Collections.singletonList(lockKey),</span><br><span class="line">                                 Collections.singletonList(requestId));</span><br><span class="line">        return &quot;1&quot;.equals(result.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä½¿ç”¨æ–¹å¼</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">String lockKey = &quot;lock:user:1001&quot;;</span><br><span class="line">String requestId = UUID.randomUUID().toString();</span><br><span class="line"></span><br><span class="line">if (tryLock(lockKey, requestId, 30000)) &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">        // æ‰§è¡Œä¸šåŠ¡é€»è¾‘</span><br><span class="line">        doSomething();</span><br><span class="line">    &#125; finally &#123;</span><br><span class="line">        releaseLock(lockKey, requestId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Redlockç®—æ³•"><a href="#Redlockç®—æ³•" class="headerlink" title="Redlockç®—æ³•"></a>Redlockç®—æ³•</h3><p>ä¸ºäº†è§£å†³å•ç‚¹æ•…éšœé—®é¢˜ï¼ŒRediså®˜æ–¹æå‡ºäº†Redlockç®—æ³•ã€‚</p><p><strong>ç®—æ³•æ­¥éª¤</strong>ï¼š</p><ol><li>è·å–å½“å‰æ—¶é—´æˆ³</li><li>ä¾æ¬¡å‘Nä¸ªRediså®ä¾‹ç”³è¯·é”</li><li>å¦‚æœåœ¨å¤§å¤šæ•°å®ä¾‹ï¼ˆN&#x2F;2+1ï¼‰ä¸Šè·å–é”æˆåŠŸï¼Œä¸”æ€»è€—æ—¶å°äºé”è¶…æ—¶æ—¶é—´ï¼Œåˆ™è®¤ä¸ºè·å–é”æˆåŠŸ</li><li>é”çš„æœ‰æ•ˆæ—¶é—´ &#x3D; åˆå§‹æœ‰æ•ˆæ—¶é—´ - è·å–é”æ¶ˆè€—çš„æ—¶é—´</li><li>é‡Šæ”¾é”æ—¶ï¼Œå‘æ‰€æœ‰Rediså®ä¾‹å‘é€é‡Šæ”¾å‘½ä»¤</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">public class Redlock &#123;</span><br><span class="line">    private List&lt;Jedis&gt; jedisInstances;</span><br><span class="line">    </span><br><span class="line">    public boolean lock(String resource, int ttl) &#123;</span><br><span class="line">        int quorum = jedisInstances.size() / 2 + 1;</span><br><span class="line">        int successCount = 0;</span><br><span class="line">        long startTime = System.currentTimeMillis();</span><br><span class="line">        </span><br><span class="line">        for (Jedis jedis : jedisInstances) &#123;</span><br><span class="line">            if (lockInstance(jedis, resource, ttl)) &#123;</span><br><span class="line">                successCount++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        long elapsedTime = System.currentTimeMillis() - startTime;</span><br><span class="line">        if (successCount &gt;= quorum &amp;&amp; elapsedTime &lt; ttl) &#123;</span><br><span class="line">            return true;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            unlock(resource);  // é‡Šæ”¾å·²è·å–çš„é”</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é”çš„é—®é¢˜ä¸ä¼˜åŒ–"><a href="#é”çš„é—®é¢˜ä¸ä¼˜åŒ–" class="headerlink" title="é”çš„é—®é¢˜ä¸ä¼˜åŒ–"></a>é”çš„é—®é¢˜ä¸ä¼˜åŒ–</h3><p><strong>é”è¶…æ—¶é—®é¢˜</strong>ï¼š ä¸šåŠ¡æ‰§è¡Œæ—¶é—´è¶…è¿‡é”è¶…æ—¶æ—¶é—´ï¼Œé”è‡ªåŠ¨é‡Šæ”¾ï¼Œå¯èƒ½å¯¼è‡´å¹¶å‘é—®é¢˜ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><ol><li><strong>çœ‹é—¨ç‹—æœºåˆ¶</strong>ï¼šå®šæ—¶ç»­æœŸé”çš„è¿‡æœŸæ—¶é—´</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public class WatchDog &#123;</span><br><span class="line">    private ScheduledExecutorService scheduler = Executors.newScheduledThreadPool(1);</span><br><span class="line">    </span><br><span class="line">    public void startWatchDog(String lockKey, String requestId) &#123;</span><br><span class="line">        scheduler.scheduleAtFixedRate(() -&gt; &#123;</span><br><span class="line">            // ç»­æœŸé”</span><br><span class="line">            String script = &quot;if redis.call(&#x27;get&#x27;, KEYS[1]) == ARGV[1] then &quot; +</span><br><span class="line">                           &quot;return redis.call(&#x27;expire&#x27;, KEYS[1], ARGV[2]) else return 0 end&quot;;</span><br><span class="line">            jedis.eval(script, Arrays.asList(lockKey), </span><br><span class="line">                      Arrays.asList(requestId, &quot;30&quot;));</span><br><span class="line">        &#125;, 10, 10, TimeUnit.SECONDS);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li><strong>åˆç†è¯„ä¼°ä¸šåŠ¡æ‰§è¡Œæ—¶é—´</strong>ï¼šè®¾ç½®è¶³å¤Ÿçš„é”è¶…æ—¶æ—¶é—´</li></ol><p><strong>é”ç«äº‰æ¿€çƒˆé—®é¢˜</strong>ï¼š å¤§é‡çº¿ç¨‹ç«äº‰åŒä¸€æŠŠé”ï¼Œå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><ol><li><strong>åˆ†æ®µé”</strong>ï¼šå°†èµ„æºåˆ†æ®µï¼Œå‡å°‘é”ç«äº‰</li><li><strong>é˜Ÿåˆ—é”</strong>ï¼šä½¿ç”¨Listå®ç°å…¬å¹³é”</li><li><strong>è‡ªæ—‹é”ä¼˜åŒ–</strong>ï¼šé€‚å½“çš„é€€é¿ç®—æ³•</li></ol><h2 id="æ‚²è§‚é”ä¸ä¹è§‚é”"><a href="#æ‚²è§‚é”ä¸ä¹è§‚é”" class="headerlink" title="æ‚²è§‚é”ä¸ä¹è§‚é”"></a>æ‚²è§‚é”ä¸ä¹è§‚é”</h2><h3 id="æ‚²è§‚é”"><a href="#æ‚²è§‚é”" class="headerlink" title="æ‚²è§‚é”"></a>æ‚²è§‚é”</h3><p>å‡è®¾ä¼šå‘ç”Ÿå¹¶å‘å†²çªï¼Œåœ¨æ“ä½œæ•°æ®å‰å…ˆè·å–é”ã€‚</p><p><strong>Rediså®ç°</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">// ä½¿ç”¨Redisåˆ†å¸ƒå¼é”å®ç°æ‚²è§‚é”</span><br><span class="line">public void updateWithPessimisticLock(String userId, int amount) &#123;</span><br><span class="line">    String lockKey = &quot;lock:account:&quot; + userId;</span><br><span class="line">    String requestId = UUID.randomUUID().toString();</span><br><span class="line">    </span><br><span class="line">    if (tryLock(lockKey, requestId, 30000)) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            // æŸ¥è¯¢è´¦æˆ·ä½™é¢</span><br><span class="line">            int balance = getBalance(userId);</span><br><span class="line">            if (balance &gt;= amount) &#123;</span><br><span class="line">                // æ‰£å‡ä½™é¢</span><br><span class="line">                updateBalance(userId, balance - amount);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                throw new InsufficientBalanceException();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            releaseLock(lockKey, requestId);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        throw new LockAcquisitionException();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¹è§‚é”"><a href="#ä¹è§‚é”" class="headerlink" title="ä¹è§‚é”"></a>ä¹è§‚é”</h3><p>å‡è®¾ä¸ä¼šå‘ç”Ÿå†²çªï¼Œåœ¨æ›´æ–°æ—¶æ£€æŸ¥æ•°æ®æ˜¯å¦è¢«ä¿®æ”¹ã€‚</p><p><strong>åŸºäºç‰ˆæœ¬å·çš„ä¹è§‚é”</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">public boolean updateWithOptimisticLock(String userId, int amount, int expectedVersion) &#123;</span><br><span class="line">    // ä½¿ç”¨Luaè„šæœ¬ä¿è¯åŸå­æ€§</span><br><span class="line">    String script = </span><br><span class="line">        &quot;local current = redis.call(&#x27;hmget&#x27;, KEYS[1], &#x27;balance&#x27;, &#x27;version&#x27;) &quot; +</span><br><span class="line">        &quot;if current[2] == ARGV[2] then &quot; +</span><br><span class="line">        &quot;  if tonumber(current[1]) &gt;= tonumber(ARGV[1]) then &quot; +</span><br><span class="line">        &quot;    redis.call(&#x27;hmset&#x27;, KEYS[1], &#x27;balance&#x27;, current[1] - ARGV[1], &#x27;version&#x27;, current[2] + 1) &quot; +</span><br><span class="line">        &quot;    return 1 &quot; +</span><br><span class="line">        &quot;  else &quot; +</span><br><span class="line">        &quot;    return -1 &quot; +  // ä½™é¢ä¸è¶³</span><br><span class="line">        &quot;  end &quot; +</span><br><span class="line">        &quot;else &quot; +</span><br><span class="line">        &quot;  return 0 &quot; +     // ç‰ˆæœ¬å·ä¸åŒ¹é…</span><br><span class="line">        &quot;end&quot;;</span><br><span class="line">    </span><br><span class="line">    String key = &quot;account:&quot; + userId;</span><br><span class="line">    Object result = jedis.eval(script, Arrays.asList(key), </span><br><span class="line">                              Arrays.asList(String.valueOf(amount), String.valueOf(expectedVersion)));</span><br><span class="line">    </span><br><span class="line">    int code = ((Long) result).intValue();</span><br><span class="line">    if (code == 1) &#123;</span><br><span class="line">        return true;  // æ›´æ–°æˆåŠŸ</span><br><span class="line">    &#125; else if (code == 0) &#123;</span><br><span class="line">        throw new OptimisticLockException(&quot;æ•°æ®å·²è¢«ä¿®æ”¹&quot;);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        throw new InsufficientBalanceException(&quot;ä½™é¢ä¸è¶³&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åŸºäºCASçš„ä¹è§‚é”</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">public void updateWithCAS(String key, Function&lt;String, String&gt; updater) &#123;</span><br><span class="line">    while (true) &#123;</span><br><span class="line">        // 1. è·å–å½“å‰å€¼</span><br><span class="line">        String currentValue = redis.get(key);</span><br><span class="line">        </span><br><span class="line">        // 2. è®¡ç®—æ–°å€¼</span><br><span class="line">        String newValue = updater.apply(currentValue);</span><br><span class="line">        </span><br><span class="line">        // 3. CASæ›´æ–°</span><br><span class="line">        String script = &quot;if redis.call(&#x27;get&#x27;, KEYS[1]) == ARGV[1] then &quot; +</span><br><span class="line">                       &quot;return redis.call(&#x27;set&#x27;, KEYS[1], ARGV[2]) else return nil end&quot;;</span><br><span class="line">        Object result = redis.eval(script, Arrays.asList(key), </span><br><span class="line">                                  Arrays.asList(currentValue, newValue));</span><br><span class="line">        </span><br><span class="line">        if (result != null) &#123;</span><br><span class="line">            break;  // æ›´æ–°æˆåŠŸ</span><br><span class="line">        &#125;</span><br><span class="line">        // æ›´æ–°å¤±è´¥ï¼Œé‡è¯•</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ‚²è§‚é”-vs-ä¹è§‚é”é€‰æ‹©"><a href="#æ‚²è§‚é”-vs-ä¹è§‚é”é€‰æ‹©" class="headerlink" title="æ‚²è§‚é” vs ä¹è§‚é”é€‰æ‹©"></a>æ‚²è§‚é” vs ä¹è§‚é”é€‰æ‹©</h3><p><strong>æ‚²è§‚é”é€‚ç”¨åœºæ™¯</strong>ï¼š</p><ul><li>å†™æ“ä½œé¢‘ç¹ï¼Œå†²çªæ¦‚ç‡é«˜</li><li>ä¸šåŠ¡é€»è¾‘å¤æ‚ï¼Œé‡è¯•æˆæœ¬é«˜</li><li>å¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚ä¸¥æ ¼</li></ul><p><strong>ä¹è§‚é”é€‚ç”¨åœºæ™¯</strong>ï¼š</p><ul><li>è¯»å¤šå†™å°‘ï¼Œå†²çªæ¦‚ç‡ä½</li><li>ä¸šåŠ¡é€»è¾‘ç®€å•ï¼Œé‡è¯•æˆæœ¬ä½</li><li>å¯¹æ€§èƒ½è¦æ±‚é«˜</li></ul><h2 id="é«˜å¯ç”¨æ¶æ„"><a href="#é«˜å¯ç”¨æ¶æ„" class="headerlink" title="é«˜å¯ç”¨æ¶æ„"></a>é«˜å¯ç”¨æ¶æ„</h2><h3 id="ä¸»ä»å¤åˆ¶"><a href="#ä¸»ä»å¤åˆ¶" class="headerlink" title="ä¸»ä»å¤åˆ¶"></a>ä¸»ä»å¤åˆ¶</h3><p>Masterè´Ÿè´£å†™æ“ä½œï¼ŒSlaveè´Ÿè´£è¯»æ“ä½œï¼Œé€šè¿‡å¤åˆ¶å®ç°æ•°æ®åŒæ­¥ã€‚</p><p><strong>å¤åˆ¶åŸç†</strong>ï¼š</p><ol><li>Slaveå‘Masterå‘é€PSYNCå‘½ä»¤</li><li>Masteræ‰§è¡ŒBGSAVEç”ŸæˆRDBæ–‡ä»¶</li><li>Masterå°†RDBæ–‡ä»¶å‘é€ç»™Slave</li><li>Slaveè½½å…¥RDBæ–‡ä»¶</li><li>Masterå°†ç¼“å†²åŒºçš„å†™å‘½ä»¤å‘é€ç»™Slave</li><li>åç»­å†™å‘½ä»¤å®æ—¶åŒæ­¥</li></ol><p><strong>éƒ¨åˆ†é‡åŒæ­¥</strong>ï¼š ç½‘ç»œæ–­è¿åï¼ŒSlaveåªéœ€è¦åŒæ­¥æ–­è¿æœŸé—´çš„å‘½ä»¤ï¼Œè€Œä¸æ˜¯å®Œæ•´é‡åŒæ­¥ã€‚</p><h3 id="å“¨å…µæ¨¡å¼ï¼ˆSentinelï¼‰"><a href="#å“¨å…µæ¨¡å¼ï¼ˆSentinelï¼‰" class="headerlink" title="å“¨å…µæ¨¡å¼ï¼ˆSentinelï¼‰"></a>å“¨å…µæ¨¡å¼ï¼ˆSentinelï¼‰</h3><p>å“¨å…µè´Ÿè´£ç›‘æ§MasterçŠ¶æ€ï¼Œåœ¨Masteræ•…éšœæ—¶è‡ªåŠ¨è¿›è¡Œæ•…éšœè½¬ç§»ã€‚</p><p><strong>å“¨å…µèŒè´£</strong>ï¼š</p><ul><li>ç›‘æ§ï¼šå®šæœŸping Masterå’ŒSlave</li><li>é€šçŸ¥ï¼šæ•…éšœæ—¶é€šçŸ¥ç®¡ç†å‘˜å’Œå®¢æˆ·ç«¯</li><li>æ•…éšœè½¬ç§»ï¼šè‡ªåŠ¨å°†Slaveæå‡ä¸ºæ–°Master</li><li>é…ç½®ç®¡ç†ï¼šä¸ºå®¢æˆ·ç«¯æä¾›æœåŠ¡å‘ç°</li></ul><p><strong>æ•…éšœè½¬ç§»æµç¨‹</strong>ï¼š</p><ol><li>å“¨å…µå‘ç°Masterä¸‹çº¿ï¼ˆä¸»è§‚ä¸‹çº¿ï¼‰</li><li>å¤šä¸ªå“¨å…µç¡®è®¤Masterä¸‹çº¿ï¼ˆå®¢è§‚ä¸‹çº¿ï¼‰</li><li>é€‰ä¸¾é¢†å¯¼å“¨å…µæ‰§è¡Œæ•…éšœè½¬ç§»</li><li>é€‰æ‹©åˆé€‚çš„Slaveä½œä¸ºæ–°Master</li><li>ä¿®æ”¹å…¶ä»–Slaveçš„é…ç½®æŒ‡å‘æ–°Master</li><li>é€šçŸ¥å®¢æˆ·ç«¯Masteråœ°å€å˜æ›´</li></ol><h3 id="é›†ç¾¤æ¨¡å¼ï¼ˆClusterï¼‰"><a href="#é›†ç¾¤æ¨¡å¼ï¼ˆClusterï¼‰" class="headerlink" title="é›†ç¾¤æ¨¡å¼ï¼ˆClusterï¼‰"></a>é›†ç¾¤æ¨¡å¼ï¼ˆClusterï¼‰</h3><p>Redis Clusteré€šè¿‡åˆ†ç‰‡å®ç°æ¨ªå‘æ‰©å±•å’Œé«˜å¯ç”¨ã€‚</p><p><strong>åˆ†ç‰‡ç®—æ³•</strong>ï¼š ä½¿ç”¨CRC16ç®—æ³•è®¡ç®—keyçš„å“ˆå¸Œå€¼ï¼Œç„¶åå¯¹16384å–æ¨¡å¾—åˆ°æ§½ä½å·ã€‚</p><p><strong>èŠ‚ç‚¹é€šä¿¡</strong>ï¼š ä½¿ç”¨Gossipåè®®åœ¨èŠ‚ç‚¹é—´äº¤æ¢çŠ¶æ€ä¿¡æ¯ï¼ŒåŒ…æ‹¬èŠ‚ç‚¹ä¸Šçº¿&#x2F;ä¸‹çº¿ã€æ§½ä½åˆ†é…ç­‰ã€‚</p><p><strong>æ•…éšœè½¬ç§»</strong>ï¼š å½“MasterèŠ‚ç‚¹æ•…éšœæ—¶ï¼Œå…¶Slaveè‡ªåŠ¨æå‡ä¸ºæ–°Masterï¼Œè¿‡ç¨‹å¯¹å®¢æˆ·ç«¯é€æ˜ã€‚</p><p><strong>æ•°æ®è¿ç§»</strong>ï¼š é›†ç¾¤æ‰©å®¹æ—¶ï¼Œéœ€è¦å°†éƒ¨åˆ†æ§½ä½ä»ç°æœ‰èŠ‚ç‚¹è¿ç§»åˆ°æ–°èŠ‚ç‚¹ã€‚</p><h2 id="æ€§èƒ½ç›‘æ§ä¸ä¼˜åŒ–"><a href="#æ€§èƒ½ç›‘æ§ä¸ä¼˜åŒ–" class="headerlink" title="æ€§èƒ½ç›‘æ§ä¸ä¼˜åŒ–"></a>æ€§èƒ½ç›‘æ§ä¸ä¼˜åŒ–</h2><h3 id="æ…¢æŸ¥è¯¢æ—¥å¿—"><a href="#æ…¢æŸ¥è¯¢æ—¥å¿—" class="headerlink" title="æ…¢æŸ¥è¯¢æ—¥å¿—"></a>æ…¢æŸ¥è¯¢æ—¥å¿—</h3><p>Redisæä¾›æ…¢æŸ¥è¯¢æ—¥å¿—åŠŸèƒ½ï¼Œè®°å½•æ‰§è¡Œæ—¶é—´è¶…è¿‡é˜ˆå€¼çš„å‘½ä»¤ã€‚</p><p><strong>é…ç½®å‚æ•°</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">slowlog-log-slower-than 10000  # è¶…è¿‡10æ¯«ç§’è®°å½•</span><br><span class="line">slowlog-max-len 128           # æœ€å¤šä¿å­˜128æ¡è®°å½•</span><br></pre></td></tr></table></figure><p><strong>æŸ¥çœ‹æ…¢æŸ¥è¯¢</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SLOWLOG GET 10  # è·å–æœ€è¿‘10æ¡æ…¢æŸ¥è¯¢</span><br></pre></td></tr></table></figure><h3 id="å†…å­˜åˆ†æ"><a href="#å†…å­˜åˆ†æ" class="headerlink" title="å†…å­˜åˆ†æ"></a>å†…å­˜åˆ†æ</h3><p>ä½¿ç”¨MEMORYå‘½ä»¤åˆ†æå†…å­˜ä½¿ç”¨æƒ…å†µã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MEMORY USAGE key         # æŸ¥çœ‹keyå ç”¨å†…å­˜</span><br><span class="line">MEMORY STATS            # æŸ¥çœ‹å†…å­˜ç»Ÿè®¡ä¿¡æ¯</span><br><span class="line">MEMORY DOCTOR           # å†…å­˜ä½¿ç”¨å»ºè®®</span><br></pre></td></tr></table></figure><h3 id="æ€§èƒ½ä¼˜åŒ–å»ºè®®"><a href="#æ€§èƒ½ä¼˜åŒ–å»ºè®®" class="headerlink" title="æ€§èƒ½ä¼˜åŒ–å»ºè®®"></a>æ€§èƒ½ä¼˜åŒ–å»ºè®®</h3><p><strong>é¿å…å¤§key</strong>ï¼š</p><ul><li>å•ä¸ªkeyçš„valueä¸è¦è¶…è¿‡10KB</li><li>é›†åˆç±»å‹å…ƒç´ æ•°é‡æ§åˆ¶åœ¨åˆç†èŒƒå›´</li><li>ä½¿ç”¨SCANä»£æ›¿KEYSå‘½ä»¤</li></ul><p><strong>åˆç†ä½¿ç”¨æ•°æ®ç»“æ„</strong>ï¼š</p><ul><li>å°å¯¹è±¡ä½¿ç”¨Hashè€Œä¸æ˜¯å¤šä¸ªString</li><li>åˆç†è®¾ç½®ziplistç­‰å‹ç¼©ç»“æ„çš„é˜ˆå€¼</li><li>ä½¿ç”¨ä½å›¾(bitmap)å­˜å‚¨å¸ƒå°”ç±»å‹å¤§æ•°æ®é›†</li></ul><p><strong>ç½‘ç»œä¼˜åŒ–</strong>ï¼š</p><ul><li>ä½¿ç”¨Pipelineæ‰¹é‡æ“ä½œ</li><li>åˆç†è®¾ç½®å®¢æˆ·ç«¯è¿æ¥æ± </li><li>å¯ç”¨TCP_NODELAYé€‰é¡¹</li></ul><p><strong>æŒä¹…åŒ–ä¼˜åŒ–</strong>ï¼š</p><ul><li>æ ¹æ®ä¸šåŠ¡éœ€æ±‚é€‰æ‹©RDBæˆ–AOF</li><li>åˆç†é…ç½®è‡ªåŠ¨ä¿å­˜æ¡ä»¶</li><li>åœ¨ä»èŠ‚ç‚¹ä¸Šè¿›è¡ŒæŒä¹…åŒ–æ“ä½œ</li></ul><p>è¿™äº›è¯¦ç»†çš„æŠ€æœ¯ç‚¹æ¶µç›–äº†Redisçš„æ ¸å¿ƒæ¦‚å¿µã€å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆå’Œå®é™…åº”ç”¨åœºæ™¯ï¼Œæ˜¯RedisæŠ€æœ¯é¢è¯•çš„é‡è¦è€ƒæŸ¥å†…å®¹ã€‚æŒæ¡è¿™äº›çŸ¥è¯†ç‚¹å¹¶èƒ½ç»“åˆå®é™…é¡¹ç›®ç»éªŒè¿›è¡Œè¯´æ˜ï¼Œå°†å¤§å¤§æé«˜é¢è¯•é€šè¿‡ç‡ã€‚</p><h2 id="å†…å­˜ç®¡ç†ä¸æ·˜æ±°æœºåˆ¶"><a href="#å†…å­˜ç®¡ç†ä¸æ·˜æ±°æœºåˆ¶" class="headerlink" title="å†…å­˜ç®¡ç†ä¸æ·˜æ±°æœºåˆ¶"></a>å†…å­˜ç®¡ç†ä¸æ·˜æ±°æœºåˆ¶</h2><h3 id="å†…å­˜æ·˜æ±°ç­–ç•¥è¯¦è§£"><a href="#å†…å­˜æ·˜æ±°ç­–ç•¥è¯¦è§£" class="headerlink" title="å†…å­˜æ·˜æ±°ç­–ç•¥è¯¦è§£"></a>å†…å­˜æ·˜æ±°ç­–ç•¥è¯¦è§£</h3><p>å½“Rediså†…å­˜ä½¿ç”¨è¾¾åˆ°maxmemoryé™åˆ¶æ—¶ï¼Œä¼šæ ¹æ®é…ç½®çš„ç­–ç•¥æ·˜æ±°æ•°æ®ã€‚</p><p><strong>8ç§æ·˜æ±°ç­–ç•¥</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># é’ˆå¯¹æ‰€æœ‰key</span><br><span class="line">noeviction          # ä¸æ·˜æ±°ï¼Œå†™å…¥è¿”å›é”™è¯¯</span><br><span class="line">allkeys-lru         # æ‰€æœ‰keyä¸­æ·˜æ±°æœ€è¿‘æœ€å°‘ä½¿ç”¨</span><br><span class="line">allkeys-lfu         # æ‰€æœ‰keyä¸­æ·˜æ±°æœ€å°‘é¢‘ç‡ä½¿ç”¨</span><br><span class="line">allkeys-random      # æ‰€æœ‰keyä¸­éšæœºæ·˜æ±°</span><br><span class="line"></span><br><span class="line"># é’ˆå¯¹è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„key</span><br><span class="line">volatile-lru        # è¿‡æœŸkeyä¸­æ·˜æ±°æœ€è¿‘æœ€å°‘ä½¿ç”¨</span><br><span class="line">volatile-lfu        # è¿‡æœŸkeyä¸­æ·˜æ±°æœ€å°‘é¢‘ç‡ä½¿ç”¨</span><br><span class="line">volatile-random     # è¿‡æœŸkeyä¸­éšæœºæ·˜æ±°</span><br><span class="line">volatile-ttl        # è¿‡æœŸkeyä¸­æ·˜æ±°å³å°†è¿‡æœŸçš„</span><br></pre></td></tr></table></figure><p><strong>LRU vs LFU å®ç°ç»†èŠ‚</strong>ï¼š Redisçš„LRUå¹¶éä¸¥æ ¼çš„LRUï¼Œè€Œæ˜¯è¿‘ä¼¼LRUç®—æ³•ï¼š</p><ul><li>æ¯ä¸ªkeyéƒ½æœ‰24ä½çš„æ—¶é’Ÿå­—æ®µè®°å½•è®¿é—®æ—¶é—´</li><li>æ·˜æ±°æ—¶éšæœºé‡‡æ ·5ä¸ªkeyï¼ˆå¯é…ç½®ï¼‰ï¼Œé€‰æ‹©æ—¶é’Ÿå€¼æœ€å°çš„</li></ul><p>LFUç®—æ³•ç»´æŠ¤è®¿é—®é¢‘ç‡ï¼š</p><ul><li>é«˜16ä½å­˜å‚¨ä¸Šæ¬¡è®¿é—®æ—¶é—´</li><li>ä½8ä½å­˜å‚¨è®¿é—®é¢‘ç‡è®¡æ•°å™¨</li><li>è®¡æ•°å™¨é‡‡ç”¨æ¦‚ç‡æ€§é€’å¢ï¼Œé¿å…é¢‘ç‡æ— é™å¢é•¿</li></ul><h3 id="å†…å­˜ç¢ç‰‡é—®é¢˜"><a href="#å†…å­˜ç¢ç‰‡é—®é¢˜" class="headerlink" title="å†…å­˜ç¢ç‰‡é—®é¢˜"></a>å†…å­˜ç¢ç‰‡é—®é¢˜</h3><p><strong>äº§ç”ŸåŸå› </strong>ï¼š</p><ul><li>é¢‘ç¹çš„æ•°æ®æ›´æ–°å¯¼è‡´å†…å­˜åˆ†é…&#x2F;é‡Šæ”¾</li><li>Redisä½¿ç”¨jemallocå†…å­˜åˆ†é…å™¨ï¼Œå­˜åœ¨å†…å­˜å¯¹é½</li><li>åˆ é™¤å¤§keyåç•™ä¸‹å†…å­˜ç©ºæ´</li></ul><p><strong>æ£€æµ‹æ–¹æ³•</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">INFO memory</span><br><span class="line"># å…³æ³¨ mem_fragmentation_ratio æŒ‡æ ‡</span><br><span class="line"># æ¯”å€¼ &gt; 1.5 è¡¨ç¤ºç¢ç‰‡è¾ƒå¤š</span><br><span class="line"># æ¯”å€¼ &lt; 1 è¡¨ç¤ºä½¿ç”¨äº†swapï¼Œæ€§èƒ½ä¸¥é‡ä¸‹é™</span><br></pre></td></tr></table></figure><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><ol><li><strong>å†…å­˜æ•´ç†</strong>ï¼ˆRedis 4.0+ï¼‰ï¼š</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CONFIG SET activedefrag yes        # å¼€å¯è‡ªåŠ¨æ•´ç†</span><br><span class="line">CONFIG SET active-defrag-threshold-lower 10  # ç¢ç‰‡ç‡è¶…è¿‡10%å¯åŠ¨</span><br><span class="line">MEMORY PURGE                       # æ‰‹åŠ¨è§¦å‘æ•´ç†</span><br></pre></td></tr></table></figure><ol><li><strong>é‡å¯Redis</strong>ï¼šæœ€å½»åº•ä½†å½±å“æœåŠ¡å¯ç”¨æ€§</li><li><strong>ä¼˜åŒ–æ•°æ®ç»“æ„</strong>ï¼šå‡å°‘å°å¯¹è±¡ï¼Œä½¿ç”¨Hashå­˜å‚¨ç›¸å…³æ•°æ®</li></ol><h2 id="è¿‡æœŸç­–ç•¥ä¸åˆ é™¤æœºåˆ¶"><a href="#è¿‡æœŸç­–ç•¥ä¸åˆ é™¤æœºåˆ¶" class="headerlink" title="è¿‡æœŸç­–ç•¥ä¸åˆ é™¤æœºåˆ¶"></a>è¿‡æœŸç­–ç•¥ä¸åˆ é™¤æœºåˆ¶</h2><h3 id="ä¸‰ç§è¿‡æœŸåˆ é™¤ç­–ç•¥"><a href="#ä¸‰ç§è¿‡æœŸåˆ é™¤ç­–ç•¥" class="headerlink" title="ä¸‰ç§è¿‡æœŸåˆ é™¤ç­–ç•¥"></a>ä¸‰ç§è¿‡æœŸåˆ é™¤ç­–ç•¥</h3><p><strong>å®šæ—¶åˆ é™¤</strong>ï¼šè®¾ç½®è¿‡æœŸæ—¶é—´æ—¶åˆ›å»ºå®šæ—¶å™¨ï¼Œåˆ°æœŸç«‹å³åˆ é™¤</p><ul><li>ä¼˜ç‚¹ï¼šåŠæ—¶é‡Šæ”¾å†…å­˜</li><li>ç¼ºç‚¹ï¼šæ¶ˆè€—CPUèµ„æºåˆ›å»ºå’Œç®¡ç†å®šæ—¶å™¨</li></ul><p><strong>æƒ°æ€§åˆ é™¤</strong>ï¼šè®¿é—®keyæ—¶æ£€æŸ¥æ˜¯å¦è¿‡æœŸï¼Œè¿‡æœŸåˆ™åˆ é™¤</p><ul><li>ä¼˜ç‚¹ï¼šCPUå‹å¥½ï¼Œåªåœ¨å¿…è¦æ—¶åˆ é™¤</li><li>ç¼ºç‚¹ï¼šå†…å­˜ä¸å‹å¥½ï¼Œè¿‡æœŸkeyå¯èƒ½é•¿æœŸå ç”¨å†…å­˜</li></ul><p><strong>å®šæœŸåˆ é™¤</strong>ï¼šå®šæœŸéšæœºæ£€æŸ¥éƒ¨åˆ†keyï¼Œåˆ é™¤è¿‡æœŸçš„</p><ul><li>Redisçš„å®é™…ç­–ç•¥ï¼Œå¹³è¡¡CPUå’Œå†…å­˜ä½¿ç”¨</li></ul><h3 id="Redisè¿‡æœŸåˆ é™¤å®ç°"><a href="#Redisè¿‡æœŸåˆ é™¤å®ç°" class="headerlink" title="Redisè¿‡æœŸåˆ é™¤å®ç°"></a>Redisè¿‡æœŸåˆ é™¤å®ç°</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">// ç®€åŒ–çš„è¿‡æœŸåˆ é™¤é€»è¾‘</span><br><span class="line">void activeExpireCycle(int type) &#123;</span><br><span class="line">    static int current_db = 0;</span><br><span class="line">    static int timelimit_exit = 0;</span><br><span class="line">    </span><br><span class="line">    for (int i = 0; i &lt; server.dbnum; i++) &#123;</span><br><span class="line">        redisDb *db = server.db + current_db % server.dbnum;</span><br><span class="line">        </span><br><span class="line">        int iteration = 0;</span><br><span class="line">        while (iteration &lt; 20) &#123;  // æœ€å¤šæ£€æŸ¥20ä¸ªkey</span><br><span class="line">            long sampled = 0, expired = 0;</span><br><span class="line">            </span><br><span class="line">            // éšæœºé€‰æ‹©keyæ£€æŸ¥è¿‡æœŸ</span><br><span class="line">            for (int i = 0; i &lt; 20; i++) &#123;</span><br><span class="line">                dictEntry *de = dictGetRandomKey(db-&gt;expires);</span><br><span class="line">                if (de == NULL) break;</span><br><span class="line">                </span><br><span class="line">                sampled++;</span><br><span class="line">                if (keyIsExpired(db, de)) &#123;</span><br><span class="line">                    deleteExpiredKey(db, de);</span><br><span class="line">                    expired++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            // å¦‚æœè¿‡æœŸæ¯”ä¾‹è¶…è¿‡25%ï¼Œç»§ç»­ä¸‹è½®æ£€æŸ¥</span><br><span class="line">            if (expired &gt; 5) iteration++;</span><br><span class="line">            else break;</span><br><span class="line">        &#125;</span><br><span class="line">        current_db++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ•°æ®ç»“æ„åº•å±‚å®ç°æ·±åº¦è§£æ"><a href="#æ•°æ®ç»“æ„åº•å±‚å®ç°æ·±åº¦è§£æ" class="headerlink" title="æ•°æ®ç»“æ„åº•å±‚å®ç°æ·±åº¦è§£æ"></a>æ•°æ®ç»“æ„åº•å±‚å®ç°æ·±åº¦è§£æ</h2><h3 id="å‹ç¼©åˆ—è¡¨ï¼ˆZipListï¼‰æ¼”è¿›"><a href="#å‹ç¼©åˆ—è¡¨ï¼ˆZipListï¼‰æ¼”è¿›" class="headerlink" title="å‹ç¼©åˆ—è¡¨ï¼ˆZipListï¼‰æ¼”è¿›"></a>å‹ç¼©åˆ—è¡¨ï¼ˆZipListï¼‰æ¼”è¿›</h3><p>Redis 7.0ç”¨ListPackæ›¿ä»£äº†ZipListï¼Œè§£å†³äº†çº§è”æ›´æ–°é—®é¢˜ã€‚</p><p><strong>ZipListé—®é¢˜</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// ZipListç»“æ„å¯¼è‡´çš„çº§è”æ›´æ–°</span><br><span class="line">// å½“æ’å…¥å…ƒç´ å¯¼è‡´æŸä¸ªentryçš„é•¿åº¦æ”¹å˜æ—¶</span><br><span class="line">// å¯èƒ½å¼•èµ·åç»­æ‰€æœ‰entryçš„é‡æ–°ç¼–ç </span><br></pre></td></tr></table></figure><p><strong>ListPackä¼˜åŠ¿</strong>ï¼š</p><ul><li>æ¯ä¸ªå…ƒç´ ç‹¬ç«‹ç¼–ç ï¼Œé¿å…çº§è”æ›´æ–°</li><li>æ”¯æŒä»å°¾éƒ¨éå†ï¼Œæé«˜æŸäº›æ“ä½œæ•ˆç‡</li></ul><h3 id="å­—å…¸æ‰©å®¹ä¸rehash"><a href="#å­—å…¸æ‰©å®¹ä¸rehash" class="headerlink" title="å­—å…¸æ‰©å®¹ä¸rehash"></a>å­—å…¸æ‰©å®¹ä¸rehash</h3><p>Rediså­—å…¸ä½¿ç”¨å¢é‡å¼rehashé¿å…é˜»å¡ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">// æ¸è¿›å¼rehashå®ç°</span><br><span class="line">int dictRehash(dict *d, int n) &#123;</span><br><span class="line">    int empty_visits = n * 10;</span><br><span class="line">    </span><br><span class="line">    if (!dictIsRehashing(d)) return 0;</span><br><span class="line">    </span><br><span class="line">    while (n-- &amp;&amp; d-&gt;ht[0].used != 0) &#123;</span><br><span class="line">        // è·³è¿‡ç©ºæ¡¶</span><br><span class="line">        while (d-&gt;ht[0].table[d-&gt;rehashidx] == NULL) &#123;</span><br><span class="line">            d-&gt;rehashidx++;</span><br><span class="line">            if (--empty_visits == 0) return 1;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // è¿ç§»æ¡¶ä¸­æ‰€æœ‰å…ƒç´ </span><br><span class="line">        dictEntry *de = d-&gt;ht[0].table[d-&gt;rehashidx];</span><br><span class="line">        while (de) &#123;</span><br><span class="line">            dictEntry *nextde = de-&gt;next;</span><br><span class="line">            unsigned int h = dictHashKey(d, de-&gt;key) &amp; d-&gt;ht[1].sizemask;</span><br><span class="line">            de-&gt;next = d-&gt;ht[1].table[h];</span><br><span class="line">            d-&gt;ht[1].table[h] = de;</span><br><span class="line">            d-&gt;ht[0].used--;</span><br><span class="line">            d-&gt;ht[1].used++;</span><br><span class="line">            de = nextde;</span><br><span class="line">        &#125;</span><br><span class="line">        d-&gt;ht[0].table[d-&gt;rehashidx] = NULL;</span><br><span class="line">        d-&gt;rehashidx++;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç½‘ç»œæ¨¡å‹ä¸æ€§èƒ½ä¼˜åŒ–"><a href="#ç½‘ç»œæ¨¡å‹ä¸æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="ç½‘ç»œæ¨¡å‹ä¸æ€§èƒ½ä¼˜åŒ–"></a>ç½‘ç»œæ¨¡å‹ä¸æ€§èƒ½ä¼˜åŒ–</h2><h3 id="Redis-6-0-å¤šçº¿ç¨‹I-O"><a href="#Redis-6-0-å¤šçº¿ç¨‹I-O" class="headerlink" title="Redis 6.0 å¤šçº¿ç¨‹I&#x2F;O"></a>Redis 6.0 å¤šçº¿ç¨‹I&#x2F;O</h3><p>å¤šçº¿ç¨‹åªç”¨äºç½‘ç»œI&#x2F;Oï¼Œå‘½ä»¤æ‰§è¡Œä»æ˜¯å•çº¿ç¨‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">// å¤šçº¿ç¨‹I/Oå¤„ç†æµç¨‹</span><br><span class="line">void *IOThreadMain(void *myid) &#123;</span><br><span class="line">    while (1) &#123;</span><br><span class="line">        // ç­‰å¾…ä¸»çº¿ç¨‹åˆ†é…ä»»åŠ¡</span><br><span class="line">        pthread_mutex_lock(&amp;io_threads_mutex[id]);</span><br><span class="line">        </span><br><span class="line">        while (io_threads_list[id] &amp;&amp; io_threads_pending[id] == 0) &#123;</span><br><span class="line">            pthread_cond_wait(&amp;io_threads_cond[id], &amp;io_threads_mutex[id]);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // å¤„ç†è¯»å†™ä»»åŠ¡</span><br><span class="line">        listNode *ln;</span><br><span class="line">        listIter li;</span><br><span class="line">        listRewind(io_threads_list[id], &amp;li);</span><br><span class="line">        </span><br><span class="line">        while ((ln = listNext(&amp;li))) &#123;</span><br><span class="line">            client *c = listNodeValue(ln);</span><br><span class="line">            if (io_threads_op == IO_THREADS_OP_WRITE) &#123;</span><br><span class="line">                writeToClient(c, 0);</span><br><span class="line">            &#125; else if (io_threads_op == IO_THREADS_OP_READ) &#123;</span><br><span class="line">                readQueryFromClient(c-&gt;conn);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        io_threads_pending[id] = 0;</span><br><span class="line">        pthread_mutex_unlock(&amp;io_threads_mutex[id]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®¢æˆ·ç«¯è¿æ¥ç®¡ç†"><a href="#å®¢æˆ·ç«¯è¿æ¥ç®¡ç†" class="headerlink" title="å®¢æˆ·ç«¯è¿æ¥ç®¡ç†"></a>å®¢æˆ·ç«¯è¿æ¥ç®¡ç†</h3><p><strong>è¿æ¥æ± é…ç½®ä¼˜åŒ–</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// Jedisè¿æ¥æ± é…ç½®</span><br><span class="line">JedisPoolConfig config = new JedisPoolConfig();</span><br><span class="line">config.setMaxTotal(200);                    // æœ€å¤§è¿æ¥æ•°</span><br><span class="line">config.setMaxIdle(50);                      // æœ€å¤§ç©ºé—²è¿æ¥</span><br><span class="line">config.setMinIdle(10);                      // æœ€å°ç©ºé—²è¿æ¥</span><br><span class="line">config.setTestOnBorrow(true);               // è·å–è¿æ¥æ—¶æµ‹è¯•</span><br><span class="line">config.setTestOnReturn(true);               // å½’è¿˜è¿æ¥æ—¶æµ‹è¯•</span><br><span class="line">config.setTestWhileIdle(true);              // ç©ºé—²æ—¶æµ‹è¯•</span><br><span class="line">config.setTimeBetweenEvictionRunsMillis(30000);  // æ£€æŸ¥é—´éš”</span><br><span class="line">config.setNumTestsPerEvictionRun(10);       // æ¯æ¬¡æ£€æŸ¥è¿æ¥æ•°</span><br><span class="line">config.setMinEvictableIdleTimeMillis(60000);     // æœ€å°ç©ºé—²æ—¶é—´</span><br><span class="line"></span><br><span class="line">JedisPool pool = new JedisPool(config, &quot;localhost&quot;, 6379);</span><br></pre></td></tr></table></figure><p><strong>Pipelineä¼˜åŒ–</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// Pipelineæ‰¹é‡æ“ä½œ</span><br><span class="line">public void batchSet(Map&lt;String, String&gt; data) &#123;</span><br><span class="line">    try (Jedis jedis = pool.getResource()) &#123;</span><br><span class="line">        Pipeline pipeline = jedis.pipelined();</span><br><span class="line">        </span><br><span class="line">        for (Map.Entry&lt;String, String&gt; entry : data.entrySet()) &#123;</span><br><span class="line">            pipeline.set(entry.getKey(), entry.getValue());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        List&lt;Object&gt; results = pipeline.syncAndReturnAll();</span><br><span class="line">        // å¤„ç†ç»“æœ</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é«˜çº§æ•°æ®ç±»å‹ä¸åº”ç”¨"><a href="#é«˜çº§æ•°æ®ç±»å‹ä¸åº”ç”¨" class="headerlink" title="é«˜çº§æ•°æ®ç±»å‹ä¸åº”ç”¨"></a>é«˜çº§æ•°æ®ç±»å‹ä¸åº”ç”¨</h2><h3 id="HyperLogLog"><a href="#HyperLogLog" class="headerlink" title="HyperLogLog"></a>HyperLogLog</h3><p>ç”¨äºåŸºæ•°ç»Ÿè®¡ï¼Œå ç”¨å†…å­˜å›ºå®šï¼ˆ12KBï¼‰ï¼Œè¯¯å·®ç‡0.81%ã€‚</p><p><strong>å®ç°åŸç†</strong>ï¼š</p><ul><li>åŸºäºæ¦‚ç‡ç®—æ³•ï¼Œé€šè¿‡è§‚å¯Ÿéšæœºæ•°çš„æœ€å¤§å‰å¯¼é›¶ä¸ªæ•°ä¼°ç®—åŸºæ•°</li><li>ä½¿ç”¨è°ƒå’Œå¹³å‡æ•°å‡å°‘è¯¯å·®</li><li>é€‚ç”¨äºUVç»Ÿè®¡ç­‰åœºæ™¯</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># ç½‘ç«™UVç»Ÿè®¡</span><br><span class="line">PFADD uv:20230815 user1 user2 user3</span><br><span class="line">PFCOUNT uv:20230815                    # è·å–UVæ•°é‡</span><br><span class="line">PFMERGE uv:week uv:20230815 uv:20230816  # åˆå¹¶å¤šæ—¥æ•°æ®</span><br></pre></td></tr></table></figure><h3 id="å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆRedis-Moduleï¼‰"><a href="#å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆRedis-Moduleï¼‰" class="headerlink" title="å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆRedis Moduleï¼‰"></a>å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆRedis Moduleï¼‰</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># Rediså¸ƒéš†è¿‡æ»¤å™¨æ¨¡å—</span><br><span class="line">BF.RESERVE myfilter 0.01 1000000       # åˆ›å»ºè¿‡æ»¤å™¨ï¼Œè¯¯æŠ¥ç‡0.01%ï¼Œé¢„æœŸå…ƒç´ 100ä¸‡</span><br><span class="line">BF.ADD myfilter &quot;user123&quot;              # æ·»åŠ å…ƒç´ </span><br><span class="line">BF.EXISTS myfilter &quot;user123&quot;           # æ£€æŸ¥å…ƒç´ æ˜¯å¦å­˜åœ¨</span><br><span class="line">BF.MADD myfilter item1 item2 item3     # æ‰¹é‡æ·»åŠ </span><br><span class="line">BF.MEXISTS myfilter item1 item2 item3  # æ‰¹é‡æ£€æŸ¥</span><br></pre></td></tr></table></figure><h3 id="Geoåœ°ç†ä½ç½®"><a href="#Geoåœ°ç†ä½ç½®" class="headerlink" title="Geoåœ°ç†ä½ç½®"></a>Geoåœ°ç†ä½ç½®</h3><p>åŸºäºSorted Setå®ç°ï¼Œä½¿ç”¨GeoHashç®—æ³•ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># æ·»åŠ åœ°ç†ä½ç½®</span><br><span class="line">GEOADD cities 116.397128 39.916527 &quot;åŒ—äº¬&quot; 121.473701 31.230416 &quot;ä¸Šæµ·&quot;</span><br><span class="line"></span><br><span class="line"># è®¡ç®—è·ç¦»</span><br><span class="line">GEODIST cities &quot;åŒ—äº¬&quot; &quot;ä¸Šæµ·&quot; km</span><br><span class="line"></span><br><span class="line"># èŒƒå›´æŸ¥è¯¢</span><br><span class="line">GEORADIUS cities 116.397128 39.916527 1000 km WITHDIST WITHCOORD</span><br><span class="line"></span><br><span class="line"># æ ¹æ®æˆå‘˜æŸ¥è¯¢</span><br><span class="line">GEORADIUSBYMEMBER cities &quot;åŒ—äº¬&quot; 1000 km</span><br></pre></td></tr></table></figure><h2 id="å®‰å…¨æ€§é—®é¢˜ä¸é˜²æŠ¤"><a href="#å®‰å…¨æ€§é—®é¢˜ä¸é˜²æŠ¤" class="headerlink" title="å®‰å…¨æ€§é—®é¢˜ä¸é˜²æŠ¤"></a>å®‰å…¨æ€§é—®é¢˜ä¸é˜²æŠ¤</h2><h3 id="å¸¸è§å®‰å…¨æ¼æ´"><a href="#å¸¸è§å®‰å…¨æ¼æ´" class="headerlink" title="å¸¸è§å®‰å…¨æ¼æ´"></a>å¸¸è§å®‰å…¨æ¼æ´</h3><p><strong>å‘½ä»¤æ³¨å…¥</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// é”™è¯¯åšæ³•ï¼šç›´æ¥æ‹¼æ¥ç”¨æˆ·è¾“å…¥</span><br><span class="line">String key = &quot;user:&quot; + userInput;  // userInputå¯èƒ½åŒ…å«æ¶æ„å‘½ä»¤</span><br><span class="line">jedis.eval(&quot;return redis.call(&#x27;get&#x27;, &#x27;&quot; + key + &quot;&#x27;)&quot;, 0);</span><br><span class="line"></span><br><span class="line">// æ­£ç¡®åšæ³•ï¼šä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢</span><br><span class="line">jedis.eval(&quot;return redis.call(&#x27;get&#x27;, KEYS[1])&quot;, 1, key);</span><br></pre></td></tr></table></figure><p><strong>æœªæˆæƒè®¿é—®</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># redis.confå®‰å…¨é…ç½®</span><br><span class="line">bind 127.0.0.1                        # ç»‘å®šæŒ‡å®šIP</span><br><span class="line">requirepass your_password              # è®¾ç½®å¯†ç </span><br><span class="line">protected-mode yes                     # å¼€å¯ä¿æŠ¤æ¨¡å¼</span><br><span class="line">port 0                                # ç¦ç”¨é»˜è®¤ç«¯å£</span><br><span class="line">port 6380                             # ä½¿ç”¨éæ ‡å‡†ç«¯å£</span><br></pre></td></tr></table></figure><p><strong>å±é™©å‘½ä»¤ç¦ç”¨</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># é‡å‘½åå±é™©å‘½ä»¤</span><br><span class="line">rename-command FLUSHDB &quot;&quot;             # ç¦ç”¨FLUSHDB</span><br><span class="line">rename-command FLUSHALL &quot;&quot;            # ç¦ç”¨FLUSHALL</span><br><span class="line">rename-command SHUTDOWN &quot;REDIS_SHUTDOWN&quot;  # é‡å‘½åSHUTDOWN</span><br><span class="line">rename-command CONFIG &quot;REDIS_CONFIG&quot;   # é‡å‘½åCONFIG</span><br></pre></td></tr></table></figure><h3 id="ACLè®¿é—®æ§åˆ¶ï¼ˆRedis-6-0-ï¼‰"><a href="#ACLè®¿é—®æ§åˆ¶ï¼ˆRedis-6-0-ï¼‰" class="headerlink" title="ACLè®¿é—®æ§åˆ¶ï¼ˆRedis 6.0+ï¼‰"></a>ACLè®¿é—®æ§åˆ¶ï¼ˆRedis 6.0+ï¼‰</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># åˆ›å»ºç”¨æˆ·</span><br><span class="line">ACL SETUSER alice on &gt;password123 ~cached:* +get +set</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹ç”¨æˆ·æƒé™</span><br><span class="line">ACL LIST</span><br><span class="line"></span><br><span class="line"># åˆ é™¤ç”¨æˆ·</span><br><span class="line">ACL DELUSER alice</span><br><span class="line"></span><br><span class="line"># æ£€æŸ¥æƒé™</span><br><span class="line">AUTH alice password123</span><br></pre></td></tr></table></figure><h2 id="ç›‘æ§ä¸è¿ç»´"><a href="#ç›‘æ§ä¸è¿ç»´" class="headerlink" title="ç›‘æ§ä¸è¿ç»´"></a>ç›‘æ§ä¸è¿ç»´</h2><h3 id="å…³é”®ç›‘æ§æŒ‡æ ‡"><a href="#å…³é”®ç›‘æ§æŒ‡æ ‡" class="headerlink" title="å…³é”®ç›‘æ§æŒ‡æ ‡"></a>å…³é”®ç›‘æ§æŒ‡æ ‡</h3><p><strong>æ€§èƒ½æŒ‡æ ‡</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># é€šè¿‡INFOå‘½ä»¤è·å–</span><br><span class="line">INFO stats</span><br><span class="line"># å…³æ³¨æŒ‡æ ‡ï¼š</span><br><span class="line"># - instantaneous_ops_per_sec: QPS</span><br><span class="line"># - keyspace_hits/keyspace_misses: å‘½ä¸­ç‡</span><br><span class="line"># - used_cpu_sys/used_cpu_user: CPUä½¿ç”¨ç‡</span><br><span class="line"># - connected_clients: è¿æ¥æ•°</span><br><span class="line"># - blocked_clients: é˜»å¡è¿æ¥æ•°</span><br></pre></td></tr></table></figure><p><strong>å†…å­˜æŒ‡æ ‡</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">INFO memory</span><br><span class="line"># å…³æ³¨æŒ‡æ ‡ï¼š</span><br><span class="line"># - used_memory: å·²ä½¿ç”¨å†…å­˜</span><br><span class="line"># - used_memory_rss: ç‰©ç†å†…å­˜å ç”¨</span><br><span class="line"># - mem_fragmentation_ratio: å†…å­˜ç¢ç‰‡ç‡</span><br><span class="line"># - used_memory_peak: å†…å­˜ä½¿ç”¨å³°å€¼</span><br></pre></td></tr></table></figure><p><strong>æŒä¹…åŒ–æŒ‡æ ‡</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">INFO persistence</span><br><span class="line"># å…³æ³¨æŒ‡æ ‡ï¼š</span><br><span class="line"># - rdb_last_save_time: æœ€åRDBä¿å­˜æ—¶é—´</span><br><span class="line"># - aof_last_rewrite_time_sec: AOFé‡å†™è€—æ—¶</span><br><span class="line"># - aof_current_size: AOFæ–‡ä»¶å¤§å°</span><br></pre></td></tr></table></figure><h3 id="æ•…éšœæ’æŸ¥å¸¸ç”¨å‘½ä»¤"><a href="#æ•…éšœæ’æŸ¥å¸¸ç”¨å‘½ä»¤" class="headerlink" title="æ•…éšœæ’æŸ¥å¸¸ç”¨å‘½ä»¤"></a>æ•…éšœæ’æŸ¥å¸¸ç”¨å‘½ä»¤</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># å®¢æˆ·ç«¯è¿æ¥ä¿¡æ¯</span><br><span class="line">CLIENT LIST</span><br><span class="line">CLIENT INFO</span><br><span class="line"></span><br><span class="line"># æ…¢æŸ¥è¯¢åˆ†æ</span><br><span class="line">SLOWLOG GET 10</span><br><span class="line">CONFIG GET slowlog-log-slower-than</span><br><span class="line"></span><br><span class="line"># å¤§keyæŸ¥æ‰¾</span><br><span class="line">MEMORY USAGE keyname</span><br><span class="line">redis-cli --bigkeys</span><br><span class="line"></span><br><span class="line"># çƒ­ç‚¹keyåˆ†æ</span><br><span class="line">redis-cli --hotkeys</span><br><span class="line"></span><br><span class="line"># å»¶è¿Ÿç›‘æ§</span><br><span class="line">LATENCY HISTORY command</span><br><span class="line">CONFIG SET latency-monitor-threshold 100</span><br></pre></td></tr></table></figure><h2 id="ç‰¹æ®Šåº”ç”¨åœºæ™¯"><a href="#ç‰¹æ®Šåº”ç”¨åœºæ™¯" class="headerlink" title="ç‰¹æ®Šåº”ç”¨åœºæ™¯"></a>ç‰¹æ®Šåº”ç”¨åœºæ™¯</h2><h3 id="åˆ†å¸ƒå¼é™æµ"><a href="#åˆ†å¸ƒå¼é™æµ" class="headerlink" title="åˆ†å¸ƒå¼é™æµ"></a>åˆ†å¸ƒå¼é™æµ</h3><p><strong>å›ºå®šçª—å£é™æµ</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">public class RedisRateLimiter &#123;</span><br><span class="line">    public boolean isAllowed(String key, int limit, int window) &#123;</span><br><span class="line">        long current = System.currentTimeMillis() / 1000 / window;</span><br><span class="line">        String windowKey = key + &quot;:&quot; + current;</span><br><span class="line">        </span><br><span class="line">        String script = </span><br><span class="line">            &quot;local count = redis.call(&#x27;incr&#x27;, KEYS[1]) &quot; +</span><br><span class="line">            &quot;if count == 1 then &quot; +</span><br><span class="line">            &quot;  redis.call(&#x27;expire&#x27;, KEYS[1], ARGV[1]) &quot; +</span><br><span class="line">            &quot;end &quot; +</span><br><span class="line">            &quot;return count&quot;;</span><br><span class="line">            </span><br><span class="line">        Long count = (Long) jedis.eval(script, Arrays.asList(windowKey), </span><br><span class="line">                                      Arrays.asList(String.valueOf(window)));</span><br><span class="line">        </span><br><span class="line">        return count &lt;= limit;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ»‘åŠ¨çª—å£é™æµ</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">public boolean slidingWindowLimit(String key, int limit, int window) &#123;</span><br><span class="line">    long now = System.currentTimeMillis();</span><br><span class="line">    long windowStart = now - window * 1000;</span><br><span class="line">    </span><br><span class="line">    String script = </span><br><span class="line">        &quot;redis.call(&#x27;zremrangebyscore&#x27;, KEYS[1], 0, ARGV[1]) &quot; +</span><br><span class="line">        &quot;local count = redis.call(&#x27;zcard&#x27;, KEYS[1]) &quot; +</span><br><span class="line">        &quot;if count &lt; tonumber(ARGV[2]) then &quot; +</span><br><span class="line">        &quot;  redis.call(&#x27;zadd&#x27;, KEYS[1], ARGV[3], ARGV[3]) &quot; +</span><br><span class="line">        &quot;  redis.call(&#x27;expire&#x27;, KEYS[1], ARGV[4]) &quot; +</span><br><span class="line">        &quot;  return 1 &quot; +</span><br><span class="line">        &quot;else &quot; +</span><br><span class="line">        &quot;  return 0 &quot; +</span><br><span class="line">        &quot;end&quot;;</span><br><span class="line">    </span><br><span class="line">    Long result = (Long) jedis.eval(script, Arrays.asList(key),</span><br><span class="line">        Arrays.asList(String.valueOf(windowStart), String.valueOf(limit),</span><br><span class="line">                     String.valueOf(now), String.valueOf(window)));</span><br><span class="line">    </span><br><span class="line">    return result == 1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åˆ†å¸ƒå¼Session"><a href="#åˆ†å¸ƒå¼Session" class="headerlink" title="åˆ†å¸ƒå¼Session"></a>åˆ†å¸ƒå¼Session</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class RedisSessionManager &#123;</span><br><span class="line">    </span><br><span class="line">    @Autowired</span><br><span class="line">    private RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class="line">    </span><br><span class="line">    public void createSession(String sessionId, String userId, int timeout) &#123;</span><br><span class="line">        String key = &quot;session:&quot; + sessionId;</span><br><span class="line">        Map&lt;String, Object&gt; sessionData = new HashMap&lt;&gt;();</span><br><span class="line">        sessionData.put(&quot;userId&quot;, userId);</span><br><span class="line">        sessionData.put(&quot;createTime&quot;, System.currentTimeMillis());</span><br><span class="line">        </span><br><span class="line">        redisTemplate.opsForHash().putAll(key, sessionData);</span><br><span class="line">        redisTemplate.expire(key, timeout, TimeUnit.SECONDS);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public boolean isValidSession(String sessionId) &#123;</span><br><span class="line">        String key = &quot;session:&quot; + sessionId;</span><br><span class="line">        return redisTemplate.hasKey(key);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public void renewSession(String sessionId, int timeout) &#123;</span><br><span class="line">        String key = &quot;session:&quot; + sessionId;</span><br><span class="line">        if (redisTemplate.hasKey(key)) &#123;</span><br><span class="line">            redisTemplate.expire(key, timeout, TimeUnit.SECONDS);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ¶ˆæ¯é˜Ÿåˆ—å®ç°"><a href="#æ¶ˆæ¯é˜Ÿåˆ—å®ç°" class="headerlink" title="æ¶ˆæ¯é˜Ÿåˆ—å®ç°"></a>æ¶ˆæ¯é˜Ÿåˆ—å®ç°</h3><p><strong>åŸºäºListçš„ç®€å•é˜Ÿåˆ—</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public class RedisQueue &#123;</span><br><span class="line">    // ç”Ÿäº§è€…</span><br><span class="line">    public void produce(String queue, String message) &#123;</span><br><span class="line">        jedis.lpush(queue, message);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // æ¶ˆè´¹è€…ï¼ˆé˜»å¡å¼ï¼‰</span><br><span class="line">    public String consume(String queue, int timeout) &#123;</span><br><span class="line">        List&lt;String&gt; result = jedis.brpop(timeout, queue);</span><br><span class="line">        return result != null ? result.get(1) : null;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åŸºäºStreamçš„æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼ˆRedis 5.0+ï¼‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># ç”Ÿäº§æ¶ˆæ¯</span><br><span class="line">XADD mystream * field1 value1 field2 value2</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºæ¶ˆè´¹è€…ç»„</span><br><span class="line">XGROUP CREATE mystream mygroup $ MKSTREAM</span><br><span class="line"></span><br><span class="line"># æ¶ˆè´¹æ¶ˆæ¯</span><br><span class="line">XREADGROUP GROUP mygroup consumer1 COUNT 10 STREAMS mystream &gt;</span><br><span class="line"></span><br><span class="line"># ç¡®è®¤æ¶ˆæ¯</span><br><span class="line">XACK mystream mygroup message_id</span><br></pre></td></tr></table></figure><h3 id="å»¶æ—¶é˜Ÿåˆ—"><a href="#å»¶æ—¶é˜Ÿåˆ—" class="headerlink" title="å»¶æ—¶é˜Ÿåˆ—"></a>å»¶æ—¶é˜Ÿåˆ—</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">public class RedisDelayQueue &#123;</span><br><span class="line">    </span><br><span class="line">    public void addDelayTask(String task, long delayTime) &#123;</span><br><span class="line">        long executeTime = System.currentTimeMillis() + delayTime;</span><br><span class="line">        jedis.zadd(&quot;delay_queue&quot;, executeTime, task);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public List&lt;String&gt; getReadyTasks() &#123;</span><br><span class="line">        long now = System.currentTimeMillis();</span><br><span class="line">        Set&lt;String&gt; tasks = jedis.zrangeByScore(&quot;delay_queue&quot;, 0, now);</span><br><span class="line">        </span><br><span class="line">        if (!tasks.isEmpty()) &#123;</span><br><span class="line">            // åŸå­æ€§åˆ é™¤å·²è·å–çš„ä»»åŠ¡</span><br><span class="line">            String script = </span><br><span class="line">                &quot;local tasks = redis.call(&#x27;zrangebyscore&#x27;, KEYS[1], 0, ARGV[1]) &quot; +</span><br><span class="line">                &quot;if #tasks &gt; 0 then &quot; +</span><br><span class="line">                &quot;  redis.call(&#x27;zremrangebyscore&#x27;, KEYS[1], 0, ARGV[1]) &quot; +</span><br><span class="line">                &quot;end &quot; +</span><br><span class="line">                &quot;return tasks&quot;;</span><br><span class="line">            </span><br><span class="line">            @SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="line">            List&lt;String&gt; result = (List&lt;String&gt;) jedis.eval(script, </span><br><span class="line">                Arrays.asList(&quot;delay_queue&quot;), Arrays.asList(String.valueOf(now)));</span><br><span class="line">            return result;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        return Collections.emptyList();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ€§èƒ½è°ƒä¼˜æŠ€å·§"><a href="#æ€§èƒ½è°ƒä¼˜æŠ€å·§" class="headerlink" title="æ€§èƒ½è°ƒä¼˜æŠ€å·§"></a>æ€§èƒ½è°ƒä¼˜æŠ€å·§</h2><h3 id="å†…å­˜ä¼˜åŒ–"><a href="#å†…å­˜ä¼˜åŒ–" class="headerlink" title="å†…å­˜ä¼˜åŒ–"></a>å†…å­˜ä¼˜åŒ–</h3><p><strong>ä½¿ç”¨Hashå­˜å‚¨å°å¯¹è±¡</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// ä¸æ¨èï¼šä¸ºæ¯ä¸ªç”¨æˆ·å­—æ®µå•ç‹¬è®¾ç½®key</span><br><span class="line">jedis.set(&quot;user:1001:name&quot;, &quot;å¼ ä¸‰&quot;);</span><br><span class="line">jedis.set(&quot;user:1001:age&quot;, &quot;25&quot;);</span><br><span class="line">jedis.set(&quot;user:1001:email&quot;, &quot;zhang@example.com&quot;);</span><br><span class="line"></span><br><span class="line">// æ¨èï¼šä½¿ç”¨Hashå­˜å‚¨</span><br><span class="line">jedis.hset(&quot;user:1001&quot;, &quot;name&quot;, &quot;å¼ ä¸‰&quot;);</span><br><span class="line">jedis.hset(&quot;user:1001&quot;, &quot;age&quot;, &quot;25&quot;);</span><br><span class="line">jedis.hset(&quot;user:1001&quot;, &quot;email&quot;, &quot;zhang@example.com&quot;);</span><br></pre></td></tr></table></figure><p><strong>åˆç†è®¾ç½®è¿‡æœŸæ—¶é—´</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// é¿å…åŒæ—¶è¿‡æœŸå¯¼è‡´é›ªå´©</span><br><span class="line">int baseExpire = 3600;  // 1å°æ—¶</span><br><span class="line">int randomExpire = baseExpire + new Random().nextInt(300);  // å¢åŠ 0-5åˆ†é’Ÿéšæœºæ—¶é—´</span><br><span class="line">jedis.setex(key, randomExpire, value);</span><br></pre></td></tr></table></figure><h3 id="ç½‘ç»œä¼˜åŒ–"><a href="#ç½‘ç»œä¼˜åŒ–" class="headerlink" title="ç½‘ç»œä¼˜åŒ–"></a>ç½‘ç»œä¼˜åŒ–</h3><p><strong>æ‰¹é‡æ“ä½œä¼˜åŒ–</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// ä½¿ç”¨Pipeline</span><br><span class="line">Pipeline pipeline = jedis.pipelined();</span><br><span class="line">for (int i = 0; i &lt; 1000; i++) &#123;</span><br><span class="line">    pipeline.set(&quot;key&quot; + i, &quot;value&quot; + i);</span><br><span class="line">&#125;</span><br><span class="line">pipeline.sync();</span><br><span class="line"></span><br><span class="line">// æˆ–ä½¿ç”¨åŸç”Ÿæ‰¹é‡å‘½ä»¤</span><br><span class="line">Map&lt;String, String&gt; batch = new HashMap&lt;&gt;();</span><br><span class="line">// ... å¡«å……æ•°æ®</span><br><span class="line">jedis.mset(flattenMap(batch));</span><br></pre></td></tr></table></figure><h3 id="CPUä¼˜åŒ–"><a href="#CPUä¼˜åŒ–" class="headerlink" title="CPUä¼˜åŒ–"></a>CPUä¼˜åŒ–</h3><p><strong>Luaè„šæœ¬å‡å°‘ç½‘ç»œå¾€è¿”</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">-- åŸå­æ€§å¢åŠ åº“å­˜</span><br><span class="line">local current = redis.call(&#x27;get&#x27;, KEYS[1])</span><br><span class="line">if current == false then</span><br><span class="line">    return -1  -- keyä¸å­˜åœ¨</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">current = tonumber(current)</span><br><span class="line">if current &gt;= tonumber(ARGV[1]) then</span><br><span class="line">    redis.call(&#x27;decrby&#x27;, KEYS[1], ARGV[1])</span><br><span class="line">    return current - tonumber(ARGV[1])</span><br><span class="line">else</span><br><span class="line">    return -2  -- åº“å­˜ä¸è¶³</span><br><span class="line">end</span><br></pre></td></tr></table></figure><p>ä½ å¥½ï¼Œæˆ‘å¾ˆä¹æ„ä¸ºä½ è¯¦ç»†è®²è§£ Redisã€‚</p><p>Redis æ˜¯ä¸€ä¸ªå¼€æºçš„ã€åŸºäºå†…å­˜çš„ã€é«˜æ€§èƒ½çš„é”®å€¼å­˜å‚¨ç³»ç»Ÿã€‚å®ƒé€šå¸¸è¢«ç”¨ä½œæ•°æ®åº“ã€ç¼“å­˜å’Œæ¶ˆæ¯ä¸­é—´ä»¶ã€‚Redis æ”¯æŒå¤šç§æ•°æ®ç»“æ„ï¼Œå¦‚å­—ç¬¦ä¸²ã€å“ˆå¸Œã€åˆ—è¡¨ã€é›†åˆå’Œæœ‰åºé›†åˆï¼Œè¿™ä½¿å¾—å®ƒåœ¨å„ç§åº”ç”¨åœºæ™¯ä¸­éƒ½éå¸¸çµæ´»ã€‚</p><h3 id="Redis-çš„æ ¸å¿ƒç‰¹ç‚¹"><a href="#Redis-çš„æ ¸å¿ƒç‰¹ç‚¹" class="headerlink" title="Redis çš„æ ¸å¿ƒç‰¹ç‚¹"></a>Redis çš„æ ¸å¿ƒç‰¹ç‚¹</h3><hr><ul><li><strong>é«˜æ€§èƒ½</strong>: Redis çš„æ‰€æœ‰æ•°æ®éƒ½å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå› æ­¤è¯»å†™é€Ÿåº¦éå¸¸å¿«ã€‚é€šå¸¸ï¼Œå•ä¸ª Redis å®ä¾‹æ¯ç§’èƒ½å¤„ç†è¶…è¿‡ 10 ä¸‡æ¬¡è¯»å†™æ“ä½œã€‚</li><li><strong>ä¸°å¯Œçš„æ•°æ®ç»“æ„</strong>: Redis ä¸ä»…ä»…æ˜¯ç®€å•çš„é”®å€¼å­˜å‚¨ï¼Œå®ƒæ”¯æŒå¤šç§å¤æ‚çš„æ•°æ®ç»“æ„ï¼Œè¿™è®©å®ƒèƒ½æ»¡è¶³æ›´å¹¿æ³›çš„åº”ç”¨éœ€æ±‚ã€‚</li><li><strong>æŒä¹…åŒ–</strong>: è™½ç„¶ Redis æ˜¯åŸºäºå†…å­˜çš„ï¼Œä½†å®ƒæä¾›äº†ä¸¤ç§ä¸åŒçš„æŒä¹…åŒ–æ–¹å¼ï¼Œå¯ä»¥å°†æ•°æ®ä»å†…å­˜ä¸­ä¿å­˜åˆ°ç£ç›˜ä¸Šï¼Œä»¥é˜²æ­¢æœåŠ¡å™¨é‡å¯åæ•°æ®ä¸¢å¤±ã€‚</li><li><strong>åŸå­æ€§</strong>: Redis çš„æ‰€æœ‰æ“ä½œéƒ½æ˜¯åŸå­æ€§çš„ã€‚è¿™æ„å‘³ç€ä¸€ä¸ªå‘½ä»¤è¦ä¹ˆå®Œå…¨æ‰§è¡Œï¼Œè¦ä¹ˆæ ¹æœ¬ä¸æ‰§è¡Œï¼Œä¸­é—´ä¸ä¼šè¢«æ‰“æ–­ï¼Œè¿™åœ¨å¤šå®¢æˆ·ç«¯å¹¶å‘è®¿é—®æ—¶å°¤å…¶é‡è¦ã€‚</li><li><strong>ä¸»ä»å¤åˆ¶</strong>: Redis æ”¯æŒä¸»ä»å¤åˆ¶ï¼Œå¯ä»¥å°†æ•°æ®ä»ä¸€ä¸ªä¸»èŠ‚ç‚¹ï¼ˆMasterï¼‰åŒæ­¥åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªä»èŠ‚ç‚¹ï¼ˆSlaveï¼‰ï¼Œä»è€Œå®ç°æ•°æ®çš„å¤‡ä»½å’Œè¯»å†™åˆ†ç¦»ï¼Œæé«˜ç³»ç»Ÿçš„å¯ç”¨æ€§å’Œæ‰©å±•æ€§ã€‚</li><li><strong>é«˜å¯ç”¨æ€§ä¸é›†ç¾¤</strong>: Redis æä¾›äº† Sentinelï¼ˆå“¨å…µï¼‰å’Œ Clusterï¼ˆé›†ç¾¤ï¼‰ä¸¤ç§æ–¹æ¡ˆï¼Œæ¥ä¿è¯ç³»ç»Ÿçš„é«˜å¯ç”¨æ€§å’Œæ‰©å±•æ€§ã€‚</li></ul><h3 id="Redis-çš„æ•°æ®ç»“æ„è¯¦è§£"><a href="#Redis-çš„æ•°æ®ç»“æ„è¯¦è§£" class="headerlink" title="Redis çš„æ•°æ®ç»“æ„è¯¦è§£"></a>Redis çš„æ•°æ®ç»“æ„è¯¦è§£</h3><hr><p>è¿™æ˜¯ Redis æœ€æœ‰ç‰¹è‰²çš„åœ°æ–¹ï¼Œç†è§£è¿™äº›æ•°æ®ç»“æ„æ˜¯æŒæ¡ Redis çš„å…³é”®ã€‚</p><h4 id="1-String-å­—ç¬¦ä¸²"><a href="#1-String-å­—ç¬¦ä¸²" class="headerlink" title="1. String (å­—ç¬¦ä¸²)"></a>1. String (å­—ç¬¦ä¸²)</h4><ul><li><strong>æœ€åŸºæœ¬çš„æ•°æ®ç»“æ„</strong>ï¼Œå¯ä»¥å­˜å‚¨ä»»ä½•ç±»å‹çš„æ•°æ®ï¼Œæ¯”å¦‚å­—ç¬¦ä¸²ã€æ•°å­—æˆ–äºŒè¿›åˆ¶æ•°æ®ã€‚ä¸€ä¸ªé”®æœ€å¤šå¯ä»¥å­˜å‚¨ 512MB çš„å€¼ã€‚</li><li><strong>å¸¸ç”¨å‘½ä»¤</strong>:<ul><li><code>SET key value</code>: è®¾ç½®é”®å€¼å¯¹ã€‚</li><li><code>GET key</code>: è·å–é”®å¯¹åº”çš„å€¼ã€‚</li><li><code>INCR key</code>: å°†é”®å¯¹åº”çš„å€¼åŠ  1ï¼Œå¸¸ç”¨äºè®¡æ•°å™¨ã€‚</li><li><code>MSET key1 value1 key2 value2</code>: åŒæ—¶è®¾ç½®å¤šä¸ªé”®å€¼å¯¹ã€‚</li><li><code>MGET key1 key2</code>: åŒæ—¶è·å–å¤šä¸ªé”®çš„å€¼ã€‚</li></ul></li><li><strong>åº”ç”¨åœºæ™¯</strong>: ç¼“å­˜ã€è®¡æ•°å™¨ã€åˆ†å¸ƒå¼é”ç­‰ã€‚</li></ul><h4 id="2-Hash-å“ˆå¸Œ"><a href="#2-Hash-å“ˆå¸Œ" class="headerlink" title="2. Hash (å“ˆå¸Œ)"></a>2. Hash (å“ˆå¸Œ)</h4><ul><li><strong>ç±»ä¼¼äºä¸€ä¸ªé”®å€¼å¯¹çš„é›†åˆ</strong>ã€‚ä¸€ä¸ªå“ˆå¸Œé”®å¯ä»¥å­˜å‚¨å¤šä¸ªå­—æ®µï¼ˆfieldï¼‰å’Œå¯¹åº”çš„å€¼ï¼ˆvalueï¼‰ï¼Œéå¸¸é€‚åˆå­˜å‚¨å¯¹è±¡ã€‚</li><li><strong>å¸¸ç”¨å‘½ä»¤</strong>:<ul><li><code>HSET key field value</code>: è®¾ç½®å“ˆå¸Œé”®ä¸­ä¸€ä¸ªå­—æ®µçš„å€¼ã€‚</li><li><code>HGET key field</code>: è·å–å“ˆå¸Œé”®ä¸­ä¸€ä¸ªå­—æ®µçš„å€¼ã€‚</li><li><code>HGETALL key</code>: è·å–å“ˆå¸Œé”®ä¸­æ‰€æœ‰çš„å­—æ®µå’Œå€¼ã€‚</li><li><code>HMSET key field1 value1 field2 value2</code>: åŒæ—¶è®¾ç½®å¤šä¸ªå­—æ®µã€‚</li><li><code>HDEL key field1 field2</code>: åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ®µã€‚</li></ul></li><li><strong>åº”ç”¨åœºæ™¯</strong>: å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ï¼ˆå¦‚<code>user:100</code>ä½œä¸ºé”®ï¼Œ<code>name</code>ã€<code>age</code>ã€<code>city</code>ä½œä¸ºå­—æ®µï¼‰ï¼Œå•†å“ä¿¡æ¯ç­‰ã€‚</li></ul><h4 id="3-List-åˆ—è¡¨"><a href="#3-List-åˆ—è¡¨" class="headerlink" title="3. List (åˆ—è¡¨)"></a>3. List (åˆ—è¡¨)</h4><ul><li><strong>ä¸€ä¸ªæœ‰åºçš„ã€å¯ä»¥é‡å¤çš„å­—ç¬¦ä¸²é›†åˆ</strong>ã€‚å¯ä»¥ä»åˆ—è¡¨çš„å¤´éƒ¨æˆ–å°¾éƒ¨æ·»åŠ æˆ–åˆ é™¤å…ƒç´ ã€‚</li><li><strong>å¸¸ç”¨å‘½ä»¤</strong>:<ul><li><code>LPUSH key value1 value2</code>: ä»åˆ—è¡¨çš„å¤´éƒ¨æ’å…¥ä¸€ä¸ªæˆ–å¤šä¸ªå€¼ã€‚</li><li><code>RPUSH key value1 value2</code>: ä»åˆ—è¡¨çš„å°¾éƒ¨æ’å…¥ä¸€ä¸ªæˆ–å¤šä¸ªå€¼ã€‚</li><li><code>LPOP key</code>: ä»åˆ—è¡¨çš„å¤´éƒ¨ç§»é™¤å¹¶è¿”å›ä¸€ä¸ªå€¼ã€‚</li><li><code>RPOP key</code>: ä»åˆ—è¡¨çš„å°¾éƒ¨ç§»é™¤å¹¶è¿”å›ä¸€ä¸ªå€¼ã€‚</li><li><code>LRANGE key start stop</code>: è·å–åˆ—è¡¨ä¸­æŒ‡å®šèŒƒå›´çš„å…ƒç´ ã€‚</li></ul></li><li><strong>åº”ç”¨åœºæ™¯</strong>: æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆé˜Ÿåˆ—ã€æ ˆï¼‰ã€æœ€æ–°æ–‡ç« åˆ—è¡¨ã€å†å²è®°å½•ç­‰ã€‚</li></ul><h4 id="4-Set-é›†åˆ"><a href="#4-Set-é›†åˆ" class="headerlink" title="4. Set (é›†åˆ)"></a>4. Set (é›†åˆ)</h4><ul><li><strong>ä¸€ä¸ªæ— åºçš„ã€ä¸é‡å¤çš„å­—ç¬¦ä¸²é›†åˆ</strong>ã€‚é›†åˆæä¾›äº†äº¤é›†ã€å¹¶é›†å’Œå·®é›†ç­‰æ“ä½œã€‚</li><li><strong>å¸¸ç”¨å‘½ä»¤</strong>:<ul><li><code>SADD key member1 member2</code>: å‘é›†åˆä¸­æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜ã€‚</li><li><code>SMEMBERS key</code>: è·å–é›†åˆä¸­çš„æ‰€æœ‰æˆå‘˜ã€‚</li><li><code>SISMEMBER key member</code>: åˆ¤æ–­ä¸€ä¸ªæˆå‘˜æ˜¯å¦åœ¨é›†åˆä¸­ã€‚</li><li><code>SINTER key1 key2</code>: æ±‚ä¸¤ä¸ªé›†åˆçš„äº¤é›†ã€‚</li><li><code>SUNION key1 key2</code>: æ±‚ä¸¤ä¸ªé›†åˆçš„å¹¶é›†ã€‚</li></ul></li><li><strong>åº”ç”¨åœºæ™¯</strong>: ç¤¾äº¤ç½‘ç»œä¸­çš„å…±åŒå¥½å‹ã€æ ‡ç­¾ç³»ç»Ÿã€å»é‡ç­‰ã€‚</li></ul><h4 id="5-Sorted-Set-æœ‰åºé›†åˆ"><a href="#5-Sorted-Set-æœ‰åºé›†åˆ" class="headerlink" title="5. Sorted Set (æœ‰åºé›†åˆ)"></a>5. Sorted Set (æœ‰åºé›†åˆ)</h4><ul><li><strong>å’Œé›†åˆç±»ä¼¼ï¼Œä½†æ¯ä¸ªæˆå‘˜éƒ½ä¼šå…³è”ä¸€ä¸ªåˆ†æ•°ï¼ˆscoreï¼‰</strong>ã€‚é€šè¿‡è¿™ä¸ªåˆ†æ•°ï¼Œå¯ä»¥å¯¹é›†åˆä¸­çš„æˆå‘˜è¿›è¡Œæ’åºã€‚åˆ†æ•°å¯ä»¥é‡å¤ï¼Œä½†æˆå‘˜å¿…é¡»å”¯ä¸€ã€‚</li><li><strong>å¸¸ç”¨å‘½ä»¤</strong>:<ul><li><code>ZADD key score1 member1 score2 member2</code>: å‘æœ‰åºé›†åˆä¸­æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå¸¦åˆ†æ•°çš„æˆå‘˜ã€‚</li><li><code>ZRANGE key start stop</code>: æŒ‰åˆ†æ•°ä»å°åˆ°å¤§æ’åºï¼Œè·å–æŒ‡å®šèŒƒå›´çš„æˆå‘˜ã€‚</li><li><code>ZREVRANGE key start stop</code>: æŒ‰åˆ†æ•°ä»å¤§åˆ°å°æ’åºï¼Œè·å–æŒ‡å®šèŒƒå›´çš„æˆå‘˜ã€‚</li><li><code>ZSCORE key member</code>: è·å–ä¸€ä¸ªæˆå‘˜çš„åˆ†æ•°ã€‚</li><li><code>ZINCRBY key increment member</code>: ç»™æŒ‡å®šæˆå‘˜çš„åˆ†æ•°å¢åŠ æŒ‡å®šå€¼ã€‚</li></ul></li><li><strong>åº”ç”¨åœºæ™¯</strong>: æ’è¡Œæ¦œï¼ˆæ¸¸æˆåˆ†æ•°ã€çƒ­ç‚¹æ–°é—»ï¼‰ã€å¸¦æƒé‡çš„ä»»åŠ¡é˜Ÿåˆ—ç­‰ã€‚</li></ul><h3 id="Redis-çš„æŒä¹…åŒ–æœºåˆ¶"><a href="#Redis-çš„æŒä¹…åŒ–æœºåˆ¶" class="headerlink" title="Redis çš„æŒä¹…åŒ–æœºåˆ¶"></a>Redis çš„æŒä¹…åŒ–æœºåˆ¶</h3><hr><p>Redis æä¾›äº†ä¸¤ç§æŒä¹…åŒ–æ–¹å¼ï¼Œå¯ä»¥å°†æ•°æ®ä»å†…å­˜ä¿å­˜åˆ°ç¡¬ç›˜ï¼Œç¡®ä¿æ•°æ®ä¸ä¼šå› ä¸ºæœåŠ¡é‡å¯è€Œä¸¢å¤±ã€‚</p><h4 id="1-RDB-Redis-Database"><a href="#1-RDB-Redis-Database" class="headerlink" title="1. RDB (Redis Database)"></a>1. RDB (Redis Database)</h4><ul><li><strong>å¿«ç…§æ–¹å¼</strong>ã€‚å®ƒä¼šåœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…ï¼Œå°†å†…å­˜ä¸­çš„æ•°æ®å¿«ç…§å†™å…¥åˆ°ç£ç›˜ä¸Šä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼ˆ<code>dump.rdb</code>ï¼‰ã€‚</li><li><strong>ä¼˜ç‚¹</strong>: RDB æ–‡ä»¶æ˜¯ä¸€ä¸ªéå¸¸ç´§å‡‘çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œéå¸¸é€‚åˆå¤‡ä»½å’Œç¾éš¾æ¢å¤ã€‚</li><li><strong>ç¼ºç‚¹</strong>: æ¯æ¬¡ä¿å­˜éƒ½ä¼šä¸¢å¤±ä»ä¸Šæ¬¡å¿«ç…§åˆ°ç°åœ¨ä¹‹é—´çš„æ•°æ®ã€‚</li></ul><h4 id="2-AOF-Append-Only-File"><a href="#2-AOF-Append-Only-File" class="headerlink" title="2. AOF (Append Only File)"></a>2. AOF (Append Only File)</h4><ul><li><strong>æ—¥å¿—æ–¹å¼</strong>ã€‚å®ƒä¼šè®°å½•æ¯ä¸€æ¬¡å¯¹ Redis æ•°æ®åº“çš„å†™æ“ä½œå‘½ä»¤ï¼Œå¹¶ä»¥è¿½åŠ ï¼ˆappendï¼‰çš„æ–¹å¼å†™å…¥åˆ°æ–‡ä»¶ä¸­ã€‚å½“ Redis é‡å¯æ—¶ï¼Œä¼šé‡æ–°æ‰§è¡Œ AOF æ–‡ä»¶ä¸­çš„å‘½ä»¤æ¥æ¢å¤æ•°æ®ã€‚</li><li><strong>ä¼˜ç‚¹</strong>: æ•°æ®ä¸¢å¤±é£é™©ä½ï¼Œå¯ä»¥é…ç½®ä¸ºæ¯ç§’åŒæ­¥ä¸€æ¬¡ï¼Œæˆ–è€…æ¯æ‰§è¡Œä¸€ä¸ªå‘½ä»¤å°±åŒæ­¥ä¸€æ¬¡ã€‚</li><li><strong>ç¼ºç‚¹</strong>: AOF æ–‡ä»¶é€šå¸¸æ¯” RDB æ–‡ä»¶å¤§ï¼Œä¸”æ¢å¤é€Ÿåº¦å¯èƒ½è¾ƒæ…¢ã€‚</li></ul><p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œé€šå¸¸ä¼š<strong>åŒæ—¶ä½¿ç”¨ RDB å’Œ AOF</strong>ï¼Œä»¥è·å¾—æ›´é«˜çš„å¯é æ€§ã€‚</p><h3 id="Redis-çš„é«˜å¯ç”¨æ€§"><a href="#Redis-çš„é«˜å¯ç”¨æ€§" class="headerlink" title="Redis çš„é«˜å¯ç”¨æ€§"></a>Redis çš„é«˜å¯ç”¨æ€§</h3><hr><h4 id="1-ä¸»ä»å¤åˆ¶-Replication"><a href="#1-ä¸»ä»å¤åˆ¶-Replication" class="headerlink" title="1. ä¸»ä»å¤åˆ¶ (Replication)"></a>1. ä¸»ä»å¤åˆ¶ (Replication)</h4><ul><li><strong>åŸºæœ¬åŸç†</strong>: å°†ä¸€ä¸ª Redis å®ä¾‹ï¼ˆä¸»èŠ‚ç‚¹ï¼‰çš„æ•°æ®å¤åˆ¶åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªå…¶ä»–å®ä¾‹ï¼ˆä»èŠ‚ç‚¹ï¼‰ã€‚ä»èŠ‚ç‚¹çš„æ•°æ®æ˜¯ä¸»èŠ‚ç‚¹çš„å®Œæ•´å‰¯æœ¬ã€‚</li><li><strong>ä½œç”¨</strong>:<ul><li><strong>æ•°æ®å¤‡ä»½</strong>: ä»èŠ‚ç‚¹å¯ä»¥ä½œä¸ºæ•°æ®çš„çƒ­å¤‡ä»½ã€‚</li><li><strong>è¯»å†™åˆ†ç¦»</strong>: å¤§å¤šæ•°è¯»æ“ä½œå¯ä»¥åˆ†æµåˆ°ä»èŠ‚ç‚¹ä¸Šï¼Œå‡è½»ä¸»èŠ‚ç‚¹çš„å‹åŠ›ã€‚</li></ul></li></ul><h4 id="2-Sentinel-å“¨å…µ"><a href="#2-Sentinel-å“¨å…µ" class="headerlink" title="2. Sentinel (å“¨å…µ)"></a>2. Sentinel (å“¨å…µ)</h4><ul><li><strong>ä½œç”¨</strong>: è‡ªåŠ¨åŒ–ç®¡ç†ä¸»ä»å¤åˆ¶é›†ç¾¤ã€‚å®ƒæ˜¯ä¸€ä¸ªç›‘æ§ç³»ç»Ÿï¼Œå¯ä»¥ç›‘æ§ä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹æ˜¯å¦æ­£å¸¸è¿è¡Œã€‚</li><li><strong>æ ¸å¿ƒåŠŸèƒ½</strong>:<ul><li><strong>ç›‘æ§</strong>: ä¸æ–­æ£€æŸ¥ä¸»ä»èŠ‚ç‚¹æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚</li><li><strong>é€šçŸ¥</strong>: å½“æŸä¸ª Redis å®ä¾‹å‡ºç°é—®é¢˜æ—¶ï¼Œä¼šå‘é€é€šçŸ¥ã€‚</li><li><strong>æ•…éšœè½¬ç§»</strong>: å¦‚æœä¸»èŠ‚ç‚¹å‘ç”Ÿæ•…éšœï¼ŒSentinel ä¼šè‡ªåŠ¨ä»å‰©ä¸‹çš„ä»èŠ‚ç‚¹ä¸­é€‰ä¸¾ä¸€ä¸ªæ–°çš„ä¸»èŠ‚ç‚¹ï¼Œå¹¶è®©å…¶ä»–ä»èŠ‚ç‚¹åˆ‡æ¢åˆ°è¿™ä¸ªæ–°çš„ä¸»èŠ‚ç‚¹ä¸Šï¼Œä»è€Œå®ç°é«˜å¯ç”¨ã€‚</li></ul></li></ul><h4 id="3-Redis-Cluster-é›†ç¾¤"><a href="#3-Redis-Cluster-é›†ç¾¤" class="headerlink" title="3. Redis Cluster (é›†ç¾¤)"></a>3. Redis Cluster (é›†ç¾¤)</h4><ul><li><strong>ä½œç”¨</strong>: è§£å†³ Redis å•æœºå†…å­˜å®¹é‡å’Œå¹¶å‘é‡çš„ç“¶é¢ˆé—®é¢˜ã€‚å®ƒå°†æ•°æ®åˆ†æ•£åˆ°å¤šä¸ªèŠ‚ç‚¹ä¸Šï¼Œæ¯ä¸ªèŠ‚ç‚¹åªè´Ÿè´£å­˜å‚¨éƒ¨åˆ†æ•°æ®ã€‚</li><li><strong>æ ¸å¿ƒåŠŸèƒ½</strong>:<ul><li><strong>æ•°æ®åˆ†ç‰‡</strong>: è‡ªåŠ¨å°†æ•°æ®åˆ†å¸ƒåœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šã€‚</li><li><strong>é«˜å¯ç”¨æ€§</strong>: å³ä½¿éƒ¨åˆ†èŠ‚ç‚¹å®•æœºï¼Œé›†ç¾¤ä¹Ÿèƒ½ç»§ç»­æ­£å¸¸å·¥ä½œã€‚</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> åˆ†å¸ƒå¼å¾®æœåŠ¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ‰‹å†™ç­”æ¡ˆ</title>
      <link href="/2025/09/11/%E6%89%8B%E5%86%99%E7%AD%94%E6%A1%88/"/>
      <url>/2025/09/11/%E6%89%8B%E5%86%99%E7%AD%94%E6%A1%88/</url>
      
        <content type="html"><![CDATA[<h3 id="1-å®ç°å•ä¾‹æ¨¡å¼-Singleton-Pattern"><a href="#1-å®ç°å•ä¾‹æ¨¡å¼-Singleton-Pattern" class="headerlink" title="1.å®ç°å•ä¾‹æ¨¡å¼ (Singleton Pattern)"></a>1.å®ç°å•ä¾‹æ¨¡å¼ (Singleton Pattern)</h3><h4 id="æ‡’æ±‰å¼ï¼š"><a href="#æ‡’æ±‰å¼ï¼š" class="headerlink" title="æ‡’æ±‰å¼ï¼š"></a>æ‡’æ±‰å¼ï¼š</h4><p>ä½¿ç”¨<strong>åŒé‡æ£€æŸ¥é”å®š (DCL)</strong> å®ç°çº¿ç¨‹å®‰å…¨çš„æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼ã€‚è¿™ç§æ¨¡å¼åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶æ‰åˆ›å»ºå®ä¾‹ï¼Œå¹¶ä¸”é€šè¿‡ä¸¤æ¬¡æ£€æŸ¥å’ŒåŒæ­¥å—ç¡®ä¿äº†çº¿ç¨‹å®‰å…¨å’Œæ€§èƒ½ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">    <span class="comment">// 1. volatile å…³é”®å­—ç¡®ä¿å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œinstance å˜é‡çš„ä¿®æ”¹èƒ½å¤Ÿç«‹å³è¢«å…¶ä»–çº¿ç¨‹çœ‹åˆ°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> Singleton instance;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. ç§æœ‰åŒ–æ„é€ å™¨ï¼Œé˜²æ­¢å¤–éƒ¨ç›´æ¥ new å®ä¾‹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. æä¾›ä¸€ä¸ªå…¨å±€è®¿é—®ç‚¹ï¼Œä½¿ç”¨ DCL ç¡®ä¿çº¿ç¨‹å®‰å…¨</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// ç¬¬ä¸€æ¬¡æ£€æŸ¥ï¼šå¦‚æœå®ä¾‹å·²ç»å­˜åœ¨ï¼Œç›´æ¥è¿”å›ï¼Œé¿å…ä¸å¿…è¦çš„åŒæ­¥</span></span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// ç¬¬ä¸€æ¬¡æ£€æŸ¥å¤±è´¥ï¼Œè¿›å…¥åŒæ­¥å—</span></span><br><span class="line">            <span class="keyword">synchronized</span> (Singleton.class) &#123;</span><br><span class="line">                <span class="comment">// ç¬¬äºŒæ¬¡æ£€æŸ¥ï¼šåœ¨åŒæ­¥å—å†…éƒ¨å†æ¬¡æ£€æŸ¥ï¼Œé˜²æ­¢å¤šä¸ªçº¿ç¨‹åŒæ—¶é€šè¿‡ç¬¬ä¸€æ¬¡æ£€æŸ¥ï¼Œ</span></span><br><span class="line">                <span class="comment">// å¯¼è‡´åˆ›å»ºå¤šä¸ªå®ä¾‹</span></span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// åˆ›å»ºå®ä¾‹</span></span><br><span class="line">                    instance = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">showMessage</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;è¿™æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼å®ä¾‹ã€‚&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h4 id="é¥¿æ±‰å¼ï¼š"><a href="#é¥¿æ±‰å¼ï¼š" class="headerlink" title="é¥¿æ±‰å¼ï¼š"></a>é¥¿æ±‰å¼ï¼š</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> test1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SingletonEager</span> &#123;</span><br><span class="line">    <span class="comment">// 1. åœ¨ç±»åŠ è½½æ—¶å°±åˆ›å»ºé™æ€å®ä¾‹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">SingletonEager</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SingletonEager</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. ç§æœ‰åŒ–æ„é€ å™¨ï¼Œé˜²æ­¢å¤–éƒ¨ç›´æ¥åˆ›å»ºå®ä¾‹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">SingletonEager</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. æä¾›ä¸€ä¸ªå…¬å…±çš„é™æ€æ–¹æ³•æ¥è·å–å”¯ä¸€å®ä¾‹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SingletonEager <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">showMessage</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;è¿™æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼å®ä¾‹ã€‚&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-ç»§æ‰¿ä¸å¤šæ€-Inheritance-and-Polymorphism"><a href="#2-ç»§æ‰¿ä¸å¤šæ€-Inheritance-and-Polymorphism" class="headerlink" title="2.ç»§æ‰¿ä¸å¤šæ€ (Inheritance and Polymorphism)"></a>2.ç»§æ‰¿ä¸å¤šæ€ (Inheritance and Polymorphism)</h3><p>è®¾è®¡ä¸€ä¸ª <code>Animal</code> æŠ½è±¡ç±»ï¼Œå¹¶åˆ›å»º <code>Dog</code> å’Œ <code>Cat</code> ç±»æ¥å±•ç¤ºç»§æ‰¿å’Œå¤šæ€ã€‚&#x3D;</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. Animal æŠ½è±¡ç±»ï¼Œå®šä¹‰é€šç”¨è¡Œä¸º</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="comment">// æŠ½è±¡æ–¹æ³•ï¼Œå­ç±»å¿…é¡»å®ç°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">eat</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. Dog ç±»ç»§æ‰¿ Animalï¼Œå¹¶é‡å†™ eat() æ–¹æ³•</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span> <span class="keyword">extends</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eat</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ç‹—æ­£åœ¨åƒéª¨å¤´ã€‚&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. Cat ç±»ç»§æ‰¿ Animalï¼Œå¹¶é‡å†™ eat() æ–¹æ³•</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span> <span class="keyword">extends</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eat</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;çŒ«æ­£åœ¨åƒé±¼ã€‚&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. å±•ç¤ºå¤šæ€çš„ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PolymorphismDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">showPolymorphism</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// çˆ¶ç±»å¼•ç”¨æŒ‡å‘å­ç±»å¯¹è±¡ï¼Œè¿™å°±æ˜¯å¤šæ€</span></span><br><span class="line">        <span class="type">Animal</span> <span class="variable">myDog</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dog</span>();</span><br><span class="line">        <span class="type">Animal</span> <span class="variable">myCat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cat</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è°ƒç”¨ç›¸åŒçš„æ–¹æ³•ï¼Œä½†ç”±äºæŒ‡å‘ä¸åŒçš„å­ç±»å®ä¾‹ï¼Œæ‰§è¡Œä¸åŒçš„è¡Œä¸º</span></span><br><span class="line">        myDog.eat(); <span class="comment">// è¾“å‡º: ç‹—æ­£åœ¨åƒéª¨å¤´ã€‚</span></span><br><span class="line">        myCat.eat(); <span class="comment">// è¾“å‡º: çŒ«æ­£åœ¨åƒé±¼ã€‚</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="equals-å’Œ-hashCode"><a href="#equals-å’Œ-hashCode" class="headerlink" title="equals() å’Œ hashCode()"></a><code>equals()</code> å’Œ <code>hashCode()</code></h3><p>ç¼–å†™ <code>Student</code> ç±»ï¼Œå¹¶é‡å†™ <code>equals()</code> å’Œ <code>hashCode()</code>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">(<span class="type">int</span> id, String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é‡å†™ equals() æ–¹æ³•ï¼Œæ ¹æ® id å’Œ name åˆ¤æ–­ä¸¤ä¸ª Student å¯¹è±¡æ˜¯å¦ç›¸ç­‰</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. æ£€æŸ¥æ˜¯å¦ä¸ºåŒä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span> == o) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="comment">// 2. æ£€æŸ¥å¯¹è±¡æ˜¯å¦ä¸º null æˆ–ç±»å‹æ˜¯å¦åŒ¹é…</span></span><br><span class="line">        <span class="keyword">if</span> (o == <span class="literal">null</span> || getClass() != o.getClass()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">// 3. ç±»å‹è½¬æ¢</span></span><br><span class="line">        <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> (Student) o;</span><br><span class="line">        <span class="comment">// 4. æ¯”è¾ƒå…³é”®å­—æ®µ (id å’Œ name)</span></span><br><span class="line">        <span class="keyword">return</span> id == student.id &amp;&amp;</span><br><span class="line">               Objects.equals(name, student.name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é‡å†™ hashCode() æ–¹æ³•ï¼Œä¸ºç›¸ç­‰çš„å¯¹è±¡ç”Ÿæˆç›¸åŒçš„å“ˆå¸Œç </span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// ä½¿ç”¨ Objects.hash() æ–¹æ³•ç”Ÿæˆå“ˆå¸Œç ï¼Œå®ƒä¼šä¸ºå¤šä¸ªå­—æ®µç”Ÿæˆä¸€ä¸ªç»„åˆå“ˆå¸Œå€¼</span></span><br><span class="line">        <span class="keyword">return</span> Objects.hash(id, name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* ä¸ºä»€ä¹ˆéœ€è¦ä¸¤è€…ä¸€èµ·é‡å†™ï¼Ÿ</span></span><br><span class="line"><span class="comment">* 1. å®ƒä»¬ä¹‹é—´å­˜åœ¨çº¦å®šï¼šå¦‚æœä¸¤ä¸ªå¯¹è±¡é€šè¿‡ equals() æ–¹æ³•æ¯”è¾ƒæ˜¯ç›¸ç­‰çš„ï¼Œé‚£ä¹ˆå®ƒä»¬çš„ hashCode() æ–¹æ³•è¿”å›çš„å€¼ä¹Ÿå¿…é¡»ç›¸ç­‰ã€‚</span></span><br><span class="line"><span class="comment">* åä¹‹åˆ™ä¸ä¸€å®šï¼Œä¸ç›¸ç­‰çš„å¯¹è±¡å¯ä»¥æœ‰ç›¸åŒçš„å“ˆå¸Œç ï¼ˆå“ˆå¸Œå†²çªï¼‰ã€‚</span></span><br><span class="line"><span class="comment">* 2. å“ˆå¸Œè¡¨ç±»ï¼ˆå¦‚ HashSet, HashMapï¼‰ä¾èµ–äºè¿™ä¸ªçº¦å®šï¼šå½“å°†å¯¹è±¡å­˜å…¥å“ˆå¸Œè¡¨æ—¶ï¼Œ</span></span><br><span class="line"><span class="comment">* å®ƒä¼šå…ˆè°ƒç”¨ hashCode() ç¡®å®šå­˜å‚¨ä½ç½®ï¼Œå†è°ƒç”¨ equals() æ¥ç¡®è®¤æ˜¯å¦å­˜åœ¨ç›¸åŒçš„å¯¹è±¡ã€‚</span></span><br><span class="line"><span class="comment">* 3. å¦‚æœåªé‡å†™ equals() ä½†ä¸é‡å†™ hashCode()ï¼Œå¯èƒ½å¯¼è‡´ä¸¤ä¸ªé€»è¾‘ä¸Šç›¸ç­‰çš„å¯¹è±¡è¢«å­˜å‚¨åœ¨ä¸åŒçš„å“ˆå¸Œä½ç½®ï¼Œ</span></span><br><span class="line"><span class="comment">* ä»è€Œæ— æ³•æ­£ç¡®æŸ¥æ‰¾å’Œå»é‡ã€‚ä¾‹å¦‚ï¼Œåœ¨ HashSet ä¸­ï¼Œå³ä½¿ä¸¤ä¸ª Student å¯¹è±¡ id å’Œ name ç›¸åŒï¼Œ</span></span><br><span class="line"><span class="comment">* ä¹Ÿä¼šè¢«è®¤ä¸ºæ˜¯ä¸åŒçš„å¯¹è±¡è€Œé‡å¤æ·»åŠ ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><hr><h3 id="æ¥å£ä¸å®ç°-Interfaces-and-Implementation"><a href="#æ¥å£ä¸å®ç°-Interfaces-and-Implementation" class="headerlink" title="æ¥å£ä¸å®ç° (Interfaces and Implementation)"></a>æ¥å£ä¸å®ç° (Interfaces and Implementation)</h3><p>è®¾è®¡ <code>Drawable</code> æ¥å£ï¼Œå¹¶ç”± <code>Circle</code> å’Œ <code>Rectangle</code> å®ç°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. å®šä¹‰ Drawable æ¥å£ï¼ŒåŒ…å«ä¸€ä¸ªæŠ½è±¡æ–¹æ³•</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Drawable</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. Circle ç±»å®ç° Drawable æ¥å£</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Circle</span> <span class="keyword">implements</span> <span class="title class_">Drawable</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ­£åœ¨ç”»ä¸€ä¸ªåœ†å½¢ã€‚&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. Rectangle ç±»å®ç° Drawable æ¥å£</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Rectangle</span> <span class="keyword">implements</span> <span class="title class_">Drawable</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ­£åœ¨ç”»ä¸€ä¸ªçŸ©å½¢ã€‚&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="å¼‚å¸¸å¤„ç†-Exception-Handling"><a href="#å¼‚å¸¸å¤„ç†-Exception-Handling" class="headerlink" title="å¼‚å¸¸å¤„ç† (Exception Handling)"></a>å¼‚å¸¸å¤„ç† (Exception Handling)</h3><p>ä½¿ç”¨ <code>try-catch-finally</code> ç»“æ„å¤„ç† <code>FileNotFoundException</code> å¹¶ç¡®ä¿èµ„æºå…³é—­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ExceptionDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">processFile</span><span class="params">(String filePath)</span> &#123;</span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="literal">null</span>; <span class="comment">// åœ¨ try å—å¤–éƒ¨å£°æ˜ï¼Œä»¥ä¾¿åœ¨ finally å—ä¸­è®¿é—®</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// å°è¯•æ‰“å¼€æ–‡ä»¶</span></span><br><span class="line">            fileInputStream = <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(filePath);</span><br><span class="line">            System.out.println(<span class="string">&quot;æ–‡ä»¶å·²æˆåŠŸæ‰“å¼€ã€‚&quot;</span>);</span><br><span class="line">            <span class="comment">// å‡è®¾è¿™é‡Œè¿›è¡Œæ–‡ä»¶è¯»å–æ“ä½œ</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">            <span class="comment">// æ•è·æ–‡ä»¶æœªæ‰¾åˆ°å¼‚å¸¸</span></span><br><span class="line">            System.err.println(<span class="string">&quot;é”™è¯¯ï¼šæŒ‡å®šçš„æ–‡ä»¶ä¸å­˜åœ¨ï¼è·¯å¾„ï¼š&quot;</span> + filePath);</span><br><span class="line">            e.printStackTrace(); <span class="comment">// æ‰“å°å¼‚å¸¸å †æ ˆä¿¡æ¯</span></span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// æ— è®ºæ˜¯å¦å‘ç”Ÿå¼‚å¸¸ï¼Œfinally å—éƒ½ä¼šæ‰§è¡Œ</span></span><br><span class="line">            <span class="keyword">if</span> (fileInputStream != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// ç¡®ä¿æ–‡ä»¶æµè¢«å…³é—­ï¼Œé˜²æ­¢èµ„æºæ³„éœ²</span></span><br><span class="line">                    fileInputStream.close();</span><br><span class="line">                    System.out.println(<span class="string">&quot;æ–‡ä»¶æµå·²åœ¨ finally å—ä¸­å…³é—­ã€‚&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    System.err.println(<span class="string">&quot;å…³é—­æ–‡ä»¶æµæ—¶å‘ç”Ÿå¼‚å¸¸ï¼š&quot;</span> + e.getMessage());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="try-with-resources"><a href="#try-with-resources" class="headerlink" title="try-with-resources"></a><code>try-with-resources</code></h3><p>ä½¿ç”¨ <code>try-with-resources</code> é‡å†™ä¸Šä¸€ä¸ªé¢˜ç›®ï¼Œå±•ç¤ºå…¶ç®€åŒ–ä¼˜åŠ¿ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TryWithResourcesDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">processFileWithResources</span><span class="params">(String filePath)</span> &#123;</span><br><span class="line">        <span class="comment">// try-with-resources è¯­å¥ï¼Œè‡ªåŠ¨ç®¡ç†å®ç°äº† AutoCloseable æ¥å£çš„èµ„æº</span></span><br><span class="line">        <span class="keyword">try</span> (<span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(filePath)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ–‡ä»¶å·²æˆåŠŸæ‰“å¼€ã€‚&quot;</span>);</span><br><span class="line">            <span class="comment">// å‡è®¾è¿™é‡Œè¿›è¡Œæ–‡ä»¶è¯»å–æ“ä½œ</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">            <span class="comment">// æ•è·æ–‡ä»¶æœªæ‰¾åˆ°å¼‚å¸¸</span></span><br><span class="line">            System.err.println(<span class="string">&quot;é”™è¯¯ï¼šæŒ‡å®šçš„æ–‡ä»¶ä¸å­˜åœ¨ï¼è·¯å¾„ï¼š&quot;</span> + filePath);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="comment">// æ•è·æ–‡ä»¶å…³é—­æ—¶å¯èƒ½å‘ç”Ÿçš„å¼‚å¸¸</span></span><br><span class="line">            System.err.println(<span class="string">&quot;å…³é—­æ–‡ä»¶æµæ—¶å‘ç”Ÿå¼‚å¸¸ï¼š&quot;</span> + e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ä¸éœ€è¦å•ç‹¬çš„ finally å—æ¥å…³é—­èµ„æºï¼ŒJVM ä¼šè‡ªåŠ¨å®Œæˆ</span></span><br><span class="line">        System.out.println(<span class="string">&quot;æ–‡ä»¶æµå·²åœ¨ try-with-resources è¯­å¥ä¸­è‡ªåŠ¨å…³é—­ã€‚&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* try-with-resources çš„ä¼˜åŠ¿ï¼š</span></span><br><span class="line"><span class="comment">* 1. ç®€åŒ–ä»£ç ï¼šä¸å†éœ€è¦æ˜¾å¼çš„ finally å—æ¥å…³é—­èµ„æºï¼Œä»£ç æ›´ç®€æ´ã€‚</span></span><br><span class="line"><span class="comment">* 2. é¿å…èµ„æºæ³„éœ²ï¼šæ— è®º try å—æ˜¯å¦æ­£å¸¸å®Œæˆæˆ–æŠ›å‡ºå¼‚å¸¸ï¼Œèµ„æºéƒ½ä¼šè¢«è‡ªåŠ¨å…³é—­ï¼Œ</span></span><br><span class="line"><span class="comment">* æœ‰æ•ˆé˜²æ­¢äº†å› å¿˜è®°å…³é—­èµ„æºè€Œå¯¼è‡´çš„å†…å­˜å’Œæ–‡ä»¶å¥æŸ„æ³„éœ²ã€‚</span></span><br><span class="line"><span class="comment">* 3. æ›´å¥½çš„å¼‚å¸¸å¤„ç†ï¼šå¦‚æœ try å—å’Œèµ„æºå…³é—­æ—¶éƒ½æŠ›å‡ºå¼‚å¸¸ï¼Œtry-with-resources ä¼š</span></span><br><span class="line"><span class="comment">* å°†èµ„æºå…³é—­æ—¶æŠ›å‡ºçš„å¼‚å¸¸ä½œä¸ºè¢«æŠ‘åˆ¶ï¼ˆsuppressedï¼‰çš„å¼‚å¸¸ï¼Œä¸»å¼‚å¸¸ä¿æŒä¸å˜ï¼Œ</span></span><br><span class="line"><span class="comment">* ä¾¿äºè°ƒè¯•ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h3 id="å†’æ³¡æ’åº-Bubble-Sort"><a href="#å†’æ³¡æ’åº-Bubble-Sort" class="headerlink" title="å†’æ³¡æ’åº (Bubble Sort)"></a>å†’æ³¡æ’åº (Bubble Sort)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SortingAlgorithms</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">bubbleSort</span><span class="params">(<span class="type">int</span>[] arr)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (arr == <span class="literal">null</span> || arr.length &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> arr.length;</span><br><span class="line">        <span class="comment">// å¤–å±‚å¾ªç¯æ§åˆ¶æ¯”è¾ƒè½®æ•°ï¼Œå…±è¿›è¡Œ n-1 è½®</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n - <span class="number">1</span>; i++) &#123;</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">swapped</span> <span class="operator">=</span> <span class="literal">false</span>; <span class="comment">// ä¼˜åŒ–ï¼šå¦‚æœåœ¨æŸä¸€è½®æ²¡æœ‰å‘ç”Ÿäº¤æ¢ï¼Œè¯´æ˜æ•°ç»„å·²ç»æœ‰åº</span></span><br><span class="line">            <span class="comment">// å†…å±‚å¾ªç¯è´Ÿè´£æ¯è½®æ¯”è¾ƒå’Œäº¤æ¢ï¼Œå°†æœ€å¤§å…ƒç´ â€œå†’â€åˆ°æ•°ç»„æœ«å°¾</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; n - <span class="number">1</span> - i; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (arr[j] &gt; arr[j + <span class="number">1</span>]) &#123;</span><br><span class="line">                    <span class="comment">// äº¤æ¢å…ƒç´ </span></span><br><span class="line">                    <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> arr[j];</span><br><span class="line">                    arr[j] = arr[j + <span class="number">1</span>];</span><br><span class="line">                    arr[j + <span class="number">1</span>] = temp;</span><br><span class="line">                    swapped = <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!swapped) &#123;</span><br><span class="line">                <span class="keyword">break</span>; <span class="comment">// å¦‚æœæ²¡æœ‰å‘ç”Ÿäº¤æ¢ï¼Œæå‰ç»“æŸæ’åº</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="å¿«é€Ÿæ’åº-Quick-Sort"><a href="#å¿«é€Ÿæ’åº-Quick-Sort" class="headerlink" title="å¿«é€Ÿæ’åº (Quick Sort)"></a>å¿«é€Ÿæ’åº (Quick Sort)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SortingAlgorithms</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">quickSort</span><span class="params">(<span class="type">int</span>[] arr)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (arr == <span class="literal">null</span> || arr.length &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        quickSort(arr, <span class="number">0</span>, arr.length - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">quickSort</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> low, <span class="type">int</span> high)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (low &lt; high) &#123;</span><br><span class="line">            <span class="comment">// æ‰¾åˆ°åŸºå‡†å…ƒç´ çš„æ­£ç¡®ä½ç½®</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">pivotIndex</span> <span class="operator">=</span> partition(arr, low, high);</span><br><span class="line">            <span class="comment">// é€’å½’åœ°å¯¹å·¦å­æ•°ç»„è¿›è¡Œæ’åº</span></span><br><span class="line">            quickSort(arr, low, pivotIndex - <span class="number">1</span>);</span><br><span class="line">            <span class="comment">// é€’å½’åœ°å¯¹å³å­æ•°ç»„è¿›è¡Œæ’åº</span></span><br><span class="line">            quickSort(arr, pivotIndex + <span class="number">1</span>, high);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">partition</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> low, <span class="type">int</span> high)</span> &#123;</span><br><span class="line">        <span class="comment">// é€‰æ‹©æœ€å³è¾¹çš„å…ƒç´ ä½œä¸ºåŸºå‡†</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">pivot</span> <span class="operator">=</span> arr[high];</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> (low - <span class="number">1</span>); <span class="comment">// i æŒ‡å‘å°äºç­‰äºåŸºå‡†çš„å…ƒç´ çš„æœ€åä¸€ä¸ªä½ç½®</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> low; j &lt; high; j++) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœå½“å‰å…ƒç´ å°äºç­‰äºåŸºå‡†</span></span><br><span class="line">            <span class="keyword">if</span> (arr[j] &lt;= pivot) &#123;</span><br><span class="line">                i++;</span><br><span class="line">                <span class="comment">// äº¤æ¢ arr[i] å’Œ arr[j]</span></span><br><span class="line">                <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> arr[i];</span><br><span class="line">                arr[i] = arr[j];</span><br><span class="line">                arr[j] = temp;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å°†åŸºå‡†å…ƒç´ æ”¾åˆ°æ­£ç¡®çš„ä½ç½®</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> arr[i + <span class="number">1</span>];</span><br><span class="line">        arr[i + <span class="number">1</span>] = arr[high];</span><br><span class="line">        arr[high] = temp;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> i + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="äºŒåˆ†æŸ¥æ‰¾-Binary-Search"><a href="#äºŒåˆ†æŸ¥æ‰¾-Binary-Search" class="headerlink" title="äºŒåˆ†æŸ¥æ‰¾ (Binary Search)"></a>äºŒåˆ†æŸ¥æ‰¾ (Binary Search)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SearchAlgorithms</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">binarySearch</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (arr == <span class="literal">null</span> || arr.length == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> arr.length - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (left &lt;= right) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> left + (right - left) / <span class="number">2</span>; <span class="comment">// é˜²æ­¢æ•´æ•°æº¢å‡º</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (arr[mid] == target) &#123;</span><br><span class="line">                <span class="keyword">return</span> mid; <span class="comment">// æ‰¾åˆ°ç›®æ ‡ï¼Œè¿”å›ç´¢å¼•</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (arr[mid] &lt; target) &#123;</span><br><span class="line">                left = mid + <span class="number">1</span>; <span class="comment">// ç›®æ ‡åœ¨å³åŠéƒ¨åˆ†ï¼Œæ›´æ–°å·¦è¾¹ç•Œ</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                right = mid - <span class="number">1</span>; <span class="comment">// ç›®æ ‡åœ¨å·¦åŠéƒ¨åˆ†ï¼Œæ›´æ–°å³è¾¹ç•Œ</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>; <span class="comment">// æ²¡æœ‰æ‰¾åˆ°ç›®æ ‡</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="é“¾è¡¨åè½¬-Reverse-Linked-List"><a href="#é“¾è¡¨åè½¬-Reverse-Linked-List" class="headerlink" title="é“¾è¡¨åè½¬ (Reverse Linked List)"></a>é“¾è¡¨åè½¬ (Reverse Linked List)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LinkedListProblems</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ListNode</span> &#123;</span><br><span class="line">        <span class="type">int</span> val;</span><br><span class="line">        ListNode next;</span><br><span class="line">        ListNode(<span class="type">int</span> x) &#123; val = x; &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ListNode <span class="title function_">reverseList</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">prev</span> <span class="operator">=</span> <span class="literal">null</span>; <span class="comment">// å‰ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">current</span> <span class="operator">=</span> head; <span class="comment">// å½“å‰èŠ‚ç‚¹</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (current != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">ListNode</span> <span class="variable">nextTemp</span> <span class="operator">=</span> current.next; <span class="comment">// æš‚å­˜ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">            current.next = prev; <span class="comment">// å°†å½“å‰èŠ‚ç‚¹çš„æŒ‡é’ˆæŒ‡å‘å‰ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">            prev = current; <span class="comment">// å‰ä¸€ä¸ªèŠ‚ç‚¹å‘å‰ç§»åŠ¨</span></span><br><span class="line">            current = nextTemp; <span class="comment">// å½“å‰èŠ‚ç‚¹å‘å‰ç§»åŠ¨</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> prev; <span class="comment">// prev æœ€ç»ˆä¼šæ˜¯æ–°çš„å¤´èŠ‚ç‚¹</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="é“¾è¡¨ä¸­é—´èŠ‚ç‚¹-Middle-of-Linked-List"><a href="#é“¾è¡¨ä¸­é—´èŠ‚ç‚¹-Middle-of-Linked-List" class="headerlink" title="é“¾è¡¨ä¸­é—´èŠ‚ç‚¹ (Middle of Linked List)"></a>é“¾è¡¨ä¸­é—´èŠ‚ç‚¹ (Middle of Linked List)</h3><p>ä½¿ç”¨<strong>å¿«æ…¢æŒ‡é’ˆ</strong>ï¼Œå¿«æŒ‡é’ˆæ¯æ¬¡èµ°ä¸¤æ­¥ï¼Œæ…¢æŒ‡é’ˆæ¯æ¬¡èµ°ä¸€æ­¥ã€‚å½“å¿«æŒ‡é’ˆåˆ°è¾¾é“¾è¡¨æœ«å°¾æ—¶ï¼Œæ…¢æŒ‡é’ˆæ­£å¥½åœ¨ä¸­é—´ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LinkedListProblems</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ListNode</span> &#123;</span><br><span class="line">        <span class="type">int</span> val;</span><br><span class="line">        ListNode next;</span><br><span class="line">        ListNode(<span class="type">int</span> x) &#123; val = x; &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ListNode <span class="title function_">findMiddleNode</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (head == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">slow</span> <span class="operator">=</span> head; <span class="comment">// æ…¢æŒ‡é’ˆï¼Œæ¯æ¬¡èµ°ä¸€æ­¥</span></span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">fast</span> <span class="operator">=</span> head; <span class="comment">// å¿«æŒ‡é’ˆï¼Œæ¯æ¬¡èµ°ä¸¤æ­¥</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// å½“å¿«æŒ‡é’ˆåˆ°è¾¾æœ«å°¾æ—¶ï¼Œæ…¢æŒ‡é’ˆæ­£å¥½åœ¨ä¸­é—´</span></span><br><span class="line">        <span class="keyword">while</span> (fast != <span class="literal">null</span> &amp;&amp; fast.next != <span class="literal">null</span>) &#123;</span><br><span class="line">            slow = slow.next;</span><br><span class="line">            fast = fast.next.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> slow;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="ç§»é™¤é‡å¤å…ƒç´ -Remove-Duplicates"><a href="#ç§»é™¤é‡å¤å…ƒç´ -Remove-Duplicates" class="headerlink" title="ç§»é™¤é‡å¤å…ƒç´  (Remove Duplicates)"></a>ç§»é™¤é‡å¤å…ƒç´  (Remove Duplicates)</h3><p>ä¸ä½¿ç”¨ <code>Set</code>ï¼Œé€šè¿‡åŒå±‚å¾ªç¯æˆ–æ’åºåéå†å®ç°ã€‚è¿™é‡Œä½¿ç”¨æ’åºåéå†çš„æ–¹æ³•ï¼Œå› ä¸ºå®ƒæ›´é«˜æ•ˆã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ListProblems</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">removeDuplicates</span><span class="params">(ArrayList&lt;String&gt; list)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (list == <span class="literal">null</span> || list.size() &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Collections.sort(list); <span class="comment">// å…ˆæ’åºï¼Œä½¿å¾—é‡å¤å…ƒç´ ç›¸é‚»</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å€’åºéå†ï¼Œç§»é™¤é‡å¤å…ƒç´ </span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> list.size() - <span class="number">2</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            <span class="keyword">if</span> (list.get(i).equals(list.get(i + <span class="number">1</span>))) &#123;</span><br><span class="line">                list.remove(i + <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="å­—ç¬¦ä¸²åè½¬-Reverse-String"><a href="#å­—ç¬¦ä¸²åè½¬-Reverse-String" class="headerlink" title="å­—ç¬¦ä¸²åè½¬ (Reverse String)"></a>å­—ç¬¦ä¸²åè½¬ (Reverse String)</h3><p>ä¸ä½¿ç”¨ <code>StringBuilder</code> æˆ– <code>StringBuffer</code> çš„ <code>reverse()</code> æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringProblems</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">reverseString</span><span class="params">(String str)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (str == <span class="literal">null</span> || str.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> str;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">char</span>[] charArray = str.toCharArray();</span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> charArray.length - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (left &lt; right) &#123;</span><br><span class="line">            <span class="comment">// äº¤æ¢é¦–å°¾å­—ç¬¦</span></span><br><span class="line">            <span class="type">char</span> <span class="variable">temp</span> <span class="operator">=</span> charArray[left];</span><br><span class="line">            charArray[left] = charArray[right];</span><br><span class="line">            charArray[right] = temp;</span><br><span class="line">            left++;</span><br><span class="line">            right--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(charArray);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="å›æ–‡å­—ç¬¦ä¸²-Palindrome-String"><a href="#å›æ–‡å­—ç¬¦ä¸²-Palindrome-String" class="headerlink" title="å›æ–‡å­—ç¬¦ä¸² (Palindrome String)"></a>å›æ–‡å­—ç¬¦ä¸² (Palindrome String)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringProblems</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isPalindrome</span><span class="params">(String str)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (str == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå°å†™å¹¶ç§»é™¤éå­—æ¯æ•°å­—å­—ç¬¦</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">cleanedStr</span> <span class="operator">=</span> str.toLowerCase().replaceAll(<span class="string">&quot;[^a-z0-9]&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> cleanedStr.length() - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (left &lt; right) &#123;</span><br><span class="line">            <span class="keyword">if</span> (cleanedStr.charAt(left) != cleanedStr.charAt(right)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            left++;</span><br><span class="line">            right--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="è®¡ç®—é˜¶ä¹˜-Factorial-Calculation"><a href="#è®¡ç®—é˜¶ä¹˜-Factorial-Calculation" class="headerlink" title="è®¡ç®—é˜¶ä¹˜ (Factorial Calculation)"></a>è®¡ç®—é˜¶ä¹˜ (Factorial Calculation)</h3><h4 id="é€’å½’æ–¹å¼"><a href="#é€’å½’æ–¹å¼" class="headerlink" title="é€’å½’æ–¹å¼"></a>é€’å½’æ–¹å¼</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MathProblems</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">long</span> <span class="title function_">factorialRecursive</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (n &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Factorial is not defined for negative numbers.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">0</span> || n == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> n * factorialRecursive(n - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="éé€’å½’æ–¹å¼"><a href="#éé€’å½’æ–¹å¼" class="headerlink" title="éé€’å½’æ–¹å¼"></a>éé€’å½’æ–¹å¼</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public class MathProblems &#123;</span><br><span class="line">    public static long factorialIterative(int n) &#123;</span><br><span class="line">        if (n &lt; 0) &#123;</span><br><span class="line">            throw new IllegalArgumentException(&quot;Factorial is not defined for negative numbers.&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        long result = 1;</span><br><span class="line">        for (int i = 2; i &lt;= n; i++) &#123;</span><br><span class="line">            result *= i;</span><br><span class="line">        &#125;</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="æ–æ³¢é‚£å¥‘æ•°åˆ—-Fibonacci-Sequence"><a href="#æ–æ³¢é‚£å¥‘æ•°åˆ—-Fibonacci-Sequence" class="headerlink" title="æ–æ³¢é‚£å¥‘æ•°åˆ— (Fibonacci Sequence)"></a>æ–æ³¢é‚£å¥‘æ•°åˆ— (Fibonacci Sequence)</h3><h4 id="é€’å½’æ–¹å¼-1"><a href="#é€’å½’æ–¹å¼-1" class="headerlink" title="é€’å½’æ–¹å¼"></a>é€’å½’æ–¹å¼</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MathProblems</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">long</span> <span class="title function_">fibonacciRecursive</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (n &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Invalid input for Fibonacci sequence.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> fibonacciRecursive(n - <span class="number">1</span>) + fibonacciRecursive(n - <span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="éé€’å½’æ–¹å¼-1"><a href="#éé€’å½’æ–¹å¼-1" class="headerlink" title="éé€’å½’æ–¹å¼"></a>éé€’å½’æ–¹å¼</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MathProblems</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">long</span> <span class="title function_">fibonacciIterative</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (n &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Invalid input for Fibonacci sequence.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">long</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">sum</span> <span class="operator">=</span> a + b;</span><br><span class="line">            a = b;</span><br><span class="line">            b = sum;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="å­—ç¬¦ä¸²ä¸­å­—ç¬¦è®¡æ•°-Character-Count"><a href="#å­—ç¬¦ä¸²ä¸­å­—ç¬¦è®¡æ•°-Character-Count" class="headerlink" title="å­—ç¬¦ä¸²ä¸­å­—ç¬¦è®¡æ•° (Character Count)"></a>å­—ç¬¦ä¸²ä¸­å­—ç¬¦è®¡æ•° (Character Count)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringProblems</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Map&lt;Character, Integer&gt; <span class="title function_">countCharacters</span><span class="params">(String str)</span> &#123;</span><br><span class="line">        Map&lt;Character, Integer&gt; charCountMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> (str == <span class="literal">null</span> || str.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> charCountMap;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">char</span> c : str.toCharArray()) &#123;</span><br><span class="line">            charCountMap.put(c, charCountMap.getOrDefault(c, <span class="number">0</span>) + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> charCountMap;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="ä¸¤æ•°ä¹‹å’Œ-Two-Sum"><a href="#ä¸¤æ•°ä¹‹å’Œ-Two-Sum" class="headerlink" title="ä¸¤æ•°ä¹‹å’Œ (Two Sum)"></a>ä¸¤æ•°ä¹‹å’Œ (Two Sum)</h3><p>ä½¿ç”¨ <code>HashMap</code> å°†å€¼å’Œç´¢å¼•å­˜å‚¨èµ·æ¥ï¼Œå®ç°ä¸€æ¬¡éå†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArrayProblems</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[] twoSum(<span class="type">int</span>[] nums, <span class="type">int</span> target) &#123;</span><br><span class="line">        Map&lt;Integer, Integer&gt; numMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">complement</span> <span class="operator">=</span> target - nums[i];</span><br><span class="line">            <span class="keyword">if</span> (numMap.containsKey(complement)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;numMap.get(complement), i&#125;;</span><br><span class="line">            &#125;</span><br><span class="line">            numMap.put(nums[i], i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;&#125;; <span class="comment">// æœªæ‰¾åˆ°</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="æ•°ç»„ä¸­æœ€å¤§-å°å€¼-Max-Min-in-Array"><a href="#æ•°ç»„ä¸­æœ€å¤§-å°å€¼-Max-Min-in-Array" class="headerlink" title="æ•°ç»„ä¸­æœ€å¤§&#x2F;å°å€¼ (Max&#x2F;Min in Array)"></a>æ•°ç»„ä¸­æœ€å¤§&#x2F;å°å€¼ (Max&#x2F;Min in Array)</h3><p>ä¸€æ¬¡éå†æ‰¾åˆ°æœ€å¤§å€¼å’Œæœ€å°å€¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArrayProblems</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[] findMaxMin(<span class="type">int</span>[] arr) &#123;</span><br><span class="line">        <span class="keyword">if</span> (arr == <span class="literal">null</span> || arr.length == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Array cannot be null or empty.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">min</span> <span class="operator">=</span> arr[<span class="number">0</span>];</span><br><span class="line">        <span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> arr[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (arr[i] &lt; min) &#123;</span><br><span class="line">                min = arr[i];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (arr[i] &gt; max) &#123;</span><br><span class="line">                max = arr[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;max, min&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="è´¨æ•°åˆ¤æ–­-Prime-Number"><a href="#è´¨æ•°åˆ¤æ–­-Prime-Number" class="headerlink" title="è´¨æ•°åˆ¤æ–­ (Prime Number)"></a>è´¨æ•°åˆ¤æ–­ (Prime Number)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MathProblems</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isPrime</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (n &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">// 1 å’Œæ›´å°çš„æ•°éƒ½ä¸æ˜¯è´¨æ•°</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// åªéœ€è¦æ£€æŸ¥åˆ° n çš„å¹³æ–¹æ ¹</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>; i * i &lt;= n; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (n % i == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="é›†åˆäº¤é›†-List-Intersection"><a href="#é›†åˆäº¤é›†-List-Intersection" class="headerlink" title="é›†åˆäº¤é›† (List Intersection)"></a>é›†åˆäº¤é›† (List Intersection)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ListProblems</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; List&lt;T&gt; <span class="title function_">intersection</span><span class="params">(List&lt;T&gt; list1, List&lt;T&gt; list2)</span> &#123;</span><br><span class="line">        List&lt;T&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> (list1 == <span class="literal">null</span> || list2 == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// éå†ç¬¬ä¸€ä¸ªåˆ—è¡¨ï¼Œæ£€æŸ¥å…ƒç´ æ˜¯å¦åœ¨ç¬¬äºŒä¸ªåˆ—è¡¨ä¸­</span></span><br><span class="line">        <span class="keyword">for</span> (T element : list1) &#123;</span><br><span class="line">            <span class="keyword">if</span> (list2.contains(element) &amp;&amp; !result.contains(element)) &#123;</span><br><span class="line">                result.add(element);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="æ•°ç»„åˆå¹¶-Merge-Sorted-Arrays"><a href="#æ•°ç»„åˆå¹¶-Merge-Sorted-Arrays" class="headerlink" title="æ•°ç»„åˆå¹¶ (Merge Sorted Arrays)"></a>æ•°ç»„åˆå¹¶ (Merge Sorted Arrays)</h3><p>å°†ä¸¤ä¸ªå·²æ’åºçš„æ•°ç»„åˆå¹¶ä¸ºä¸€ä¸ªæ–°çš„å·²æ’åºæ•°ç»„ï¼Œä½¿ç”¨<strong>åŒæŒ‡é’ˆ</strong>æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArrayProblems</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[] mergeSortedArrays(<span class="type">int</span>[] arr1, <span class="type">int</span>[] arr2) &#123;</span><br><span class="line">        <span class="type">int</span>[] merged = <span class="keyword">new</span> <span class="title class_">int</span>[arr1.length + arr2.length];</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, j = <span class="number">0</span>, k = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (i &lt; arr1.length &amp;&amp; j &lt; arr2.length) &#123;</span><br><span class="line">            <span class="keyword">if</span> (arr1[i] &lt; arr2[j]) &#123;</span><br><span class="line">                merged[k++] = arr1[i++];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                merged[k++] = arr2[j++];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (i &lt; arr1.length) &#123;</span><br><span class="line">            merged[k++] = arr1[i++];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (j &lt; arr2.length) &#123;</span><br><span class="line">            merged[k++] = arr2[j++];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> merged;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="åˆ¤æ–­å›æ–‡æ•°-Palindrome-Number"><a href="#åˆ¤æ–­å›æ–‡æ•°-Palindrome-Number" class="headerlink" title="åˆ¤æ–­å›æ–‡æ•° (Palindrome Number)"></a>åˆ¤æ–­å›æ–‡æ•° (Palindrome Number)</h3><p>ä¸ä½¿ç”¨ <code>String</code> è½¬æ¢ï¼Œé€šè¿‡æ•°å­¦æ–¹æ³•åè½¬ä¸€åŠæ•°å­—ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MathProblems</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isPalindromeNumber</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">        <span class="comment">// è´Ÿæ•°å’Œä»¥ 0 ç»“å°¾çš„é 0 æ•°å­—éƒ½ä¸æ˜¯å›æ–‡</span></span><br><span class="line">        <span class="keyword">if</span> (x &lt; <span class="number">0</span> || (x % <span class="number">10</span> == <span class="number">0</span> &amp;&amp; x != <span class="number">0</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">reversedNumber</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (x &gt; reversedNumber) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">lastDigit</span> <span class="operator">=</span> x % <span class="number">10</span>;</span><br><span class="line">            reversedNumber = reversedNumber * <span class="number">10</span> + lastDigit;</span><br><span class="line">            x /= <span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¶æ•°ä½æ•°å­—æ—¶ï¼Œx ç­‰äº reversedNumber</span></span><br><span class="line">        <span class="comment">// å¥‡æ•°ä½æ•°å­—æ—¶ï¼Œx ç­‰äº reversedNumber é™¤ä»¥ 10</span></span><br><span class="line">        <span class="keyword">return</span> x == reversedNumber || x == reversedNumber / <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="ç½—é©¬æ•°å­—è½¬æ•´æ•°-Roman-to-Integer"><a href="#ç½—é©¬æ•°å­—è½¬æ•´æ•°-Roman-to-Integer" class="headerlink" title="ç½—é©¬æ•°å­—è½¬æ•´æ•° (Roman to Integer)"></a>ç½—é©¬æ•°å­—è½¬æ•´æ•° (Roman to Integer)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringProblems</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">romanToInt</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        Map&lt;Character, Integer&gt; romanMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        romanMap.put(<span class="string">&#x27;I&#x27;</span>, <span class="number">1</span>);</span><br><span class="line">        romanMap.put(<span class="string">&#x27;V&#x27;</span>, <span class="number">5</span>);</span><br><span class="line">        romanMap.put(<span class="string">&#x27;X&#x27;</span>, <span class="number">10</span>);</span><br><span class="line">        romanMap.put(<span class="string">&#x27;L&#x27;</span>, <span class="number">50</span>);</span><br><span class="line">        romanMap.put(<span class="string">&#x27;C&#x27;</span>, <span class="number">100</span>);</span><br><span class="line">        romanMap.put(<span class="string">&#x27;D&#x27;</span>, <span class="number">500</span>);</span><br><span class="line">        romanMap.put(<span class="string">&#x27;M&#x27;</span>, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; s.length(); i++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">currentVal</span> <span class="operator">=</span> romanMap.get(s.charAt(i));</span><br><span class="line">            <span class="comment">// å¦‚æœå½“å‰å­—ç¬¦çš„å€¼å°äºä¸‹ä¸€ä¸ªå­—ç¬¦çš„å€¼ï¼Œåˆ™éœ€è¦å‡å»å½“å‰å€¼</span></span><br><span class="line">            <span class="keyword">if</span> (i &lt; s.length() - <span class="number">1</span> &amp;&amp; currentVal &lt; romanMap.get(s.charAt(i + <span class="number">1</span>))) &#123;</span><br><span class="line">                result -= currentVal;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                result += currentVal;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="çˆ¬æ¥¼æ¢¯-Climbing-Stairs"><a href="#çˆ¬æ¥¼æ¢¯-Climbing-Stairs" class="headerlink" title="çˆ¬æ¥¼æ¢¯ (Climbing Stairs)"></a>çˆ¬æ¥¼æ¢¯ (Climbing Stairs)</h3><p>è¿™æ˜¯ç»å…¸çš„<strong>åŠ¨æ€è§„åˆ’</strong>é—®é¢˜ã€‚</p><h4 id="åŠ¨æ€è§„åˆ’æ–¹å¼-éé€’å½’"><a href="#åŠ¨æ€è§„åˆ’æ–¹å¼-éé€’å½’" class="headerlink" title="åŠ¨æ€è§„åˆ’æ–¹å¼ (éé€’å½’)"></a>åŠ¨æ€è§„åˆ’æ–¹å¼ (éé€’å½’)</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MathProblems</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">climbStairs</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (n &lt;= <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> n;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span>[] dp = <span class="keyword">new</span> <span class="title class_">int</span>[n + <span class="number">1</span>];</span><br><span class="line">        dp[<span class="number">1</span>] = <span class="number">1</span>; <span class="comment">// çˆ¬ 1 çº§å°é˜¶ï¼Œæœ‰ 1 ç§æ–¹æ³•</span></span><br><span class="line">        dp[<span class="number">2</span>] = <span class="number">2</span>; <span class="comment">// çˆ¬ 2 çº§å°é˜¶ï¼Œæœ‰ 2 ç§æ–¹æ³• (1+1, 2)</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">3</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            <span class="comment">// åˆ°è¾¾ç¬¬ i çº§å°é˜¶çš„æ–¹æ³•æ•° = (ä» i-1 çº§çˆ¬ 1 çº§çš„æ–¹æ³•æ•°) + (ä» i-2 çº§çˆ¬ 2 çº§çš„æ–¹æ³•æ•°)</span></span><br><span class="line">            dp[i] = dp[i - <span class="number">1</span>] + dp[i - <span class="number">2</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dp[n];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¥½çš„ï¼Œä»¥ä¸‹æ˜¯åŸºäº  è¯­è¨€çš„çº¿ç¨‹åŸºç¡€ä¸åŒæ­¥çš„å®ç°ï¼Œå¹¶é™„å¸¦è¯¦ç»†æ³¨é‡Šã€‚</p><h3 id="çº¿ç¨‹åˆ›å»º"><a href="#çº¿ç¨‹åˆ›å»º" class="headerlink" title="çº¿ç¨‹åˆ›å»º"></a>çº¿ç¨‹åˆ›å»º</h3><h4 id="1-ç»§æ‰¿-Thread-ç±»"><a href="#1-ç»§æ‰¿-Thread-ç±»" class="headerlink" title="1. ç»§æ‰¿ Thread ç±»"></a>1. ç»§æ‰¿ <code>Thread</code> ç±»</h4><p>é€šè¿‡ç»§æ‰¿ <code>java.lang.Thread</code> ç±»å¹¶é‡å†™å…¶ <code>run()</code> æ–¹æ³•æ¥åˆ›å»ºçº¿ç¨‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç»§æ‰¿ Thread ç±»åˆ›å»ºçº¿ç¨‹</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// çº¿ç¨‹æ‰§è¡Œçš„ä»»åŠ¡</span></span><br><span class="line">        System.out.println(<span class="string">&quot;ä½¿ç”¨ç»§æ‰¿ Thread ç±»çš„æ–¹å¼åˆ›å»ºçš„çº¿ç¨‹æ­£åœ¨è¿è¡Œã€‚&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-å®ç°-Runnable-æ¥å£"><a href="#2-å®ç°-Runnable-æ¥å£" class="headerlink" title="2. å®ç° Runnable æ¥å£"></a>2. å®ç° <code>Runnable</code> æ¥å£</h4><p>é€šè¿‡å®ç° <code>java.lang.Runnable</code> æ¥å£å¹¶å°†å…¶ä½œä¸ºå‚æ•°ä¼ é€’ç»™ <code>Thread</code> ç±»çš„æ„é€ å‡½æ•°æ¥åˆ›å»ºçº¿ç¨‹ã€‚è¿™ç§æ–¹å¼æ›´çµæ´»ï¼Œæ¨èä½¿ç”¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®ç° Runnable æ¥å£åˆ›å»ºçº¿ç¨‹</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyRunnable</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// çº¿ç¨‹æ‰§è¡Œçš„ä»»åŠ¡</span></span><br><span class="line">        System.out.println(<span class="string">&quot;ä½¿ç”¨å®ç° Runnable æ¥å£çš„æ–¹å¼åˆ›å»ºçš„çº¿ç¨‹æ­£åœ¨è¿è¡Œã€‚&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="sleep-ä¸-yield"><a href="#sleep-ä¸-yield" class="headerlink" title="sleep() ä¸ yield()"></a><code>sleep()</code> ä¸ <code>yield()</code></h3><p><code>sleep()</code> å’Œ <code>yield()</code> éƒ½æ˜¯çº¿ç¨‹è°ƒåº¦çš„æ–¹æ³•ï¼Œä½†å®ƒä»¬çš„ä½œç”¨å’Œæ•ˆæœä¸åŒã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SleepYieldDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// ä½¿ç”¨ sleep() çš„çº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;çº¿ç¨‹ A: å¼€å§‹æ‰§è¡Œ...&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// sleep() ä½¿çº¿ç¨‹æš‚åœæŒ‡å®šæ—¶é—´ï¼Œè¿›å…¥ WAITING çŠ¶æ€ï¼Œä½†ä¸ä¼šé‡Šæ”¾é”</span></span><br><span class="line">                System.out.println(<span class="string">&quot;çº¿ç¨‹ A: å‡†å¤‡ç¡çœ  2 ç§’...&quot;</span>);</span><br><span class="line">                Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">                System.out.println(<span class="string">&quot;çº¿ç¨‹ A: ç¡çœ ç»“æŸï¼Œç»§ç»­æ‰§è¡Œã€‚&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä½¿ç”¨ yield() çš„çº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;çº¿ç¨‹ B: å¼€å§‹æ‰§è¡Œ...&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;çº¿ç¨‹ B: æ­£åœ¨æ‰§è¡Œ &quot;</span> + i);</span><br><span class="line">                <span class="comment">// yield() æç¤ºçº¿ç¨‹è°ƒåº¦å™¨è®©å‡º CPU æ—¶é—´ï¼Œä½†ä¸ä¿è¯ä¸€å®šç”Ÿæ•ˆ</span></span><br><span class="line">                Thread.<span class="keyword">yield</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;çº¿ç¨‹ B: æ‰§è¡Œå®Œæ¯•ã€‚&quot;</span>);</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>sleep()</strong>: ä½¿å½“å‰çº¿ç¨‹<strong>æš‚åœæ‰§è¡ŒæŒ‡å®šçš„æ—¶é—´</strong>ï¼Œè¿›å…¥ <strong>TIMED_WAITING</strong> çŠ¶æ€ã€‚å®ƒä¼š<strong>é‡Šæ”¾ CPU èµ„æº</strong>ï¼Œä½†<strong>ä¸é‡Šæ”¾é”</strong>ã€‚</li><li><strong>yield()</strong>: æç¤ºçº¿ç¨‹è°ƒåº¦å™¨ï¼Œå½“å‰çº¿ç¨‹æ„¿æ„<strong>è®©å‡ºå½“å‰ CPU æ—¶é—´ç‰‡</strong>ã€‚çº¿ç¨‹ä¼šä» <strong>RUNNING</strong> çŠ¶æ€è½¬æ¢ä¸º <strong>RUNNABLE</strong> çŠ¶æ€ï¼Œä¸å…¶ä»–çº¿ç¨‹ç«äº‰ CPUï¼Œä½†<strong>ä¸ä¿è¯</strong>å…¶ä»–çº¿ç¨‹èƒ½ç«‹å³è·å¾—æ‰§è¡Œã€‚å®ƒä¸»è¦ç”¨äºä¼˜åŒ–çº¿ç¨‹è°ƒåº¦ï¼Œé€šå¸¸åœ¨å¤šçº¿ç¨‹ç¨‹åºä¸­<strong>ä¸åº”ä¾èµ–</strong>å…¶è¡Œä¸ºæ¥ä¿è¯æ­£ç¡®æ€§ã€‚</li></ul><hr><h3 id="join-æ–¹æ³•"><a href="#join-æ–¹æ³•" class="headerlink" title="join() æ–¹æ³•"></a><code>join()</code> æ–¹æ³•</h3><p><code>join()</code> æ–¹æ³•å…è®¸ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæ¯•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">JoinDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">workerThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;å­çº¿ç¨‹: æ­£åœ¨æ‰§è¡Œ...&quot;</span>);</span><br><span class="line">                Thread.sleep(<span class="number">3000</span>); <span class="comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span></span><br><span class="line">                System.out.println(<span class="string">&quot;å­çº¿ç¨‹: æ‰§è¡Œå®Œæ¯•ã€‚&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        workerThread.start();</span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸»çº¿ç¨‹: ç­‰å¾…å­çº¿ç¨‹æ‰§è¡Œå®Œæ¯•...&quot;</span>);</span><br><span class="line">        <span class="comment">// è°ƒç”¨ join() æ–¹æ³•ï¼Œä¸»çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ° workerThread æ‰§è¡Œå®Œæ¯•</span></span><br><span class="line">        workerThread.join();</span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸»çº¿ç¨‹: å­çº¿ç¨‹å·²æ‰§è¡Œå®Œæ¯•ï¼Œä¸»çº¿ç¨‹ç»§ç»­æ‰§è¡Œã€‚&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="éçº¿ç¨‹å®‰å…¨è®¡æ•°å™¨"><a href="#éçº¿ç¨‹å®‰å…¨è®¡æ•°å™¨" class="headerlink" title="éçº¿ç¨‹å®‰å…¨è®¡æ•°å™¨"></a>éçº¿ç¨‹å®‰å…¨è®¡æ•°å™¨</h3><p>åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶å¯¹å…±äº«èµ„æºè¿›è¡Œè¯»å†™æ“ä½œï¼Œå¯èƒ½å¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">UnsafeCounter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">increment</span><span class="params">()</span> &#123;</span><br><span class="line">        count++; <span class="comment">// è¿™ä¸€è¡Œä»£ç å¹¶éåŸå­æ“ä½œï¼Œå®ƒåŒ…å«ä¸‰ä¸ªæ­¥éª¤ï¼šè¯»ã€åŠ  1ã€å†™</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ThreadSafetyDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">UnsafeCounter</span> <span class="variable">counter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UnsafeCounter</span>();</span><br><span class="line">        Thread[] threads = <span class="keyword">new</span> <span class="title class_">Thread</span>[<span class="number">100</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; threads.length; i++) &#123;</span><br><span class="line">            threads[i] = <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; <span class="number">10000</span>; j++) &#123;</span><br><span class="line">                    counter.increment();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            threads[i].start();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Thread thread : threads) &#123;</span><br><span class="line">            thread.join();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æœ€ç»ˆç»“æœä¸ä¸€å®šæ˜¯ 100 * 10000 = 1000000</span></span><br><span class="line">        System.out.println(<span class="string">&quot;éçº¿ç¨‹å®‰å…¨è®¡æ•°å™¨çš„æœ€ç»ˆç»“æœ: &quot;</span> + counter.getCount());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="synchronized-å…³é”®å­—"><a href="#synchronized-å…³é”®å­—" class="headerlink" title="synchronized å…³é”®å­—"></a><code>synchronized</code> å…³é”®å­—</h3><p>ä½¿ç”¨ <code>synchronized</code> å…³é”®å­—å¯ä»¥ä¿è¯åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®å…±äº«èµ„æºï¼Œä»è€Œè§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SynchronizedCounter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨ synchronized å…³é”®å­—ä¿®é¥°æ–¹æ³•ï¼Œé”ä½æ•´ä¸ªå¯¹è±¡å®ä¾‹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">increment</span><span class="params">()</span> &#123;</span><br><span class="line">        count++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SynchronizedDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">SynchronizedCounter</span> <span class="variable">counter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SynchronizedCounter</span>();</span><br><span class="line">        Thread[] threads = <span class="keyword">new</span> <span class="title class_">Thread</span>[<span class="number">100</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; threads.length; i++) &#123;</span><br><span class="line">            threads[i] = <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; <span class="number">10000</span>; j++) &#123;</span><br><span class="line">                    counter.increment();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            threads[i].start();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Thread thread : threads) &#123;</span><br><span class="line">            thread.join();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æœ€ç»ˆç»“æœä¸º 1000000</span></span><br><span class="line">        System.out.println(<span class="string">&quot;synchronized è®¡æ•°å™¨çš„æœ€ç»ˆç»“æœ: &quot;</span> + counter.getCount());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="synchronized-å—ä¸æ–¹æ³•"><a href="#synchronized-å—ä¸æ–¹æ³•" class="headerlink" title="synchronized å—ä¸æ–¹æ³•"></a><code>synchronized</code> å—ä¸æ–¹æ³•</h3><ul><li><strong>synchronized æ–¹æ³•</strong>: é”å®šçš„æ˜¯å½“å‰å¯¹è±¡å®ä¾‹ (<code>this</code>)ã€‚</li><li><strong>synchronized å—</strong>: æä¾›äº†æ›´ç»†ç²’åº¦çš„æ§åˆ¶ï¼Œå¯ä»¥æŒ‡å®šé”å®šçš„å¯¹è±¡ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SynchronizedBlockDemo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">lock1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">lock2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// synchronized æ–¹æ³•ï¼Œé”å®šå½“å‰å¯¹è±¡å®ä¾‹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">synchronizedMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot; è¿›å…¥ synchronized æ–¹æ³•ã€‚&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot; ç¦»å¼€ synchronized æ–¹æ³•ã€‚&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// synchronized å—ï¼Œé”å®šæŒ‡å®šçš„å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">synchronizedBlock1</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot; å°è¯•è·å– lock1...&quot;</span>);</span><br><span class="line">        <span class="keyword">synchronized</span> (lock1) &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; å·²è·å– lock1ã€‚&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; é‡Šæ”¾ lock1ã€‚&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">synchronizedBlock2</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot; å°è¯•è·å– lock2...&quot;</span>);</span><br><span class="line">        <span class="keyword">synchronized</span> (lock2) &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; å·²è·å– lock2ã€‚&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; é‡Šæ”¾ lock2ã€‚&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * åŒºåˆ«ä¸é€‚ç”¨åœºæ™¯:</span></span><br><span class="line"><span class="comment"> * - synchronized æ–¹æ³•: ç®€å•æ˜“ç”¨ï¼Œä½†é”å®šèŒƒå›´å¤§ï¼Œå¯èƒ½å¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚å½“éœ€è¦åŒæ­¥æ•´ä¸ªæ–¹æ³•æ—¶ä½¿ç”¨ã€‚</span></span><br><span class="line"><span class="comment"> * - synchronized å—: é”å®šèŒƒå›´å°ï¼Œå¯ä»¥åªåŒæ­¥éœ€è¦ä¿æŠ¤çš„ä»£ç æ®µï¼Œæé«˜å¹¶å‘æ€§èƒ½ã€‚å½“åªéœ€è¦åŒæ­¥éƒ¨åˆ†ä»£ç æ—¶ä½¿ç”¨ã€‚</span></span><br><span class="line"><span class="comment"> * åŒæ—¶ï¼Œå¯ä»¥é€šè¿‡é”å®šä¸åŒçš„å¯¹è±¡æ¥é¿å…ä¸å¿…è¦çš„é˜»å¡ï¼Œå®ç°æ›´é«˜çš„å¹¶å‘åº¦ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><hr><h3 id="volatile-å…³é”®å­—"><a href="#volatile-å…³é”®å­—" class="headerlink" title="volatile å…³é”®å­—"></a><code>volatile</code> å…³é”®å­—</h3><p><code>volatile</code> å…³é”®å­—ä¿è¯äº†å˜é‡åœ¨å¤šçº¿ç¨‹é—´çš„<strong>å¯è§æ€§</strong>ï¼Œä½†ä¸ä¿è¯<strong>åŸå­æ€§</strong>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">VolatileDemo</span> &#123;</span><br><span class="line">    <span class="comment">// volatile ä¿è¯æ‰€æœ‰çº¿ç¨‹çœ‹åˆ°çš„æ˜¯è¯¥å˜é‡çš„æœ€æ–°å€¼</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="type">boolean</span> <span class="variable">ready</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;çº¿ç¨‹ A: æ­£åœ¨ç­‰å¾…æ ‡å¿—ä½å˜ä¸º trueã€‚&quot;</span>);</span><br><span class="line">            <span class="keyword">while</span> (!ready) &#123;</span><br><span class="line">                <span class="comment">// ç©ºå¾ªç¯ï¼Œç­‰å¾… ready å˜ä¸º true</span></span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;çº¿ç¨‹ A: æ ‡å¿—ä½å·²å˜ä¸º trueï¼Œå¾ªç¯ç»“æŸã€‚&quot;</span>);</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line">        Thread.sleep(<span class="number">1000</span>); <span class="comment">// ç¡®ä¿çº¿ç¨‹ A å…ˆè¿è¡Œ</span></span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸»çº¿ç¨‹: æ­£åœ¨å°†æ ‡å¿—ä½è®¾ç½®ä¸º trueã€‚&quot;</span>);</span><br><span class="line">        ready = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * ä¸ºä»€ä¹ˆ volatile ä¸èƒ½ä¿è¯åŸå­æ€§?</span></span><br><span class="line"><span class="comment"> * - åŸå­æ€§æ˜¯æŒ‡ä¸€ä¸ªæ“ä½œæ˜¯ä¸å¯ä¸­æ–­çš„ï¼Œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œï¼Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œã€‚</span></span><br><span class="line"><span class="comment"> * - volatile åªèƒ½ä¿è¯å˜é‡çš„è¯»å†™æ“ä½œæ˜¯åŸå­çš„ï¼Œä½†åƒ `count++` è¿™æ ·çš„å¤åˆæ“ä½œï¼ˆè¯»ã€åŠ ã€å†™ï¼‰</span></span><br><span class="line"><span class="comment"> * ä¾ç„¶ä¸æ˜¯åŸå­çš„ã€‚å¤šä¸ªçº¿ç¨‹å¯èƒ½åŒæ—¶è¯»åˆ°æ—§å€¼ï¼Œå¯¼è‡´æœ€ç»ˆç»“æœä¸æ­£ç¡®ã€‚</span></span><br><span class="line"><span class="comment"> * - volatile ä¸»è¦ç”¨äºä¸€å†™å¤šè¯»çš„åœºæ™¯ï¼Œæˆ–è€…ç”¨äºæ§åˆ¶çº¿ç¨‹æ‰§è¡Œæµç¨‹çš„æ ‡å¿—ä½ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><hr><h3 id="AtomicInteger"><a href="#AtomicInteger" class="headerlink" title="AtomicInteger"></a><code>AtomicInteger</code></h3><p><code>AtomicInteger</code> æ˜¯ä¸€ä¸ªåŸå­ç±»ï¼Œå®ƒä½¿ç”¨ CAS (Compare-and-Swap) æœºåˆ¶æ¥ä¿è¯æ“ä½œçš„åŸå­æ€§ï¼Œä»è€Œå®ç°çº¿ç¨‹å®‰å…¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicInteger;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AtomicCounter</span> &#123;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨ AtomicInteger æ›¿ä»£ int</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">AtomicInteger</span> <span class="variable">count</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">increment</span><span class="params">()</span> &#123;</span><br><span class="line">        count.incrementAndGet(); <span class="comment">// è¿™æ˜¯ä¸€ä¸ªåŸå­æ“ä½œ</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> count.get();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AtomicDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">AtomicCounter</span> <span class="variable">counter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicCounter</span>();</span><br><span class="line">        Thread[] threads = <span class="keyword">new</span> <span class="title class_">Thread</span>[<span class="number">100</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; threads.length; i++) &#123;</span><br><span class="line">            threads[i] = <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; <span class="number">10000</span>; j++) &#123;</span><br><span class="line">                    counter.increment();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            threads[i].start();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Thread thread : threads) &#123;</span><br><span class="line">            thread.join();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æœ€ç»ˆç»“æœä¸º 1000000</span></span><br><span class="line">        System.out.println(<span class="string">&quot;AtomicInteger è®¡æ•°å™¨çš„æœ€ç»ˆç»“æœ: &quot;</span> + counter.getCount());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="çº¿ç¨‹é€šä¿¡"><a href="#çº¿ç¨‹é€šä¿¡" class="headerlink" title="çº¿ç¨‹é€šä¿¡"></a>çº¿ç¨‹é€šä¿¡</h3><p>ä½¿ç”¨ <code>wait()</code> å’Œ <code>notifyAll()</code> å®ç°ä¸¤ä¸ªçº¿ç¨‹äº¤æ›¿æ‰“å°å¥‡æ•°å’Œå¶æ•°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PrintNumbers</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printOdd</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">            <span class="keyword">while</span> (count &lt; <span class="number">10</span>) &#123;</span><br><span class="line">                <span class="keyword">while</span> (count % <span class="number">2</span> == <span class="number">0</span>) &#123; <span class="comment">// å¦‚æœæ˜¯å¶æ•°ï¼Œåˆ™ç­‰å¾…</span></span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        lock.wait();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;: &quot;</span> + count++);</span><br><span class="line">                lock.notifyAll(); <span class="comment">// å”¤é†’å…¶ä»–ç­‰å¾…çš„çº¿ç¨‹</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printEven</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">            <span class="keyword">while</span> (count &lt; <span class="number">10</span>) &#123;</span><br><span class="line">                <span class="keyword">while</span> (count % <span class="number">2</span> != <span class="number">0</span>) &#123; <span class="comment">// å¦‚æœæ˜¯å¥‡æ•°ï¼Œåˆ™ç­‰å¾…</span></span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        lock.wait();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;: &quot;</span> + count++);</span><br><span class="line">                lock.notifyAll(); <span class="comment">// å”¤é†’å…¶ä»–ç­‰å¾…çš„çº¿ç¨‹</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">PrintNumbers</span> <span class="variable">pn</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PrintNumbers</span>();</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">oddThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(pn::printOdd, <span class="string">&quot;å¥‡æ•°çº¿ç¨‹&quot;</span>);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">evenThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(pn::printEven, <span class="string">&quot;å¶æ•°çº¿ç¨‹&quot;</span>);</span><br><span class="line"></span><br><span class="line">        oddThread.start();</span><br><span class="line">        evenThread.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¥½çš„ï¼Œä»¥ä¸‹æ˜¯  ä¸­é«˜çº§å¹¶å‘ç¼–ç¨‹çš„å®ç°ï¼Œå¹¶é™„å¸¦è¯¦ç»†æ³¨é‡Šã€‚</p><h3 id="ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼-ä½¿ç”¨-wait-å’Œ-notifyAll"><a href="#ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼-ä½¿ç”¨-wait-å’Œ-notifyAll" class="headerlink" title="ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ (ä½¿ç”¨ wait() å’Œ notifyAll())"></a>ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ (ä½¿ç”¨ <code>wait()</code> å’Œ <code>notifyAll()</code>)</h3><p>è¿™æ˜¯ä¸€ä¸ªç»å…¸çš„çº¿ç¨‹åä½œé—®é¢˜ã€‚ç”Ÿäº§è€…ç”Ÿäº§æ•°æ®ï¼Œæ”¾å…¥å…±äº«é˜Ÿåˆ—ï¼›æ¶ˆè´¹è€…ä»é˜Ÿåˆ—ä¸­å–å‡ºæ•°æ®è¿›è¡Œæ¶ˆè´¹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.LinkedList;</span><br><span class="line"><span class="keyword">import</span> java.util.Queue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ProducerConsumerClassic</span> &#123;</span><br><span class="line">    <span class="comment">// å…±äº«é˜Ÿåˆ—ï¼Œä½¿ç”¨ LinkedList å®ç°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Queue&lt;Integer&gt; queue = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">// é˜Ÿåˆ—æœ€å¤§å®¹é‡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX_SIZE</span> <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">LOCK</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">produce</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (LOCK) &#123;</span><br><span class="line">                <span class="comment">// å¦‚æœé˜Ÿåˆ—å·²æ»¡ï¼Œç”Ÿäº§è€…ç­‰å¾…</span></span><br><span class="line">                <span class="keyword">while</span> (queue.size() == MAX_SIZE) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;é˜Ÿåˆ—å·²æ»¡ï¼Œç”Ÿäº§è€…ç­‰å¾…...&quot;</span>);</span><br><span class="line">                    LOCK.wait();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// ç”Ÿäº§æ•°æ®å¹¶æ”¾å…¥é˜Ÿåˆ—</span></span><br><span class="line">                queue.offer(i);</span><br><span class="line">                System.out.println(<span class="string">&quot;ç”Ÿäº§è€…ç”Ÿäº§äº†: &quot;</span> + i);</span><br><span class="line">                i++;</span><br><span class="line">                <span class="comment">// å”¤é†’æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹ï¼ˆåŒ…æ‹¬æ¶ˆè´¹è€…ï¼‰</span></span><br><span class="line">                LOCK.notifyAll();</span><br><span class="line">            &#125;</span><br><span class="line">            Thread.sleep(<span class="number">100</span>); <span class="comment">// æ¨¡æ‹Ÿç”Ÿäº§æ—¶é—´</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">consume</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (LOCK) &#123;</span><br><span class="line">                <span class="comment">// å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œæ¶ˆè´¹è€…ç­‰å¾…</span></span><br><span class="line">                <span class="keyword">while</span> (queue.isEmpty()) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;é˜Ÿåˆ—ä¸ºç©ºï¼Œæ¶ˆè´¹è€…ç­‰å¾…...&quot;</span>);</span><br><span class="line">                    LOCK.wait();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// æ¶ˆè´¹æ•°æ®</span></span><br><span class="line">                <span class="type">int</span> <span class="variable">data</span> <span class="operator">=</span> queue.poll();</span><br><span class="line">                System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…æ¶ˆè´¹äº†: &quot;</span> + data);</span><br><span class="line">                <span class="comment">// å”¤é†’æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹ï¼ˆåŒ…æ‹¬ç”Ÿäº§è€…ï¼‰</span></span><br><span class="line">                LOCK.notifyAll();</span><br><span class="line">            &#125;</span><br><span class="line">            Thread.sleep(<span class="number">500</span>); <span class="comment">// æ¨¡æ‹Ÿæ¶ˆè´¹æ—¶é—´</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼-ä½¿ç”¨-BlockingQueue"><a href="#ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼-ä½¿ç”¨-BlockingQueue" class="headerlink" title="ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ (ä½¿ç”¨ BlockingQueue)"></a>ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ (ä½¿ç”¨ <code>BlockingQueue</code>)</h3><p><code>java.util.concurrent.BlockingQueue</code> æ¥å£æä¾›äº†çº¿ç¨‹å®‰å…¨çš„é˜Ÿåˆ—æ“ä½œï¼Œç®€åŒ–äº†ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹çš„å®ç°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.BlockingQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.LinkedBlockingQueue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ProducerConsumerBlockingQueue</span> &#123;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨ BlockingQueueï¼Œå®ƒå†…éƒ¨å·²ç»å¤„ç†äº†çº¿ç¨‹åŒæ­¥</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> BlockingQueue&lt;Integer&gt; queue = <span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;&gt;(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">produce</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="comment">// put() æ–¹æ³•åœ¨é˜Ÿåˆ—æ»¡æ—¶ä¼šè‡ªåŠ¨é˜»å¡</span></span><br><span class="line">            queue.put(i);</span><br><span class="line">            System.out.println(<span class="string">&quot;ç”Ÿäº§è€…ç”Ÿäº§äº†: &quot;</span> + i);</span><br><span class="line">            i++;</span><br><span class="line">            Thread.sleep(<span class="number">100</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">consume</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="comment">// take() æ–¹æ³•åœ¨é˜Ÿåˆ—ç©ºæ—¶ä¼šè‡ªåŠ¨é˜»å¡</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">data</span> <span class="operator">=</span> queue.take();</span><br><span class="line">            System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…æ¶ˆè´¹äº†: &quot;</span> + data);</span><br><span class="line">            Thread.sleep(<span class="number">500</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="ReentrantLock"><a href="#ReentrantLock" class="headerlink" title="ReentrantLock"></a><code>ReentrantLock</code></h3><p>ä½¿ç”¨ <code>ReentrantLock</code> å®ç°çº¿ç¨‹å®‰å…¨è®¡æ•°å™¨ï¼Œå¹¶è§£é‡Šå…¶ä¸ <code>synchronized</code> çš„åŒºåˆ«ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ReentrantLockCounter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">increment</span><span class="params">()</span> &#123;</span><br><span class="line">        lock.lock(); <span class="comment">// è·å–é”</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            count++; <span class="comment">// åœ¨ try å—ä¸­æ‰§è¡Œéœ€è¦åŒæ­¥çš„ä»£ç </span></span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock(); <span class="comment">// åœ¨ finally å—ä¸­é‡Šæ”¾é”ï¼Œç¡®ä¿é”æ€»æ˜¯è¢«é‡Šæ”¾</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCount</span><span class="params">()</span> &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> count;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* ReentrantLock ä¸ synchronized çš„åŒºåˆ«:</span></span><br><span class="line"><span class="comment">* 1. è¯­æ³•å±‚é¢: `synchronized` æ˜¯ JVM çš„å†…ç½®å…³é”®å­—ï¼Œè€Œ `ReentrantLock` æ˜¯ä¸€ä¸ªç±»ã€‚</span></span><br><span class="line"><span class="comment">* 2. çµæ´»æ€§: `ReentrantLock` æä¾›äº†æ›´çµæ´»çš„é”å®šæ§åˆ¶ã€‚ä¾‹å¦‚ï¼Œå®ƒæ”¯æŒå…¬å¹³é”ï¼ˆæŒ‰è¯·æ±‚é¡ºåºè·å–é”ï¼‰ï¼Œ</span></span><br><span class="line"><span class="comment">* å¯ä»¥å°è¯•éé˜»å¡åœ°è·å–é”ï¼ˆ`tryLock()`ï¼‰ï¼Œä»¥åŠæ”¯æŒä¸­æ–­ï¼ˆ`lockInterruptibly()`ï¼‰ã€‚</span></span><br><span class="line"><span class="comment">* 3. æ€§èƒ½: åœ¨æ—©æœŸç‰ˆæœ¬ä¸­ï¼Œ`ReentrantLock` é€šå¸¸æ€§èƒ½æ›´å¥½ã€‚ä½†éšç€  å¯¹ `synchronized` ä¼˜åŒ–ï¼ˆåå‘é”ã€è½»é‡çº§é”ï¼‰ï¼Œ</span></span><br><span class="line"><span class="comment">* ä¸¤è€…æ€§èƒ½å·²éå¸¸æ¥è¿‘ã€‚åœ¨ç®€å•åœºæ™¯ä¸‹ï¼Œ`synchronized` æ›´ç®€æ´ã€‚</span></span><br><span class="line"><span class="comment">* 4. åä½œ: `ReentrantLock` å¿…é¡»é…åˆ `Condition` æ¥å£æ‰èƒ½å®ç°çº¿ç¨‹é—´çš„ç­‰å¾…/å”¤é†’æœºåˆ¶ï¼Œè€Œ `synchronized` ç›´æ¥</span></span><br><span class="line"><span class="comment">* ä½¿ç”¨ `Object` çš„ `wait()` å’Œ `notify()`ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><hr><h3 id="ReentrantLock-ä¸-Condition"><a href="#ReentrantLock-ä¸-Condition" class="headerlink" title="ReentrantLock ä¸ Condition"></a><code>ReentrantLock</code> ä¸ <code>Condition</code></h3><p>ä½¿ç”¨ <code>ReentrantLock</code> å’Œ <code>Condition</code> é‡æ–°å®ç°ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.LinkedList;</span><br><span class="line"><span class="keyword">import</span> java.util.Queue;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Condition;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ProducerConsumerCondition</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Queue&lt;Integer&gt; queue = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX_SIZE</span> <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸¤ä¸ª Condition å®ä¾‹ï¼Œåˆ†åˆ«ç”¨äºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Condition</span> <span class="variable">producerCondition</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Condition</span> <span class="variable">consumerCondition</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">produce</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            lock.lock();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">while</span> (queue.size() == MAX_SIZE) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;é˜Ÿåˆ—å·²æ»¡ï¼Œç”Ÿäº§è€…ç­‰å¾…...&quot;</span>);</span><br><span class="line">                    producerCondition.await(); <span class="comment">// ç”Ÿäº§è€…ç­‰å¾…</span></span><br><span class="line">                &#125;</span><br><span class="line">                queue.offer(i);</span><br><span class="line">                System.out.println(<span class="string">&quot;ç”Ÿäº§è€…ç”Ÿäº§äº†: &quot;</span> + i);</span><br><span class="line">                i++;</span><br><span class="line">                consumerCondition.signalAll(); <span class="comment">// å”¤é†’æ‰€æœ‰æ¶ˆè´¹è€…</span></span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                lock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">            Thread.sleep(<span class="number">100</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">consume</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            lock.lock();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">while</span> (queue.isEmpty()) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;é˜Ÿåˆ—ä¸ºç©ºï¼Œæ¶ˆè´¹è€…ç­‰å¾…...&quot;</span>);</span><br><span class="line">                    consumerCondition.await(); <span class="comment">// æ¶ˆè´¹è€…ç­‰å¾…</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="type">int</span> <span class="variable">data</span> <span class="operator">=</span> queue.poll();</span><br><span class="line">                System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…æ¶ˆè´¹äº†: &quot;</span> + data);</span><br><span class="line">                producerCondition.signalAll(); <span class="comment">// å”¤é†’æ‰€æœ‰ç”Ÿäº§è€…</span></span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                lock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">            Thread.sleep(<span class="number">500</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="ExecutorService"><a href="#ExecutorService" class="headerlink" title="ExecutorService"></a><code>ExecutorService</code></h3><p>åˆ›å»ºä¸€ä¸ªå›ºå®šå¤§å°çš„çº¿ç¨‹æ± ï¼Œå¹¶å‘å…¶æäº¤å¤šä¸ªä»»åŠ¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ExecutorServiceDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªå›ºå®šå¤§å°ä¸º 3 çš„çº¿ç¨‹æ± </span></span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">executorService</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">int</span> <span class="variable">taskId</span> <span class="operator">=</span> i;</span><br><span class="line">            executorService.execute(() -&gt; &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;ä»»åŠ¡ &quot;</span> + taskId + <span class="string">&quot; æ­£åœ¨ç”±çº¿ç¨‹ &quot;</span> + Thread.currentThread().getName() + <span class="string">&quot; æ‰§è¡Œã€‚&quot;</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">1000</span>); <span class="comment">// æ¨¡æ‹Ÿä»»åŠ¡æ‰§è¡Œæ—¶é—´</span></span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    Thread.currentThread().interrupt();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å…³é—­çº¿ç¨‹æ± ï¼Œä¸å†æ¥æ”¶æ–°ä»»åŠ¡ï¼Œå·²æäº¤çš„ä»»åŠ¡ä¼šç»§ç»­æ‰§è¡Œ</span></span><br><span class="line">        executorService.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="Callable-ä¸-Future"><a href="#Callable-ä¸-Future" class="headerlink" title="Callable ä¸ Future"></a><code>Callable</code> ä¸ <code>Future</code></h3><p>ä½¿ç”¨ <code>Callable</code> æäº¤ä»»åŠ¡ï¼Œå¹¶ä½¿ç”¨ <code>Future</code> è·å–è¿”å›å€¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CallableFutureDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">executorService</span> <span class="operator">=</span> Executors.newSingleThreadExecutor();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ª Callable ä»»åŠ¡ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²</span></span><br><span class="line">        Callable&lt;String&gt; task = () -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ä»»åŠ¡å¼€å§‹æ‰§è¡Œ...&quot;</span>);</span><br><span class="line">            Thread.sleep(<span class="number">2000</span>); <span class="comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œè¿”å›ç»“æœï¼&quot;</span>;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æäº¤ä»»åŠ¡å¹¶è·å¾— Future å¯¹è±¡</span></span><br><span class="line">        Future&lt;String&gt; future = executorService.submit(task);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸»çº¿ç¨‹: ä»»åŠ¡å·²æäº¤ï¼Œç»§ç»­æ‰§è¡Œå…¶ä»–æ“ä½œ...&quot;</span>);</span><br><span class="line">        <span class="comment">// get() æ–¹æ³•ä¼šé˜»å¡ï¼Œç›´åˆ°ä»»åŠ¡å®Œæˆå¹¶è¿”å›ç»“æœ</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> future.get();</span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸»çº¿ç¨‹: è·å¾—ä»»åŠ¡ç»“æœ -&gt; &quot;</span> + result);</span><br><span class="line"></span><br><span class="line">        executorService.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="CountDownLatch"><a href="#CountDownLatch" class="headerlink" title="CountDownLatch"></a><code>CountDownLatch</code></h3><p><code>CountDownLatch</code> å…è®¸ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ç­‰å¾…ç›´åˆ°åœ¨å…¶ä»–çº¿ç¨‹ä¸­æ‰§è¡Œçš„ä¸€ç»„æ“ä½œå®Œæˆã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.CountDownLatch;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CountDownLatchDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">workerCount</span> <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line">        <span class="comment">// è®¡æ•°å™¨ï¼Œå½“è®¡æ•°å™¨å‡åˆ° 0 æ—¶ï¼Œä¸»çº¿ç¨‹ä¼šè¢«å”¤é†’</span></span><br><span class="line">        <span class="type">CountDownLatch</span> <span class="variable">latch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(workerCount);</span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">executor</span> <span class="operator">=</span> Executors.newFixedThreadPool(workerCount);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; workerCount; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">int</span> <span class="variable">workerId</span> <span class="operator">=</span> i;</span><br><span class="line">            executor.execute(() -&gt; &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;å·¥ä½œçº¿ç¨‹ &quot;</span> + workerId + <span class="string">&quot; å¼€å§‹æ‰§è¡Œä»»åŠ¡...&quot;</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep((<span class="type">long</span>) (Math.random() * <span class="number">2000</span>)); <span class="comment">// æ¨¡æ‹Ÿä»»åŠ¡æ‰§è¡Œ</span></span><br><span class="line">                    System.out.println(<span class="string">&quot;å·¥ä½œçº¿ç¨‹ &quot;</span> + workerId + <span class="string">&quot; ä»»åŠ¡å®Œæˆã€‚&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    Thread.currentThread().interrupt();</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    latch.countDown(); <span class="comment">// ä»»åŠ¡å®Œæˆåï¼Œè®¡æ•°å™¨å‡ 1</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸»çº¿ç¨‹: ç­‰å¾…æ‰€æœ‰å·¥ä½œçº¿ç¨‹å®Œæˆ...&quot;</span>);</span><br><span class="line">        latch.await(); <span class="comment">// é˜»å¡ä¸»çº¿ç¨‹ï¼Œç›´åˆ°è®¡æ•°å™¨ä¸º 0</span></span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸»çº¿ç¨‹: æ‰€æœ‰å·¥ä½œçº¿ç¨‹å·²å®Œæˆï¼Œç»§ç»­æ‰§è¡Œä¸‹ä¸€æ­¥ã€‚&quot;</span>);</span><br><span class="line"></span><br><span class="line">        executor.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="CyclicBarrier"><a href="#CyclicBarrier" class="headerlink" title="CyclicBarrier"></a><code>CyclicBarrier</code></h3><p><code>CyclicBarrier</code> å…è®¸ä¸€ç»„çº¿ç¨‹ç›¸äº’ç­‰å¾…ï¼Œç›´åˆ°æ‰€æœ‰çº¿ç¨‹éƒ½åˆ°è¾¾ä¸€ä¸ªå…±åŒçš„å±éšœç‚¹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.BrokenBarrierException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CyclicBarrier;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CyclicBarrierDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">partySize</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line">        <span class="comment">// å½“ 3 ä¸ªçº¿ç¨‹éƒ½åˆ°è¾¾å±éšœæ—¶ï¼Œæ‰§è¡Œä¸€ä¸ªå±éšœåŠ¨ä½œ</span></span><br><span class="line">        <span class="type">CyclicBarrier</span> <span class="variable">barrier</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CyclicBarrier</span>(partySize, () -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;\næ‰€æœ‰çº¿ç¨‹å·²åˆ°è¾¾å±éšœç‚¹ï¼ç»§ç»­æ‰§è¡Œä¸‹ä¸€é˜¶æ®µã€‚\n&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">executor</span> <span class="operator">=</span> Executors.newFixedThreadPool(partySize);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; partySize; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">int</span> <span class="variable">threadId</span> <span class="operator">=</span> i;</span><br><span class="line">            executor.execute(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;çº¿ç¨‹ &quot;</span> + threadId + <span class="string">&quot; æ­£åœ¨æ‰§è¡Œç¬¬ä¸€é˜¶æ®µä»»åŠ¡...&quot;</span>);</span><br><span class="line">                    Thread.sleep((<span class="type">long</span>) (Math.random() * <span class="number">1000</span>));</span><br><span class="line">                    System.out.println(<span class="string">&quot;çº¿ç¨‹ &quot;</span> + threadId + <span class="string">&quot; ç¬¬ä¸€é˜¶æ®µä»»åŠ¡å®Œæˆï¼Œåˆ°è¾¾å±éšœã€‚&quot;</span>);</span><br><span class="line">                    barrier.await(); <span class="comment">// çº¿ç¨‹åœ¨æ­¤å¤„ç­‰å¾…</span></span><br><span class="line"></span><br><span class="line">                    System.out.println(<span class="string">&quot;çº¿ç¨‹ &quot;</span> + threadId + <span class="string">&quot; æ­£åœ¨æ‰§è¡Œç¬¬äºŒé˜¶æ®µä»»åŠ¡...&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException | BrokenBarrierException e) &#123;</span><br><span class="line">                    Thread.currentThread().interrupt();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        executor.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="Semaphore"><a href="#Semaphore" class="headerlink" title="Semaphore"></a><code>Semaphore</code></h3><p><code>Semaphore</code>ï¼ˆä¿¡å·é‡ï¼‰ç”¨æ¥æ§åˆ¶å¯¹èµ„æºçš„å¹¶å‘è®¿é—®æ•°é‡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.Semaphore;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SemaphoreDemo</span> &#123;</span><br><span class="line">    <span class="comment">// å…è®¸ 3 ä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Semaphore</span> <span class="variable">semaphore</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Semaphore</span>(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">accessResource</span><span class="params">(<span class="type">int</span> threadId)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            semaphore.acquire(); <span class="comment">// è·å–è®¸å¯</span></span><br><span class="line">            System.out.println(<span class="string">&quot;çº¿ç¨‹ &quot;</span> + threadId + <span class="string">&quot; æ­£åœ¨è®¿é—®èµ„æº...&quot;</span>);</span><br><span class="line">            Thread.sleep(<span class="number">2000</span>); <span class="comment">// æ¨¡æ‹Ÿèµ„æºè®¿é—®æ—¶é—´</span></span><br><span class="line">            System.out.println(<span class="string">&quot;çº¿ç¨‹ &quot;</span> + threadId + <span class="string">&quot; è®¿é—®èµ„æºå®Œæ¯•ã€‚&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            Thread.currentThread().interrupt();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            semaphore.release(); <span class="comment">// é‡Šæ”¾è®¸å¯</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">SemaphoreDemo</span> <span class="variable">demo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SemaphoreDemo</span>();</span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">executor</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">int</span> <span class="variable">threadId</span> <span class="operator">=</span> i;</span><br><span class="line">            executor.execute(() -&gt; demo.accessResource(threadId));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        executor.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="çº¿ç¨‹æ­»é”"><a href="#çº¿ç¨‹æ­»é”" class="headerlink" title="çº¿ç¨‹æ­»é”"></a>çº¿ç¨‹æ­»é”</h3><h4 id="1-æ­»é”æ¼”ç¤º"><a href="#1-æ­»é”æ¼”ç¤º" class="headerlink" title="1. æ­»é”æ¼”ç¤º"></a>1. æ­»é”æ¼”ç¤º</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DeadlockDemo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">lock1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">lock2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">threadA</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (lock1) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;çº¿ç¨‹A: å·²è·å¾— lock1ï¼Œå°è¯•è·å– lock2...&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">100</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">synchronized</span> (lock2) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;çº¿ç¨‹A: å·²è·å¾— lock2ã€‚&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">threadB</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (lock2) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;çº¿ç¨‹B: å·²è·å¾— lock2ï¼Œå°è¯•è·å– lock1...&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">100</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">synchronized</span> (lock1) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;çº¿ç¨‹B: å·²è·å¾— lock1ã€‚&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">DeadlockDemo</span> <span class="variable">demo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeadlockDemo</span>();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(demo::threadA, <span class="string">&quot;Thread-A&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(demo::threadB, <span class="string">&quot;Thread-B&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* æ­»é”äº§ç”Ÿæ¡ä»¶:</span></span><br><span class="line"><span class="comment">* 1. äº’æ–¥æ¡ä»¶: èµ„æºæ˜¯ç‹¬å çš„ï¼Œä¸€ä¸ªçº¿ç¨‹åœ¨ä½¿ç”¨æ—¶ï¼Œå…¶ä»–çº¿ç¨‹æ— æ³•ä½¿ç”¨ã€‚</span></span><br><span class="line"><span class="comment">* 2. è¯·æ±‚ä¸ä¿æŒæ¡ä»¶: çº¿ç¨‹å·²ç»æŒæœ‰è‡³å°‘ä¸€ä¸ªèµ„æºï¼Œä½†åˆè¯·æ±‚å…¶ä»–èµ„æºï¼ŒåŒæ—¶åˆä¿æŒå¯¹å·²æœ‰èµ„æºçš„å æœ‰ã€‚</span></span><br><span class="line"><span class="comment">* 3. ä¸å¯å‰¥å¤ºæ¡ä»¶: èµ„æºåªèƒ½åœ¨æŒæœ‰å®ƒçš„çº¿ç¨‹å®Œæˆä»»åŠ¡åç”±å®ƒè‡ªå·±é‡Šæ”¾ã€‚</span></span><br><span class="line"><span class="comment">* 4. å¾ªç¯ç­‰å¾…æ¡ä»¶: å­˜åœ¨ä¸€ä¸ªçº¿ç¨‹èµ„æºçš„å¾ªç¯é“¾ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½åœ¨ç­‰å¾…ä¸‹ä¸€ä¸ªçº¿ç¨‹æ‰€æŒæœ‰çš„èµ„æºã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><hr><h3 id="æ­»é”é¢„é˜²"><a href="#æ­»é”é¢„é˜²" class="headerlink" title="æ­»é”é¢„é˜²"></a>æ­»é”é¢„é˜²</h3><p>é€šè¿‡æ‰“ç ´æ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶ä¹‹ä¸€æ¥é¢„é˜²æ­»é”ã€‚è¿™é‡Œé€šè¿‡<strong>èµ„æºæœ‰åºåˆ†é…</strong>æ¥æ‰“ç ´<strong>å¾ªç¯ç­‰å¾…</strong>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DeadlockPrevention</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">lock1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">lock2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">threadA</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// çº¿ç¨‹ A æŒ‰é¡ºåºå…ˆè·å– lock1ï¼Œå†è·å– lock2</span></span><br><span class="line">        <span class="keyword">synchronized</span> (lock1) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;çº¿ç¨‹A: å·²è·å¾— lock1ï¼Œå°è¯•è·å– lock2...&quot;</span>);</span><br><span class="line">            <span class="keyword">synchronized</span> (lock2) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;çº¿ç¨‹A: å·²è·å¾— lock2ã€‚&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">threadB</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// çº¿ç¨‹ B ä¹ŸæŒ‰é¡ºåºå…ˆè·å– lock1ï¼Œå†è·å– lock2</span></span><br><span class="line">        <span class="keyword">synchronized</span> (lock1) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;çº¿ç¨‹B: å·²è·å¾— lock1ï¼Œå°è¯•è·å– lock2...&quot;</span>);</span><br><span class="line">            <span class="keyword">synchronized</span> (lock2) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;çº¿ç¨‹B: å·²è·å¾— lock2ã€‚&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">DeadlockPrevention</span> <span class="variable">demo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeadlockPrevention</span>();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(demo::threadA, <span class="string">&quot;Thread-A&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(demo::threadB, <span class="string">&quot;Thread-B&quot;</span>).start();</span><br><span class="line">        <span class="comment">// ä¸¤ä¸ªçº¿ç¨‹éƒ½æŒ‰ç›¸åŒçš„é¡ºåºè·å–é”ï¼Œä¸ä¼šå‘ç”Ÿæ­»é”</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="ThreadLocal"><a href="#ThreadLocal" class="headerlink" title="ThreadLocal"></a><code>ThreadLocal</code></h3><p><code>ThreadLocal</code> ä¸ºæ¯ä¸ªçº¿ç¨‹æä¾›äº†ä¸€ä¸ªç‹¬ç«‹çš„å˜é‡å‰¯æœ¬ï¼Œå®ç°äº†çº¿ç¨‹é—´çš„æ•°æ®éš”ç¦»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ThreadLocalDemo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;String&gt; threadLocal = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAndPrint</span><span class="params">(String value)</span> &#123;</span><br><span class="line">        <span class="comment">// è®¾ç½®çº¿ç¨‹æœ¬åœ°å˜é‡</span></span><br><span class="line">        threadLocal.set(value);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>); <span class="comment">// æ¨¡æ‹Ÿä»»åŠ¡</span></span><br><span class="line">            <span class="comment">// è·å–å¹¶æ‰“å°å½“å‰çº¿ç¨‹çš„å˜é‡å€¼</span></span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; çš„å˜é‡å€¼: &quot;</span> + threadLocal.get());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// æœ€ä½³å®è·µï¼šä½¿ç”¨å®Œåç§»é™¤ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼</span></span><br><span class="line">            threadLocal.remove();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ThreadLocalDemo</span> <span class="variable">demo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadLocalDemo</span>();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; demo.setAndPrint(<span class="string">&quot;çº¿ç¨‹ A çš„æ•°æ®&quot;</span>), <span class="string">&quot;Thread-A&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; demo.setAndPrint(<span class="string">&quot;çº¿ç¨‹ B çš„æ•°æ®&quot;</span>), <span class="string">&quot;Thread-B&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* åŸç†å’Œä½œç”¨:</span></span><br><span class="line"><span class="comment">* åŸç†: ThreadLocal å†…éƒ¨æœ‰ä¸€ä¸ª `ThreadLocalMap`ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ `ThreadLocalMap`ã€‚</span></span><br><span class="line"><span class="comment">* å½“æˆ‘ä»¬è°ƒç”¨ `set()` æ–¹æ³•æ—¶ï¼Œå®é™…ä¸Šæ˜¯å°†å€¼å­˜å‚¨åˆ°äº†å½“å‰çº¿ç¨‹çš„ `ThreadLocalMap` ä¸­ï¼Œ</span></span><br><span class="line"><span class="comment">* é”®ä¸º `ThreadLocal` å®ä¾‹æœ¬èº«ã€‚</span></span><br><span class="line"><span class="comment">* ä½œç”¨:</span></span><br><span class="line"><span class="comment">* 1. æ•°æ®éš”ç¦»: è§£å†³äº†å¤šçº¿ç¨‹è®¿é—®å…±äº«å˜é‡çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œä½†å…¶æœ¬è´¨ä¸æ˜¯åŒæ­¥ï¼Œè€Œæ˜¯é€šè¿‡â€œä»¥ç©ºé—´æ¢æ—¶é—´â€çš„æ–¹å¼ï¼Œ</span></span><br><span class="line"><span class="comment">* ä¸ºæ¯ä¸ªçº¿ç¨‹æä¾›ç‹¬ç«‹å‰¯æœ¬ï¼Œé¿å…äº†ç«äº‰ã€‚</span></span><br><span class="line"><span class="comment">* 2. ä¼ é€’å‚æ•°: åœ¨æ•´ä¸ªæ–¹æ³•è°ƒç”¨é“¾ä¸­ï¼Œæ— éœ€å±‚å±‚ä¼ é€’å‚æ•°ï¼Œå¯ä»¥æ–¹ä¾¿åœ°åœ¨ä»»ä½•åœ°æ–¹è·å–å½“å‰çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><hr><h3 id="çº¿ç¨‹å®‰å…¨å•ä¾‹-é™æ€å†…éƒ¨ç±»"><a href="#çº¿ç¨‹å®‰å…¨å•ä¾‹-é™æ€å†…éƒ¨ç±»" class="headerlink" title="çº¿ç¨‹å®‰å…¨å•ä¾‹ (é™æ€å†…éƒ¨ç±»)"></a>çº¿ç¨‹å®‰å…¨å•ä¾‹ (é™æ€å†…éƒ¨ç±»)</h3><p>é™æ€å†…éƒ¨ç±»æ–¹å¼æ˜¯å®ç°çº¿ç¨‹å®‰å…¨çš„æ‡’æ±‰å¼å•ä¾‹çš„æœ€ä½³å®è·µä¹‹ä¸€ã€‚å®ƒåˆ©ç”¨äº† JVM ç±»åŠ è½½æœºåˆ¶çš„çº¿ç¨‹å®‰å…¨ç‰¹æ€§ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SingletonThreadSafe</span> &#123;</span><br><span class="line">    <span class="comment">// ç§æœ‰åŒ–æ„é€ å™¨</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">SingletonThreadSafe</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é™æ€å†…éƒ¨ç±»ï¼Œå®ƒåªåœ¨ SingletonThreadSafe è¢«é¦–æ¬¡è°ƒç”¨æ—¶æ‰ä¼šè¢«åŠ è½½</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">SingletonHolder</span> &#123;</span><br><span class="line">        <span class="comment">// é™æ€æˆå‘˜å˜é‡ï¼Œåœ¨ç±»åŠ è½½æ—¶åˆå§‹åŒ–</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">SingletonThreadSafe</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SingletonThreadSafe</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æä¾›å…¨å±€è®¿é—®ç‚¹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SingletonThreadSafe <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> SingletonHolder.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* ä¼˜ç‚¹:</span></span><br><span class="line"><span class="comment">* 1. çº¿ç¨‹å®‰å…¨: ç±»çš„åŠ è½½æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› æ­¤ INSTANCE çš„åˆå§‹åŒ–æ˜¯åŸå­çš„ã€‚</span></span><br><span class="line"><span class="comment">* 2. æ‡’åŠ è½½: åªæœ‰åœ¨è°ƒç”¨ getInstance() æ–¹æ³•æ—¶ï¼ŒSingletonHolder ç±»æ‰ä¼šè¢«åŠ è½½ï¼Œ</span></span><br><span class="line"><span class="comment">* ä»è€Œå®ç°æ‡’åŠ è½½ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><hr><h3 id="ReadWriteLock"><a href="#ReadWriteLock" class="headerlink" title="ReadWriteLock"></a><code>ReadWriteLock</code></h3><p><code>ReadWriteLock</code> é€‚ç”¨äºè¯»å¤šå†™å°‘çš„åœºæ™¯ï¼Œå®ƒå…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è¿›è¡Œè¯»æ“ä½œï¼Œä½†å†™æ“ä½œå¿…é¡»æ˜¯äº’æ–¥çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReadWriteLock;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantReadWriteLock;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ReadWriteLockDemo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">ReadWriteLock</span> <span class="variable">rwLock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantReadWriteLock</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">sharedData</span> <span class="operator">=</span> <span class="string">&quot;åˆå§‹æ•°æ®&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">readData</span><span class="params">()</span> &#123;</span><br><span class="line">        rwLock.readLock().lock(); <span class="comment">// è·å–è¯»é”</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; æ­£åœ¨è¯»å–æ•°æ®...&quot;</span>);</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            <span class="keyword">return</span> (String) sharedData;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            Thread.currentThread().interrupt();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            rwLock.readLock().unlock(); <span class="comment">// é‡Šæ”¾è¯»é”</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">writeData</span><span class="params">(String newData)</span> &#123;</span><br><span class="line">        rwLock.writeLock().lock(); <span class="comment">// è·å–å†™é”</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; æ­£åœ¨å†™å…¥æ•°æ®...&quot;</span>);</span><br><span class="line">            Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">            <span class="comment">// sharedData = newData; // å®é™…æ›´æ–°æ•°æ®</span></span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; å†™å…¥å®Œæˆã€‚&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            Thread.currentThread().interrupt();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            rwLock.writeLock().unlock(); <span class="comment">// é‡Šæ”¾å†™é”</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="çº¿ç¨‹æ± å…³é—­"><a href="#çº¿ç¨‹æ± å…³é—­" class="headerlink" title="çº¿ç¨‹æ± å…³é—­"></a>çº¿ç¨‹æ± å…³é—­</h3><p><code>ExecutorService</code> çš„ä¸¤ç§å…³é—­æ–¹å¼ï¼š<code>shutdown()</code> å’Œ <code>shutdownNow()</code>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ShutdownDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">executor</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æäº¤ 5 ä¸ªä»»åŠ¡</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">int</span> <span class="variable">taskId</span> <span class="operator">=</span> i;</span><br><span class="line">            executor.execute(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;ä»»åŠ¡ &quot;</span> + taskId + <span class="string">&quot; æ­£åœ¨æ‰§è¡Œ...&quot;</span>);</span><br><span class="line">                    Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;ä»»åŠ¡ &quot;</span> + taskId + <span class="string">&quot; è¢«ä¸­æ–­ã€‚&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// shutdown() vs shutdownNow()</span></span><br><span class="line">        <span class="comment">// executor.shutdown(); // ä¼˜é›…å…³é—­</span></span><br><span class="line">        executor.shutdownNow(); <span class="comment">// æš´åŠ›å…³é—­</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;çº¿ç¨‹æ± å·²å…³é—­ã€‚&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* åŒºåˆ«:</span></span><br><span class="line"><span class="comment">* - shutdown(): ä¼˜é›…å…³é—­ã€‚ä¸å†æ¥å—æ–°çš„ä»»åŠ¡ï¼Œä½†ä¼šç­‰å¾…å·²æäº¤çš„ä»»åŠ¡ï¼ˆåŒ…æ‹¬æ­£åœ¨æ‰§è¡Œå’Œåœ¨é˜Ÿåˆ—ä¸­çš„ï¼‰å…¨éƒ¨æ‰§è¡Œå®Œæ¯•ã€‚</span></span><br><span class="line"><span class="comment">* æ‰§è¡Œåï¼ŒisShutdown() è¿”å› trueï¼ŒisTerminated() è¿”å› falseï¼Œç›´åˆ°æ‰€æœ‰ä»»åŠ¡å®Œæˆã€‚</span></span><br><span class="line"><span class="comment">* - shutdownNow(): æš´åŠ›å…³é—­ã€‚ç«‹å³åœæ­¢æ‰€æœ‰æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¹¶è¿”å›åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡åˆ—è¡¨ã€‚</span></span><br><span class="line"><span class="comment">* å®ƒä¼šå‘æ‰€æœ‰çº¿ç¨‹å‘é€ interrupt() ä¸­æ–­ä¿¡å·ã€‚</span></span><br><span class="line"><span class="comment">* æ‰§è¡Œåï¼ŒisShutdown() è¿”å› trueï¼ŒisTerminated() ç«‹å³è¿”å› trueã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><hr><h3 id="ä¸­æ–­æœºåˆ¶"><a href="#ä¸­æ–­æœºåˆ¶" class="headerlink" title="ä¸­æ–­æœºåˆ¶"></a>ä¸­æ–­æœºåˆ¶</h3><p>ä¸€ä¸ªçº¿ç¨‹é€šè¿‡å“åº” <code>interrupt()</code> è°ƒç”¨æ¥æ­£ç¡®åœæ­¢è‡ªèº«ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">InterruptedThreadDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">worker</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">while</span> (!Thread.currentThread().isInterrupted()) &#123; <span class="comment">// æ£€æŸ¥ä¸­æ–­æ ‡å¿—</span></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;çº¿ç¨‹æ­£åœ¨æ‰§è¡Œ...&quot;</span>);</span><br><span class="line">                    <span class="comment">// sleep()ã€wait() ç­‰æ–¹æ³•ä¼šæŠ›å‡º InterruptedException å¹¶æ¸…é™¤ä¸­æ–­æ ‡å¿—</span></span><br><span class="line">                    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;çº¿ç¨‹è¢«ä¸­æ–­ï¼&quot;</span>);</span><br><span class="line">                    <span class="comment">// é‡æ–°è®¾ç½®ä¸­æ–­æ ‡å¿—ï¼Œä»¥ä¾¿å¤–å±‚å¾ªç¯èƒ½æ­£ç¡®é€€å‡º</span></span><br><span class="line">                    Thread.currentThread().interrupt();</span><br><span class="line">                    <span class="comment">// æˆ–è€…ç›´æ¥ return é€€å‡º</span></span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;çº¿ç¨‹å·²é€€å‡ºã€‚&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        worker.start();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">3500</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å‘é€ä¸­æ–­ä¿¡å·</span></span><br><span class="line">        worker.interrupt();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å­æ•°ç»„æ±‚å’Œ-Subarray-Sum"><a href="#å­æ•°ç»„æ±‚å’Œ-Subarray-Sum" class="headerlink" title="å­æ•°ç»„æ±‚å’Œ (Subarray Sum)"></a>å­æ•°ç»„æ±‚å’Œ (Subarray Sum)</h3><p>ä½¿ç”¨<strong>æ»‘åŠ¨çª—å£</strong>æˆ–<strong>å‰ç¼€å’Œ + å“ˆå¸Œè¡¨</strong>ä¸¤ç§æ–¹å¼è§£å†³ã€‚è¿™é‡Œæ¼”ç¤ºå‰ç¼€å’Œ + å“ˆå¸Œè¡¨ï¼Œå®ƒèƒ½å¤„ç†è´Ÿæ•°æƒ…å†µä¸”æ—¶é—´å¤æ‚åº¦æ›´ä¼˜ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ArrayProblems</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰¾å‡ºå’Œç­‰äºç›®æ ‡å€¼çš„è¿ç»­å­æ•°ç»„ã€‚</span></span><br><span class="line"><span class="comment">     * ä½¿ç”¨å‰ç¼€å’Œä¸å“ˆå¸Œè¡¨çš„æ–¹å¼ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(n)ã€‚</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> nums   æ•´æ•°æ•°ç»„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> target ç›®æ ‡å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å¦‚æœæ‰¾åˆ°ï¼Œè¿”å›å­æ•°ç»„çš„èµ·å§‹å’Œç»“æŸç´¢å¼•ï¼›å¦åˆ™è¿”å› null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[] findSubarraySum(<span class="type">int</span>[] nums, <span class="type">int</span> target) &#123;</span><br><span class="line">        <span class="keyword">if</span> (nums == <span class="literal">null</span> || nums.length == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// key: å‰ç¼€å’Œ, value: å‡ºç°è¯¥å‰ç¼€å’Œçš„ç´¢å¼•</span></span><br><span class="line">        Map&lt;Integer, Integer&gt; prefixSumMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        prefixSumMap.put(<span class="number">0</span>, -<span class="number">1</span>); <span class="comment">// åˆå§‹åŒ–ï¼Œå¤„ç†ä»æ•°ç»„å¼€å¤´å¼€å§‹çš„å­æ•°ç»„</span></span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">currentSum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">            currentSum += nums[i];</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ£€æŸ¥æ˜¯å¦å­˜åœ¨ (currentSum - target) è¿™æ ·çš„å‰ç¼€å’Œ</span></span><br><span class="line">            <span class="keyword">if</span> (prefixSumMap.containsKey(currentSum - target)) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">start</span> <span class="operator">=</span> prefixSumMap.get(currentSum - target) + <span class="number">1</span>;</span><br><span class="line">                <span class="type">int</span> <span class="variable">end</span> <span class="operator">=</span> i;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;start, end&#125;;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            prefixSumMap.put(currentSum, i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="å­—ç¬¦ä¸²å»é‡-Remove-Duplicates-from-String"><a href="#å­—ç¬¦ä¸²å»é‡-Remove-Duplicates-from-String" class="headerlink" title="å­—ç¬¦ä¸²å»é‡ (Remove Duplicates from String)"></a>å­—ç¬¦ä¸²å»é‡ (Remove Duplicates from String)</h3><p>ä½¿ç”¨ <code>LinkedHashSet</code> ä¿æŒç›¸å¯¹é¡ºåºæˆ–æ‰‹åŠ¨éå†ã€‚è¿™é‡Œæ‰‹åŠ¨éå†å®ç°ï¼Œé¿å…ä½¿ç”¨é¢å¤–æ•°æ®ç»“æ„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">StringProblems</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¯¹ä¸€ä¸ªå­—ç¬¦ä¸²è¿›è¡Œå»é‡ï¼Œå¹¶ä¿æŒåŸæœ‰å­—ç¬¦çš„ç›¸å¯¹é¡ºåºã€‚</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> str å¾…å»é‡çš„å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å»é‡åçš„å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">removeDuplicates</span><span class="params">(String str)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (str == <span class="literal">null</span> || str.length() &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> str;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="type">boolean</span>[] charSet = <span class="keyword">new</span> <span class="title class_">boolean</span>[<span class="number">256</span>]; <span class="comment">// å‡è®¾ä¸º ASCII å­—ç¬¦é›†</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; str.length(); i++) &#123;</span><br><span class="line">            <span class="type">char</span> <span class="variable">c</span> <span class="operator">=</span> str.charAt(i);</span><br><span class="line">            <span class="keyword">if</span> (!charSet[c]) &#123;</span><br><span class="line">                sb.append(c);</span><br><span class="line">                charSet[c] = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="æœ€é•¿ä¸é‡å¤å­ä¸²-Longest-Substring-Without-Repeating-Characters"><a href="#æœ€é•¿ä¸é‡å¤å­ä¸²-Longest-Substring-Without-Repeating-Characters" class="headerlink" title="æœ€é•¿ä¸é‡å¤å­ä¸² (Longest Substring Without Repeating Characters)"></a>æœ€é•¿ä¸é‡å¤å­ä¸² (Longest Substring Without Repeating Characters)</h3><p>ä½¿ç”¨<strong>æ»‘åŠ¨çª—å£</strong>åŠ <strong>å“ˆå¸Œè¡¨</strong>æˆ–<strong>æ•°ç»„</strong>æ¥é«˜æ•ˆè§£å†³ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StringProblems</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰¾å‡ºæœ€é•¿ä¸é‡å¤å­ä¸²çš„é•¿åº¦ã€‚</span></span><br><span class="line"><span class="comment">     * ä½¿ç”¨æ»‘åŠ¨çª—å£ï¼ˆåŒæŒ‡é’ˆï¼‰å’Œå“ˆå¸Œè¡¨</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> s è¾“å…¥å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æœ€é•¿ä¸é‡å¤å­ä¸²çš„é•¿åº¦</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">lengthOfLongestSubstring</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (s == <span class="literal">null</span> || s.length() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// key: å­—ç¬¦, value: å­—ç¬¦çš„æœ€æ–°ç´¢å¼•</span></span><br><span class="line">        Map&lt;Character, Integer&gt; charIndexMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span> <span class="variable">maxLength</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>; <span class="comment">// æ»‘åŠ¨çª—å£çš„å·¦è¾¹ç•Œ</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> <span class="number">0</span>; right &lt; s.length(); right++) &#123;</span><br><span class="line">            <span class="type">char</span> <span class="variable">currentChar</span> <span class="operator">=</span> s.charAt(right);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å¦‚æœå½“å‰å­—ç¬¦å·²åœ¨çª—å£å†…ï¼Œæ›´æ–°å·¦è¾¹ç•Œ</span></span><br><span class="line">            <span class="keyword">if</span> (charIndexMap.containsKey(currentChar)) &#123;</span><br><span class="line">                left = Math.max(left, charIndexMap.get(currentChar) + <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            charIndexMap.put(currentChar, right);</span><br><span class="line">            maxLength = Math.max(maxLength, right - left + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> maxLength;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="å­—ç¬¦ä¸²è½¬æ•´æ•°-String-to-Integer-atoi"><a href="#å­—ç¬¦ä¸²è½¬æ•´æ•°-String-to-Integer-atoi" class="headerlink" title="å­—ç¬¦ä¸²è½¬æ•´æ•° (String to Integer - atoi)"></a>å­—ç¬¦ä¸²è½¬æ•´æ•° (String to Integer - atoi)</h3><p>å®ç° <code>atoi</code> å‡½æ•°ï¼Œéœ€è¦è€ƒè™‘å„ç§è¾¹ç•Œæƒ…å†µã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">StringProblems</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å®ç° atoi å‡½æ•°ï¼Œå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•´æ•°ã€‚</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> s å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> è½¬æ¢åçš„æ•´æ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">myAtoi</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (s == <span class="literal">null</span> || s.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        s = s.trim(); <span class="comment">// 1. å»æ‰å‰å¯¼ç©ºæ ¼</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (s.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">sign</span> <span class="operator">=</span> <span class="number">1</span>; <span class="comment">// 2. å¤„ç†æ­£è´Ÿå·</span></span><br><span class="line">        <span class="keyword">if</span> (s.charAt(index) == <span class="string">&#x27;-&#x27;</span>) &#123;</span><br><span class="line">            sign = -<span class="number">1</span>;</span><br><span class="line">            index++;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (s.charAt(index) == <span class="string">&#x27;+&#x27;</span>) &#123;</span><br><span class="line">            index++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">result</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (index &lt; s.length()) &#123;</span><br><span class="line">            <span class="type">char</span> <span class="variable">c</span> <span class="operator">=</span> s.charAt(index);</span><br><span class="line">            <span class="comment">// 3. æ£€æŸ¥æ˜¯å¦ä¸ºæ•°å­—</span></span><br><span class="line">            <span class="keyword">if</span> (!Character.isDigit(c)) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">int</span> <span class="variable">digit</span> <span class="operator">=</span> c - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">            result = result * <span class="number">10</span> + digit;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 4. å¤„ç†æº¢å‡º</span></span><br><span class="line">            <span class="keyword">if</span> (sign == <span class="number">1</span> &amp;&amp; result &gt; Integer.MAX_VALUE) &#123;</span><br><span class="line">                <span class="keyword">return</span> Integer.MAX_VALUE;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (sign == -<span class="number">1</span> &amp;&amp; -result &lt; Integer.MIN_VALUE) &#123;</span><br><span class="line">                <span class="keyword">return</span> Integer.MIN_VALUE;</span><br><span class="line">            &#125;</span><br><span class="line">            index++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (<span class="type">int</span>) (result * sign);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="åˆ¤æ–­å­ä¸²-Substring-Check"><a href="#åˆ¤æ–­å­ä¸²-Substring-Check" class="headerlink" title="åˆ¤æ–­å­ä¸² (Substring Check)"></a>åˆ¤æ–­å­ä¸² (Substring Check)</h3><p>ä½¿ç”¨ <code>String.indexOf()</code> æ˜¯æœ€ç›´æ¥çš„æ–¹å¼ã€‚å¦‚æœä¸èƒ½ä½¿ç”¨å†…ç½®æ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡åŒæŒ‡é’ˆæˆ– KMP ç®—æ³•å®ç°ã€‚è¿™é‡Œæä¾›åŒæŒ‡é’ˆçš„å®ç°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">StringProblems</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ¤æ–­ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦æ˜¯å¦ä¸€ä¸ªå­—ç¬¦ä¸²çš„å­ä¸²ã€‚</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> mainStr ä¸»å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> subStr  å­å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å¦‚æœ subStr æ˜¯ mainStr çš„å­ä¸²ï¼Œè¿”å› trueï¼›å¦åˆ™è¿”å› false</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isSubstring</span><span class="params">(String mainStr, String subStr)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (mainStr == <span class="literal">null</span> || subStr == <span class="literal">null</span> || mainStr.length() &lt; subStr.length()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (subStr.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;= mainStr.length() - subStr.length(); i++) &#123;</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">match</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; subStr.length(); j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (mainStr.charAt(i + j) != subStr.charAt(j)) &#123;</span><br><span class="line">                    match = <span class="literal">false</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (match) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="æ•°ç»„æ—‹è½¬-Array-Rotation"><a href="#æ•°ç»„æ—‹è½¬-Array-Rotation" class="headerlink" title="æ•°ç»„æ—‹è½¬ (Array Rotation)"></a>æ•°ç»„æ—‹è½¬ (Array Rotation)</h3><p>å‘å³æ—‹è½¬ <code>k</code> æ­¥ï¼Œå¯ä»¥é€šè¿‡ä¸‰æ¬¡åè½¬æˆ–ä½¿ç”¨é¢å¤–æ•°ç»„å®ç°ã€‚è¿™é‡Œä½¿ç”¨ç©ºé—´å¤æ‚åº¦ä¸º <code>O(1)</code> çš„ä¸‰æ¬¡åè½¬æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ArrayProblems</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†ä¸€ä¸ªæ•´æ•°æ•°ç»„å‘å³æ—‹è½¬ k æ­¥ã€‚</span></span><br><span class="line"><span class="comment">     * ä½¿ç”¨ä¸‰æ¬¡åè½¬çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> nums æ•´æ•°æ•°ç»„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> k    æ—‹è½¬æ­¥æ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">rotate</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (nums == <span class="literal">null</span> || nums.length &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        k %= nums.length; <span class="comment">// å¤„ç† k å¤§äºæ•°ç»„é•¿åº¦çš„æƒ…å†µ</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1. åè½¬æ•´ä¸ªæ•°ç»„</span></span><br><span class="line">        reverse(nums, <span class="number">0</span>, nums.length - <span class="number">1</span>);</span><br><span class="line">        <span class="comment">// 2. åè½¬å‰ k ä¸ªå…ƒç´ </span></span><br><span class="line">        reverse(nums, <span class="number">0</span>, k - <span class="number">1</span>);</span><br><span class="line">        <span class="comment">// 3. åè½¬å‰©ä¸‹çš„å…ƒç´ </span></span><br><span class="line">        reverse(nums, k, nums.length - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">reverse</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> start, <span class="type">int</span> end)</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (start &lt; end) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> nums[start];</span><br><span class="line">            nums[start] = nums[end];</span><br><span class="line">            nums[end] = temp;</span><br><span class="line">            start++;</span><br><span class="line">            end--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="äº¤é”™å­—ç¬¦ä¸²-Interleaving-String"><a href="#äº¤é”™å­—ç¬¦ä¸²-Interleaving-String" class="headerlink" title="äº¤é”™å­—ç¬¦ä¸² (Interleaving String)"></a>äº¤é”™å­—ç¬¦ä¸² (Interleaving String)</h3><p>åˆ¤æ–­ <code>s3</code> æ˜¯å¦ç”± <code>s1</code> å’Œ <code>s2</code> äº¤é”™è€Œæˆï¼Œå¯ä»¥ä½¿ç”¨<strong>åŠ¨æ€è§„åˆ’</strong>è§£å†³ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">StringProblems</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ¤æ–­ä¸¤ä¸ªå­—ç¬¦ä¸²äº¤é”™å½¢æˆçš„å­—ç¬¦ä¸²æ˜¯å¦ç­‰äºç¬¬ä¸‰ä¸ªå­—ç¬¦ä¸²ã€‚</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> s1 å­—ç¬¦ä¸²1</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> s2 å­—ç¬¦ä¸²2</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> s3 å­—ç¬¦ä¸²3</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å¦‚æœæ˜¯äº¤é”™å­—ç¬¦ä¸²ï¼Œè¿”å› trueï¼›å¦åˆ™è¿”å› false</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isInterleave</span><span class="params">(String s1, String s2, String s3)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (s1.length() + s2.length() != s3.length()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// dp[i][j] è¡¨ç¤º s1 çš„å‰ i ä¸ªå­—ç¬¦å’Œ s2 çš„å‰ j ä¸ªå­—ç¬¦èƒ½å¦äº¤é”™ç»„æˆ s3 çš„å‰ i+j ä¸ªå­—ç¬¦</span></span><br><span class="line">        <span class="type">boolean</span>[][] dp = <span class="keyword">new</span> <span class="title class_">boolean</span>[s1.length() + <span class="number">1</span>][s2.length() + <span class="number">1</span>];</span><br><span class="line">        dp[<span class="number">0</span>][<span class="number">0</span>] = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–ç¬¬ä¸€è¡Œ (s1 ä¸å–å­—ç¬¦)</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt;= s2.length(); j++) &#123;</span><br><span class="line">            dp[<span class="number">0</span>][j] = dp[<span class="number">0</span>][j - <span class="number">1</span>] &amp;&amp; s2.charAt(j - <span class="number">1</span>) == s3.charAt(j - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–ç¬¬ä¸€åˆ— (s2 ä¸å–å­—ç¬¦)</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= s1.length(); i++) &#123;</span><br><span class="line">            dp[i][<span class="number">0</span>] = dp[i - <span class="number">1</span>][<span class="number">0</span>] &amp;&amp; s1.charAt(i - <span class="number">1</span>) == s3.charAt(i - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¡«å…… DP è¡¨</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= s1.length(); i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt;= s2.length(); j++) &#123;</span><br><span class="line">                dp[i][j] = (dp[i - <span class="number">1</span>][j] &amp;&amp; s1.charAt(i - <span class="number">1</span>) == s3.charAt(i + j - <span class="number">1</span>)) ||</span><br><span class="line">                           (dp[i][j - <span class="number">1</span>] &amp;&amp; s2.charAt(j - <span class="number">1</span>) == s3.charAt(i + j - <span class="number">1</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[s1.length()][s2.length()];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="æœ€é•¿å…¬å…±å‰ç¼€-Longest-Common-Prefix"><a href="#æœ€é•¿å…¬å…±å‰ç¼€-Longest-Common-Prefix" class="headerlink" title="æœ€é•¿å…¬å…±å‰ç¼€ (Longest Common Prefix)"></a>æœ€é•¿å…¬å…±å‰ç¼€ (Longest Common Prefix)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">StringProblems</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰¾å‡ºå­—ç¬¦ä¸²æ•°ç»„ä¸­çš„æœ€é•¿å…¬å…±å‰ç¼€ã€‚</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> strs å­—ç¬¦ä¸²æ•°ç»„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æœ€é•¿å…¬å…±å‰ç¼€</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">longestCommonPrefix</span><span class="params">(String[] strs)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (strs == <span class="literal">null</span> || strs.length == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">prefix</span> <span class="operator">=</span> strs[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; strs.length; i++) &#123;</span><br><span class="line">            <span class="comment">// å¾ªç¯æ¯”è¾ƒï¼Œç›´åˆ°æ‰¾åˆ°å­ä¸²</span></span><br><span class="line">            <span class="keyword">while</span> (strs[i].indexOf(prefix) != <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">// æ¯æ¬¡ç¼©çŸ­ prefix</span></span><br><span class="line">                prefix = prefix.substring(<span class="number">0</span>, prefix.length() - <span class="number">1</span>);</span><br><span class="line">                <span class="keyword">if</span> (prefix.isEmpty()) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> prefix;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="å­—ç¬¦ä¸²å‹ç¼©-String-Compression"><a href="#å­—ç¬¦ä¸²å‹ç¼©-String-Compression" class="headerlink" title="å­—ç¬¦ä¸²å‹ç¼© (String Compression)"></a>å­—ç¬¦ä¸²å‹ç¼© (String Compression)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">StringProblems</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å®ç°åŸºæœ¬çš„å­—ç¬¦ä¸²å‹ç¼©ï¼Œä¾‹å¦‚ aabcccccaaa å‹ç¼©ä¸º a2b1c5a3ã€‚</span></span><br><span class="line"><span class="comment">     * å¦‚æœå‹ç¼©åçš„å­—ç¬¦ä¸²æ²¡æœ‰å˜çŸ­ï¼Œåˆ™è¿”å›åŸå­—ç¬¦ä¸²ã€‚</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> str å¾…å‹ç¼©çš„å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å‹ç¼©åçš„å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">compressString</span><span class="params">(String str)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (str == <span class="literal">null</span> || str.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">compressed</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= str.length(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i &lt; str.length() &amp;&amp; str.charAt(i) == str.charAt(i - <span class="number">1</span>)) &#123;</span><br><span class="line">                count++;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                compressed.append(str.charAt(i - <span class="number">1</span>)).append(count);</span><br><span class="line">                count = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (compressed.length() &gt;= str.length()) &#123;</span><br><span class="line">            <span class="keyword">return</span> str; <span class="comment">// å¦‚æœå‹ç¼©åæ²¡æœ‰å˜çŸ­ï¼Œè¿”å›åŸå­—ç¬¦ä¸²</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> compressed.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="å¯»æ‰¾é‡å¤æ•°-Find-the-Duplicate-Number"><a href="#å¯»æ‰¾é‡å¤æ•°-Find-the-Duplicate-Number" class="headerlink" title="å¯»æ‰¾é‡å¤æ•° (Find the Duplicate Number)"></a>å¯»æ‰¾é‡å¤æ•° (Find the Duplicate Number)</h3><p>ç»™å®šä¸€ä¸ªåŒ…å« <code>n+1</code> ä¸ªæ•´æ•°çš„æ•°ç»„ï¼Œæ•°å­—éƒ½åœ¨ <code>1</code> åˆ° <code>n</code> çš„èŒƒå›´å†…ã€‚æ‰¾å‡ºè¿™ä¸ªé‡å¤çš„æ•°å­—ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ArrayProblems</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä½¿ç”¨**å¿«æ…¢æŒ‡é’ˆ**ï¼ˆç±»ä¼¼äºæ£€æµ‹é“¾è¡¨ç¯ï¼‰æ¥å¯»æ‰¾é‡å¤æ•°ã€‚</span></span><br><span class="line"><span class="comment">     * å‡è®¾æ•°ç»„æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œç´¢å¼• `i` æŒ‡å‘ `nums[i]`</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> nums åŒ…å« n+1 ä¸ªæ•´æ•°çš„æ•°ç»„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> é‡å¤çš„æ•°å­—</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">findDuplicate</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. å¯»æ‰¾ç¯çš„å…¥å£</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">slow</span> <span class="operator">=</span> nums[<span class="number">0</span>];</span><br><span class="line">        <span class="type">int</span> <span class="variable">fast</span> <span class="operator">=</span> nums[nums[<span class="number">0</span>]];</span><br><span class="line">        <span class="keyword">while</span> (slow != fast) &#123;</span><br><span class="line">            slow = nums[slow];</span><br><span class="line">            fast = nums[nums[fast]];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. æ‰¾åˆ°ç¯åï¼Œä»å¤´å¼€å§‹ï¼Œå¿«æ…¢æŒ‡é’ˆä»¥ç›¸åŒé€Ÿåº¦å‰è¿›ï¼Œç›¸é‡ç‚¹å³ä¸ºç¯çš„å…¥å£ï¼ˆé‡å¤æ•°ï¼‰</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">p1</span> <span class="operator">=</span> nums[<span class="number">0</span>];</span><br><span class="line">        <span class="type">int</span> <span class="variable">p2</span> <span class="operator">=</span> slow;</span><br><span class="line">        <span class="keyword">while</span> (p1 != p2) &#123;</span><br><span class="line">            p1 = nums[p1];</span><br><span class="line">            p2 = nums[p2];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> p1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="é“¾è¡¨ã€æ ˆä¸é˜Ÿåˆ—"><a href="#é“¾è¡¨ã€æ ˆä¸é˜Ÿåˆ—" class="headerlink" title="é“¾è¡¨ã€æ ˆä¸é˜Ÿåˆ—"></a>é“¾è¡¨ã€æ ˆä¸é˜Ÿåˆ—</h3><h4 id="åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨"><a href="#åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨" class="headerlink" title="åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨"></a>åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨</h4><p>ä½¿ç”¨<strong>åŒæŒ‡é’ˆ</strong>æ–¹æ³•ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„é“¾è¡¨ï¼Œéå†ä¸¤ä¸ªè¾“å…¥é“¾è¡¨ï¼Œæ¯”è¾ƒèŠ‚ç‚¹å€¼å¹¶ä¾æ¬¡æ·»åŠ åˆ°æ–°é“¾è¡¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ListNode</span> &#123;</span><br><span class="line">    <span class="type">int</span> val;</span><br><span class="line">    ListNode next;</span><br><span class="line">    ListNode(<span class="type">int</span> x) &#123; val = x; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LinkedListProblems</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ListNode <span class="title function_">mergeTwoLists</span><span class="params">(ListNode l1, ListNode l2)</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªå“‘èŠ‚ç‚¹ï¼Œç®€åŒ–æ“ä½œ</span></span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">dummy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">current</span> <span class="operator">=</span> dummy;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (l1 != <span class="literal">null</span> &amp;&amp; l2 != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (l1.val &lt;= l2.val) &#123;</span><br><span class="line">                current.next = l1;</span><br><span class="line">                l1 = l1.next;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                current.next = l2;</span><br><span class="line">                l2 = l2.next;</span><br><span class="line">            &#125;</span><br><span class="line">            current = current.next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°†å‰©ä½™çš„èŠ‚ç‚¹æ·»åŠ åˆ°æ–°é“¾è¡¨æœ«å°¾</span></span><br><span class="line">        <span class="keyword">if</span> (l1 != <span class="literal">null</span>) &#123;</span><br><span class="line">            current.next = l1;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (l2 != <span class="literal">null</span>) &#123;</span><br><span class="line">            current.next = l2;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dummy.next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é“¾è¡¨å€’æ•°ç¬¬-k-ä¸ªèŠ‚ç‚¹"><a href="#é“¾è¡¨å€’æ•°ç¬¬-k-ä¸ªèŠ‚ç‚¹" class="headerlink" title="é“¾è¡¨å€’æ•°ç¬¬ k ä¸ªèŠ‚ç‚¹"></a>é“¾è¡¨å€’æ•°ç¬¬ k ä¸ªèŠ‚ç‚¹</h4><p>ä½¿ç”¨<strong>å¿«æ…¢æŒ‡é’ˆ</strong>ï¼Œåªéå†ä¸€æ¬¡ã€‚å¿«æŒ‡é’ˆå…ˆèµ° <code>k</code> æ­¥ï¼Œç„¶åå¿«æ…¢æŒ‡é’ˆåŒæ—¶å‰è¿›ï¼Œå½“å¿«æŒ‡é’ˆåˆ°è¾¾æœ«å°¾æ—¶ï¼Œæ…¢æŒ‡é’ˆæ­£å¥½åœ¨å€’æ•°ç¬¬ <code>k</code> ä¸ªä½ç½®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LinkedListProblems</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ListNode <span class="title function_">findKthFromEnd</span><span class="params">(ListNode head, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (head == <span class="literal">null</span> || k &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">fast</span> <span class="operator">=</span> head;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">slow</span> <span class="operator">=</span> head;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¿«æŒ‡é’ˆå…ˆèµ° k æ­¥</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; k; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (fast == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>; <span class="comment">// é“¾è¡¨é•¿åº¦å°äº k</span></span><br><span class="line">            &#125;</span><br><span class="line">            fast = fast.next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¿«æ…¢æŒ‡é’ˆåŒæ—¶å‰è¿›ï¼Œç›´åˆ°å¿«æŒ‡é’ˆåˆ°è¾¾æœ«å°¾</span></span><br><span class="line">        <span class="keyword">while</span> (fast != <span class="literal">null</span>) &#123;</span><br><span class="line">            fast = fast.next;</span><br><span class="line">            slow = slow.next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> slow;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åˆ é™¤é‡å¤èŠ‚ç‚¹"><a href="#åˆ é™¤é‡å¤èŠ‚ç‚¹" class="headerlink" title="åˆ é™¤é‡å¤èŠ‚ç‚¹"></a>åˆ é™¤é‡å¤èŠ‚ç‚¹</h4><p>ç»™å®šä¸€ä¸ªå·²æ’åºçš„é“¾è¡¨ï¼Œåˆ é™¤æ‰€æœ‰é‡å¤çš„èŠ‚ç‚¹ï¼Œä½¿å¾—æ¯ä¸ªå…ƒç´ åªå‡ºç°ä¸€æ¬¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LinkedListProblems</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ListNode <span class="title function_">deleteDuplicates</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (head == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">current</span> <span class="operator">=</span> head;</span><br><span class="line">        <span class="keyword">while</span> (current != <span class="literal">null</span> &amp;&amp; current.next != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (current.val == current.next.val) &#123;</span><br><span class="line">                current.next = current.next.next; <span class="comment">// åˆ é™¤ä¸‹ä¸€ä¸ªé‡å¤èŠ‚ç‚¹</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                current = current.next; <span class="comment">// å‰è¿›åˆ°ä¸‹ä¸€ä¸ªä¸é‡å¤çš„èŠ‚ç‚¹</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åˆ¤æ–­é“¾è¡¨æ˜¯å¦æœ‰ç¯"><a href="#åˆ¤æ–­é“¾è¡¨æ˜¯å¦æœ‰ç¯" class="headerlink" title="åˆ¤æ–­é“¾è¡¨æ˜¯å¦æœ‰ç¯"></a>åˆ¤æ–­é“¾è¡¨æ˜¯å¦æœ‰ç¯</h4><p>ä½¿ç”¨<strong>å¿«æ…¢æŒ‡é’ˆ</strong>ã€‚å¦‚æœé“¾è¡¨æœ‰ç¯ï¼Œå¿«æŒ‡é’ˆæœ€ç»ˆä¼šè¿½ä¸Šæ…¢æŒ‡é’ˆã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LinkedListProblems</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">hasCycle</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (head == <span class="literal">null</span> || head.next == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">slow</span> <span class="operator">=</span> head;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">fast</span> <span class="operator">=</span> head.next;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (slow != fast) &#123;</span><br><span class="line">            <span class="keyword">if</span> (fast == <span class="literal">null</span> || fast.next == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">// å·²ç»åˆ°è¾¾æœ«å°¾ï¼Œæ²¡æœ‰ç¯</span></span><br><span class="line">            &#125;</span><br><span class="line">            slow = slow.next;</span><br><span class="line">            fast = fast.next.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é“¾è¡¨æ±‚å’Œ"><a href="#é“¾è¡¨æ±‚å’Œ" class="headerlink" title="é“¾è¡¨æ±‚å’Œ"></a>é“¾è¡¨æ±‚å’Œ</h4><p>ä¸¤ä¸ªéè´Ÿæ•´æ•°ç”±é“¾è¡¨è¡¨ç¤ºï¼Œæ¯ä¸ªèŠ‚ç‚¹åŒ…å«ä¸€ä¸ªæ•°å­—ã€‚è®¡ç®—å®ƒä»¬çš„å’Œã€‚è¿™é‡Œå‡è®¾é“¾è¡¨æŒ‰<strong>é€†åº</strong>å­˜å‚¨æ•°å­—ï¼ˆä¸ªä½åœ¨å‰ï¼‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LinkedListProblems</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ListNode <span class="title function_">addTwoNumbers</span><span class="params">(ListNode l1, ListNode l2)</span> &#123;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">dummy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">current</span> <span class="operator">=</span> dummy;</span><br><span class="line">        <span class="type">int</span> <span class="variable">carry</span> <span class="operator">=</span> <span class="number">0</span>; <span class="comment">// è¿›ä½</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (l1 != <span class="literal">null</span> || l2 != <span class="literal">null</span> || carry &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> carry;</span><br><span class="line">            <span class="keyword">if</span> (l1 != <span class="literal">null</span>) &#123;</span><br><span class="line">                sum += l1.val;</span><br><span class="line">                l1 = l1.next;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (l2 != <span class="literal">null</span>) &#123;</span><br><span class="line">                sum += l2.val;</span><br><span class="line">                l2 = l2.next;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            carry = sum / <span class="number">10</span>;</span><br><span class="line">            current.next = <span class="keyword">new</span> <span class="title class_">ListNode</span>(sum % <span class="number">10</span>);</span><br><span class="line">            current = current.next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dummy.next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ ˆå®ç°é˜Ÿåˆ—"><a href="#æ ˆå®ç°é˜Ÿåˆ—" class="headerlink" title="æ ˆå®ç°é˜Ÿåˆ—"></a>æ ˆå®ç°é˜Ÿåˆ—</h4><p>ä½¿ç”¨ä¸¤ä¸ªæ ˆï¼Œä¸€ä¸ªç”¨äºå…¥é˜Ÿ (<code>inStack</code>)ï¼Œä¸€ä¸ªç”¨äºå‡ºé˜Ÿ (<code>outStack</code>)ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Stack;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyQueue</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Stack&lt;Integer&gt; inStack;</span><br><span class="line">    <span class="keyword">private</span> Stack&lt;Integer&gt; outStack;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyQueue</span><span class="params">()</span> &#123;</span><br><span class="line">        inStack = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">        outStack = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">push</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">        inStack.push(x);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">pop</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (outStack.isEmpty()) &#123;</span><br><span class="line">            transfer();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> outStack.pop();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">peek</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (outStack.isEmpty()) &#123;</span><br><span class="line">            transfer();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> outStack.peek();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (!inStack.isEmpty()) &#123;</span><br><span class="line">            outStack.push(inStack.pop());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">empty</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> inStack.isEmpty() &amp;&amp; outStack.isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é˜Ÿåˆ—å®ç°æ ˆ"><a href="#é˜Ÿåˆ—å®ç°æ ˆ" class="headerlink" title="é˜Ÿåˆ—å®ç°æ ˆ"></a>é˜Ÿåˆ—å®ç°æ ˆ</h4><p>ä½¿ç”¨ä¸¤ä¸ªé˜Ÿåˆ—ï¼Œä¸€ä¸ªç”¨äºå…¥æ ˆ (<code>q1</code>)ï¼Œä¸€ä¸ªç”¨äºè¾…åŠ© (<code>q2</code>)ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.LinkedList;</span><br><span class="line"><span class="keyword">import</span> java.util.Queue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyStack</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Queue&lt;Integer&gt; q1;</span><br><span class="line">    <span class="keyword">private</span> Queue&lt;Integer&gt; q2;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyStack</span><span class="params">()</span> &#123;</span><br><span class="line">        q1 = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        q2 = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">push</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">        q1.offer(x);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">pop</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (q1.size() &gt; <span class="number">1</span>) &#123;</span><br><span class="line">            q2.offer(q1.poll());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> q1.poll();</span><br><span class="line">        Queue&lt;Integer&gt; temp = q1;</span><br><span class="line">        q1 = q2;</span><br><span class="line">        q2 = temp;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">top</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> pop();</span><br><span class="line">        q1.offer(result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">empty</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> q1.isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æœ‰æ•ˆæ‹¬å·"><a href="#æœ‰æ•ˆæ‹¬å·" class="headerlink" title="æœ‰æ•ˆæ‹¬å·"></a>æœ‰æ•ˆæ‹¬å·</h4><p>ä½¿ç”¨ä¸€ä¸ª<strong>æ ˆ</strong>æ¥æ£€æŸ¥æ‹¬å·æ˜¯å¦åŒ¹é…ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Stack;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StackProblems</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isValid</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        Stack&lt;Character&gt; stack = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">char</span> c : s.toCharArray()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (c == <span class="string">&#x27;(&#x27;</span> || c == <span class="string">&#x27;[&#x27;</span> || c == <span class="string">&#x27;&#123;&#x27;</span>) &#123;</span><br><span class="line">                stack.push(c);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (stack.isEmpty()) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="type">char</span> <span class="variable">top</span> <span class="operator">=</span> stack.pop();</span><br><span class="line">                <span class="keyword">if</span> ((c == <span class="string">&#x27;)&#x27;</span> &amp;&amp; top != <span class="string">&#x27;(&#x27;</span>) ||</span><br><span class="line">                    (c == <span class="string">&#x27;]&#x27;</span> &amp;&amp; top != <span class="string">&#x27;[&#x27;</span>) ||</span><br><span class="line">                    (c == <span class="string">&#x27;&#125;&#x27;</span> &amp;&amp; top != <span class="string">&#x27;&#123;&#x27;</span>)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> stack.isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="æ ‘ä¸é€’å½’"><a href="#æ ‘ä¸é€’å½’" class="headerlink" title="æ ‘ä¸é€’å½’"></a>æ ‘ä¸é€’å½’</h3><p>å®šä¹‰ä¸€ä¸ªç®€å•çš„äºŒå‰æ ‘èŠ‚ç‚¹ç±»ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public class TreeNode &#123;</span><br><span class="line">    int val;</span><br><span class="line">    TreeNode left;</span><br><span class="line">    TreeNode right;</span><br><span class="line">    TreeNode(int x) &#123; val = x; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="äºŒå‰æ ‘å‰åºéå†-Preorder-Traversal"><a href="#äºŒå‰æ ‘å‰åºéå†-Preorder-Traversal" class="headerlink" title="äºŒå‰æ ‘å‰åºéå† (Preorder Traversal)"></a>äºŒå‰æ ‘å‰åºéå† (Preorder Traversal)</h4><p><strong>é€’å½’æ–¹å¼</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TreeTraversal</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;Integer&gt; <span class="title function_">preorderTraversalRecursive</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        preorder(root, result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">preorder</span><span class="params">(TreeNode node, List&lt;Integer&gt; list)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        list.add(node.val);</span><br><span class="line">        preorder(node.left, list);</span><br><span class="line">        preorder(node.right, list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>éé€’å½’æ–¹å¼</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Stack;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TreeTraversal</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;Integer&gt; <span class="title function_">preorderTraversalIterative</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">        Stack&lt;TreeNode&gt; stack = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">        stack.push(root);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (!stack.isEmpty()) &#123;</span><br><span class="line">            <span class="type">TreeNode</span> <span class="variable">node</span> <span class="operator">=</span> stack.pop();</span><br><span class="line">            result.add(node.val);</span><br><span class="line">            <span class="comment">// å…ˆå‹å…¥å³å­èŠ‚ç‚¹ï¼Œå†å‹å…¥å·¦å­èŠ‚ç‚¹ï¼Œä¿è¯å¼¹å‡ºæ—¶å…ˆå¤„ç†å·¦å­èŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">if</span> (node.right != <span class="literal">null</span>) &#123;</span><br><span class="line">                stack.push(node.right);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (node.left != <span class="literal">null</span>) &#123;</span><br><span class="line">                stack.push(node.left);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="äºŒå‰æ ‘ä¸­åºéå†-Inorder-Traversal"><a href="#äºŒå‰æ ‘ä¸­åºéå†-Inorder-Traversal" class="headerlink" title="äºŒå‰æ ‘ä¸­åºéå† (Inorder Traversal)"></a>äºŒå‰æ ‘ä¸­åºéå† (Inorder Traversal)</h4><p><strong>é€’å½’æ–¹å¼</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TreeTraversal</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;Integer&gt; <span class="title function_">inorderTraversalRecursive</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        inorder(root, result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">inorder</span><span class="params">(TreeNode node, List&lt;Integer&gt; list)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        inorder(node.left, list);</span><br><span class="line">        list.add(node.val);</span><br><span class="line">        inorder(node.right, list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>éé€’å½’æ–¹å¼</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Stack;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TreeTraversal</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;Integer&gt; <span class="title function_">inorderTraversalIterative</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        Stack&lt;TreeNode&gt; stack = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">current</span> <span class="operator">=</span> root;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (current != <span class="literal">null</span> || !stack.isEmpty()) &#123;</span><br><span class="line">            <span class="comment">// å°†æ‰€æœ‰å·¦å­èŠ‚ç‚¹å‹å…¥æ ˆ</span></span><br><span class="line">            <span class="keyword">while</span> (current != <span class="literal">null</span>) &#123;</span><br><span class="line">                stack.push(current);</span><br><span class="line">                current = current.left;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// å¼¹å‡ºæ ˆé¡¶èŠ‚ç‚¹ï¼Œå¹¶å¤„ç†å…¶å³å­æ ‘</span></span><br><span class="line">            current = stack.pop();</span><br><span class="line">            result.add(current.val);</span><br><span class="line">            current = current.right;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="äºŒå‰æ ‘ååºéå†-Postorder-Traversal"><a href="#äºŒå‰æ ‘ååºéå†-Postorder-Traversal" class="headerlink" title="äºŒå‰æ ‘ååºéå† (Postorder Traversal)"></a>äºŒå‰æ ‘ååºéå† (Postorder Traversal)</h4><p><strong>é€’å½’æ–¹å¼</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TreeTraversal</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;Integer&gt; <span class="title function_">postorderTraversalRecursive</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        postorder(root, result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">postorder</span><span class="params">(TreeNode node, List&lt;Integer&gt; list)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        postorder(node.left, list);</span><br><span class="line">        postorder(node.right, list);</span><br><span class="line">        list.add(node.val);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>éé€’å½’æ–¹å¼</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Stack;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TreeTraversal</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;Integer&gt; <span class="title function_">postorderTraversalIterative</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">        Stack&lt;TreeNode&gt; stack = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">        stack.push(root);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (!stack.isEmpty()) &#123;</span><br><span class="line">            <span class="type">TreeNode</span> <span class="variable">node</span> <span class="operator">=</span> stack.pop();</span><br><span class="line">            result.add(node.val); <span class="comment">// å€’åºæ’å…¥</span></span><br><span class="line">            <span class="keyword">if</span> (node.left != <span class="literal">null</span>) &#123;</span><br><span class="line">                stack.push(node.left);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (node.right != <span class="literal">null</span>) &#123;</span><br><span class="line">                stack.push(node.right);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Collections.reverse(result); <span class="comment">// å°†ç»“æœåè½¬</span></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="äºŒå‰æ ‘å±‚åºéå†-Level-Order-Traversal"><a href="#äºŒå‰æ ‘å±‚åºéå†-Level-Order-Traversal" class="headerlink" title="äºŒå‰æ ‘å±‚åºéå† (Level Order Traversal)"></a>äºŒå‰æ ‘å±‚åºéå† (Level Order Traversal)</h4><p>ä½¿ç”¨<strong>é˜Ÿåˆ—</strong>å®ç°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.LinkedList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Queue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TreeTraversal</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">levelOrder</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Queue&lt;TreeNode&gt; queue = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        queue.offer(root);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (!queue.isEmpty()) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">levelSize</span> <span class="operator">=</span> queue.size();</span><br><span class="line">            List&lt;Integer&gt; currentLevel = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; levelSize; i++) &#123;</span><br><span class="line">                <span class="type">TreeNode</span> <span class="variable">node</span> <span class="operator">=</span> queue.poll();</span><br><span class="line">                currentLevel.add(node.val);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (node.left != <span class="literal">null</span>) &#123;</span><br><span class="line">                    queue.offer(node.left);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (node.right != <span class="literal">null</span>) &#123;</span><br><span class="line">                    queue.offer(node.right);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            result.add(currentLevel);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å¯¹ç§°äºŒå‰æ ‘-Symmetric-Tree"><a href="#å¯¹ç§°äºŒå‰æ ‘-Symmetric-Tree" class="headerlink" title="å¯¹ç§°äºŒå‰æ ‘ (Symmetric Tree)"></a>å¯¹ç§°äºŒå‰æ ‘ (Symmetric Tree)</h4><p>ä½¿ç”¨<strong>é€’å½’</strong>ï¼Œæ£€æŸ¥æ ¹èŠ‚ç‚¹çš„å·¦å³å­æ ‘æ˜¯å¦æ˜¯é•œåƒå¯¹ç§°çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TreeProblems</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isSymmetric</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> isMirror(root.left, root.right);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isMirror</span><span class="params">(TreeNode t1, TreeNode t2)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (t1 == <span class="literal">null</span> &amp;&amp; t2 == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (t1 == <span class="literal">null</span> || t2 == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (t1.val == t2.val) &amp;&amp; isMirror(t1.right, t2.left) &amp;&amp; isMirror(t1.left, t2.right);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æœ€å¤§æ·±åº¦-Maximum-Depth-of-Binary-Tree"><a href="#æœ€å¤§æ·±åº¦-Maximum-Depth-of-Binary-Tree" class="headerlink" title="æœ€å¤§æ·±åº¦ (Maximum Depth of Binary Tree)"></a>æœ€å¤§æ·±åº¦ (Maximum Depth of Binary Tree)</h4><p>ä½¿ç”¨<strong>é€’å½’</strong>ï¼ˆæ·±åº¦ä¼˜å…ˆæœç´¢ï¼‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TreeProblems</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">maxDepth</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">leftDepth</span> <span class="operator">=</span> maxDepth(root.left);</span><br><span class="line">        <span class="type">int</span> <span class="variable">rightDepth</span> <span class="operator">=</span> maxDepth(root.right);</span><br><span class="line">        <span class="keyword">return</span> Math.max(leftDepth, rightDepth) + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="éªŒè¯äºŒå‰æœç´¢æ ‘-Validate-Binary-Search-Tree"><a href="#éªŒè¯äºŒå‰æœç´¢æ ‘-Validate-Binary-Search-Tree" class="headerlink" title="éªŒè¯äºŒå‰æœç´¢æ ‘ (Validate Binary Search Tree)"></a>éªŒè¯äºŒå‰æœç´¢æ ‘ (Validate Binary Search Tree)</h4><p>ä½¿ç”¨<strong>é€’å½’</strong>æˆ–<strong>ä¸­åºéå†</strong>ã€‚äºŒå‰æœç´¢æ ‘çš„ä¸­åºéå†ç»“æœæ˜¯å‡åºçš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TreeProblems</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isValidBST</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> isValidBST(root, Long.MIN_VALUE, Long.MAX_VALUE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isValidBST</span><span class="params">(TreeNode node, <span class="type">long</span> min, <span class="type">long</span> max)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ£€æŸ¥å½“å‰èŠ‚ç‚¹çš„å€¼æ˜¯å¦åœ¨æœ‰æ•ˆèŒƒå›´å†…</span></span><br><span class="line">        <span class="keyword">if</span> (node.val &lt;= min || node.val &gt;= max) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// é€’å½’æ£€æŸ¥å·¦å³å­æ ‘ï¼Œå¹¶ç¼©å°æœ‰æ•ˆèŒƒå›´</span></span><br><span class="line">        <span class="keyword">return</span> isValidBST(node.left, min, node.val) &amp;&amp; isValidBST(node.right, node.val, max);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><h4 id="æœ€å¤§å­æ•°ç»„å’Œ-Maximum-Subarray-Sum"><a href="#æœ€å¤§å­æ•°ç»„å’Œ-Maximum-Subarray-Sum" class="headerlink" title="æœ€å¤§å­æ•°ç»„å’Œ (Maximum Subarray Sum)"></a>æœ€å¤§å­æ•°ç»„å’Œ (Maximum Subarray Sum)</h4><p>ä½¿ç”¨<strong>åŠ¨æ€è§„åˆ’</strong> (Kadaneâ€™s algorithm)ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArrayProblems</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">maxSubArray</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (nums == <span class="literal">null</span> || nums.length == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">maxSoFar</span> <span class="operator">=</span> nums[<span class="number">0</span>]; <span class="comment">// è¿„ä»Šä¸ºæ­¢çš„æœ€å¤§å’Œ</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">maxEndingHere</span> <span class="operator">=</span> nums[<span class="number">0</span>]; <span class="comment">// ä»¥å½“å‰ä½ç½®ç»“å°¾çš„æœ€å¤§å’Œ</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">            <span class="comment">// maxEndingHere çš„å€¼æ˜¯ï¼š(å½“å‰å…ƒç´ ) æˆ– (å½“å‰å…ƒç´  + ä¹‹å‰çš„æœ€å¤§å’Œ)</span></span><br><span class="line">            maxEndingHere = Math.max(nums[i], maxEndingHere + nums[i]);</span><br><span class="line">            maxSoFar = Math.max(maxSoFar, maxEndingHere);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> maxSoFar;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä¸¤æ•°ç›¸åŠ -Large-Number-Addition"><a href="#ä¸¤æ•°ç›¸åŠ -Large-Number-Addition" class="headerlink" title="ä¸¤æ•°ç›¸åŠ  (Large Number Addition)"></a>ä¸¤æ•°ç›¸åŠ  (Large Number Addition)</h4><p>å°†ä¸¤ä¸ªè¶…é•¿æ­£æ•´æ•°å­—ç¬¦ä¸²ç›¸åŠ ï¼Œæ¨¡æ‹Ÿå°å­¦åŠ æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringProblems</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">addStrings</span><span class="params">(String num1, String num2)</span> &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> num1.length() - <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> num2.length() - <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">carry</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (i &gt;= <span class="number">0</span> || j &gt;= <span class="number">0</span> || carry &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">digit1</span> <span class="operator">=</span> (i &gt;= <span class="number">0</span>) ? num1.charAt(i--) - <span class="string">&#x27;0&#x27;</span> : <span class="number">0</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">digit2</span> <span class="operator">=</span> (j &gt;= <span class="number">0</span>) ? num2.charAt(j--) - <span class="string">&#x27;0&#x27;</span> : <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">            <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> digit1 + digit2 + carry;</span><br><span class="line">            sb.append(sum % <span class="number">10</span>);</span><br><span class="line">            carry = sum / <span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sb.reverse().toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä½è¿ç®—å®ç°åŠ æ³•-Addition-with-Bitwise-Operators"><a href="#ä½è¿ç®—å®ç°åŠ æ³•-Addition-with-Bitwise-Operators" class="headerlink" title="ä½è¿ç®—å®ç°åŠ æ³• (Addition with Bitwise Operators)"></a>ä½è¿ç®—å®ç°åŠ æ³• (Addition with Bitwise Operators)</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MathProblems</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">        <span class="type">int</span> sum;</span><br><span class="line">        <span class="type">int</span> carry;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (b != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// è®¡ç®—æ— è¿›ä½çš„å’Œï¼ˆå¼‚æˆ–ï¼‰</span></span><br><span class="line">            sum = a ^ b;</span><br><span class="line">            <span class="comment">// è®¡ç®—è¿›ä½ï¼ˆä¸&amp;å·¦ç§»ï¼‰</span></span><br><span class="line">            carry = (a &amp; b) &lt;&lt; <span class="number">1</span>;</span><br><span class="line">            a = sum;</span><br><span class="line">            b = carry;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å…¨æ’åˆ—-Permutations"><a href="#å…¨æ’åˆ—-Permutations" class="headerlink" title="å…¨æ’åˆ— (Permutations)"></a>å…¨æ’åˆ— (Permutations)</h4><p>ä½¿ç”¨<strong>å›æº¯ç®—æ³•</strong>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BacktrackingProblems</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">permute</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        backtrackPermute(result, <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(), nums, <span class="keyword">new</span> <span class="title class_">boolean</span>[nums.length]);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">backtrackPermute</span><span class="params">(List&lt;List&lt;Integer&gt;&gt; result, List&lt;Integer&gt; tempList, <span class="type">int</span>[] nums, <span class="type">boolean</span>[] used)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (tempList.size() == nums.length) &#123;</span><br><span class="line">            result.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(tempList));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (used[i]) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            used[i] = <span class="literal">true</span>;</span><br><span class="line">            tempList.add(nums[i]);</span><br><span class="line">            backtrackPermute(result, tempList, nums, used);</span><br><span class="line">            tempList.remove(tempList.size() - <span class="number">1</span>);</span><br><span class="line">            used[i] = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å­é›†-Subsets"><a href="#å­é›†-Subsets" class="headerlink" title="å­é›† (Subsets)"></a>å­é›† (Subsets)</h4><p>ä½¿ç”¨<strong>å›æº¯ç®—æ³•</strong>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BacktrackingProblems</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">subsets</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        backtrackSubsets(result, <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(), nums, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">backtrackSubsets</span><span class="params">(List&lt;List&lt;Integer&gt;&gt; result, List&lt;Integer&gt; tempList, <span class="type">int</span>[] nums, <span class="type">int</span> start)</span> &#123;</span><br><span class="line">        result.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(tempList));</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> start; i &lt; nums.length; i++) &#123;</span><br><span class="line">            tempList.add(nums[i]);</span><br><span class="line">            backtrackSubsets(result, tempList, nums, i + <span class="number">1</span>);</span><br><span class="line">            tempList.remove(tempList.size() - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è·³å°é˜¶-Climbing-Stairs"><a href="#è·³å°é˜¶-Climbing-Stairs" class="headerlink" title="è·³å°é˜¶ (Climbing Stairs)"></a>è·³å°é˜¶ (Climbing Stairs)</h4><p>è¿™æ˜¯ç»å…¸çš„<strong>åŠ¨æ€è§„åˆ’</strong>é—®é¢˜ï¼Œä¸æ–æ³¢é‚£å¥‘æ•°åˆ—ç±»ä¼¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MathProblems</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">climbStairs</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (n &lt;= <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> n;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span>[] dp = <span class="keyword">new</span> <span class="title class_">int</span>[n + <span class="number">1</span>];</span><br><span class="line">        dp[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">        dp[<span class="number">2</span>] = <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">3</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            dp[i] = dp[i - <span class="number">1</span>] + dp[i - <span class="number">2</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[n];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å®ç°ä¸€ä¸ªç®€å•çš„-Trie-å‰ç¼€æ ‘"><a href="#å®ç°ä¸€ä¸ªç®€å•çš„-Trie-å‰ç¼€æ ‘" class="headerlink" title="å®ç°ä¸€ä¸ªç®€å•çš„ Trie (å‰ç¼€æ ‘)"></a>å®ç°ä¸€ä¸ªç®€å•çš„ Trie (å‰ç¼€æ ‘)</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TrieNode</span> &#123;</span><br><span class="line">    Map&lt;Character, TrieNode&gt; children;</span><br><span class="line">    <span class="type">boolean</span> isEndOfWord;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TrieNode</span><span class="params">()</span> &#123;</span><br><span class="line">        children = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        isEndOfWord = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Trie</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> TrieNode root;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Trie</span><span class="params">()</span> &#123;</span><br><span class="line">        root = <span class="keyword">new</span> <span class="title class_">TrieNode</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(String word)</span> &#123;</span><br><span class="line">        <span class="type">TrieNode</span> <span class="variable">current</span> <span class="operator">=</span> root;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">char</span> c : word.toCharArray()) &#123;</span><br><span class="line">            current = current.children.computeIfAbsent(c, k -&gt; <span class="keyword">new</span> <span class="title class_">TrieNode</span>());</span><br><span class="line">        &#125;</span><br><span class="line">        current.isEndOfWord = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">search</span><span class="params">(String word)</span> &#123;</span><br><span class="line">        <span class="type">TrieNode</span> <span class="variable">current</span> <span class="operator">=</span> root;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">char</span> c : word.toCharArray()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!current.children.containsKey(c)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            current = current.children.get(c);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> current.isEndOfWord;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">startsWith</span><span class="params">(String prefix)</span> &#123;</span><br><span class="line">        <span class="type">TrieNode</span> <span class="variable">current</span> <span class="operator">=</span> root;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">char</span> c : prefix.toCharArray()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!current.children.containsKey(c)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            current = current.children.get(c);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åè½¬é“¾è¡¨-II-Reverse-Linked-List-II"><a href="#åè½¬é“¾è¡¨-II-Reverse-Linked-List-II" class="headerlink" title="åè½¬é“¾è¡¨ II (Reverse Linked List II)"></a>åè½¬é“¾è¡¨ II (Reverse Linked List II)</h4><p>åè½¬é“¾è¡¨ä»ä½ç½® <code>m</code> åˆ° <code>n</code> çš„éƒ¨åˆ†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LinkedListProblems</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ListNode <span class="title function_">reverseBetween</span><span class="params">(ListNode head, <span class="type">int</span> m, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">dummy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">0</span>);</span><br><span class="line">        dummy.next = head;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">pre</span> <span class="operator">=</span> dummy;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; m - <span class="number">1</span>; i++) &#123;</span><br><span class="line">            pre = pre.next; <span class="comment">// ç§»åŠ¨åˆ°åè½¬éƒ¨åˆ†çš„å‰ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">start</span> <span class="operator">=</span> pre.next; <span class="comment">// åè½¬éƒ¨åˆ†çš„èµ·å§‹èŠ‚ç‚¹</span></span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">then</span> <span class="operator">=</span> start.next; <span class="comment">// å¾…åè½¬çš„ç¬¬äºŒä¸ªèŠ‚ç‚¹</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n - m; i++) &#123;</span><br><span class="line">            start.next = then.next;</span><br><span class="line">            then.next = pre.next;</span><br><span class="line">            pre.next = then;</span><br><span class="line">            then = start.next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dummy.next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="LRU-ç¼“å­˜-LRU-Cache"><a href="#LRU-ç¼“å­˜-LRU-Cache" class="headerlink" title="LRU ç¼“å­˜ (LRU Cache)"></a>LRU ç¼“å­˜ (LRU Cache)</h4><p>ä½¿ç”¨ <code>LinkedHashMap</code> å¯ä»¥éå¸¸æ–¹ä¾¿åœ°å®ç° LRU ç¼“å­˜ï¼Œå› ä¸ºå®ƒæœ¬èº«å°±ç»´æŠ¤äº†æ’å…¥é¡ºåºæˆ–è®¿é—®é¡ºåºã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.LinkedHashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LRUCache</span>&lt;K, V&gt; <span class="keyword">extends</span> <span class="title class_">LinkedHashMap</span>&lt;K, V&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> capacity;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LRUCache</span><span class="params">(<span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(capacity, <span class="number">0.75f</span>, <span class="literal">true</span>); <span class="comment">// true è¡¨ç¤ºæŒ‰è®¿é—®é¡ºåºæ’åº</span></span><br><span class="line">        <span class="built_in">this</span>.capacity = capacity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">removeEldestEntry</span><span class="params">(Map.Entry&lt;K, V&gt; eldest)</span> &#123;</span><br><span class="line">        <span class="comment">// å½“å®¹é‡è¶…è¿‡é™åˆ¶æ—¶ï¼Œè‡ªåŠ¨ç§»é™¤æœ€è€çš„ï¼ˆæœ€ä¹…æœªè®¿é—®çš„ï¼‰æ¡ç›®</span></span><br><span class="line">        <span class="keyword">return</span> size() &gt; capacity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> V <span class="title function_">get</span><span class="params">(K key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.getOrDefault(key, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(K key, V value)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.put(key, value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åˆ¤æ–­å›æ–‡é“¾è¡¨-Palindrome-Linked-List"><a href="#åˆ¤æ–­å›æ–‡é“¾è¡¨-Palindrome-Linked-List" class="headerlink" title="åˆ¤æ–­å›æ–‡é“¾è¡¨ (Palindrome Linked List)"></a>åˆ¤æ–­å›æ–‡é“¾è¡¨ (Palindrome Linked List)</h4><p>å¯ä»¥ä½¿ç”¨å¿«æ…¢æŒ‡é’ˆæ‰¾åˆ°ä¸­ç‚¹ï¼Œç„¶ååè½¬ååŠéƒ¨åˆ†ï¼Œæœ€åæ¯”è¾ƒä¸¤éƒ¨åˆ†æ˜¯å¦ç›¸ç­‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LinkedListProblems</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isPalindrome</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (head == <span class="literal">null</span> || head.next == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1. å¿«æ…¢æŒ‡é’ˆæ‰¾ä¸­ç‚¹</span></span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">slow</span> <span class="operator">=</span> head;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">fast</span> <span class="operator">=</span> head;</span><br><span class="line">        <span class="keyword">while</span> (fast != <span class="literal">null</span> &amp;&amp; fast.next != <span class="literal">null</span>) &#123;</span><br><span class="line">            slow = slow.next;</span><br><span class="line">            fast = fast.next.next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. åè½¬ååŠéƒ¨åˆ†</span></span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">secondHalf</span> <span class="operator">=</span> reverseList(slow);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. æ¯”è¾ƒå‰åŠéƒ¨åˆ†å’Œåè½¬åçš„ååŠéƒ¨åˆ†</span></span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">firstHalf</span> <span class="operator">=</span> head;</span><br><span class="line">        <span class="keyword">while</span> (secondHalf != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (firstHalf.val != secondHalf.val) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            firstHalf = firstHalf.next;</span><br><span class="line">            secondHalf = secondHalf.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ListNode <span class="title function_">reverseList</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">prev</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">current</span> <span class="operator">=</span> head;</span><br><span class="line">        <span class="keyword">while</span> (current != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">ListNode</span> <span class="variable">nextTemp</span> <span class="operator">=</span> current.next;</span><br><span class="line">            current.next = prev;</span><br><span class="line">            prev = current;</span><br><span class="line">            current = nextTemp;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> prev;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="ReadWriteLock-1"><a href="#ReadWriteLock-1" class="headerlink" title="ReadWriteLock"></a><code>ReadWriteLock</code></h3><p><code>ReadWriteLock</code> å…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è¿›è¡Œè¯»æ“ä½œï¼Œä½†åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œå†™æ“ä½œï¼Œä»è€Œæé«˜è¯»å¤šå†™å°‘çš„åœºæ™¯ä¸‹çš„å¹¶å‘æ€§èƒ½ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReadWriteLock;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantReadWriteLock;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SharedResource</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">ReadWriteLock</span> <span class="variable">rwLock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantReadWriteLock</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> <span class="string">&quot;åˆå§‹æ•°æ®&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¯»æ“ä½œï¼šå…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">readData</span><span class="params">()</span> &#123;</span><br><span class="line">        rwLock.readLock().lock(); <span class="comment">// è·å–è¯»é”</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; æ­£åœ¨è¯»å–æ•°æ®...&quot;</span>);</span><br><span class="line">            Thread.sleep(<span class="number">100</span>); <span class="comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span></span><br><span class="line">            <span class="keyword">return</span> data;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            Thread.currentThread().interrupt();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            rwLock.readLock().unlock(); <span class="comment">// é‡Šæ”¾è¯»é”</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å†™æ“ä½œï¼šåŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">writeData</span><span class="params">(String newData)</span> &#123;</span><br><span class="line">        rwLock.writeLock().lock(); <span class="comment">// è·å–å†™é”</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; æ­£åœ¨å†™å…¥æ•°æ®...&quot;</span>);</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>); <span class="comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span></span><br><span class="line">            <span class="built_in">this</span>.data = newData;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; å†™å…¥å®Œæˆã€‚&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            Thread.currentThread().interrupt();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            rwLock.writeLock().unlock(); <span class="comment">// é‡Šæ”¾å†™é”</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="CountDownLatch-1"><a href="#CountDownLatch-1" class="headerlink" title="CountDownLatch"></a><code>CountDownLatch</code></h3><p><code>CountDownLatch</code> å…è®¸ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…ï¼Œç›´åˆ°å…¶ä»–çº¿ç¨‹éƒ½å®Œæˆäº†æŸé¡¹å·¥ä½œã€‚å®ƒå°±åƒä¸€ä¸ªå€’è®¡æ—¶å™¨ï¼Œä¸€æ—¦è®¡æ•°ä¸ºé›¶ï¼Œç­‰å¾…çš„çº¿ç¨‹å°±ä¼šè¢«å”¤é†’ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.CountDownLatch;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CountDownLatchDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">int</span> <span class="variable">workerCount</span> <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªè®¡æ•°å™¨ï¼Œåˆå§‹å€¼ä¸º 5</span></span><br><span class="line">        <span class="type">CountDownLatch</span> <span class="variable">latch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(workerCount);</span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">executor</span> <span class="operator">=</span> Executors.newFixedThreadPool(workerCount);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸»çº¿ç¨‹ï¼šå¯åŠ¨ &quot;</span> + workerCount + <span class="string">&quot; ä¸ªå·¥ä½œçº¿ç¨‹...&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; workerCount; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">int</span> <span class="variable">workerId</span> <span class="operator">=</span> i;</span><br><span class="line">            executor.execute(() -&gt; &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;å·¥ä½œçº¿ç¨‹ &quot;</span> + workerId + <span class="string">&quot; å¼€å§‹æ‰§è¡Œä»»åŠ¡...&quot;</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep((<span class="type">long</span>) (Math.random() * <span class="number">2000</span>)); <span class="comment">// æ¨¡æ‹Ÿä»»åŠ¡æ‰§è¡Œ</span></span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    Thread.currentThread().interrupt();</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;å·¥ä½œçº¿ç¨‹ &quot;</span> + workerId + <span class="string">&quot; ä»»åŠ¡å®Œæˆã€‚&quot;</span>);</span><br><span class="line">                    latch.countDown(); <span class="comment">// ä»»åŠ¡å®Œæˆåï¼Œè®¡æ•°å™¨å‡ 1</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸»çº¿ç¨‹ï¼šç­‰å¾…æ‰€æœ‰å·¥ä½œçº¿ç¨‹å®Œæˆ...&quot;</span>);</span><br><span class="line">        latch.await(); <span class="comment">// é˜»å¡ä¸»çº¿ç¨‹ï¼Œç›´åˆ°è®¡æ•°å™¨ä¸º 0</span></span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸»çº¿ç¨‹ï¼šæ‰€æœ‰å·¥ä½œçº¿ç¨‹å·²å®Œæˆï¼Œç»§ç»­æ‰§è¡Œä¸‹ä¸€æ­¥ã€‚&quot;</span>);</span><br><span class="line"></span><br><span class="line">        executor.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="CyclicBarrier-1"><a href="#CyclicBarrier-1" class="headerlink" title="CyclicBarrier"></a><code>CyclicBarrier</code></h3><p><code>CyclicBarrier</code> å…è®¸ä¸€ç»„çº¿ç¨‹åœ¨åˆ°è¾¾ä¸€ä¸ªå…±åŒçš„å±éšœç‚¹åï¼Œå†ä¸€èµ·ç»§ç»­æ‰§è¡Œã€‚å®ƒå°±åƒèµ›è·‘çš„èµ·è·‘çº¿ï¼Œæ‰€æœ‰é€‰æ‰‹éƒ½å‡†å¤‡å¥½åï¼Œå‘ä»¤æªæ‰å“ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.BrokenBarrierException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CyclicBarrier;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CyclicBarrierDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">int</span> <span class="variable">runnerCount</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªå±éšœï¼Œå½“ 3 ä¸ªçº¿ç¨‹éƒ½åˆ°è¾¾æ—¶ï¼Œæ‰§è¡Œä¸€ä¸ªå±éšœåŠ¨ä½œ</span></span><br><span class="line">        <span class="type">CyclicBarrier</span> <span class="variable">barrier</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CyclicBarrier</span>(runnerCount, () -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;\næ‰€æœ‰èµ›è·‘è€…éƒ½å·²å°±ä½ï¼Œå‘ä»¤æªå“ï¼\n&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">executor</span> <span class="operator">=</span> Executors.newFixedThreadPool(runnerCount);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; runnerCount; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">int</span> <span class="variable">runnerId</span> <span class="operator">=</span> i;</span><br><span class="line">            executor.execute(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;èµ›è·‘è€… &quot;</span> + runnerId + <span class="string">&quot; æ­£åœ¨èµ°å‘èµ·è·‘çº¿...&quot;</span>);</span><br><span class="line">                    Thread.sleep((<span class="type">long</span>) (Math.random() * <span class="number">3000</span>)); <span class="comment">// æ¨¡æ‹Ÿå‡†å¤‡æ—¶é—´</span></span><br><span class="line">                    System.out.println(<span class="string">&quot;èµ›è·‘è€… &quot;</span> + runnerId + <span class="string">&quot; åˆ°è¾¾èµ·è·‘çº¿ï¼Œå‡†å¤‡å°±ç»ªã€‚&quot;</span>);</span><br><span class="line">                    barrier.await(); <span class="comment">// çº¿ç¨‹åœ¨æ­¤å¤„ç­‰å¾…ï¼Œç›´åˆ°æ‰€æœ‰çº¿ç¨‹éƒ½åˆ°è¾¾</span></span><br><span class="line"></span><br><span class="line">                    System.out.println(<span class="string">&quot;èµ›è·‘è€… &quot;</span> + runnerId + <span class="string">&quot; å¼€å§‹è·‘æ­¥ï¼&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException | BrokenBarrierException e) &#123;</span><br><span class="line">                    Thread.currentThread().interrupt();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        executor.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="Semaphore-1"><a href="#Semaphore-1" class="headerlink" title="Semaphore"></a><code>Semaphore</code></h3><p><code>Semaphore</code>ï¼ˆä¿¡å·é‡ï¼‰ç”¨æ¥æ§åˆ¶å¯¹æŸä¸ªèµ„æºçš„å¹¶å‘è®¿é—®æ•°é‡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.Semaphore;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SemaphoreDemo</span> &#123;</span><br><span class="line">    <span class="comment">// åœè½¦åœºæœ€å¤šå…è®¸ 3 è¾†è½¦åœæ”¾</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Semaphore</span> <span class="variable">semaphore</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Semaphore</span>(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">park</span><span class="params">(<span class="type">int</span> carId)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ±½è½¦ &quot;</span> + carId + <span class="string">&quot; æ­£åœ¨å¯»æ‰¾è½¦ä½...&quot;</span>);</span><br><span class="line">            semaphore.acquire(); <span class="comment">// è·å–ä¸€ä¸ªè®¸å¯</span></span><br><span class="line">            System.out.println(<span class="string">&quot;æ±½è½¦ &quot;</span> + carId + <span class="string">&quot; æˆåŠŸè¿›å…¥åœè½¦åœºã€‚&quot;</span>);</span><br><span class="line">            Thread.sleep((<span class="type">long</span>) (Math.random() * <span class="number">3000</span>)); <span class="comment">// æ¨¡æ‹Ÿåœè½¦æ—¶é—´</span></span><br><span class="line">            System.out.println(<span class="string">&quot;æ±½è½¦ &quot;</span> + carId + <span class="string">&quot; ç¦»å¼€åœè½¦åœºã€‚&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            Thread.currentThread().interrupt();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            semaphore.release(); <span class="comment">// é‡Šæ”¾è®¸å¯</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">SemaphoreDemo</span> <span class="variable">demo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SemaphoreDemo</span>();</span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">executor</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">10</span>); <span class="comment">// 10 è¾†è½¦</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">int</span> <span class="variable">carId</span> <span class="operator">=</span> i;</span><br><span class="line">            executor.execute(() -&gt; demo.park(carId));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        executor.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="æ­»é”é¢„é˜²-æŒ‰é”é¡ºåº"><a href="#æ­»é”é¢„é˜²-æŒ‰é”é¡ºåº" class="headerlink" title="æ­»é”é¢„é˜² (æŒ‰é”é¡ºåº)"></a>æ­»é”é¢„é˜² (æŒ‰é”é¡ºåº)</h3><p>é€šè¿‡<strong>èµ„æºæœ‰åºåˆ†é…</strong>æ¥æ‰“ç ´æ­»é”çš„<strong>å¾ªç¯ç­‰å¾…</strong>æ¡ä»¶ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DeadlockPrevention</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">lockA</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">lockB</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">threadOne</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (lockA) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;çº¿ç¨‹ 1: å·²è·å¾— lockAï¼Œå°è¯•è·å– lockB...&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">100</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                Thread.currentThread().interrupt();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">synchronized</span> (lockB) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;çº¿ç¨‹ 1: å·²è·å¾— lockBã€‚&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">threadTwo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// ä¸¤ä¸ªçº¿ç¨‹éƒ½æŒ‰ç›¸åŒçš„é¡ºåºï¼ˆå…ˆ A å Bï¼‰è·å–é”</span></span><br><span class="line">        <span class="keyword">synchronized</span> (lockA) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;çº¿ç¨‹ 2: å·²è·å¾— lockAï¼Œå°è¯•è·å– lockB...&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">100</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                Thread.currentThread().interrupt();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">synchronized</span> (lockB) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;çº¿ç¨‹ 2: å·²è·å¾— lockBã€‚&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">DeadlockPrevention</span> <span class="variable">demo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeadlockPrevention</span>();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(demo::threadOne, <span class="string">&quot;Thread-1&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(demo::threadTwo, <span class="string">&quot;Thread-2&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="çº¿ç¨‹æ± å¼‚å¸¸"><a href="#çº¿ç¨‹æ± å¼‚å¸¸" class="headerlink" title="çº¿ç¨‹æ± å¼‚å¸¸"></a>çº¿ç¨‹æ± å¼‚å¸¸</h3><p>ä½¿ç”¨ <code>Future.get()</code> æˆ–åœ¨ä»»åŠ¡ä¸­æ•è·å¼‚å¸¸æ¥å¤„ç†çº¿ç¨‹æ± ä¸­ä»»åŠ¡æŠ›å‡ºçš„å¼‚å¸¸ã€‚<code>execute()</code> æ–¹æ³•æ— æ³•ç›´æ¥æ•è·å¼‚å¸¸ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ThreadPoolExceptionDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">executor</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æäº¤ä¸€ä¸ªä¼šæŠ›å‡ºè¿è¡Œæ—¶å¼‚å¸¸çš„ä»»åŠ¡</span></span><br><span class="line">        Future&lt;?&gt; future = executor.submit(() -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ä»»åŠ¡å¼€å§‹æ‰§è¡Œ...&quot;</span>);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;è¿™æ˜¯ä¸€ä¸ªæ¨¡æ‹Ÿçš„ä»»åŠ¡æ‰§è¡Œå¼‚å¸¸ã€‚&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°è¯•è·å–ä»»åŠ¡ç»“æœæ¥æ•è·å¼‚å¸¸</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            future.get();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ExecutionException e) &#123;</span><br><span class="line">            System.err.println(<span class="string">&quot;æ•è·åˆ°ä»»åŠ¡æ‰§è¡Œå¼‚å¸¸ï¼š&quot;</span> + e.getCause().getMessage());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä½¿ç”¨ execute() æäº¤ä»»åŠ¡ï¼Œå¼‚å¸¸ä¼šè¢«åæ‰ï¼Œé™¤éè‡ªå®šä¹‰ UncaughtExceptionHandler</span></span><br><span class="line">        executor.execute(() -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;å¦ä¸€ä¸ªä»»åŠ¡å¼€å§‹æ‰§è¡Œ...&quot;</span>);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;è¿™ä¸ªå¼‚å¸¸ä¼šè¢«åæ‰ã€‚&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        executor.shutdown();</span><br><span class="line">        executor.awaitTermination(<span class="number">1</span>, TimeUnit.SECONDS);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="ThreadLocal-1"><a href="#ThreadLocal-1" class="headerlink" title="ThreadLocal"></a><code>ThreadLocal</code></h3><p><code>ThreadLocal</code> ä¸ºæ¯ä¸ªçº¿ç¨‹æä¾›äº†ç‹¬ç«‹çš„å˜é‡å‰¯æœ¬ï¼Œå®ç°äº†æ•°æ®éš”ç¦»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ThreadLocalDemo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;String&gt; threadLocal = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAndPrint</span><span class="params">(String value)</span> &#123;</span><br><span class="line">        threadLocal.set(value); <span class="comment">// è®¾ç½®å½“å‰çº¿ç¨‹çš„å˜é‡å‰¯æœ¬</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>); <span class="comment">// æ¨¡æ‹Ÿä»»åŠ¡</span></span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; çš„å˜é‡å€¼: &quot;</span> + threadLocal.get());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            Thread.currentThread().interrupt();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            threadLocal.remove(); <span class="comment">// æœ€ä½³å®è·µï¼šä½¿ç”¨å®Œåç§»é™¤ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ThreadLocalDemo</span> <span class="variable">demo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadLocalDemo</span>();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; demo.setAndPrint(<span class="string">&quot;çº¿ç¨‹ A çš„æ•°æ®&quot;</span>), <span class="string">&quot;Thread-A&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; demo.setAndPrint(<span class="string">&quot;çº¿ç¨‹ B çš„æ•°æ®&quot;</span>), <span class="string">&quot;Thread-B&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="LockSupport"><a href="#LockSupport" class="headerlink" title="LockSupport"></a><code>LockSupport</code></h3><p><code>LockSupport.park()</code> å’Œ <code>LockSupport.unpark()</code> æä¾›äº†æ›´çµæ´»çš„çº¿ç¨‹é˜»å¡å’Œå”¤é†’æœºåˆ¶ï¼Œç±»ä¼¼äº <code>wait()</code> å’Œ <code>notify()</code>ï¼Œä½†ä¸éœ€è¦ä¾èµ–é”ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.LockSupport;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LockSupportDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">workerThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;å·¥ä½œçº¿ç¨‹: ä»»åŠ¡å‡†å¤‡å°±ç»ªï¼Œå³å°†é˜»å¡...&quot;</span>);</span><br><span class="line">            LockSupport.park(); <span class="comment">// é˜»å¡å½“å‰çº¿ç¨‹</span></span><br><span class="line">            System.out.println(<span class="string">&quot;å·¥ä½œçº¿ç¨‹: è¢«å”¤é†’ï¼Œç»§ç»­æ‰§è¡Œã€‚&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        workerThread.start();</span><br><span class="line">        Thread.sleep(<span class="number">2000</span>); <span class="comment">// ç¡®ä¿å·¥ä½œçº¿ç¨‹å·²æ‰§è¡Œ park()</span></span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸»çº¿ç¨‹: å”¤é†’å·¥ä½œçº¿ç¨‹ã€‚&quot;</span>);</span><br><span class="line">        LockSupport.unpark(workerThread); <span class="comment">// å”¤é†’æŒ‡å®šçº¿ç¨‹</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="çº¿ç¨‹é€šä¿¡-æŒ‰é¡ºåºæ‰“å°"><a href="#çº¿ç¨‹é€šä¿¡-æŒ‰é¡ºåºæ‰“å°" class="headerlink" title="çº¿ç¨‹é€šä¿¡ (æŒ‰é¡ºåºæ‰“å°)"></a>çº¿ç¨‹é€šä¿¡ (æŒ‰é¡ºåºæ‰“å°)</h3><p>ä½¿ç”¨ <code>wait()</code> å’Œ <code>notifyAll()</code> å®ç°ä¸‰ä¸ªçº¿ç¨‹æŒ‰é¡ºåºæ‰“å°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SequentialPrinter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">state</span> <span class="operator">=</span> <span class="number">0</span>; <span class="comment">// 0: A, 1: B, 2: C</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printA</span><span class="params">()</span> &#123;</span><br><span class="line">        printLetter(<span class="string">&quot;A&quot;</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printB</span><span class="params">()</span> &#123;</span><br><span class="line">        printLetter(<span class="string">&quot;B&quot;</span>, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printC</span><span class="params">()</span> &#123;</span><br><span class="line">        printLetter(<span class="string">&quot;C&quot;</span>, <span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">printLetter</span><span class="params">(String letter, <span class="type">int</span> expectedState)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">                <span class="keyword">while</span> (state != expectedState) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        lock.wait();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        Thread.currentThread().interrupt();</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.print(letter);</span><br><span class="line">                state = (state + <span class="number">1</span>) % <span class="number">3</span>; <span class="comment">// åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªçŠ¶æ€</span></span><br><span class="line">                lock.notifyAll();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">SequentialPrinter</span> <span class="variable">printer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SequentialPrinter</span>();</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">threadA</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(printer::printA);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">threadB</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(printer::printB);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">threadC</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(printer::printC);</span><br><span class="line"></span><br><span class="line">        threadA.start();</span><br><span class="line">        threadB.start();</span><br><span class="line">        threadC.start();</span><br><span class="line"></span><br><span class="line">        threadA.join();</span><br><span class="line">        threadB.join();</span><br><span class="line">        threadC.join();</span><br><span class="line">        System.out.println(<span class="string">&quot;\næ‰“å°å®Œæˆã€‚&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="çº¿ç¨‹æ± "><a href="#çº¿ç¨‹æ± " class="headerlink" title="çº¿ç¨‹æ± "></a>çº¿ç¨‹æ± </h3><h4 id="ThreadPoolExecutor-çš„ä¸ƒä¸ªå‚æ•°"><a href="#ThreadPoolExecutor-çš„ä¸ƒä¸ªå‚æ•°" class="headerlink" title="ThreadPoolExecutor çš„ä¸ƒä¸ªå‚æ•°"></a><code>ThreadPoolExecutor</code> çš„ä¸ƒä¸ªå‚æ•°</h4><ol><li><code>corePoolSize</code>: æ ¸å¿ƒçº¿ç¨‹æ•°ã€‚çº¿ç¨‹æ± ä¸­å¸¸é©»çš„çº¿ç¨‹æ•°é‡ï¼Œå³ä½¿ç©ºé—²ä¹Ÿä¸ä¼šè¢«é”€æ¯ã€‚</li><li><code>maximumPoolSize</code>: æœ€å¤§çº¿ç¨‹æ•°ã€‚å½“å·¥ä½œé˜Ÿåˆ—å·²æ»¡ï¼Œä¸”ä»»åŠ¡é‡ç»§ç»­å¢åŠ æ—¶ï¼Œçº¿ç¨‹æ± å¯ä»¥åˆ›å»ºçš„æœ€å¤§çº¿ç¨‹æ•°ã€‚</li><li><code>keepAliveTime</code>: ç©ºé—²çº¿ç¨‹å­˜æ´»æ—¶é—´ã€‚å½“çº¿ç¨‹æ•°å¤§äº <code>corePoolSize</code> æ—¶ï¼Œéæ ¸å¿ƒçº¿ç¨‹çš„ç©ºé—²å­˜æ´»æ—¶é—´ã€‚</li><li><code>unit</code>: <code>keepAliveTime</code> çš„æ—¶é—´å•ä½ã€‚</li><li><code>workQueue</code>: å·¥ä½œé˜Ÿåˆ—ã€‚ç”¨äºå­˜æ”¾ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¸¸ç”¨çš„æœ‰ <code>ArrayBlockingQueue</code>ã€<code>LinkedBlockingQueue</code> ç­‰ã€‚</li><li><code>threadFactory</code>: çº¿ç¨‹å·¥å‚ã€‚ç”¨äºåˆ›å»ºæ–°çº¿ç¨‹ï¼Œå¯ä»¥è‡ªå®šä¹‰çº¿ç¨‹çš„åç§°ã€ä¼˜å…ˆçº§ç­‰ã€‚</li><li><code>handler</code>: æ‹’ç»ç­–ç•¥ã€‚å½“çº¿ç¨‹æ± å’Œå·¥ä½œé˜Ÿåˆ—éƒ½å·²æ»¡æ—¶ï¼Œç”¨äºå¤„ç†æ–°æ¥çš„ä»»åŠ¡ï¼Œä¾‹å¦‚æŠ›å‡ºå¼‚å¸¸ã€ç”±è°ƒç”¨è€…æ‰§è¡Œç­‰ã€‚</li></ol><h4 id="æ‰‹å†™ä¸€ä¸ªè‡ªå®šä¹‰çº¿ç¨‹æ± "><a href="#æ‰‹å†™ä¸€ä¸ªè‡ªå®šä¹‰çº¿ç¨‹æ± " class="headerlink" title="æ‰‹å†™ä¸€ä¸ªè‡ªå®šä¹‰çº¿ç¨‹æ± "></a>æ‰‹å†™ä¸€ä¸ªè‡ªå®šä¹‰çº¿ç¨‹æ± </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomThreadPool</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// è‡ªå®šä¹‰çº¿ç¨‹æ± </span></span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">executor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(</span><br><span class="line">                <span class="number">2</span>, <span class="comment">// æ ¸å¿ƒçº¿ç¨‹æ•°</span></span><br><span class="line">                <span class="number">5</span>, <span class="comment">// æœ€å¤§çº¿ç¨‹æ•°</span></span><br><span class="line">                <span class="number">60L</span>, <span class="comment">// ç©ºé—²çº¿ç¨‹å­˜æ´»æ—¶é—´</span></span><br><span class="line">                TimeUnit.SECONDS,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;&gt;(<span class="number">10</span>), <span class="comment">// å·¥ä½œé˜Ÿåˆ—å®¹é‡ä¸º 10</span></span><br><span class="line">                Executors.defaultThreadFactory(), <span class="comment">// é»˜è®¤çº¿ç¨‹å·¥å‚</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>.CallerRunsPolicy() <span class="comment">// æ‹’ç»ç­–ç•¥ï¼šç”±è°ƒç”¨è€…çº¿ç¨‹æ‰§è¡Œ</span></span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">int</span> <span class="variable">taskId</span> <span class="operator">=</span> i;</span><br><span class="line">            executor.execute(() -&gt; &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;ä»»åŠ¡ &quot;</span> + taskId + <span class="string">&quot; æ­£åœ¨ç”±çº¿ç¨‹ &quot;</span> + Thread.currentThread().getName() + <span class="string">&quot; æ‰§è¡Œã€‚&quot;</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">100</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    Thread.currentThread().interrupt();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        executor.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="åŸå­ç±»"><a href="#åŸå­ç±»" class="headerlink" title="åŸå­ç±»"></a>åŸå­ç±»</h3><p>ä½¿ç”¨ <code>AtomicBoolean</code> æˆ– <code>AtomicReference</code> è§£å†³å¹¶å‘é—®é¢˜ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicBoolean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AtomicBooleanDemo</span> &#123;</span><br><span class="line">    <span class="comment">// ç¡®ä¿åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œåˆå§‹åŒ–æ“ä½œ</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">AtomicBoolean</span> <span class="variable">initialized</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicBoolean</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// åªæœ‰å½“ initialized ä¸º false æ—¶ï¼Œæ‰å°†å…¶è®¾ç½®ä¸º true å¹¶æ‰§è¡Œåˆå§‹åŒ–</span></span><br><span class="line">        <span class="keyword">if</span> (initialized.compareAndSet(<span class="literal">false</span>, <span class="literal">true</span>)) &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;: å¼€å§‹æ‰§è¡Œåˆå§‹åŒ–æ“ä½œ...&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                Thread.currentThread().interrupt();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;: åˆå§‹åŒ–å®Œæˆã€‚&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;: åˆå§‹åŒ–å·²è¢«å…¶ä»–çº¿ç¨‹æ‰§è¡Œï¼Œè·³è¿‡ã€‚&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(AtomicBooleanDemo::initialize, <span class="string">&quot;Thread-&quot;</span> + i).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="volatile-å†…å­˜è¯­ä¹‰"><a href="#volatile-å†…å­˜è¯­ä¹‰" class="headerlink" title="volatile å†…å­˜è¯­ä¹‰"></a><code>volatile</code> å†…å­˜è¯­ä¹‰</h3><p><code>volatile</code> ç¡®ä¿äº†<strong>å¯è§æ€§</strong>å’Œ<strong>æœ‰åºæ€§</strong>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">VolatileMemorySemantics</span> &#123;</span><br><span class="line">    <span class="comment">// 1. å¯è§æ€§ï¼šå½“ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº† ready çš„å€¼ï¼Œå…¶ä»–çº¿ç¨‹èƒ½ç«‹å³çœ‹åˆ°æœ€æ–°å€¼</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="type">boolean</span> <span class="variable">ready</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">number</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">WriterThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            number = <span class="number">42</span>; <span class="comment">// ä¿®æ”¹ number</span></span><br><span class="line">            ready = <span class="literal">true</span>; <span class="comment">// ä¿®æ”¹ ready</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ReaderThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (!ready) &#123;</span><br><span class="line">                <span class="comment">// ç­‰å¾… ready å˜ä¸º true</span></span><br><span class="line">                <span class="comment">// å¦‚æœæ²¡æœ‰ volatileï¼Œè¿™é‡Œå¯èƒ½ä¼šé™·å…¥æ­»å¾ªç¯</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 2. æœ‰åºæ€§ï¼šå†™ volatile å˜é‡ï¼ˆready = trueï¼‰ä¹‹å‰çš„æ“ä½œï¼ˆnumber = 42ï¼‰</span></span><br><span class="line">            <span class="comment">// å¯¹å…¶ä»–çº¿ç¨‹éƒ½æ˜¯å¯è§çš„ã€‚ä¿è¯äº† number çš„å€¼æ˜¯ 42ã€‚</span></span><br><span class="line">            System.out.println(<span class="string">&quot;è¯»å–åˆ°çš„ number å€¼: &quot;</span> + number);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">WriterThread</span>().start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ReaderThread</span>().start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="ä¸­æ–­æœºåˆ¶-1"><a href="#ä¸­æ–­æœºåˆ¶-1" class="headerlink" title="ä¸­æ–­æœºåˆ¶"></a>ä¸­æ–­æœºåˆ¶</h3><p>ä¸€ä¸ªçº¿ç¨‹é€šè¿‡å“åº” <code>interrupt()</code> è°ƒç”¨æ¥æ­£ç¡®åœæ­¢è‡ªèº«ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">InterruptibleThreadDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">worker</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">while</span> (!Thread.currentThread().isInterrupted()) &#123; <span class="comment">// æ£€æŸ¥ä¸­æ–­æ ‡å¿—</span></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;çº¿ç¨‹æ­£åœ¨æ‰§è¡Œ...&quot;</span>);</span><br><span class="line">                    <span class="comment">// sleep()ã€wait() ç­‰æ–¹æ³•ä¼šæŠ›å‡º InterruptedException å¹¶æ¸…é™¤ä¸­æ–­æ ‡å¿—</span></span><br><span class="line">                    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;çº¿ç¨‹è¢«ä¸­æ–­ï¼Œå³å°†é€€å‡º...&quot;</span>);</span><br><span class="line">                    <span class="comment">// é‡æ–°è®¾ç½®ä¸­æ–­æ ‡å¿—ï¼Œä»¥ä¾¿å¤–å±‚å¾ªç¯èƒ½æ­£ç¡®é€€å‡º</span></span><br><span class="line">                    Thread.currentThread().interrupt();</span><br><span class="line">                    <span class="comment">// æˆ–è€…ç›´æ¥ break æˆ– return é€€å‡º</span></span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;çº¿ç¨‹å·²ä¼˜é›…åœ°é€€å‡ºã€‚&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        worker.start();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">3500</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            Thread.currentThread().interrupt();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸»çº¿ç¨‹: å‘é€ä¸­æ–­ä¿¡å·ã€‚&quot;</span>);</span><br><span class="line">        worker.interrupt();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="ConcurrentHashMap"><a href="#ConcurrentHashMap" class="headerlink" title="ConcurrentHashMap"></a><code>ConcurrentHashMap</code></h3><p><code>ConcurrentHashMap</code> çš„å¹¶å‘åŸç†æ˜¯**åˆ†æ®µé”ï¼ˆ 7ï¼‰**æˆ– <strong>CAS + Synchronizedï¼ˆ 8ï¼‰</strong>ï¼Œåªå¯¹æ“ä½œçš„æ¡¶è¿›è¡Œé”å®šï¼Œå¤§å¤§æé«˜äº†å¹¶å‘æ€§èƒ½ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcurrentHashMapDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        ConcurrentHashMap&lt;String, Integer&gt; map = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">executor</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¯åŠ¨ 10 ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹å‘ map ä¸­æ·»åŠ  1000 ä¸ªé”®å€¼å¯¹</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">int</span> <span class="variable">threadId</span> <span class="operator">=</span> i;</span><br><span class="line">            executor.execute(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; <span class="number">1000</span>; j++) &#123;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;key-&quot;</span> + (threadId * <span class="number">1000</span> + j);</span><br><span class="line">                    map.put(key, j);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        executor.shutdown();</span><br><span class="line">        executor.awaitTermination(<span class="number">1</span>, TimeUnit.MINUTES);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;æœ€ç»ˆ map çš„å¤§å°: &quot;</span> + map.size()); <span class="comment">// æœŸæœ›å€¼ä¸º 10000</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="ForkJoinPool"><a href="#ForkJoinPool" class="headerlink" title="ForkJoinPool"></a><code>ForkJoinPool</code></h3><p><code>ForkJoinPool</code> æ˜¯ä¸€ä¸ªç”¨äºåˆ†æ²»ä»»åŠ¡çš„çº¿ç¨‹æ± ï¼Œ<code>RecursiveTask</code> æ˜¯å¯è¿”å›ç»“æœçš„åˆ†æ²»ä»»åŠ¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.ForkJoinPool;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.RecursiveTask;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SumTask</span> <span class="keyword">extends</span> <span class="title class_">RecursiveTask</span>&lt;Long&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span>[] array;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> start;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> end;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">THRESHOLD</span> <span class="operator">=</span> <span class="number">10000</span>; <span class="comment">// ä»»åŠ¡åˆ†è§£çš„é˜ˆå€¼</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SumTask</span><span class="params">(<span class="type">long</span>[] array, <span class="type">int</span> start, <span class="type">int</span> end)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.array = array;</span><br><span class="line">        <span class="built_in">this</span>.start = start;</span><br><span class="line">        <span class="built_in">this</span>.end = end;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Long <span class="title function_">compute</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœä»»åŠ¡è§„æ¨¡å°äºç­‰äºé˜ˆå€¼ï¼Œåˆ™ç›´æ¥è®¡ç®—</span></span><br><span class="line">        <span class="keyword">if</span> (end - start &lt;= THRESHOLD) &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> start; i &lt; end; i++) &#123;</span><br><span class="line">                sum += array[i];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> sum;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// å¦åˆ™ï¼Œå°†ä»»åŠ¡åˆ†è§£æˆä¸¤ä¸ªå­ä»»åŠ¡</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> start + (end - start) / <span class="number">2</span>;</span><br><span class="line">            <span class="type">SumTask</span> <span class="variable">leftTask</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SumTask</span>(array, start, mid);</span><br><span class="line">            <span class="type">SumTask</span> <span class="variable">rightTask</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SumTask</span>(array, mid, end);</span><br><span class="line"></span><br><span class="line">            leftTask.fork(); <span class="comment">// æäº¤å·¦å­ä»»åŠ¡</span></span><br><span class="line">            <span class="type">long</span> <span class="variable">rightResult</span> <span class="operator">=</span> rightTask.compute(); <span class="comment">// åŒæ­¥è®¡ç®—å³å­ä»»åŠ¡</span></span><br><span class="line">            <span class="type">long</span> <span class="variable">leftResult</span> <span class="operator">=</span> leftTask.join(); <span class="comment">// ç­‰å¾…å·¦å­ä»»åŠ¡ç»“æœ</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> leftResult + rightResult;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">long</span>[] array = <span class="keyword">new</span> <span class="title class_">long</span>[<span class="number">1000000</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; array.length; i++) &#123;</span><br><span class="line">            array[i] = i;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">ForkJoinPool</span> <span class="variable">pool</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ForkJoinPool</span>();</span><br><span class="line">        <span class="type">SumTask</span> <span class="variable">task</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SumTask</span>(array, <span class="number">0</span>, array.length);</span><br><span class="line">        <span class="type">long</span> <span class="variable">result</span> <span class="operator">=</span> pool.invoke(task);</span><br><span class="line">        System.out.println(<span class="string">&quot;å¤§æ•°ç»„çš„å’Œä¸º: &quot;</span> + result);</span><br><span class="line"></span><br><span class="line">        pool.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="1-è¯­è¨€åŸºç¡€"><a href="#1-è¯­è¨€åŸºç¡€" class="headerlink" title="1.  è¯­è¨€åŸºç¡€"></a>1.  è¯­è¨€åŸºç¡€</h3><h4 id="å˜é‡ä¸æ•°æ®ç±»å‹"><a href="#å˜é‡ä¸æ•°æ®ç±»å‹" class="headerlink" title="å˜é‡ä¸æ•°æ®ç±»å‹"></a>å˜é‡ä¸æ•°æ®ç±»å‹</h4><p> çš„åŸºæœ¬æ•°æ®ç±»å‹å†³å®šäº†å˜é‡å¯ä»¥å­˜å‚¨çš„æ•°æ®èŒƒå›´ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataTypesDetailed</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// æ•´æ•°ç±»å‹ï¼šé»˜è®¤ä¸º int</span></span><br><span class="line">        <span class="type">byte</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">100</span>; <span class="comment">// å ç”¨ 1 å­—èŠ‚ï¼Œ-128 åˆ° 127</span></span><br><span class="line">        <span class="type">short</span> <span class="variable">s</span> <span class="operator">=</span> <span class="number">10000</span>; <span class="comment">// å ç”¨ 2 å­—èŠ‚</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">100000</span>; <span class="comment">// å ç”¨ 4 å­—èŠ‚</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">l</span> <span class="operator">=</span> <span class="number">10000000000L</span>; <span class="comment">// å ç”¨ 8 å­—èŠ‚ï¼Œéœ€è¦ L æˆ– l åç¼€</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// æµ®ç‚¹ç±»å‹ï¼šé»˜è®¤ä¸º double</span></span><br><span class="line">        <span class="type">float</span> <span class="variable">f</span> <span class="operator">=</span> <span class="number">3.14f</span>; <span class="comment">// å ç”¨ 4 å­—èŠ‚ï¼Œéœ€è¦ f æˆ– F åç¼€</span></span><br><span class="line">        <span class="type">double</span> <span class="variable">d</span> <span class="operator">=</span> <span class="number">3.1415926535</span>; <span class="comment">// å ç”¨ 8 å­—èŠ‚</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// å­—ç¬¦ç±»å‹</span></span><br><span class="line">        <span class="type">char</span> <span class="variable">c1</span> <span class="operator">=</span> <span class="string">&#x27;A&#x27;</span>; <span class="comment">// å•ä¸ªå­—ç¬¦ï¼Œå ç”¨ 2 å­—èŠ‚</span></span><br><span class="line">        <span class="type">char</span> <span class="variable">c2</span> <span class="operator">=</span> <span class="number">65</span>; <span class="comment">// ä¹Ÿå¯ä»¥ä½¿ç”¨ ASCII ç æˆ– Unicode</span></span><br><span class="line">        System.out.println(<span class="string">&quot;c1 å’Œ c2 æ˜¯å¦ç›¸ç­‰ï¼Ÿ &quot;</span> + (c1 == c2));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¸ƒå°”ç±»å‹</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isFun</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;å­¦Javaæœ‰è¶£å—ï¼Ÿ&quot;</span> + isFun);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç±»å‹è½¬æ¢"><a href="#ç±»å‹è½¬æ¢" class="headerlink" title="ç±»å‹è½¬æ¢"></a>ç±»å‹è½¬æ¢</h4><p> ä¸­ï¼Œä»å°èŒƒå›´ç±»å‹å‘å¤§èŒƒå›´ç±»å‹è½¬æ¢æ˜¯<strong>è‡ªåŠ¨</strong>çš„ï¼ˆéšå¼è½¬æ¢ï¼‰ï¼›ä»å¤§èŒƒå›´å‘å°èŒƒå›´è½¬æ¢éœ€è¦<strong>å¼ºåˆ¶</strong>è½¬æ¢ï¼ˆæ˜¾å¼è½¬æ¢ï¼‰ï¼Œå¯èƒ½é€ æˆæ•°æ®ä¸¢å¤±ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TypeCasting</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// éšå¼è½¬æ¢ï¼šint -&gt; long</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">myInt</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line">        <span class="type">long</span> <span class="variable">myLong</span> <span class="operator">=</span> myInt;</span><br><span class="line">        System.out.println(<span class="string">&quot;éšå¼è½¬æ¢åçš„ long ç±»å‹: &quot;</span> + myLong);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ˜¾å¼è½¬æ¢ï¼šdouble -&gt; int</span></span><br><span class="line">        <span class="type">double</span> <span class="variable">myDouble</span> <span class="operator">=</span> <span class="number">9.99</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">myInteger</span> <span class="operator">=</span> (<span class="type">int</span>) myDouble; <span class="comment">// å¼ºåˆ¶è½¬æ¢ï¼Œå°æ•°éƒ¨åˆ†è¢«ä¸¢å¼ƒ</span></span><br><span class="line">        System.out.println(<span class="string">&quot;æ˜¾å¼è½¬æ¢åçš„ int ç±»å‹: &quot;</span> + myInteger); <span class="comment">// è¾“å‡º 9</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ•°ç»„"><a href="#æ•°ç»„" class="headerlink" title="æ•°ç»„"></a>æ•°ç»„</h4><p>æ•°ç»„æ˜¯å­˜å‚¨<strong>å›ºå®šå¤§å°</strong>åŒç±»å‹å…ƒç´ çš„é›†åˆã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArrayExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// å£°æ˜å¹¶åˆå§‹åŒ–ä¸€ä¸ªæ•´æ•°æ•°ç»„</span></span><br><span class="line">        <span class="type">int</span>[] numbers = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">5</span>]; <span class="comment">// åˆ›å»ºä¸€ä¸ªé•¿åº¦ä¸º 5 çš„æ•°ç»„</span></span><br><span class="line">        numbers[<span class="number">0</span>] = <span class="number">10</span>;</span><br><span class="line">        numbers[<span class="number">1</span>] = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å£°æ˜ã€åˆå§‹åŒ–å¹¶èµ‹å€¼</span></span><br><span class="line">        String[] fruits = &#123;<span class="string">&quot;Apple&quot;</span>, <span class="string">&quot;Banana&quot;</span>, <span class="string">&quot;Cherry&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// éå†æ•°ç»„</span></span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰€æœ‰æ°´æœ:&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (String fruit : fruits) &#123; <span class="comment">// å¢å¼º for å¾ªç¯</span></span><br><span class="line">            System.out.println(fruit);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="2-é¢å‘å¯¹è±¡ç¼–ç¨‹-OOP"><a href="#2-é¢å‘å¯¹è±¡ç¼–ç¨‹-OOP" class="headerlink" title="2. é¢å‘å¯¹è±¡ç¼–ç¨‹ (OOP)"></a>2. é¢å‘å¯¹è±¡ç¼–ç¨‹ (OOP)</h3><h4 id="æ„é€ æ–¹æ³•ä¸æ–¹æ³•é‡è½½"><a href="#æ„é€ æ–¹æ³•ä¸æ–¹æ³•é‡è½½" class="headerlink" title="æ„é€ æ–¹æ³•ä¸æ–¹æ³•é‡è½½"></a>æ„é€ æ–¹æ³•ä¸æ–¹æ³•é‡è½½</h4><p><strong>æ„é€ æ–¹æ³•</strong>æ˜¯ä¸€ç§ç‰¹æ®Šæ–¹æ³•ï¼Œç”¨äºåˆ›å»ºå¯¹è±¡æ—¶åˆå§‹åŒ–ã€‚<strong>æ–¹æ³•é‡è½½</strong>æ˜¯æŒ‡åœ¨åŒä¸€ä¸ªç±»ä¸­ï¼Œæ–¹æ³•åç›¸åŒä½†å‚æ•°åˆ—è¡¨ä¸åŒï¼ˆå‚æ•°ç±»å‹ã€æ•°é‡æˆ–é¡ºåºï¼‰çš„æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    String name;</span><br><span class="line">    <span class="type">int</span> age;</span><br><span class="line">    String id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ— å‚æ„é€ æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>(<span class="string">&quot;æœªçŸ¥&quot;</span>, <span class="number">0</span>, <span class="string">&quot;000&quot;</span>); <span class="comment">// è°ƒç”¨æœ¬ç±»çš„ä¸‰å‚æ„é€ æ–¹æ³•</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é‡è½½æ„é€ æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">(String name, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">        <span class="built_in">this</span>.id = <span class="string">&quot;000&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é‡è½½æ„é€ æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">(String name, <span class="type">int</span> age, String id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ–¹æ³•é‡è½½: è®¡ç®—ä¸¤ä¸ªæ•°çš„å’Œ</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">add</span><span class="params">(<span class="type">double</span> a, <span class="type">double</span> b)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç»§æ‰¿ã€å¤šæ€ä¸æŠ½è±¡"><a href="#ç»§æ‰¿ã€å¤šæ€ä¸æŠ½è±¡" class="headerlink" title="ç»§æ‰¿ã€å¤šæ€ä¸æŠ½è±¡"></a>ç»§æ‰¿ã€å¤šæ€ä¸æŠ½è±¡</h4><p>ç»§æ‰¿å®ç°ä»£ç å¤ç”¨ï¼Œå¤šæ€å®ç°è¡Œä¸ºå¤šæ ·åŒ–ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// çˆ¶ç±»ï¼šæŠ½è±¡ç±»</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Vehicle</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> String brand; <span class="comment">// å­ç±»å¯ä»¥è®¿é—®</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Vehicle</span><span class="params">(String brand)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.brand = brand;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>; <span class="comment">// æŠ½è±¡æ–¹æ³•ï¼Œå­ç±»å¿…é¡»å®ç°</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">displayBrand</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å“ç‰Œæ˜¯: &quot;</span> + brand);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å­ç±»ï¼šç»§æ‰¿ Vehicle</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Car</span> <span class="keyword">extends</span> <span class="title class_">Vehicle</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Car</span><span class="params">(String brand)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(brand); <span class="comment">// è°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ±½è½¦æ­£åœ¨è·¯ä¸Šè¡Œé©¶...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å­ç±»ï¼šç»§æ‰¿ Vehicle</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Bicycle</span> <span class="keyword">extends</span> <span class="title class_">Vehicle</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Bicycle</span><span class="params">(String brand)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(brand);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;è‡ªè¡Œè½¦æ­£åœ¨éª‘è¡Œ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PolymorphismDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Vehicle</span> <span class="variable">myCar</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Car</span>(<span class="string">&quot;BMW&quot;</span>); <span class="comment">// å¤šæ€å¼•ç”¨</span></span><br><span class="line">        <span class="type">Vehicle</span> <span class="variable">myBicycle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Bicycle</span>(<span class="string">&quot;Giant&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åŒä¸€ä¸ªæ–¹æ³•è°ƒç”¨ï¼Œä¸åŒè¡Œä¸º</span></span><br><span class="line">        myCar.run(); <span class="comment">// è¾“å‡º &quot;æ±½è½¦æ­£åœ¨è·¯ä¸Šè¡Œé©¶...&quot;</span></span><br><span class="line">        myBicycle.run(); <span class="comment">// è¾“å‡º &quot;è‡ªè¡Œè½¦æ­£åœ¨éª‘è¡Œ...&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="3-æ ¸å¿ƒç±»åº“"><a href="#3-æ ¸å¿ƒç±»åº“" class="headerlink" title="3.  æ ¸å¿ƒç±»åº“"></a>3.  æ ¸å¿ƒç±»åº“</h3><p>å¥½çš„ï¼Œè¿™æ¬¡æˆ‘ä»¬å°†æŠŠ<strong>å„ç§æ–¹æ³•çš„ä½¿ç”¨ä»£ç </strong>ç›´æ¥åµŒå…¥åˆ°æ¯ä¸ªçŸ¥è¯†ç‚¹çš„è§£é‡Šä¸­ï¼Œè®©æ‚¨åœ¨å­¦ä¹ æ¦‚å¿µçš„åŒæ—¶ï¼Œå°±èƒ½çœ‹åˆ°å…·ä½“çš„ä»£ç å®ç°å’Œæ•ˆæœã€‚æˆ‘ä»¬å°†ä¸“æ³¨äº<strong>æ•°ç»„ã€å­—ç¬¦ä¸²å’Œé›†åˆ</strong>è¿™ä¸‰å¤§æ ¸å¿ƒéƒ¨åˆ†ï¼ŒæŠŠå®ƒä»¬çš„åˆ›å»ºã€éå†ã€å’Œå„ç§å¸¸ç”¨æ–¹æ³•çš„ä»£ç ç¤ºä¾‹éƒ½æ¸…æ™°åœ°å±•ç¤ºå‡ºæ¥ã€‚</p><hr><h3 id="1-æ•°ç»„ï¼ˆArrayï¼‰"><a href="#1-æ•°ç»„ï¼ˆArrayï¼‰" class="headerlink" title="1. æ•°ç»„ï¼ˆArrayï¼‰"></a>1. æ•°ç»„ï¼ˆArrayï¼‰</h3><p>æ•°ç»„æ˜¯ä¸€ç§å›ºå®šå¤§å°çš„ã€ç”¨äºå­˜å‚¨åŒç±»å‹å…ƒç´ çš„å®¹å™¨ã€‚</p><h4 id="åˆ›å»ºå’Œéå†"><a href="#åˆ›å»ºå’Œéå†" class="headerlink" title="åˆ›å»ºå’Œéå†"></a>åˆ›å»ºå’Œéå†</h4><p>è¿™é‡Œå±•ç¤ºä¸¤ç§æœ€å¸¸è§çš„åˆ›å»ºæ•°ç»„çš„æ–¹å¼ï¼Œå¹¶ä½¿ç”¨ä¸¤ç§å¾ªç¯è¿›è¡Œéå†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArrayExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// æ–¹å¼ä¸€ï¼šå£°æ˜å¹¶åˆ†é…ç©ºé—´ï¼Œç³»ç»Ÿèµ‹é»˜è®¤å€¼</span></span><br><span class="line">        <span class="type">int</span>[] intArray = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">3</span>]; <span class="comment">// åˆ›å»ºä¸€ä¸ªåŒ…å«3ä¸ªæ•´æ•°çš„æ•°ç»„ï¼Œé»˜è®¤å€¼éƒ½æ˜¯0</span></span><br><span class="line">        intArray[<span class="number">0</span>] = <span class="number">10</span>;</span><br><span class="line">        intArray[<span class="number">1</span>] = <span class="number">20</span>;</span><br><span class="line">        intArray[<span class="number">2</span>] = <span class="number">30</span>;</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">&quot;æ•°ç»„ intArray çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯: &quot;</span> + intArray[<span class="number">0</span>]); <span class="comment">// è¾“å‡º: 10</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ–¹å¼äºŒï¼šå£°æ˜å¹¶ç›´æ¥åˆå§‹åŒ–</span></span><br><span class="line">        String[] stringArray = &#123;<span class="string">&quot;Hello&quot;</span>, <span class="string">&quot;World&quot;</span>, <span class="string">&quot;Java&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// éå†æ–¹å¼ä¸€ï¼šä½¿ç”¨ for å¾ªç¯</span></span><br><span class="line">        System.out.println(<span class="string">&quot;\n--- ä½¿ç”¨ for å¾ªç¯éå† ---&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; stringArray.length; i++) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;stringArray[&quot;</span> + i + <span class="string">&quot;] = &quot;</span> + stringArray[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// éå†æ–¹å¼äºŒï¼šä½¿ç”¨å¢å¼º for å¾ªç¯ï¼ˆæ›´ç®€æ´ï¼‰</span></span><br><span class="line">        System.out.println(<span class="string">&quot;\n--- ä½¿ç”¨å¢å¼º for å¾ªç¯éå† ---&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (String element : stringArray) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;å…ƒç´ : &quot;</span> + element);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Arrays-ç±»çš„å¸¸ç”¨æ–¹æ³•"><a href="#Arrays-ç±»çš„å¸¸ç”¨æ–¹æ³•" class="headerlink" title="Arrays ç±»çš„å¸¸ç”¨æ–¹æ³•"></a><code>Arrays</code> ç±»çš„å¸¸ç”¨æ–¹æ³•</h4><p><code>java.util.Arrays</code> ç±»æä¾›äº†å¾ˆå¤šé™æ€æ–¹æ³•ï¼Œæ–¹ä¾¿æˆ‘ä»¬å¯¹æ•°ç»„è¿›è¡Œæ“ä½œï¼Œæ¯”å¦‚æ’åºã€æŸ¥æ‰¾ã€å¤åˆ¶ç­‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArraysMethodExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] numbers = &#123;<span class="number">4</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">1</span>, <span class="number">6</span>&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1. æ’åºï¼šArrays.sort()</span></span><br><span class="line">        Arrays.sort(numbers);</span><br><span class="line">        System.out.println(<span class="string">&quot;æ’åºå: &quot;</span> + Arrays.toString(numbers)); <span class="comment">// è¾“å‡º: [1, 2, 4, 6, 8]</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. æŸ¥æ‰¾ï¼šArrays.binarySearch() (å¿…é¡»å…ˆæ’åº)</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> Arrays.binarySearch(numbers, <span class="number">6</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;å…ƒç´  6 çš„ç´¢å¼•æ˜¯: &quot;</span> + index); <span class="comment">// è¾“å‡º: 3</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. å¡«å……ï¼šArrays.fill()</span></span><br><span class="line">        <span class="type">int</span>[] newArray = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">5</span>];</span><br><span class="line">        Arrays.fill(newArray, <span class="number">99</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;å¡«å……å: &quot;</span> + Arrays.toString(newArray)); <span class="comment">// è¾“å‡º: [99, 99, 99, 99, 99]</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4. å¤åˆ¶ï¼šArrays.copyOf()</span></span><br><span class="line">        <span class="type">int</span>[] copiedArray = Arrays.copyOf(numbers, <span class="number">3</span>); <span class="comment">// å¤åˆ¶å‰3ä¸ªå…ƒç´ </span></span><br><span class="line">        System.out.println(<span class="string">&quot;å¤åˆ¶å‰3ä¸ªå…ƒç´ : &quot;</span> + Arrays.toString(copiedArray)); <span class="comment">// è¾“å‡º: [1, 2, 4]</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 5. æ¯”è¾ƒï¼šArrays.equals()</span></span><br><span class="line">        <span class="type">int</span>[] anotherArray = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>&#125;;</span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸¤ä¸ªæ•°ç»„æ˜¯å¦ç›¸ç­‰: &quot;</span> + Arrays.equals(numbers, anotherArray)); <span class="comment">// è¾“å‡º: true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="2-å­—ç¬¦ä¸²ï¼ˆStringï¼‰"><a href="#2-å­—ç¬¦ä¸²ï¼ˆStringï¼‰" class="headerlink" title="2. å­—ç¬¦ä¸²ï¼ˆStringï¼‰"></a>2. å­—ç¬¦ä¸²ï¼ˆStringï¼‰</h3><p><code>String</code> æ˜¯ä¸€ä¸ªä¸å¯å˜çš„å­—ç¬¦åºåˆ—ï¼Œè¿™æ„å‘³ç€ä¸€æ—¦åˆ›å»ºï¼Œå®ƒçš„å†…å®¹å°±ä¸èƒ½è¢«ä¿®æ”¹ã€‚æ‰€æœ‰ä¿®æ”¹æ“ä½œéƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„ <code>String</code> å¯¹è±¡ã€‚</p><h4 id="åˆ›å»ºå’Œå¸¸ç”¨æ–¹æ³•"><a href="#åˆ›å»ºå’Œå¸¸ç”¨æ–¹æ³•" class="headerlink" title="åˆ›å»ºå’Œå¸¸ç”¨æ–¹æ³•"></a>åˆ›å»ºå’Œå¸¸ç”¨æ–¹æ³•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºæ–¹å¼</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">str1</span> <span class="operator">=</span> <span class="string">&quot;  Java is a great language. &quot;</span>; <span class="comment">// å­—é¢é‡</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">str2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;Java is a great language.&quot;</span>); <span class="comment">// ä½¿ç”¨ new å…³é”®å­—</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¸¸ç”¨æ–¹æ³•</span></span><br><span class="line">        <span class="comment">// 1. è·å–é•¿åº¦</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> str1.length();</span><br><span class="line">        System.out.println(<span class="string">&quot;å­—ç¬¦ä¸²é•¿åº¦: &quot;</span> + length); <span class="comment">// è¾“å‡º: 29</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. è®¿é—®å­—ç¬¦</span></span><br><span class="line">        <span class="type">char</span> <span class="variable">firstChar</span> <span class="operator">=</span> str1.charAt(<span class="number">2</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;ç¬¬3ä¸ªå­—ç¬¦æ˜¯: &quot;</span> + firstChar); <span class="comment">// è¾“å‡º: J</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. æˆªå–å­ä¸²</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">sub</span> <span class="operator">=</span> str1.substring(<span class="number">5</span>, <span class="number">7</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆªå–å­ä¸²: &quot;</span> + sub); <span class="comment">// è¾“å‡º: is</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4. æŸ¥æ‰¾ä½ç½®</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> str1.indexOf(<span class="string">&quot;great&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;&#x27;great&#x27; çš„ç´¢å¼•: &quot;</span> + index); <span class="comment">// è¾“å‡º: 11</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 5. åˆ¤æ–­</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">contains</span> <span class="operator">=</span> str1.contains(<span class="string">&quot;language&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;æ˜¯å¦åŒ…å« &#x27;language&#x27;: &quot;</span> + contains); <span class="comment">// è¾“å‡º: true</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">startsWith</span> <span class="operator">=</span> str1.startsWith(<span class="string">&quot;  Java&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;æ˜¯å¦ä»¥ &#x27;  Java&#x27; å¼€å¤´: &quot;</span> + startsWith); <span class="comment">// è¾“å‡º: true</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 6. æ›¿æ¢</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">replacedStr</span> <span class="operator">=</span> str1.replace(<span class="string">&quot;great&quot;</span>, <span class="string">&quot;wonderful&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;æ›¿æ¢å: &quot;</span> + replacedStr); <span class="comment">// è¾“å‡º:   Java is a wonderful language. </span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 7. å¤§å°å†™è½¬æ¢å’Œå»ç©ºæ ¼</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">trimmedStr</span> <span class="operator">=</span> str1.trim();</span><br><span class="line">        System.out.println(<span class="string">&quot;å»é™¤é¦–å°¾ç©ºæ ¼: &#x27;&quot;</span> + trimmedStr + <span class="string">&quot;&#x27;&quot;</span>); <span class="comment">// è¾“å‡º: &#x27;Java is a great language.&#x27;</span></span><br><span class="line">        System.out.println(<span class="string">&quot;è½¬ä¸ºå¤§å†™: &quot;</span> + trimmedStr.toUpperCase());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 8. åˆ†å‰²å’Œè¿æ¥</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> <span class="string">&quot;apple,banana,orange&quot;</span>;</span><br><span class="line">        String[] fruits = data.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;åˆ†å‰²å: &quot;</span> + Arrays.toString(fruits)); <span class="comment">// è¾“å‡º: [apple, banana, orange]</span></span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">joinedString</span> <span class="operator">=</span> String.join(<span class="string">&quot; - &quot;</span>, fruits);</span><br><span class="line">        System.out.println(<span class="string">&quot;è¿æ¥å: &quot;</span> + joinedString); <span class="comment">// è¾“å‡º: apple - banana - orange</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="StringBuilder-å’Œ-StringBuffer"><a href="#StringBuilder-å’Œ-StringBuffer" class="headerlink" title="StringBuilder å’Œ StringBuffer"></a><code>StringBuilder</code> å’Œ <code>StringBuffer</code></h4><p>å¯¹äºéœ€è¦é¢‘ç¹ä¿®æ”¹å­—ç¬¦ä¸²çš„åœºæ™¯ï¼Œåº”ä½¿ç”¨ <code>StringBuilder</code> æˆ– <code>StringBuffer</code> ä»¥æé«˜æ€§èƒ½ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringBuilderExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1. è¿½åŠ å†…å®¹</span></span><br><span class="line">        sb.append(<span class="string">&quot; World&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;è¿½åŠ å: &quot;</span> + sb); <span class="comment">// è¾“å‡º: Hello World</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. æ’å…¥å†…å®¹</span></span><br><span class="line">        sb.insert(<span class="number">6</span>, <span class="string">&quot;Beautiful &quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;æ’å…¥å: &quot;</span> + sb); <span class="comment">// è¾“å‡º: Hello Beautiful World</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. åˆ é™¤å†…å®¹</span></span><br><span class="line">        sb.delete(<span class="number">6</span>, <span class="number">15</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;åˆ é™¤å: &quot;</span> + sb); <span class="comment">// è¾“å‡º: Hello World</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="3-é›†åˆï¼ˆCollectionsï¼‰"><a href="#3-é›†åˆï¼ˆCollectionsï¼‰" class="headerlink" title="3. é›†åˆï¼ˆCollectionsï¼‰"></a>3. é›†åˆï¼ˆCollectionsï¼‰</h3><p>Java é›†åˆæ¡†æ¶æä¾›äº†å¼ºå¤§çš„æ•°æ®ç»“æ„æ¥å­˜å‚¨å’Œæ“ä½œå¯¹è±¡ã€‚</p><h4 id="Listï¼ˆåˆ—è¡¨ï¼‰"><a href="#Listï¼ˆåˆ—è¡¨ï¼‰" class="headerlink" title="Listï¼ˆåˆ—è¡¨ï¼‰"></a><strong>List</strong>ï¼ˆåˆ—è¡¨ï¼‰</h4><p><code>List</code> æ˜¯ä¸€ç§æœ‰åºã€å¯é‡å¤çš„é›†åˆã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.LinkedList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ListExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»º ArrayListï¼ˆæŸ¥è¯¢å¿«ï¼‰</span></span><br><span class="line">        List&lt;String&gt; fruits = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        fruits.add(<span class="string">&quot;Apple&quot;</span>); <span class="comment">// æ·»åŠ å…ƒç´ </span></span><br><span class="line">        fruits.add(<span class="string">&quot;Banana&quot;</span>);</span><br><span class="line">        fruits.add(<span class="string">&quot;Apple&quot;</span>); <span class="comment">// å…è®¸é‡å¤</span></span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;åˆ—è¡¨å…ƒç´ : &quot;</span> + fruits); <span class="comment">// è¾“å‡º: [Apple, Banana, Apple]</span></span><br><span class="line">        System.out.println(<span class="string">&quot;ç¬¬ä¸€ä¸ªå…ƒç´ : &quot;</span> + fruits.get(<span class="number">0</span>)); <span class="comment">// è·å–å…ƒç´ </span></span><br><span class="line">        System.out.println(<span class="string">&quot;åˆ—è¡¨å¤§å°: &quot;</span> + fruits.size());</span><br><span class="line"></span><br><span class="line">        fruits.set(<span class="number">1</span>, <span class="string">&quot;Grape&quot;</span>); <span class="comment">// æ›¿æ¢ç¬¬äºŒä¸ªå…ƒç´ </span></span><br><span class="line">        System.out.println(<span class="string">&quot;æ›¿æ¢å: &quot;</span> + fruits); <span class="comment">// è¾“å‡º: [Apple, Grape, Apple]</span></span><br><span class="line"></span><br><span class="line">        fruits.remove(<span class="number">1</span>); <span class="comment">// åˆ é™¤ç¬¬äºŒä¸ªå…ƒç´ </span></span><br><span class="line">        System.out.println(<span class="string">&quot;åˆ é™¤å: &quot;</span> + fruits); <span class="comment">// è¾“å‡º: [Apple, Apple]</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Setï¼ˆé›†ï¼‰"><a href="#Setï¼ˆé›†ï¼‰" class="headerlink" title="Setï¼ˆé›†ï¼‰"></a><strong>Set</strong>ï¼ˆé›†ï¼‰</h4><p><code>Set</code> æ˜¯ä¸€ç§æ— åºã€ä¸å¯é‡å¤çš„é›†åˆã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SetExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»º HashSet</span></span><br><span class="line">        Set&lt;String&gt; uniqueFruits = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        uniqueFruits.add(<span class="string">&quot;Apple&quot;</span>);</span><br><span class="line">        uniqueFruits.add(<span class="string">&quot;Banana&quot;</span>);</span><br><span class="line">        uniqueFruits.add(<span class="string">&quot;Apple&quot;</span>); <span class="comment">// æ·»åŠ é‡å¤å…ƒç´ ï¼Œä¼šå¤±è´¥</span></span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;é›†åˆå…ƒç´ : &quot;</span> + uniqueFruits); <span class="comment">// è¾“å‡º: [Apple, Banana] (é¡ºåºä¸å®š)</span></span><br><span class="line"></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">containsBanana</span> <span class="operator">=</span> uniqueFruits.contains(<span class="string">&quot;Banana&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;æ˜¯å¦åŒ…å« &#x27;Banana&#x27;: &quot;</span> + containsBanana); <span class="comment">// è¾“å‡º: true</span></span><br><span class="line"></span><br><span class="line">        uniqueFruits.remove(<span class="string">&quot;Banana&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;åˆ é™¤å: &quot;</span> + uniqueFruits); <span class="comment">// è¾“å‡º: [Apple]</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Mapï¼ˆæ˜ å°„ï¼‰"><a href="#Mapï¼ˆæ˜ å°„ï¼‰" class="headerlink" title="Mapï¼ˆæ˜ å°„ï¼‰"></a><strong>Map</strong>ï¼ˆæ˜ å°„ï¼‰</h4><p><code>Map</code> å­˜å‚¨é”®å€¼å¯¹ï¼Œé”®æ˜¯å”¯ä¸€çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MapExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»º HashMap</span></span><br><span class="line">        Map&lt;String, Integer&gt; studentScores = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        studentScores.put(<span class="string">&quot;Alice&quot;</span>, <span class="number">95</span>); <span class="comment">// æ·»åŠ é”®å€¼å¯¹</span></span><br><span class="line">        studentScores.put(<span class="string">&quot;Bob&quot;</span>, <span class="number">88</span>);</span><br><span class="line">        studentScores.put(<span class="string">&quot;Alice&quot;</span>, <span class="number">100</span>); <span class="comment">// é”®å·²å­˜åœ¨ï¼Œä¼šè¦†ç›–æ—§å€¼</span></span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;Alice çš„åˆ†æ•°: &quot;</span> + studentScores.get(<span class="string">&quot;Alice&quot;</span>)); <span class="comment">// è¾“å‡º: 100</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// éå† Map çš„ä¸‰ç§æ–¹å¼</span></span><br><span class="line">        <span class="comment">// æ–¹å¼ä¸€ï¼šéå†é”®é›†</span></span><br><span class="line">        System.out.println(<span class="string">&quot;\n--- éå†é”®é›† ---&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (String name : studentScores.keySet()) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;å§“å: &quot;</span> + name + <span class="string">&quot;, åˆ†æ•°: &quot;</span> + studentScores.get(name));</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ–¹å¼äºŒï¼šéå†å€¼é›†</span></span><br><span class="line">        System.out.println(<span class="string">&quot;\n--- éå†å€¼é›† ---&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (Integer score : studentScores.values()) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;åˆ†æ•°: &quot;</span> + score);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ–¹å¼ä¸‰ï¼šéå†é”®å€¼å¯¹é›† (Entry Set)ï¼Œæœ€å¸¸ç”¨ä¸”é«˜æ•ˆ</span></span><br><span class="line">        System.out.println(<span class="string">&quot;\n--- éå†é”®å€¼å¯¹é›† ---&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, Integer&gt; entry : studentScores.entrySet()) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;å§“å: &quot;</span> + entry.getKey() + <span class="string">&quot;, åˆ†æ•°: &quot;</span> + entry.getValue());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ‰‹å†™ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> æ‰‹å†™ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¢è¯•é¢˜ç›®</title>
      <link href="/2025/09/11/%E9%9D%A2%E8%AF%95%E9%A2%98%E7%9B%AE/"/>
      <url>/2025/09/11/%E9%9D%A2%E8%AF%95%E9%A2%98%E7%9B%AE/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€Java-åŸºç¡€è¯­æ³•-å…³é”®å­—"><a href="#ä¸€ã€Java-åŸºç¡€è¯­æ³•-å…³é”®å­—" class="headerlink" title="ä¸€ã€Java åŸºç¡€è¯­æ³• &amp; å…³é”®å­—"></a>ä¸€ã€Java åŸºç¡€è¯­æ³• &amp; å…³é”®å­—</h2><h2 id="1-JDKã€JRE-å’Œ-JVM-çš„åŒºåˆ«"><a href="#1-JDKã€JRE-å’Œ-JVM-çš„åŒºåˆ«" class="headerlink" title="1. JDKã€JRE å’Œ JVM çš„åŒºåˆ«"></a>1. JDKã€JRE å’Œ JVM çš„åŒºåˆ«</h2><ul><li><strong>JVMï¼ˆJava Virtual Machineï¼‰</strong>ï¼šJava è™šæ‹Ÿæœºï¼Œè´Ÿè´£æ‰§è¡Œå­—èŠ‚ç ï¼ˆ<code>.class</code>ï¼‰ã€‚æä¾›ç±»åŠ è½½ã€å­—èŠ‚ç æ ¡éªŒã€å†…å­˜ç®¡ç†ï¼ˆå †ã€æ–¹æ³•åŒºï¼‰ã€æ‰§è¡Œå¼•æ“ã€åƒåœ¾å›æ”¶ã€çº¿ç¨‹è°ƒåº¦ç­‰ã€‚æ˜¯æŠ½è±¡çš„è§„èŒƒï¼Œå…·ä½“ç”±ä¸åŒå‚å•†å®ç°ï¼ˆHotSpotã€OpenJ9 ç­‰ï¼‰ã€‚</li><li><strong>JREï¼ˆJava Runtime Environmentï¼‰</strong>ï¼šè¿è¡Œç¯å¢ƒï¼ŒåŒ…å« JVMã€æ ¸å¿ƒç±»åº“ï¼ˆrt.jar æˆ– modulesï¼‰ã€ä»¥åŠè¿è¡Œæ—¶éœ€è¦çš„å…¶å®ƒèµ„æºã€‚ç”¨äºè¿è¡Œ Java ç¨‹åºã€‚</li><li><strong>JDKï¼ˆJava Development Kitï¼‰</strong>ï¼šå¼€å‘å·¥å…·åŒ…ï¼ŒåŒ…å« JRE + å¼€å‘å·¥å…·ï¼ˆ<code>javac</code>ã€<code>jar</code>ã€<code>javadoc</code>ã€è°ƒè¯•å·¥å…·ç­‰ï¼‰ã€‚ç”¨äºå¼€å‘ Java ç¨‹åºã€‚<br> æ€»ç»“ï¼šJDK âŠƒ JRE âŠƒ JVMï¼ˆJDK åŒ…å« JREï¼ŒJRE åŒ…å« JVMï¼‰ã€‚</li></ul><hr><h2 id="2-Java-çš„è·¨å¹³å°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#2-Java-çš„è·¨å¹³å°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="2. Java çš„è·¨å¹³å°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"></a>2. Java çš„è·¨å¹³å°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</h2><ul><li>Java ç¨‹åºå…ˆç”± <code>javac</code> ç¼–è¯‘æˆä¸å¹³å°æ— å…³çš„ <strong>å­—èŠ‚ç </strong>ï¼ˆ<code>.class</code>ï¼‰ã€‚å­—èŠ‚ç ä¸æ˜¯æœºå™¨ç ï¼Œè€Œæ˜¯ä¾› JVM æ‰§è¡Œçš„æŒ‡ä»¤é›†ã€‚</li><li>æ¯ä¸ªå¹³å°ï¼ˆWindows&#x2F;Linux&#x2F;macOSï¼‰æœ‰ç›¸åº”çš„ JVM å®ç°ï¼ŒJVM æŠŠå­—èŠ‚ç ç¿»è¯‘æˆè¯¥å¹³å°çš„æœºå™¨æŒ‡ä»¤ï¼ˆé€šè¿‡è§£é‡Šå™¨ã€JIT ç¼–è¯‘å™¨ç­‰ï¼‰ã€‚å› æ­¤åŒä¸€å¥— <code>.class</code> å¯ä»¥åœ¨ä¸åŒå¹³å°çš„ JVM ä¸Šè¿è¡Œ â€”â€” â€œä¸€æ¬¡ç¼–å†™ï¼Œå¤„å¤„è¿è¡Œâ€ï¼ˆWrite Once, Run Anywhereï¼‰ã€‚</li><li>å…¶å®ƒä¿è¯è·¨å¹³å°çš„è¦ç‚¹ï¼šæ ‡å‡†åº“éšè—å¹³å°å·®å¼‚ï¼ˆI&#x2F;Oã€çº¿ç¨‹ç­‰ï¼‰ï¼Œéœ€é¿å…ä½¿ç”¨ä¸å¹³å°ç»‘å®šçš„æœ¬åœ°ä»£ç ï¼ˆJNIï¼‰ã€‚</li></ul><hr><h2 id="3-Java-çš„åŸºæœ¬æ•°æ®ç±»å‹æœ‰å“ªäº›ï¼Ÿå„è‡ªçš„é»˜è®¤å€¼ï¼Ÿ"><a href="#3-Java-çš„åŸºæœ¬æ•°æ®ç±»å‹æœ‰å“ªäº›ï¼Ÿå„è‡ªçš„é»˜è®¤å€¼ï¼Ÿ" class="headerlink" title="3. Java çš„åŸºæœ¬æ•°æ®ç±»å‹æœ‰å“ªäº›ï¼Ÿå„è‡ªçš„é»˜è®¤å€¼ï¼Ÿ"></a>3. Java çš„åŸºæœ¬æ•°æ®ç±»å‹æœ‰å“ªäº›ï¼Ÿå„è‡ªçš„é»˜è®¤å€¼ï¼Ÿ</h2><p>8 ç§åŸºæœ¬ç±»å‹åŠé»˜è®¤å€¼ï¼ˆæˆå‘˜å˜é‡&#x2F;æ•°ç»„å…ƒç´ ï¼›å±€éƒ¨å˜é‡æ— é»˜è®¤å€¼å¿…é¡»åˆå§‹åŒ–ï¼‰ï¼š</p><ul><li><code>byte</code>ï¼š1 byteï¼Œé»˜è®¤å€¼ <code>0</code></li><li><code>short</code>ï¼š2 bytesï¼Œé»˜è®¤å€¼ <code>0</code></li><li><code>int</code>ï¼š4 bytesï¼Œé»˜è®¤å€¼ <code>0</code></li><li><code>long</code>ï¼š8 bytesï¼Œé»˜è®¤å€¼ <code>0L</code></li><li><code>float</code>ï¼š4 bytesï¼Œé»˜è®¤å€¼ <code>0.0f</code></li><li><code>double</code>ï¼š8 bytesï¼Œé»˜è®¤å€¼ <code>0.0d</code></li><li><code>char</code>ï¼š2 bytesï¼ˆUTF-16 code unitï¼‰ï¼Œé»˜è®¤å€¼ <code>&#39;\u0000&#39;</code>ï¼ˆå³ 0ï¼‰</li><li><code>boolean</code>ï¼šJVM è¯­ä¹‰ä¸Šç”¨ 1 bit è¡¨ç¤ºï¼Œé»˜è®¤å€¼ <code>false</code></li></ul><p>å¦å¤–ï¼Œ<strong>å¼•ç”¨ç±»å‹</strong>ï¼ˆå¯¹è±¡ã€æ•°ç»„ç­‰ï¼‰çš„é»˜è®¤å€¼æ˜¯ <code>null</code>ã€‚</p><hr><h2 id="4-byteã€shortã€intã€long-å„å å¤šå°‘å­—èŠ‚ï¼Ÿ"><a href="#4-byteã€shortã€intã€long-å„å å¤šå°‘å­—èŠ‚ï¼Ÿ" class="headerlink" title="4. byteã€shortã€intã€long å„å å¤šå°‘å­—èŠ‚ï¼Ÿ"></a>4. <code>byte</code>ã€<code>short</code>ã€<code>int</code>ã€<code>long</code> å„å å¤šå°‘å­—èŠ‚ï¼Ÿ</h2><ul><li><code>byte</code>ï¼š<strong>1 å­—èŠ‚</strong>ï¼ˆ8 ä½ï¼‰</li><li><code>short</code>ï¼š<strong>2 å­—èŠ‚</strong>ï¼ˆ16 ä½ï¼‰</li><li><code>int</code>ï¼š<strong>4 å­—èŠ‚</strong>ï¼ˆ32 ä½ï¼‰</li><li><code>long</code>ï¼š<strong>8 å­—èŠ‚</strong>ï¼ˆ64 ä½ï¼‰</li></ul><p>ï¼ˆä¸Šè¿°ä¸º Java è¯­è¨€è§„èŒƒå®šä¹‰ï¼Œä¸å¹³å°æ— å…³ã€‚ï¼‰</p><hr><h2 id="5-float-å’Œ-double-çš„åŒºåˆ«ï¼Ÿ"><a href="#5-float-å’Œ-double-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="5. float å’Œ double çš„åŒºåˆ«ï¼Ÿ"></a>5. <code>float</code> å’Œ <code>double</code> çš„åŒºåˆ«ï¼Ÿ</h2><ul><li>ç²¾åº¦ä¸å­˜å‚¨ï¼š<ul><li><code>float</code>ï¼š32 ä½å•ç²¾åº¦æµ®ç‚¹ï¼ˆIEEE 754ï¼‰ï¼Œçº¦ 6~7 ä½æœ‰æ•ˆæ•°å­—ã€‚</li><li><code>double</code>ï¼š64 ä½åŒç²¾åº¦æµ®ç‚¹ï¼ˆIEEE 754ï¼‰ï¼Œçº¦ 15~16 ä½æœ‰æ•ˆæ•°å­—ã€‚</li></ul></li><li>ç²¾åº¦æ›´é«˜çš„ <code>double</code> æ›´å¸¸ç”¨ï¼›<code>float</code> ç”¨äºèŠ‚çœå†…å­˜æˆ–ä¸ç‰¹å®š APIï¼ˆå¦‚å›¾å½¢åº“ï¼‰å…¼å®¹ã€‚</li><li>æ³¨æ„ï¼šæµ®ç‚¹æ•°æœ‰ç²¾åº¦è¯¯å·®ï¼Œä¸é€‚åˆåšç²¾ç¡®è´§å¸è®¡ç®—ï¼ˆåº”ä½¿ç”¨ <code>BigDecimal</code>ï¼‰ã€‚</li><li>é»˜è®¤æµ®ç‚¹å­—é¢é‡ä¸º <code>double</code>ï¼ˆä¾‹å¦‚ <code>1.2</code> æ˜¯ <code>double</code>ï¼Œå†™æˆ <code>1.2f</code> æ‰æ˜¯ <code>float</code>ï¼‰ã€‚</li></ul><hr><h2 id="6-char-ç±»å‹å å‡ ä¸ªå­—èŠ‚ï¼Ÿèƒ½å­˜æ±‰å­—å—ï¼Ÿ"><a href="#6-char-ç±»å‹å å‡ ä¸ªå­—èŠ‚ï¼Ÿèƒ½å­˜æ±‰å­—å—ï¼Ÿ" class="headerlink" title="6. char ç±»å‹å å‡ ä¸ªå­—èŠ‚ï¼Ÿèƒ½å­˜æ±‰å­—å—ï¼Ÿ"></a>6. <code>char</code> ç±»å‹å å‡ ä¸ªå­—èŠ‚ï¼Ÿèƒ½å­˜æ±‰å­—å—ï¼Ÿ</h2><ul><li><code>char</code> å  <strong>2 å­—èŠ‚</strong>ï¼ˆ16 ä½ï¼‰ï¼Œè¡¨ç¤º UTF-16 çš„ä¸€ä¸ª code unitã€‚</li><li>èƒ½å¦å­˜æ±‰å­—ï¼šå¤šæ•°å¸¸ç”¨æ±‰å­—ï¼ˆä½äºåŸºæœ¬å¤šæ–‡ç§å¹³é¢ BMPï¼‰å¯ä»¥ç”¨å•ä¸ª <code>char</code> è¡¨ç¤ºï¼ˆä¾‹å¦‚ <code>&#39;ä½ &#39;</code>ï¼‰ï¼›ä½†æœ‰äº›ç½•è§æ±‰å­—æˆ– emoji å±äºè¡¥å……å¹³é¢ï¼ˆSupplementary Planesï¼‰ï¼Œå®ƒä»¬éœ€è¦ <strong>ä¸¤ä¸ª charï¼ˆç§°ä¸º surrogate pairï¼‰</strong> æ¥è¡¨ç¤ºã€‚</li><li>å› æ­¤ï¼Œå•ä¸ª <code>char</code> èƒ½è¡¨ç¤ºä¸€ä¸ª UTF-16 code unitï¼Œè€Œä¸æ˜¯å®Œæ•´çš„ Unicode code pointã€‚å¤„ç† Unicode å­—ç¬¦æ—¶æ³¨æ„ä½¿ç”¨ <code>int codePoint</code> &#x2F; <code>Character</code> çš„ç›¸å…³ APIã€‚</li></ul><hr><h2 id="7-è‡ªåŠ¨è£…ç®±ï¼ˆautoboxingï¼‰å’Œæ‹†ç®±ï¼ˆunboxingï¼‰çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#7-è‡ªåŠ¨è£…ç®±ï¼ˆautoboxingï¼‰å’Œæ‹†ç®±ï¼ˆunboxingï¼‰çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="7. è‡ªåŠ¨è£…ç®±ï¼ˆautoboxingï¼‰å’Œæ‹†ç®±ï¼ˆunboxingï¼‰çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"></a>7. è‡ªåŠ¨è£…ç®±ï¼ˆautoboxingï¼‰å’Œæ‹†ç®±ï¼ˆunboxingï¼‰çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</h2><ul><li><p><strong>æ¦‚å¿µ</strong>ï¼š</p><ul><li>è£…ç®±ï¼šæŠŠåŸºæœ¬ç±»å‹è‡ªåŠ¨è½¬æ¢æˆå¯¹åº”çš„åŒ…è£…ç±»å‹ï¼ˆå¦‚ <code>int</code> â†’ <code>Integer</code>ï¼‰ã€‚</li><li>æ‹†ç®±ï¼šæŠŠåŒ…è£…ç±»å‹è‡ªåŠ¨è½¬æ¢å›åŸºæœ¬ç±»å‹ï¼ˆå¦‚ <code>Integer</code> â†’ <code>int</code>ï¼‰ã€‚</li></ul></li><li><p><strong>ç¼–è¯‘å™¨è¡Œä¸º</strong>ï¼šè‡ªåŠ¨è£…ç®±&#x2F;æ‹†ç®±æ˜¯åœ¨ç¼–è¯‘æœŸç”± Java ç¼–è¯‘å™¨æ’å…¥å¯¹åº”çš„è°ƒç”¨ï¼Œç¤ºä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Integer a = 10;        // ç¼–è¯‘å™¨ä¼šè½¬æ¢ä¸º Integer.valueOf(10)</span><br><span class="line">int b = a;             // ç¼–è¯‘å™¨ä¼šè½¬æ¢ä¸º a.intValue()</span><br></pre></td></tr></table></figure></li><li><p><strong>valueOf ç¼“å­˜</strong>ï¼šåŒ…è£…ç±»ï¼ˆå¦‚ <code>Integer.valueOf(int)</code>ï¼‰ä¼šå¯¹å°æ•´æ•°ï¼ˆé»˜è®¤ -128 åˆ° 127ï¼‰åšç¼“å­˜ä»¥é‡ç”¨å¯¹è±¡ï¼Œå‡å°‘é¢‘ç¹åˆ›å»ºå¯¹è±¡ã€‚</p></li><li><p><strong>æ³¨æ„äº‹é¡¹</strong>ï¼š</p><ul><li><p>æ‹†ç®± <code>null</code> ä¼šæŠ›å‡º <code>NullPointerException</code>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Integer x = null;</span><br><span class="line">int y = x; // NPE</span><br></pre></td></tr></table></figure></li><li><p>è£…ç®±&#x2F;æ‹†ç®±ä¼šæœ‰æ€§èƒ½å¼€é”€ï¼ˆå¯¹è±¡åˆ›å»ºã€è£…ç®±&#x2F;æ‹†ç®±æ–¹æ³•è°ƒç”¨ï¼‰ï¼Œåœ¨æ€§èƒ½æ•æ„Ÿåœºæ™¯å°½é‡ä½¿ç”¨åŸºæœ¬ç±»å‹æˆ–æ‰‹åŠ¨ä¼˜åŒ–ã€‚</p></li><li><p>æ¯”è¾ƒæ—¶æ³¨æ„ï¼š<code>Integer a = 100; Integer b = 100; a==b</code> åœ¨ç¼“å­˜èŒƒå›´å†…å¯èƒ½ä¸º <code>true</code>ï¼Œè¶…å‡ºèŒƒå›´åˆ™é€šå¸¸ä¸º <code>false</code>ã€‚</p></li></ul></li></ul><hr><h2 id="8-å’Œ-equals-çš„åŒºåˆ«ï¼Ÿ"><a href="#8-å’Œ-equals-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="8. == å’Œ equals() çš„åŒºåˆ«ï¼Ÿ"></a>8. <code>==</code> å’Œ <code>equals()</code> çš„åŒºåˆ«ï¼Ÿ</h2><ul><li><strong>&#x3D;&#x3D;</strong>ï¼š<ul><li>å¯¹äºåŸºæœ¬ç±»å‹ï¼šæ¯”è¾ƒ <strong>å€¼</strong>ï¼ˆæ•°å€¼æ˜¯å¦ç›¸ç­‰ï¼‰ã€‚</li><li>å¯¹äºå¼•ç”¨ç±»å‹ï¼šæ¯”è¾ƒ <strong>å¼•ç”¨åœ°å€</strong>ï¼ˆæ˜¯å¦æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼‰ã€‚</li></ul></li><li><strong>equals()</strong>ï¼š<ul><li>æ˜¯ <code>Object</code> çš„æ–¹æ³•ï¼Œé»˜è®¤å®ç°ä¹Ÿæ˜¯æ¯”è¾ƒå¼•ç”¨ï¼ˆç­‰ä»·äº <code>==</code>ï¼‰ã€‚</li><li>è®¸å¤šç±»ï¼ˆå¦‚ <code>String</code>ã€<code>Integer</code>ã€é›†åˆç±»ç­‰ï¼‰é‡å†™äº† <code>equals()</code>ï¼Œç”¨äºæ¯”è¾ƒ<strong>é€»è¾‘&#x2F;å†…å®¹ç›¸ç­‰</strong>ã€‚</li></ul></li><li><strong>ä½¿ç”¨å»ºè®®</strong>ï¼š<ul><li>æ¯”è¾ƒå¯¹è±¡å†…å®¹ç”¨ <code>equals()</code>ï¼ˆéœ€æ£€æŸ¥ <code>null</code>ï¼‰ï¼Œæ¯”è¾ƒæ˜¯å¦åŒä¸€å®ä¾‹ç”¨ <code>==</code>ã€‚</li><li>ä¸ <code>equals()</code> é…å¥—åº”é‡å†™ <code>hashCode()</code>ï¼ˆè§ä¸‹é¢˜ï¼‰ã€‚</li></ul></li></ul><hr><h2 id="9-hashCode-å’Œ-equals-çš„å…³ç³»ï¼Ÿ"><a href="#9-hashCode-å’Œ-equals-çš„å…³ç³»ï¼Ÿ" class="headerlink" title="9. hashCode å’Œ equals çš„å…³ç³»ï¼Ÿ"></a>9. <code>hashCode</code> å’Œ <code>equals</code> çš„å…³ç³»ï¼Ÿ</h2><ul><li><strong>åˆåŒï¼ˆContractï¼‰</strong>ï¼ˆé‡è¦ï¼‰ï¼š<ol><li>å¦‚æœä¸¤ä¸ªå¯¹è±¡é€šè¿‡ <code>equals()</code> è¢«åˆ¤å®šä¸ºç›¸ç­‰ï¼ˆ<code>a.equals(b)</code> ä¸º <code>true</code>ï¼‰ï¼Œé‚£ä¹ˆ <code>a.hashCode() == b.hashCode()</code> å¿…é¡»æˆç«‹ã€‚</li><li>åä¹‹ä¸è¦æ±‚ï¼š<code>hashCode</code> ç›¸ç­‰çš„å¯¹è±¡ä¸ä¸€å®š <code>equals()</code> ç›¸ç­‰ï¼ˆå“ˆå¸Œå†²çªå…è®¸ï¼‰ã€‚</li></ol></li><li><strong>åœ¨å“ˆå¸Œé›†åˆä¸­çš„è§’è‰²</strong>ï¼š<ul><li>å“ˆå¸Œè¡¨ï¼ˆ<code>HashMap</code>&#x2F;<code>HashSet</code>ï¼‰å…ˆç”¨ <code>hashCode()</code> æ‰¾åˆ°æ¡¶ï¼ˆbucketï¼‰ï¼Œè‹¥æ¡¶ä¸­æœ‰å¤šä¸ªå…ƒç´ ï¼Œå†ç”¨ <code>equals()</code> é€ä¸ªæ¯”è¾ƒç¡®è®¤ç›¸ç­‰æˆ–å†²çªã€‚</li><li>å¦‚æœåªé‡å†™ <code>equals()</code> è€Œä¸é‡å†™ <code>hashCode()</code> ä¼šç ´åé›†åˆè¡Œä¸ºï¼ˆä¾‹å¦‚æ”¾å…¥ <code>HashSet</code> åæ— æ³•æ­£ç¡®æŸ¥æ‰¾ï¼‰ã€‚</li></ul></li><li><strong>å®ç°è¦ç‚¹</strong>ï¼š<ul><li><code>hashCode()</code> è¦å°½é‡åˆ†æ•£ï¼ˆé™ä½å†²çªï¼‰ï¼Œå¹¶åœ¨å¯¹è±¡ä¸å¯å˜å­—æ®µä¸ŠåŸºäºç›¸åŒè§„åˆ™è®¡ç®—ã€‚</li><li>è‹¥å¯¹è±¡å¯å˜ï¼Œè‹¥ç”¨äºå“ˆå¸Œé›†åˆè¦å°å¿ƒï¼šä¿®æ”¹å­—æ®µä¼šå¯¼è‡´ <code>hashCode()</code> æ”¹å˜ï¼Œç ´åé›†åˆå†…éƒ¨ç»“æ„ã€‚</li></ul></li></ul><hr><h2 id="10-Stringã€StringBufferã€StringBuilder-çš„åŒºåˆ«ï¼Ÿ"><a href="#10-Stringã€StringBufferã€StringBuilder-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="10. Stringã€StringBufferã€StringBuilder çš„åŒºåˆ«ï¼Ÿ"></a>10. <code>String</code>ã€<code>StringBuffer</code>ã€<code>StringBuilder</code> çš„åŒºåˆ«ï¼Ÿ</h2><ul><li><strong>String</strong>ï¼š<ul><li>ä¸å¯å˜ï¼ˆimmutableï¼‰ï¼Œæ¯æ¬¡ä¿®æ”¹éƒ½ä¼šäº§ç”Ÿæ–°çš„å¯¹è±¡ï¼ˆæˆ–æ–°å†…éƒ¨ char&#x2F;byte æ•°ç»„ï¼‰ã€‚</li><li>çº¿ç¨‹å®‰å…¨ï¼ˆå› ä¸ºä¸å¯å˜ï¼‰ï¼Œé€‚åˆé¢‘ç¹è¯»å–ã€å°‘é‡ä¿®æ”¹çš„åœºæ™¯ã€‚</li></ul></li><li><strong>StringBuffer</strong>ï¼š<ul><li>å¯å˜çš„å­—ç¬¦åºåˆ—ï¼ˆå†…éƒ¨æœ‰ç¼“å†²åŒº <code>char[]</code>&#x2F;<code>byte[]</code>ï¼‰ï¼Œå‡ ä¹ä¸ <code>StringBuilder</code> æ¥å£ç›¸åŒã€‚</li><li><strong>çº¿ç¨‹å®‰å…¨</strong>ï¼Œå…¶æ–¹æ³•å¤§å¤šä½¿ç”¨ <code>synchronized</code>ï¼Œå› æ­¤åœ¨å¤šçº¿ç¨‹ä¸‹å¯ä»¥è¢«å¤šä¸ªçº¿ç¨‹å®‰å…¨ä½¿ç”¨ã€‚</li><li>ç›¸å¯¹è¾ƒæ…¢ï¼ˆåŒæ­¥å¼€é”€ï¼‰ã€‚</li></ul></li><li><strong>StringBuilderï¼ˆJava 5+ï¼‰</strong>ï¼š<ul><li>å¯å˜ï¼Œ<strong>éçº¿ç¨‹å®‰å…¨</strong>ï¼ˆæ²¡æœ‰åŒæ­¥ï¼‰ï¼Œæ¯” <code>StringBuffer</code> å¿«ã€‚</li><li>æ¨èåœ¨å•çº¿ç¨‹æˆ–å¤–éƒ¨å·²åŒæ­¥çš„åœºæ™¯ä¸‹ä½¿ç”¨ã€‚</li></ul></li><li><strong>é€‰æ‹©å»ºè®®</strong>ï¼š<ul><li>å¤šçº¿ç¨‹éœ€è¦å¯å˜å­—ç¬¦ä¸²ï¼š<code>StringBuffer</code>ï¼ˆæˆ–å¤–éƒ¨åŒæ­¥ï¼‰ã€‚</li><li>å•çº¿ç¨‹&#x2F;å±€éƒ¨æ„é€ å­—ç¬¦ä¸²ï¼š<code>StringBuilder</code>ã€‚</li><li>å¸¸é‡å­—ç¬¦ä¸²æˆ–å°‘é‡æ‹¼æ¥ï¼š<code>String</code>ï¼ˆç¼–è¯‘å™¨å¯¹ <code>+</code> ä¼šä¼˜åŒ–ä¸º <code>StringBuilder</code>ï¼‰ã€‚</li></ul></li></ul><hr><h2 id="11-ä¸ºä»€ä¹ˆ-String-æ˜¯ä¸å¯å˜çš„ï¼ˆimmutableï¼‰ï¼Ÿ"><a href="#11-ä¸ºä»€ä¹ˆ-String-æ˜¯ä¸å¯å˜çš„ï¼ˆimmutableï¼‰ï¼Ÿ" class="headerlink" title="11. ä¸ºä»€ä¹ˆ String æ˜¯ä¸å¯å˜çš„ï¼ˆimmutableï¼‰ï¼Ÿ"></a>11. ä¸ºä»€ä¹ˆ <code>String</code> æ˜¯ä¸å¯å˜çš„ï¼ˆimmutableï¼‰ï¼Ÿ</h2><p>åŸå› ï¼ˆå‡ æ¡é‡è¦ç†ç”±ï¼‰ï¼š</p><ol><li><strong>å®‰å…¨æ€§</strong>ï¼š<code>String</code> ç»å¸¸ç”¨äºå…³é”®åœºæ™¯ï¼ˆç±»åŠ è½½å™¨ã€ç½‘ç»œåœ°å€ã€æ–‡ä»¶åã€æƒé™æ£€æŸ¥ã€æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ç­‰ï¼‰ã€‚ä¸å¯å˜ä¿è¯åœ¨ä¼ é€’å¼•ç”¨æ—¶ä¸è¢«æ¶æ„æˆ–æ„å¤–ä¿®æ”¹ã€‚</li><li><strong>çº¿ç¨‹å®‰å…¨</strong>ï¼šä¸å¯å˜å¯¹è±¡å›ºæœ‰çº¿ç¨‹å®‰å…¨ï¼Œå¤šä¸ªçº¿ç¨‹å¯å…±äº«åŒä¸€ <code>String</code> å®ä¾‹è€Œæ— éœ€åŒæ­¥ã€‚</li><li><strong>æ€§èƒ½ï¼ˆç¼“å­˜ hashCodeï¼‰</strong>ï¼š<code>String</code> çš„å“ˆå¸Œå€¼å¯ç¼“å­˜ï¼ˆ<code>hash</code> å­—æ®µï¼‰ï¼Œä¾¿äºä½œä¸º Map çš„ keyï¼Œé¿å…é‡å¤è®¡ç®—ã€‚</li><li><strong>å­—ç¬¦ä¸²å¸¸é‡æ± </strong>ï¼šå¯å®‰å…¨åœ°å°†å­—é¢é‡æ”¾å…¥æ± ä¸­é‡ç”¨ï¼Œä¸ç”¨å¤åˆ¶æˆ–æ‹…å¿ƒä¿®æ”¹ã€‚</li><li><strong>ä¼˜åŒ–</strong>ï¼šJVM å¯è¿›è¡Œå…±äº«ã€å¸¸é‡æŠ˜å ç­‰ä¼˜åŒ–ï¼ˆæ›´æ˜“äºå®ç°æŸäº›ç¼–è¯‘æœŸ&#x2F;è¿è¡ŒæœŸä¼˜åŒ–ï¼‰ã€‚</li></ol><hr><h2 id="12-String-å¸¸é‡æ± çš„å®ç°æœºåˆ¶ï¼Ÿ"><a href="#12-String-å¸¸é‡æ± çš„å®ç°æœºåˆ¶ï¼Ÿ" class="headerlink" title="12. String å¸¸é‡æ± çš„å®ç°æœºåˆ¶ï¼Ÿ"></a>12. <code>String</code> å¸¸é‡æ± çš„å®ç°æœºåˆ¶ï¼Ÿ</h2><ul><li><strong>æ¦‚å¿µ</strong>ï¼šç¼–è¯‘æœŸå’Œè¿è¡ŒæœŸç»´æŠ¤ä¸€ä¸ªå­—ç¬¦ä¸²æ± ï¼ˆString Intern Poolï¼‰ï¼Œç”¨äºå­˜æ”¾å­—ç¬¦ä¸²å­—é¢é‡ï¼ˆliteralï¼‰å’Œæ˜¾å¼ <code>intern()</code> åçš„å­—ç¬¦ä¸²ï¼Œä»¥ä¾¿é‡ç”¨ç›¸åŒå†…å®¹çš„ <code>String</code> å®ä¾‹ã€‚</li><li><strong>ç¼–è¯‘æœŸ</strong>ï¼šæºä»£ç ä¸­çš„å­—ç¬¦ä¸²å­—é¢é‡ï¼ˆå¦‚ <code>&quot;abc&quot;</code>ï¼‰ä¼šè¢«æ”¾åˆ°å¸¸é‡æ± ï¼ˆç¼–è¯‘åçš„ class æ–‡ä»¶å¸¸é‡æ± ï¼‰ï¼Œç±»åŠ è½½åè¿™äº›å­—é¢é‡ä¼šæ”¾å…¥è¿è¡Œæ—¶çš„å­—ç¬¦ä¸²æ± ã€‚</li><li><strong>è¿è¡ŒæœŸ</strong>ï¼š<ul><li>ä»¥å‰ï¼ˆJava 6 åŠæ›´æ—©ï¼‰ï¼šå­—ç¬¦ä¸²å¸¸é‡æ± åœ¨ PermGenï¼ˆæ–¹æ³•åŒºï¼‰ä¸­ã€‚</li><li>Java 7 èµ·ï¼šå¸¸é‡æ± è¿ç§»åˆ° Java å †ï¼ˆè¿è¡Œæ—¶å¸¸é‡æ± ä¹Ÿåœ¨å †é‡Œï¼‰ï¼Œé¿å… PermGen é—®é¢˜ã€‚</li></ul></li><li><strong>intern()</strong>ï¼šå½“è°ƒç”¨ <code>s.intern()</code> æ—¶ï¼ŒJVM ä¼šæ£€æŸ¥æ± ä¸­æ˜¯å¦å·²æœ‰ç›¸åŒå†…å®¹çš„å­—ç¬¦ä¸²ï¼š<ul><li>è‹¥å­˜åœ¨ï¼Œè¿”å›æ± ä¸­çš„å¼•ç”¨ï¼›</li><li>è‹¥ä¸å­˜åœ¨ï¼Œå°†è¯¥å­—ç¬¦ä¸²çš„å¼•ç”¨åŠ å…¥æ± å¹¶è¿”å›å®ƒã€‚</li></ul></li><li><strong>ç¼–è¯‘æ—¶ä¼˜åŒ–</strong>ï¼šå­—ç¬¦ä¸²å¸¸é‡çš„æ‹¼æ¥ï¼ˆç¼–è¯‘æ—¶å¸¸é‡ï¼‰ä¼šåœ¨ç¼–è¯‘æœŸåˆå¹¶ï¼Œå¦‚ <code>&quot;a&quot; + &quot;b&quot;</code> â†’ <code>&quot;ab&quot;</code>ï¼Œç›´æ¥æ”¾å…¥å¸¸é‡æ± ï¼›è€Œè¿è¡Œæ—¶æ‹¼æ¥ï¼ˆå˜é‡å‚ä¸ï¼‰åˆ™ä½¿ç”¨ <code>StringBuilder</code>ã€‚</li></ul><hr><h2 id="13-new-String-abc-åˆ›å»ºäº†å‡ ä¸ªå¯¹è±¡ï¼Ÿ"><a href="#13-new-String-abc-åˆ›å»ºäº†å‡ ä¸ªå¯¹è±¡ï¼Ÿ" class="headerlink" title="13. new String(&quot;abc&quot;) åˆ›å»ºäº†å‡ ä¸ªå¯¹è±¡ï¼Ÿ"></a>13. <code>new String(&quot;abc&quot;)</code> åˆ›å»ºäº†å‡ ä¸ªå¯¹è±¡ï¼Ÿ</h2><ul><li><strong>é€šå¸¸æƒ…å½¢</strong>ï¼š<ul><li>è‹¥ <code>&quot;abc&quot;</code> å­—é¢é‡å°šæœªåœ¨å¸¸é‡æ± ä¸­å­˜åœ¨ï¼Œæ‰§è¡Œ <code>new String(&quot;abc&quot;)</code> ä¼šå¯¼è‡´ <strong>ä¸¤ä¸ªå¯¹è±¡</strong> è¢«åˆ›å»ºï¼šå¸¸é‡æ± ä¸­çš„ <code>&quot;abc&quot;</code>ï¼ˆä¸€ä¸ª <code>String</code>ï¼‰å’Œå †ä¸­é€šè¿‡ <code>new</code> åˆ›å»ºçš„æ–°çš„ <code>String</code> å®ä¾‹ï¼ˆå†…å®¹é€šå¸¸æ˜¯å¯¹å¸¸é‡æ± ä¸­å­—ç¬¦æ•°ç»„çš„å¤åˆ¶æˆ–å…±äº«ï¼Œå…·ä½“å®ç°éš Java ç‰ˆæœ¬è€Œå¼‚ï¼‰ã€‚</li><li>å¦‚æœå­—é¢é‡ <code>&quot;abc&quot;</code> å·²ç»å­˜åœ¨äºå¸¸é‡æ± ä¸­ï¼ˆä¾‹å¦‚ä¹‹å‰è¢«åŠ è½½è¿‡ï¼‰ï¼Œé‚£ä¹ˆ <code>new String(&quot;abc&quot;)</code> åªä¼šåˆ›å»º <strong>ä¸€ä¸ªå †å¯¹è±¡</strong>ï¼ˆnew çš„é‚£ä¸ª <code>String</code>ï¼‰ã€‚</li></ul></li><li><strong>æ³¨æ„</strong>ï¼šè‡ª Java 7&#x2F;9 å <code>String</code> å†…éƒ¨å®ç°æ”¹å˜ï¼ˆå‹ç¼©å­—ç¬¦ä¸²ã€byte[] å­˜å‚¨ç­‰ï¼‰ï¼Œä½†é€»è¾‘ä¸Šä¸Šè¿°ç»“è®ºæˆç«‹ï¼šé€šå¸¸ 1 æˆ– 2 ä¸ªå¯¹è±¡ï¼Œå–å†³äºå¸¸é‡æ± ä¸­æ˜¯å¦å·²å­˜åœ¨è¯¥å­—é¢é‡ã€‚</li></ul><hr><h2 id="14-final-å…³é”®å­—çš„ä½œç”¨ï¼Ÿ"><a href="#14-final-å…³é”®å­—çš„ä½œç”¨ï¼Ÿ" class="headerlink" title="14. final å…³é”®å­—çš„ä½œç”¨ï¼Ÿ"></a>14. <code>final</code> å…³é”®å­—çš„ä½œç”¨ï¼Ÿ</h2><ul><li><strong>ç”¨äºç±»ï¼ˆfinal classï¼‰</strong>ï¼šç±»ä¸å¯è¢«ç»§æ‰¿ï¼ˆå¦‚ <code>String</code>ï¼‰ã€‚</li><li><strong>ç”¨äºæ–¹æ³•ï¼ˆfinal æ–¹æ³•ï¼‰</strong>ï¼šæ–¹æ³•ä¸èƒ½è¢«å­ç±»é‡å†™ï¼ˆoverrideï¼‰ï¼Œç”¨äºç¡®ä¿è¡Œä¸ºä¸å¯å˜ã€‚</li><li><strong>ç”¨äºå˜é‡ï¼ˆfinal å­—æ®µ&#x2F;å±€éƒ¨å˜é‡ï¼‰</strong>ï¼š<ul><li>å¯¹åŸºæœ¬ç±»å‹ï¼šèµ‹å€¼åå€¼ä¸å¯æ”¹å˜ï¼ˆå¸¸é‡ï¼‰ã€‚</li><li>å¯¹å¼•ç”¨ç±»å‹ï¼šå¼•ç”¨ä¸å¯æ”¹å˜ï¼ˆä¸èƒ½æŒ‡å‘å¦ä¸€ä¸ªå¯¹è±¡ï¼‰ï¼Œä½†æ‰€æŒ‡å‘å¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ä»å¯å˜ï¼ˆé™¤éå¯¹è±¡æœ¬èº«ä¸å¯å˜ï¼‰ã€‚</li><li><code>static final</code> å¸¸ç”¨æ¥å®šä¹‰å¸¸é‡ï¼ˆç¼–è¯‘æœŸå¸¸é‡ï¼‰ã€‚</li></ul></li><li><strong>ç”¨äºå‚æ•°</strong>ï¼ˆæ–¹æ³•å½¢å‚å¯ä»¥å£°æ˜ä¸º <code>final</code>ï¼‰ï¼šä»£è¡¨æ–¹æ³•å†…ä¸èƒ½ä¿®æ”¹è¯¥å‚æ•°å¼•ç”¨&#x2F;å€¼ã€‚</li><li><strong>å…¶å®ƒç”¨é€”</strong>ï¼šåœ¨å¤šçº¿ç¨‹ä¸­ï¼Œ<code>final</code> å­—æ®µçš„å†™-æ„é€ è¿‡ç¨‹è¢« JMMï¼ˆJava å†…å­˜æ¨¡å‹ï¼‰å¤„ç†ï¼Œç¡®ä¿æ„é€ å®Œæˆåå…¶ä»–çº¿ç¨‹å¯è§ï¼ˆå®‰å…¨å‘å¸ƒæ–¹é¢æœ‰å¥½å¤„ï¼‰ã€‚</li></ul><hr><h2 id="15-static-å…³é”®å­—çš„ä½œç”¨ï¼Ÿ"><a href="#15-static-å…³é”®å­—çš„ä½œç”¨ï¼Ÿ" class="headerlink" title="15. static å…³é”®å­—çš„ä½œç”¨ï¼Ÿ"></a>15. <code>static</code> å…³é”®å­—çš„ä½œç”¨ï¼Ÿ</h2><ul><li>ç”¨äºå£°æ˜ç±»çº§åˆ«æˆå‘˜ï¼ˆå­—æ®µã€æ–¹æ³•ã€åˆå§‹åŒ–å—ã€åµŒå¥—ç±»ï¼‰ï¼Œä¸ä¾èµ–å®ä¾‹ã€‚</li><li><strong>static å˜é‡</strong>ï¼šç±»å˜é‡ï¼Œæ‰€æœ‰å®ä¾‹å…±äº«ä¸€ä»½ã€‚å†…å­˜ä¸­ä»…æœ‰ä¸€ä»½å‰¯æœ¬ã€‚</li><li><strong>static æ–¹æ³•</strong>ï¼šç±»æ–¹æ³•ï¼Œå¯é€šè¿‡ <code>ClassName.method()</code> è°ƒç”¨ï¼›ä¸èƒ½ç›´æ¥è®¿é—®éé™æ€æˆå‘˜ï¼ˆå› æ—  thisï¼‰ã€‚</li><li><strong>static ä»£ç å—</strong>ï¼šç±»åŠ è½½æ—¶æ‰§è¡Œä¸€æ¬¡ï¼ˆç”¨äºé™æ€åˆå§‹åŒ–ï¼‰ã€‚</li><li><strong>static åµŒå¥—ç±»</strong>ï¼šå¯ä»¥å£°æ˜ä¸ºé™æ€çš„å†…éƒ¨ç±»ï¼ˆé™æ€åµŒå¥—ç±»ï¼‰ï¼Œæ²¡æœ‰å¤–éƒ¨å®ä¾‹å¼•ç”¨ã€‚</li></ul><hr><h2 id="16-static-ä¿®é¥°å˜é‡ã€æ–¹æ³•ã€ä»£ç å—åˆ†åˆ«æ„å‘³ç€ä»€ä¹ˆï¼Ÿ"><a href="#16-static-ä¿®é¥°å˜é‡ã€æ–¹æ³•ã€ä»£ç å—åˆ†åˆ«æ„å‘³ç€ä»€ä¹ˆï¼Ÿ" class="headerlink" title="16. static ä¿®é¥°å˜é‡ã€æ–¹æ³•ã€ä»£ç å—åˆ†åˆ«æ„å‘³ç€ä»€ä¹ˆï¼Ÿ"></a>16. <code>static</code> ä¿®é¥°å˜é‡ã€æ–¹æ³•ã€ä»£ç å—åˆ†åˆ«æ„å‘³ç€ä»€ä¹ˆï¼Ÿ</h2><ul><li><strong>static å˜é‡ï¼ˆç±»å˜é‡ï¼‰</strong>ï¼š<ul><li>éšç±»åŠ è½½è€Œåˆ›å»ºï¼Œæ‰€æœ‰å¯¹è±¡å…±äº«åŒä¸€ä»½æ•°æ®ã€‚</li><li>å¯é€šè¿‡ <code>ClassName.field</code> æˆ– <code>instance.field</code>ï¼ˆä¸æ¨èï¼‰è®¿é—®ã€‚</li></ul></li><li><strong>static æ–¹æ³•</strong>ï¼š<ul><li>å±äºç±»ï¼Œè°ƒç”¨æ—¶æ— éœ€å®ä¾‹ã€‚</li><li>ä¸èƒ½ä½¿ç”¨ <code>this</code>ã€ä¸èƒ½ç›´æ¥è®¿é—®éé™æ€æˆå‘˜ã€‚</li><li>å¯ä½œä¸ºå·¥å…·æ–¹æ³•ï¼ˆå¦‚ <code>Math.abs()</code>ï¼‰ã€‚</li></ul></li><li><strong>static ä»£ç å—</strong>ï¼š<ul><li>åœ¨ç±»åŠ è½½é˜¶æ®µæ‰§è¡Œä¸€æ¬¡ï¼Œç”¨äºå¤æ‚é™æ€åˆå§‹åŒ–ï¼ˆæ¯”å¦‚åˆå§‹åŒ–é™æ€å¸¸é‡ã€åŠ è½½æœ¬åœ°åº“ç­‰ï¼‰ã€‚</li><li>æ‰§è¡Œé¡ºåºï¼šé™æ€å—æŒ‰å®šä¹‰é¡ºåºæ‰§è¡Œï¼Œç±»åŠ è½½æ—¶è¿è¡Œï¼ˆåœ¨å®ä¾‹åŒ–ä¹‹å‰ï¼‰ã€‚</li></ul></li></ul><hr><h2 id="17-static-å’Œ-final-èƒ½ä¸€èµ·ç”¨å—ï¼Ÿ"><a href="#17-static-å’Œ-final-èƒ½ä¸€èµ·ç”¨å—ï¼Ÿ" class="headerlink" title="17. static å’Œ final èƒ½ä¸€èµ·ç”¨å—ï¼Ÿ"></a>17. <code>static</code> å’Œ <code>final</code> èƒ½ä¸€èµ·ç”¨å—ï¼Ÿ</h2><ul><li><p><strong>èƒ½</strong>ã€‚<code>static final</code> å¸¸ç”¨äºå®šä¹‰ç±»å¸¸é‡ï¼ˆå°¤å…¶æ˜¯åŸºæœ¬ç±»å‹å’Œ <code>String</code>ï¼‰ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">public static final int MAX = 100;</span><br><span class="line">public static final String NAME = &quot;abc&quot;;</span><br></pre></td></tr></table></figure></li><li><p><strong>åŒºåˆ«</strong>ï¼š</p><ul><li>å¦‚æœæ˜¯ç¼–è¯‘æœŸå¸¸é‡ï¼ˆ<code>static final</code> åŸºæœ¬ç±»å‹æˆ– <code>String</code> ä¸”åœ¨ç¼–è¯‘æ—¶å¯ä»¥ç¡®å®šï¼‰ï¼Œç¼–è¯‘å™¨ä¼šå°†å…¶å†…è”åˆ°ä½¿ç”¨å¤„ï¼ˆè¢«å¼•ç”¨çš„ç±»ç¼–è¯‘åçœ‹åˆ°çš„æ˜¯å¸¸é‡å€¼ï¼‰ï¼Œæ³¨æ„è·¨æ¨¡å—ä¿®æ”¹å¯èƒ½å¯¼è‡´éœ€è¦é‡æ–°ç¼–è¯‘å¼•ç”¨æ–¹ã€‚</li><li>å¦‚æœæ˜¯ <code>static final</code> å¼•ç”¨å¯¹è±¡ä¸”ä¸æ˜¯ç¼–è¯‘æœŸå¸¸é‡ï¼Œåˆ™å¼•ç”¨æœ¬èº«ä¸å¯å˜ï¼Œä½†å¯¹è±¡å†…å®¹å¯èƒ½å¯å˜ã€‚</li></ul></li></ul><hr><h2 id="18-static-å†…éƒ¨ç±»å’Œéé™æ€å†…éƒ¨ç±»çš„åŒºåˆ«ï¼Ÿ"><a href="#18-static-å†…éƒ¨ç±»å’Œéé™æ€å†…éƒ¨ç±»çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="18. static å†…éƒ¨ç±»å’Œéé™æ€å†…éƒ¨ç±»çš„åŒºåˆ«ï¼Ÿ"></a>18. <code>static</code> å†…éƒ¨ç±»å’Œéé™æ€å†…éƒ¨ç±»çš„åŒºåˆ«ï¼Ÿ</h2><ul><li><strong>é™æ€å†…éƒ¨ç±»ï¼ˆstatic nested classï¼‰</strong>ï¼š<ul><li>ç›¸å½“äºå¤–éƒ¨ç±»çš„ä¸€ä¸ªé™æ€æˆå‘˜ã€‚</li><li><strong>æ²¡æœ‰</strong>å¯¹å¤–éƒ¨ç±»å®ä¾‹çš„éšå¼å¼•ç”¨ï¼ˆä¸èƒ½ç›´æ¥è®¿é—®å¤–éƒ¨ç±»çš„éé™æ€æˆå‘˜ï¼‰ã€‚</li><li>å¯ä»¥åƒæ™®é€šç±»é‚£æ ·å®ä¾‹åŒ–ï¼š<code>Outer.StaticInner inner = new Outer.StaticInner();</code></li></ul></li><li><strong>éé™æ€å†…éƒ¨ç±»ï¼ˆinner classï¼‰</strong>ï¼š<ul><li>æ¯ä¸ªå®ä¾‹éšå¼æŒæœ‰ä¸€ä¸ªå¤–éƒ¨ç±»å®ä¾‹å¼•ç”¨ï¼ˆ<code>Outer.this</code>ï¼‰ï¼Œå¯ä»¥ç›´æ¥è®¿é—®å¤–éƒ¨ç±»çš„æ‰€æœ‰æˆå‘˜ï¼ˆåŒ…æ‹¬ç§æœ‰æˆå‘˜ï¼‰ã€‚</li><li>åˆ›å»ºæ–¹å¼ï¼š<code>Outer outer = new Outer(); Outer.Inner inner = outer.new Inner();</code></li><li>å ç”¨å¤–éƒ¨ç±»å¯¹è±¡çš„å†…å­˜å¼•ç”¨ï¼Œå¯èƒ½å¯¼è‡´å†…å­˜æ³„éœ²ï¼ˆå¦‚æœé•¿æœŸæŒæœ‰å†…éƒ¨ç±»å®ä¾‹å¯¼è‡´å¤–éƒ¨ç±»ä¸èƒ½è¢«å›æ”¶ï¼‰ã€‚</li></ul></li><li><strong>é€‰æ‹©åŸåˆ™</strong>ï¼šå¦‚æœå†…éƒ¨ç±»ä¸éœ€è¦è®¿é—®å¤–éƒ¨å®ä¾‹æˆå‘˜ï¼Œä¼˜å…ˆä½¿ç”¨ <code>static</code> åµŒå¥—ç±»ï¼Œé¿å…é¢å¤–å¼•ç”¨ã€‚</li></ul><hr><h2 id="19-Java-ä¸­çš„-this-å’Œ-super-çš„åŒºåˆ«ï¼Ÿ"><a href="#19-Java-ä¸­çš„-this-å’Œ-super-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="19. Java ä¸­çš„ this å’Œ super çš„åŒºåˆ«ï¼Ÿ"></a>19. Java ä¸­çš„ <code>this</code> å’Œ <code>super</code> çš„åŒºåˆ«ï¼Ÿ</h2><ul><li><strong>this</strong>ï¼š<ul><li>å¼•ç”¨å½“å‰å¯¹è±¡çš„å¼•ç”¨ã€‚</li><li>ç”¨äºè®¿é—®å½“å‰ç±»çš„å®ä¾‹å˜é‡ã€è°ƒç”¨å½“å‰ç±»çš„å…¶ä»–æ„é€ å™¨ï¼ˆ<code>this(...)</code>ï¼‰ã€æˆ–ä¼ é€’å½“å‰å¯¹è±¡å¼•ç”¨ã€‚</li></ul></li><li><strong>super</strong>ï¼š<ul><li>å¼•ç”¨å½“å‰å¯¹è±¡çš„çˆ¶ç±»éƒ¨åˆ†ã€‚</li><li>ç”¨äºè®¿é—®çˆ¶ç±»è¢«è¦†ç›–çš„æ–¹æ³•ï¼ˆ<code>super.method()</code>ï¼‰ã€çˆ¶ç±»å­—æ®µï¼ˆè‹¥æœ‰åŒåå­—æ®µï¼‰ã€ä»¥åŠåœ¨å­ç±»æ„é€ å™¨ç¬¬ä¸€è¡Œè°ƒç”¨çˆ¶ç±»æ„é€ å™¨ï¼ˆ<code>super(...)</code>ï¼‰ã€‚</li></ul></li><li><strong>æ³¨æ„</strong>ï¼š<ul><li><code>this()</code> æˆ– <code>super()</code> å¿…é¡»åœ¨æ„é€ å™¨çš„ç¬¬ä¸€è¡Œï¼ˆä¸¤è€…ä¸èƒ½åŒæ—¶å‡ºç°ï¼‰ã€‚</li><li><code>super</code> ä¸èƒ½ç”¨äºè®¿é—®çˆ¶ç±»çš„ private æˆå‘˜ï¼ˆç¼–è¯‘æœŸé™åˆ¶ï¼‰ã€‚</li></ul></li></ul><hr><h2 id="20-Java-ä¸­æ„é€ æ–¹æ³•èƒ½å¦è¢«é‡å†™ï¼Ÿ"><a href="#20-Java-ä¸­æ„é€ æ–¹æ³•èƒ½å¦è¢«é‡å†™ï¼Ÿ" class="headerlink" title="20. Java ä¸­æ„é€ æ–¹æ³•èƒ½å¦è¢«é‡å†™ï¼Ÿ"></a>20. Java ä¸­æ„é€ æ–¹æ³•èƒ½å¦è¢«é‡å†™ï¼Ÿ</h2><ul><li><strong>ä¸èƒ½</strong>ã€‚é‡å†™ï¼ˆoverrideï¼‰é€‚ç”¨äºå®ä¾‹æ–¹æ³•ï¼Œæ„é€ æ–¹æ³•ä¸æ˜¯ç»§æ‰¿çš„æˆå‘˜ï¼Œå­ç±»ä¸èƒ½é‡å†™çˆ¶ç±»çš„æ„é€ å™¨ã€‚</li><li><strong>å¯ä»¥é‡è½½ï¼ˆoverloadï¼‰</strong>ï¼šåœ¨åŒä¸€ç±»ä¸­åŒåæ„é€ å™¨æœ‰ä¸åŒå‚æ•°åˆ—è¡¨å±äºé‡è½½ã€‚</li><li>å­ç±»æ„é€ å™¨å¯é€šè¿‡ <code>super(...)</code> æ˜¾å¼è°ƒç”¨çˆ¶ç±»æ„é€ å™¨æ¥å®Œæˆçˆ¶ç±»åˆå§‹åŒ–ã€‚</li></ul><hr><h2 id="21-æ¥å£å’ŒæŠ½è±¡ç±»çš„åŒºåˆ«ï¼Ÿ"><a href="#21-æ¥å£å’ŒæŠ½è±¡ç±»çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="21. æ¥å£å’ŒæŠ½è±¡ç±»çš„åŒºåˆ«ï¼Ÿ"></a>21. æ¥å£å’ŒæŠ½è±¡ç±»çš„åŒºåˆ«ï¼Ÿ</h2><ul><li><strong>æ¥å£ï¼ˆinterfaceï¼‰</strong>ï¼š<ul><li>æ—©æœŸï¼ˆJava 7 ä¹‹å‰ï¼‰ï¼šåªåŒ…å«æŠ½è±¡æ–¹æ³•ï¼ˆé»˜è®¤æ˜¯ <code>public abstract</code>ï¼‰å’Œ <code>public static final</code> å¸¸é‡ã€‚</li><li>Java 8+ï¼šå¯ä»¥åŒ…å« <code>default</code> æ–¹æ³•ä¸ <code>static</code> æ–¹æ³•ï¼ˆå¯ä»¥æœ‰éƒ¨åˆ†å®ç°ï¼‰ï¼›Java 9+ å…è®¸ <code>private</code> æ–¹æ³•ã€‚</li><li>æ”¯æŒå¤šç»§æ‰¿ï¼ˆä¸€ä¸ªç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£ï¼‰ã€‚</li><li>æ²¡æœ‰å®ä¾‹å­—æ®µï¼ˆé™¤ <code>static final</code> å¸¸é‡å¤–ï¼‰ã€‚</li></ul></li><li><strong>æŠ½è±¡ç±»ï¼ˆabstract classï¼‰</strong>ï¼š<ul><li>å¯ä»¥æœ‰å®ä¾‹å­—æ®µï¼ˆéé™æ€æˆå‘˜å˜é‡ï¼‰ã€å·²æœ‰å®ç°çš„æ–¹æ³•ï¼ˆå…·ä½“æ–¹æ³•ï¼‰ã€æ„é€ å™¨ã€‚</li><li>é€‚åˆè¡¨ç¤ºä¸€ç±»æœ‰å…±åŒè¡Œä¸ºå¹¶å…±äº«çŠ¶æ€çš„ç±»å±‚æ¬¡ã€‚</li><li>ç±»åªèƒ½å•ç»§æ‰¿ï¼ˆåªèƒ½ç»§æ‰¿ä¸€ä¸ªæŠ½è±¡ç±»ï¼‰ã€‚</li></ul></li><li><strong>é€‰æ‹©å»ºè®®</strong>ï¼š<ul><li>å¦‚æœéœ€è¦å¤šç»§æ‰¿è¡Œä¸ºã€åªå®šä¹‰æ–¹æ³•å¥‘çº¦ä¸”ä¸éœ€è¦çŠ¶æ€ï¼Œä½¿ç”¨æ¥å£ã€‚</li><li>å¦‚æœéœ€è¦æä¾›å…±æœ‰å®ç°å’ŒçŠ¶æ€ï¼Œä½¿ç”¨æŠ½è±¡ç±»ã€‚</li></ul></li></ul><hr><h2 id="22-æ¥å£ä¸­å¯ä»¥æœ‰-default-æ–¹æ³•å’Œ-static-æ–¹æ³•å—ï¼Ÿ"><a href="#22-æ¥å£ä¸­å¯ä»¥æœ‰-default-æ–¹æ³•å’Œ-static-æ–¹æ³•å—ï¼Ÿ" class="headerlink" title="22. æ¥å£ä¸­å¯ä»¥æœ‰ default æ–¹æ³•å’Œ static æ–¹æ³•å—ï¼Ÿ"></a>22. æ¥å£ä¸­å¯ä»¥æœ‰ <code>default</code> æ–¹æ³•å’Œ <code>static</code> æ–¹æ³•å—ï¼Ÿ</h2><ul><li><strong>å¯ä»¥ï¼ˆJava 8 èµ·ï¼‰</strong>ã€‚<ul><li><code>default</code> æ–¹æ³•ï¼šä¸ºå®ç°ç±»æä¾›é»˜è®¤å®ç°ï¼Œé¿å…ç ´åå·²æœ‰å®ç°ï¼ˆæ¥å£æ¼”åŒ–ï¼‰ã€‚å®ç°ç±»å¯ä»¥è¦†ç›–ï¼ˆoverrideï¼‰ã€‚</li><li><code>static</code> æ–¹æ³•ï¼šå±äºæ¥å£è‡ªèº«ï¼Œå¯ä»¥é€šè¿‡ <code>InterfaceName.method()</code> è°ƒç”¨ï¼Œä¸èƒ½é€šè¿‡å®ä¾‹è°ƒç”¨ã€‚</li></ul></li><li>Java 9 åŠä»¥åè¿˜å¯æœ‰ <code>private</code> æ–¹æ³•ï¼Œä¾›æ¥å£å†…éƒ¨å¤ç”¨å®ç°é€»è¾‘ã€‚</li></ul><hr><h2 id="23-Java-8-æ¥å£æ–°å¢äº†ä»€ä¹ˆï¼Ÿ"><a href="#23-Java-8-æ¥å£æ–°å¢äº†ä»€ä¹ˆï¼Ÿ" class="headerlink" title="23. Java 8 æ¥å£æ–°å¢äº†ä»€ä¹ˆï¼Ÿ"></a>23. Java 8 æ¥å£æ–°å¢äº†ä»€ä¹ˆï¼Ÿ</h2><ul><li>Java 8 åœ¨æ¥å£ä¸­æ–°å¢äº† <strong>default æ–¹æ³•</strong> å’Œ <strong>static æ–¹æ³•</strong>ï¼Œå…è®¸æ¥å£æä¾›å¸¦å®ç°çš„æ–¹æ³•ï¼Œä»è€Œä¾¿äºæ¥å£çš„æ¼”åŒ–ï¼ˆå‘åå…¼å®¹ï¼‰ã€‚è¿™ä¹Ÿæ˜¯ Java 8 å¼•å…¥å‡½æ•°å¼ç¼–ç¨‹æ”¯æŒçš„åŸºç¡€ä¹‹ä¸€ï¼ˆå…è®¸æ¥å£ä½œä¸ºå‡½æ•°å¼æ¥å£ï¼‰ã€‚</li></ul><hr><h2 id="24-Java-8-æœ‰ä»€ä¹ˆæ–°ç‰¹æ€§ï¼Œå¹¶è¯¦ç»†ä»‹ç»ï¼ˆé‡ç‚¹ï¼‰"><a href="#24-Java-8-æœ‰ä»€ä¹ˆæ–°ç‰¹æ€§ï¼Œå¹¶è¯¦ç»†ä»‹ç»ï¼ˆé‡ç‚¹ï¼‰" class="headerlink" title="24. Java 8 æœ‰ä»€ä¹ˆæ–°ç‰¹æ€§ï¼Œå¹¶è¯¦ç»†ä»‹ç»ï¼ˆé‡ç‚¹ï¼‰"></a>24. Java 8 æœ‰ä»€ä¹ˆæ–°ç‰¹æ€§ï¼Œå¹¶è¯¦ç»†ä»‹ç»ï¼ˆé‡ç‚¹ï¼‰</h2><hr><h1 id="ä¸€ã€Java-8-æ–°ç‰¹æ€§æ·±å…¥è§£æ"><a href="#ä¸€ã€Java-8-æ–°ç‰¹æ€§æ·±å…¥è§£æ" class="headerlink" title="ä¸€ã€Java 8 æ–°ç‰¹æ€§æ·±å…¥è§£æ"></a>ä¸€ã€Java 8 æ–°ç‰¹æ€§æ·±å…¥è§£æ</h1><h2 id="1-Lambda-è¡¨è¾¾å¼"><a href="#1-Lambda-è¡¨è¾¾å¼" class="headerlink" title="1. Lambda è¡¨è¾¾å¼"></a>1. Lambda è¡¨è¾¾å¼</h2><h3 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><ul><li>åŒ¿åå‡½æ•°ï¼Œå…è®¸æŠŠè¡Œä¸ºä½œä¸ºå‚æ•°ä¼ é€’ã€‚</li><li>ç®€åŒ–åŒ¿åå†…éƒ¨ç±»å†™æ³•ï¼Œå®ç°å‡½æ•°å¼ç¼–ç¨‹ã€‚</li></ul><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; list = Arrays.asList(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;bb&quot;</span>, <span class="string">&quot;ccc&quot;</span>);</span><br><span class="line">Collections.sort(list, (s1, s2) -&gt; s1.length() - s2.length());</span><br></pre></td></tr></table></figure><h3 id="åº•å±‚åŸç†"><a href="#åº•å±‚åŸç†" class="headerlink" title="åº•å±‚åŸç†"></a>åº•å±‚åŸç†</h3><ul><li>ç¼–è¯‘å™¨ç”Ÿæˆé™æ€&#x2F;å®ä¾‹æ–¹æ³• + <code>invokedynamic</code> æŒ‡ä»¤ã€‚</li><li>JVM è°ƒç”¨ <code>LambdaMetafactory</code> åŠ¨æ€ç”Ÿæˆå‡½æ•°å¯¹è±¡ï¼Œå®ç° <strong>å‡½æ•°å¼æ¥å£</strong>ã€‚</li><li>æ•è·å¤–éƒ¨å˜é‡é€šè¿‡é—­åŒ…æœºåˆ¶å­˜å‚¨ï¼ˆå¿…é¡»æ˜¯ <code>effectively final</code>ï¼‰ã€‚</li></ul><h3 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h3><ul><li>è¯­æ³•ç®€æ´</li><li>å¯ä½œä¸ºå‚æ•°ä¼ é€’è¡Œä¸º</li><li>æ€§èƒ½é«˜äºåŒ¿åå†…éƒ¨ç±»ï¼ˆå‡å°‘å¯¹è±¡åˆ›å»ºï¼‰</li></ul><hr><h2 id="2-å‡½æ•°å¼æ¥å£"><a href="#2-å‡½æ•°å¼æ¥å£" class="headerlink" title="2. å‡½æ•°å¼æ¥å£"></a>2. å‡½æ•°å¼æ¥å£</h2><h3 id="æ¦‚å¿µ-1"><a href="#æ¦‚å¿µ-1" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><ul><li>ä»…æœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•çš„æ¥å£ï¼Œç”¨ä½œ Lambda è¡¨è¾¾å¼çš„ç›®æ ‡ç±»å‹ã€‚</li><li>å¯ç”¨ <code>@FunctionalInterface</code> æ ‡è¯†ã€‚</li></ul><h3 id="ç¤ºä¾‹-1"><a href="#ç¤ºä¾‹-1" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@FunctionalInterface</span><br><span class="line">interface Converter&lt;F, T&gt; &#123;</span><br><span class="line">    T convert(F from);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Converter&lt;String, Integer&gt; c = Integer::valueOf;</span><br><span class="line">System.out.println(c.convert(&quot;123&quot;)); // 123</span><br></pre></td></tr></table></figure><h3 id="åº•å±‚åŸç†-1"><a href="#åº•å±‚åŸç†-1" class="headerlink" title="åº•å±‚åŸç†"></a>åº•å±‚åŸç†</h3><ul><li>Lambda è¡¨è¾¾å¼ç¼–è¯‘æ—¶ç”Ÿæˆå®ç°å‡½æ•°å¼æ¥å£çš„å‡½æ•°å¯¹è±¡ã€‚</li><li>æ•è·å˜é‡é€šè¿‡é—­åŒ…å¯¹è±¡ä¿å­˜ã€‚</li></ul><h3 id="ç‰¹ç‚¹-1"><a href="#ç‰¹ç‚¹-1" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h3><ul><li>ç®€åŒ–åŒ¿åç±»</li><li>æ”¯æŒå‡½æ•°å¼ç¼–ç¨‹</li><li>å¯ä¸ Stream &#x2F; Optional ç­‰ç»“åˆ</li></ul><hr><h2 id="3-Stream-API"><a href="#3-Stream-API" class="headerlink" title="3. Stream API"></a>3. Stream API</h2><h3 id="æ¦‚å¿µ-2"><a href="#æ¦‚å¿µ-2" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><ul><li>å¯¹é›†åˆè¿›è¡Œå£°æ˜å¼æ“ä½œï¼ˆè¿‡æ»¤ã€æ˜ å°„ã€å½’çº¦ï¼‰ã€‚</li><li>æ”¯æŒ <strong>æƒ°æ€§æ±‚å€¼</strong> å’Œ <strong>å¹¶è¡Œå¤„ç†</strong>ã€‚</li></ul><h3 id="ç¤ºä¾‹-2"><a href="#ç¤ºä¾‹-2" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; names = Arrays.asList(&quot;Alice&quot;, &quot;Bob&quot;, &quot;Charlie&quot;);</span><br><span class="line">List&lt;String&gt; filtered = names.stream()</span><br><span class="line">    .filter(s -&gt; s.length() &gt; 3)</span><br><span class="line">    .map(String::toUpperCase)</span><br><span class="line">    .collect(Collectors.toList());</span><br><span class="line">System.out.println(filtered); // [ALICE, CHARLIE]</span><br></pre></td></tr></table></figure><h3 id="åº•å±‚åŸç†-2"><a href="#åº•å±‚åŸç†-2" class="headerlink" title="åº•å±‚åŸç†"></a>åº•å±‚åŸç†</h3><ul><li>Stream æ˜¯æµæ°´çº¿å¯¹è±¡ï¼Œä¸­é—´æ“ä½œè¿”å›æ–°çš„ Streamï¼Œç»ˆç«¯æ“ä½œè§¦å‘è®¡ç®—ã€‚</li><li>ä¸²è¡Œæµï¼šé¡ºåºè¿­ä»£å™¨å¤„ç†</li><li>å¹¶è¡Œæµï¼šForkJoinPool åˆ†å—å¤„ç†</li></ul><h3 id="ç‰¹ç‚¹-2"><a href="#ç‰¹ç‚¹-2" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h3><ul><li>å£°æ˜å¼ã€é“¾å¼æ“ä½œ</li><li>æ”¯æŒå¹¶è¡Œ</li><li>å¯ä¸ Lambda &#x2F; æ–¹æ³•å¼•ç”¨ç»“åˆ</li></ul><hr><h2 id="4-æ–¹æ³•å¼•ç”¨"><a href="#4-æ–¹æ³•å¼•ç”¨" class="headerlink" title="4. æ–¹æ³•å¼•ç”¨"></a>4. æ–¹æ³•å¼•ç”¨</h2><h3 id="æ¦‚å¿µ-3"><a href="#æ¦‚å¿µ-3" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><ul><li>Lambda è¡¨è¾¾å¼çš„ç®€åŒ–å†™æ³•ï¼Œå¼•ç”¨ç°æœ‰æ–¹æ³•ã€‚</li><li>ç±»å‹ï¼š<ol><li>é™æ€æ–¹æ³•å¼•ç”¨ï¼š<code>ClassName::staticMethod</code></li><li>å®ä¾‹æ–¹æ³•å¼•ç”¨ï¼š<code>instance::method</code></li><li>æ„é€ å™¨å¼•ç”¨ï¼š<code>ClassName::new</code></li></ol></li></ul><h3 id="ç¤ºä¾‹-3"><a href="#ç¤ºä¾‹-3" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; names = Arrays.asList(&quot;a&quot;, &quot;bb&quot;, &quot;ccc&quot;);</span><br><span class="line">names.forEach(System.out::println); // å®ä¾‹æ–¹æ³•å¼•ç”¨</span><br><span class="line">Supplier&lt;List&lt;String&gt;&gt; listSupplier = ArrayList::new; // æ„é€ å™¨å¼•ç”¨</span><br></pre></td></tr></table></figure><h3 id="åº•å±‚åŸç†-3"><a href="#åº•å±‚åŸç†-3" class="headerlink" title="åº•å±‚åŸç†"></a>åº•å±‚åŸç†</h3><ul><li>ç¼–è¯‘å™¨è½¬æˆ Lambda è¡¨è¾¾å¼ + invokedynamicã€‚</li><li>JVM ç”Ÿæˆå®ç°å‡½æ•°å¼æ¥å£çš„å‡½æ•°å¯¹è±¡ï¼Œå†…éƒ¨æŒæœ‰æ–¹æ³•å¼•ç”¨ã€‚</li></ul><h3 id="ç‰¹ç‚¹-3"><a href="#ç‰¹ç‚¹-3" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h3><ul><li>ç®€æ´ç›´è§‚</li><li>å¯å‡å°‘ Lambda ä»£ç </li><li>ä¸ Stream &#x2F; Optional é…åˆä½¿ç”¨</li></ul><hr><h2 id="5-java-time-API"><a href="#5-java-time-API" class="headerlink" title="5. java.time API"></a>5. java.time API</h2><h3 id="æ¦‚å¿µ-4"><a href="#æ¦‚å¿µ-4" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><ul><li>æ›¿ä»£ <code>Date</code> &#x2F; <code>Calendar</code>ï¼Œä¸å¯å˜ã€çº¿ç¨‹å®‰å…¨ã€‚</li><li>æ ¸å¿ƒç±»ï¼š<ul><li><code>LocalDate</code> &#x2F; <code>LocalTime</code> &#x2F; <code>LocalDateTime</code>ï¼ˆæ— æ—¶åŒºï¼‰</li><li><code>ZonedDateTime</code>ï¼ˆå¸¦æ—¶åŒºï¼‰</li><li><code>Duration</code> &#x2F; <code>Period</code>ï¼ˆæ—¶é—´æ®µï¼‰</li></ul></li></ul><h3 id="ç¤ºä¾‹-4"><a href="#ç¤ºä¾‹-4" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">LocalDate today = LocalDate.now();</span><br><span class="line">LocalDate tomorrow = today.plusDays(1);</span><br><span class="line">ZonedDateTime zdt = ZonedDateTime.now(ZoneId.of(&quot;Asia/Singapore&quot;));</span><br><span class="line">System.out.println(tomorrow);</span><br><span class="line">System.out.println(zdt);</span><br></pre></td></tr></table></figure><h3 id="åº•å±‚åŸç†-4"><a href="#åº•å±‚åŸç†-4" class="headerlink" title="åº•å±‚åŸç†"></a>åº•å±‚åŸç†</h3><ul><li>å†…éƒ¨å­—æ®µ <code>final</code> ä¿å­˜å€¼ï¼Œä¸å¯å˜ã€‚</li><li>å·¥å‚æ–¹æ³•åˆ›å»ºå¯¹è±¡ï¼Œé“¾å¼æ“ä½œè¿”å›æ–°å¯¹è±¡ã€‚</li><li>ä½¿ç”¨ enum + æ•´å‹&#x2F;å­—èŠ‚ä¼˜åŒ–å­˜å‚¨ï¼ˆå¦‚ LocalDate å¹´æœˆæ—¥ç”¨ intï¼‰ã€‚</li></ul><h3 id="ç‰¹ç‚¹-4"><a href="#ç‰¹ç‚¹-4" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h3><ul><li>ä¸å¯å˜ï¼Œçº¿ç¨‹å®‰å…¨</li><li>é“¾å¼æ“ä½œï¼Œæ˜“ç»„åˆ</li><li>æ”¯æŒå„ç§å†æ³•å’Œæ—¶åŒºè®¡ç®—</li></ul><hr><h2 id="6-Optional"><a href="#6-Optional" class="headerlink" title="6. Optional"></a>6. Optional</h2><h3 id="æ¦‚å¿µ-5"><a href="#æ¦‚å¿µ-5" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><ul><li>å®¹å™¨å¯¹è±¡ï¼Œé˜²æ­¢ <code>NullPointerException</code>ã€‚</li><li>å¯ä»¥åŒ…å«å€¼æˆ–ä¸ºç©ºï¼ˆemptyï¼‰ã€‚</li></ul><h3 id="ç¤ºä¾‹-5"><a href="#ç¤ºä¾‹-5" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Optional&lt;String&gt; opt1 = Optional.of(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">Optional&lt;String&gt; opt2 = Optional.ofNullable(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">System.out.println(opt1.isPresent()); <span class="comment">// true</span></span><br><span class="line">System.out.println(opt2.orElse(<span class="string">&quot;Default&quot;</span>)); <span class="comment">// Default</span></span><br><span class="line">opt1.map(String::toUpperCase).ifPresent(System.out::println); <span class="comment">// HELLO</span></span><br></pre></td></tr></table></figure><h3 id="åº•å±‚åŸç†-5"><a href="#åº•å±‚åŸç†-5" class="headerlink" title="åº•å±‚åŸç†"></a>åº•å±‚åŸç†</h3><ul><li>å†…éƒ¨ <code>value</code> å­—æ®µå­˜å‚¨éç©ºå€¼ï¼Œç©ºå€¼ä½¿ç”¨å•ä¾‹ <code>EMPTY</code>ã€‚</li><li><code>map</code> &#x2F; <code>flatMap</code> &#x2F; <code>filter</code> è¿”å›æ–°çš„ Optionalï¼Œå¯¹è±¡ä¸å¯å˜ã€‚</li><li>ä¸ Lambda &#x2F; å‡½æ•°å¼æ¥å£ç»“åˆå®ç°é“¾å¼å®‰å…¨æ“ä½œã€‚</li></ul><h3 id="ç‰¹ç‚¹-5"><a href="#ç‰¹ç‚¹-5" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h3><ul><li>é¿å…æ˜¾å¼ null åˆ¤æ–­</li><li>æ”¯æŒé“¾å¼è°ƒç”¨</li><li>å¯ä¸ Stream &#x2F; Lambda é…åˆ</li></ul><hr><h2 id="Java-8-å…­å¤§æ ¸å¿ƒç‰¹æ€§åº•å±‚å¯¹æ¯”è¡¨"><a href="#Java-8-å…­å¤§æ ¸å¿ƒç‰¹æ€§åº•å±‚å¯¹æ¯”è¡¨" class="headerlink" title="Java 8 å…­å¤§æ ¸å¿ƒç‰¹æ€§åº•å±‚å¯¹æ¯”è¡¨"></a>Java 8 å…­å¤§æ ¸å¿ƒç‰¹æ€§åº•å±‚å¯¹æ¯”è¡¨</h2><table><thead><tr><th>ç‰¹æ€§</th><th>åº•å±‚å®ç°</th><th>æ ¸å¿ƒåŸç†</th><th>ä¼˜åŠ¿</th></tr></thead><tbody><tr><td>Lambda</td><td>invokedynamic + LambdaMetafactory</td><td>åŠ¨æ€ç”Ÿæˆå‡½æ•°å¯¹è±¡</td><td>ç®€æ´ã€æ€§èƒ½é«˜</td></tr><tr><td>å‡½æ•°å¼æ¥å£</td><td>å•æŠ½è±¡æ–¹æ³•æ¥å£</td><td>æ•è·å˜é‡é€šè¿‡é—­åŒ…å­˜å‚¨</td><td>ç®€åŒ–åŒ¿åç±»ï¼Œå‡½æ•°å¼ç¼–ç¨‹</td></tr><tr><td>Stream API</td><td>æµæ°´çº¿ + å»¶è¿Ÿæ±‚å€¼</td><td>ä¸­é—´æ“ä½œæƒ°æ€§ï¼Œç»ˆç«¯è§¦å‘</td><td>å£°æ˜å¼ã€å¯å¹¶è¡Œ</td></tr><tr><td>æ–¹æ³•å¼•ç”¨</td><td>Lambda ç®€åŒ–è¯­æ³• + invokedynamic</td><td>å†…éƒ¨æŒæœ‰æ–¹æ³•å¼•ç”¨</td><td>ç®€æ´ç›´è§‚ï¼Œå‡å°‘ä»£ç </td></tr><tr><td>java.time</td><td>ä¸å¯å˜å¯¹è±¡ + å·¥å‚æ–¹æ³•</td><td>finalå­—æ®µä¿å­˜å€¼ï¼Œé“¾å¼è¿”å›æ–°å¯¹è±¡</td><td>çº¿ç¨‹å®‰å…¨ï¼Œå¯ç»„åˆ</td></tr><tr><td>Optional</td><td>åŒ…è£…å¯¹è±¡ + å•ä¾‹ EMPTY</td><td>ä¸å¯å˜å®¹å™¨ï¼Œå‡½æ•°å¼é“¾å¼è°ƒç”¨</td><td>é¿å… NPEï¼Œå®‰å…¨é“¾å¼æ“ä½œ</td></tr></tbody></table><hr><h1 id="äºŒã€synchronized-åº•å±‚åŸç†æ·±å…¥è§£æ"><a href="#äºŒã€synchronized-åº•å±‚åŸç†æ·±å…¥è§£æ" class="headerlink" title="äºŒã€synchronized åº•å±‚åŸç†æ·±å…¥è§£æ"></a>äºŒã€synchronized åº•å±‚åŸç†æ·±å…¥è§£æ</h1><h2 id="1-JVM-é”çš„ç±»å‹"><a href="#1-JVM-é”çš„ç±»å‹" class="headerlink" title="1. JVM é”çš„ç±»å‹"></a>1. JVM é”çš„ç±»å‹</h2><table><thead><tr><th>é”ç±»å‹</th><th>ç‰¹ç‚¹</th><th>æ€§èƒ½</th></tr></thead><tbody><tr><td>åå‘é” (Biased Lock)</td><td>æ— ç«äº‰æ—¶åå‘ç¬¬ä¸€ä¸ªçº¿ç¨‹ï¼Œè½»é‡</td><td>é«˜</td></tr><tr><td>è½»é‡çº§é” (Lightweight)</td><td>ç«äº‰å°‘æ—¶ä½¿ç”¨ CAS å‡çº§é”</td><td>ä¸­</td></tr><tr><td>é‡é‡çº§é” (Monitor)</td><td>é«˜ç«äº‰æ—¶ä½¿ç”¨ OS mutexï¼Œé˜»å¡çº¿ç¨‹</td><td>ä½</td></tr></tbody></table><hr><h2 id="2-synchronized-å¯¹è±¡å¤´ç»“æ„"><a href="#2-synchronized-å¯¹è±¡å¤´ç»“æ„" class="headerlink" title="2. synchronized å¯¹è±¡å¤´ç»“æ„"></a>2. synchronized å¯¹è±¡å¤´ç»“æ„</h2><ul><li>æ¯ä¸ªå¯¹è±¡åœ¨ JVM å†…å­˜ä¸­éƒ½æœ‰ <strong>å¯¹è±¡å¤´ï¼ˆMark Wordï¼‰</strong>ï¼Œå­˜å‚¨é”ä¿¡æ¯ã€å“ˆå¸Œç ã€GC æ ‡è®°ç­‰ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">å¯¹è±¡å¤´ Mark Word (32/64bit)</span><br><span class="line">+----------------+----------------+----------------+</span><br><span class="line">| HashCode       | GC info        | Lock info      |</span><br><span class="line">+----------------+----------------+----------------+</span><br></pre></td></tr></table></figure><ul><li><strong>é”æ ‡è®°ä½</strong>ï¼š<ul><li>00ï¼šæ— é”</li><li>01ï¼šåå‘é”</li><li>10ï¼šè½»é‡çº§é”</li><li>11ï¼šé‡é‡çº§é”</li></ul></li></ul><hr><h2 id="3-synchronized-æ‰§è¡Œæµç¨‹"><a href="#3-synchronized-æ‰§è¡Œæµç¨‹" class="headerlink" title="3. synchronized æ‰§è¡Œæµç¨‹"></a>3. synchronized æ‰§è¡Œæµç¨‹</h2><h3 id="a-åå‘é”ï¼ˆæ— ç«äº‰ï¼‰"><a href="#a-åå‘é”ï¼ˆæ— ç«äº‰ï¼‰" class="headerlink" title="a) åå‘é”ï¼ˆæ— ç«äº‰ï¼‰"></a>a) åå‘é”ï¼ˆæ— ç«äº‰ï¼‰</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">çº¿ç¨‹è·å–é” -&gt; åœ¨å¯¹è±¡å¤´æ‰“ä¸Šçº¿ç¨‹ID -&gt; æ‰§è¡Œ -&gt; é‡Šæ”¾é” -&gt; ä¿æŒåå‘çŠ¶æ€</span><br></pre></td></tr></table></figure><h3 id="b-è½»é‡çº§é”ï¼ˆCASç«äº‰ï¼‰"><a href="#b-è½»é‡çº§é”ï¼ˆCASç«äº‰ï¼‰" class="headerlink" title="b) è½»é‡çº§é”ï¼ˆCASç«äº‰ï¼‰"></a>b) è½»é‡çº§é”ï¼ˆCASç«äº‰ï¼‰</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">çº¿ç¨‹å°è¯•CASæŠ¢é” -&gt; æˆåŠŸï¼šæŒæœ‰é” -&gt; æ‰§è¡Œ -&gt; é‡Šæ”¾</span><br><span class="line">                      |-&gt; å¤±è´¥ï¼šå‡çº§ä¸ºé‡é‡çº§é”</span><br></pre></td></tr></table></figure><h3 id="c-é‡é‡çº§é”ï¼ˆé˜»å¡ï¼‰"><a href="#c-é‡é‡çº§é”ï¼ˆé˜»å¡ï¼‰" class="headerlink" title="c) é‡é‡çº§é”ï¼ˆé˜»å¡ï¼‰"></a>c) é‡é‡çº§é”ï¼ˆé˜»å¡ï¼‰</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">çº¿ç¨‹æ— æ³•è·å–é” -&gt; é˜»å¡ï¼ˆOSç­‰å¾…é˜Ÿåˆ—ï¼‰ -&gt; è¢«å”¤é†’ -&gt; è·å–é” -&gt; æ‰§è¡Œ -&gt; é‡Šæ”¾é”</span><br></pre></td></tr></table></figure><h3 id="å›¾ç¤º"><a href="#å›¾ç¤º" class="headerlink" title="å›¾ç¤º"></a>å›¾ç¤º</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+------------------+</span><br><span class="line">|  synchronized()  |</span><br><span class="line">+------------------+</span><br><span class="line">          |</span><br><span class="line">    JVMå¯¹è±¡å¤´Mark Word</span><br><span class="line">          |</span><br><span class="line">+------------------------+</span><br><span class="line">| åå‘é” -&gt; è½»é‡çº§é” -&gt; é‡é‡çº§é”</span><br><span class="line">+------------------------+</span><br></pre></td></tr></table></figure><hr><h2 id="4-synchronized-æ–¹æ³•ç¤ºä¾‹"><a href="#4-synchronized-æ–¹æ³•ç¤ºä¾‹" class="headerlink" title="4. synchronized æ–¹æ³•ç¤ºä¾‹"></a>4. synchronized æ–¹æ³•ç¤ºä¾‹</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Counter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">increment</span><span class="params">()</span> &#123;</span><br><span class="line">        count++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>é”å¯¹è±¡</strong>ï¼šå®ä¾‹æ–¹æ³•é”ä½ <code>this</code>ï¼Œé™æ€æ–¹æ³•é”ä½ç±»å¯¹è±¡ <code>ClassName.class</code>ã€‚</li><li><strong>æ•ˆæœ</strong>ï¼šåŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½è¿›å…¥ <code>increment()</code>ï¼Œä¿è¯ <code>count++</code> æ“ä½œçš„åŸå­æ€§ã€‚</li></ul><hr><h2 id="5-JVM-ä¼˜åŒ–"><a href="#5-JVM-ä¼˜åŒ–" class="headerlink" title="5. JVM ä¼˜åŒ–"></a>5. JVM ä¼˜åŒ–</h2><ul><li><strong>é”æ¶ˆé™¤</strong>ï¼šç¼–è¯‘å™¨æˆ– JIT å¯æ£€æµ‹æ— ç«äº‰æƒ…å†µï¼Œæ¶ˆé™¤åŒæ­¥é”ã€‚</li><li><strong>é”ç²—åŒ–</strong>ï¼šæŠŠå¤šæ¬¡è¿ç»­çš„å°èŒƒå›´é”åˆå¹¶ï¼Œå‡å°‘åŠ é”æ¬¡æ•°ã€‚</li><li><strong>åå‘é” &#x2F; è½»é‡çº§é” &#x2F; é‡é‡çº§é”å‡çº§</strong>ï¼šåŠ¨æ€é€‚åº”ç«äº‰æƒ…å†µï¼Œå…¼é¡¾æ€§èƒ½ä¸æ­£ç¡®æ€§ã€‚</li></ul><h2 id="25-å¤šæ€çš„å®ç°æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#25-å¤šæ€çš„å®ç°æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="25.å¤šæ€çš„å®ç°æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿ"></a>25.å¤šæ€çš„å®ç°æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿ</h2><ul><li><strong>æ¦‚å¿µ</strong>ï¼šåŒä¸€æ“ä½œä½œç”¨äºä¸åŒå¯¹è±¡æ—¶è¡¨ç°å‡ºä¸åŒçš„è¡Œä¸ºï¼ˆä¸»è¦è¡¨ç°ä¸ºæ–¹æ³•çš„åŠ¨æ€ç»‘å®šï¼‰ã€‚</li><li><strong>å®ç°æœºåˆ¶</strong>ï¼š<ul><li><strong>ç¼–è¯‘æ—¶</strong>ï¼šæ ¹æ®å¼•ç”¨ç±»å‹æ£€æŸ¥æ–¹æ³•ç­¾åï¼ˆé™æ€ç±»å‹æ£€æŸ¥ï¼‰ã€‚</li><li><strong>è¿è¡Œæ—¶</strong>ï¼šå®é™…è°ƒç”¨çš„æ–¹æ³•æ ¹æ®å¯¹è±¡çš„å®é™…ç±»å‹ï¼ˆè¿è¡Œæ—¶ç±»å‹ï¼‰å†³å®šï¼›å³ <strong>åŠ¨æ€ç»‘å®šï¼ˆdynamic dispatchï¼‰</strong>ã€‚</li><li>JVM é€šå¸¸é€šè¿‡ <strong>è™šæ–¹æ³•è¡¨ï¼ˆvtableï¼‰&#x2F;æ–¹æ³•æŸ¥æ‰¾æœºåˆ¶</strong> å®ç°ã€‚è°ƒç”¨ä¸€ä¸ªé <code>static</code>ã€é <code>private</code>ã€é <code>final</code> çš„æ–¹æ³•æ—¶ï¼Œä¼šåœ¨è¿è¡Œæ—¶æŸ¥æ‰¾å®é™…ç±»çš„å®ç°å¹¶è°ƒç”¨ã€‚</li></ul></li><li><strong>ç»“æœ</strong>ï¼šå­ç±»å¯ä»¥è¦†ç›–çˆ¶ç±»æ–¹æ³•ï¼Œè°ƒç”¨è€…ä½¿ç”¨çˆ¶ç±»å¼•ç”¨æŒ‡å‘å­ç±»å¯¹è±¡æ—¶ï¼Œè°ƒç”¨çš„æ˜¯å­ç±»çš„è¦†ç›–æ–¹æ³•ï¼ˆè¿è¡Œæ—¶å†³å®šï¼‰ã€‚</li><li><strong>æ³¨æ„</strong>ï¼š<code>static</code>ã€<code>private</code>ã€<code>final</code> æ–¹æ³•ä¸ä¼šè¢«åŠ¨æ€ç»‘å®šï¼ˆæ˜¯é™æ€ç»‘å®šï¼‰ã€‚</li></ul><hr><h2 id="26-æ–¹æ³•é‡è½½ï¼ˆoverloadï¼‰å’Œæ–¹æ³•é‡å†™ï¼ˆoverrideï¼‰çš„åŒºåˆ«ï¼Ÿ"><a href="#26-æ–¹æ³•é‡è½½ï¼ˆoverloadï¼‰å’Œæ–¹æ³•é‡å†™ï¼ˆoverrideï¼‰çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="26. æ–¹æ³•é‡è½½ï¼ˆoverloadï¼‰å’Œæ–¹æ³•é‡å†™ï¼ˆoverrideï¼‰çš„åŒºåˆ«ï¼Ÿ"></a>26. æ–¹æ³•é‡è½½ï¼ˆoverloadï¼‰å’Œæ–¹æ³•é‡å†™ï¼ˆoverrideï¼‰çš„åŒºåˆ«ï¼Ÿ</h2><ul><li><p><strong>æ–¹æ³•é‡è½½ï¼ˆOverloadingï¼‰</strong>ï¼š</p><ul><li>åŒä¸€ç±»ä¸­æ–¹æ³•åç›¸åŒã€å‚æ•°åˆ—è¡¨ä¸åŒï¼ˆå‚æ•°ç±»å‹&#x2F;ä¸ªæ•°&#x2F;é¡ºåºï¼‰ï¼Œè¿”å›ç±»å‹å¯ä»¥ä¸åŒã€‚</li><li>ç¼–è¯‘æ—¶å†³å®šï¼ˆé‡è½½è§£æåœ¨ç¼–è¯‘æœŸå®Œæˆï¼‰ï¼Œä¸ç»§æ‰¿å…³ç³»æ— å…³ã€‚</li></ul></li><li><p><strong>æ–¹æ³•é‡å†™ï¼ˆOverridingï¼‰</strong>ï¼š</p><ul><li>å­ç±»å®šä¹‰ä¸çˆ¶ç±»ç›¸åŒæ–¹æ³•ç­¾åï¼ˆæ–¹æ³•å + å‚æ•°ç±»å‹ç›¸åŒï¼‰çš„å®ç°ï¼Œç›®çš„æ˜¯æ”¹å˜&#x2F;æ‰©å±•çˆ¶ç±»è¡Œä¸ºã€‚</li><li>è¿è¡Œæ—¶åŠ¨æ€ç»‘å®šï¼Œå¿…é¡»æ»¡è¶³è®¿é—®æƒé™ä¸èƒ½æ›´ä¸¥æ ¼ï¼ŒæŠ›å‡ºçš„å—æ£€å¼‚å¸¸ä¸èƒ½è¶…è¿‡çˆ¶ç±»ç‰ˆæœ¬ç­‰è§„åˆ™ã€‚</li></ul></li><li><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// overload</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">f</span><span class="params">(<span class="type">int</span> x)</span> &#123;&#125;</span><br><span class="line"><span class="keyword">void</span> <span class="title function_">f</span><span class="params">(String s)</span> &#123;&#125;</span><br><span class="line"><span class="comment">// override</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> &#123; <span class="keyword">void</span> <span class="title function_">m</span><span class="params">()</span> &#123;&#125; &#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span> <span class="keyword">extends</span> <span class="title class_">A</span> &#123; <span class="meta">@Override</span> <span class="keyword">void</span> <span class="title function_">m</span><span class="params">()</span> &#123;&#125; &#125;</span><br></pre></td></tr></table></figure></li></ul><hr><h2 id="27-Java-æ”¯æŒå¤šç»§æ‰¿å—ï¼Ÿå¦‚ä½•å®ç°ç±»ä¼¼æ•ˆæœï¼Ÿ"><a href="#27-Java-æ”¯æŒå¤šç»§æ‰¿å—ï¼Ÿå¦‚ä½•å®ç°ç±»ä¼¼æ•ˆæœï¼Ÿ" class="headerlink" title="27. Java æ”¯æŒå¤šç»§æ‰¿å—ï¼Ÿå¦‚ä½•å®ç°ç±»ä¼¼æ•ˆæœï¼Ÿ"></a>27. Java æ”¯æŒå¤šç»§æ‰¿å—ï¼Ÿå¦‚ä½•å®ç°ç±»ä¼¼æ•ˆæœï¼Ÿ</h2><ul><li><strong>ç±»çš„å¤šç»§æ‰¿</strong>ï¼šJava <strong>ä¸æ”¯æŒç±»çš„å¤šç»§æ‰¿</strong>ï¼ˆä¸èƒ½ç»§æ‰¿å¤šä¸ªç±»ï¼‰ï¼Œä»¥é¿å…è±å½¢ç»§æ‰¿é—®é¢˜ï¼ˆdiamond problemï¼‰ã€‚</li><li><strong>å®ç°ç±»ä¼¼æ•ˆæœçš„æ–¹æ³•</strong>ï¼š<ul><li><strong>æ¥å£å¤šå®ç°</strong>ï¼šä¸€ä¸ªç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£ï¼ˆJava 8 çš„ <code>default</code> æ–¹æ³•ä¹Ÿå¸¦æ¥ç±»ä¼¼å¤šç»§æ‰¿æ–¹æ³•å®ç°çš„å¯èƒ½ï¼Œä½†æœ‰å†²çªè§£å†³è§„åˆ™ï¼‰ã€‚</li><li><strong>ç»„åˆ&#x2F;å§”æ‰˜ï¼ˆcomposition&#x2F;delegationï¼‰</strong>ï¼šåœ¨ç±»ä¸­æŒæœ‰å…¶å®ƒç±»çš„å®ä¾‹å¹¶æŠŠè°ƒç”¨å§”æ‰˜ç»™å®ƒä»¬ï¼ˆä¼˜äºç»§æ‰¿çš„é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™ï¼‰ã€‚</li></ul></li><li><strong>æ¥å£å†²çªè§£å†³</strong>ï¼šè‹¥å¤šä¸ªæ¥å£æä¾›ç›¸åŒé»˜è®¤æ–¹æ³•ï¼Œç±»å¿…é¡»é‡å†™è¯¥æ–¹æ³•å¹¶æ˜ç¡®è°ƒç”¨å“ªä¸ªæ¥å£çš„é»˜è®¤å®ç°ï¼ˆ<code>InterfaceName.super.method()</code>ï¼‰ã€‚</li></ul><hr><h2 id="28-Java-çš„å››ç§è®¿é—®ä¿®é¥°ç¬¦ï¼Ÿ"><a href="#28-Java-çš„å››ç§è®¿é—®ä¿®é¥°ç¬¦ï¼Ÿ" class="headerlink" title="28. Java çš„å››ç§è®¿é—®ä¿®é¥°ç¬¦ï¼Ÿ"></a>28. Java çš„å››ç§è®¿é—®ä¿®é¥°ç¬¦ï¼Ÿ</h2><ul><li><code>public</code>ï¼šå¯¹æ‰€æœ‰ç±»å¯è§ï¼ˆä»»ä½•åŒ…ï¼‰ã€‚</li><li><code>protected</code>ï¼šå¯¹åŒåŒ…ç±»å’Œå­ç±»å¯è§ï¼ˆå³åŒåŒ…æˆ–å­ç±»å¯ä»¥è®¿é—®ï¼‰ã€‚</li><li><strong>é»˜è®¤ï¼ˆåŒ…ç§æœ‰ï¼Œpackage-privateï¼‰</strong>ï¼ˆä¸å†™ä¿®é¥°ç¬¦ï¼‰ï¼šå¯¹åŒåŒ…ç±»å¯è§ï¼ŒåŒ…å¤–ä¸å¯è§ã€‚</li><li><code>private</code>ï¼šä»…åœ¨æœ¬ç±»å†…å¯è§ï¼ŒåŒ…å¤–&#x2F;å­ç±»ä¸å¯è®¿é—®ï¼ˆå­ç±»æ— æ³•ç›´æ¥è®¿é—®çˆ¶ç±» private æˆå‘˜ï¼‰ã€‚</li><li><strong>æ³¨æ„</strong>ï¼šå¯¹ç±»ï¼ˆé¡¶å±‚ç±»ï¼‰åªèƒ½ä½¿ç”¨ <code>public</code> æˆ–é»˜è®¤ï¼ˆåŒ…ç§æœ‰ï¼‰ï¼Œä¸èƒ½å£°æ˜ä¸º <code>private</code>&#x2F;<code>protected</code>ã€‚</li></ul><hr><h2 id="29-transient-å…³é”®å­—çš„ä½œç”¨ï¼Ÿ"><a href="#29-transient-å…³é”®å­—çš„ä½œç”¨ï¼Ÿ" class="headerlink" title="29. transient å…³é”®å­—çš„ä½œç”¨ï¼Ÿ"></a>29. <code>transient</code> å…³é”®å­—çš„ä½œç”¨ï¼Ÿ</h2><ul><li>ç”¨äºæ ‡è®°å­—æ®µåœ¨ Java åºåˆ—åŒ–ï¼ˆ<code>Serializable</code>ï¼‰è¿‡ç¨‹ä¸­<strong>ä¸è¢«åºåˆ—åŒ–</strong>ã€‚</li><li>è¢«æ ‡è®°ä¸º <code>transient</code> çš„å­—æ®µåœ¨åºåˆ—åŒ–åä¸ä¼šå†™å…¥åºåˆ—åŒ–æµï¼Œååºåˆ—åŒ–æ—¶è¿™äº›å­—æ®µä¼šä»¥é»˜è®¤å€¼æ¢å¤ï¼ˆåŸºæœ¬ç±»å‹ 0ï¼Œå¼•ç”¨ç±»å‹ <code>null</code>ï¼‰ã€‚</li><li>å¸¸ç”¨äºæ•æ„Ÿä¿¡æ¯ï¼ˆå¯†ç ï¼‰ã€ä¸éœ€è¦æŒä¹…åŒ–çš„ç¼“å­˜å­—æ®µã€æˆ–å¯é‡å»ºçš„çŠ¶æ€å­—æ®µã€‚</li><li>æ³¨æ„ï¼š<code>static</code> å­—æ®µæœ¬èº«ä¹Ÿä¸ä¼šè¢«åºåˆ—åŒ–ï¼ˆå› ä¸ºæ˜¯ç±»çº§åˆ«ï¼Œä¸å±äºå®ä¾‹çŠ¶æ€ï¼‰ã€‚</li></ul><hr><h2 id="30-volatile-å…³é”®å­—çš„ä½œç”¨ï¼Ÿ"><a href="#30-volatile-å…³é”®å­—çš„ä½œç”¨ï¼Ÿ" class="headerlink" title="30. volatile å…³é”®å­—çš„ä½œç”¨ï¼Ÿ"></a>30. <code>volatile</code> å…³é”®å­—çš„ä½œç”¨ï¼Ÿ</h2><ul><li><strong>å¯è§æ€§</strong>ï¼šä¿è¯å¯¹ <code>volatile</code> å˜é‡çš„å†™å…¥å¯¹å…¶å®ƒçº¿ç¨‹ç«‹å³å¯è§ï¼ˆè¯»å–æ€»æ˜¯ä»ä¸»å†…å­˜è€Œä¸æ˜¯çº¿ç¨‹ç¼“å­˜è¯»å–ï¼‰ã€‚</li><li><strong>ç¦æ­¢æŒ‡ä»¤é‡æ’åºï¼ˆéƒ¨åˆ†ï¼‰</strong>ï¼šè¯»&#x2F;å†™ <code>volatile</code> å­˜åœ¨çš„å†…å­˜å±éšœèƒ½ä¿è¯ä¸€å®šçš„æœ‰åºæ€§ï¼ˆå†™ <code>volatile</code> å‘ç”Ÿåœ¨åç»­è¯»çš„å¯è§æ€§ä¸Šï¼Œæ›´å¤šç»†èŠ‚å‚è€ƒ JMMï¼‰ã€‚</li><li><strong>ä¸ä¿è¯åŸå­æ€§</strong>ï¼šå¯¹å•æ¬¡è¯»&#x2F;å†™æ“ä½œæ˜¯åŸå­çš„ï¼ˆå¯¹ <code>long</code>&#x2F;<code>double</code> åœ¨ Java 5 åä¹Ÿä¿è¯åŸå­ï¼‰ï¼Œä½†éåŸå­æ“ä½œï¼ˆå¦‚ <code>i++</code>ï¼‰ä¸æ˜¯åŸå­çš„ã€‚</li><li><strong>å…¸å‹ç”¨é€”</strong>ï¼š<ul><li>çŠ¶æ€æ ‡å¿—ï¼ˆå¦‚ <code>volatile boolean running</code>ï¼‰ã€‚</li><li>ç”¨äºå®ç°åŒé‡æ£€æŸ¥é”å®šï¼ˆDCLï¼‰å•ä¾‹ä¸­çš„ <code>instance</code>ï¼ˆåœ¨ Java 5+ ç¯å¢ƒä¸‹æœ‰æ•ˆï¼‰ã€‚</li></ul></li><li><strong>ä¸ synchronized æ¯”è¾ƒ</strong>ï¼š<ul><li><code>volatile</code> è½»é‡ï¼Œåªä¿è¯å¯è§æ€§ä¸éƒ¨åˆ†æœ‰åºæ€§ï¼Œä¸ä¿è¯äº’æ–¥ï¼›é€‚ç”¨äºç®€å•çŠ¶æ€é€šä¿¡ã€‚</li><li><code>synchronized</code> æä¾›äº’æ–¥å’Œå¯è§æ€§ä¿è¯ï¼ˆæ›´é‡ï¼‰ï¼Œå¹¶å¯é…åˆ <code>wait/notify</code>ã€‚</li></ul></li></ul><hr><h2 id="31-synchronized-çš„ä½œç”¨åŠåº•å±‚åŸç†ï¼Ÿ"><a href="#31-synchronized-çš„ä½œç”¨åŠåº•å±‚åŸç†ï¼Ÿ" class="headerlink" title="31. synchronized çš„ä½œç”¨åŠåº•å±‚åŸç†ï¼Ÿ"></a>31. <code>synchronized</code> çš„ä½œç”¨åŠåº•å±‚åŸç†ï¼Ÿ</h2><h3 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h3><ul><li><strong>äº’æ–¥ï¼ˆæ’å®ƒï¼‰</strong>ï¼šä¿è¯åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ‰§è¡Œè¢« <code>synchronized</code> ä¿®é¥°çš„ä»£ç å—æˆ–æ–¹æ³•ï¼ˆé’ˆå¯¹åŒä¸€æŠŠé”ï¼‰ã€‚</li><li><strong>å¯è§æ€§</strong>ï¼šè¿›å…¥&#x2F;é€€å‡ºåŒæ­¥å—ä¼šå»ºç«‹ happens-before å…³ç³»ï¼Œç¡®ä¿é”é‡Šæ”¾å‰çš„å†™å¯¹éšåè·å–è¯¥é”çš„çº¿ç¨‹å¯è§ã€‚</li><li><strong>ç”¨é€”</strong>ï¼šä¿æŠ¤ä¸´ç•ŒåŒºã€ç¡®ä¿å¤šä¸ªçº¿ç¨‹å¯¹å…±äº«å¯å˜çŠ¶æ€çš„å®‰å…¨è®¿é—®ã€‚</li></ul><h3 id="ä½¿ç”¨æ–¹å¼"><a href="#ä½¿ç”¨æ–¹å¼" class="headerlink" title="ä½¿ç”¨æ–¹å¼"></a>ä½¿ç”¨æ–¹å¼</h3><ul><li><strong>æ–¹æ³•çº§åˆ«</strong>ï¼š<ul><li><code>synchronized void m() &#123; ... &#125;</code>ï¼šç­‰ä»·äº <code>synchronized(this)</code>ï¼ˆå®ä¾‹æ–¹æ³•ï¼‰æˆ– <code>synchronized (ClassName.class)</code>ï¼ˆé™æ€æ–¹æ³•ï¼‰ã€‚</li></ul></li><li><strong>ä»£ç å—çº§åˆ«</strong>ï¼š<ul><li><code>synchronized(this) &#123; ... &#125;</code> æˆ– <code>synchronized(lockObj) &#123; ... &#125;</code> æ›´çµæ´»ï¼Œèƒ½å‡å°é”çš„ç²’åº¦ã€‚</li></ul></li></ul><h3 id="åº•å±‚åŸç†ï¼ˆHotSpot-å®ç°æ¦‚è¦ï¼‰"><a href="#åº•å±‚åŸç†ï¼ˆHotSpot-å®ç°æ¦‚è¦ï¼‰" class="headerlink" title="åº•å±‚åŸç†ï¼ˆHotSpot å®ç°æ¦‚è¦ï¼‰"></a>åº•å±‚åŸç†ï¼ˆHotSpot å®ç°æ¦‚è¦ï¼‰</h3><ul><li>JVM ä½¿ç”¨å¯¹è±¡å¤´ï¼ˆobject headerï¼‰ä¸­çš„ <strong>mark word</strong> å’Œå…³è”æ•°æ®ç»“æ„ç»´æŠ¤é”çŠ¶æ€ã€‚</li><li>é”ä¼˜åŒ–ç­–ç•¥ï¼ˆä¸ºæå‡æ€§èƒ½ï¼ŒHotSpot å¼•å…¥è‹¥å¹²ä¼˜åŒ–ï¼‰ï¼š<ol><li><strong>åå‘é”ï¼ˆBiased Lockingï¼‰</strong>ï¼šåœ¨æ²¡æœ‰ç«äº‰çš„æƒ…å†µä¸‹ï¼Œé”ä¼šåå‘äºç¬¬ä¸€æ¬¡è·å¾—å®ƒçš„çº¿ç¨‹ï¼Œé‡å¤è·å–æ— éœ€ CASï¼Œå‡å°‘å¼€é”€ã€‚</li><li><strong>è½»é‡çº§é”ï¼ˆLightweight Lockingï¼‰</strong>ï¼šä½¿ç”¨ CAS æ“ä½œåœ¨æ ˆä¸Šè®°å½•åŠ é”è®°å½•ï¼Œé¿å…è¿›å…¥é‡é‡çº§ç›‘è§†å™¨ï¼ˆmonitorï¼‰ã€‚</li><li><strong>é‡é‡çº§é”ï¼ˆMonitor&#x2F;Mutexï¼‰</strong>ï¼šå½“ç«äº‰æ¿€çƒˆæˆ– CAS å¤±è´¥æ—¶ï¼Œå‡çº§ä¸ºé‡é‡çº§é”ï¼Œä½¿ç”¨æ“ä½œç³»ç»Ÿäº’æ–¥é‡ï¼ˆå¯èƒ½æ¶‰åŠçº¿ç¨‹é˜»å¡&#x2F;å”¤é†’ï¼‰ã€‚</li></ol></li><li><code>monitorenter</code> &#x2F; <code>monitorexit</code> æ˜¯å­—èŠ‚ç æŒ‡ä»¤ï¼ˆç”±ç¼–è¯‘å™¨&#x2F;å­—èŠ‚ç ç”Ÿæˆå™¨ç”Ÿæˆï¼‰ã€‚</li><li>JIT ç¼–è¯‘å™¨å¯è¿›è¡Œé”æ¶ˆé™¤ã€é”ç²—åŒ–ã€é”ä¼˜åŒ–ç­‰ï¼ˆå½“èƒ½è¯æ˜æ— å¹¶å‘è®¿é—®æˆ–å·²å¤–éƒ¨åŒæ­¥æ—¶ï¼‰ã€‚</li></ul><h3 id="wait-notify-notifyAll"><a href="#wait-notify-notifyAll" class="headerlink" title="wait/notify&#x2F;notifyAll"></a><code>wait/notify</code>&#x2F;<code>notifyAll</code></h3><ul><li><code>Object.wait()</code>ã€<code>notify()</code>ã€<code>notifyAll()</code> å¿…é¡»åœ¨æŒæœ‰å¯¹è±¡ç›‘è§†å™¨ï¼ˆå³åœ¨ <code>synchronized</code> å—å†…ï¼‰æ—¶è°ƒç”¨ï¼Œç”¨äºçº¿ç¨‹é—´åä½œï¼ˆæ¡ä»¶ç­‰å¾…&#x2F;é€šçŸ¥ï¼‰ã€‚</li><li><code>wait()</code> ä¼šé‡Šæ”¾é”å¹¶è¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼›<code>notify()</code> å”¤é†’ç­‰å¾…é˜Ÿåˆ—ä¸­çš„ä¸€ä¸ªçº¿ç¨‹ï¼ˆè¢«å”¤é†’çº¿ç¨‹åœ¨é‡æ–°è·å¾—é”åç»§ç»­ï¼‰ã€‚</li></ul><h3 id="æ³¨æ„ä¸é™·é˜±"><a href="#æ³¨æ„ä¸é™·é˜±" class="headerlink" title="æ³¨æ„ä¸é™·é˜±"></a>æ³¨æ„ä¸é™·é˜±</h3><ul><li>é”ç²’åº¦ï¼šé¿å…ç”¨è¿‡å¤§é”ï¼ˆå¦‚ <code>synchronized</code> åœ¨æ–¹æ³•å¤´éƒ¨é”ä½å¤§é‡æ“ä½œï¼‰ï¼Œè°¨æ…ä½¿ç”¨ <code>String</code> æˆ–è£…ç®±å¯¹è±¡ä½œä¸ºé”ï¼ˆå¯èƒ½ä¼šå¯¼è‡´å¤šä¸ªå®ä¾‹å…±ç”¨åŒä¸€é”æˆ–é”è¢«å¤–éƒ¨æŒæœ‰ï¼‰ã€‚</li><li>æ­»é”ï¼šå¤šçº¿ç¨‹é”é¡ºåºä¸å½“å¯èƒ½æ­»é”ï¼›è®¾è®¡æ—¶è°¨é˜²ã€‚</li><li>æ€§èƒ½ï¼šåœ¨é«˜å¹¶å‘ä¸‹å¯è€ƒè™‘ä½¿ç”¨ <code>java.util.concurrent</code> åŒ…ï¼ˆ<code>ReentrantLock</code>ã€<code>ConcurrentHashMap</code>ã€<code>AtomicXxx</code>ï¼‰ç­‰æ›´ç»†ç²’åº¦ã€é«˜æ€§èƒ½çš„å¹¶å‘å·¥å…·ã€‚</li></ul><hr><h2 id="äºŒã€é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ˆOOPï¼‰"><a href="#äºŒã€é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ˆOOPï¼‰" class="headerlink" title="äºŒã€é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ˆOOPï¼‰"></a>äºŒã€é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ˆOOPï¼‰</h2><hr><h2 id="1-é¢å‘å¯¹è±¡çš„ä¸‰å¤§ç‰¹æ€§æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#1-é¢å‘å¯¹è±¡çš„ä¸‰å¤§ç‰¹æ€§æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1. é¢å‘å¯¹è±¡çš„ä¸‰å¤§ç‰¹æ€§æ˜¯ä»€ä¹ˆï¼Ÿ"></a><strong>1. é¢å‘å¯¹è±¡çš„ä¸‰å¤§ç‰¹æ€§æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h2><ul><li><strong>å°è£…ï¼ˆEncapsulationï¼‰</strong>ï¼šéšè—å®ç°ç»†èŠ‚ï¼Œåªæš´éœ²å¿…è¦æ¥å£ã€‚</li><li><strong>ç»§æ‰¿ï¼ˆInheritanceï¼‰</strong>ï¼šå­ç±»å¤ç”¨çˆ¶ç±»å±æ€§å’Œæ–¹æ³•ï¼Œæ‰©å±•åŠŸèƒ½ã€‚</li><li><strong>å¤šæ€ï¼ˆPolymorphismï¼‰</strong>ï¼šåŒä¸€æ¥å£ï¼Œä¸åŒå®ç°ã€‚è¡¨ç°ä¸ºæ–¹æ³•é‡å†™ã€æ–¹æ³•é‡è½½ã€‚</li></ul><hr><h2 id="2-å°è£…çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#2-å°è£…çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="2. å°è£…çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ"></a><strong>2. å°è£…çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h2><ul><li>éšè—å¯¹è±¡å†…éƒ¨å®ç°ç»†èŠ‚ï¼Œåªæš´éœ²å¿…è¦æ¥å£ã€‚</li><li>æé«˜ä»£ç å¤ç”¨æ€§ã€å®‰å…¨æ€§ï¼Œé¿å…æ•°æ®è¢«éšæ„ä¿®æ”¹ã€‚</li><li>ä¾‹å¦‚ï¼šç±»çš„æˆå‘˜å˜é‡ç”¨ <code>private</code>ï¼Œæä¾› <code>getter/setter</code> è®¿é—®ã€‚</li></ul><hr><h2 id="3-å¤šæ€çš„ä¼˜ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#3-å¤šæ€çš„ä¼˜ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="3. å¤šæ€çš„ä¼˜ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ"></a><strong>3. å¤šæ€çš„ä¼˜ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h2><ul><li><strong>æ¥å£ç»Ÿä¸€</strong>ï¼šä¸åŒå®ç°ç±»å¯é€šè¿‡çˆ¶ç±»&#x2F;æ¥å£æ“ä½œã€‚</li><li><strong>å¯æ‰©å±•æ€§å¼º</strong>ï¼šæ–°å¢å­ç±»ä¸å½±å“åŸæœ‰ä»£ç ã€‚</li><li><strong>è§£è€¦</strong>ï¼šè°ƒç”¨æ–¹åªä¾èµ–æŠ½è±¡ï¼Œè€Œä¸ä¾èµ–å…·ä½“å®ç°ã€‚</li><li>ä¾‹ï¼š<code>List list = new ArrayList();</code>ï¼Œåç»­å¯æ¢æˆ <code>LinkedList</code>ã€‚</li></ul><hr><h2 id="4-é‡å†™æ–¹æ³•æ—¶è¿”å›å€¼èƒ½å¦ä¸åŒï¼Ÿ"><a href="#4-é‡å†™æ–¹æ³•æ—¶è¿”å›å€¼èƒ½å¦ä¸åŒï¼Ÿ" class="headerlink" title="4. é‡å†™æ–¹æ³•æ—¶è¿”å›å€¼èƒ½å¦ä¸åŒï¼Ÿ"></a><strong>4. é‡å†™æ–¹æ³•æ—¶è¿”å›å€¼èƒ½å¦ä¸åŒï¼Ÿ</strong></h2><ul><li><strong>ä¸èƒ½å®Œå…¨ä¸åŒ</strong>ã€‚</li><li>Java å…è®¸ <strong>åå˜è¿”å›ç±»å‹</strong>ï¼šå­ç±»æ–¹æ³•çš„è¿”å›å€¼ç±»å‹å¯ä»¥æ˜¯çˆ¶ç±»æ–¹æ³•è¿”å›å€¼çš„å­ç±»ã€‚</li><li>ä¾‹å¦‚ï¼šçˆ¶ç±»è¿”å› <code>Number</code>ï¼Œå­ç±»å¯ä»¥è¿”å› <code>Integer</code>ã€‚</li></ul><hr><h2 id="5-æ„é€ å‡½æ•°èƒ½å¦è¢«ç»§æ‰¿ï¼Ÿ"><a href="#5-æ„é€ å‡½æ•°èƒ½å¦è¢«ç»§æ‰¿ï¼Ÿ" class="headerlink" title="5. æ„é€ å‡½æ•°èƒ½å¦è¢«ç»§æ‰¿ï¼Ÿ"></a><strong>5. æ„é€ å‡½æ•°èƒ½å¦è¢«ç»§æ‰¿ï¼Ÿ</strong></h2><ul><li><strong>ä¸èƒ½ç»§æ‰¿</strong>ï¼Œå› ä¸ºæ„é€ å‡½æ•°åå¿…é¡»ä¸ç±»åç›¸åŒã€‚</li><li>ä½†å­ç±»å¯é€šè¿‡ <code>super(...)</code> è°ƒç”¨çˆ¶ç±»æ„é€ æ–¹æ³•ã€‚</li></ul><hr><h2 id="6-æ„é€ å‡½æ•°èƒ½å¦-privateï¼Ÿ"><a href="#6-æ„é€ å‡½æ•°èƒ½å¦-privateï¼Ÿ" class="headerlink" title="6. æ„é€ å‡½æ•°èƒ½å¦ privateï¼Ÿ"></a><strong>6. æ„é€ å‡½æ•°èƒ½å¦ privateï¼Ÿ</strong></h2><ul><li><strong>å¯ä»¥</strong>ï¼Œå¸¸è§äºå•ä¾‹æ¨¡å¼ï¼ˆé¥¿æ±‰&#x2F;æ‡’æ±‰&#x2F;æšä¸¾å•ä¾‹ï¼‰ã€‚</li><li>ä½œç”¨ï¼šç¦æ­¢å¤–éƒ¨ <code>new</code>ï¼Œåªèƒ½é€šè¿‡ç±»æä¾›çš„æ–¹æ³•è·å–å®ä¾‹ã€‚</li></ul><hr><h2 id="7-å•ä¾‹æ¨¡å¼çš„å‡ ç§å®ç°æ–¹å¼ï¼Ÿ"><a href="#7-å•ä¾‹æ¨¡å¼çš„å‡ ç§å®ç°æ–¹å¼ï¼Ÿ" class="headerlink" title="7. å•ä¾‹æ¨¡å¼çš„å‡ ç§å®ç°æ–¹å¼ï¼Ÿ"></a><strong>7. å•ä¾‹æ¨¡å¼çš„å‡ ç§å®ç°æ–¹å¼ï¼Ÿ</strong></h2><ol><li>é¥¿æ±‰å¼ï¼ˆç±»åŠ è½½å³å®ä¾‹åŒ–ï¼Œçº¿ç¨‹å®‰å…¨ï¼Œä½†å¯èƒ½æµªè´¹å†…å­˜ï¼‰ã€‚</li><li>æ‡’æ±‰å¼ï¼ˆå»¶è¿ŸåŠ è½½ï¼Œéœ€åŠ  <code>synchronized</code> ä¿è¯çº¿ç¨‹å®‰å…¨ï¼‰ã€‚</li><li>åŒé‡æ£€æŸ¥é”ï¼ˆDCLï¼Œvolatile + synchronizedï¼Œæ€§èƒ½ä¼˜ï¼‰ã€‚</li><li>é™æ€å†…éƒ¨ç±»ï¼ˆæ¨èï¼Œåˆ©ç”¨ç±»åŠ è½½æœºåˆ¶ï¼Œçº¿ç¨‹å®‰å…¨ï¼‰ã€‚</li><li>æšä¸¾å•ä¾‹ï¼ˆæœ€ä½³å®è·µï¼Œé˜²æ­¢åå°„å’Œååºåˆ—åŒ–æ”»å‡»ï¼‰ã€‚</li></ol><hr><h2 id="8-é¥¿æ±‰å¼å’Œæ‡’æ±‰å¼å•ä¾‹çš„åŒºåˆ«ï¼Ÿ"><a href="#8-é¥¿æ±‰å¼å’Œæ‡’æ±‰å¼å•ä¾‹çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="8. é¥¿æ±‰å¼å’Œæ‡’æ±‰å¼å•ä¾‹çš„åŒºåˆ«ï¼Ÿ"></a><strong>8. é¥¿æ±‰å¼å’Œæ‡’æ±‰å¼å•ä¾‹çš„åŒºåˆ«ï¼Ÿ</strong></h2><ul><li><strong>é¥¿æ±‰å¼</strong>ï¼šç±»åŠ è½½æ—¶å®ä¾‹åŒ– â†’ çº¿ç¨‹å®‰å…¨ï¼Œå¯åŠ¨æ—¶å¯èƒ½æµªè´¹å†…å­˜ã€‚</li><li><strong>æ‡’æ±‰å¼</strong>ï¼šç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶æ‰å®ä¾‹åŒ– â†’ èŠ‚çœèµ„æºï¼Œä½†éœ€åŠ é”ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</li></ul><hr><h2 id="9-ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å†…éƒ¨ç±»ï¼Ÿ"><a href="#9-ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å†…éƒ¨ç±»ï¼Ÿ" class="headerlink" title="9. ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å†…éƒ¨ç±»ï¼Ÿ"></a><strong>9. ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å†…éƒ¨ç±»ï¼Ÿ</strong></h2><ul><li>å†…éƒ¨ç±»å¯ä»¥ <strong>è®¿é—®å¤–éƒ¨ç±»çš„ç§æœ‰æˆå‘˜</strong>ã€‚</li><li>æ›´å¥½åœ°ç»„ç»‡ä»£ç ï¼Œä½¿é€»è¾‘æ›´ç´§å¯†ã€‚</li><li>åœ¨éœ€è¦å›è°ƒæˆ–äº‹ä»¶ç›‘å¬æ—¶å¸¸ç”¨ã€‚</li></ul><hr><h2 id="10-æˆå‘˜å†…éƒ¨ç±»ã€å±€éƒ¨å†…éƒ¨ç±»ã€é™æ€å†…éƒ¨ç±»çš„åŒºåˆ«ï¼Ÿ"><a href="#10-æˆå‘˜å†…éƒ¨ç±»ã€å±€éƒ¨å†…éƒ¨ç±»ã€é™æ€å†…éƒ¨ç±»çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="10. æˆå‘˜å†…éƒ¨ç±»ã€å±€éƒ¨å†…éƒ¨ç±»ã€é™æ€å†…éƒ¨ç±»çš„åŒºåˆ«ï¼Ÿ"></a><strong>10. æˆå‘˜å†…éƒ¨ç±»ã€å±€éƒ¨å†…éƒ¨ç±»ã€é™æ€å†…éƒ¨ç±»çš„åŒºåˆ«ï¼Ÿ</strong></h2><ul><li><strong>æˆå‘˜å†…éƒ¨ç±»</strong>ï¼šä¾é™„äºå¤–éƒ¨ç±»å®ä¾‹ï¼Œå¯ä»¥è®¿é—®å¤–éƒ¨ç±»å®ä¾‹å˜é‡ã€‚</li><li><strong>å±€éƒ¨å†…éƒ¨ç±»</strong>ï¼šå®šä¹‰åœ¨æ–¹æ³•å†…éƒ¨ï¼Œä½œç”¨èŒƒå›´ä»…åœ¨æ–¹æ³•å†…ã€‚</li><li><strong>é™æ€å†…éƒ¨ç±»</strong>ï¼šä¸ä¾èµ–å¤–éƒ¨ç±»å®ä¾‹ï¼Œåªèƒ½è®¿é—®å¤–éƒ¨ç±»é™æ€æˆå‘˜ã€‚</li></ul><hr><h2 id="11-Java-ä¸­å¯¹è±¡çš„åˆ›å»ºæ–¹å¼æœ‰å“ªäº›ï¼Ÿ"><a href="#11-Java-ä¸­å¯¹è±¡çš„åˆ›å»ºæ–¹å¼æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="11. Java ä¸­å¯¹è±¡çš„åˆ›å»ºæ–¹å¼æœ‰å“ªäº›ï¼Ÿ"></a><strong>11. Java ä¸­å¯¹è±¡çš„åˆ›å»ºæ–¹å¼æœ‰å“ªäº›ï¼Ÿ</strong></h2><ol><li><code>new</code> å…³é”®å­—ã€‚</li><li>åå°„ <code>Class.newInstance()</code>ã€‚</li><li><code>Constructor.newInstance()</code>ã€‚</li><li>é€šè¿‡ <code>clone()</code>ã€‚</li><li>é€šè¿‡ååºåˆ—åŒ– <code>ObjectInputStream.readObject()</code>ã€‚</li></ol><hr><h2 id="12-å¯¹è±¡ä¹‹é—´çš„æµ…æ‹·è´å’Œæ·±æ‹·è´çš„åŒºåˆ«ï¼Ÿ"><a href="#12-å¯¹è±¡ä¹‹é—´çš„æµ…æ‹·è´å’Œæ·±æ‹·è´çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="12. å¯¹è±¡ä¹‹é—´çš„æµ…æ‹·è´å’Œæ·±æ‹·è´çš„åŒºåˆ«ï¼Ÿ"></a><strong>12. å¯¹è±¡ä¹‹é—´çš„æµ…æ‹·è´å’Œæ·±æ‹·è´çš„åŒºåˆ«ï¼Ÿ</strong></h2><ul><li><strong>æµ…æ‹·è´</strong>ï¼šåªå¤åˆ¶å¯¹è±¡æœ¬èº«ï¼Œå¼•ç”¨å­—æ®µä»æŒ‡å‘åŒä¸€å¯¹è±¡ã€‚</li><li><strong>æ·±æ‹·è´</strong>ï¼šè¿å¼•ç”¨å¯¹è±¡ä¹Ÿå¤åˆ¶ä¸€ä»½ï¼Œå®Œå…¨ç‹¬ç«‹ã€‚</li></ul><hr><h2 id="13-clone-æ–¹æ³•çš„åŸç†ï¼Ÿ"><a href="#13-clone-æ–¹æ³•çš„åŸç†ï¼Ÿ" class="headerlink" title="13. clone() æ–¹æ³•çš„åŸç†ï¼Ÿ"></a><strong>13. clone() æ–¹æ³•çš„åŸç†ï¼Ÿ</strong></h2><ul><li>æ¥è‡ª <code>Object</code> ç±»ï¼Œé»˜è®¤æ˜¯ <strong>æµ…æ‹·è´</strong>ã€‚</li><li>å¿…é¡»å®ç° <code>Cloneable</code> æ¥å£ï¼Œå¦åˆ™æŠ›å‡º <code>CloneNotSupportedException</code>ã€‚</li><li>å¯é‡å†™ <code>clone()</code> å®ç°æ·±æ‹·è´ã€‚</li></ul><hr><h2 id="14-ä¸ºä»€ä¹ˆ-Java-ä¸æ”¯æŒå¤šç»§æ‰¿ï¼Ÿ"><a href="#14-ä¸ºä»€ä¹ˆ-Java-ä¸æ”¯æŒå¤šç»§æ‰¿ï¼Ÿ" class="headerlink" title="14. ä¸ºä»€ä¹ˆ Java ä¸æ”¯æŒå¤šç»§æ‰¿ï¼Ÿ"></a><strong>14. ä¸ºä»€ä¹ˆ Java ä¸æ”¯æŒå¤šç»§æ‰¿ï¼Ÿ</strong></h2><ul><li>ä¸ºäº†é¿å… <strong>è±å½¢ç»§æ‰¿é—®é¢˜</strong>ï¼ˆå¤šä¸ªçˆ¶ç±»æ–¹æ³•å†²çªï¼‰ã€‚</li><li>Java ä½¿ç”¨ <strong>æ¥å£</strong> æ¥å®ç°å¤šç»§æ‰¿ç‰¹æ€§ã€‚</li></ul><hr><h2 id="15-Java-æ˜¯å€¼ä¼ é€’è¿˜æ˜¯å¼•ç”¨ä¼ é€’ï¼Ÿ"><a href="#15-Java-æ˜¯å€¼ä¼ é€’è¿˜æ˜¯å¼•ç”¨ä¼ é€’ï¼Ÿ" class="headerlink" title="15. Java æ˜¯å€¼ä¼ é€’è¿˜æ˜¯å¼•ç”¨ä¼ é€’ï¼Ÿ"></a><strong>15. Java æ˜¯å€¼ä¼ é€’è¿˜æ˜¯å¼•ç”¨ä¼ é€’ï¼Ÿ</strong></h2><ul><li>Java <strong>åªæœ‰å€¼ä¼ é€’</strong>ã€‚</li><li>å¯¹è±¡å‚æ•°ä¼ é€’çš„æ˜¯ <strong>å¼•ç”¨çš„å‰¯æœ¬</strong>ï¼ˆå€¼ï¼‰ï¼Œä½†æŒ‡å‘åŒä¸€å¯¹è±¡ã€‚</li></ul><hr><h2 id="16-æ–¹æ³•å‚æ•°ä¼ é€’æ—¶æ˜¯å¦‚ä½•å¤„ç†å¯¹è±¡çš„ï¼Ÿ"><a href="#16-æ–¹æ³•å‚æ•°ä¼ é€’æ—¶æ˜¯å¦‚ä½•å¤„ç†å¯¹è±¡çš„ï¼Ÿ" class="headerlink" title="16. æ–¹æ³•å‚æ•°ä¼ é€’æ—¶æ˜¯å¦‚ä½•å¤„ç†å¯¹è±¡çš„ï¼Ÿ"></a><strong>16. æ–¹æ³•å‚æ•°ä¼ é€’æ—¶æ˜¯å¦‚ä½•å¤„ç†å¯¹è±¡çš„ï¼Ÿ</strong></h2><ul><li>æ–¹æ³•å†…ä¿®æ”¹å¯¹è±¡çš„å­—æ®µ â†’ ä¼šå½±å“å¤–éƒ¨å¯¹è±¡ã€‚</li><li>æ–¹æ³•å†…ç»™å¼•ç”¨å˜é‡é‡æ–°èµ‹å€¼ â†’ ä¸ä¼šå½±å“å¤–éƒ¨å¯¹è±¡ã€‚</li></ul><hr><h2 id="17-å°è£…æ€§ä½“ç°åœ¨å“ªäº›æ–¹é¢ï¼Ÿ"><a href="#17-å°è£…æ€§ä½“ç°åœ¨å“ªäº›æ–¹é¢ï¼Ÿ" class="headerlink" title="17. å°è£…æ€§ä½“ç°åœ¨å“ªäº›æ–¹é¢ï¼Ÿ"></a><strong>17. å°è£…æ€§ä½“ç°åœ¨å“ªäº›æ–¹é¢ï¼Ÿ</strong></h2><ul><li>ä½¿ç”¨ <code>private</code> ä¿®é¥°æˆå‘˜å˜é‡ã€‚</li><li>æä¾› <code>getter/setter</code> æ§åˆ¶è®¿é—®æƒé™ã€‚</li><li>ä½¿ç”¨è®¿é—®ä¿®é¥°ç¬¦ï¼ˆpublic&#x2F;protected&#x2F;default&#x2F;privateï¼‰æ§åˆ¶ç±»å’Œæ–¹æ³•çš„å¯è§æ€§ã€‚</li></ul><hr><h2 id="18-ä¸ºä»€ä¹ˆéœ€è¦ç»§æ‰¿ï¼Ÿ"><a href="#18-ä¸ºä»€ä¹ˆéœ€è¦ç»§æ‰¿ï¼Ÿ" class="headerlink" title="18. ä¸ºä»€ä¹ˆéœ€è¦ç»§æ‰¿ï¼Ÿ"></a><strong>18. ä¸ºä»€ä¹ˆéœ€è¦ç»§æ‰¿ï¼Ÿ</strong></h2><ul><li>ä»£ç å¤ç”¨ï¼ˆå‡å°‘é‡å¤ï¼‰ã€‚</li><li>æé«˜æ‰©å±•æ€§ï¼ˆå­ç±»æ‰©å±•çˆ¶ç±»åŠŸèƒ½ï¼‰ã€‚</li><li>å®ç°å¤šæ€ï¼Œè§£è€¦ä¸šåŠ¡é€»è¾‘ã€‚</li></ul><hr><h2 id="19-é‡å†™-Object-ç±»çš„-toString-æ–¹æ³•çš„æ„ä¹‰ï¼Ÿ"><a href="#19-é‡å†™-Object-ç±»çš„-toString-æ–¹æ³•çš„æ„ä¹‰ï¼Ÿ" class="headerlink" title="19. é‡å†™ Object ç±»çš„ toString æ–¹æ³•çš„æ„ä¹‰ï¼Ÿ"></a><strong>19. é‡å†™ Object ç±»çš„ toString æ–¹æ³•çš„æ„ä¹‰ï¼Ÿ</strong></h2><ul><li>æé«˜å¯è¯»æ€§ï¼Œæ–¹ä¾¿è°ƒè¯•å’Œæ—¥å¿—è®°å½•ã€‚</li><li>é»˜è®¤ <code>toString()</code> æ‰“å°ç±»å+hashcodeï¼Œä¸ç›´è§‚ã€‚</li><li>é‡å†™åå¯æ‰“å°å¯¹è±¡æ ¸å¿ƒå­—æ®µä¿¡æ¯ã€‚</li></ul><hr><h2 id="20-é‡å†™-Object-ç±»çš„-equals-æ–¹æ³•æ—¶éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ"><a href="#20-é‡å†™-Object-ç±»çš„-equals-æ–¹æ³•æ—¶éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ" class="headerlink" title="20. é‡å†™ Object ç±»çš„ equals æ–¹æ³•æ—¶éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ"></a><strong>20. é‡å†™ Object ç±»çš„ equals æ–¹æ³•æ—¶éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ</strong></h2><ul><li>å¿…é¡»æ»¡è¶³ <strong>è‡ªåæ€§ã€å¯¹ç§°æ€§ã€ä¼ é€’æ€§ã€ä¸€è‡´æ€§</strong>ã€‚</li><li>ä¸ <code>hashCode()</code> ä¿æŒä¸€è‡´ï¼šç›¸ç­‰å¯¹è±¡å¿…é¡»æœ‰ç›¸åŒçš„ hashCodeã€‚</li><li>é¿å… <code>NullPointerException</code>ã€‚</li></ul><hr><h2 id="ä¸‰ã€å¼‚å¸¸å¤„ç†"><a href="#ä¸‰ã€å¼‚å¸¸å¤„ç†" class="headerlink" title="ä¸‰ã€å¼‚å¸¸å¤„ç†"></a>ä¸‰ã€å¼‚å¸¸å¤„ç†</h2><hr><h3 id="1-Java-çš„å¼‚å¸¸ä½“ç³»ç»“æ„ï¼Ÿ"><a href="#1-Java-çš„å¼‚å¸¸ä½“ç³»ç»“æ„ï¼Ÿ" class="headerlink" title="1. Java çš„å¼‚å¸¸ä½“ç³»ç»“æ„ï¼Ÿ"></a>1. Java çš„å¼‚å¸¸ä½“ç³»ç»“æ„ï¼Ÿ</h3><ul><li><strong>é¡¶å±‚ç±»</strong>ï¼š<code>Throwable</code><ul><li><strong>Error</strong>ï¼ˆé”™è¯¯ï¼Œç¨‹åºæ— æ³•å¤„ç†ï¼Œé€šå¸¸ç”± JVM æŠ›å‡ºï¼‰<ul><li>å¦‚ï¼š<code>OutOfMemoryError</code>ã€<code>StackOverflowError</code></li></ul></li><li><strong>Exception</strong>ï¼ˆå¼‚å¸¸ï¼Œç¨‹åºå¯å¤„ç†ï¼‰<ul><li><strong>Checked Exception</strong>ï¼ˆå—æ£€å¼‚å¸¸ï¼Œç¼–è¯‘æœŸæ£€æŸ¥ï¼‰<ul><li>å¦‚ï¼š<code>IOException</code>ã€<code>SQLException</code></li></ul></li><li><strong>Unchecked Exception</strong>ï¼ˆè¿è¡Œæ—¶å¼‚å¸¸ï¼Œç¼–è¯‘å™¨ä¸å¼ºåˆ¶å¤„ç†ï¼‰<ul><li>å¦‚ï¼š<code>NullPointerException</code>ã€<code>ArrayIndexOutOfBoundsException</code></li></ul></li></ul></li></ul></li></ul><p>ğŸ‘‰ ç»“æ„å›¾ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Throwable</span><br><span class="line"> â”œâ”€â”€ Error</span><br><span class="line"> â””â”€â”€ Exception</span><br><span class="line">      â”œâ”€â”€ Checked Exception</span><br><span class="line">      â””â”€â”€ Unchecked Exception (RuntimeException)</span><br></pre></td></tr></table></figure><hr><h3 id="2-Checked-Exception-å’Œ-Unchecked-Exception-çš„åŒºåˆ«ï¼Ÿ"><a href="#2-Checked-Exception-å’Œ-Unchecked-Exception-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="2. Checked Exception å’Œ Unchecked Exception çš„åŒºåˆ«ï¼Ÿ"></a>2. Checked Exception å’Œ Unchecked Exception çš„åŒºåˆ«ï¼Ÿ</h3><ul><li><strong>Checked Exceptionï¼ˆå—æ£€å¼‚å¸¸ï¼‰</strong><ul><li>å¿…é¡»æ˜¾å¼å¤„ç†ï¼ˆtry-catch æˆ– throws å£°æ˜ï¼‰ã€‚</li><li>ç¼–è¯‘å™¨å¼ºåˆ¶æ£€æŸ¥ï¼Œå¦åˆ™æ— æ³•é€šè¿‡ç¼–è¯‘ã€‚</li><li>å…¸å‹åœºæ™¯ï¼šIOã€æ•°æ®åº“ã€ç½‘ç»œè°ƒç”¨ã€‚</li></ul></li><li><strong>Unchecked Exceptionï¼ˆéå—æ£€å¼‚å¸¸ &#x2F; è¿è¡Œæ—¶å¼‚å¸¸ï¼‰</strong><ul><li>ä¸å¼ºåˆ¶å¤„ç†ï¼Œç¼–è¯‘å™¨ä¸æ£€æŸ¥ã€‚</li><li>é€šå¸¸ç”±ç¨‹åºé€»è¾‘é”™è¯¯å¯¼è‡´ã€‚</li><li>å…¸å‹åœºæ™¯ï¼šNPEã€é™¤é›¶ã€æ•°ç»„è¶Šç•Œã€‚</li></ul></li></ul><hr><h3 id="3-throw-å’Œ-throws-çš„åŒºåˆ«ï¼Ÿ"><a href="#3-throw-å’Œ-throws-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="3. throw å’Œ throws çš„åŒºåˆ«ï¼Ÿ"></a>3. throw å’Œ throws çš„åŒºåˆ«ï¼Ÿ</h3><ul><li><strong>throw</strong><ul><li>ç”¨äºæ–¹æ³•ä½“å†…éƒ¨ï¼Œ<strong>æŠ›å‡ºå…·ä½“çš„å¼‚å¸¸å¯¹è±¡</strong>ã€‚</li><li>è¯­æ³•ï¼š<code>throw new Exception(&quot;msg&quot;);</code></li></ul></li><li><strong>throws</strong><ul><li>ç”¨äºæ–¹æ³•å£°æ˜å¤„ï¼Œ<strong>æ ‡è¯†è¯¥æ–¹æ³•å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸ç±»å‹</strong>ã€‚</li><li>è¯­æ³•ï¼š<code>public void test() throws IOException &#123;&#125;</code></li></ul></li></ul><p>ğŸ‘‰ æ€»ç»“ï¼š</p><ul><li><code>throw</code> &#x3D; æŠ›å‡ºå¼‚å¸¸å®ä¾‹ã€‚</li><li><code>throws</code> &#x3D; å£°æ˜å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸ç±»å‹ã€‚</li></ul><hr><h3 id="4-try-catch-finally-çš„æ‰§è¡Œé¡ºåºï¼Ÿ"><a href="#4-try-catch-finally-çš„æ‰§è¡Œé¡ºåºï¼Ÿ" class="headerlink" title="4. try-catch-finally çš„æ‰§è¡Œé¡ºåºï¼Ÿ"></a>4. try-catch-finally çš„æ‰§è¡Œé¡ºåºï¼Ÿ</h3><ol><li><code>try</code> å—å…ˆæ‰§è¡Œã€‚</li><li>å¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œè·³åˆ°å¯¹åº” <code>catch</code> æ‰§è¡Œã€‚</li><li><code>finally</code> <strong>ä¸€å®šä¼šæ‰§è¡Œ</strong>ï¼ˆé™¤é <code>System.exit()</code>ï¼‰ã€‚</li><li>å¦‚æœ <code>try</code> æˆ– <code>catch</code> æœ‰ <code>return</code>ï¼Œä¼šå…ˆæ‰§è¡Œ <code>finally</code>ï¼Œå†è¿”å›ç»“æœã€‚</li></ol><hr><h3 id="5-finally-ä¸­çš„-return-ä¼šè¦†ç›–-try-ä¸­çš„-return-å—ï¼Ÿ"><a href="#5-finally-ä¸­çš„-return-ä¼šè¦†ç›–-try-ä¸­çš„-return-å—ï¼Ÿ" class="headerlink" title="5. finally ä¸­çš„ return ä¼šè¦†ç›– try ä¸­çš„ return å—ï¼Ÿ"></a>5. finally ä¸­çš„ return ä¼šè¦†ç›– try ä¸­çš„ return å—ï¼Ÿ</h3><p>âœ… <strong>ä¼šè¦†ç›–</strong>ã€‚</p><ul><li>å¦‚æœ <code>try</code> ä¸­æœ‰ <code>return</code>ï¼Œä½† <code>finally</code> ä¸­ä¹Ÿæœ‰ <code>return</code>ï¼Œæœ€ç»ˆè¿”å›çš„æ˜¯ <code>finally</code> çš„ç»“æœã€‚<br> ğŸ‘‰ å› æ­¤å®é™…å¼€å‘ä¸­ <strong>ä¸æ¨èåœ¨ finally ä¸­å†™ return</strong>ã€‚</li></ul><hr><h3 id="6-try-with-resources-çš„ä½œç”¨ï¼Ÿ"><a href="#6-try-with-resources-çš„ä½œç”¨ï¼Ÿ" class="headerlink" title="6. try-with-resources çš„ä½œç”¨ï¼Ÿ"></a>6. try-with-resources çš„ä½œç”¨ï¼Ÿ</h3><ul><li>Java 7 å¼•å…¥ï¼Œç®€åŒ–èµ„æºç®¡ç†ï¼ˆå¦‚æµã€æ•°æ®åº“è¿æ¥ï¼‰ã€‚</li><li>è‡ªåŠ¨å…³é—­å®ç°äº† <code>AutoCloseable</code> æˆ– <code>Closeable</code> æ¥å£çš„èµ„æºã€‚</li><li>é¿å…å¿˜è®° <code>finally &#123; resource.close(); &#125;</code>ã€‚</li></ul><p>ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (<span class="type">BufferedReader</span> <span class="variable">br</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">FileReader</span>(<span class="string">&quot;a.txt&quot;</span>))) &#123;</span><br><span class="line">    System.out.println(br.readLine());</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="7-è‡ªå®šä¹‰å¼‚å¸¸ç±»å¦‚ä½•å®ç°ï¼Ÿ"><a href="#7-è‡ªå®šä¹‰å¼‚å¸¸ç±»å¦‚ä½•å®ç°ï¼Ÿ" class="headerlink" title="7. è‡ªå®šä¹‰å¼‚å¸¸ç±»å¦‚ä½•å®ç°ï¼Ÿ"></a>7. è‡ªå®šä¹‰å¼‚å¸¸ç±»å¦‚ä½•å®ç°ï¼Ÿ</h3><ul><li>ç»§æ‰¿ <code>Exception</code>ï¼ˆCheckedï¼‰æˆ– <code>RuntimeException</code>ï¼ˆUncheckedï¼‰ã€‚</li><li>æä¾›æ„é€ æ–¹æ³•ï¼šæ— å‚ã€å¸¦ messageã€å¸¦ causeã€‚</li></ul><p>ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyException</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="8-Error-å’Œ-Exception-çš„åŒºåˆ«ï¼Ÿ"><a href="#8-Error-å’Œ-Exception-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="8. Error å’Œ Exception çš„åŒºåˆ«ï¼Ÿ"></a>8. Error å’Œ Exception çš„åŒºåˆ«ï¼Ÿ</h3><ul><li><strong>Error</strong>ï¼šç³»ç»Ÿçº§é”™è¯¯ï¼ŒJVM æ— æ³•æ¢å¤ï¼Œç¨‹åºä¸åº”è¯¥æ•è·ã€‚<ul><li>å¦‚ <code>OutOfMemoryError</code>ã€<code>StackOverflowError</code>ã€‚</li></ul></li><li><strong>Exception</strong>ï¼šåº”ç”¨çº§å¼‚å¸¸ï¼Œç¨‹åºåº”è¯¥å¤„ç†ã€‚<ul><li>å¦‚ <code>IOException</code>ã€<code>SQLException</code>ã€<code>NullPointerException</code>ã€‚</li></ul></li></ul><hr><h3 id="9-NullPointerException-å¸¸è§åœºæ™¯æœ‰å“ªäº›ï¼Ÿ"><a href="#9-NullPointerException-å¸¸è§åœºæ™¯æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="9. NullPointerException å¸¸è§åœºæ™¯æœ‰å“ªäº›ï¼Ÿ"></a>9. NullPointerException å¸¸è§åœºæ™¯æœ‰å“ªäº›ï¼Ÿ</h3><ol><li>è°ƒç”¨ç©ºå¯¹è±¡çš„æ–¹æ³•ï¼š<code>obj.toString()</code>ã€‚</li><li>è®¿é—®ç©ºæ•°ç»„ï¼š<code>arr.length</code>ã€‚</li><li>è®¿é—®ç©ºé›†åˆï¼š<code>list.size()</code>ã€‚</li><li>è‡ªåŠ¨æ‹†ç®±ï¼š<code>Integer num = null; int n = num;</code>ã€‚</li><li>Map æŸ¥æ‰¾ä¸º nullï¼Œå†è°ƒç”¨æ–¹æ³•ï¼š<code>map.get(&quot;key&quot;).toString()</code>ã€‚</li><li>ä¾èµ–æ³¨å…¥&#x2F;æœªåˆå§‹åŒ–çš„å¯¹è±¡ã€‚</li></ol><hr><h3 id="10-è¿è¡Œæ—¶å¼‚å¸¸éœ€è¦æ•è·å—ï¼Ÿä¸ºä»€ä¹ˆ"><a href="#10-è¿è¡Œæ—¶å¼‚å¸¸éœ€è¦æ•è·å—ï¼Ÿä¸ºä»€ä¹ˆ" class="headerlink" title="10. è¿è¡Œæ—¶å¼‚å¸¸éœ€è¦æ•è·å—ï¼Ÿä¸ºä»€ä¹ˆ"></a>10. è¿è¡Œæ—¶å¼‚å¸¸éœ€è¦æ•è·å—ï¼Ÿä¸ºä»€ä¹ˆ</h3><ul><li><strong>é€šå¸¸ä¸éœ€è¦æ˜¾å¼æ•è·</strong>ï¼Œå› ä¸ºå®ƒä»¬å¤šç”±é€»è¾‘é”™è¯¯å¯¼è‡´ï¼ˆå¦‚ NPEã€é™¤é›¶ï¼‰ã€‚</li><li>æ•è·è¿è¡Œæ—¶å¼‚å¸¸å¹¶ä¸èƒ½è§£å†³é—®é¢˜ï¼Œåº”è¯¥<strong>é€šè¿‡ä¿®æ”¹ä»£ç é€»è¾‘</strong>é¿å…ã€‚</li><li>ä½†åœ¨æŸäº›å…³é”®æœåŠ¡ï¼ˆå¦‚ API å±‚ï¼‰å¯ä»¥ç”¨ç»Ÿä¸€å¼‚å¸¸å¤„ç†ï¼ˆå¦‚ Spring @ControllerAdviceï¼‰æ‹¦æˆªï¼Œé¿å…ç¨‹åºç›´æ¥å´©æºƒã€‚</li></ul><hr><h2 id="å››ã€é›†åˆæ¡†æ¶ï¼ˆCollectionsï¼‰"><a href="#å››ã€é›†åˆæ¡†æ¶ï¼ˆCollectionsï¼‰" class="headerlink" title="å››ã€é›†åˆæ¡†æ¶ï¼ˆCollectionsï¼‰"></a>å››ã€é›†åˆæ¡†æ¶ï¼ˆCollectionsï¼‰</h2><hr><h3 id="1-Collection-å’Œ-Collections-çš„åŒºåˆ«ï¼Ÿ"><a href="#1-Collection-å’Œ-Collections-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="1. Collection å’Œ Collections çš„åŒºåˆ«ï¼Ÿ"></a>1. Collection å’Œ Collections çš„åŒºåˆ«ï¼Ÿ</h3><ul><li><strong>Collection</strong>ï¼šé›†åˆæ¥å£ï¼Œæ˜¯æ‰€æœ‰é›†åˆç±»çš„çˆ¶æ¥å£ï¼ˆListã€Setï¼‰ã€‚</li><li><strong>Collections</strong>ï¼šå·¥å…·ç±»ï¼Œæä¾›æ“ä½œé›†åˆçš„é™æ€æ–¹æ³•ï¼ˆæ’åºã€æœç´¢ã€åŒæ­¥åŒ…è£…ç­‰ï¼‰ã€‚</li></ul><hr><h3 id="2-Listã€Setã€Map-çš„åŒºåˆ«ï¼Ÿ"><a href="#2-Listã€Setã€Map-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="2. Listã€Setã€Map çš„åŒºåˆ«ï¼Ÿ"></a>2. Listã€Setã€Map çš„åŒºåˆ«ï¼Ÿ</h3><ul><li><strong>List</strong>ï¼šæœ‰åºã€å¯é‡å¤ï¼ŒæŒ‰ç´¢å¼•è®¿é—®ï¼ˆArrayListã€LinkedListï¼‰ã€‚</li><li><strong>Set</strong>ï¼šæ— åºã€ä¸å¯é‡å¤ï¼ŒåŸºäºå“ˆå¸Œæˆ–æ ‘ï¼ˆHashSetã€TreeSetï¼‰ã€‚</li><li><strong>Map</strong>ï¼šé”®å€¼å¯¹å­˜å‚¨ï¼ŒKey ä¸å¯é‡å¤ï¼ŒValue å¯é‡å¤ï¼ˆHashMapã€TreeMapï¼‰ã€‚</li></ul><hr><h3 id="3-ArrayList-å’Œ-LinkedList-çš„åŒºåˆ«ï¼Ÿ"><a href="#3-ArrayList-å’Œ-LinkedList-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="3. ArrayList å’Œ LinkedList çš„åŒºåˆ«ï¼Ÿ"></a>3. ArrayList å’Œ LinkedList çš„åŒºåˆ«ï¼Ÿ</h3><ul><li><strong>ArrayList</strong>ï¼šåŸºäºåŠ¨æ€æ•°ç»„ï¼ŒæŸ¥è¯¢å¿«ï¼ˆO(1)ï¼‰ï¼Œå¢åˆ æ…¢ï¼ˆO(n)ï¼‰ã€‚</li><li><strong>LinkedList</strong>ï¼šåŸºäºåŒå‘é“¾è¡¨ï¼Œå¢åˆ å¿«ï¼ˆO(1)ï¼‰ï¼ŒæŸ¥è¯¢æ…¢ï¼ˆO(n)ï¼‰ã€‚</li></ul><hr><h3 id="4-HashMap-çš„åº•å±‚å®ç°ï¼Ÿ"><a href="#4-HashMap-çš„åº•å±‚å®ç°ï¼Ÿ" class="headerlink" title="4. HashMap çš„åº•å±‚å®ç°ï¼Ÿ"></a>4. HashMap çš„åº•å±‚å®ç°ï¼Ÿ</h3><ul><li><strong>JDK 1.7</strong>ï¼šæ•°ç»„ + é“¾è¡¨ã€‚</li><li><strong>JDK 1.8</strong>ï¼šæ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘ï¼ˆé“¾è¡¨é•¿åº¦ â‰¥ 8 æ—¶è½¬ä¸ºæ ‘ï¼‰ã€‚</li></ul><hr><h3 id="5-HashMap-1-7-å’Œ-1-8-çš„åŒºåˆ«ï¼Ÿ"><a href="#5-HashMap-1-7-å’Œ-1-8-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="5. HashMap 1.7 å’Œ 1.8 çš„åŒºåˆ«ï¼Ÿ"></a>5. HashMap 1.7 å’Œ 1.8 çš„åŒºåˆ«ï¼Ÿ</h3><ol><li>1.7ï¼šæ•°ç»„ + é“¾è¡¨ï¼Œé‡‡ç”¨å¤´æ’æ³•ï¼Œæ˜“å‡ºç°å¹¶å‘æ­»å¾ªç¯ã€‚</li><li>1.8ï¼šæ•°ç»„ + é“¾è¡¨&#x2F;çº¢é»‘æ ‘ï¼Œå°¾æ’æ³•ï¼Œé¿å…æ­»å¾ªç¯ï¼Œæé«˜æ€§èƒ½ã€‚</li><li>1.8 å¼•å…¥çº¢é»‘æ ‘ï¼ŒæŸ¥æ‰¾æ•ˆç‡ä» O(n) ä¼˜åŒ–ä¸º O(log n)ã€‚</li></ol><hr><h3 id="6-HashMap-å¦‚ä½•è§£å†³å“ˆå¸Œå†²çªï¼Ÿ"><a href="#6-HashMap-å¦‚ä½•è§£å†³å“ˆå¸Œå†²çªï¼Ÿ" class="headerlink" title="6. HashMap å¦‚ä½•è§£å†³å“ˆå¸Œå†²çªï¼Ÿ"></a>6. HashMap å¦‚ä½•è§£å†³å“ˆå¸Œå†²çªï¼Ÿ</h3><ul><li>æ–¹æ³•ï¼šæ‹‰é“¾æ³•ï¼ˆé“¾è¡¨ï¼‰+ çº¢é»‘æ ‘ã€‚</li><li>å†²çªæ—¶ï¼Œå°†å…ƒç´ æŒ‚åˆ°é“¾è¡¨&#x2F;æ ‘ä¸Šã€‚</li></ul><hr><h3 id="7-HashSet-çš„åº•å±‚å®ç°ï¼Ÿ"><a href="#7-HashSet-çš„åº•å±‚å®ç°ï¼Ÿ" class="headerlink" title="7. HashSet çš„åº•å±‚å®ç°ï¼Ÿ"></a>7. HashSet çš„åº•å±‚å®ç°ï¼Ÿ</h3><ul><li>åŸºäº <strong>HashMap</strong> å®ç°ã€‚</li><li><code>HashSet</code> çš„å…ƒç´ å­˜å‚¨åœ¨ <code>HashMap</code> çš„ key ä¸Šï¼Œvalue ä¸ºä¸€ä¸ªå›ºå®šå¯¹è±¡ <code>PRESENT</code>ã€‚</li></ul><hr><h3 id="8-ConcurrentHashMap-çš„åº•å±‚å®ç°ï¼Ÿ"><a href="#8-ConcurrentHashMap-çš„åº•å±‚å®ç°ï¼Ÿ" class="headerlink" title="8. ConcurrentHashMap çš„åº•å±‚å®ç°ï¼Ÿ"></a>8. ConcurrentHashMap çš„åº•å±‚å®ç°ï¼Ÿ</h3><ul><li><strong>JDK 1.7</strong>ï¼šåˆ†æ®µé”ï¼ˆSegment + HashEntryï¼‰ã€‚</li><li><strong>JDK 1.8</strong>ï¼šCAS + synchronizedï¼Œæ•°æ®ç»“æ„ä¸ HashMap ç±»ä¼¼ï¼Œæ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘ã€‚</li></ul><hr><h3 id="9-Hashtable-å’Œ-HashMap-çš„åŒºåˆ«ï¼Ÿ"><a href="#9-Hashtable-å’Œ-HashMap-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="9. Hashtable å’Œ HashMap çš„åŒºåˆ«ï¼Ÿ"></a>9. Hashtable å’Œ HashMap çš„åŒºåˆ«ï¼Ÿ</h3><ul><li><strong>çº¿ç¨‹å®‰å…¨æ€§</strong>ï¼šHashtable æ˜¯åŒæ­¥çš„ï¼ŒHashMap ä¸æ˜¯ã€‚</li><li><strong>null</strong>ï¼šHashtable ä¸å…è®¸ keyã€value ä¸º nullï¼›HashMap å…è®¸ä¸€ä¸ª null key å’Œå¤šä¸ª null valueã€‚</li><li><strong>æ•ˆç‡</strong>ï¼šHashMap æ›´é«˜æ•ˆã€‚</li></ul><hr><h3 id="10-TreeMap-å’Œ-HashMap-çš„åŒºåˆ«ï¼Ÿ"><a href="#10-TreeMap-å’Œ-HashMap-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="10. TreeMap å’Œ HashMap çš„åŒºåˆ«ï¼Ÿ"></a>10. TreeMap å’Œ HashMap çš„åŒºåˆ«ï¼Ÿ</h3><ul><li><strong>TreeMap</strong>ï¼šåŸºäºçº¢é»‘æ ‘ï¼Œæœ‰åºï¼ˆæŒ‰ Key æ’åºï¼‰ã€‚</li><li><strong>HashMap</strong>ï¼šåŸºäºå“ˆå¸Œè¡¨ï¼Œæ— åºã€‚</li></ul><hr><h3 id="11-WeakHashMap-çš„ç‰¹ç‚¹ï¼Ÿ"><a href="#11-WeakHashMap-çš„ç‰¹ç‚¹ï¼Ÿ" class="headerlink" title="11. WeakHashMap çš„ç‰¹ç‚¹ï¼Ÿ"></a>11. WeakHashMap çš„ç‰¹ç‚¹ï¼Ÿ</h3><ul><li>Key ä½¿ç”¨ <strong>å¼±å¼•ç”¨</strong>ï¼Œå½“æ²¡æœ‰å¼ºå¼•ç”¨æŒ‡å‘è¯¥ Key æ—¶ï¼Œä¼šè¢« GC å›æ”¶ã€‚</li><li>å¸¸ç”¨äºç¼“å­˜ã€‚</li></ul><hr><h3 id="12-CopyOnWriteArrayList-çš„åº”ç”¨åœºæ™¯ï¼Ÿ"><a href="#12-CopyOnWriteArrayList-çš„åº”ç”¨åœºæ™¯ï¼Ÿ" class="headerlink" title="12. CopyOnWriteArrayList çš„åº”ç”¨åœºæ™¯ï¼Ÿ"></a>12. CopyOnWriteArrayList çš„åº”ç”¨åœºæ™¯ï¼Ÿ</h3><ul><li>å†™æ—¶å¤åˆ¶ï¼šå†™æ“ä½œæ—¶å¤åˆ¶æ–°æ•°ç»„ï¼Œè¯»æ“ä½œä¸åŠ é”ã€‚</li><li>é€‚ç”¨äº <strong>è¯»å¤šå†™å°‘</strong> çš„å¹¶å‘åœºæ™¯ï¼Œæ¯”å¦‚ç¼“å­˜ã€è®¢é˜…åˆ—è¡¨ã€‚</li></ul><hr><h3 id="13-LinkedHashMap-çš„åº•å±‚åŸç†ï¼Ÿ"><a href="#13-LinkedHashMap-çš„åº•å±‚åŸç†ï¼Ÿ" class="headerlink" title="13. LinkedHashMap çš„åº•å±‚åŸç†ï¼Ÿ"></a>13. LinkedHashMap çš„åº•å±‚åŸç†ï¼Ÿ</h3><ul><li>åŸºäº HashMap + åŒå‘é“¾è¡¨ã€‚</li><li>ä¿è¯æ’å…¥é¡ºåºï¼ˆæˆ– LRU é¡ºåºï¼‰ã€‚</li></ul><hr><h3 id="14-Map-çš„-key-æ˜¯å¦å¯ä»¥ä¸º-nullï¼Ÿ"><a href="#14-Map-çš„-key-æ˜¯å¦å¯ä»¥ä¸º-nullï¼Ÿ" class="headerlink" title="14. Map çš„ key æ˜¯å¦å¯ä»¥ä¸º nullï¼Ÿ"></a>14. Map çš„ key æ˜¯å¦å¯ä»¥ä¸º nullï¼Ÿ</h3><ul><li><strong>HashMap</strong>ï¼šå…è®¸ä¸€ä¸ª null keyã€‚</li><li><strong>Hashtable &#x2F; TreeMap</strong>ï¼šä¸å…è®¸ null keyã€‚</li></ul><hr><h3 id="15-ArrayList-æ‰©å®¹æœºåˆ¶ï¼Ÿ"><a href="#15-ArrayList-æ‰©å®¹æœºåˆ¶ï¼Ÿ" class="headerlink" title="15. ArrayList æ‰©å®¹æœºåˆ¶ï¼Ÿ"></a>15. ArrayList æ‰©å®¹æœºåˆ¶ï¼Ÿ</h3><ul><li>åˆå§‹å®¹é‡ 10ï¼Œè¶…è¿‡å®¹é‡æ—¶æ‰©å®¹ä¸ºåŸæ¥çš„ 1.5 å€ã€‚</li><li>é€šè¿‡ <code>Arrays.copyOf()</code> å®ç°æ•°ç»„å¤åˆ¶ã€‚</li></ul><hr><h3 id="16-Vector-å’Œ-ArrayList-çš„åŒºåˆ«ï¼Ÿ"><a href="#16-Vector-å’Œ-ArrayList-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="16. Vector å’Œ ArrayList çš„åŒºåˆ«ï¼Ÿ"></a>16. Vector å’Œ ArrayList çš„åŒºåˆ«ï¼Ÿ</h3><ul><li><strong>Vector</strong>ï¼šçº¿ç¨‹å®‰å…¨ï¼ˆæ–¹æ³•åŠ  synchronizedï¼‰ï¼Œæ‰©å®¹ä¸º 2 å€ã€‚</li><li><strong>ArrayList</strong>ï¼šéçº¿ç¨‹å®‰å…¨ï¼Œæ‰©å®¹ä¸º 1.5 å€ã€‚</li></ul><hr><h3 id="17-PriorityQueue-çš„åº•å±‚å®ç°ï¼Ÿ"><a href="#17-PriorityQueue-çš„åº•å±‚å®ç°ï¼Ÿ" class="headerlink" title="17. PriorityQueue çš„åº•å±‚å®ç°ï¼Ÿ"></a>17. PriorityQueue çš„åº•å±‚å®ç°ï¼Ÿ</h3><ul><li>åŸºäº <strong>äºŒå‰å°é¡¶å †</strong>ï¼Œä¿è¯é˜Ÿå¤´å…ƒç´ æ˜¯æœ€å°å€¼ã€‚</li><li>æ’å…¥ã€åˆ é™¤æ“ä½œæ—¶é—´å¤æ‚åº¦ O(log n)ã€‚</li></ul><hr><h3 id="18-BlockingQueue-çš„å‡ ç§å®ç°ç±»ï¼Ÿ"><a href="#18-BlockingQueue-çš„å‡ ç§å®ç°ç±»ï¼Ÿ" class="headerlink" title="18. BlockingQueue çš„å‡ ç§å®ç°ç±»ï¼Ÿ"></a>18. BlockingQueue çš„å‡ ç§å®ç°ç±»ï¼Ÿ</h3><ul><li><strong>ArrayBlockingQueue</strong>ï¼šæ•°ç»„ç»“æ„ï¼Œæœ‰ç•Œã€‚</li><li><strong>LinkedBlockingQueue</strong>ï¼šé“¾è¡¨ç»“æ„ï¼Œå¯é€‰å®¹é‡ã€‚</li><li><strong>PriorityBlockingQueue</strong>ï¼šä¼˜å…ˆçº§é˜Ÿåˆ—ã€‚</li><li><strong>DelayQueue</strong>ï¼šå»¶æ—¶é˜Ÿåˆ—ã€‚</li><li><strong>SynchronousQueue</strong>ï¼šä¸å­˜å‚¨å…ƒç´ ï¼Œç›´æ¥ç§»äº¤ã€‚</li></ul><hr><h3 id="19-HashMap-æ­»å¾ªç¯é—®é¢˜å‡ºç°åœ¨å“ªä¸ªç‰ˆæœ¬ï¼Ÿ"><a href="#19-HashMap-æ­»å¾ªç¯é—®é¢˜å‡ºç°åœ¨å“ªä¸ªç‰ˆæœ¬ï¼Ÿ" class="headerlink" title="19. HashMap æ­»å¾ªç¯é—®é¢˜å‡ºç°åœ¨å“ªä¸ªç‰ˆæœ¬ï¼Ÿ"></a>19. HashMap æ­»å¾ªç¯é—®é¢˜å‡ºç°åœ¨å“ªä¸ªç‰ˆæœ¬ï¼Ÿ</h3><ul><li><strong>JDK 1.7</strong> å¤šçº¿ç¨‹æ‰©å®¹æ—¶ï¼Œé“¾è¡¨é‡‡ç”¨å¤´æ’æ³•ï¼Œå¯èƒ½å½¢æˆç¯ï¼Œå¯¼è‡´æ­»å¾ªç¯ã€‚</li><li><strong>JDK 1.8</strong> ä½¿ç”¨å°¾æ’æ³•ï¼Œè§£å†³è¯¥é—®é¢˜ã€‚</li></ul><hr><h3 id="20-fail-fast-å’Œ-fail-safe-çš„åŒºåˆ«ï¼Ÿ"><a href="#20-fail-fast-å’Œ-fail-safe-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="20. fail-fast å’Œ fail-safe çš„åŒºåˆ«ï¼Ÿ"></a>20. fail-fast å’Œ fail-safe çš„åŒºåˆ«ï¼Ÿ</h3><ul><li><strong>fail-fast</strong>ï¼šè¿­ä»£è¿‡ç¨‹ä¸­ç»“æ„è¢«ä¿®æ”¹ï¼Œä¼šæŠ›å‡º <code>ConcurrentModificationException</code>ã€‚å¦‚ï¼šArrayListã€HashMapã€‚</li><li><strong>fail-safe</strong>ï¼šè¿­ä»£åŸºäºå‰¯æœ¬ï¼Œä¸ä¼šæŠ›å¼‚å¸¸ã€‚å¦‚ï¼šCopyOnWriteArrayListã€ConcurrentHashMapã€‚</li></ul><hr><h2 id="äº”ã€å¹¶å‘ç¼–ç¨‹ï¼ˆJUCï¼‰"><a href="#äº”ã€å¹¶å‘ç¼–ç¨‹ï¼ˆJUCï¼‰" class="headerlink" title="äº”ã€å¹¶å‘ç¼–ç¨‹ï¼ˆJUCï¼‰"></a>äº”ã€å¹¶å‘ç¼–ç¨‹ï¼ˆJUCï¼‰</h2><hr><h3 id="1-Java-ä¸­çš„çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸï¼Ÿ"><a href="#1-Java-ä¸­çš„çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸï¼Ÿ" class="headerlink" title="1. Java ä¸­çš„çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸï¼Ÿ"></a>1. Java ä¸­çš„çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸï¼Ÿ</h3><ul><li><strong>NEWï¼ˆæ–°å»ºï¼‰</strong>ï¼š<code>new Thread()</code> åï¼Œè¿˜æ²¡è°ƒç”¨ <code>start()</code>ã€‚</li><li><strong>RUNNABLEï¼ˆå°±ç»ª&#x2F;è¿è¡Œä¸­ï¼‰</strong>ï¼šè°ƒç”¨ <code>start()</code>ï¼Œç­‰å¾… CPU è°ƒåº¦ã€‚</li><li><strong>BLOCKEDï¼ˆé˜»å¡ï¼‰</strong>ï¼šç­‰å¾…é”ã€‚</li><li><strong>WAITINGï¼ˆæ— é™ç­‰å¾…ï¼‰</strong>ï¼šè°ƒç”¨ <code>wait()</code>ã€<code>join()</code>ï¼Œéœ€å…¶ä»–çº¿ç¨‹å”¤é†’ã€‚</li><li><strong>TIMED_WAITINGï¼ˆé™æ—¶ç­‰å¾…ï¼‰</strong>ï¼šè°ƒç”¨ <code>sleep()</code>ã€<code>wait(timeout)</code>ã€‚</li><li><strong>TERMINATEDï¼ˆç»ˆæ­¢ï¼‰</strong>ï¼šçº¿ç¨‹æ‰§è¡Œå®Œæ¯•æˆ–å¼‚å¸¸é€€å‡ºã€‚</li></ul><hr><h3 id="2-Runnable-å’Œ-Callable-çš„åŒºåˆ«ï¼Ÿ"><a href="#2-Runnable-å’Œ-Callable-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="2. Runnable å’Œ Callable çš„åŒºåˆ«ï¼Ÿ"></a>2. Runnable å’Œ Callable çš„åŒºåˆ«ï¼Ÿ</h3><ul><li><strong>Runnable</strong>ï¼šæ— è¿”å›å€¼ï¼Œä¸èƒ½æŠ›å‡ºå—æ£€å¼‚å¸¸ã€‚</li><li><strong>Callable</strong>ï¼šæœ‰è¿”å›å€¼ï¼ˆFuture è·å–ï¼‰ï¼Œå¯æŠ›å‡ºå¼‚å¸¸ã€‚</li></ul><hr><h3 id="3-ThreadPoolExecutor-çš„å‚æ•°æœ‰å“ªäº›ï¼Ÿ"><a href="#3-ThreadPoolExecutor-çš„å‚æ•°æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="3. ThreadPoolExecutor çš„å‚æ•°æœ‰å“ªäº›ï¼Ÿ"></a>3. ThreadPoolExecutor çš„å‚æ•°æœ‰å“ªäº›ï¼Ÿ</h3><ul><li><strong>corePoolSize</strong>ï¼šæ ¸å¿ƒçº¿ç¨‹æ•°ã€‚</li><li><strong>maximumPoolSize</strong>ï¼šæœ€å¤§çº¿ç¨‹æ•°ã€‚</li><li><strong>keepAliveTime</strong>ï¼šéæ ¸å¿ƒçº¿ç¨‹å­˜æ´»æ—¶é—´ã€‚</li><li><strong>unit</strong>ï¼šæ—¶é—´å•ä½ã€‚</li><li><strong>workQueue</strong>ï¼šä»»åŠ¡é˜Ÿåˆ—ï¼ˆBlockingQueueï¼‰ã€‚</li><li><strong>threadFactory</strong>ï¼šçº¿ç¨‹å·¥å‚ï¼ˆè‡ªå®šä¹‰çº¿ç¨‹åï¼‰ã€‚</li><li><strong>handler</strong>ï¼šæ‹’ç»ç­–ç•¥ã€‚</li></ul><hr><h3 id="4-çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ"><a href="#4-çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="4. çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ"></a>4. çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ</h3><ul><li><strong>AbortPolicy</strong>ï¼ˆé»˜è®¤ï¼‰ï¼šæŠ› <code>RejectedExecutionException</code>ã€‚</li><li><strong>CallerRunsPolicy</strong>ï¼šä»»åŠ¡äº¤ç»™æäº¤ä»»åŠ¡çš„çº¿ç¨‹æ‰§è¡Œã€‚</li><li><strong>DiscardPolicy</strong>ï¼šç›´æ¥ä¸¢å¼ƒä»»åŠ¡ã€‚</li><li><strong>DiscardOldestPolicy</strong>ï¼šä¸¢å¼ƒé˜Ÿåˆ—é‡Œæœ€æ—§çš„ä»»åŠ¡ï¼Œå†å°è¯•æäº¤ã€‚</li></ul><hr><h3 id="5-åˆ›å»ºçº¿ç¨‹çš„å››ç§æ–¹å¼ï¼Ÿ"><a href="#5-åˆ›å»ºçº¿ç¨‹çš„å››ç§æ–¹å¼ï¼Ÿ" class="headerlink" title="5. åˆ›å»ºçº¿ç¨‹çš„å››ç§æ–¹å¼ï¼Ÿ"></a>5. åˆ›å»ºçº¿ç¨‹çš„å››ç§æ–¹å¼ï¼Ÿ</h3><ol><li>ç»§æ‰¿ Thread ç±»ã€‚</li><li>å®ç° Runnable æ¥å£ã€‚</li><li>å®ç° Callable + FutureTaskã€‚</li><li>ä½¿ç”¨çº¿ç¨‹æ± ï¼ˆExecutorServiceï¼‰ã€‚</li></ol><hr><h3 id="6-synchronized-çš„åº•å±‚å®ç°åŸç†ï¼Ÿ"><a href="#6-synchronized-çš„åº•å±‚å®ç°åŸç†ï¼Ÿ" class="headerlink" title="6. synchronized çš„åº•å±‚å®ç°åŸç†ï¼Ÿ"></a>6. synchronized çš„åº•å±‚å®ç°åŸç†ï¼Ÿ</h3><ul><li>åŸºäº <strong>å¯¹è±¡å¤´ (Mark Word)</strong> å’Œ <strong>Monitorï¼ˆç®¡ç¨‹ï¼‰</strong>ã€‚</li><li>è¿›å…¥åŒæ­¥å—æ—¶ï¼Œå°è¯•è·å–å¯¹è±¡çš„ Monitorï¼Œè·å–ä¸åˆ°åˆ™é˜»å¡ã€‚</li><li>åº•å±‚ä¾èµ– <strong>JVM æŒ‡ä»¤</strong>ï¼š<code>monitorenter</code>ã€<code>monitorexit</code>ã€‚</li></ul><hr><h3 id="7-synchronized-å’Œ-ReentrantLock-çš„åŒºåˆ«ï¼Ÿ"><a href="#7-synchronized-å’Œ-ReentrantLock-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="7. synchronized å’Œ ReentrantLock çš„åŒºåˆ«ï¼Ÿ"></a>7. synchronized å’Œ ReentrantLock çš„åŒºåˆ«ï¼Ÿ</h3><ul><li><strong>é”ç±»å‹</strong>ï¼šsynchronized æ˜¯ JVM çº§åˆ«ï¼ŒReentrantLock æ˜¯ JUC æä¾›çš„ APIã€‚</li><li><strong>åŠŸèƒ½</strong>ï¼šReentrantLock æ”¯æŒå…¬å¹³é”&#x2F;éå…¬å¹³é”ã€å¯ä¸­æ–­ã€å°è¯•åŠ é”ã€æ¡ä»¶å˜é‡ã€‚</li><li><strong>å¯é‡å…¥æ€§</strong>ï¼šä¸¤è€…éƒ½å¯é‡å…¥ã€‚</li><li><strong>æ€§èƒ½</strong>ï¼šsynchronized åœ¨ JDK1.6 ä¹‹åä¼˜åŒ–ï¼ˆåå‘é”ã€è½»é‡çº§é”ï¼‰æ€§èƒ½å·²æå‡ã€‚</li></ul><hr><h3 id="8-å…¬å¹³é”å’Œéå…¬å¹³é”çš„åŒºåˆ«ï¼Ÿ"><a href="#8-å…¬å¹³é”å’Œéå…¬å¹³é”çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="8. å…¬å¹³é”å’Œéå…¬å¹³é”çš„åŒºåˆ«ï¼Ÿ"></a>8. å…¬å¹³é”å’Œéå…¬å¹³é”çš„åŒºåˆ«ï¼Ÿ</h3><ul><li><strong>å…¬å¹³é”</strong>ï¼šæŒ‰ç…§ç­‰å¾…é¡ºåºè·å–é”ã€‚</li><li><strong>éå…¬å¹³é”</strong>ï¼šå…è®¸â€œæ’é˜Ÿâ€ï¼Œå‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæé«˜ååé‡ã€‚</li><li>ReentrantLock é»˜è®¤éå…¬å¹³ã€‚</li></ul><hr><h3 id="9-AQS-çš„åŸç†ï¼Ÿ"><a href="#9-AQS-çš„åŸç†ï¼Ÿ" class="headerlink" title="9. AQS çš„åŸç†ï¼Ÿ"></a>9. AQS çš„åŸç†ï¼Ÿ</h3><ul><li><strong>AQSï¼ˆAbstractQueuedSynchronizerï¼‰</strong> æ˜¯æ„å»ºé”å’ŒåŒæ­¥å™¨çš„æ¡†æ¶ã€‚</li><li>å†…éƒ¨ç»´æŠ¤ä¸€ä¸ª <strong>state</strong>ï¼ˆè¡¨ç¤ºèµ„æºæ•°é‡ï¼‰å’Œ <strong>FIFO åŒå‘é˜Ÿåˆ—</strong>ã€‚</li><li>é€šè¿‡ CAS ä¿®æ”¹ stateï¼Œå¤±è´¥åˆ™å°†çº¿ç¨‹åŠ å…¥ç­‰å¾…é˜Ÿåˆ—ï¼ŒæŒ‚èµ·é˜»å¡ï¼Œç­‰èµ„æºé‡Šæ”¾å†å”¤é†’ã€‚</li></ul><hr><h3 id="10-CountDownLatch-çš„åº”ç”¨åœºæ™¯ï¼Ÿ"><a href="#10-CountDownLatch-çš„åº”ç”¨åœºæ™¯ï¼Ÿ" class="headerlink" title="10. CountDownLatch çš„åº”ç”¨åœºæ™¯ï¼Ÿ"></a>10. CountDownLatch çš„åº”ç”¨åœºæ™¯ï¼Ÿ</h3><ul><li>å€’è®¡æ•°å™¨ï¼šä¸€ä¸ªçº¿ç¨‹ç­‰å¾…å¤šä¸ªçº¿ç¨‹å®Œæˆåå†æ‰§è¡Œã€‚</li><li>ä¾‹å­ï¼šä¸»çº¿ç¨‹ç­‰å¾…å¤šä¸ªå­ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ã€‚</li></ul><hr><h3 id="11-CyclicBarrier-çš„åº”ç”¨åœºæ™¯ï¼Ÿ"><a href="#11-CyclicBarrier-çš„åº”ç”¨åœºæ™¯ï¼Ÿ" class="headerlink" title="11. CyclicBarrier çš„åº”ç”¨åœºæ™¯ï¼Ÿ"></a>11. CyclicBarrier çš„åº”ç”¨åœºæ™¯ï¼Ÿ</h3><ul><li>æ …æ ï¼šä¸€ç»„çº¿ç¨‹äº’ç›¸ç­‰å¾…ï¼Œç›´åˆ°æ‰€æœ‰çº¿ç¨‹åˆ°è¾¾å±éšœç‚¹å†ç»§ç»­ã€‚</li><li>ä¾‹å­ï¼šå¤šäººæ¸¸æˆï¼Œæ‰€æœ‰ç©å®¶éƒ½å‡†å¤‡å¥½å†å¼€å§‹ã€‚</li></ul><hr><h3 id="12-Semaphore-çš„åº”ç”¨åœºæ™¯ï¼Ÿ"><a href="#12-Semaphore-çš„åº”ç”¨åœºæ™¯ï¼Ÿ" class="headerlink" title="12. Semaphore çš„åº”ç”¨åœºæ™¯ï¼Ÿ"></a>12. Semaphore çš„åº”ç”¨åœºæ™¯ï¼Ÿ</h3><ul><li>ä¿¡å·é‡ï¼šæ§åˆ¶å¹¶å‘è®¿é—®çš„çº¿ç¨‹æ•°é‡ã€‚</li><li>ä¾‹å­ï¼šåœè½¦åœºé™åˆ¶è½¦ä½æ•°ã€æ•°æ®åº“è¿æ¥æ± ã€‚</li></ul><hr><h3 id="13-Exchanger-çš„åº”ç”¨åœºæ™¯ï¼Ÿ"><a href="#13-Exchanger-çš„åº”ç”¨åœºæ™¯ï¼Ÿ" class="headerlink" title="13. Exchanger çš„åº”ç”¨åœºæ™¯ï¼Ÿ"></a>13. Exchanger çš„åº”ç”¨åœºæ™¯ï¼Ÿ</h3><ul><li>çº¿ç¨‹é—´æ•°æ®äº¤æ¢ï¼šä¸¤ä¸ªçº¿ç¨‹é…å¯¹äº¤æ¢æ•°æ®ã€‚</li><li>ä¾‹å­ï¼šç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…äº¤æ¢ç¼“å†²åŒºã€‚</li></ul><hr><h3 id="14-volatile-èƒ½ä¿è¯åŸå­æ€§å—ï¼Ÿ"><a href="#14-volatile-èƒ½ä¿è¯åŸå­æ€§å—ï¼Ÿ" class="headerlink" title="14. volatile èƒ½ä¿è¯åŸå­æ€§å—ï¼Ÿ"></a>14. volatile èƒ½ä¿è¯åŸå­æ€§å—ï¼Ÿ</h3><ul><li><strong>ä¸èƒ½</strong>ï¼Œåªèƒ½ä¿è¯å¯è§æ€§å’Œç¦æ­¢æŒ‡ä»¤é‡æ’ã€‚</li><li>ä¾‹å­ï¼š<code>count++</code> åœ¨å¤šçº¿ç¨‹ä¸‹ä»ç„¶ä¸å®‰å…¨ã€‚</li></ul><hr><h3 id="15-CAS-çš„åŸç†ï¼Ÿ"><a href="#15-CAS-çš„åŸç†ï¼Ÿ" class="headerlink" title="15. CAS çš„åŸç†ï¼Ÿ"></a>15. CAS çš„åŸç†ï¼Ÿ</h3><ul><li>Compare And Swapï¼šæ¯”è¾ƒå†…å­˜å€¼æ˜¯å¦ä¸ºé¢„æœŸå€¼ï¼Œå¦‚æœæ˜¯åˆ™æ›´æ–°ï¼Œå¦åˆ™é‡è¯•ã€‚</li><li>åº•å±‚ä¾èµ– CPU çš„ <strong>cmpxchg</strong> æŒ‡ä»¤ï¼Œä¿è¯åŸå­æ€§ã€‚</li></ul><hr><h3 id="16-ABA-é—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿæ€ä¹ˆè§£å†³ï¼Ÿ"><a href="#16-ABA-é—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿæ€ä¹ˆè§£å†³ï¼Ÿ" class="headerlink" title="16. ABA é—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿæ€ä¹ˆè§£å†³ï¼Ÿ"></a>16. ABA é—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿæ€ä¹ˆè§£å†³ï¼Ÿ</h3><ul><li><strong>é—®é¢˜</strong>ï¼šCAS åªæ¯”è¾ƒå€¼ï¼Œæ— æ³•æ„ŸçŸ¥å€¼è¢«æ”¹è¿‡ã€‚ä¾‹å¦‚ Aâ†’Bâ†’Aã€‚</li><li><strong>è§£å†³</strong>ï¼šä½¿ç”¨ <strong>ç‰ˆæœ¬å·&#x2F;æ—¶é—´æˆ³</strong>ï¼ˆAtomicStampedReferenceã€AtomicMarkableReferenceï¼‰ã€‚</li></ul><hr><h3 id="17-ThreadLocal-çš„ä½œç”¨åŠåŸç†ï¼Ÿ"><a href="#17-ThreadLocal-çš„ä½œç”¨åŠåŸç†ï¼Ÿ" class="headerlink" title="17. ThreadLocal çš„ä½œç”¨åŠåŸç†ï¼Ÿ"></a>17. ThreadLocal çš„ä½œç”¨åŠåŸç†ï¼Ÿ</h3><ul><li><strong>ä½œç”¨</strong>ï¼šä¸ºæ¯ä¸ªçº¿ç¨‹æä¾›ç‹¬ç«‹å˜é‡å‰¯æœ¬ï¼Œé¿å…å…±äº«æ•°æ®å†²çªã€‚</li><li><strong>åŸç†</strong>ï¼šThread å†…éƒ¨æœ‰ä¸ª ThreadLocalMapï¼Œä»¥ ThreadLocal ä¸º key å­˜å‚¨å˜é‡ã€‚</li></ul><hr><h3 id="18-ThreadLocal-å†…å­˜æ³„æ¼çš„åŸå› ï¼Ÿ"><a href="#18-ThreadLocal-å†…å­˜æ³„æ¼çš„åŸå› ï¼Ÿ" class="headerlink" title="18. ThreadLocal å†…å­˜æ³„æ¼çš„åŸå› ï¼Ÿ"></a>18. ThreadLocal å†…å­˜æ³„æ¼çš„åŸå› ï¼Ÿ</h3><ul><li>ThreadLocalMap çš„ key æ˜¯ <strong>å¼±å¼•ç”¨</strong>ï¼Œå¯èƒ½è¢«å›æ”¶ï¼Œvalue å´è¿˜å­˜åœ¨ï¼Œå¯¼è‡´æ³„æ¼ã€‚</li><li>è§£å†³ï¼šç”¨å®ŒåŠæ—¶ <code>remove()</code>ã€‚</li></ul><hr><h3 id="19-JUC-ä¸­çš„åŸå­ç±»æœ‰å“ªäº›ï¼Ÿ"><a href="#19-JUC-ä¸­çš„åŸå­ç±»æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="19. JUC ä¸­çš„åŸå­ç±»æœ‰å“ªäº›ï¼Ÿ"></a>19. JUC ä¸­çš„åŸå­ç±»æœ‰å“ªäº›ï¼Ÿ</h3><ul><li><strong>åŸºæœ¬ç±»å‹åŸå­ç±»</strong>ï¼šAtomicIntegerã€AtomicLongã€AtomicBooleanã€‚</li><li><strong>å¼•ç”¨ç±»å‹åŸå­ç±»</strong>ï¼šAtomicReferenceã€AtomicStampedReferenceã€‚</li><li><strong>æ•°ç»„åŸå­ç±»</strong>ï¼šAtomicIntegerArrayã€AtomicLongArrayã€‚</li><li><strong>å¯¹è±¡å±æ€§æ›´æ–°å™¨</strong>ï¼šAtomicIntegerFieldUpdater ç­‰ã€‚</li></ul><hr><h3 id="20-ä¹è§‚é”å’Œæ‚²è§‚é”çš„åŒºåˆ«ï¼Ÿ"><a href="#20-ä¹è§‚é”å’Œæ‚²è§‚é”çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="20. ä¹è§‚é”å’Œæ‚²è§‚é”çš„åŒºåˆ«ï¼Ÿ"></a>20. ä¹è§‚é”å’Œæ‚²è§‚é”çš„åŒºåˆ«ï¼Ÿ</h3><ul><li><strong>æ‚²è§‚é”</strong>ï¼šå‡è®¾ä¼šå‘ç”Ÿå†²çªï¼Œå…ˆåŠ é”å†æ“ä½œï¼ˆsynchronizedã€ReentrantLockï¼‰ã€‚</li><li><strong>ä¹è§‚é”</strong>ï¼šå‡è®¾ä¸ä¼šå†²çªï¼Œå…ˆæ“ä½œå†æ£€æŸ¥ï¼ˆCASï¼‰ã€‚</li></ul><hr><h2 id="å…­ã€JVM-å†…å­˜æ¨¡å‹"><a href="#å…­ã€JVM-å†…å­˜æ¨¡å‹" class="headerlink" title="å…­ã€JVM &amp; å†…å­˜æ¨¡å‹"></a>å…­ã€JVM &amp; å†…å­˜æ¨¡å‹</h2><hr><h3 id="1-JVM-å†…å­˜ç»“æ„ï¼Ÿ"><a href="#1-JVM-å†…å­˜ç»“æ„ï¼Ÿ" class="headerlink" title="1. JVM å†…å­˜ç»“æ„ï¼Ÿ"></a>1. JVM å†…å­˜ç»“æ„ï¼Ÿ</h3><p>JVM è¿è¡Œæ—¶ä¸»è¦åˆ†ä¸ºï¼š</p><ul><li><strong>å †ï¼ˆHeapï¼‰</strong>ï¼šå­˜æ”¾å¯¹è±¡å®ä¾‹ï¼Œåƒåœ¾å›æ”¶çš„ä¸»è¦åŒºåŸŸã€‚</li><li><strong>è™šæ‹Ÿæœºæ ˆï¼ˆStackï¼‰</strong>ï¼šå­˜æ”¾æ–¹æ³•è°ƒç”¨çš„å±€éƒ¨å˜é‡ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€è¿”å›åœ°å€ã€‚</li><li><strong>æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Method Stackï¼‰</strong>ï¼šä¸º native æ–¹æ³•æœåŠ¡ã€‚</li><li><strong>ç¨‹åºè®¡æ•°å™¨ï¼ˆPC Registerï¼‰</strong>ï¼šè®°å½•çº¿ç¨‹å½“å‰æ‰§è¡Œçš„å­—èŠ‚ç ä½ç½®ã€‚</li><li><strong>æ–¹æ³•åŒºï¼ˆMethod Area &#x2F; Metaspaceï¼‰</strong>ï¼šå­˜æ”¾ç±»å…ƒæ•°æ®ã€å¸¸é‡æ± ã€é™æ€å˜é‡ã€JIT ç¼–è¯‘åçš„ä»£ç ã€‚</li></ul><hr><h3 id="2-å †å’Œæ ˆçš„åŒºåˆ«ï¼Ÿ"><a href="#2-å †å’Œæ ˆçš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="2. å †å’Œæ ˆçš„åŒºåˆ«ï¼Ÿ"></a>2. å †å’Œæ ˆçš„åŒºåˆ«ï¼Ÿ</h3><ul><li><strong>å †</strong>ï¼šå­˜æ”¾å¯¹è±¡å®ä¾‹ï¼Œçº¿ç¨‹å…±äº«ï¼Œéœ€åƒåœ¾å›æ”¶ã€‚</li><li><strong>æ ˆ</strong>ï¼šå­˜æ”¾æ–¹æ³•å¸§ã€å±€éƒ¨å˜é‡ï¼Œçº¿ç¨‹ç§æœ‰ï¼Œç”Ÿå‘½å‘¨æœŸéšçº¿ç¨‹ç»“æŸã€‚</li></ul><hr><h3 id="3-å †å†…å­˜çš„åˆ†ä»£æ¨¡å‹ï¼Ÿ"><a href="#3-å †å†…å­˜çš„åˆ†ä»£æ¨¡å‹ï¼Ÿ" class="headerlink" title="3. å †å†…å­˜çš„åˆ†ä»£æ¨¡å‹ï¼Ÿ"></a>3. å †å†…å­˜çš„åˆ†ä»£æ¨¡å‹ï¼Ÿ</h3><ul><li><strong>æ–°ç”Ÿä»£ï¼ˆYoung Generationï¼‰</strong>ï¼šEden + Survivorï¼ˆS0&#x2F;S1ï¼‰ã€‚</li><li><strong>è€å¹´ä»£ï¼ˆOld Generationï¼‰</strong>ï¼šå­˜æ”¾é•¿ç”Ÿå‘½å‘¨æœŸå¯¹è±¡ã€‚</li><li><strong>æ°¸ä¹…ä»£&#x2F;å…ƒç©ºé—´</strong>ï¼šå­˜æ”¾ç±»å…ƒä¿¡æ¯ã€å¸¸é‡æ± ã€‚</li></ul><hr><h3 id="4-æ–°ç”Ÿä»£ã€è€å¹´ä»£ã€æ°¸ä¹…ä»£çš„åŒºåˆ«ï¼Ÿ"><a href="#4-æ–°ç”Ÿä»£ã€è€å¹´ä»£ã€æ°¸ä¹…ä»£çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="4. æ–°ç”Ÿä»£ã€è€å¹´ä»£ã€æ°¸ä¹…ä»£çš„åŒºåˆ«ï¼Ÿ"></a>4. æ–°ç”Ÿä»£ã€è€å¹´ä»£ã€æ°¸ä¹…ä»£çš„åŒºåˆ«ï¼Ÿ</h3><ul><li><strong>æ–°ç”Ÿä»£</strong>ï¼šå¯¹è±¡æ–°å»ºæ—¶åˆ†é…ï¼Œå¤§éƒ¨åˆ†å¯¹è±¡â€œæœç”Ÿå¤•æ­»â€ã€‚</li><li><strong>è€å¹´ä»£</strong>ï¼šå­˜æ´»æ—¶é—´é•¿æˆ–å¤§å¯¹è±¡ç›´æ¥è¿›å…¥ã€‚</li><li><strong>æ°¸ä¹…ä»£ï¼ˆJDK 7 åŠä¹‹å‰ï¼‰</strong>ï¼šå­˜æ”¾ç±»ä¿¡æ¯ã€é™æ€å˜é‡ã€‚</li><li><strong>å…ƒç©ºé—´ï¼ˆJDK 8 ä¹‹åï¼‰</strong>ï¼šæ›¿ä»£æ°¸ä¹…ä»£ï¼Œä½¿ç”¨æœ¬åœ°å†…å­˜ï¼Œé¿å… OOM: PermGenã€‚</li></ul><hr><h3 id="5-å…ƒç©ºé—´å’Œæ°¸ä¹…ä»£çš„åŒºåˆ«ï¼Ÿ"><a href="#5-å…ƒç©ºé—´å’Œæ°¸ä¹…ä»£çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="5. å…ƒç©ºé—´å’Œæ°¸ä¹…ä»£çš„åŒºåˆ«ï¼Ÿ"></a>5. å…ƒç©ºé—´å’Œæ°¸ä¹…ä»£çš„åŒºåˆ«ï¼Ÿ</h3><ul><li>æ°¸ä¹…ä»£ï¼ˆPermGenï¼‰ï¼šä½¿ç”¨ JVM å†…å­˜ï¼Œå®¹æ˜“ OOMã€‚</li><li>å…ƒç©ºé—´ï¼ˆMetaspaceï¼‰ï¼šä½¿ç”¨æœ¬åœ°å†…å­˜ï¼Œç†è®ºä¸Šæ›´å¤§ï¼Œæ›´çµæ´»ã€‚</li></ul><hr><h3 id="6-å¯¹è±¡åœ¨å †ä¸­çš„åˆ†é…è¿‡ç¨‹ï¼Ÿ"><a href="#6-å¯¹è±¡åœ¨å †ä¸­çš„åˆ†é…è¿‡ç¨‹ï¼Ÿ" class="headerlink" title="6. å¯¹è±¡åœ¨å †ä¸­çš„åˆ†é…è¿‡ç¨‹ï¼Ÿ"></a>6. å¯¹è±¡åœ¨å †ä¸­çš„åˆ†é…è¿‡ç¨‹ï¼Ÿ</h3><ol><li>åœ¨ Eden åŒºåˆ†é…ã€‚</li><li>Minor GC æ—¶ï¼Œå¹¸å­˜çš„å¯¹è±¡è¿›å…¥ Survivor åŒºã€‚</li><li>å¤šæ¬¡ Minor GC ä»å­˜æ´» â†’ æ™‹å‡è€å¹´ä»£ã€‚</li><li>å¤§å¯¹è±¡ï¼ˆå¦‚å¤§æ•°ç»„ï¼‰å¯èƒ½ç›´æ¥è¿›å…¥è€å¹´ä»£ã€‚</li></ol><hr><h3 id="7-å¯¹è±¡ä»€ä¹ˆæ—¶å€™è¿›å…¥è€å¹´ä»£ï¼Ÿ"><a href="#7-å¯¹è±¡ä»€ä¹ˆæ—¶å€™è¿›å…¥è€å¹´ä»£ï¼Ÿ" class="headerlink" title="7. å¯¹è±¡ä»€ä¹ˆæ—¶å€™è¿›å…¥è€å¹´ä»£ï¼Ÿ"></a>7. å¯¹è±¡ä»€ä¹ˆæ—¶å€™è¿›å…¥è€å¹´ä»£ï¼Ÿ</h3><ul><li>åœ¨ Survivor åŒºç»è¿‡å¤šæ¬¡ Minor GCï¼Œè¾¾åˆ°æ™‹å‡é˜ˆå€¼ï¼ˆé»˜è®¤ 15 æ¬¡ï¼‰ã€‚</li><li>å¤§å¯¹è±¡è¶…è¿‡é˜ˆå€¼ï¼Œç›´æ¥è¿›å…¥è€å¹´ä»£ã€‚</li><li>Survivor åŒºæ”¾ä¸ä¸‹ï¼Œç›´æ¥è¿›å…¥è€å¹´ä»£ã€‚</li></ul><hr><h3 id="8-JVM-çš„åƒåœ¾å›æ”¶ç®—æ³•ï¼Ÿ"><a href="#8-JVM-çš„åƒåœ¾å›æ”¶ç®—æ³•ï¼Ÿ" class="headerlink" title="8. JVM çš„åƒåœ¾å›æ”¶ç®—æ³•ï¼Ÿ"></a>8. JVM çš„åƒåœ¾å›æ”¶ç®—æ³•ï¼Ÿ</h3><ul><li><strong>æ ‡è®°-æ¸…é™¤</strong>ï¼šæ ‡è®°å­˜æ´»å¯¹è±¡ï¼Œæ¸…é™¤æœªæ ‡è®°ã€‚ç¼ºç‚¹ï¼šç¢ç‰‡å¤šã€‚</li><li><strong>æ ‡è®°-æ•´ç†</strong>ï¼šæ ‡è®°å­˜æ´»å¯¹è±¡å¹¶ç§»åŠ¨ï¼Œæ•´ç†å†…å­˜ï¼Œé¿å…ç¢ç‰‡ã€‚</li><li><strong>å¤åˆ¶ç®—æ³•</strong>ï¼šå°†æ´»å¯¹è±¡å¤åˆ¶åˆ°æ–°åŒºåŸŸï¼Œæ¸…ç©ºæ—§åŒºåŸŸï¼Œé€‚åˆæ–°ç”Ÿä»£ã€‚</li></ul><hr><h3 id="9-åƒåœ¾æ”¶é›†å™¨æœ‰å“ªäº›ï¼Ÿ"><a href="#9-åƒåœ¾æ”¶é›†å™¨æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="9. åƒåœ¾æ”¶é›†å™¨æœ‰å“ªäº›ï¼Ÿ"></a>9. åƒåœ¾æ”¶é›†å™¨æœ‰å“ªäº›ï¼Ÿ</h3><ul><li><strong>Serial</strong>ï¼ˆå•çº¿ç¨‹ï¼Œé€‚åˆå°å†…å­˜ï¼‰ã€‚</li><li><strong>ParNew</strong>ï¼ˆå¤šçº¿ç¨‹ç‰ˆ Serialï¼‰ã€‚</li><li><strong>Parallel Scavengeï¼ˆååé‡ä¼˜å…ˆï¼‰</strong>ã€‚</li><li><strong>CMSï¼ˆä½å»¶è¿Ÿï¼Œå“åº”å¿«ï¼‰</strong>ã€‚</li><li><strong>G1ï¼ˆåŒºåŸŸåŒ–ï¼Œå‡è¡¡åœé¡¿æ—¶é—´ï¼‰</strong>ã€‚</li><li><strong>ZGCã€Shenandoahï¼ˆè¶…ä½å»¶è¿Ÿï¼Œé€‚åˆå¤§å†…å­˜åœºæ™¯ï¼‰</strong>ã€‚</li></ul><hr><h3 id="10-CMS-å’Œ-G1-çš„åŒºåˆ«ï¼Ÿ"><a href="#10-CMS-å’Œ-G1-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="10. CMS å’Œ G1 çš„åŒºåˆ«ï¼Ÿ"></a>10. CMS å’Œ G1 çš„åŒºåˆ«ï¼Ÿ</h3><ul><li><strong>CMS</strong>ï¼šå¹¶å‘æ”¶é›†ï¼Œä½å»¶è¿Ÿï¼Œä½†å¯èƒ½äº§ç”Ÿå†…å­˜ç¢ç‰‡ã€‚</li><li><strong>G1</strong>ï¼šåŸºäºåˆ†åŒºï¼ˆRegionï¼‰ï¼Œå¯é¢„æµ‹åœé¡¿æ—¶é—´ï¼Œæ•´ç†å†…å­˜ï¼Œé€‚åˆå¤§å †å†…å­˜ã€‚</li></ul><hr><h3 id="11-Minor-GC-å’Œ-Full-GC-çš„åŒºåˆ«ï¼Ÿ"><a href="#11-Minor-GC-å’Œ-Full-GC-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="11. Minor GC å’Œ Full GC çš„åŒºåˆ«ï¼Ÿ"></a>11. Minor GC å’Œ Full GC çš„åŒºåˆ«ï¼Ÿ</h3><ul><li><strong>Minor GC</strong>ï¼šå›æ”¶æ–°ç”Ÿä»£ï¼Œé€Ÿåº¦å¿«ï¼Œé¢‘ç¹ã€‚</li><li><strong>Full GC</strong>ï¼šå›æ”¶æ•´ä¸ªå †ï¼ˆæ–°ç”Ÿä»£ + è€å¹´ä»£ + å…ƒç©ºé—´ï¼‰ï¼Œè€—æ—¶é•¿ï¼Œé¢‘ç‡ä½ã€‚</li></ul><hr><h3 id="12-ä»€ä¹ˆæ˜¯-Stop-The-Worldï¼Ÿ"><a href="#12-ä»€ä¹ˆæ˜¯-Stop-The-Worldï¼Ÿ" class="headerlink" title="12. ä»€ä¹ˆæ˜¯ Stop The Worldï¼Ÿ"></a>12. ä»€ä¹ˆæ˜¯ Stop The Worldï¼Ÿ</h3><ul><li>GC æœŸé—´ï¼Œæ‰€æœ‰å·¥ä½œçº¿ç¨‹å¿…é¡»åœä¸‹æ¥ç­‰å¾…ï¼Œé€ æˆåº”ç”¨æš‚åœï¼ˆSTWï¼‰ã€‚</li><li>STW æ˜¯ä¸å¯é¿å…çš„ï¼Œåªèƒ½å°½é‡å‡å°‘æ—¶é•¿ã€‚</li></ul><hr><h3 id="13-JVM-å¸¸è§çš„è°ƒä¼˜å‚æ•°ï¼Ÿ"><a href="#13-JVM-å¸¸è§çš„è°ƒä¼˜å‚æ•°ï¼Ÿ" class="headerlink" title="13. JVM å¸¸è§çš„è°ƒä¼˜å‚æ•°ï¼Ÿ"></a>13. JVM å¸¸è§çš„è°ƒä¼˜å‚æ•°ï¼Ÿ</h3><ul><li><code>-Xms</code> åˆå§‹å †å¤§å°ã€‚</li><li><code>-Xmx</code> æœ€å¤§å †å¤§å°ã€‚</li><li><code>-Xmn</code> æ–°ç”Ÿä»£å¤§å°ã€‚</li><li><code>-XX:SurvivorRatio</code> Eden:Survivor æ¯”ä¾‹ã€‚</li><li><code>-XX:+PrintGCDetails</code> æ‰“å° GC æ—¥å¿—ã€‚</li><li><code>-XX:+UseG1GC</code> æŒ‡å®šåƒåœ¾æ”¶é›†å™¨ã€‚</li><li><code>-XX:MaxMetaspaceSize</code> å…ƒç©ºé—´å¤§å°ã€‚</li></ul><hr><h3 id="14-ç±»åŠ è½½çš„åŒäº²å§”æ´¾æœºåˆ¶ï¼Ÿ"><a href="#14-ç±»åŠ è½½çš„åŒäº²å§”æ´¾æœºåˆ¶ï¼Ÿ" class="headerlink" title="14. ç±»åŠ è½½çš„åŒäº²å§”æ´¾æœºåˆ¶ï¼Ÿ"></a>14. ç±»åŠ è½½çš„åŒäº²å§”æ´¾æœºåˆ¶ï¼Ÿ</h3><ul><li><strong>è¿‡ç¨‹</strong>ï¼šåŠ è½½è¯·æ±‚å…ˆäº¤ç»™çˆ¶åŠ è½½å™¨ï¼Œå¦‚æœçˆ¶åŠ è½½å™¨æ— æ³•åŠ è½½ï¼Œå†ç”±å­åŠ è½½å™¨åŠ è½½ã€‚</li></ul><hr><h3 id="15-åŒäº²å§”æ´¾çš„å¥½å¤„ï¼Ÿ"><a href="#15-åŒäº²å§”æ´¾çš„å¥½å¤„ï¼Ÿ" class="headerlink" title="15. åŒäº²å§”æ´¾çš„å¥½å¤„ï¼Ÿ"></a>15. åŒäº²å§”æ´¾çš„å¥½å¤„ï¼Ÿ</h3><ul><li>é¿å…ç±»é‡å¤åŠ è½½ã€‚</li><li>ä¿è¯æ ¸å¿ƒç±»ï¼ˆå¦‚ java.lang.Stringï¼‰ä¸ä¼šè¢«ç¯¡æ”¹ã€‚</li></ul><hr><h3 id="16-ç±»åŠ è½½å™¨çš„ç§ç±»ï¼Ÿ"><a href="#16-ç±»åŠ è½½å™¨çš„ç§ç±»ï¼Ÿ" class="headerlink" title="16. ç±»åŠ è½½å™¨çš„ç§ç±»ï¼Ÿ"></a>16. ç±»åŠ è½½å™¨çš„ç§ç±»ï¼Ÿ</h3><ul><li><strong>Bootstrap ClassLoader</strong>ï¼šåŠ è½½æ ¸å¿ƒç±»åº“ã€‚</li><li><strong>Extension ClassLoader</strong>ï¼šåŠ è½½æ‰©å±•ç±»ã€‚</li><li><strong>Application ClassLoader</strong>ï¼šåŠ è½½ç”¨æˆ·åº”ç”¨ç±»ã€‚</li><li><strong>è‡ªå®šä¹‰ ClassLoader</strong>ï¼šç”¨æˆ·è‡ªå·±æ‰©å±•ã€‚</li></ul><hr><h3 id="17-OOM-çš„å¸¸è§ç±»å‹ï¼Ÿ"><a href="#17-OOM-çš„å¸¸è§ç±»å‹ï¼Ÿ" class="headerlink" title="17. OOM çš„å¸¸è§ç±»å‹ï¼Ÿ"></a>17. OOM çš„å¸¸è§ç±»å‹ï¼Ÿ</h3><ul><li><strong>Java heap space</strong>ï¼šå †æº¢å‡ºã€‚</li><li><strong>GC overhead limit exceeded</strong>ï¼šGC å›æ”¶æ— æ•ˆã€‚</li><li><strong>Metaspace</strong>ï¼šå…ƒç©ºé—´æº¢å‡ºã€‚</li><li><strong>Direct buffer memory</strong>ï¼šç›´æ¥å†…å­˜æº¢å‡ºã€‚</li><li><strong>Unable to create new native thread</strong>ï¼šçº¿ç¨‹æ•°è¿‡å¤šã€‚</li></ul><hr><h3 id="18-å†…å­˜æ³„æ¼å’Œå†…å­˜æº¢å‡ºçš„åŒºåˆ«ï¼Ÿ"><a href="#18-å†…å­˜æ³„æ¼å’Œå†…å­˜æº¢å‡ºçš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="18. å†…å­˜æ³„æ¼å’Œå†…å­˜æº¢å‡ºçš„åŒºåˆ«ï¼Ÿ"></a>18. å†…å­˜æ³„æ¼å’Œå†…å­˜æº¢å‡ºçš„åŒºåˆ«ï¼Ÿ</h3><ul><li><strong>å†…å­˜æ³„æ¼</strong>ï¼šä¸å†ä½¿ç”¨çš„å¯¹è±¡ä»ç„¶è¢«å¼•ç”¨ï¼Œä¸èƒ½è¢« GC å›æ”¶ã€‚</li><li><strong>å†…å­˜æº¢å‡º</strong>ï¼šå†…å­˜ä¸è¶³ï¼Œç”³è¯·ä¸åˆ°æ›´å¤šç©ºé—´ã€‚</li></ul><hr><h3 id="19-finalize-æ–¹æ³•çš„ä½œç”¨ï¼Ÿ"><a href="#19-finalize-æ–¹æ³•çš„ä½œç”¨ï¼Ÿ" class="headerlink" title="19. finalize() æ–¹æ³•çš„ä½œç”¨ï¼Ÿ"></a>19. finalize() æ–¹æ³•çš„ä½œç”¨ï¼Ÿ</h3><ul><li>å¯¹è±¡è¢« GC å‰æ‰§è¡Œä¸€æ¬¡æ¸…ç†é€»è¾‘ã€‚</li><li>ç¼ºç‚¹ï¼šæ‰§è¡Œä¸ç¡®å®šã€æ€§èƒ½å·®ï¼ŒJDK9 å¼€å§‹åºŸå¼ƒï¼Œæ¨èä½¿ç”¨ <strong>try-with-resources&#x2F;AutoCloseable</strong>ã€‚</li></ul><hr><h3 id="20-Java-å†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰çš„æ ¸å¿ƒå†…å®¹ï¼Ÿ"><a href="#20-Java-å†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰çš„æ ¸å¿ƒå†…å®¹ï¼Ÿ" class="headerlink" title="20. Java å†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰çš„æ ¸å¿ƒå†…å®¹ï¼Ÿ"></a>20. Java å†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰çš„æ ¸å¿ƒå†…å®¹ï¼Ÿ</h3><ul><li>å®šä¹‰äº†å¤šçº¿ç¨‹å¦‚ä½•å…±äº«å†…å­˜ã€‚</li><li>å…³é”®ç‚¹ï¼š<ul><li><strong>ä¸»å†…å­˜</strong>ï¼šå­˜æ”¾å…±äº«å˜é‡ã€‚</li><li><strong>å·¥ä½œå†…å­˜</strong>ï¼šæ¯ä¸ªçº¿ç¨‹çš„æœ¬åœ°å‰¯æœ¬ã€‚</li><li><strong>happens-before è§„åˆ™</strong>ï¼šä¿è¯å¯è§æ€§ã€æœ‰åºæ€§ã€‚</li><li><strong>volatileã€synchronizedã€final</strong> æä¾›å†…å­˜è¯­ä¹‰ã€‚</li></ul></li></ul><hr><h2 id="ä¸ƒã€æ³›å‹ã€æ³¨è§£ã€åå°„"><a href="#ä¸ƒã€æ³›å‹ã€æ³¨è§£ã€åå°„" class="headerlink" title="ä¸ƒã€æ³›å‹ã€æ³¨è§£ã€åå°„"></a>ä¸ƒã€æ³›å‹ã€æ³¨è§£ã€åå°„</h2><hr><h3 id="1-ä»€ä¹ˆæ˜¯æ³›å‹ï¼Ÿ"><a href="#1-ä»€ä¹ˆæ˜¯æ³›å‹ï¼Ÿ" class="headerlink" title="1. ä»€ä¹ˆæ˜¯æ³›å‹ï¼Ÿ"></a>1. ä»€ä¹ˆæ˜¯æ³›å‹ï¼Ÿ</h3><ul><li><p><strong>å®šä¹‰</strong>ï¼šæ³›å‹ï¼ˆGenericï¼‰æ˜¯ <strong>å‚æ•°åŒ–ç±»å‹</strong>ï¼Œè®©ç±»ã€æ¥å£ã€æ–¹æ³•å¯ä»¥æ“ä½œä¸åŒç±»å‹çš„æ•°æ®ï¼Œè€Œä¸ç”¨ç¼–å†™é‡å¤ä»£ç ã€‚</p></li><li><p><strong>å¥½å¤„</strong>ï¼š</p><ol><li><strong>ç±»å‹å®‰å…¨</strong>ï¼ˆç¼–è¯‘æœŸæ£€æŸ¥ï¼Œé¿å… <code>ClassCastException</code>ï¼‰ã€‚</li><li><strong>ä»£ç å¤ç”¨</strong>ï¼ˆç›¸åŒé€»è¾‘å¯é€‚é…å¤šç§ç±»å‹ï¼‰ã€‚</li><li><strong>å¯è¯»æ€§é«˜</strong>ï¼ˆç±»å‹æ˜ç¡®ï¼‰ã€‚</li></ol></li><li><p><strong>ä¾‹å­</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">list.add(<span class="string">&quot;abc&quot;</span>); <span class="comment">// ç¼–è¯‘æœŸæ£€æŸ¥ç±»å‹</span></span><br></pre></td></tr></table></figure></li></ul><hr><h3 id="2-æ³›å‹çš„ç±»å‹æ“¦é™¤æœºåˆ¶ï¼Ÿ"><a href="#2-æ³›å‹çš„ç±»å‹æ“¦é™¤æœºåˆ¶ï¼Ÿ" class="headerlink" title="2. æ³›å‹çš„ç±»å‹æ“¦é™¤æœºåˆ¶ï¼Ÿ"></a>2. æ³›å‹çš„ç±»å‹æ“¦é™¤æœºåˆ¶ï¼Ÿ</h3><ul><li><p><strong>åŸç†</strong>ï¼šJava çš„æ³›å‹æ˜¯ <strong>ä¼ªæ³›å‹</strong>ï¼Œåªåœ¨ <strong>ç¼–è¯‘æœŸæœ‰æ•ˆ</strong>ï¼Œç¼–è¯‘åæ³›å‹ä¿¡æ¯è¢«æ“¦é™¤ï¼ˆType Erasureï¼‰ã€‚</p></li><li><p><strong>ç»“æœ</strong>ï¼š</p><ul><li><code>List&lt;String&gt;</code> å’Œ <code>List&lt;Integer&gt;</code> åœ¨è¿è¡Œæ—¶æ˜¯åŒä¸€ä¸ªç±»å‹ï¼š<code>List</code>ã€‚</li><li>æ³›å‹æ–¹æ³•çš„ç±»å‹å‚æ•°ä¼šè¢«æ“¦é™¤ä¸º <strong>ä¸Šç•Œï¼ˆextendsï¼‰æˆ– Object</strong>ã€‚</li></ul></li><li><p><strong>ä¾‹å­</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; l1 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">List&lt;Integer&gt; l2 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">System.out.println(l1.getClass() == l2.getClass()); <span class="comment">// true</span></span><br></pre></td></tr></table></figure></li></ul><hr><h3 id="3-æ³›å‹é€šé…ç¬¦-extends-å’Œ-super-çš„åŒºåˆ«ï¼Ÿ"><a href="#3-æ³›å‹é€šé…ç¬¦-extends-å’Œ-super-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="3. æ³›å‹é€šé…ç¬¦ ? extends å’Œ ? super çš„åŒºåˆ«ï¼Ÿ"></a>3. æ³›å‹é€šé…ç¬¦ ? extends å’Œ ? super çš„åŒºåˆ«ï¼Ÿ</h3><ul><li><code>? extends T</code>ï¼šè¡¨ç¤ºç±»å‹çš„ <strong>ä¸Šç•Œ</strong>ï¼Œæ¥å— <code>T</code> åŠå…¶å­ç±»ã€‚<ul><li>é€‚åˆ <strong>ç”Ÿäº§è€…ï¼ˆProducerï¼‰</strong>ï¼Œåªè¯»ï¼Œä¸å¯å†™ã€‚</li></ul></li><li><code>? super T</code>ï¼šè¡¨ç¤ºç±»å‹çš„ <strong>ä¸‹ç•Œ</strong>ï¼Œæ¥å— <code>T</code> åŠå…¶çˆ¶ç±»ã€‚<ul><li>é€‚åˆ <strong>æ¶ˆè´¹è€…ï¼ˆConsumerï¼‰</strong>ï¼Œå¯ä»¥å†™å…¥ T åŠå…¶å­ç±»å¯¹è±¡ã€‚</li></ul></li><li><strong>å£è¯€</strong>ï¼šPECSï¼ˆProducer Extends, Consumer Superï¼‰ã€‚</li></ul><hr><h3 id="4-æ³¨è§£çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#4-æ³¨è§£çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="4. æ³¨è§£çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ"></a>4. æ³¨è§£çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</h3><ul><li><strong>ä½œç”¨</strong>ï¼šæ³¨è§£ï¼ˆAnnotationï¼‰æ˜¯ <strong>å…ƒæ•°æ®</strong>ï¼Œä¸ºä»£ç æä¾›è¯´æ˜ä¿¡æ¯ã€‚</li><li><strong>åˆ†ç±»</strong>ï¼š<ul><li>ç¼–è¯‘æœŸä½¿ç”¨ï¼ˆå¦‚ <code>@Override</code>, <code>@SuppressWarnings</code>ï¼‰ã€‚</li><li>è¿è¡Œæ—¶ä½¿ç”¨ï¼ˆç»“åˆåå°„ï¼Œé©±åŠ¨æ¡†æ¶é€»è¾‘ï¼Œå¦‚ <code>@Autowired</code>ï¼‰ã€‚</li></ul></li><li><strong>åº”ç”¨åœºæ™¯</strong>ï¼šæ¡†æ¶å¼€å‘ï¼ˆSpringã€Hibernateï¼‰ã€ç¼–è¯‘å™¨æ£€æŸ¥ã€æ–‡æ¡£ç”Ÿæˆç­‰ã€‚</li></ul><hr><h3 id="5-å…ƒæ³¨è§£æœ‰å“ªäº›ï¼Ÿ"><a href="#5-å…ƒæ³¨è§£æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="5. å…ƒæ³¨è§£æœ‰å“ªäº›ï¼Ÿ"></a>5. å…ƒæ³¨è§£æœ‰å“ªäº›ï¼Ÿ</h3><p>Java æä¾›äº†å››ä¸ªå…ƒæ³¨è§£ï¼ˆæ³¨è§£çš„æ³¨è§£ï¼‰ï¼š</p><ol><li><code>@Target</code> â€”â€” æŒ‡å®šæ³¨è§£å¯ç”¨çš„ä½ç½®ï¼ˆç±»ã€æ–¹æ³•ã€å­—æ®µã€å‚æ•°ç­‰ï¼‰ã€‚</li><li><code>@Retention</code> â€”â€” æŒ‡å®šæ³¨è§£çš„ç”Ÿå‘½å‘¨æœŸï¼ˆæºç &#x2F;ç¼–è¯‘æœŸ&#x2F;è¿è¡Œæ—¶ï¼‰ã€‚</li><li><code>@Documented</code> â€”â€” æ˜¯å¦åŒ…å«åœ¨ javadoc ä¸­ã€‚</li><li><code>@Inherited</code> â€”â€” å­ç±»æ˜¯å¦èƒ½ç»§æ‰¿çˆ¶ç±»çš„æ³¨è§£ã€‚</li></ol><hr><h3 id="6-è‡ªå®šä¹‰æ³¨è§£å¦‚ä½•å®ç°ï¼Ÿ"><a href="#6-è‡ªå®šä¹‰æ³¨è§£å¦‚ä½•å®ç°ï¼Ÿ" class="headerlink" title="6. è‡ªå®šä¹‰æ³¨è§£å¦‚ä½•å®ç°ï¼Ÿ"></a>6. è‡ªå®šä¹‰æ³¨è§£å¦‚ä½•å®ç°ï¼Ÿ</h3><ul><li><p><strong>å®šä¹‰</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.METHOD)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MyAnnotation &#123;</span><br><span class="line">    String <span class="title function_">value</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>ä½¿ç”¨</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MyAnnotation(&quot;test&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">foo</span><span class="params">()</span> &#123;&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>è§£æ</strong>ï¼ˆåå°„ï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Method</span> <span class="variable">m</span> <span class="operator">=</span> clazz.getMethod(<span class="string">&quot;foo&quot;</span>);</span><br><span class="line"><span class="type">MyAnnotation</span> <span class="variable">ann</span> <span class="operator">=</span> m.getAnnotation(MyAnnotation.class);</span><br><span class="line">System.out.println(ann.value());</span><br></pre></td></tr></table></figure></li></ul><hr><h3 id="7-åå°„çš„ä½œç”¨ï¼Ÿ"><a href="#7-åå°„çš„ä½œç”¨ï¼Ÿ" class="headerlink" title="7. åå°„çš„ä½œç”¨ï¼Ÿ"></a>7. åå°„çš„ä½œç”¨ï¼Ÿ</h3><ul><li><strong>å®šä¹‰</strong>ï¼šåå°„ï¼ˆReflectionï¼‰å…è®¸ç¨‹åºåœ¨ <strong>è¿è¡Œæ—¶</strong> è·å–ç±»çš„ä¿¡æ¯ï¼Œå¹¶æ“ä½œå…¶å±æ€§ã€æ–¹æ³•ã€æ„é€ å™¨ã€‚</li><li><strong>ä½œç”¨</strong>ï¼š<ul><li>æ¡†æ¶ï¼ˆå¦‚ Springã€MyBatisï¼‰è‡ªåŠ¨æ³¨å…¥å’Œé…ç½®ã€‚</li><li>åŠ¨æ€ä»£ç†ã€‚</li><li>åŠ¨æ€åŠ è½½ç±»ã€‚</li></ul></li></ul><hr><h3 id="8-åå°„çš„æ€§èƒ½é—®é¢˜ï¼Ÿ"><a href="#8-åå°„çš„æ€§èƒ½é—®é¢˜ï¼Ÿ" class="headerlink" title="8. åå°„çš„æ€§èƒ½é—®é¢˜ï¼Ÿ"></a>8. åå°„çš„æ€§èƒ½é—®é¢˜ï¼Ÿ</h3><ul><li><strong>åŸå› </strong>ï¼š<ul><li>åå°„è°ƒç”¨æ–¹æ³•æ¯”ç›´æ¥è°ƒç”¨å¤šäº†å®‰å…¨æ£€æŸ¥ã€æ–¹æ³•æŸ¥æ‰¾ï¼Œæ€§èƒ½å·® 10~20 å€ã€‚</li></ul></li><li><strong>ä¼˜åŒ–</strong>ï¼š<ul><li>ä½¿ç”¨ <code>setAccessible(true)</code> å…³é—­å®‰å…¨æ£€æŸ¥ã€‚</li><li>ä½¿ç”¨ <code>MethodHandle</code>ï¼ˆJDK7+ï¼‰ã€‚</li><li>ä½¿ç”¨ <code>LambdaMetafactory</code>ï¼ˆJDK8+ï¼‰åšåŠ¨æ€ä»£ç†ã€‚</li></ul></li></ul><hr><h3 id="9-åå°„èƒ½å¦è®¿é—®ç§æœ‰å­—æ®µï¼Ÿ"><a href="#9-åå°„èƒ½å¦è®¿é—®ç§æœ‰å­—æ®µï¼Ÿ" class="headerlink" title="9. åå°„èƒ½å¦è®¿é—®ç§æœ‰å­—æ®µï¼Ÿ"></a>9. åå°„èƒ½å¦è®¿é—®ç§æœ‰å­—æ®µï¼Ÿ</h3><ul><li><p><strong>èƒ½</strong>ï¼Œéœ€è¦ <code>setAccessible(true)</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> clazz.getDeclaredField(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">field.set(obj, <span class="string">&quot;newValue&quot;</span>);</span><br></pre></td></tr></table></figure></li><li><p><strong>æ³¨æ„</strong>ï¼šJDK 9 æ¨¡å—åŒ–åï¼Œè·¨æ¨¡å—è®¿é—®å¯èƒ½ä¼šæœ‰ <code>InaccessibleObjectException</code>ã€‚</p></li></ul><hr><h3 id="10-åŠ¨æ€ä»£ç†çš„ä¸¤ç§å®ç°æ–¹å¼ï¼Ÿ"><a href="#10-åŠ¨æ€ä»£ç†çš„ä¸¤ç§å®ç°æ–¹å¼ï¼Ÿ" class="headerlink" title="10. åŠ¨æ€ä»£ç†çš„ä¸¤ç§å®ç°æ–¹å¼ï¼Ÿ"></a>10. åŠ¨æ€ä»£ç†çš„ä¸¤ç§å®ç°æ–¹å¼ï¼Ÿ</h3><ol><li><strong>JDK åŠ¨æ€ä»£ç†</strong>ï¼šåŸºäº <code>InvocationHandler + Proxy</code>ï¼Œåªèƒ½ä»£ç† <strong>æ¥å£</strong>ã€‚</li><li><strong>CGLIB åŠ¨æ€ä»£ç†</strong>ï¼šåŸºäº ASM å­—èŠ‚ç ç”Ÿæˆï¼Œç»§æ‰¿ç›®æ ‡ç±»ï¼Œèƒ½ä»£ç† <strong>ç±»</strong>ã€‚</li></ol><hr><h3 id="11-JDK-åŠ¨æ€ä»£ç†å’Œ-CGLIB-çš„åŒºåˆ«ï¼Ÿ"><a href="#11-JDK-åŠ¨æ€ä»£ç†å’Œ-CGLIB-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="11. JDK åŠ¨æ€ä»£ç†å’Œ CGLIB çš„åŒºåˆ«ï¼Ÿ"></a>11. JDK åŠ¨æ€ä»£ç†å’Œ CGLIB çš„åŒºåˆ«ï¼Ÿ</h3><ul><li><strong>JDK åŠ¨æ€ä»£ç†</strong>ï¼š<ul><li>ä»£ç†æ¥å£ã€‚</li><li>JDK è‡ªå¸¦ï¼Œæ— éœ€ä¾èµ–ã€‚</li><li>æ€§èƒ½ç•¥ä½ã€‚</li></ul></li><li><strong>CGLIB</strong>ï¼š<ul><li>ä»£ç†ç±»ï¼ˆç”Ÿæˆå­ç±»ï¼‰ã€‚</li><li>ä¸èƒ½ä»£ç† <code>final</code> ç±»&#x2F;æ–¹æ³•ã€‚</li><li>æ€§èƒ½æ›´é«˜ï¼ˆå­—èŠ‚ç ç”Ÿæˆï¼‰ã€‚</li></ul></li></ul><hr><h3 id="12-åå°„å¦‚ä½•åˆ›å»ºå¯¹è±¡ï¼Ÿ"><a href="#12-åå°„å¦‚ä½•åˆ›å»ºå¯¹è±¡ï¼Ÿ" class="headerlink" title="12. åå°„å¦‚ä½•åˆ›å»ºå¯¹è±¡ï¼Ÿ"></a>12. åå°„å¦‚ä½•åˆ›å»ºå¯¹è±¡ï¼Ÿ</h3><ol><li><p><strong>ä½¿ç”¨ Class çš„ <code>newInstance()</code></strong>ï¼ˆå·²åºŸå¼ƒï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> clazz.newInstance();</span><br></pre></td></tr></table></figure></li><li><p><strong>ä½¿ç”¨ Constructor</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Constructor&lt;?&gt; ctor = clazz.getConstructor(String.class);</span><br><span class="line"><span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ctor.newInstance(<span class="string">&quot;param&quot;</span>);</span><br></pre></td></tr></table></figure></li></ol><hr><h3 id="13-Class-forName-å’Œ-ClassLoader-loadClass-çš„åŒºåˆ«ï¼Ÿ"><a href="#13-Class-forName-å’Œ-ClassLoader-loadClass-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="13. Class.forName å’Œ ClassLoader.loadClass çš„åŒºåˆ«ï¼Ÿ"></a>13. Class.forName å’Œ ClassLoader.loadClass çš„åŒºåˆ«ï¼Ÿ</h3><ul><li><strong>Class.forName</strong>ï¼šåŠ è½½å¹¶ <strong>åˆå§‹åŒ–</strong> ç±»ï¼ˆä¼šæ‰§è¡Œé™æ€ä»£ç å—ï¼‰ã€‚</li><li><strong>ClassLoader.loadClass</strong>ï¼šä»…åŠ è½½ï¼Œä¸åˆå§‹åŒ–ï¼ˆå»¶è¿Ÿæ‰§è¡Œ <code>&lt;clinit&gt;</code>ï¼‰ã€‚</li></ul><hr><h3 id="14-æ³¨è§£å’Œåå°„ç»“åˆèƒ½å®ç°å“ªäº›åŠŸèƒ½ï¼Ÿ"><a href="#14-æ³¨è§£å’Œåå°„ç»“åˆèƒ½å®ç°å“ªäº›åŠŸèƒ½ï¼Ÿ" class="headerlink" title="14. æ³¨è§£å’Œåå°„ç»“åˆèƒ½å®ç°å“ªäº›åŠŸèƒ½ï¼Ÿ"></a>14. æ³¨è§£å’Œåå°„ç»“åˆèƒ½å®ç°å“ªäº›åŠŸèƒ½ï¼Ÿ</h3><ul><li>IOC &#x2F; DIï¼ˆä¾èµ–æ³¨å…¥ï¼ŒSpring çš„ <code>@Autowired</code>ï¼‰ã€‚</li><li>ORM æ¡†æ¶ï¼ˆMyBatis çš„ <code>@Mapper</code>ï¼ŒJPA çš„ <code>@Entity</code>ï¼‰ã€‚</li><li>AOPï¼ˆ<code>@Aspect</code>ï¼‰ã€‚</li><li>é…ç½®é©±åŠ¨å¼€å‘ï¼ˆ<code>@Configuration</code>, <code>@Value</code>ï¼‰ã€‚</li></ul><hr><h3 id="15-æ³¨è§£å¤„ç†å™¨ï¼ˆAPTï¼‰çš„ä½œç”¨ï¼Ÿ"><a href="#15-æ³¨è§£å¤„ç†å™¨ï¼ˆAPTï¼‰çš„ä½œç”¨ï¼Ÿ" class="headerlink" title="15. æ³¨è§£å¤„ç†å™¨ï¼ˆAPTï¼‰çš„ä½œç”¨ï¼Ÿ"></a>15. æ³¨è§£å¤„ç†å™¨ï¼ˆAPTï¼‰çš„ä½œç”¨ï¼Ÿ</h3><ul><li><strong>APTï¼ˆAnnotation Processing Toolï¼‰</strong>ï¼šç¼–è¯‘æœŸæ‰«ææ³¨è§£å¹¶ç”Ÿæˆä»£ç ã€‚</li><li><strong>å…¸å‹åº”ç”¨</strong>ï¼š<ul><li>Dagger2ï¼ˆä¾èµ–æ³¨å…¥ï¼‰ã€‚</li><li>ButterKnifeï¼ˆè§†å›¾æ³¨å…¥ï¼‰ã€‚</li><li>Lombokï¼ˆè‡ªåŠ¨ç”Ÿæˆ getter&#x2F;setter&#x2F;toString ç­‰ï¼‰ã€‚</li></ul></li></ul><hr><h2 id="å…«ã€Java-8-æ–°ç‰¹æ€§"><a href="#å…«ã€Java-8-æ–°ç‰¹æ€§" class="headerlink" title="å…«ã€Java 8+ æ–°ç‰¹æ€§"></a>å…«ã€Java 8+ æ–°ç‰¹æ€§</h2><ol><li>Lambda è¡¨è¾¾å¼çš„ä½œç”¨ï¼Ÿ</li><li>å‡½æ•°å¼æ¥å£æœ‰å“ªäº›ï¼Ÿ</li><li>Stream æµçš„å¸¸è§æ“ä½œï¼Ÿ</li><li>Optional çš„ä½œç”¨ï¼Ÿ</li><li>CompletableFuture çš„ä½œç”¨ï¼Ÿ</li><li>Java 8 æ¥å£çš„é»˜è®¤æ–¹æ³•å’Œé™æ€æ–¹æ³•ï¼Ÿ</li><li>forEach å’Œä¼ ç»Ÿ for çš„åŒºåˆ«ï¼Ÿ</li><li>parallelStream çš„åŸç†ï¼Ÿ</li><li>Java 9 æ¨¡å—åŒ–ç³»ç»Ÿï¼ˆJigsawï¼‰æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>Java 14 çš„ switch è¡¨è¾¾å¼å¢å¼ºï¼Ÿ</li><li>Java 16 çš„ record ç‰¹æ€§ï¼Ÿ</li><li>Java 17 çš„ sealed class ç‰¹æ€§ï¼Ÿ</li><li>var å…³é”®å­—æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>ZGC çš„ç‰¹æ€§ï¼Ÿ</li><li>Project Loom çš„è™šæ‹Ÿçº¿ç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ</li></ol><h2 id="ä¹ã€IO"><a href="#ä¹ã€IO" class="headerlink" title="ä¹ã€IO"></a>ä¹ã€IO</h2><hr><h2 id="ä¸€ã€Java-IO-åŸºç¡€ä¸æµï¼ˆ1â€“20ï¼‰"><a href="#ä¸€ã€Java-IO-åŸºç¡€ä¸æµï¼ˆ1â€“20ï¼‰" class="headerlink" title="ä¸€ã€Java IO åŸºç¡€ä¸æµï¼ˆ1â€“20ï¼‰"></a>ä¸€ã€Java IO åŸºç¡€ä¸æµï¼ˆ1â€“20ï¼‰</h2><hr><h3 id="1-Java-IO-çš„æ€»ä½“ä½“ç³»ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#1-Java-IO-çš„æ€»ä½“ä½“ç³»ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1. Java IO çš„æ€»ä½“ä½“ç³»ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿ"></a>1. Java IO çš„æ€»ä½“ä½“ç³»ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿ</h3><ul><li><strong>IO çš„ä¸¤å¤§åŸºç±»</strong>ï¼š<ul><li>å­—èŠ‚æµï¼š<code>InputStream</code>ã€<code>OutputStream</code>ï¼ˆå¤„ç†äºŒè¿›åˆ¶æ•°æ®ï¼‰ã€‚</li><li>å­—ç¬¦æµï¼š<code>Reader</code>ã€<code>Writer</code>ï¼ˆå¤„ç†æ–‡æœ¬å­—ç¬¦ï¼‰ã€‚</li></ul></li><li><strong>æŒ‰åŠŸèƒ½åˆ’åˆ†</strong>ï¼š<ul><li>èŠ‚ç‚¹æµï¼ˆç›´æ¥å¯¹æ¥æ•°æ®æºï¼Œå¦‚ <code>FileInputStream</code>ã€<code>FileReader</code>ï¼‰ã€‚</li><li>å¤„ç†æµï¼ˆåŒ…è£…å…¶ä»–æµï¼Œå¦‚ <code>BufferedReader</code>ã€<code>DataInputStream</code>ï¼‰ã€‚</li></ul></li><li><strong>æ ¸å¿ƒè®¾è®¡æ¨¡å¼</strong>ï¼šè£…é¥°å™¨æ¨¡å¼ï¼ˆDecorator Patternï¼‰ï¼Œé€šè¿‡å±‚å±‚åŒ…è£…å¢å¼ºåŠŸèƒ½ã€‚</li></ul><hr><h3 id="2-InputStream-OutputStream-çš„å¸¸è§å­ç±»æœ‰å“ªäº›ï¼Ÿ"><a href="#2-InputStream-OutputStream-çš„å¸¸è§å­ç±»æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="2. InputStream &#x2F; OutputStream çš„å¸¸è§å­ç±»æœ‰å“ªäº›ï¼Ÿ"></a>2. InputStream &#x2F; OutputStream çš„å¸¸è§å­ç±»æœ‰å“ªäº›ï¼Ÿ</h3><ul><li><strong>InputStream</strong>ï¼š<code>FileInputStream</code>ã€<code>BufferedInputStream</code>ã€<code>DataInputStream</code>ã€<code>ObjectInputStream</code>ã€<code>ByteArrayInputStream</code>ã€‚</li><li><strong>OutputStream</strong>ï¼š<code>FileOutputStream</code>ã€<code>BufferedOutputStream</code>ã€<code>DataOutputStream</code>ã€<code>ObjectOutputStream</code>ã€<code>ByteArrayOutputStream</code>ã€‚</li></ul><hr><h3 id="3-Reader-Writer-çš„å¸¸è§å­ç±»æœ‰å“ªäº›ï¼Ÿ"><a href="#3-Reader-Writer-çš„å¸¸è§å­ç±»æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="3. Reader &#x2F; Writer çš„å¸¸è§å­ç±»æœ‰å“ªäº›ï¼Ÿ"></a>3. Reader &#x2F; Writer çš„å¸¸è§å­ç±»æœ‰å“ªäº›ï¼Ÿ</h3><ul><li><strong>Reader</strong>ï¼š<code>FileReader</code>ã€<code>BufferedReader</code>ã€<code>InputStreamReader</code>ã€<code>CharArrayReader</code>ã€<code>StringReader</code>ã€‚</li><li><strong>Writer</strong>ï¼š<code>FileWriter</code>ã€<code>BufferedWriter</code>ã€<code>OutputStreamWriter</code>ã€<code>CharArrayWriter</code>ã€<code>StringWriter</code>ã€‚</li></ul><hr><h3 id="4-å­—èŠ‚æµä¸å­—ç¬¦æµçš„æœ¬è´¨åŒºåˆ«å’Œä½¿ç”¨åœºæ™¯ï¼Ÿ"><a href="#4-å­—èŠ‚æµä¸å­—ç¬¦æµçš„æœ¬è´¨åŒºåˆ«å’Œä½¿ç”¨åœºæ™¯ï¼Ÿ" class="headerlink" title="4. å­—èŠ‚æµä¸å­—ç¬¦æµçš„æœ¬è´¨åŒºåˆ«å’Œä½¿ç”¨åœºæ™¯ï¼Ÿ"></a>4. å­—èŠ‚æµä¸å­—ç¬¦æµçš„æœ¬è´¨åŒºåˆ«å’Œä½¿ç”¨åœºæ™¯ï¼Ÿ</h3><ul><li><strong>å­—èŠ‚æµ</strong>ï¼ˆ8bitï¼‰ï¼šé¢å‘äºŒè¿›åˆ¶æ•°æ®ï¼Œå¦‚å›¾ç‰‡ã€éŸ³è§†é¢‘ã€å‹ç¼©æ–‡ä»¶ã€‚</li><li><strong>å­—ç¬¦æµ</strong>ï¼ˆ16bitï¼ŒåŸºäº Unicodeï¼‰ï¼šé¢å‘æ–‡æœ¬ï¼Œè‡ªåŠ¨å¤„ç†å­—ç¬¦ç¼–ç ã€‚</li><li><strong>è”ç³»</strong>ï¼šå­—ç¬¦æµå¸¸å¸¸é€šè¿‡ <code>InputStreamReader/OutputStreamWriter</code> åŒ…è£…å­—èŠ‚æµå¹¶æŒ‡å®šç¼–ç ã€‚</li></ul><hr><h3 id="5-ä¸ºä»€ä¹ˆè¦æœ‰ç¼“å†²æµï¼Ÿ"><a href="#5-ä¸ºä»€ä¹ˆè¦æœ‰ç¼“å†²æµï¼Ÿ" class="headerlink" title="5. ä¸ºä»€ä¹ˆè¦æœ‰ç¼“å†²æµï¼Ÿ"></a>5. ä¸ºä»€ä¹ˆè¦æœ‰ç¼“å†²æµï¼Ÿ</h3><ul><li><strong>åŸå› </strong>ï¼šæ–‡ä»¶ IO å±äºç³»ç»Ÿè°ƒç”¨ï¼Œæ¯æ¬¡è¯»å†™ä»£ä»·é«˜ã€‚</li><li><strong>ä½œç”¨</strong>ï¼šå‡å°‘ç£ç›˜äº¤äº’æ¬¡æ•°ï¼Œæé«˜æ€§èƒ½ã€‚</li><li><strong>ä¾‹å­</strong>ï¼š<code>BufferedReader.readLine()</code> èƒ½æŒ‰è¡Œè¯»å–ï¼Œæ•ˆç‡è¿œé«˜äº <code>FileReader.read()</code>ã€‚</li></ul><hr><h3 id="6-flush-ä¸-close-çš„åŒºåˆ«ï¼Ÿ"><a href="#6-flush-ä¸-close-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="6. flush() ä¸ close() çš„åŒºåˆ«ï¼Ÿ"></a>6. flush() ä¸ close() çš„åŒºåˆ«ï¼Ÿ</h3><ul><li><strong>flush()</strong>ï¼šå°†å†…å­˜ç¼“å†²åŒºæ•°æ®ç«‹åˆ»å†™å…¥ç›®æ ‡ï¼ˆä½†ä¸å…³é—­æµï¼‰ã€‚</li><li><strong>close()</strong>ï¼šå…ˆæ‰§è¡Œ <code>flush()</code>ï¼Œç„¶åé‡Šæ”¾åº•å±‚èµ„æºã€‚</li><li><strong>æ³¨æ„ç‚¹</strong>ï¼š<ul><li>è‹¥å¿˜è®° <code>flush()</code>ï¼Œå¯èƒ½å¯¼è‡´éƒ¨åˆ†æ•°æ®æœªå†™å…¥æ–‡ä»¶ã€‚</li><li><code>close()</code> åå†è°ƒç”¨ <code>write()</code> ä¼šæŠ›å¼‚å¸¸ã€‚</li></ul></li></ul><hr><h3 id="7-try-with-resources-çš„å·¥ä½œåŸç†ï¼Ÿ"><a href="#7-try-with-resources-çš„å·¥ä½œåŸç†ï¼Ÿ" class="headerlink" title="7. try-with-resources çš„å·¥ä½œåŸç†ï¼Ÿ"></a>7. try-with-resources çš„å·¥ä½œåŸç†ï¼Ÿ</h3><ul><li><strong>è¯­æ³•ç³–</strong>ï¼š<code>try (Resource r = ...) &#123;&#125;</code>ï¼Œè¦æ±‚èµ„æºå®ç° <code>AutoCloseable</code>ã€‚</li><li><strong>åŸç†</strong>ï¼šç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆ <code>finally &#123; r.close() &#125;</code>ã€‚</li><li><strong>suppressed exceptions</strong>ï¼šå¦‚æœ <code>try</code> å’Œ <code>close()</code> éƒ½æŠ›å¼‚å¸¸ï¼Œå…³é—­æ—¶çš„å¼‚å¸¸ä¼šè¢«æ ‡è®°ä¸º <strong>suppressed</strong>ï¼Œå¯é€šè¿‡ <code>Throwable.getSuppressed()</code> è·å–ã€‚</li></ul><hr><h3 id="8-è£…é¥°å™¨æ¨¡å¼åœ¨-Java-IO-ä¸­å¦‚ä½•ä½“ç°ï¼Ÿ"><a href="#8-è£…é¥°å™¨æ¨¡å¼åœ¨-Java-IO-ä¸­å¦‚ä½•ä½“ç°ï¼Ÿ" class="headerlink" title="8. è£…é¥°å™¨æ¨¡å¼åœ¨ Java IO ä¸­å¦‚ä½•ä½“ç°ï¼Ÿ"></a>8. è£…é¥°å™¨æ¨¡å¼åœ¨ Java IO ä¸­å¦‚ä½•ä½“ç°ï¼Ÿ</h3><ul><li><p><strong>ä¾‹å­</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Reader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(</span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;a.txt&quot;</span>), StandardCharsets.UTF_8));</span><br></pre></td></tr></table></figure></li><li><p><strong>æœ¬è´¨</strong>ï¼šæ¯å±‚æµåªå…³å¿ƒè‡ªå·±çš„åŠŸèƒ½ï¼ˆç¼“å†²ã€è§£ç ã€è¡Œè¯»å–ï¼‰ï¼Œé€šè¿‡é“¾å¼ç»„åˆå¢å¼ºèƒ½åŠ›ã€‚</p></li></ul><hr><h3 id="9-File-ç±»çš„èƒ½åŠ›ä¸é™åˆ¶ï¼Ÿ"><a href="#9-File-ç±»çš„èƒ½åŠ›ä¸é™åˆ¶ï¼Ÿ" class="headerlink" title="9. File ç±»çš„èƒ½åŠ›ä¸é™åˆ¶ï¼Ÿ"></a>9. File ç±»çš„èƒ½åŠ›ä¸é™åˆ¶ï¼Ÿ</h3><ul><li><strong>èƒ½åšçš„</strong>ï¼šæ–‡ä»¶&#x2F;ç›®å½•çš„å…ƒæ•°æ®æ“ä½œï¼ˆè·¯å¾„ã€å­˜åœ¨æ€§ã€æƒé™ã€å¤§å°ã€ä¿®æ”¹æ—¶é—´ç­‰ï¼‰ã€‚</li><li><strong>ä¸èƒ½åšçš„</strong>ï¼šä¸æ”¯æŒè¯»å†™æ–‡ä»¶å†…å®¹ï¼Œéœ€ç»“åˆ <code>InputStream/OutputStream</code>ã€‚</li></ul><hr><h3 id="10-RandomAccessFile-çš„ç”¨é€”ï¼Ÿ"><a href="#10-RandomAccessFile-çš„ç”¨é€”ï¼Ÿ" class="headerlink" title="10. RandomAccessFile çš„ç”¨é€”ï¼Ÿ"></a>10. RandomAccessFile çš„ç”¨é€”ï¼Ÿ</h3><ul><li><strong>åŠŸèƒ½</strong>ï¼šæ”¯æŒéšæœºè¯»å†™ï¼Œå†…éƒ¨æœ‰ä¸€ä¸ªæ–‡ä»¶æŒ‡é’ˆï¼Œå¯ <code>seek()</code> åˆ°ä»»æ„ä½ç½®è¯»å†™ã€‚</li><li><strong>å…¸å‹åœºæ™¯</strong>ï¼šæ—¥å¿—æ–‡ä»¶ã€æ•°æ®åº“å­˜å‚¨æ–‡ä»¶ã€‚</li><li><strong>å¹¶å‘é—®é¢˜</strong>ï¼šä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¤šçº¿ç¨‹å†™éœ€åŠ é”ã€‚</li></ul><hr><h3 id="11-FileInputStream-ä¸-FileReader-çš„åŒºåˆ«ï¼Ÿ"><a href="#11-FileInputStream-ä¸-FileReader-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="11. FileInputStream ä¸ FileReader çš„åŒºåˆ«ï¼Ÿ"></a>11. FileInputStream ä¸ FileReader çš„åŒºåˆ«ï¼Ÿ</h3><ul><li><strong>FileInputStream</strong>ï¼šå­—èŠ‚æµï¼Œç›´æ¥è¯»äºŒè¿›åˆ¶ã€‚</li><li><strong>FileReader</strong>ï¼šå­—ç¬¦æµï¼Œå†…éƒ¨ç”¨ <code>InputStreamReader</code> å¹¶é»˜è®¤ä½¿ç”¨å¹³å°ç¼–ç ã€‚</li><li><strong>ä½¿ç”¨å»ºè®®</strong>ï¼š<ul><li>éæ–‡æœ¬ â†’ <code>FileInputStream</code>ã€‚</li><li>æ–‡æœ¬ï¼ˆéœ€ç¼–ç å¤„ç†ï¼‰ â†’ <code>FileReader</code>ï¼ˆä½†æœ€å¥½ç”¨ <code>InputStreamReader</code> æ˜¾å¼æŒ‡å®šç¼–ç ï¼‰ã€‚</li></ul></li></ul><hr><h3 id="12-å¸¸è§æ–‡ä»¶æ‹·è´æ–¹å¼æ€§èƒ½å¯¹æ¯”"><a href="#12-å¸¸è§æ–‡ä»¶æ‹·è´æ–¹å¼æ€§èƒ½å¯¹æ¯”" class="headerlink" title="12. å¸¸è§æ–‡ä»¶æ‹·è´æ–¹å¼æ€§èƒ½å¯¹æ¯”"></a>12. å¸¸è§æ–‡ä»¶æ‹·è´æ–¹å¼æ€§èƒ½å¯¹æ¯”</h3><ol><li><strong>è£¸ read&#x2F;write</strong>ï¼šé€å­—èŠ‚æ‹·è´ï¼Œæœ€æ…¢ã€‚</li><li><strong>å¸¦ç¼“å†²</strong>ï¼š<code>BufferedInputStream/BufferedOutputStream</code>ï¼Œæ€§èƒ½æå‡ 5~10 å€ã€‚</li><li><strong>NIO <code>FileChannel.transferTo()</code></strong>ï¼šåˆ©ç”¨é›¶æ‹·è´ï¼Œæ€§èƒ½æœ€é«˜ã€‚</li></ol><hr><h3 id="13-å¦‚ä½•å®‰å…¨å¤„ç†å­—ç¬¦ç¼–ç ï¼Ÿ"><a href="#13-å¦‚ä½•å®‰å…¨å¤„ç†å­—ç¬¦ç¼–ç ï¼Ÿ" class="headerlink" title="13. å¦‚ä½•å®‰å…¨å¤„ç†å­—ç¬¦ç¼–ç ï¼Ÿ"></a>13. å¦‚ä½•å®‰å…¨å¤„ç†å­—ç¬¦ç¼–ç ï¼Ÿ</h3><ul><li><p><strong>æ–¹å¼</strong>ï¼šä½¿ç”¨ <code>InputStreamReader</code>&#x2F;<code>OutputStreamWriter</code> å¹¶æ˜¾å¼æŒ‡å®šç¼–ç ã€‚</p></li><li><p><strong>ä¾‹å­</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;a.txt&quot;</span>), StandardCharsets.UTF_8);</span><br></pre></td></tr></table></figure></li></ul><hr><h3 id="14-å­—ç¬¦ç¼–ç å¸¸è§å‘ï¼Ÿ"><a href="#14-å­—ç¬¦ç¼–ç å¸¸è§å‘ï¼Ÿ" class="headerlink" title="14. å­—ç¬¦ç¼–ç å¸¸è§å‘ï¼Ÿ"></a>14. å­—ç¬¦ç¼–ç å¸¸è§å‘ï¼Ÿ</h3><ul><li>UTF-8 vs GBK æ··ç”¨ï¼šè§£ç é”™è¯¯ï¼Œå‡ºç°ä¹±ç ã€‚</li><li>BOMï¼ˆByte Order Markï¼‰ï¼šéƒ¨åˆ† UTF-8 æ–‡ä»¶å‰ 3 å­—èŠ‚ BOM å¯èƒ½å¯¼è‡´è§£æå¤±è´¥ã€‚</li><li>æˆªæ–­ï¼šå†™å…¥æ—¶æŒ‰å­—èŠ‚æˆªæ–­ UTF-8 å¤šå­—èŠ‚å­—ç¬¦ â†’ ä¹±ç ã€‚</li><li><strong>è§£å†³</strong>ï¼šç»Ÿä¸€ç¼–ç ï¼ˆUTF-8ï¼‰ï¼Œé¿å…éšå¼ç¼–ç ã€‚</li></ul><hr><h3 id="15-æ–‡ä»¶è¿½åŠ ï¼ˆappendï¼‰æ–¹å¼ï¼Ÿ"><a href="#15-æ–‡ä»¶è¿½åŠ ï¼ˆappendï¼‰æ–¹å¼ï¼Ÿ" class="headerlink" title="15. æ–‡ä»¶è¿½åŠ ï¼ˆappendï¼‰æ–¹å¼ï¼Ÿ"></a>15. æ–‡ä»¶è¿½åŠ ï¼ˆappendï¼‰æ–¹å¼ï¼Ÿ</h3><ul><li><p><strong>å®ç°</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;a.txt&quot;</span>, <span class="literal">true</span>);</span><br></pre></td></tr></table></figure></li><li><p><strong>åŸå­æ€§é—®é¢˜</strong>ï¼šå¤šçº¿ç¨‹å†™å…¥éœ€åŠ é”ï¼Œå¦åˆ™å¯èƒ½äº¤å‰è¦†ç›–ã€‚</p></li></ul><hr><h3 id="16-å¦‚ä½•åˆ¤æ–­å¹¶å¤„ç†æ–‡ä»¶çŠ¶æ€ï¼Ÿ"><a href="#16-å¦‚ä½•åˆ¤æ–­å¹¶å¤„ç†æ–‡ä»¶çŠ¶æ€ï¼Ÿ" class="headerlink" title="16. å¦‚ä½•åˆ¤æ–­å¹¶å¤„ç†æ–‡ä»¶çŠ¶æ€ï¼Ÿ"></a>16. å¦‚ä½•åˆ¤æ–­å¹¶å¤„ç†æ–‡ä»¶çŠ¶æ€ï¼Ÿ</h3><ul><li><strong>å­˜åœ¨æ€§</strong>ï¼š<code>file.exists()</code>ã€‚</li><li><strong>æƒé™</strong>ï¼š<code>file.canRead()</code>, <code>file.canWrite()</code>ã€‚</li><li><strong>å ç”¨</strong>ï¼šåªèƒ½é€šè¿‡æ‰“å¼€å°è¯•ï¼Œè‹¥è¢«å ç”¨ä¼šæŠ›å¼‚å¸¸ã€‚</li></ul><hr><h3 id="17-File-mkdirs-ä¸-mkdir-åŒºåˆ«ï¼Ÿ"><a href="#17-File-mkdirs-ä¸-mkdir-åŒºåˆ«ï¼Ÿ" class="headerlink" title="17. File.mkdirs() ä¸ mkdir() åŒºåˆ«ï¼Ÿ"></a>17. File.mkdirs() ä¸ mkdir() åŒºåˆ«ï¼Ÿ</h3><ul><li><strong>mkdir()</strong>ï¼šåªåˆ›å»ºå½“å‰ç›®å½•ï¼Œçˆ¶ç›®å½•ä¸å­˜åœ¨åˆ™å¤±è´¥ã€‚</li><li><strong>mkdirs()</strong>ï¼šä¼šé€’å½’åˆ›å»ºæ‰€æœ‰ä¸å­˜åœ¨çš„çˆ¶ç›®å½•ã€‚</li><li><strong>è¿”å›å€¼</strong>ï¼šæˆåŠŸè¿”å› <code>true</code>ï¼Œå¦åˆ™ <code>false</code>ã€‚</li></ul><hr><h3 id="18-ä¸´æ—¶æ–‡ä»¶ï¼ˆcreateTempFileï¼‰çš„ç”¨é€”ï¼Ÿ"><a href="#18-ä¸´æ—¶æ–‡ä»¶ï¼ˆcreateTempFileï¼‰çš„ç”¨é€”ï¼Ÿ" class="headerlink" title="18. ä¸´æ—¶æ–‡ä»¶ï¼ˆcreateTempFileï¼‰çš„ç”¨é€”ï¼Ÿ"></a>18. ä¸´æ—¶æ–‡ä»¶ï¼ˆcreateTempFileï¼‰çš„ç”¨é€”ï¼Ÿ</h3><ul><li><strong>æ–¹æ³•</strong>ï¼š<code>File.createTempFile(&quot;prefix&quot;, &quot;.tmp&quot;)</code>ã€‚</li><li><strong>ç‰¹ç‚¹</strong>ï¼šè‡ªåŠ¨ç”Ÿæˆå”¯ä¸€æ–‡ä»¶åã€‚</li><li><strong>åˆ é™¤ç­–ç•¥</strong>ï¼š<code>file.deleteOnExit()</code> JVM é€€å‡ºæ—¶åˆ é™¤ï¼Œä½†ä¾èµ–äºæ­£å¸¸é€€å‡ºã€‚</li></ul><hr><h3 id="19-æ–‡ä»¶çš„è¯»å†™é”ä¸å¹¶å‘è®¿é—®ï¼Ÿ"><a href="#19-æ–‡ä»¶çš„è¯»å†™é”ä¸å¹¶å‘è®¿é—®ï¼Ÿ" class="headerlink" title="19. æ–‡ä»¶çš„è¯»å†™é”ä¸å¹¶å‘è®¿é—®ï¼Ÿ"></a>19. æ–‡ä»¶çš„è¯»å†™é”ä¸å¹¶å‘è®¿é—®ï¼Ÿ</h3><ul><li><strong>Java NIO</strong>ï¼š<code>FileChannel.lock()</code> æä¾›æ–‡ä»¶é”ï¼ˆç‹¬å é”ã€å…±äº«é”ï¼‰ã€‚</li><li><strong>æ³¨æ„</strong>ï¼šæ–‡ä»¶é”æ˜¯ OS çº§åˆ«ï¼Œè·¨è¿›ç¨‹ç”Ÿæ•ˆï¼›æ€§èƒ½å¼€é”€è¾ƒå¤§ï¼Œä¸é€‚åˆé¢‘ç¹æ“ä½œã€‚</li></ul><hr><h3 id="20-æµå…³é—­å¼‚å¸¸å¤„ç†æœ€ä½³å®è·µ"><a href="#20-æµå…³é—­å¼‚å¸¸å¤„ç†æœ€ä½³å®è·µ" class="headerlink" title="20. æµå…³é—­å¼‚å¸¸å¤„ç†æœ€ä½³å®è·µ"></a>20. æµå…³é—­å¼‚å¸¸å¤„ç†æœ€ä½³å®è·µ</h3><ul><li><strong>ä¼ ç»Ÿå†™æ³•</strong>ï¼štry-finally æ‰‹åŠ¨å…³é—­æµã€‚</li><li><strong>æ¨è</strong>ï¼štry-with-resourcesï¼Œé¿å…é—æ¼å…³é—­ã€‚</li><li><strong>å…³é—­å¼‚å¸¸</strong>ï¼šåª logï¼Œä¸å½±å“ä¸»è¦ä¸šåŠ¡å¼‚å¸¸å¤„ç†ã€‚</li></ul><hr><h2 id="äºŒã€Java-IO-è®¾è®¡ä¸æ¨¡å¼ï¼ˆ21â€“40ï¼‰"><a href="#äºŒã€Java-IO-è®¾è®¡ä¸æ¨¡å¼ï¼ˆ21â€“40ï¼‰" class="headerlink" title="äºŒã€Java IO è®¾è®¡ä¸æ¨¡å¼ï¼ˆ21â€“40ï¼‰"></a>äºŒã€Java IO è®¾è®¡ä¸æ¨¡å¼ï¼ˆ21â€“40ï¼‰</h2><ol><li>InputStream&#x2F;OutputStream çš„è£…é¥°å™¨é“¾å¸¸è§ç»„åˆï¼ˆBuffered -&gt; GZIP -&gt; Cipher ç­‰ï¼‰ã€‚</li><li>PushbackInputStreamã€SequenceInputStream çš„ä½œç”¨ä¸åº”ç”¨åœºæ™¯ã€‚</li><li>PipedInputStream &#x2F; PipedOutputStreamï¼ˆç®¡é“æµï¼‰çš„ä½¿ç”¨ä¸çº¿ç¨‹æ³¨æ„ç‚¹ã€‚</li><li>FilterInputStream&#x2F;FilterOutputStream çš„è®¾è®¡ä¸æ‰©å±•ã€‚</li><li>IO ä¸å¼‚å¸¸å¤„ç†ï¼šIOException çš„å¸¸è§å­ç±»ä¸å¤„ç†ç­–ç•¥ã€‚</li><li>æµå¤åˆ¶çš„å¸¸è§å®ç°æ¨¡æ¿ï¼ˆæ¨¡æ¿æ–¹æ³•å¼ä»£ç ï¼‰ã€‚</li><li>NIO å¼•å…¥å‰çš„ IO å±€é™æ€§ï¼ˆå¯æ‰©å±•æ€§ã€çº¿ç¨‹æ¨¡å‹ï¼‰ã€‚</li><li>å¦‚ä½•å®ç°ä¸€ä¸ªå¸¦è¶…æ—¶çš„è¯»æ“ä½œï¼ˆSocket&#x2F;Channelï¼‰ï¼Ÿ</li><li>æµå¼å¤„ç†ä¸å†…å­˜å‹å¥½å‹å¤„ç†ï¼ˆæµå¼å¤„ç†å¤§æ–‡ä»¶ï¼‰å®è·µã€‚</li><li>Base64 ç¼–è§£ç åœ¨æµä¸­çš„é«˜æ•ˆé›†æˆæ–¹æ³•ã€‚</li><li>åŠ å¯†&#x2F;è§£å¯†æµï¼ˆCipherInputStream&#x2F;CipherOutputStreamï¼‰å¦‚ä½•æ­£ç¡®å…³é—­ï¼Ÿ</li><li>GZIPInputStream&#x2F;GZIPOutputStream çš„å‹ç¼©æµä½¿ç”¨æ³¨æ„äº‹é¡¹ã€‚</li><li>ObjectInputStream&#x2F;ObjectOutputStream çš„å·¥ä½œæœºåˆ¶ï¼ˆç±»å…ƒæ•°æ®ã€å¥æŸ„è¡¨ï¼‰ã€‚</li><li>å¦‚ä½•å®ç°è·¨è¯­è¨€çš„åºåˆ—åŒ–å…¼å®¹ï¼ˆJSON&#x2F;Protobuf&#x2F;Avroï¼‰ï¼Ÿ</li><li>å®ç°è‡ªå®šä¹‰ InputStream å­ç±»æ—¶éœ€è¦æ³¨æ„ä»€ä¹ˆï¼ˆread æ–¹æ³•è¯­ä¹‰ï¼‰ï¼Ÿ</li><li>è®¾è®¡ç”¨äºæ—¥å¿—å†™å…¥çš„é«˜åå IO æ¨¡å¼ï¼ˆå¼‚æ­¥æ‰¹é‡å†™ï¼‰ã€‚</li><li>æµå¤åˆ¶æ—¶å¦‚ä½•ç»Ÿè®¡é€Ÿç‡ä¸è¿›åº¦ï¼ˆå¸¦è¿›åº¦å›è°ƒï¼‰ï¼Ÿ</li><li>å¦‚ä½•å®‰å…¨å¤„ç†äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆæµè¾¹ç•Œã€magic headerï¼‰ï¼Ÿ</li><li>å¤§å¯¹è±¡&#x2F;å¤§æ•°ç»„å†™å…¥æµæ—¶çš„å†…å­˜ä¼˜åŒ–ç­–ç•¥ï¼ˆåˆ†å—ã€æµåŒ–ï¼‰ã€‚</li><li>å¦‚ä½•å®ç°å¯é‡å…¥&#x2F;å¯æ¢å¤çš„æ–­ç‚¹ç»­ä¼ æ–‡ä»¶å†™å…¥ï¼Ÿ</li></ol><hr><h2 id="ä¸‰ã€æ–‡ä»¶ç³»ç»Ÿã€é”ä¸æ“ä½œï¼ˆ41â€“60ï¼‰"><a href="#ä¸‰ã€æ–‡ä»¶ç³»ç»Ÿã€é”ä¸æ“ä½œï¼ˆ41â€“60ï¼‰" class="headerlink" title="ä¸‰ã€æ–‡ä»¶ç³»ç»Ÿã€é”ä¸æ“ä½œï¼ˆ41â€“60ï¼‰"></a>ä¸‰ã€æ–‡ä»¶ç³»ç»Ÿã€é”ä¸æ“ä½œï¼ˆ41â€“60ï¼‰</h2><ol><li>Java ä¸­æ–‡ä»¶é” FileLock çš„ç±»å‹ï¼ˆå…±äº«&#x2F;ç‹¬å ï¼‰åŠå®ç°åŸç†ã€‚</li><li>FileLock çš„å±€é™æ€§ï¼ˆè·¨ JVMã€è·¨ OS è¡Œä¸ºå·®å¼‚ï¼‰ã€‚</li><li>æ–‡ä»¶æè¿°ç¬¦æ³„éœ²çš„å¸¸è§åŸå› ä¸å®šä½æ–¹æ³•ã€‚</li><li>æ–‡ä»¶å¥æŸ„ä¸Šé™ï¼ˆulimitï¼‰å¯¹ Java æœåŠ¡çš„å½±å“ä¸æ’æŸ¥ã€‚</li><li>ç¡¬é“¾æ¥ä¸è½¯é“¾æ¥åœ¨ Java ä¸­å¦‚ä½•åŒºåˆ†ä¸æ“ä½œï¼Ÿ</li><li>MappedByteBufferï¼ˆå†…å­˜æ˜ å°„æ–‡ä»¶ï¼‰çš„ä¼˜åŠ£ä¸é£é™©ï¼ˆå†…å­˜å›æ”¶ã€æ–‡ä»¶é”ï¼‰ã€‚</li><li>å¤§æ–‡ä»¶åˆ†ç‰‡è¯»å–ä¸å¹¶å‘åˆå¹¶ç­–ç•¥ã€‚</li><li>å¦‚ä½•é«˜æ•ˆç»Ÿè®¡å¤§æ—¥å¿—æ–‡ä»¶ä¸­æŸæ¡ä»¶çš„è¡Œæ•°ï¼ˆåˆ†å— + å¹¶è¡Œï¼‰ï¼Ÿ</li><li>æ–‡ä»¶ç³»ç»Ÿç¼“å­˜ï¼ˆPageCacheï¼‰å¯¹è¯»å†™æ€§èƒ½çš„å½±å“æœºåˆ¶ã€‚</li><li>fsync &#x2F; FileDescriptor.sync åœ¨æŒä¹…åŒ–ä¿éšœä¸Šçš„ä½œç”¨ã€‚</li><li>æ–‡ä»¶é¡ºåºå†™ä¸éšæœºå†™çš„æ€§èƒ½å·®å¼‚ä¸ä¼˜åŒ–å»ºè®®ã€‚</li><li>ç£ç›˜ç±»å‹ï¼ˆSSD vs HDDï¼‰å¯¹ IO ç­–ç•¥çš„å½±å“ã€‚</li><li>åŸå­é‡å‘½åï¼ˆrenameTo&#x2F;Files.moveï¼‰çš„è·¨å¹³å°å·®å¼‚ã€‚</li><li>æ–‡ä»¶ç›‘æ§ï¼ˆWatchServiceï¼‰çš„å®ç°é™åˆ¶ä¸æ›¿ä»£æ–¹æ¡ˆã€‚</li><li>å¤„ç†æ—¥å¿—åˆ‡å‰²ï¼ˆrotationï¼‰æ—¶çš„æ–‡ä»¶å¥æŸ„ç®¡ç†ç­–ç•¥ã€‚</li><li>å¦‚ä½•å®ç°é›¶åœæœºéƒ¨ç½²ä¸­å¯¹æ–‡ä»¶çš„å¹³æ»‘è¿ç§»ï¼Ÿ</li><li>è½¯åˆ é™¤ï¼ˆæ ‡è®°åˆ é™¤ï¼‰ä¸ç‰©ç†åˆ é™¤çš„ IO è€ƒé‡ã€‚</li><li>å¤‡ä»½&#x2F;å¿«ç…§ç­–ç•¥å¯¹ IO çš„å½±å“ï¼ˆå†·å¤‡ vs çƒ­å¤‡ï¼‰ã€‚</li><li>å¤§æ–‡ä»¶æ ¡éªŒï¼ˆMD5&#x2F;SHAï¼‰åœ¨æµå¼å¤„ç†ä¸­çš„å®ç°ã€‚</li><li>æ–‡ä»¶ç³»ç»Ÿä¸€è‡´æ€§é—®é¢˜ï¼ˆå†™å…¥åç«‹å³è¯»å–åˆ°ä¸åŒæ­¥ï¼‰å¦‚ä½•è¯Šæ–­ã€‚</li></ol><hr><h2 id="å››ã€åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ï¼ˆ61â€“75ï¼‰"><a href="#å››ã€åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ï¼ˆ61â€“75ï¼‰" class="headerlink" title="å››ã€åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ï¼ˆ61â€“75ï¼‰"></a>å››ã€åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ï¼ˆ61â€“75ï¼‰</h2><ol><li>Java åŸç”Ÿåºåˆ—åŒ–ï¼ˆSerializableï¼‰çš„æœºåˆ¶å’Œå¯¹è±¡å†™å…¥æ ¼å¼ã€‚</li><li>serialVersionUID çš„ä½œç”¨ã€è‡ªåŠ¨ç”Ÿæˆä¸å…¼å®¹æ€§ç­–ç•¥ã€‚</li><li>transient å­—æ®µã€static å­—æ®µåœ¨åºåˆ—åŒ–ä¸­çš„å¤„ç†ã€‚</li><li>Externalizable ä¸ Serializable çš„åŒºåˆ«ä¸ä½¿ç”¨åœºæ™¯ã€‚</li><li>Java åºåˆ—åŒ–çš„å®‰å…¨é£é™©ï¼ˆååºåˆ—åŒ–æ¼æ´ï¼‰ä¸é˜²æŠ¤æªæ–½ã€‚</li><li>é«˜æ€§èƒ½äºŒè¿›åˆ¶åºåˆ—åŒ–æ–¹æ¡ˆå¯¹æ¯”ï¼šKryoã€Protostuffã€Protobufã€Avroã€‚</li><li>JSON å’ŒäºŒè¿›åˆ¶åºåˆ—åŒ–çš„æƒè¡¡ï¼ˆå¯è¯»æ€§ vs æ€§èƒ½&#x2F;å¤§å°ï¼‰ã€‚</li><li>å¦‚ä½•å®ç°å¯æ¼”åŒ–çš„åºåˆ—åŒ–åè®®ï¼ˆå‘å‰&#x2F;å‘åå…¼å®¹ï¼‰ï¼Ÿ</li><li>å¯¹è±¡å›¾åºåˆ—åŒ–æ—¶å¾ªç¯å¼•ç”¨çš„å¤„ç†ï¼ˆå¥æŸ„æœºåˆ¶ï¼‰ã€‚</li><li>å¯¹è±¡åºåˆ—åŒ–æ€§èƒ½è°ƒä¼˜è¦ç‚¹ï¼ˆç¼“å†²ã€å¯¹è±¡é‡ç”¨ï¼‰ã€‚</li><li>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¦‚ä½•ç®¡ç†åºåˆ—åŒ–ç­–ç•¥ï¼ˆè·¨æœåŠ¡ç‰ˆæœ¬ï¼‰ï¼Ÿ</li><li>è‡ªå®šä¹‰åºåˆ—åŒ–ï¼ˆwriteObject&#x2F;readObjectï¼‰å¸¸è§é™·é˜±ã€‚</li><li>åºåˆ—åŒ–æ—¶å¦‚ä½•å¤„ç†ç±»åŠ è½½å™¨é—®é¢˜ï¼Ÿ</li><li>å¤§å¯¹è±¡åºåˆ—åŒ–æ—¶çš„å†…å­˜ä¸ GC é£é™©å¦‚ä½•é™ä½ï¼Ÿ</li><li>ä½¿ç”¨åºåˆ—åŒ–ä½œä¸ºç¼“å­˜ï¼ˆRedis&#x2F;Memcachedï¼‰æ—¶çš„æ³¨æ„äº‹é¡¹ã€‚</li></ol><hr><h2 id="äº”ã€NIO-æ·±å…¥ï¼šBuffer-Channel-Selectorï¼ˆ76â€“100ï¼‰"><a href="#äº”ã€NIO-æ·±å…¥ï¼šBuffer-Channel-Selectorï¼ˆ76â€“100ï¼‰" class="headerlink" title="äº”ã€NIO æ·±å…¥ï¼šBuffer &#x2F; Channel &#x2F; Selectorï¼ˆ76â€“100ï¼‰"></a>äº”ã€NIO æ·±å…¥ï¼šBuffer &#x2F; Channel &#x2F; Selectorï¼ˆ76â€“100ï¼‰</h2><hr><h3 id="1-NIO-ä¸‰å¤§æ ¸å¿ƒï¼ˆBufferã€Channelã€Selectorï¼‰"><a href="#1-NIO-ä¸‰å¤§æ ¸å¿ƒï¼ˆBufferã€Channelã€Selectorï¼‰" class="headerlink" title="1. NIO ä¸‰å¤§æ ¸å¿ƒï¼ˆBufferã€Channelã€Selectorï¼‰"></a>1. NIO ä¸‰å¤§æ ¸å¿ƒï¼ˆBufferã€Channelã€Selectorï¼‰</h3><ul><li><strong>Buffer</strong>ï¼šæ•°æ®å®¹å™¨ï¼Œæ‰€æœ‰è¯»å†™æ“ä½œéƒ½è¦é€šè¿‡å®ƒå®Œæˆã€‚</li><li><strong>Channel</strong>ï¼šé€šé“ï¼Œè¿æ¥æ•°æ®æºä¸ Bufferï¼Œæ”¯æŒåŒå‘è¯»å†™ã€‚</li><li><strong>Selector</strong>ï¼šå¤šè·¯å¤ç”¨å™¨ï¼Œæ£€æµ‹å¤šä¸ª Channel çš„äº‹ä»¶ï¼ˆè¯»ã€å†™ã€è¿æ¥ç­‰ï¼‰ï¼Œå®ç°éé˜»å¡ IOã€‚</li></ul><hr><h3 id="2-ByteBuffer-çš„-position-limit-capacity"><a href="#2-ByteBuffer-çš„-position-limit-capacity" class="headerlink" title="2. ByteBuffer çš„ position &#x2F; limit &#x2F; capacity"></a>2. ByteBuffer çš„ position &#x2F; limit &#x2F; capacity</h3><ul><li><strong>capacity</strong>ï¼šç¼“å†²åŒºçš„æ€»å®¹é‡ï¼Œåˆ›å»ºæ—¶ç¡®å®šã€‚</li><li><strong>position</strong>ï¼šå½“å‰è¯»å†™æŒ‡é’ˆï¼Œè¡¨ç¤ºä¸‹ä¸€ä¸ªæ“ä½œçš„ä½ç½®ã€‚</li><li><strong>limit</strong>ï¼šå¯æ“ä½œçš„è¾¹ç•Œï¼Œå†™æ¨¡å¼ä¸‹&#x3D;capacityï¼Œè¯»æ¨¡å¼ä¸‹&#x3D;å†™å…¥çš„æ•°æ®é‡ã€‚</li></ul><hr><h3 id="3-flip-clear-rewind-compact"><a href="#3-flip-clear-rewind-compact" class="headerlink" title="3. flip(), clear(), rewind(), compact()"></a>3. flip(), clear(), rewind(), compact()</h3><ul><li><strong>flip()</strong>ï¼šåˆ‡æ¢å†™ â†’ è¯»æ¨¡å¼ï¼ˆlimit&#x3D;positionï¼Œposition&#x3D;0ï¼‰ã€‚</li><li><strong>clear()</strong>ï¼šæ¸…ç©ºç¼“å†²ï¼Œå‡†å¤‡å†™ï¼ˆposition&#x3D;0ï¼Œlimit&#x3D;capacityï¼‰ã€‚</li><li><strong>rewind()</strong>ï¼šé‡æ–°è¯»ï¼ˆposition&#x3D;0ï¼Œlimit ä¸å˜ï¼‰ã€‚</li><li><strong>compact()</strong>ï¼šæœªè¯»æ•°æ®å‰ç§»ï¼Œposition æŒ‡å‘æœªè¯»æ•°æ®æœ«å°¾ã€‚</li></ul><hr><h3 id="4-DirectByteBuffer-vs-HeapByteBuffer"><a href="#4-DirectByteBuffer-vs-HeapByteBuffer" class="headerlink" title="4. DirectByteBuffer vs HeapByteBuffer"></a>4. DirectByteBuffer vs HeapByteBuffer</h3><ul><li><strong>HeapByteBuffer</strong>ï¼šæ•°æ®åœ¨ JVM å †å†…å­˜ï¼ŒGC ç®¡ç†ï¼Œæ‹·è´åˆ°å†…æ ¸æ€å¤šä¸€ä»½ã€‚</li><li><strong>DirectByteBuffer</strong>ï¼šæ•°æ®åœ¨å †å¤–å†…å­˜ï¼ŒIO æ—¶é›¶æ‹·è´ï¼Œæ€§èƒ½æ›´é«˜ï¼Œä½†åˆ†é…é‡Šæ”¾ä»£ä»·å¤§ã€‚</li></ul><hr><h3 id="5-ByteBuffer-slice-asReadOnlyBuffer"><a href="#5-ByteBuffer-slice-asReadOnlyBuffer" class="headerlink" title="5. ByteBuffer slice() &#x2F; asReadOnlyBuffer()"></a>5. ByteBuffer slice() &#x2F; asReadOnlyBuffer()</h3><ul><li><strong>slice()</strong>ï¼šå…±äº«åº•å±‚æ•°æ®ï¼Œæ–°çš„ç¼“å†²åŒº position&#x3D;0ï¼Œlimit&#x3D;å‰©ä½™ã€‚</li><li><strong>asReadOnlyBuffer()</strong>ï¼šç”Ÿæˆåªè¯»è§†å›¾ï¼Œä¿®æ”¹ä¼šæŠ› <code>ReadOnlyBufferException</code>ã€‚</li></ul><hr><h3 id="6-Scatter-Gather-IO"><a href="#6-Scatter-Gather-IO" class="headerlink" title="6. Scatter&#x2F;Gather IO"></a>6. Scatter&#x2F;Gather IO</h3><ul><li><strong>Scatter Read</strong>ï¼šä¸€ä¸ª Channel â†’ å¤šä¸ª Bufferï¼ˆé€‚åˆå›ºå®šå¤´+ä½“ï¼‰ã€‚</li><li><strong>Gather Write</strong>ï¼šå¤šä¸ª Buffer â†’ ä¸€ä¸ª Channelï¼ˆé¿å…æ‹¼æ¥ï¼‰ã€‚</li></ul><hr><h3 id="7-FileChannel-çš„å…³é”®æ–¹æ³•"><a href="#7-FileChannel-çš„å…³é”®æ–¹æ³•" class="headerlink" title="7. FileChannel çš„å…³é”®æ–¹æ³•"></a>7. FileChannel çš„å…³é”®æ–¹æ³•</h3><ul><li><strong>position()</strong>ï¼šè·å–&#x2F;è®¾ç½®æ–‡ä»¶æŒ‡é’ˆã€‚</li><li><strong>size()</strong>ï¼šè¿”å›æ–‡ä»¶å¤§å°ã€‚</li><li><strong>truncate(long size)</strong>ï¼šæˆªæ–­æ–‡ä»¶ã€‚</li><li><strong>force(boolean metaData)</strong>ï¼šå¼ºåˆ¶å†™å…¥ç£ç›˜ã€‚</li></ul><hr><h3 id="8-MappedByteBufferï¼ˆå†…å­˜æ˜ å°„ï¼‰"><a href="#8-MappedByteBufferï¼ˆå†…å­˜æ˜ å°„ï¼‰" class="headerlink" title="8. MappedByteBufferï¼ˆå†…å­˜æ˜ å°„ï¼‰"></a>8. MappedByteBufferï¼ˆå†…å­˜æ˜ å°„ï¼‰</h3><ul><li><strong>åˆ›å»º</strong>ï¼š<code>FileChannel.map(mode, position, size)</code></li><li><strong>ä¼˜ç‚¹</strong>ï¼šç›´æ¥æ“ä½œå†…å­˜æ˜ å°„ï¼Œæ•ˆç‡é«˜ã€‚</li><li><strong>é‡Šæ”¾</strong>ï¼šJDK æ— ç›´æ¥ APIï¼Œé€šå¸¸é€šè¿‡åå°„ <code>Cleaner.clean()</code>ï¼Œéœ€æ³¨æ„å†…å­˜æ³„éœ²ã€‚</li></ul><hr><h3 id="9-Channel-vs-Stream"><a href="#9-Channel-vs-Stream" class="headerlink" title="9. Channel vs Stream"></a>9. Channel vs Stream</h3><ul><li><strong>Stream</strong>ï¼šå•å‘ã€é˜»å¡ã€‚</li><li><strong>Channel</strong>ï¼šåŒå‘ã€å¯éé˜»å¡ï¼Œå¯å’Œ Selector é…åˆã€‚</li></ul><hr><h3 id="10-Selector-å·¥ä½œæµç¨‹"><a href="#10-Selector-å·¥ä½œæµç¨‹" class="headerlink" title="10. Selector å·¥ä½œæµç¨‹"></a>10. Selector å·¥ä½œæµç¨‹</h3><ol><li><strong>æ³¨å†Œ</strong>ï¼š<code>channel.register(selector, ops)</code></li><li><strong>é€‰æ‹©</strong>ï¼š<code>selector.select(timeout)</code></li><li><strong>éå†</strong>ï¼š<code>selectedKeys()</code> éå†å¤„ç†</li><li><strong>å–æ¶ˆ</strong>ï¼šè°ƒç”¨ <code>key.cancel()</code></li></ol><hr><h3 id="11-Selector-åº•å±‚å®ç°"><a href="#11-Selector-åº•å±‚å®ç°" class="headerlink" title="11. Selector åº•å±‚å®ç°"></a>11. Selector åº•å±‚å®ç°</h3><ul><li><strong>Linux</strong>ï¼šepoll</li><li><strong>Windows</strong>ï¼šselect</li><li><strong>macOS</strong>ï¼škqueue<br> å½±å“æ€§èƒ½å’Œå¯æ‰©å±•æ€§ï¼ˆepoll é€‚åˆé«˜å¹¶å‘ï¼‰ã€‚</li></ul><hr><h3 id="12-éé˜»å¡-Channel-çš„-read-write-è¿”å›å€¼"><a href="#12-éé˜»å¡-Channel-çš„-read-write-è¿”å›å€¼" class="headerlink" title="12. éé˜»å¡ Channel çš„ read&#x2F;write è¿”å›å€¼"></a>12. éé˜»å¡ Channel çš„ read&#x2F;write è¿”å›å€¼</h3><ul><li><p><strong>read</strong>ï¼š</p><ul><li><blockquote><p>0ï¼šè¯»å–å­—èŠ‚æ•°</p></blockquote></li><li><p>0ï¼šæ— æ•°æ®</p></li><li><p>-1ï¼šEOFï¼ˆå…³é—­ï¼‰</p></li></ul></li><li><p><strong>write</strong>ï¼š</p><ul><li><blockquote><p>0ï¼šå†™å…¥å­—èŠ‚æ•°</p></blockquote></li><li><p>0ï¼šå†…æ ¸ç¼“å†²åŒºæ»¡</p></li></ul></li></ul><hr><h3 id="13-ç²˜åŒ…-æ‹†åŒ…é—®é¢˜"><a href="#13-ç²˜åŒ…-æ‹†åŒ…é—®é¢˜" class="headerlink" title="13. ç²˜åŒ…&#x2F;æ‹†åŒ…é—®é¢˜"></a>13. ç²˜åŒ…&#x2F;æ‹†åŒ…é—®é¢˜</h3><p>åŸå› ï¼šTCP æµå¼ä¼ è¾“æ— è¾¹ç•Œã€‚<br> è§£å†³ç­–ç•¥ï¼š</p><ul><li>å›ºå®šé•¿åº¦ï¼ˆå®šé•¿åè®®ï¼‰</li><li>åˆ†éš”ç¬¦ï¼ˆå¦‚ <code>\n</code>ï¼‰</li><li>é•¿åº¦å‰ç½®ï¼ˆå¸¸è§ï¼‰</li></ul><hr><h3 id="14-è¶…æ—¶æ–­å¼€-å¿ƒè·³æ£€æµ‹"><a href="#14-è¶…æ—¶æ–­å¼€-å¿ƒè·³æ£€æµ‹" class="headerlink" title="14. è¶…æ—¶æ–­å¼€ &amp; å¿ƒè·³æ£€æµ‹"></a>14. è¶…æ—¶æ–­å¼€ &amp; å¿ƒè·³æ£€æµ‹</h3><ul><li><strong>è¶…æ—¶æ–­å¼€</strong>ï¼šåœ¨ <code>select(timeout)</code> ä¸­æ£€æµ‹é•¿æ—¶é—´æ— è¯»å†™çš„è¿æ¥ã€‚</li><li><strong>å¿ƒè·³æ£€æµ‹</strong>ï¼šå®¢æˆ·ç«¯&#x2F;æœåŠ¡ç«¯å®šæœŸå‘é€ <code>PING</code>ï¼Œæ— å“åº”åˆ™æ–­å¼€ã€‚</li></ul><hr><h3 id="15-Pipe-åœ¨-NIO-ä¸­çš„ä½œç”¨"><a href="#15-Pipe-åœ¨-NIO-ä¸­çš„ä½œç”¨" class="headerlink" title="15. Pipe åœ¨ NIO ä¸­çš„ä½œç”¨"></a>15. Pipe åœ¨ NIO ä¸­çš„ä½œç”¨</h3><ul><li>å•å‘é€šä¿¡ï¼ˆå†™ç«¯ â†’ è¯»ç«¯ï¼‰ï¼Œå¸¸ç”¨äºçº¿ç¨‹é—´é€šä¿¡ã€‚</li><li>ä½†æ€§èƒ½ä¸å¦‚ BlockingQueueã€‚</li></ul><hr><h3 id="16-å¤š-Selector-å¤š-Reactor"><a href="#16-å¤š-Selector-å¤š-Reactor" class="headerlink" title="16. å¤š Selector &#x2F; å¤š Reactor"></a>16. å¤š Selector &#x2F; å¤š Reactor</h3><ul><li><strong>å• Reactor</strong>ï¼šä¸€ä¸ªçº¿ç¨‹è´Ÿè´£ Selectorã€‚</li><li><strong>å¤š Reactor</strong>ï¼šä¸» Reactor å¤„ç† acceptï¼Œå­ Reactor å¤„ç† read&#x2F;writeã€‚</li><li><strong>å¤š Selector</strong>ï¼šçº¿ç¨‹æ± åˆ†æ‹… Channel è´Ÿè½½ã€‚</li></ul><hr><h3 id="17-ByteBuffer-å¤šçº¿ç¨‹é—®é¢˜"><a href="#17-ByteBuffer-å¤šçº¿ç¨‹é—®é¢˜" class="headerlink" title="17. ByteBuffer å¤šçº¿ç¨‹é—®é¢˜"></a>17. ByteBuffer å¤šçº¿ç¨‹é—®é¢˜</h3><ul><li><strong>ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„</strong>ã€‚</li><li>è§£å†³ï¼šæ¯ä¸ªçº¿ç¨‹ç‹¬ç«‹ Bufferï¼Œæˆ–å¤–éƒ¨åŠ é”ã€‚</li></ul><hr><h3 id="18-DirectByteBuffer-é¿å…æ³„éœ²"><a href="#18-DirectByteBuffer-é¿å…æ³„éœ²" class="headerlink" title="18. DirectByteBuffer é¿å…æ³„éœ²"></a>18. DirectByteBuffer é¿å…æ³„éœ²</h3><ul><li>ä½¿ç”¨ <code>ByteBuffer.allocateDirect()</code> ä»£ä»·å¤§ã€‚</li><li>å»ºè®®ï¼šä½¿ç”¨ <code>-XX:+UseLargePages</code>ã€æ± åŒ–ç®¡ç†ï¼ˆNetty çš„ <code>PooledByteBufAllocator</code>ï¼‰ã€‚</li></ul><hr><h3 id="19-Selector-selectedKeys-æ­£ç¡®ç”¨æ³•"><a href="#19-Selector-selectedKeys-æ­£ç¡®ç”¨æ³•" class="headerlink" title="19. Selector selectedKeys æ­£ç¡®ç”¨æ³•"></a>19. Selector selectedKeys æ­£ç¡®ç”¨æ³•</h3><ul><li>éå† <code>selectedKeys()</code></li><li>å¤„ç†å®Œä¸€ä¸ª key â†’ <code>iterator.remove()</code></li><li>å¦åˆ™ä¸‹æ¬¡å¾ªç¯ä»ä¼šè§¦å‘ã€‚</li></ul><hr><h3 id="20-NIO-é«˜æ•ˆè¯»å†™å¾ªç¯æ¨¡æ¿"><a href="#20-NIO-é«˜æ•ˆè¯»å†™å¾ªç¯æ¨¡æ¿" class="headerlink" title="20. NIO é«˜æ•ˆè¯»å†™å¾ªç¯æ¨¡æ¿"></a>20. NIO é«˜æ•ˆè¯»å†™å¾ªç¯æ¨¡æ¿</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    selector.select();</span><br><span class="line">    Iterator&lt;SelectionKey&gt; it = selector.selectedKeys().iterator();</span><br><span class="line">    <span class="keyword">while</span> (it.hasNext()) &#123;</span><br><span class="line">        <span class="type">SelectionKey</span> <span class="variable">key</span> <span class="operator">=</span> it.next();</span><br><span class="line">        it.remove();</span><br><span class="line">        <span class="keyword">if</span> (key.isReadable()) &#123;</span><br><span class="line">            <span class="type">SocketChannel</span> <span class="variable">sc</span> <span class="operator">=</span> (SocketChannel) key.channel();</span><br><span class="line">            <span class="type">ByteBuffer</span> <span class="variable">buf</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line">            <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> sc.read(buf);</span><br><span class="line">            <span class="keyword">if</span> (n == -<span class="number">1</span>) sc.close();</span><br><span class="line">            <span class="keyword">else</span> &#123; buf.flip(); sc.write(buf); &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="21-transferTo-transferFromï¼ˆé›¶æ‹·è´ï¼‰"><a href="#21-transferTo-transferFromï¼ˆé›¶æ‹·è´ï¼‰" class="headerlink" title="21. transferTo&#x2F;transferFromï¼ˆé›¶æ‹·è´ï¼‰"></a>21. transferTo&#x2F;transferFromï¼ˆé›¶æ‹·è´ï¼‰</h3><ul><li>ç›´æ¥åœ¨å†…æ ¸ç©ºé—´å®Œæˆæ–‡ä»¶å¤åˆ¶ï¼ˆå‡å°‘ç”¨æˆ·æ€æ‹·è´ï¼‰ã€‚</li><li>å±€é™ï¼šWindows ä¸€æ¬¡ä¼ è¾“å¤§å°æœ‰é™ï¼Œéœ€å¾ªç¯ã€‚</li></ul><hr><h3 id="22-FileChannel-é«˜æ•ˆå¤åˆ¶"><a href="#22-FileChannel-é«˜æ•ˆå¤åˆ¶" class="headerlink" title="22. FileChannel é«˜æ•ˆå¤åˆ¶"></a>22. FileChannel é«˜æ•ˆå¤åˆ¶</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (<span class="type">FileChannel</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(src).getChannel();</span><br><span class="line">     <span class="type">FileChannel</span> <span class="variable">out</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(dest).getChannel()) &#123;</span><br><span class="line">    in.transferTo(<span class="number">0</span>, in.size(), out);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="23-é«˜å¹¶å‘æœåŠ¡å™¨ç“¶é¢ˆ"><a href="#23-é«˜å¹¶å‘æœåŠ¡å™¨ç“¶é¢ˆ" class="headerlink" title="23. é«˜å¹¶å‘æœåŠ¡å™¨ç“¶é¢ˆ"></a>23. é«˜å¹¶å‘æœåŠ¡å™¨ç“¶é¢ˆ</h3><ul><li>å•çº¿ç¨‹ Selector æ€§èƒ½ä¸è¶³ã€‚</li><li>Buffer&#x2F;Direct å†…å­˜æ³„éœ²ã€‚</li><li>å¤§é‡å°åŒ…ï¼ˆTCP ç²˜æ‹†åŒ…ï¼‰ã€‚</li><li>epoll ç©ºè½®è¯¢ bugï¼ˆCPU é£™é«˜ï¼‰ã€‚</li></ul><hr><h3 id="24-Windows-vs-Linux"><a href="#24-Windows-vs-Linux" class="headerlink" title="24. Windows vs Linux"></a>24. Windows vs Linux</h3><ul><li><strong>Linux</strong>ï¼šepollï¼Œå¯ä¼¸ç¼©åˆ°ç™¾ä¸‡è¿æ¥ã€‚</li><li><strong>Windows</strong>ï¼šselectï¼Œfd æ•°é‡å—é™ï¼Œæ‰©å±•æ€§å·®ã€‚</li></ul><hr><h3 id="25-ç®€å•-Echo-Server-æ€è·¯"><a href="#25-ç®€å•-Echo-Server-æ€è·¯" class="headerlink" title="25. ç®€å• Echo Server æ€è·¯"></a>25. ç®€å• Echo Server æ€è·¯</h3><ol><li>åˆ›å»º <code>Selector</code></li><li>æ³¨å†Œ <code>ServerSocketChannel</code></li><li>å¾ªç¯ <code>select()</code></li><li>å¤„ç† <code>accept</code> â†’ æ³¨å†Œ SocketChannel</li><li>å¤„ç† <code>read</code> â†’ å›å†™æ•°æ®</li></ol><hr><p>âš¡æ€»ç»“ï¼šNIO çš„æ ¸å¿ƒæ˜¯ <strong>ç¼“å†²åŒºç®¡ç†</strong>ï¼ˆByteBufferï¼‰ã€<strong>å¤šè·¯å¤ç”¨</strong>ï¼ˆSelectorï¼‰ã€<strong>é›¶æ‹·è´ä¼˜åŒ–</strong>ï¼ˆFileChannel.transferTo&#x2F;MappedByteBufferï¼‰ã€‚<br> åœ¨é«˜å¹¶å‘ç³»ç»Ÿé‡Œï¼ˆå¦‚ Nettyï¼‰ï¼Œè¿™äº› API ä¼šç»“åˆçº¿ç¨‹æ¨¡å‹å’Œå†…å­˜æ± è¿›ä¸€æ­¥ä¼˜åŒ–ã€‚</p><hr><h2 id="å…­ã€Socket-TCP-UDP-WebSocketï¼ˆ101â€“140ï¼‰"><a href="#å…­ã€Socket-TCP-UDP-WebSocketï¼ˆ101â€“140ï¼‰" class="headerlink" title="å…­ã€Socket &#x2F; TCP &#x2F; UDP &#x2F; WebSocketï¼ˆ101â€“140ï¼‰"></a>å…­ã€Socket &#x2F; TCP &#x2F; UDP &#x2F; WebSocketï¼ˆ101â€“140ï¼‰</h2><ol><li>Socket çš„åŸºæœ¬æ¦‚å¿µï¼šç«¯ç‚¹ã€ä¸‰å…ƒç»„&#x2F;å››å…ƒç»„ï¼ˆIP:port + peerï¼‰ã€‚</li><li>Java ä¸­ Socketã€ServerSocketã€DatagramSocket çš„ä¸»è¦ API åŒºåˆ«ã€‚</li><li>TCP ä¸ UDP çš„æ ¸å¿ƒå·®å¼‚ï¼ˆå¯é æ€§ã€æœ‰åºæ€§ã€è¿æ¥æ€§ï¼‰ã€‚</li><li>TCP ä¸‰æ¬¡æ¡æ‰‹ï¼ˆSYNã€SYN-ACKã€ACKï¼‰ä¸å››æ¬¡æŒ¥æ‰‹æµç¨‹è¯¦è§£ã€‚</li><li>TIME_WAITã€CLOSE_WAITã€FIN_WAIT1&#x2F;2 ç­‰ TCP çŠ¶æ€å«ä¹‰ä¸äº§ç”ŸåŸå› ã€‚</li><li>åŠå¼€è¿æ¥ï¼ˆhalf-openï¼‰æ˜¯ä»€ä¹ˆï¼Œå¦‚ä½•æ£€æµ‹ä¸æ¢å¤ï¼Ÿ</li><li>TCP çš„æµé‡æ§åˆ¶ï¼ˆçª—å£ï¼‰ä¸æ‹¥å¡æ§åˆ¶ï¼ˆæ…¢å¯åŠ¨ã€æ‹¥å¡é¿å…ã€å¿«é‡ä¼ ã€å¿«æ¢å¤ï¼‰åŸºç¡€ã€‚</li><li>Nagle ç®—æ³•ï¼ˆTCP_NODELAYï¼‰çš„åŸç†å’Œåœ¨å»¶è¿Ÿåœºæ™¯ä¸‹çš„å½±å“ã€‚</li><li>TCP å»¶è¿Ÿç¡®è®¤ï¼ˆdelayed ACKï¼‰å¯¹äº¤äº’å‹åº”ç”¨çš„å½±å“ã€‚</li><li>Socket é€‰é¡¹ SO_TIMEOUTã€SO_KEEPALIVEã€SO_REUSEADDRã€SO_REUSEPORTã€SO_LINGER å«ä¹‰ä¸ä½¿ç”¨åœºæ™¯ã€‚</li><li>backlog å‚æ•°ï¼ˆServerSocket æ„é€ æˆ– listenï¼‰ä¸ accept é˜Ÿåˆ—ï¼ˆsyn, accept é˜Ÿåˆ—ï¼‰åŒºåˆ«ã€‚</li><li>ephemeral portï¼ˆçŸ­æš‚ç«¯å£ï¼‰ä¸ç«¯å£è€—å°½é—®é¢˜åŠè§£å†³åŠæ³•ã€‚</li><li>SYN flood æ”»å‡»çš„åŸç†å’Œé˜²æŠ¤ï¼ˆSYN cookiesã€firewallï¼‰ã€‚</li><li>TCP å¿«é€Ÿæ‰“å¼€ï¼ˆTCP Fast Openï¼‰æ˜¯ä»€ä¹ˆï¼Œæœ‰ä½•ä¼˜åŠ£ï¼Ÿï¼ˆç®€è¿°ï¼‰</li><li>MTUã€MSS ä¸ IP åˆ†ç‰‡å¯¹ä¼ è¾“çš„å½±å“ä¸è¯Šæ–­æ–¹æ³•ã€‚</li><li>UDP çš„ç»„æ’­ï¼ˆMulticastï¼‰ä¸å¹¿æ’­ï¼ˆBroadcastï¼‰æœºåˆ¶ä¸ Java æ”¯æŒï¼ˆMulticastSocketï¼‰ã€‚</li><li>UDP ä¸¢åŒ…ã€ä¹±åºã€åŒ…å¤§å°é™åˆ¶ï¼ˆæœ€ä½³å®è·µï¼‰ã€‚</li><li>UDP ç©¿é€ NATï¼ˆSTUN&#x2F;ICEï¼‰çš„åŸºæœ¬åŸç†ã€‚</li><li>å¦‚ä½•åœ¨ Java ä¸­å®ç°é«˜æ€§èƒ½ UDP æœåŠ¡å™¨ï¼Ÿï¼ˆNIO + DatagramChannelï¼‰</li><li>WebSocket åè®®åŸºç¡€ï¼ˆæ¡æ‰‹ã€å¸§æ ¼å¼ã€ping&#x2F;pongã€closeï¼‰ã€‚</li><li>Java å®ç° WebSocket çš„å¸¸è§åº“ï¼ˆjavax.websocketã€Netty websocketã€Undertowï¼‰ã€‚</li><li>TLS over TCPï¼ˆHTTPSï¼‰çš„æ¡æ‰‹æµç¨‹è¦ç‚¹ï¼ˆè¯ä¹¦éªŒè¯ã€å¯¹ç§°å¯†é’¥åå•†ï¼‰ã€‚</li><li>ä½¿ç”¨ SSLSocket &#x2F; SSLServerSocket å’Œ SSLEngine çš„å·®åˆ«åŠé€‚ç”¨åœºæ™¯ã€‚</li><li>SSL&#x2F;TLS æ¡æ‰‹çš„é‡ç”¨ï¼ˆsession resumptionï¼‰ä¸æ€§èƒ½ä¼˜åŒ–ã€‚</li><li>ä¸­é—´äººæ”»å‡»ï¼ˆMITMï¼‰ä¸è¯ä¹¦é“¾ã€CAã€ä¿¡ä»»æ ¹çš„è§’è‰²ã€‚</li><li>å¦‚ä½•åœ¨ Socket ç¨‹åºä¸­å®ç°å¿ƒè·³ã€è¶…æ—¶ä¸æ–­çº¿é‡è¿ï¼Ÿ</li><li>TCP Keepalive ä¸åº”ç”¨å±‚å¿ƒè·³çš„åŒºåˆ«å’ŒååŒä½¿ç”¨ã€‚</li><li>å¦‚ä½•é€šè¿‡æŠ“åŒ…ï¼ˆtcpdump&#x2F;wiresharkï¼‰è¯Šæ–­ Socket è¿æ¥é—®é¢˜ï¼Ÿ</li><li>Socket çš„éé˜»å¡ accept&#x2F;read&#x2F;write å®ç°æ³¨æ„ç‚¹ï¼ˆèµ„æº&#x2F;å¼‚æ­¥å®‰å…¨ï¼‰ã€‚</li><li>å¦‚ä½•é¿å… TCP ç²˜åŒ…&#x2F;æ‹†åŒ…åœ¨ Socket åŸç”Ÿç¼–ç¨‹ä¸­çš„å½±å“ï¼ˆæµå¼åè®®è®¾è®¡ï¼‰ï¼Ÿ</li><li>å®æˆ˜ï¼šå®ç°ä¸€ä¸ªå¸¦é•¿åº¦å‰ç¼€çš„ TCP åè®®çš„ Java æœåŠ¡ç«¯&#x2F;å®¢æˆ·ç«¯ï¼ˆæ€è·¯ï¼‰ã€‚</li><li>å¦‚ä½•ä¼˜é›…å¤„ç†å¤§é‡çŸ­è¿æ¥çš„åœºæ™¯ï¼Ÿï¼ˆè¿æ¥æ± ã€HTTP keep-aliveï¼‰</li><li>Socket ç«¯å£å¤ç”¨ï¼ˆSO_REUSEADDR vs SO_REUSEPORTï¼‰åœ¨è´Ÿè½½å‡è¡¡ä¸­çš„ç”¨æ³•ã€‚</li><li>å¤šè·¯å¤ç”¨ï¼ˆselect&#x2F;poll&#x2F;epollï¼‰ä¸ socket å¤§è¿æ¥æ•°çš„å¤„ç†ã€‚</li><li>ç½‘ç»œå­—èŠ‚åºï¼ˆbig-endianï¼‰ä¸æ•°æ®ç¼–è§£ç æ³¨æ„ç‚¹ã€‚</li><li>ä½¿ç”¨ TCP_NODELAYï¼ˆç¦ç”¨ Nagleï¼‰æ—¶çš„ CPU&#x2F;ç½‘ç»œ trade-offã€‚</li><li>å¦‚ä½•åœ¨ Java ä¸­åšåˆ°é›¶æ‹·è´æ–‡ä»¶ä¼ è¾“ï¼ˆSocket + FileChannel.transferToï¼‰ï¼Ÿ</li><li>Socket å…³é—­æµç¨‹ä¸­é‡åˆ°é˜»å¡ï¼ˆSO_LINGERï¼‰çš„å¤„ç†åŠæ³•ã€‚</li><li>å¦‚ä½•é˜²æ­¢æˆ–æ£€æµ‹ â€œsocket half-closedâ€ çš„èµ„æºæ³„æ¼ï¼Ÿ</li><li>å®æˆ˜é¢˜ï¼šç”¨ BIOã€NIOã€Netty å„å®ç°ä¸€ä¸ªç®€æ˜“çš„èŠå¤©æœåŠ¡å™¨ï¼Œæ¯”è¾ƒæ€§èƒ½ä¸ä»£ç å¤æ‚åº¦ï¼ˆæ€è·¯è¦ç‚¹ï¼‰ã€‚</li></ol><hr><h2 id="ä¸ƒã€å¼‚æ­¥-IOã€IO-æ¨¡å‹ä¸é«˜é˜¶æ¨¡å¼ï¼ˆ141â€“150ï¼‰"><a href="#ä¸ƒã€å¼‚æ­¥-IOã€IO-æ¨¡å‹ä¸é«˜é˜¶æ¨¡å¼ï¼ˆ141â€“150ï¼‰" class="headerlink" title="ä¸ƒã€å¼‚æ­¥ IOã€IO æ¨¡å‹ä¸é«˜é˜¶æ¨¡å¼ï¼ˆ141â€“150ï¼‰"></a>ä¸ƒã€å¼‚æ­¥ IOã€IO æ¨¡å‹ä¸é«˜é˜¶æ¨¡å¼ï¼ˆ141â€“150ï¼‰</h2><ol><li>IO æ¨¡å‹åˆ†ç±»ï¼šåŒæ­¥é˜»å¡ã€åŒæ­¥éé˜»å¡ã€IO å¤šè·¯å¤ç”¨ã€ä¿¡å·é©±åŠ¨ã€å¼‚æ­¥ï¼ˆAIOï¼‰ã€‚</li><li>Reactor æ¨¡å¼ä¸ Proactor æ¨¡å¼çš„åŸç†ä¸åŒºåˆ«ã€‚</li><li>Java AIOï¼ˆAsynchronousChannelã€AsynchronousSocketChannelï¼‰API ä»‹ç»ã€‚</li><li>CompletionHandler ä¸ Future é£æ ¼çš„å¼‚æ­¥å›è°ƒæ¯”è¾ƒã€‚</li><li>é«˜å¹¶å‘ä¸‹é€‰æ‹© NIO è¿˜æ˜¯ AIO çš„å®é™…è€ƒé‡ï¼ˆå®ç°å¤æ‚åº¦ã€å¹³å°æ”¯æŒï¼‰ã€‚</li><li>äº‹ä»¶é©±åŠ¨ç³»ç»Ÿçš„ back-pressure è®¾è®¡ï¼ˆæµæ§ã€é€Ÿç‡é™åˆ¶ï¼‰ã€‚</li><li>çº¿ç¨‹æ¨¡å‹è®¾è®¡ï¼šacceptors &#x2F; io workers &#x2F; business workers çš„æƒè¡¡ã€‚</li><li>RCUã€æ— é”é˜Ÿåˆ—åœ¨é«˜å¹¶å‘ IO æ¡†æ¶ä¸­çš„åº”ç”¨åœºæ™¯ã€‚</li><li>å¦‚ä½•åœ¨åº”ç”¨å±‚å®ç°è¯·æ±‚é˜Ÿåˆ—ä¸æ’é˜Ÿç­–ç•¥æ¥ç¼“è§£çªå‘æµé‡ï¼Ÿ</li><li>å®æˆ˜é¢˜ï¼šè®¾è®¡ä¸€ä¸ªæ”¯æŒç™¾ä¸‡è¿æ¥çš„æœåŠ¡å™¨æ¶æ„ï¼ˆæ ¸å¿ƒç»„ä»¶ä¸ IO ç­–ç•¥ï¼‰ã€‚</li></ol><hr><h2 id="å…«ã€é›¶æ‹·è´ã€å†…æ ¸ä¸æ€§èƒ½è°ƒä¼˜ï¼ˆ151â€“160ï¼‰"><a href="#å…«ã€é›¶æ‹·è´ã€å†…æ ¸ä¸æ€§èƒ½è°ƒä¼˜ï¼ˆ151â€“160ï¼‰" class="headerlink" title="å…«ã€é›¶æ‹·è´ã€å†…æ ¸ä¸æ€§èƒ½è°ƒä¼˜ï¼ˆ151â€“160ï¼‰"></a>å…«ã€é›¶æ‹·è´ã€å†…æ ¸ä¸æ€§èƒ½è°ƒä¼˜ï¼ˆ151â€“160ï¼‰</h2><ol><li>é›¶æ‹·è´ï¼ˆzero-copyï¼‰æ¦‚å¿µå’Œå¸¸è§å®ç°ï¼ˆsendfile, mmap, spliceï¼‰ã€‚</li><li>FileChannel.transferTo&#x2F;transferFrom åœ¨ Linux ä¸‹å¦‚ä½•åˆ©ç”¨ sendfile å®ç°é›¶æ‹·è´ï¼Ÿ</li><li>mmapï¼ˆå†…å­˜æ˜ å°„æ–‡ä»¶ï¼‰çš„å®ç°åŸç†ä¸ GC &#x2F;å›æ”¶é—®é¢˜ã€‚</li><li>DMAï¼ˆDirect Memory Accessï¼‰åœ¨é›¶æ‹·è´ä¸­çš„ä½œç”¨ä¸é™åˆ¶ã€‚</li><li>å†…æ ¸æ€ &#x2F; ç”¨æˆ·æ€æ‹·è´æ¬¡æ•°ä¸é›¶æ‹·è´å¸¦æ¥çš„å‡å°‘æ•ˆæœã€‚</li><li>TCP çª—å£ã€æ‹¥å¡æ§åˆ¶è°ƒä¼˜å‚æ•°ï¼ˆnet.ipv4.tcp_* ç³»åˆ—å¸¸è§é¡¹ï¼‰ã€‚</li><li>ç³»ç»Ÿçº§è°ƒä¼˜ï¼šæ–‡ä»¶æè¿°ç¬¦ä¸Šé™ï¼ˆulimit -nï¼‰ã€somaxconnã€backlogã€epoll_limits ç­‰ã€‚</li><li>é«˜å¹¶å‘ç½‘ç»œæœåŠ¡çš„ç›‘æ§æŒ‡æ ‡ï¼ˆfd ä½¿ç”¨ã€accept latencyã€context switchã€cpu stealï¼‰ã€‚</li><li>æ€§èƒ½è¯Šæ–­å·¥å…·ä¸æµç¨‹ï¼šiostat, vmstat, sar, perf, tcpdump, ss, straceã€‚</li><li>å®æˆ˜é¢˜ï¼šå¦‚ä½•å®šä½å¹¶ä¿®å¤ä¸€ä¸ªé«˜å¹¶å‘æœåŠ¡å™¨çš„ accept é˜»å¡ &#x2F; è¿æ¥ä¸¢å¤± é—®é¢˜ï¼ˆè¯Šæ–­æ­¥éª¤ï¼‰ã€‚</li></ol><hr><h1 id="Java-åŸºç¡€é¢è¯•é¢˜"><a href="#Java-åŸºç¡€é¢è¯•é¢˜" class="headerlink" title="Java åŸºç¡€é¢è¯•é¢˜"></a>Java åŸºç¡€é¢è¯•é¢˜</h1><h3 id="ä¸€ã€è¯­è¨€ç‰¹æ€§-åŸºç¡€è¯­æ³•"><a href="#ä¸€ã€è¯­è¨€ç‰¹æ€§-åŸºç¡€è¯­æ³•" class="headerlink" title="ä¸€ã€è¯­è¨€ç‰¹æ€§ &amp; åŸºç¡€è¯­æ³•"></a>ä¸€ã€è¯­è¨€ç‰¹æ€§ &amp; åŸºç¡€è¯­æ³•</h3><hr><h3 id="1-Java-ä¸­çš„-å’Œ-equals-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå¦‚ä½•æ­£ç¡®é‡å†™-equals-ï¼Ÿ"><a href="#1-Java-ä¸­çš„-å’Œ-equals-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå¦‚ä½•æ­£ç¡®é‡å†™-equals-ï¼Ÿ" class="headerlink" title="1. Java ä¸­çš„ &#x3D;&#x3D; å’Œ equals() æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå¦‚ä½•æ­£ç¡®é‡å†™ equals()ï¼Ÿ"></a>1. Java ä¸­çš„ &#x3D;&#x3D; å’Œ equals() æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå¦‚ä½•æ­£ç¡®é‡å†™ equals()ï¼Ÿ</h3><ul><li><strong>&#x3D;&#x3D;</strong><ul><li>å¯¹äºåŸºæœ¬æ•°æ®ç±»å‹ï¼šæ¯”è¾ƒå€¼æ˜¯å¦ç›¸ç­‰ã€‚</li><li>å¯¹äºå¼•ç”¨ç±»å‹ï¼šæ¯”è¾ƒä¸¤ä¸ªå¼•ç”¨æ˜¯å¦æŒ‡å‘åŒä¸€å—å†…å­˜åœ°å€ï¼ˆå³æ˜¯å¦æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼‰ã€‚</li></ul></li><li><strong>equals()</strong><ul><li>å®šä¹‰åœ¨ <code>Object</code> ç±»ä¸­ï¼Œé»˜è®¤å®ç°ä¹Ÿæ˜¯ <code>==</code>ã€‚</li><li>ä¸€èˆ¬ä¼šè¢«ç±»ï¼ˆå¦‚ <code>String</code>ã€<code>Integer</code> ç­‰ï¼‰é‡å†™ï¼Œç”¨æ¥æ¯”è¾ƒâ€œå†…å®¹â€æ˜¯å¦ç›¸åŒï¼Œè€Œä¸æ˜¯å†…å­˜åœ°å€ã€‚</li></ul></li></ul><p>ğŸ‘‰ æ­£ç¡®é‡å†™ <code>equals()</code> è¦æ»¡è¶³ <strong>è‡ªåæ€§ã€å¯¹ç§°æ€§ã€ä¼ é€’æ€§ã€ä¸€è‡´æ€§</strong>ï¼Œå¹¶ä¸”å’Œ <code>null</code> æ¯”è¾ƒæ—¶è¿”å› <code>false</code>ã€‚<br> å…¸å‹å®ç°æ­¥éª¤ï¼š</p><ol><li>åˆ¤æ–­ <code>this == obj</code>ï¼Œè‹¥ç›¸ç­‰ç›´æ¥è¿”å› <code>true</code>ã€‚</li><li>åˆ¤æ–­ <code>obj</code> æ˜¯å¦ä¸ºåŒç±»å®ä¾‹ã€‚</li><li>å¼ºåˆ¶ç±»å‹è½¬æ¢åé€ä¸ªæ¯”è¾ƒå…³é”®å­—æ®µã€‚</li></ol><hr><h3 id="2-ä¸ºä»€ä¹ˆé‡å†™-equals-æ—¶å¿…é¡»é‡å†™-hashCode-ï¼Ÿä¸é‡å†™ä¼šæ€æ ·ï¼Ÿ"><a href="#2-ä¸ºä»€ä¹ˆé‡å†™-equals-æ—¶å¿…é¡»é‡å†™-hashCode-ï¼Ÿä¸é‡å†™ä¼šæ€æ ·ï¼Ÿ" class="headerlink" title="2. ä¸ºä»€ä¹ˆé‡å†™ equals() æ—¶å¿…é¡»é‡å†™ hashCode()ï¼Ÿä¸é‡å†™ä¼šæ€æ ·ï¼Ÿ"></a>2. ä¸ºä»€ä¹ˆé‡å†™ equals() æ—¶å¿…é¡»é‡å†™ hashCode()ï¼Ÿä¸é‡å†™ä¼šæ€æ ·ï¼Ÿ</h3><ul><li><strong>åŸå› </strong>ï¼šå› ä¸º <code>HashMap</code>ã€<code>HashSet</code> ç­‰åŸºäºå“ˆå¸Œè¡¨çš„é›†åˆä½¿ç”¨ <code>hashCode()</code> æ¥å†³å®šå…ƒç´ å­˜æ”¾ä½ç½®ï¼Œç„¶åå†ç”¨ <code>equals()</code> åˆ¤æ–­å…ƒç´ æ˜¯å¦ç›¸åŒã€‚</li><li><strong>å¥‘çº¦</strong>ï¼ˆJDK æ–‡æ¡£è§„å®šï¼‰ï¼š<ul><li>å¦‚æœä¸¤ä¸ªå¯¹è±¡ <code>equals()</code> ç›¸ç­‰ï¼Œé‚£ä¹ˆå®ƒä»¬çš„ <code>hashCode()</code> å¿…é¡»ç›¸ç­‰ã€‚</li><li>åä¹‹ï¼Œ<code>hashCode()</code> ç›¸ç­‰å¹¶ä¸ä¸€å®šæ„å‘³ç€ <code>equals()</code> ç›¸ç­‰ã€‚</li></ul></li><li><strong>ä¸é‡å†™ä¼šæ€æ ·</strong>ï¼š<ul><li>ä¸¤ä¸ªå†…å®¹ç›¸åŒçš„å¯¹è±¡å¯èƒ½ <code>equals()</code> ä¸º trueï¼Œä½† <code>hashCode()</code> ä¸åŒï¼Œå¯¼è‡´æ”¾è¿› <code>HashSet</code> æ—¶è¢«å½“ä½œä¸¤ä¸ªå¯¹è±¡å­˜å‚¨ï¼Œè¿èƒŒé›†åˆâ€œä¸é‡å¤â€çš„åŸåˆ™ã€‚</li></ul></li></ul><hr><h3 id="3-Object-ç±»æœ‰å“ªäº›æ–¹æ³•ï¼Ÿå“ªäº›æ–¹æ³•ç»å¸¸éœ€è¦é‡å†™ï¼Ÿ"><a href="#3-Object-ç±»æœ‰å“ªäº›æ–¹æ³•ï¼Ÿå“ªäº›æ–¹æ³•ç»å¸¸éœ€è¦é‡å†™ï¼Ÿ" class="headerlink" title="3. Object ç±»æœ‰å“ªäº›æ–¹æ³•ï¼Ÿå“ªäº›æ–¹æ³•ç»å¸¸éœ€è¦é‡å†™ï¼Ÿ"></a>3. Object ç±»æœ‰å“ªäº›æ–¹æ³•ï¼Ÿå“ªäº›æ–¹æ³•ç»å¸¸éœ€è¦é‡å†™ï¼Ÿ</h3><ul><li><strong>å¸¸ç”¨æ–¹æ³•</strong>ï¼š<ul><li><code>equals()</code>ï¼šå¯¹è±¡å†…å®¹æ¯”è¾ƒã€‚</li><li><code>hashCode()</code>ï¼šå“ˆå¸Œå€¼ï¼Œé…åˆ <code>equals</code>ã€‚</li><li><code>toString()</code>ï¼šå¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤ºã€‚</li><li><code>clone()</code>ï¼šå¯¹è±¡å…‹éš†ï¼ˆæµ…æ‹·è´ï¼Œéœ€å®ç° <code>Cloneable</code>ï¼‰ã€‚</li><li><code>finalize()</code>ï¼šå¯¹è±¡è¢« GC å‰è°ƒç”¨ï¼ˆå·²ä¸æ¨èä½¿ç”¨ï¼‰ã€‚</li></ul></li><li><strong>åŒæ­¥æ–¹æ³•</strong>ï¼š<ul><li><code>wait()</code> &#x2F; <code>notify()</code> &#x2F; <code>notifyAll()</code>ï¼šçº¿ç¨‹é€šä¿¡ã€‚</li></ul></li><li><strong>ç±»ç›¸å…³æ–¹æ³•</strong>ï¼š<ul><li><code>getClass()</code>ï¼šè·å–å¯¹è±¡çš„è¿è¡Œæ—¶ç±»å‹ã€‚</li></ul></li></ul><p>ğŸ‘‰ ç»å¸¸éœ€è¦é‡å†™çš„ï¼š<code>equals()</code>ã€<code>hashCode()</code>ã€<code>toString()</code>ã€‚</p><hr><h3 id="4-finalã€finallyã€finalize-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#4-finalã€finallyã€finalize-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="4. finalã€finallyã€finalize() æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>4. finalã€finallyã€finalize() æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><ul><li><strong>final</strong>ï¼šå…³é”®å­—<ul><li>ä¿®é¥°ç±»ï¼šç±»ä¸èƒ½è¢«ç»§æ‰¿ã€‚</li><li>ä¿®é¥°æ–¹æ³•ï¼šæ–¹æ³•ä¸èƒ½è¢«é‡å†™ã€‚</li><li>ä¿®é¥°å˜é‡ï¼šå˜é‡æˆä¸ºå¸¸é‡ï¼Œåªèƒ½èµ‹å€¼ä¸€æ¬¡ã€‚</li></ul></li><li><strong>finally</strong>ï¼šå…³é”®å­—<ul><li>ç”¨äº <code>try-catch-finally</code>ï¼Œæ— è®ºæ˜¯å¦æœ‰å¼‚å¸¸ï¼Œ<code>finally</code> å—ä¸­çš„ä»£ç ä¸€å®šä¼šæ‰§è¡Œï¼ˆé™¤é <code>System.exit(0)</code>ï¼‰ã€‚</li></ul></li><li><strong>finalize()</strong>ï¼šæ–¹æ³•<ul><li><code>Object</code> ç±»å®šä¹‰ï¼Œåœ¨ GC å‰è°ƒç”¨ï¼Œå¸¸ç”¨äºé‡Šæ”¾éæ‰˜ç®¡èµ„æºã€‚</li><li>å·²è¢«æ ‡è®°ä¸ºåºŸå¼ƒï¼ˆJava 9 å¼€å§‹ï¼‰ï¼Œå› ä¸ºä¸å¯é¢„æµ‹ã€ä¸å¯é ã€‚</li></ul></li></ul><hr><h3 id="5-Java-ä¸­çš„-instanceof-å…³é”®å­—æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ"><a href="#5-Java-ä¸­çš„-instanceof-å…³é”®å­—æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ" class="headerlink" title="5. Java ä¸­çš„ instanceof å…³é”®å­—æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ"></a>5. Java ä¸­çš„ instanceof å…³é”®å­—æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</h3><ul><li><strong>ä½œç”¨</strong>ï¼šåˆ¤æ–­æŸä¸ªå¯¹è±¡æ˜¯å¦ä¸ºæŸä¸ªç±»æˆ–å…¶å­ç±»çš„å®ä¾‹ã€‚</li><li><strong>å®ç°åŸç†</strong>ï¼š<ul><li>JVM åœ¨å¯¹è±¡å¤´ä¸­å­˜å‚¨äº†å¯¹è±¡æ‰€å±çš„ç±»çš„å…ƒæ•°æ®æŒ‡é’ˆã€‚</li><li><code>instanceof</code> å®é™…æ˜¯æ£€æŸ¥è¯¥ç±»å…ƒæ•°æ®æ˜¯å¦æ˜¯æŒ‡å®šç±»æˆ–å…¶å­ç±»ã€‚</li><li>ç¼–è¯‘å™¨ä¼šå°† <code>obj instanceof A</code> è½¬æ¢ä¸ºå­—èŠ‚ç  <code>instanceof</code> æŒ‡ä»¤ï¼Œç”± JVM åœ¨è¿è¡Œæ—¶åˆ¤æ–­ã€‚</li></ul></li></ul><hr><h3 id="6-æ¥å£å’ŒæŠ½è±¡ç±»çš„åŒºåˆ«ï¼Ÿæ¥å£èƒ½ä¸èƒ½æœ‰æ„é€ å‡½æ•°ï¼Ÿ"><a href="#6-æ¥å£å’ŒæŠ½è±¡ç±»çš„åŒºåˆ«ï¼Ÿæ¥å£èƒ½ä¸èƒ½æœ‰æ„é€ å‡½æ•°ï¼Ÿ" class="headerlink" title="6. æ¥å£å’ŒæŠ½è±¡ç±»çš„åŒºåˆ«ï¼Ÿæ¥å£èƒ½ä¸èƒ½æœ‰æ„é€ å‡½æ•°ï¼Ÿ"></a>6. æ¥å£å’ŒæŠ½è±¡ç±»çš„åŒºåˆ«ï¼Ÿæ¥å£èƒ½ä¸èƒ½æœ‰æ„é€ å‡½æ•°ï¼Ÿ</h3><ul><li><strong>æ¥å£</strong>ï¼š<ul><li>åªèƒ½å®šä¹‰æ–¹æ³•ï¼ˆJava 8 ä¹‹åå¯æœ‰ <code>default</code> å’Œ <code>static</code> æ–¹æ³•ï¼‰ã€‚</li><li>ä¸èƒ½æœ‰æ„é€ å‡½æ•°ï¼ˆå› ä¸ºæ¥å£ä¸èƒ½ç›´æ¥å®ä¾‹åŒ–ï¼‰ã€‚</li><li>å¯ä»¥å®ç° <strong>å¤šç»§æ‰¿</strong>ï¼ˆä¸€ä¸ªç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£ï¼‰ã€‚</li></ul></li><li><strong>æŠ½è±¡ç±»</strong>ï¼š<ul><li>å¯ä»¥æœ‰æ™®é€šæ–¹æ³•ã€æŠ½è±¡æ–¹æ³•ã€æˆå‘˜å˜é‡ã€‚</li><li>å¯ä»¥æœ‰æ„é€ å‡½æ•°ï¼ˆä½†ä¸èƒ½ç›´æ¥ newï¼Œç”¨äºå­ç±»æ„é€ æ—¶è°ƒç”¨ï¼‰ã€‚</li><li>åªèƒ½å•ç»§æ‰¿ã€‚</li></ul></li></ul><hr><h3 id="7-æ¥å£å¯ä»¥å¤šç»§æ‰¿å—ï¼ŸæŠ½è±¡ç±»å¯ä»¥å®ç°æ¥å£å—ï¼Ÿ"><a href="#7-æ¥å£å¯ä»¥å¤šç»§æ‰¿å—ï¼ŸæŠ½è±¡ç±»å¯ä»¥å®ç°æ¥å£å—ï¼Ÿ" class="headerlink" title="7. æ¥å£å¯ä»¥å¤šç»§æ‰¿å—ï¼ŸæŠ½è±¡ç±»å¯ä»¥å®ç°æ¥å£å—ï¼Ÿ"></a>7. æ¥å£å¯ä»¥å¤šç»§æ‰¿å—ï¼ŸæŠ½è±¡ç±»å¯ä»¥å®ç°æ¥å£å—ï¼Ÿ</h3><ul><li><strong>æ¥å£å¯ä»¥å¤šç»§æ‰¿</strong>ï¼š<code>interface A extends B, C &#123;&#125;</code></li><li><strong>æŠ½è±¡ç±»å¯ä»¥å®ç°æ¥å£</strong>ï¼šå¯ä»¥é€‰æ‹©æ€§å®ç°æ¥å£çš„æ–¹æ³•ï¼Œæœªå®ç°çš„æ–¹æ³•ä»ä¿æŒ <code>abstract</code>ï¼Œç”±å­ç±»å®ç°ã€‚</li></ul><hr><h3 id="8-default-æ–¹æ³•å’Œ-static-æ–¹æ³•åœ¨æ¥å£ä¸­çš„æ„ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#8-default-æ–¹æ³•å’Œ-static-æ–¹æ³•åœ¨æ¥å£ä¸­çš„æ„ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="8. default æ–¹æ³•å’Œ static æ–¹æ³•åœ¨æ¥å£ä¸­çš„æ„ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿ"></a>8. default æ–¹æ³•å’Œ static æ–¹æ³•åœ¨æ¥å£ä¸­çš„æ„ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿ</h3><ul><li><strong>default æ–¹æ³•</strong>ï¼š<ul><li>Java 8 å¼•å…¥ï¼Œæ¥å£ä¸­å¯ä»¥æœ‰é»˜è®¤å®ç°çš„æ–¹æ³•ã€‚</li><li>è§£å†³æ¥å£æ‰©å±•çš„å…¼å®¹æ€§é—®é¢˜ï¼ˆç»™è€æ¥å£æ–°å¢æ–¹æ³•ä¸ä¼šå¯¼è‡´æ‰€æœ‰å®ç°ç±»æŠ¥é”™ï¼‰ã€‚</li></ul></li><li><strong>static æ–¹æ³•</strong>ï¼š<ul><li>å±äºæ¥å£æœ¬èº«ï¼Œè€Œä¸æ˜¯å®ç°ç±»ã€‚</li><li>ç”¨äºæä¾›å·¥å…·æ–¹æ³•æˆ–å…¬å…±é€»è¾‘ï¼ˆç±»ä¼¼ <code>Collections</code> çš„å·¥å…·ç±»æ–¹æ³•ï¼‰ã€‚</li></ul></li></ul><hr><h3 id="9-ä»€ä¹ˆæ˜¯å†…éƒ¨ç±»ï¼Ÿåˆ†ä¸ºå“ªå‡ ç§ï¼Ÿ"><a href="#9-ä»€ä¹ˆæ˜¯å†…éƒ¨ç±»ï¼Ÿåˆ†ä¸ºå“ªå‡ ç§ï¼Ÿ" class="headerlink" title="9. ä»€ä¹ˆæ˜¯å†…éƒ¨ç±»ï¼Ÿåˆ†ä¸ºå“ªå‡ ç§ï¼Ÿ"></a>9. ä»€ä¹ˆæ˜¯å†…éƒ¨ç±»ï¼Ÿåˆ†ä¸ºå“ªå‡ ç§ï¼Ÿ</h3><ul><li><strong>å†…éƒ¨ç±»</strong>ï¼šå®šä¹‰åœ¨ç±»ä¸­çš„ç±»ï¼Œå¯ä»¥è®¿é—®å¤–éƒ¨ç±»çš„æˆå‘˜ã€‚</li><li><strong>ç§ç±»</strong>ï¼š<ol><li><strong>æˆå‘˜å†…éƒ¨ç±»</strong>ï¼ˆéé™æ€å†…éƒ¨ç±»ï¼‰<ul><li>ä¾èµ–å¤–éƒ¨ç±»å®ä¾‹ï¼Œä¸èƒ½æœ‰ <code>static</code> æˆå‘˜ã€‚</li></ul></li><li><strong>é™æ€å†…éƒ¨ç±»</strong><ul><li>ç±»ä¼¼æ™®é€šç±»ï¼Œä½†ä½œç”¨åŸŸåœ¨å¤–éƒ¨ç±»å†…ï¼Œå¯ä»¥æœ‰ <code>static</code> æˆå‘˜ã€‚</li></ul></li><li><strong>å±€éƒ¨å†…éƒ¨ç±»</strong><ul><li>å®šä¹‰åœ¨æ–¹æ³•ä½“æˆ–ä»£ç å—ä¸­ï¼Œåªèƒ½åœ¨è¯¥èŒƒå›´å†…ä½¿ç”¨ã€‚</li></ul></li><li><strong>åŒ¿åå†…éƒ¨ç±»</strong><ul><li>æ²¡æœ‰åå­—ï¼Œé€šå¸¸åœ¨éœ€è¦â€œä¸´æ—¶å®ç°æ¥å£æˆ–ç»§æ‰¿ç±»â€çš„åœºæ™¯ä½¿ç”¨ã€‚</li></ul></li></ol></li></ul><hr><h3 id="10-åŒ¿åå†…éƒ¨ç±»å’Œ-Lambda-è¡¨è¾¾å¼çš„åŒºåˆ«ï¼Ÿ"><a href="#10-åŒ¿åå†…éƒ¨ç±»å’Œ-Lambda-è¡¨è¾¾å¼çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="10. åŒ¿åå†…éƒ¨ç±»å’Œ Lambda è¡¨è¾¾å¼çš„åŒºåˆ«ï¼Ÿ"></a>10. åŒ¿åå†…éƒ¨ç±»å’Œ Lambda è¡¨è¾¾å¼çš„åŒºåˆ«ï¼Ÿ</h3><ul><li><strong>åŒ¿åå†…éƒ¨ç±»</strong>ï¼š<ul><li>å®ç°æ¥å£&#x2F;ç»§æ‰¿æŠ½è±¡ç±»çš„ <strong>å…·ä½“åŒ¿åç±»å¯¹è±¡</strong>ã€‚</li><li>å¯ä»¥æœ‰å¤šä¸ªæ–¹æ³•ï¼Œä½†é€šå¸¸åªé‡å†™éœ€è¦çš„æ–¹æ³•ã€‚</li><li>ç”Ÿæˆ <code>.class</code> æ–‡ä»¶ï¼ˆé¢å¤–å¼€é”€ï¼‰ã€‚</li></ul></li><li><strong>Lambda è¡¨è¾¾å¼</strong>ï¼š<ul><li>ä»…èƒ½ç”¨äº <strong>å‡½æ•°å¼æ¥å£</strong>ï¼ˆåªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•çš„æ¥å£ï¼‰ã€‚</li><li>æ›´ç®€æ´ï¼Œæœ¬è´¨æ˜¯è¯­æ³•ç³–ï¼Œç¼–è¯‘åç”Ÿæˆ <code>invokedynamic</code> å­—èŠ‚ç æŒ‡ä»¤ï¼Œè°ƒç”¨è¿è¡Œæ—¶ç”Ÿæˆçš„å‡½æ•°å¯¹è±¡ã€‚</li><li>ä¸ä¼šåˆ›å»ºæ–°çš„ <code>.class</code> æ–‡ä»¶ï¼Œæ›´è½»é‡ã€‚</li></ul></li></ul><hr><h3 id="äºŒã€æ•°æ®ç±»å‹-å†…å­˜"><a href="#äºŒã€æ•°æ®ç±»å‹-å†…å­˜" class="headerlink" title="äºŒã€æ•°æ®ç±»å‹ &amp; å†…å­˜"></a>äºŒã€æ•°æ®ç±»å‹ &amp; å†…å­˜</h3><hr><h3 id="1-Java-ä¸­çš„åŸºæœ¬æ•°æ®ç±»å‹å’ŒåŒ…è£…ç±»å‹æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ"><a href="#1-Java-ä¸­çš„åŸºæœ¬æ•°æ®ç±»å‹å’ŒåŒ…è£…ç±»å‹æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ" class="headerlink" title="1. Java ä¸­çš„åŸºæœ¬æ•°æ®ç±»å‹å’ŒåŒ…è£…ç±»å‹æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ"></a>1. Java ä¸­çš„åŸºæœ¬æ•°æ®ç±»å‹å’ŒåŒ…è£…ç±»å‹æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ</h3><ul><li><strong>åŸºæœ¬æ•°æ®ç±»å‹</strong>ï¼ˆprimitiveï¼‰ï¼š<code>byte, short, int, long, float, double, char, boolean</code><ul><li>å­˜å‚¨åœ¨æ ˆä¸Šï¼ˆæˆ–å¯„å­˜å™¨ï¼‰ï¼Œæ•ˆç‡é«˜ï¼Œç©ºé—´å ç”¨å›ºå®šã€‚</li><li>ä¸èƒ½ä¸º <code>null</code>ï¼Œé»˜è®¤å€¼å›ºå®šï¼ˆå¦‚ <code>int</code> é»˜è®¤ <code>0</code>ï¼Œ<code>boolean</code> é»˜è®¤ <code>false</code>ï¼‰ã€‚</li></ul></li><li><strong>åŒ…è£…ç±»å‹</strong>ï¼ˆwrapperï¼‰ï¼š<code>Byte, Short, Integer, Long, Float, Double, Character, Boolean</code><ul><li>æ˜¯å¯¹è±¡ï¼Œå­˜å‚¨åœ¨å †ä¸­ã€‚</li><li>å¯ä»¥ä¸º <code>null</code>ï¼Œæœ‰ä¸°å¯Œçš„ APIã€‚</li><li>å¯ä»¥å‚ä¸é›†åˆç±»ï¼ˆå¦‚ <code>ArrayList</code> åªèƒ½å­˜å¯¹è±¡ï¼‰ã€‚</li></ul></li><li><strong>è‡ªåŠ¨è£…ç®±&#x2F;æ‹†ç®±</strong>ï¼šJava ä¼šåœ¨åŸºæœ¬ç±»å‹å’ŒåŒ…è£…ç±»ä¹‹é—´è‡ªåŠ¨è½¬æ¢ã€‚</li></ul><hr><h3 id="2-ä¸ºä»€ä¹ˆ-Integer-æœ‰ç¼“å­˜æœºåˆ¶ï¼ŸèŒƒå›´æ˜¯å¤šå°‘ï¼Ÿ"><a href="#2-ä¸ºä»€ä¹ˆ-Integer-æœ‰ç¼“å­˜æœºåˆ¶ï¼ŸèŒƒå›´æ˜¯å¤šå°‘ï¼Ÿ" class="headerlink" title="2. ä¸ºä»€ä¹ˆ Integer æœ‰ç¼“å­˜æœºåˆ¶ï¼ŸèŒƒå›´æ˜¯å¤šå°‘ï¼Ÿ"></a>2. ä¸ºä»€ä¹ˆ Integer æœ‰ç¼“å­˜æœºåˆ¶ï¼ŸèŒƒå›´æ˜¯å¤šå°‘ï¼Ÿ</h3><ul><li><strong>åŸå› </strong>ï¼š<ul><li>ä¸ºäº†é¿å…é¢‘ç¹åˆ›å»ºå¯¹è±¡ï¼Œæé«˜æ€§èƒ½ã€‚</li><li>å°æ•´æ•°ä½¿ç”¨é¢‘ç‡é«˜ï¼ˆå¦‚å¾ªç¯ã€ä¸‹æ ‡ï¼‰ï¼Œæ‰€ä»¥ç¼“å­˜å¸¸ç”¨çš„æ•´æ•°ã€‚</li></ul></li><li><strong>èŒƒå›´</strong>ï¼š<code>-128 ~ 127</code>ã€‚</li><li><strong>å®ç°</strong>ï¼š<ul><li><code>IntegerCache</code> é™æ€å†…éƒ¨ç±»åœ¨ç±»åŠ è½½æ—¶åˆå§‹åŒ–ç¼“å­˜æ•°ç»„ã€‚</li><li><code>Integer.valueOf(int i)</code> æ–¹æ³•ä¼šå…ˆæŸ¥ç¼“å­˜ï¼Œå†å†³å®šæ˜¯å¦ new å¯¹è±¡ã€‚</li></ul></li></ul><hr><h3 id="3-ä¸ºä»€ä¹ˆ-new-Integer-127-new-Integer-127-ä¸º-falseï¼Œè€Œ-Integer-valueOf-127-Integer-valueOf-127-ä¸º-trueï¼Ÿ"><a href="#3-ä¸ºä»€ä¹ˆ-new-Integer-127-new-Integer-127-ä¸º-falseï¼Œè€Œ-Integer-valueOf-127-Integer-valueOf-127-ä¸º-trueï¼Ÿ" class="headerlink" title="3. ä¸ºä»€ä¹ˆ new Integer(127) == new Integer(127) ä¸º falseï¼Œè€Œ Integer.valueOf(127) == Integer.valueOf(127) ä¸º trueï¼Ÿ"></a>3. ä¸ºä»€ä¹ˆ <code>new Integer(127) == new Integer(127)</code> ä¸º falseï¼Œè€Œ <code>Integer.valueOf(127) == Integer.valueOf(127)</code> ä¸º trueï¼Ÿ</h3><ul><li><code>new Integer(127)</code>ï¼šæ¯æ¬¡éƒ½ä¼šåˆ›å»ºæ–°å¯¹è±¡ï¼Œå†…å­˜åœ°å€ä¸åŒï¼Œæ‰€ä»¥ <code>==</code> ä¸º falseã€‚</li><li><code>Integer.valueOf(127)</code>ï¼šä¼šæŸ¥ç¼“å­˜ï¼Œ<code>127</code> åœ¨ <code>-128~127</code> èŒƒå›´å†…ï¼Œè¿”å›åŒä¸€ä¸ªå¯¹è±¡å¼•ç”¨ï¼Œæ‰€ä»¥ <code>==</code> ä¸º trueã€‚</li></ul><p>ğŸ‘‰ <strong>æ€»ç»“</strong>ï¼š</p><ul><li><code>==</code> æ¯”è¾ƒçš„æ˜¯å¼•ç”¨åœ°å€ã€‚</li><li><code>equals()</code> æ‰æ˜¯æ¯”è¾ƒæ•°å€¼ã€‚</li></ul><hr><h3 id="4-NaN-å’Œ-Infinity-åœ¨-Java-ä¸­å¦‚ä½•è¡¨ç¤ºï¼Ÿ"><a href="#4-NaN-å’Œ-Infinity-åœ¨-Java-ä¸­å¦‚ä½•è¡¨ç¤ºï¼Ÿ" class="headerlink" title="4. NaN å’Œ Infinity åœ¨ Java ä¸­å¦‚ä½•è¡¨ç¤ºï¼Ÿ"></a>4. NaN å’Œ Infinity åœ¨ Java ä¸­å¦‚ä½•è¡¨ç¤ºï¼Ÿ</h3><ul><li><strong>NaNï¼ˆNot a Numberï¼‰</strong>ï¼š<ul><li>å¦‚ <code>0.0 / 0.0</code> æˆ– <code>Math.sqrt(-1)</code>ã€‚</li><li>ç‰¹ç‚¹ï¼š<code>NaN != NaN</code>ï¼Œè¦ç”¨ <code>Double.isNaN()</code> æ£€æµ‹ã€‚</li></ul></li><li><strong>Infinityï¼ˆæ­£&#x2F;è´Ÿæ— ç©·å¤§ï¼‰</strong>ï¼š<ul><li>å¦‚ <code>1.0 / 0.0 = Infinity</code>ï¼Œ<code>-1.0 / 0.0 = -Infinity</code>ã€‚</li><li>ç”¨ <code>Double.isInfinite()</code> æ£€æµ‹ã€‚</li></ul></li></ul><hr><h3 id="5-ä¸ºä»€ä¹ˆæµ®ç‚¹æ•°è®¡ç®—æœ‰ç²¾åº¦é—®é¢˜ï¼Ÿå¦‚ä½•é¿å…ï¼Ÿ"><a href="#5-ä¸ºä»€ä¹ˆæµ®ç‚¹æ•°è®¡ç®—æœ‰ç²¾åº¦é—®é¢˜ï¼Ÿå¦‚ä½•é¿å…ï¼Ÿ" class="headerlink" title="5. ä¸ºä»€ä¹ˆæµ®ç‚¹æ•°è®¡ç®—æœ‰ç²¾åº¦é—®é¢˜ï¼Ÿå¦‚ä½•é¿å…ï¼Ÿ"></a>5. ä¸ºä»€ä¹ˆæµ®ç‚¹æ•°è®¡ç®—æœ‰ç²¾åº¦é—®é¢˜ï¼Ÿå¦‚ä½•é¿å…ï¼Ÿ</h3><ul><li><strong>åŸå› </strong>ï¼š<ul><li>æµ®ç‚¹æ•°é‡‡ç”¨ <strong>IEEE 754 äºŒè¿›åˆ¶æµ®ç‚¹è¡¨ç¤º</strong>ï¼Œå¤§å¤šæ•°åè¿›åˆ¶å°æ•°ï¼ˆå¦‚ <code>0.1</code>ï¼‰ä¸èƒ½ç²¾ç¡®è¡¨ç¤ºï¼Œåªèƒ½å­˜å‚¨è¿‘ä¼¼å€¼ã€‚</li><li>è®¡ç®—æ—¶ä¼šç´¯ç§¯è¯¯å·®ã€‚</li></ul></li><li><strong>é¿å…æ–¹æ³•</strong>ï¼š<ul><li>ä½¿ç”¨ <code>BigDecimal</code>ï¼ˆæ¨èï¼‰ã€‚</li><li>æˆ–ä½¿ç”¨æ•´æ•°æ›¿ä»£ï¼ˆå¦‚é‡‘é¢ç”¨åˆ†è€Œä¸æ˜¯å…ƒï¼‰ã€‚</li></ul></li></ul><hr><h3 id="6-BigDecimal-ä¸ºä»€ä¹ˆèƒ½è§£å†³æµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜ï¼Ÿ"><a href="#6-BigDecimal-ä¸ºä»€ä¹ˆèƒ½è§£å†³æµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜ï¼Ÿ" class="headerlink" title="6. BigDecimal ä¸ºä»€ä¹ˆèƒ½è§£å†³æµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜ï¼Ÿ"></a>6. BigDecimal ä¸ºä»€ä¹ˆèƒ½è§£å†³æµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜ï¼Ÿ</h3><ul><li><strong>åŸç†</strong>ï¼š<ul><li>å†…éƒ¨ä½¿ç”¨ <strong>BigInteger + ç²¾åº¦æ ‡è¯† scale</strong> è¡¨ç¤ºä»»æ„ç²¾åº¦çš„åè¿›åˆ¶æ•°ã€‚</li><li>ä¸ä¾èµ–äºŒè¿›åˆ¶æµ®ç‚¹å­˜å‚¨ï¼Œè€Œæ˜¯åŸºäºå­—ç¬¦ä¸²æˆ–æ•´æ•°è¿›è¡Œç²¾ç¡®è®¡ç®—ã€‚</li></ul></li><li><strong>æ³¨æ„</strong>ï¼š<ul><li>ä¸èƒ½ç”¨ <code>new BigDecimal(double)</code>ï¼ˆä¼šå¸¦å…¥äºŒè¿›åˆ¶è¯¯å·®ï¼‰ã€‚</li><li>æ¨è <code>BigDecimal.valueOf(double)</code> æˆ– <code>new BigDecimal(String)</code>ã€‚</li></ul></li></ul><hr><h3 id="7-Java-ä¸­çš„å­—ç¬¦é›†é»˜è®¤æ˜¯ä»€ä¹ˆï¼Ÿåœ¨ä¸åŒå¹³å°ä¸Šä¼šä¸ä¸€æ ·å—ï¼Ÿ"><a href="#7-Java-ä¸­çš„å­—ç¬¦é›†é»˜è®¤æ˜¯ä»€ä¹ˆï¼Ÿåœ¨ä¸åŒå¹³å°ä¸Šä¼šä¸ä¸€æ ·å—ï¼Ÿ" class="headerlink" title="7. Java ä¸­çš„å­—ç¬¦é›†é»˜è®¤æ˜¯ä»€ä¹ˆï¼Ÿåœ¨ä¸åŒå¹³å°ä¸Šä¼šä¸ä¸€æ ·å—ï¼Ÿ"></a>7. Java ä¸­çš„å­—ç¬¦é›†é»˜è®¤æ˜¯ä»€ä¹ˆï¼Ÿåœ¨ä¸åŒå¹³å°ä¸Šä¼šä¸ä¸€æ ·å—ï¼Ÿ</h3><ul><li>Java å†…éƒ¨ä½¿ç”¨ <strong>UTF-16ï¼ˆUnicodeï¼‰</strong> å­˜å‚¨ <code>char</code> å’Œ <code>String</code>ã€‚</li><li>é»˜è®¤å­—ç¬¦é›†ï¼ˆ<code>Charset.defaultCharset()</code>ï¼‰ä¼šéšå¹³å°ä¸åŒè€Œä¸åŒï¼š<ul><li>Windowsï¼ˆä¸­æ–‡ç¯å¢ƒï¼‰ï¼š<code>GBK</code> æˆ– <code>GB2312</code>ã€‚</li><li>Linux &#x2F; macOSï¼šé€šå¸¸æ˜¯ <code>UTF-8</code>ã€‚<br> ğŸ‘‰ è¿™ä¼šå½±å“æ–‡ä»¶è¯»å†™ã€ç½‘ç»œä¼ è¾“ç­‰ã€‚</li></ul></li></ul><hr><h3 id="8-Stringã€StringBuilderã€StringBuffer-åŒºåˆ«ï¼Ÿçº¿ç¨‹å®‰å…¨æ€§ï¼Ÿ"><a href="#8-Stringã€StringBuilderã€StringBuffer-åŒºåˆ«ï¼Ÿçº¿ç¨‹å®‰å…¨æ€§ï¼Ÿ" class="headerlink" title="8. Stringã€StringBuilderã€StringBuffer åŒºåˆ«ï¼Ÿçº¿ç¨‹å®‰å…¨æ€§ï¼Ÿ"></a>8. Stringã€StringBuilderã€StringBuffer åŒºåˆ«ï¼Ÿçº¿ç¨‹å®‰å…¨æ€§ï¼Ÿ</h3><ul><li><strong>String</strong><ul><li>ä¸å¯å˜ç±»ï¼ˆåº•å±‚ <code>final char[]</code>ï¼‰ï¼Œæ¯æ¬¡æ‹¼æ¥éƒ½ä¼šç”Ÿæˆæ–°å¯¹è±¡ã€‚</li></ul></li><li><strong>StringBuilder</strong><ul><li>å¯å˜å­—ç¬¦åºåˆ—ï¼ˆåº•å±‚ <code>char[]</code>ï¼‰ï¼Œé«˜æ•ˆï¼Œ<strong>éçº¿ç¨‹å®‰å…¨</strong>ã€‚</li></ul></li><li><strong>StringBuffer</strong><ul><li>å¯å˜å­—ç¬¦åºåˆ—ï¼Œæ–¹æ³•åŠ äº† <code>synchronized</code>ï¼Œ<strong>çº¿ç¨‹å®‰å…¨</strong>ï¼Œæ•ˆç‡æ¯” <code>StringBuilder</code> ä½ã€‚</li></ul></li></ul><p>ğŸ‘‰ å•çº¿ç¨‹æ¨è <code>StringBuilder</code>ï¼Œå¤šçº¿ç¨‹æ¨è <code>StringBuffer</code>ã€‚</p><hr><h3 id="9-ä¸ºä»€ä¹ˆ-String-æ˜¯ä¸å¯å˜çš„ï¼ŸèƒŒåå®ç°ç»†èŠ‚ï¼Ÿ"><a href="#9-ä¸ºä»€ä¹ˆ-String-æ˜¯ä¸å¯å˜çš„ï¼ŸèƒŒåå®ç°ç»†èŠ‚ï¼Ÿ" class="headerlink" title="9. ä¸ºä»€ä¹ˆ String æ˜¯ä¸å¯å˜çš„ï¼ŸèƒŒåå®ç°ç»†èŠ‚ï¼Ÿ"></a>9. ä¸ºä»€ä¹ˆ String æ˜¯ä¸å¯å˜çš„ï¼ŸèƒŒåå®ç°ç»†èŠ‚ï¼Ÿ</h3><ul><li><strong>åŸå› </strong>ï¼š<ol><li><strong>å®‰å…¨æ€§</strong>ï¼šå¦‚ç½‘ç»œè¯·æ±‚ URLã€æ–‡ä»¶è·¯å¾„ã€ClassLoader åç§°ç­‰ï¼Œä¸€æ—¦åˆ›å»ºä¸å¯ä¿®æ”¹ï¼Œé¿å…è¢«ç¯¡æ”¹ã€‚</li><li><strong>çº¿ç¨‹å®‰å…¨</strong>ï¼šä¸å¯å˜å¯¹è±¡å¤©ç„¶çº¿ç¨‹å®‰å…¨ã€‚</li><li><strong>å“ˆå¸Œå€¼ç¼“å­˜</strong>ï¼š<code>String</code> ç¼“å­˜äº† <code>hashCode</code>ï¼Œä¸å¯å˜ä¿è¯å“ˆå¸Œå€¼ä¸ä¼šå˜åŒ–ã€‚</li><li><strong>å­—ç¬¦ä¸²å¸¸é‡æ± ä¼˜åŒ–</strong>ï¼šä¸å¯å˜å¯¹è±¡å¯è¢«å¤ç”¨ã€‚</li></ol></li><li><strong>å®ç°</strong>ï¼š<ul><li><code>private final char[] value</code>ï¼ˆJDK 9 ä»¥åæ”¹æˆ <code>byte[]</code> + <code>coder</code>ï¼ŒèŠ‚çœå†…å­˜ï¼‰ã€‚</li></ul></li></ul><hr><h3 id="10-intern-æ–¹æ³•çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#10-intern-æ–¹æ³•çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="10. intern() æ–¹æ³•çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ"></a>10. intern() æ–¹æ³•çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</h3><ul><li><p><strong>ä½œç”¨</strong>ï¼š</p><ul><li>å°†å­—ç¬¦ä¸²æ”¾å…¥ <strong>å­—ç¬¦ä¸²å¸¸é‡æ± </strong>ï¼Œè¿”å›æ± ä¸­çš„å¼•ç”¨ã€‚</li><li>è‹¥æ± ä¸­å·²æœ‰ç­‰å€¼å­—ç¬¦ä¸²ï¼Œåˆ™è¿”å›å·²æœ‰å¯¹è±¡å¼•ç”¨ã€‚</li></ul></li><li><p><strong>æ„ä¹‰</strong>ï¼š</p><ul><li>å‡å°‘å†…å­˜å ç”¨ï¼Œæé«˜æ¯”è¾ƒæ•ˆç‡ï¼ˆå¸¸é‡æ± ä¸­çš„ <code>String</code> å¯ä»¥ç›´æ¥ç”¨ <code>==</code> æ¯”è¾ƒï¼‰ã€‚</li></ul></li><li><p><strong>ä¾‹å­</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> s1.intern();</span><br><span class="line"><span class="type">String</span> <span class="variable">s3</span> <span class="operator">=</span> <span class="string">&quot;abc&quot;</span>;</span><br><span class="line">System.out.println(s2 == s3); <span class="comment">// true</span></span><br></pre></td></tr></table></figure></li></ul><hr><h3 id="ä¸‰ã€é›†åˆæ¡†æ¶"><a href="#ä¸‰ã€é›†åˆæ¡†æ¶" class="headerlink" title="ä¸‰ã€é›†åˆæ¡†æ¶"></a>ä¸‰ã€é›†åˆæ¡†æ¶</h3><hr><h2 id="1-ArrayList-å’Œ-Vector-çš„åŒºåˆ«"><a href="#1-ArrayList-å’Œ-Vector-çš„åŒºåˆ«" class="headerlink" title="1. ArrayList å’Œ Vector çš„åŒºåˆ«"></a><strong>1. ArrayList å’Œ Vector çš„åŒºåˆ«</strong></h2><table><thead><tr><th>ç‰¹æ€§</th><th>ArrayList</th><th>Vector</th></tr></thead><tbody><tr><td>çº¿ç¨‹å®‰å…¨</td><td>éçº¿ç¨‹å®‰å…¨</td><td>çº¿ç¨‹å®‰å…¨ï¼ˆæ–¹æ³•åŠ  synchronizedï¼‰</td></tr><tr><td>æ‰©å®¹æœºåˆ¶</td><td>é»˜è®¤ 1.5 å€</td><td>é»˜è®¤ 2 å€</td></tr><tr><td>æ€§èƒ½</td><td>é«˜ï¼ˆæ— é”ï¼‰</td><td>ä½ï¼ˆåŒæ­¥å¼€é”€ï¼‰</td></tr><tr><td>ç”¨é€”</td><td>å¤šçº¿ç¨‹å¤–éƒ¨ä¸å®‰å…¨</td><td>é€‚åˆå¤šçº¿ç¨‹å…±äº«åœºæ™¯ï¼Œä½†ç°åœ¨è¾ƒå°‘ä½¿ç”¨</td></tr><tr><td>é¢è¯•æ‹“å±•</td><td>å¦‚ä½•åœ¨å¤šçº¿ç¨‹ä¸‹å®‰å…¨ä½¿ç”¨ ArrayListï¼Ÿå¯ç”¨ <code>Collections.synchronizedList()</code> æˆ– <code>CopyOnWriteArrayList</code></td><td></td></tr></tbody></table><p><strong>åŸç†</strong>ï¼š</p><ul><li>éƒ½åŸºäºåŠ¨æ€æ•°ç»„å®ç°</li><li>æ·»åŠ å…ƒç´ æ—¶å¦‚æœå®¹é‡ä¸å¤Ÿï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„å¹¶å¤åˆ¶åŸæ•°ç»„å†…å®¹</li></ul><hr><h2 id="2-ä¸ºä»€ä¹ˆ-ArrayList-çš„æ‰©å®¹æ˜¯-1-5-å€ï¼Ÿ"><a href="#2-ä¸ºä»€ä¹ˆ-ArrayList-çš„æ‰©å®¹æ˜¯-1-5-å€ï¼Ÿ" class="headerlink" title="2. ä¸ºä»€ä¹ˆ ArrayList çš„æ‰©å®¹æ˜¯ 1.5 å€ï¼Ÿ"></a><strong>2. ä¸ºä»€ä¹ˆ ArrayList çš„æ‰©å®¹æ˜¯ 1.5 å€ï¼Ÿ</strong></h2><ul><li><p><strong>ç›®çš„</strong>ï¼šå¹³è¡¡ <strong>å†…å­˜æ¶ˆè€—</strong> å’Œ <strong>æ‰©å®¹é¢‘ç‡</strong></p></li><li><p><strong>åŸç†</strong>ï¼š</p><ul><li>è¿‡å°æ‰©å®¹ï¼šé¢‘ç¹åˆ›å»ºæ–°æ•°ç»„ï¼Œå¤åˆ¶å¼€é”€å¤§</li><li>è¿‡å¤§æ‰©å®¹ï¼šæµªè´¹å†…å­˜</li></ul></li><li><p>JDK 1.8 çš„æ‰©å®¹å…¬å¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">newCapacity = oldCapacity + (oldCapacity &gt;&gt; <span class="number">1</span>); <span class="comment">// ç›¸å½“äº 1.5 å€</span></span><br></pre></td></tr></table></figure></li><li><p>é¢è¯•ç‚¹ï¼š</p><ul><li>LinkedList ä¸éœ€è¦æ‰©å®¹ï¼Œå› ä¸ºé“¾è¡¨åŠ¨æ€å¢é•¿</li><li>å¦‚ä½•è‡ªå®šä¹‰æ‰©å®¹ç­–ç•¥ï¼Ÿ</li></ul></li></ul><hr><h2 id="3-LinkedList-æ˜¯åŒå‘é“¾è¡¨è¿˜æ˜¯å•å‘é“¾è¡¨ï¼Ÿ"><a href="#3-LinkedList-æ˜¯åŒå‘é“¾è¡¨è¿˜æ˜¯å•å‘é“¾è¡¨ï¼Ÿ" class="headerlink" title="3. LinkedList æ˜¯åŒå‘é“¾è¡¨è¿˜æ˜¯å•å‘é“¾è¡¨ï¼Ÿ"></a><strong>3. LinkedList æ˜¯åŒå‘é“¾è¡¨è¿˜æ˜¯å•å‘é“¾è¡¨ï¼Ÿ</strong></h2><ul><li><p><strong>Java ä¸­ LinkedList æ˜¯åŒå‘é“¾è¡¨</strong></p></li><li><p><strong>ç»“æ„</strong>ï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Node&lt;E&gt; &#123;</span><br><span class="line">    E item;</span><br><span class="line">    Node&lt;E&gt; next;</span><br><span class="line">    Node&lt;E&gt; prev;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>ä¼˜ç‚¹</strong>ï¼š</p><ul><li>æ”¯æŒå¿«é€Ÿæ’å…¥&#x2F;åˆ é™¤ï¼ˆO(1)ï¼‰</li><li>æ”¯æŒä»å¤´å°¾éå†</li></ul></li><li><p><strong>ç¼ºç‚¹</strong>ï¼š</p><ul><li>éšæœºè®¿é—®æ…¢ï¼ˆO(n)ï¼‰</li><li>å†…å­˜å ç”¨å¤§ï¼ˆéœ€è¦ prev æŒ‡é’ˆï¼‰</li></ul></li></ul><hr><h2 id="4-HashSet-åº•å±‚å®ç°"><a href="#4-HashSet-åº•å±‚å®ç°" class="headerlink" title="4. HashSet åº•å±‚å®ç°"></a><strong>4. HashSet åº•å±‚å®ç°</strong></h2><ul><li><strong>åº•å±‚ä½¿ç”¨ HashMap å®ç°</strong></li><li><strong>åŸç†</strong>ï¼š<ul><li>æ¯ä¸ªå…ƒç´ ä½œä¸º <code>HashMap</code> çš„ key</li><li>value ä½¿ç”¨ä¸€ä¸ªå›ºå®šçš„ Object å¯¹è±¡ <code>PRESENT</code></li></ul></li><li><strong>ç‰¹ç‚¹</strong>ï¼š<ul><li>ä¸å…è®¸é‡å¤</li><li>æ— åºå­˜å‚¨</li></ul></li><li><strong>æ€§èƒ½</strong>ï¼š<ul><li>æ’å…¥ã€åˆ é™¤ã€æŸ¥æ‰¾å‡ O(1) å¹³å‡</li></ul></li><li>é¢è¯•æ‹“å±•ï¼šHashSet å’Œ LinkedHashSet çš„åŒºåˆ«ï¼Ÿ<ul><li>LinkedHashSet ç»´æŠ¤äº†æ’å…¥é¡ºåº</li></ul></li></ul><hr><h2 id="5-TreeSet-å’Œ-TreeMap-çš„åº•å±‚å®ç°"><a href="#5-TreeSet-å’Œ-TreeMap-çš„åº•å±‚å®ç°" class="headerlink" title="5. TreeSet å’Œ TreeMap çš„åº•å±‚å®ç°"></a><strong>5. TreeSet å’Œ TreeMap çš„åº•å±‚å®ç°</strong></h2><ul><li><strong>TreeMap</strong>ï¼šåŸºäº <strong>çº¢é»‘æ ‘</strong> å®ç°</li><li><strong>TreeSet</strong>ï¼šå†…éƒ¨ä½¿ç”¨ TreeMap å­˜å‚¨å…ƒç´ </li><li><strong>ç‰¹ç‚¹</strong>ï¼š<ul><li>è‡ªåŠ¨æ’åºï¼ˆè‡ªç„¶æ’åºæˆ– Comparatorï¼‰</li><li>æŸ¥æ‰¾ã€æ’å…¥ã€åˆ é™¤ O(log n)</li></ul></li><li><strong>çº¢é»‘æ ‘ç‰¹æ€§</strong>ï¼š<ul><li>è‡ªå¹³è¡¡äºŒå‰æœç´¢æ ‘</li><li>æ’å…¥&#x2F;åˆ é™¤ä¿æŒå¹³è¡¡ï¼Œé€šè¿‡æ—‹è½¬å’ŒæŸ“è‰²æ“ä½œ</li></ul></li></ul><hr><h2 id="6-PriorityQueue-çš„åº•å±‚æ•°æ®ç»“æ„"><a href="#6-PriorityQueue-çš„åº•å±‚æ•°æ®ç»“æ„" class="headerlink" title="6. PriorityQueue çš„åº•å±‚æ•°æ®ç»“æ„"></a><strong>6. PriorityQueue çš„åº•å±‚æ•°æ®ç»“æ„</strong></h2><ul><li><p><strong>åŸºäºå †å®ç°</strong>ï¼ˆé»˜è®¤æœ€å°å †ï¼‰</p></li><li><p><strong>ç‰¹æ€§</strong>ï¼š</p><ul><li>æ’å…¥ O(log n)</li><li>å–å‡ºæœ€å°å€¼ O(log n)</li></ul></li><li><p><strong>å†…éƒ¨å®ç°</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Object[] queue; <span class="comment">// åŠ¨æ€æ•°ç»„å­˜å‚¨å †</span></span><br></pre></td></tr></table></figure></li><li><p><strong>åº”ç”¨</strong>ï¼š</p><ul><li>å®šæ—¶ä»»åŠ¡è°ƒåº¦</li><li>Dijkstra ç®—æ³•</li></ul></li><li><p>é¢è¯•æ‹“å±•ï¼šå¦‚ä½•å®ç°æœ€å¤§å †ï¼Ÿ</p><ul><li>ä½¿ç”¨ Comparator æˆ–è¦†å†™ compare æ–¹æ³•</li></ul></li></ul><hr><h2 id="7-ConcurrentSkipListMap-çš„åº•å±‚åŸç†"><a href="#7-ConcurrentSkipListMap-çš„åº•å±‚åŸç†" class="headerlink" title="7. ConcurrentSkipListMap çš„åº•å±‚åŸç†"></a><strong>7. ConcurrentSkipListMap çš„åº•å±‚åŸç†</strong></h2><ul><li><strong>åŸºäºè·³è¡¨å®ç°</strong></li><li><strong>ç‰¹ç‚¹</strong>ï¼š<ul><li>æœ‰åº Mapï¼Œæ”¯æŒå¹¶å‘æ“ä½œ</li><li>è¯»æ“ä½œæ— é”ï¼ˆlock-freeï¼‰ï¼Œå†™æ“ä½œä½¿ç”¨ CAS&#x2F;é”ç²’åº¦è¾ƒå°</li></ul></li><li><strong>è·³è¡¨åŸç†</strong>ï¼š<ul><li>å¤šå±‚é“¾è¡¨</li><li>é¡¶å±‚é“¾è¡¨é—´éš”å¤§</li><li>æŸ¥æ‰¾ã€æ’å…¥ã€åˆ é™¤ O(log n) å¹³å‡</li></ul></li></ul><hr><h2 id="8-CopyOnWriteArrayList-çš„å†™æ—¶å¤åˆ¶"><a href="#8-CopyOnWriteArrayList-çš„å†™æ—¶å¤åˆ¶" class="headerlink" title="8. CopyOnWriteArrayList çš„å†™æ—¶å¤åˆ¶"></a><strong>8. CopyOnWriteArrayList çš„å†™æ—¶å¤åˆ¶</strong></h2><ul><li><strong>åŸç†</strong>ï¼š<ul><li>æ¯æ¬¡å†™æ“ä½œï¼ˆaddã€removeï¼‰éƒ½ä¼šå¤åˆ¶ä¸€ä»½åº•å±‚æ•°ç»„</li><li>è¯»æ“ä½œä¸åŠ é”ï¼Œç›´æ¥è¯»å–æ—§æ•°ç»„</li></ul></li><li><strong>ä¼˜ç‚¹</strong>ï¼š<ul><li>é«˜åº¦å¹¶å‘è¯»æ€§èƒ½</li><li>é¿å… ConcurrentModificationException</li></ul></li><li><strong>ç¼ºç‚¹</strong>ï¼š<ul><li>å†™æ“ä½œæˆæœ¬é«˜ï¼ˆæ•°ç»„å¤åˆ¶ï¼‰</li><li>å†…å­˜å¼€é”€å¤§</li></ul></li><li><strong>åº”ç”¨åœºæ™¯</strong>ï¼š<ul><li>è¯»å¤šå†™å°‘ï¼ˆå¦‚ç›‘å¬å™¨åˆ—è¡¨ã€é…ç½®ç¼“å­˜ï¼‰</li></ul></li></ul><hr><h2 id="9-EnumMap-å’Œ-EnumSet"><a href="#9-EnumMap-å’Œ-EnumSet" class="headerlink" title="9. EnumMap å’Œ EnumSet"></a><strong>9. EnumMap å’Œ EnumSet</strong></h2><ul><li><strong>EnumMap</strong>ï¼š<ul><li>Key æ˜¯æšä¸¾ç±»å‹</li><li>åº•å±‚ä½¿ç”¨æ•°ç»„å­˜å‚¨ï¼Œæ•ˆç‡é«˜</li></ul></li><li><strong>EnumSet</strong>ï¼š<ul><li>å…ƒç´ ä¸ºæšä¸¾</li><li>åº•å±‚ä½¿ç”¨ <strong>ä½å‘é‡(bit vector)</strong> å­˜å‚¨</li></ul></li><li><strong>ç‰¹ç‚¹</strong>ï¼š<ul><li>é«˜æ•ˆï¼Œå ç”¨å†…å­˜å°</li><li>éå†é€Ÿåº¦å¿«</li></ul></li><li><strong>åº”ç”¨</strong>ï¼š<ul><li>çŠ¶æ€æœºã€æ ‡å¿—ä½é›†åˆ</li></ul></li></ul><hr><h2 id="10-WeakHashMap-å’Œ-HashMap-çš„åŒºåˆ«"><a href="#10-WeakHashMap-å’Œ-HashMap-çš„åŒºåˆ«" class="headerlink" title="10. WeakHashMap å’Œ HashMap çš„åŒºåˆ«"></a><strong>10. WeakHashMap å’Œ HashMap çš„åŒºåˆ«</strong></h2><table><thead><tr><th>ç‰¹æ€§</th><th>HashMap</th><th>WeakHashMap</th></tr></thead><tbody><tr><td>Key å¼•ç”¨ç±»å‹</td><td>å¼ºå¼•ç”¨</td><td>å¼±å¼•ç”¨</td></tr><tr><td>GC è¡Œä¸º</td><td>ä¸å—åƒåœ¾å›æ”¶å½±å“</td><td>Key è¢«å›æ”¶æ—¶è‡ªåŠ¨åˆ é™¤ Entry</td></tr><tr><td>ç”¨é€”</td><td>æ™®é€š Map</td><td>ç¼“å­˜ã€å†…å­˜æ•æ„Ÿå¯¹è±¡çš„æ˜ å°„</td></tr><tr><td>é¢è¯•ç‚¹</td><td>WeakHashMap å¦‚ä½•é˜²æ­¢å†…å­˜æ³„æ¼ï¼Ÿ</td><td></td></tr></tbody></table><p><strong>åŸç†</strong>ï¼š</p><ul><li>WeakHashMap çš„ key æ˜¯ <code>WeakReference</code></li><li>å½“ key ä¸å†è¢«å¤–éƒ¨å¼ºå¼•ç”¨æ—¶ï¼Œåƒåœ¾å›æ”¶å™¨å›æ”¶ï¼Œå¹¶é€šè¿‡ ReferenceQueue æ¸…ç† Entry</li></ul><hr><h3 id="å››ã€å¼‚å¸¸-é”™è¯¯å¤„ç†"><a href="#å››ã€å¼‚å¸¸-é”™è¯¯å¤„ç†" class="headerlink" title="å››ã€å¼‚å¸¸ &amp; é”™è¯¯å¤„ç†"></a>å››ã€å¼‚å¸¸ &amp; é”™è¯¯å¤„ç†</h3><hr><h2 id="1-Java-ä¸­çš„å¼‚å¸¸åˆ†ä¸ºå“ªä¸¤å¤§ç±»ï¼Ÿ"><a href="#1-Java-ä¸­çš„å¼‚å¸¸åˆ†ä¸ºå“ªä¸¤å¤§ç±»ï¼Ÿ" class="headerlink" title="1. Java ä¸­çš„å¼‚å¸¸åˆ†ä¸ºå“ªä¸¤å¤§ç±»ï¼Ÿ"></a><strong>1. Java ä¸­çš„å¼‚å¸¸åˆ†ä¸ºå“ªä¸¤å¤§ç±»ï¼Ÿ</strong></h2><ul><li><strong>Errorï¼ˆé”™è¯¯ï¼‰</strong>ï¼š<ul><li>ç³»ç»Ÿçº§é”™è¯¯ï¼Œé€šå¸¸æ— æ³•æ¢å¤</li><li>ä¾‹å­ï¼š<code>OutOfMemoryError</code>ã€<code>StackOverflowError</code></li><li>ä¸å»ºè®®æ•è·</li></ul></li><li><strong>Exceptionï¼ˆå¼‚å¸¸ï¼‰</strong>ï¼š<ul><li>ç¨‹åºå¯ä»¥æ•è·ã€å¤„ç†</li><li>å­ç±»ï¼š<ol><li><strong>å—æ£€å¼‚å¸¸ï¼ˆCheckedExceptionï¼‰</strong>ï¼šå¿…é¡» try&#x2F;catch æˆ– throws æŠ›å‡º<ul><li>ä¾‹å­ï¼š<code>IOException</code>ã€<code>SQLException</code></li></ul></li><li><strong>éå—æ£€å¼‚å¸¸ï¼ˆUncheckedException &#x2F; RuntimeExceptionï¼‰</strong>ï¼šå¯é€‰æ‹©æ•è·<ul><li>ä¾‹å­ï¼š<code>NullPointerException</code>ã€<code>IllegalArgumentException</code></li></ul></li></ol></li></ul></li></ul><p><strong>é¢è¯•ç‚¹</strong>ï¼š</p><ul><li>Checked vs Unchecked å¼‚å¸¸çš„è®¾è®¡åˆè¡·ï¼š<ul><li>Checked å¼‚å¸¸å¼ºåˆ¶å¤„ç†ï¼Œæé«˜ç¨‹åºå¥å£®æ€§</li><li>RuntimeException ç”¨äºç¼–ç¨‹é”™è¯¯ï¼Œä¸å¿…å¼ºåˆ¶æ•è·</li></ul></li></ul><hr><h2 id="2-Error-å’Œ-Exception-çš„åŒºåˆ«"><a href="#2-Error-å’Œ-Exception-çš„åŒºåˆ«" class="headerlink" title="2. Error å’Œ Exception çš„åŒºåˆ«"></a><strong>2. Error å’Œ Exception çš„åŒºåˆ«</strong></h2><table><thead><tr><th>ç‰¹æ€§</th><th>Error</th><th>Exception</th></tr></thead><tbody><tr><td>æ˜¯å¦å¯æ¢å¤</td><td>ä¸å¯æ¢å¤</td><td>å¯æ¢å¤ï¼ˆç¨‹åºå¯å¤„ç†ï¼‰</td></tr><tr><td>æ•è·å»ºè®®</td><td>ä¸å»ºè®®æ•è·</td><td>å»ºè®®æ•è·å’Œå¤„ç†</td></tr><tr><td>å­ç±»ç¤ºä¾‹</td><td>OutOfMemoryError</td><td>IOException, SQLException</td></tr><tr><td>ä½¿ç”¨åœºæ™¯</td><td>JVM å†…éƒ¨é”™è¯¯</td><td>åº”ç”¨ç¨‹åºå¼‚å¸¸å¤„ç†</td></tr></tbody></table><hr><h2 id="3-å—æ£€å¼‚å¸¸å’Œéå—æ£€å¼‚å¸¸åŒºåˆ«"><a href="#3-å—æ£€å¼‚å¸¸å’Œéå—æ£€å¼‚å¸¸åŒºåˆ«" class="headerlink" title="3. å—æ£€å¼‚å¸¸å’Œéå—æ£€å¼‚å¸¸åŒºåˆ«"></a><strong>3. å—æ£€å¼‚å¸¸å’Œéå—æ£€å¼‚å¸¸åŒºåˆ«</strong></h2><table><thead><tr><th>ç‰¹æ€§</th><th>CheckedException</th><th>UncheckedException</th></tr></thead><tbody><tr><td>ç¼–è¯‘å™¨æ£€æŸ¥</td><td>ç¼–è¯‘å™¨å¼ºåˆ¶è¦æ±‚å¤„ç†</td><td>ç¼–è¯‘å™¨ä¸è¦æ±‚</td></tr><tr><td>ç»§æ‰¿å…³ç³»</td><td>Exception é™¤ RuntimeException</td><td>RuntimeException å­ç±»</td></tr><tr><td>ä½¿ç”¨åœºæ™¯</td><td>å¯æ¢å¤å¼‚å¸¸ï¼Œå¦‚æ–‡ä»¶ä¸å­˜åœ¨</td><td>ç¼–ç¨‹é”™è¯¯ï¼Œå¦‚ç©ºæŒ‡é’ˆ</td></tr></tbody></table><p><strong>é¢è¯•ç‚¹</strong>ï¼š</p><ul><li>Checked å¼‚å¸¸åœ¨ API è®¾è®¡ä¸­å¯æç¤ºè°ƒç”¨è€…</li><li>RuntimeException å¤šç”¨äºç¨‹åºé€»è¾‘é”™è¯¯ï¼Œé˜²æ­¢è¿‡å¤š try&#x2F;catch</li></ul><hr><h2 id="4-throw-å’Œ-throws-çš„åŒºåˆ«"><a href="#4-throw-å’Œ-throws-çš„åŒºåˆ«" class="headerlink" title="4. throw å’Œ throws çš„åŒºåˆ«"></a><strong>4. throw å’Œ throws çš„åŒºåˆ«</strong></h2><table><thead><tr><th>ç‰¹æ€§</th><th>throw</th><th>throws</th></tr></thead><tbody><tr><td>ä½ç½®</td><td>æ–¹æ³•ä½“å†…</td><td>æ–¹æ³•å£°æ˜ä¸Š</td></tr><tr><td>ç”¨é€”</td><td>æŠ›å‡ºå…·ä½“å¼‚å¸¸å®ä¾‹</td><td>å£°æ˜æ–¹æ³•å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸ç±»å‹</td></tr><tr><td>ä¸ªæ•°é™åˆ¶</td><td>ä¸€æ¬¡æŠ›å‡ºä¸€ä¸ª</td><td>å¯å£°æ˜å¤šä¸ªå¼‚å¸¸</td></tr><tr><td>é¢è¯•ç¤ºä¾‹</td><td><code>throw new IOException()</code></td><td><code>void read() throws IOException</code></td></tr></tbody></table><hr><h2 id="5-try-with-resources-çš„åº•å±‚åŸç†"><a href="#5-try-with-resources-çš„åº•å±‚åŸç†" class="headerlink" title="5. try-with-resources çš„åº•å±‚åŸç†"></a><strong>5. try-with-resources çš„åº•å±‚åŸç†</strong></h2><ul><li><p><strong>è¯­æ³•</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (<span class="type">BufferedReader</span> <span class="variable">br</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">FileReader</span>(<span class="string">&quot;file.txt&quot;</span>))) &#123;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨èµ„æº</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>åº•å±‚å®ç°</strong>ï¼š</p><ul><li><p>è‡ªåŠ¨è°ƒç”¨èµ„æºçš„ <code>close()</code> æ–¹æ³•</p></li><li><p>èµ„æºå¿…é¡»å®ç° <strong>AutoCloseable</strong> æ¥å£</p></li><li><p>ç¼–è¯‘å™¨å°†å…¶è½¬æ¢ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">BufferedReader</span> <span class="variable">br</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">FileReader</span>(<span class="string">&quot;file.txt&quot;</span>));</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨èµ„æº</span></span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (br != <span class="literal">null</span>) br.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>ä¼˜åŠ¿</strong>ï¼š</p><ul><li>è‡ªåŠ¨å…³é—­èµ„æºï¼Œé¿å…èµ„æºæ³„æ¼</li><li>æ”¯æŒå¤šä¸ªèµ„æºå£°æ˜</li></ul></li><li><p><strong>é¢è¯•æ‹“å±•</strong>ï¼šå¤šèµ„æºå…³é—­çš„å¼‚å¸¸æŠ‘åˆ¶æœºåˆ¶ (<code>addSuppressed</code>)</p></li></ul><hr><h2 id="6-è‡ªå®šä¹‰å¼‚å¸¸å¦‚ä½•è®¾è®¡ï¼Ÿç»§æ‰¿å“ªä¸ªç±»"><a href="#6-è‡ªå®šä¹‰å¼‚å¸¸å¦‚ä½•è®¾è®¡ï¼Ÿç»§æ‰¿å“ªä¸ªç±»" class="headerlink" title="6. è‡ªå®šä¹‰å¼‚å¸¸å¦‚ä½•è®¾è®¡ï¼Ÿç»§æ‰¿å“ªä¸ªç±»"></a><strong>6. è‡ªå®šä¹‰å¼‚å¸¸å¦‚ä½•è®¾è®¡ï¼Ÿç»§æ‰¿å“ªä¸ªç±»</strong></h2><ul><li><p><strong>ç»§æ‰¿ RuntimeException</strong>ï¼š</p><ul><li>ç”¨äºéå—æ£€å¼‚å¸¸ï¼ˆç¼–ç¨‹é”™è¯¯ã€ä¸šåŠ¡é€»è¾‘å¼‚å¸¸ï¼‰</li></ul></li><li><p><strong>ç»§æ‰¿ Exception</strong>ï¼š</p><ul><li>ç”¨äºå—æ£€å¼‚å¸¸ï¼ˆéœ€è¦è°ƒç”¨è€…å¤„ç†ï¼‰</li></ul></li><li><p><strong>å®ç°å»ºè®®</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBusinessException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyBusinessException</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(message);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyBusinessException</span><span class="params">(String message, Throwable cause)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(message, cause);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>é¢è¯•ç‚¹</strong>ï¼š</p><ul><li>è‡ªå®šä¹‰å¼‚å¸¸åŠ ä¸Šå¼‚å¸¸é“¾ï¼ˆcauseï¼‰</li><li>è§„èŒƒå¼‚å¸¸ä¿¡æ¯ï¼Œä¾¿äºæ—¥å¿—è¿½è¸ª</li></ul></li></ul><hr><h2 id="7-ä¸ºä»€ä¹ˆä¸å»ºè®®æ•è·-Throwableï¼Ÿ"><a href="#7-ä¸ºä»€ä¹ˆä¸å»ºè®®æ•è·-Throwableï¼Ÿ" class="headerlink" title="7. ä¸ºä»€ä¹ˆä¸å»ºè®®æ•è· Throwableï¼Ÿ"></a><strong>7. ä¸ºä»€ä¹ˆä¸å»ºè®®æ•è· Throwableï¼Ÿ</strong></h2><ul><li>Throwable åŒ…å« Error å’Œ Exception</li><li>æ•è· Throwable ä¼šï¼š<ul><li>æ•è·ç³»ç»Ÿçº§é”™è¯¯ï¼ˆOutOfMemoryErrorï¼‰</li><li>ç ´å JVM æ­£å¸¸å·¥ä½œ</li></ul></li><li><strong>æœ€ä½³å®è·µ</strong>ï¼š<ul><li>åªæ•è·å¯æ¢å¤çš„ Exception æˆ– RuntimeException</li><li>æ•è· Throwable ä»…ç”¨äºæ—¥å¿—æ”¶é›†æˆ–ç›‘æ§</li></ul></li></ul><hr><h2 id="8-å¼‚å¸¸é“¾ï¼ˆException-Chainingï¼‰æ˜¯ä»€ä¹ˆ"><a href="#8-å¼‚å¸¸é“¾ï¼ˆException-Chainingï¼‰æ˜¯ä»€ä¹ˆ" class="headerlink" title="8. å¼‚å¸¸é“¾ï¼ˆException Chainingï¼‰æ˜¯ä»€ä¹ˆ"></a><strong>8. å¼‚å¸¸é“¾ï¼ˆException Chainingï¼‰æ˜¯ä»€ä¹ˆ</strong></h2><ul><li><p><strong>æ¦‚å¿µ</strong>ï¼š</p><ul><li>åœ¨æ•è·ä¸€ä¸ªå¼‚å¸¸æ—¶ï¼Œå°†åŸå¼‚å¸¸å°è£…åœ¨æ–°å¼‚å¸¸ä¸­æŠ›å‡º</li></ul></li><li><p><strong>å®ç°</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    method();</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">MyBusinessException</span>(<span class="string">&quot;è¯»å–æ–‡ä»¶å¤±è´¥&quot;</span>, e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>ä¼˜åŠ¿</strong>ï¼š</p><ul><li>ä¿ç•™åŸå§‹å¼‚å¸¸ä¿¡æ¯</li><li>ä¾¿äºè°ƒè¯•å’Œæ—¥å¿—è¿½è¸ª</li></ul></li></ul><hr><h2 id="9-Java-8-ä¹‹åå¯¹å¼‚å¸¸å¤„ç†çš„æ”¹è¿›"><a href="#9-Java-8-ä¹‹åå¯¹å¼‚å¸¸å¤„ç†çš„æ”¹è¿›" class="headerlink" title="9. Java 8 ä¹‹åå¯¹å¼‚å¸¸å¤„ç†çš„æ”¹è¿›"></a><strong>9. Java 8 ä¹‹åå¯¹å¼‚å¸¸å¤„ç†çš„æ”¹è¿›</strong></h2><ul><li><p><strong>Lambda è¡¨è¾¾å¼</strong>ï¼š</p><ul><li>å¯¹å—æ£€å¼‚å¸¸çš„å¤„ç†æ›´åŠ ç®€æ´ï¼Œä½†éœ€è¦ç‰¹æ®Šå¤„ç†</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">list.forEach(item -&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123; process(item); &#125;</span><br><span class="line">    <span class="keyword">catch</span>(IOException e) &#123; e.printStackTrace(); &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li><li><p><strong>Optional &amp; Streams</strong>ï¼š</p><ul><li>é¿å…ç©ºæŒ‡é’ˆå¼‚å¸¸</li><li>å¯ä»¥åœ¨ <code>map</code>&#x2F;<code>filter</code> ä¸­å¤„ç†å¼‚å¸¸</li></ul></li><li><p><strong>é¢è¯•æ‹“å±•</strong>ï¼š</p><ul><li>å¼‚å¸¸åœ¨å¹¶è¡Œ Stream ä¸­å¦‚ä½•ä¼ é€’</li><li><code>CompletableFuture</code> å¼‚å¸¸å¤„ç†</li></ul></li></ul><hr><h2 id="10-å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¦‚ä½•æ­£ç¡®ä¼ é€’å¼‚å¸¸"><a href="#10-å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¦‚ä½•æ­£ç¡®ä¼ é€’å¼‚å¸¸" class="headerlink" title="10. å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¦‚ä½•æ­£ç¡®ä¼ é€’å¼‚å¸¸"></a><strong>10. å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¦‚ä½•æ­£ç¡®ä¼ é€’å¼‚å¸¸</strong></h2><ul><li><p><strong>é—®é¢˜</strong>ï¼š</p><ul><li>å­çº¿ç¨‹å¼‚å¸¸ä¸ä¼šç›´æ¥æŠ›ç»™ä¸»çº¿ç¨‹</li></ul></li><li><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><ol><li><p><strong>Future &#x2F; Callable</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Future&lt;?&gt; future = executor.submit(() -&gt; &#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;error&quot;</span>); &#125;);</span><br><span class="line">future.get(); <span class="comment">// ä¼šæŠ› ExecutionException</span></span><br></pre></td></tr></table></figure></li><li><p><strong>Thread.UncaughtExceptionHandler</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">thread.setUncaughtExceptionHandler((t, e) -&gt; log.error(<span class="string">&quot;çº¿ç¨‹å¼‚å¸¸&quot;</span>, e));</span><br></pre></td></tr></table></figure></li><li><p><strong>CompletableFuture.exceptionally</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CompletableFuture.runAsync(() -&gt; &#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(); &#125;)</span><br><span class="line">                 .exceptionally(ex -&gt; &#123; log.error(ex); <span class="keyword">return</span> <span class="literal">null</span>; &#125;);</span><br></pre></td></tr></table></figure></li></ol></li><li><p><strong>é¢è¯•æ‹“å±•</strong>ï¼š</p><ul><li>å¦‚ä½•å¤„ç†çº¿ç¨‹æ± ä¸­æœªæ•è·å¼‚å¸¸</li><li>å¼‚æ­¥ä»»åŠ¡å¼‚å¸¸é“¾è¿½è¸ª</li></ul></li></ul><hr><h3 id="äº”ã€JVM-å†…å­˜ç®¡ç†"><a href="#äº”ã€JVM-å†…å­˜ç®¡ç†" class="headerlink" title="äº”ã€JVM &amp; å†…å­˜ç®¡ç†"></a>äº”ã€JVM &amp; å†…å­˜ç®¡ç†</h3><hr><h2 id="1-Java-å†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#1-Java-å†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1. Java å†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰æ˜¯ä»€ä¹ˆï¼Ÿ"></a><strong>1. Java å†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h2><ul><li><strong>å®šä¹‰</strong>ï¼š<ul><li>Java å†…å­˜æ¨¡å‹ï¼ˆJava Memory Modelï¼ŒJMMï¼‰æ˜¯ Java è™šæ‹Ÿæœºè§„èŒƒä¸­å®šä¹‰çš„ä¸€å¥—è§„èŒƒï¼Œç”¨äºæè¿° <strong>Java ç¨‹åºä¸­å„ä¸ªçº¿ç¨‹å¦‚ä½•è®¿é—®å…±äº«å†…å­˜ä»¥åŠå¦‚ä½•ä¿è¯å¯è§æ€§ã€åŸå­æ€§ã€æœ‰åºæ€§</strong>ã€‚</li></ul></li><li><strong>æ ¸å¿ƒä½œç”¨</strong>ï¼š<ol><li><strong>è§£å†³å¤šçº¿ç¨‹å¯è§æ€§é—®é¢˜</strong></li><li><strong>è§„å®šå†…å­˜æ“ä½œé¡ºåº</strong>ï¼ˆhappens-before åŸåˆ™ï¼‰</li><li><strong>å®šä¹‰å˜é‡è®¿é—®åŸå­æ€§</strong></li></ol></li><li><strong>å…³é”®æ¦‚å¿µ</strong>ï¼š<ul><li><strong>ä¸»å†…å­˜ï¼ˆMain Memoryï¼‰</strong>ï¼šå…±äº«å˜é‡å­˜å‚¨ä½ç½®</li><li><strong>å·¥ä½œå†…å­˜ï¼ˆWorking Memory &#x2F; Thread Local Cacheï¼‰</strong>ï¼šçº¿ç¨‹ç§æœ‰ç¼“å­˜</li><li><strong>volatileã€synchronizedã€final</strong> çš„è¯­ä¹‰ä¿è¯ä¸åŒå±‚æ¬¡çš„å¯è§æ€§å’ŒåŸå­æ€§</li></ul></li></ul><hr><h2 id="2-JVM-å†…å­˜åˆ†ä¸ºå“ªå‡ ä¸ªåŒºåŸŸï¼Ÿæ¯ä¸ªåŒºåŸŸçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#2-JVM-å†…å­˜åˆ†ä¸ºå“ªå‡ ä¸ªåŒºåŸŸï¼Ÿæ¯ä¸ªåŒºåŸŸçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="2. JVM å†…å­˜åˆ†ä¸ºå“ªå‡ ä¸ªåŒºåŸŸï¼Ÿæ¯ä¸ªåŒºåŸŸçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ"></a><strong>2. JVM å†…å­˜åˆ†ä¸ºå“ªå‡ ä¸ªåŒºåŸŸï¼Ÿæ¯ä¸ªåŒºåŸŸçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h2><ol><li><strong>ç¨‹åºè®¡æ•°å™¨ï¼ˆPC Registerï¼‰</strong><ul><li>æ¯ä¸ªçº¿ç¨‹ç§æœ‰</li><li>ä¿å­˜å½“å‰çº¿ç¨‹æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤åœ°å€</li><li>æ”¯æŒçº¿ç¨‹åˆ‡æ¢å’Œæ–¹æ³•è°ƒç”¨è¿”å›</li></ul></li><li><strong>è™šæ‹Ÿæœºæ ˆï¼ˆStackï¼‰</strong><ul><li>æ¯ä¸ªçº¿ç¨‹ç§æœ‰</li><li>å­˜å‚¨å±€éƒ¨å˜é‡ã€æ“ä½œæ ˆã€åŠ¨æ€é“¾æ¥ä¿¡æ¯ã€æ–¹æ³•å‡ºå£</li><li>æ ˆå¸§ï¼šæ–¹æ³•æ‰§è¡Œçš„æœ€å°å•ä½</li><li>å¼‚å¸¸ï¼šStackOverflowError</li></ul></li><li><strong>æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Method Stackï¼‰</strong><ul><li>JVM è°ƒç”¨æœ¬åœ°æ–¹æ³•ï¼ˆC&#x2F;C++å®ç°ï¼‰ä½¿ç”¨</li><li>HotSpot é€šå¸¸ä¸è™šæ‹Ÿæœºæ ˆåˆå¹¶</li></ul></li><li><strong>å †ï¼ˆHeapï¼‰</strong><ul><li>æ‰€æœ‰çº¿ç¨‹å…±äº«</li><li>å­˜å‚¨å¯¹è±¡å®ä¾‹åŠæ•°ç»„</li><li>åƒåœ¾æ”¶é›†çš„ä¸»è¦åŒºåŸŸ</li><li>å­åŒºåŸŸï¼š<ul><li><strong>å¹´è½»ä»£ï¼ˆYoung Generationï¼‰</strong>ï¼šEden + Survivor0 + Survivor1</li><li><strong>è€å¹´ä»£ï¼ˆOld Generationï¼‰</strong></li><li><strong>å…ƒç©ºé—´ï¼ˆMetaspace &#x2F; æ–¹æ³•åŒºï¼‰</strong>ï¼šå­˜æ”¾ç±»å…ƒä¿¡æ¯</li></ul></li></ul></li><li><strong>æ–¹æ³•åŒºï¼ˆMetaspace &#x2F; ä»¥å‰ç§°ä¸º PermGenï¼‰</strong><ul><li>å­˜å‚¨ç±»ä¿¡æ¯ã€å¸¸é‡æ± ã€é™æ€å˜é‡</li><li>Metaspace ä»æœ¬åœ°å†…å­˜åˆ†é…ï¼ˆä¸å†å— JVM å †å¤§å°é™åˆ¶ï¼‰</li></ul></li><li><strong>è¿è¡Œæ—¶å¸¸é‡æ± </strong><ul><li>ç±»åŠ è½½æ—¶ç”Ÿæˆ</li><li>å­˜æ”¾å­—é¢é‡ã€ç¬¦å·å¼•ç”¨ã€å­—ç¬¦ä¸²å¸¸é‡ç­‰</li></ul></li></ol><hr><h2 id="3-ä¸ºä»€ä¹ˆ-String-å¸¸é‡æ± è¦æ”¾åœ¨å †é‡Œè€Œä¸æ˜¯æ–¹æ³•åŒºï¼Ÿ"><a href="#3-ä¸ºä»€ä¹ˆ-String-å¸¸é‡æ± è¦æ”¾åœ¨å †é‡Œè€Œä¸æ˜¯æ–¹æ³•åŒºï¼Ÿ" class="headerlink" title="3. ä¸ºä»€ä¹ˆ String å¸¸é‡æ± è¦æ”¾åœ¨å †é‡Œè€Œä¸æ˜¯æ–¹æ³•åŒºï¼Ÿ"></a><strong>3. ä¸ºä»€ä¹ˆ String å¸¸é‡æ± è¦æ”¾åœ¨å †é‡Œè€Œä¸æ˜¯æ–¹æ³•åŒºï¼Ÿ</strong></h2><ul><li><strong>å†å²åŸå› </strong>ï¼š<ul><li>JDK 1.6 åŠä»¥å‰ï¼šå­—ç¬¦ä¸²å¸¸é‡æ± åœ¨æ°¸ä¹…ä»£ï¼ˆPermGenï¼‰ï¼Œæ˜“å¯¼è‡´ OOM</li></ul></li><li><strong>ç°ä»£å®ç°</strong>ï¼š<ul><li>JDK 7+ å°†å¸¸é‡æ± ç§»åˆ°å †</li></ul></li><li><strong>ä¼˜åŠ¿</strong>ï¼š<ol><li>åƒåœ¾å›æ”¶å¯ç®¡ç†</li><li>å†…å­˜åˆ†é…çµæ´»ï¼Œé¿å…æ–¹æ³•åŒºæº¢å‡º</li><li>å¤šçº¿ç¨‹è®¿é—®å®‰å…¨æ€§æå‡ï¼ˆä¸å †å¯¹è±¡ GC åŒæ­¥ï¼‰</li></ol></li></ul><hr><h2 id="4-ä»€ä¹ˆæ˜¯åƒåœ¾å›æ”¶ï¼ˆGCï¼‰çš„å¯è¾¾æ€§åˆ†æç®—æ³•ï¼Ÿ"><a href="#4-ä»€ä¹ˆæ˜¯åƒåœ¾å›æ”¶ï¼ˆGCï¼‰çš„å¯è¾¾æ€§åˆ†æç®—æ³•ï¼Ÿ" class="headerlink" title="4. ä»€ä¹ˆæ˜¯åƒåœ¾å›æ”¶ï¼ˆGCï¼‰çš„å¯è¾¾æ€§åˆ†æç®—æ³•ï¼Ÿ"></a><strong>4. ä»€ä¹ˆæ˜¯åƒåœ¾å›æ”¶ï¼ˆGCï¼‰çš„å¯è¾¾æ€§åˆ†æç®—æ³•ï¼Ÿ</strong></h2><ul><li><p><strong>å¯è¾¾æ€§åˆ†æï¼ˆReachability Analysisï¼‰</strong>ï¼š</p><ul><li>ä» <strong>GC Roots</strong> å¼€å§‹ï¼Œé€šè¿‡å¼•ç”¨é“¾åˆ¤æ–­å¯¹è±¡æ˜¯å¦å¯è¾¾</li><li><strong>ä¸å¯è¾¾å¯¹è±¡</strong>å³ä¸ºåƒåœ¾ï¼Œå¯ä»¥å›æ”¶</li></ul></li><li><p><strong>ç¤ºæ„</strong>ï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GC Roots</span><br><span class="line">   |</span><br><span class="line">   v</span><br><span class="line">Object A --&gt; Object B</span><br></pre></td></tr></table></figure><ul><li>å¦‚æœ Object B æ— æ³•é€šè¿‡ GC Roots è®¿é—®ï¼Œåˆ™è¢«å›æ”¶</li></ul></li></ul><hr><h2 id="5-å“ªäº›å¯¹è±¡å¯ä»¥ä½œä¸º-GC-Rootsï¼Ÿ"><a href="#5-å“ªäº›å¯¹è±¡å¯ä»¥ä½œä¸º-GC-Rootsï¼Ÿ" class="headerlink" title="5. å“ªäº›å¯¹è±¡å¯ä»¥ä½œä¸º GC Rootsï¼Ÿ"></a><strong>5. å“ªäº›å¯¹è±¡å¯ä»¥ä½œä¸º GC Rootsï¼Ÿ</strong></h2><p>å¸¸è§ GC Rootsï¼š</p><ol><li><strong>è™šæ‹Ÿæœºæ ˆä¸­çš„å¼•ç”¨</strong>ï¼ˆå±€éƒ¨å˜é‡ã€æ–¹æ³•å‚æ•°ï¼‰</li><li><strong>é™æ€å˜é‡</strong>ï¼ˆç±»é™æ€æˆå‘˜ï¼‰</li><li><strong>å¸¸é‡å¼•ç”¨</strong>ï¼ˆå¸¸é‡æ± å¼•ç”¨ï¼‰</li><li><strong>JNI å¼•ç”¨</strong>ï¼ˆæœ¬åœ°æ–¹æ³•æ ˆä¸­çš„å¼•ç”¨ï¼‰</li></ol><hr><h2 id="6-å¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨çš„åŒºåˆ«"><a href="#6-å¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨çš„åŒºåˆ«" class="headerlink" title="6. å¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨çš„åŒºåˆ«"></a><strong>6. å¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨çš„åŒºåˆ«</strong></h2><table><thead><tr><th>ç±»å‹</th><th>ç‰¹ç‚¹</th><th>GC è¡Œä¸º</th><th>é¢è¯•åº”ç”¨</th></tr></thead><tbody><tr><td>å¼ºå¼•ç”¨ï¼ˆStrong Referenceï¼‰</td><td>æ™®é€šå¯¹è±¡å¼•ç”¨</td><td>ä¸å¯å›æ”¶</td><td>æ™®é€šå¯¹è±¡</td></tr><tr><td>è½¯å¼•ç”¨ï¼ˆSoft Referenceï¼‰</td><td>é€šè¿‡ SoftReference å¼•ç”¨</td><td>å†…å­˜ä¸è¶³æ—¶å›æ”¶</td><td>ç¼“å­˜ï¼ˆMemory-sensitive cacheï¼‰</td></tr><tr><td>å¼±å¼•ç”¨ï¼ˆWeak Referenceï¼‰</td><td>WeakReference å¼•ç”¨</td><td>GC æ—¶ç«‹å³å›æ”¶</td><td>ThreadLocal æ¸…ç†ã€ç¼“å­˜</td></tr><tr><td>è™šå¼•ç”¨ï¼ˆPhantom Referenceï¼‰</td><td>PhantomReference å¼•ç”¨</td><td>ä»…åšå¼•ç”¨é˜Ÿåˆ—é€šçŸ¥</td><td>å¯¹è±¡å›æ”¶å‰åšæ¸…ç†ã€èµ„æºé‡Šæ”¾</td></tr></tbody></table><hr><h2 id="7-GC-ç®—æ³•"><a href="#7-GC-ç®—æ³•" class="headerlink" title="7. GC ç®—æ³•"></a><strong>7. GC ç®—æ³•</strong></h2><ol><li><strong>æ ‡è®°-æ¸…é™¤ï¼ˆMark-Sweepï¼‰</strong><ul><li>æ ‡è®°å¯è¾¾å¯¹è±¡ï¼Œæ¸…é™¤æœªæ ‡è®°å¯¹è±¡</li><li>ä¼˜ç‚¹ï¼šç®€å•</li><li>ç¼ºç‚¹ï¼šäº§ç”Ÿç¢ç‰‡</li></ul></li><li><strong>æ ‡è®°-æ•´ç†ï¼ˆMark-Compactï¼‰</strong><ul><li>æ ‡è®°å¯è¾¾å¯¹è±¡</li><li>å°†å­˜æ´»å¯¹è±¡ç§»åŠ¨åˆ°ä¸€ç«¯</li><li>ä¼˜ç‚¹ï¼šè§£å†³ç¢ç‰‡é—®é¢˜</li><li>ç¼ºç‚¹ï¼šç§»åŠ¨å¯¹è±¡æˆæœ¬é«˜</li></ul></li><li><strong>å¤åˆ¶ç®—æ³•ï¼ˆCopyingï¼‰</strong><ul><li>å°†å†…å­˜åˆ†ä¸ºä¸¤å—</li><li>å°†å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å—ï¼Œæ¸…ç†æ—§å—</li><li>ä¼˜ç‚¹ï¼šåˆ†é…å¿«ï¼Œæ•´ç†å¿«</li><li>ç¼ºç‚¹ï¼šå†…å­˜åˆ©ç”¨ç‡ä½</li></ul></li></ol><hr><h2 id="8-å¸¸è§çš„åƒåœ¾æ”¶é›†å™¨"><a href="#8-å¸¸è§çš„åƒåœ¾æ”¶é›†å™¨" class="headerlink" title="8. å¸¸è§çš„åƒåœ¾æ”¶é›†å™¨"></a><strong>8. å¸¸è§çš„åƒåœ¾æ”¶é›†å™¨</strong></h2><table><thead><tr><th>åƒåœ¾æ”¶é›†å™¨</th><th>é€‚ç”¨åœºæ™¯</th><th>ç‰¹ç‚¹</th></tr></thead><tbody><tr><td>Serial GC</td><td>å•æ ¸</td><td>STW ä¸²è¡Œï¼Œç®€å•ã€é«˜ååé‡ä½</td></tr><tr><td>Parallel GC</td><td>å¤šæ ¸</td><td>å¹¶è¡Œå›æ”¶å¹´è½»ä»£ï¼Œé«˜ååé‡</td></tr><tr><td>CMS GC</td><td>å¤šæ ¸</td><td>å¹¶å‘å›æ”¶è€å¹´ä»£ï¼Œå‡å°‘ STW</td></tr><tr><td>G1 GC</td><td>å¤§å †</td><td>åˆ†åŒºå›æ”¶ï¼Œä½å»¶è¿Ÿï¼Œé¢„æµ‹åœé¡¿</td></tr><tr><td>ZGC</td><td>è¶…å¤§å †</td><td>å¹¶å‘æ ‡è®°-æ¸…ç†ï¼Œä½å»¶è¿Ÿ</td></tr><tr><td>Shenandoah</td><td>å¤§å †</td><td>å¹¶å‘æ ‡è®°-æ•´ç†ï¼Œå‡å°‘ STW</td></tr></tbody></table><hr><h2 id="9-ä»€ä¹ˆæ˜¯-Stop-The-World-STW-ï¼Ÿ"><a href="#9-ä»€ä¹ˆæ˜¯-Stop-The-World-STW-ï¼Ÿ" class="headerlink" title="9. ä»€ä¹ˆæ˜¯ Stop-The-World (STW)ï¼Ÿ"></a><strong>9. ä»€ä¹ˆæ˜¯ Stop-The-World (STW)ï¼Ÿ</strong></h2><ul><li><strong>å®šä¹‰</strong>ï¼šJVM æš‚åœæ‰€æœ‰åº”ç”¨çº¿ç¨‹æ‰§è¡Œï¼Œä¸“é—¨è¿›è¡Œ GC</li><li><strong>åŸå› </strong>ï¼š<ul><li>é˜²æ­¢å¯¹è±¡è¢«ä¿®æ”¹å¯¼è‡´å›æ”¶é”™è¯¯</li></ul></li><li><strong>é¢è¯•æ‹“å±•</strong>ï¼š<ul><li>G1&#x2F;ZGC&#x2F;Shenandoah å°½é‡ç¼©çŸ­ STW æ—¶é—´</li><li>å¹¶å‘ GC ä¸ STW çš„æŠ˜ä¸­</li></ul></li></ul><hr><h2 id="10-JVM-è°ƒä¼˜å¸¸è§å‚æ•°"><a href="#10-JVM-è°ƒä¼˜å¸¸è§å‚æ•°" class="headerlink" title="10. JVM è°ƒä¼˜å¸¸è§å‚æ•°"></a><strong>10. JVM è°ƒä¼˜å¸¸è§å‚æ•°</strong></h2><table><thead><tr><th>å‚æ•°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><code>-Xmx</code></td><td>æœ€å¤§å †å¤§å°</td></tr><tr><td><code>-Xms</code></td><td>åˆå§‹å †å¤§å°</td></tr><tr><td><code>-Xmn</code></td><td>å¹´è½»ä»£å¤§å°</td></tr><tr><td><code>-XX:SurvivorRatio</code></td><td>Eden&#x2F;Survivor æ¯”ä¾‹</td></tr><tr><td><code>-XX:+UseG1GC</code></td><td>ä½¿ç”¨ G1 GC</td></tr><tr><td><code>-XX:MaxGCPauseMillis</code></td><td>æœ€å¤§åœé¡¿æ—¶é—´</td></tr><tr><td><code>-XX:+PrintGCDetails</code></td><td>æ‰“å° GC æ—¥å¿—</td></tr><tr><td><code>-XX:+HeapDumpOnOutOfMemoryError</code></td><td>OOM æ—¶ç”Ÿæˆå †è½¬å‚¨</td></tr></tbody></table><p><strong>é¢è¯•æ‹“å±•</strong>ï¼š</p><ul><li>å¦‚ä½•è°ƒä¼˜è€å¹´ä»£å’Œå¹´è½»ä»£æ¯”ä¾‹ï¼Ÿ</li><li>GC æ—¥å¿—åˆ†æç¤ºä¾‹ï¼šå¹´è½»ä»£æ»¡ã€è€å¹´ä»£æ™‹å‡ã€STW åœé¡¿</li></ul><hr><h3 id="å…­ã€å¹¶å‘ç¼–ç¨‹åŸºç¡€"><a href="#å…­ã€å¹¶å‘ç¼–ç¨‹åŸºç¡€" class="headerlink" title="å…­ã€å¹¶å‘ç¼–ç¨‹åŸºç¡€"></a>å…­ã€å¹¶å‘ç¼–ç¨‹åŸºç¡€</h3><hr><h2 id="1-Java-ä¸­çš„-volatile-å…³é”®å­—çš„åº•å±‚å®ç°åŸç†"><a href="#1-Java-ä¸­çš„-volatile-å…³é”®å­—çš„åº•å±‚å®ç°åŸç†" class="headerlink" title="1. Java ä¸­çš„ volatile å…³é”®å­—çš„åº•å±‚å®ç°åŸç†"></a><strong>1. Java ä¸­çš„ volatile å…³é”®å­—çš„åº•å±‚å®ç°åŸç†</strong></h2><ul><li><strong>ä½œç”¨</strong>ï¼š<ol><li><strong>ä¿è¯å¯è§æ€§</strong>ï¼šä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹å˜é‡åï¼Œå…¶ä»–çº¿ç¨‹ç«‹å³å¯è§</li><li><strong>ç¦æ­¢æŒ‡ä»¤é‡æ’</strong>ï¼šä¿è¯é¡ºåºæ€§</li></ol></li><li><strong>åŸç†</strong>ï¼š<ul><li>åº•å±‚é€šè¿‡ <strong>å†…å­˜å±éšœï¼ˆMemory Barrier &#x2F; Fenceï¼‰</strong> å®ç°</li><li><code>volatile</code> è¯»æ“ä½œï¼š<ul><li>åŠ è½½å±éšœï¼ˆLoadLoad + LoadStoreï¼‰</li></ul></li><li><code>volatile</code> å†™æ“ä½œï¼š<ul><li>å†™å±éšœï¼ˆStoreStore + StoreLoadï¼‰</li></ul></li></ul></li><li><strong>æ³¨æ„</strong>ï¼š<ul><li>ä¸èƒ½ä¿è¯ <strong>åŸå­æ€§</strong></li><li>é€‚åˆ <strong>çŠ¶æ€æ ‡è¯†ã€å¼€å…³å˜é‡</strong></li></ul></li></ul><hr><h2 id="2-synchronized-çš„å®ç°åŸç†"><a href="#2-synchronized-çš„å®ç°åŸç†" class="headerlink" title="2. synchronized çš„å®ç°åŸç†"></a><strong>2. synchronized çš„å®ç°åŸç†</strong></h2><ul><li><strong>ä½œç”¨</strong>ï¼š<ul><li>ä¿è¯ <strong>äº’æ–¥è®¿é—®</strong></li><li>ä¿è¯ <strong>å¯è§æ€§</strong></li></ul></li><li><strong>åº•å±‚æœºåˆ¶</strong>ï¼š<ul><li>Java å¯¹è±¡å¤´åŒ…å« <strong>Mark Word</strong></li><li>æ¯ä¸ªå¯¹è±¡å¯ä»¥å…³è”ä¸€ä¸ª <strong>Monitor</strong></li><li><strong>Monitor</strong> ç”¨äºç®¡ç†çº¿ç¨‹çš„åŠ é”ã€é˜»å¡ã€å”¤é†’</li></ul></li><li><strong>é”å‡çº§æµç¨‹</strong>ï¼š<ol><li><strong>åå‘é”</strong>ï¼ˆé»˜è®¤è½»é‡çº§çº¿ç¨‹æ— ç«äº‰ï¼‰</li><li><strong>è½»é‡çº§é”</strong>ï¼ˆCAS ç«äº‰ï¼Œè†¨èƒ€å‰ï¼‰</li><li><strong>é‡é‡çº§é”</strong>ï¼ˆé”è†¨èƒ€ï¼Œé˜»å¡å…¶ä»–çº¿ç¨‹ï¼‰</li></ol></li></ul><hr><h2 id="3-åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”"><a href="#3-åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”" class="headerlink" title="3. åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”"></a><strong>3. åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”</strong></h2><table><thead><tr><th>é”ç±»å‹</th><th>é€‚ç”¨åœºæ™¯</th><th>å®ç°æ–¹å¼</th><th>ä¼˜ç¼ºç‚¹</th></tr></thead><tbody><tr><td>åå‘é”</td><td>å•çº¿ç¨‹</td><td>åœ¨å¯¹è±¡å¤´æ ‡è®°çº¿ç¨‹ ID</td><td>å‡å°‘æ— ç«äº‰å¼€é”€</td></tr><tr><td>è½»é‡çº§é”</td><td>å¤šçº¿ç¨‹ç«äº‰è½»é‡</td><td>CAS è‡ªæ—‹ + æ ˆè®°å½•é”</td><td>é«˜æ•ˆï¼Œé¿å…é˜»å¡</td></tr><tr><td>é‡é‡çº§é”</td><td>å¤šçº¿ç¨‹ç«äº‰ä¸¥é‡</td><td>Monitor + é˜»å¡</td><td>å¼€é”€å¤§ï¼Œå¯èƒ½ STW</td></tr></tbody></table><p><strong>é¢è¯•æ‹“å±•</strong>ï¼š</p><ul><li>å¦‚ä½•é€šè¿‡ <code>-XX:+PrintFlagsFinal</code> æŸ¥çœ‹é”æ ‡å¿—ä½</li><li>åå‘é”é»˜è®¤å»¶è¿Ÿ 4 ç§’å¯ç”¨</li></ul><hr><h2 id="4-ä»€ä¹ˆæ˜¯-CAS-æ“ä½œï¼ŸABA-é—®é¢˜å¦‚ä½•è§£å†³ï¼Ÿ"><a href="#4-ä»€ä¹ˆæ˜¯-CAS-æ“ä½œï¼ŸABA-é—®é¢˜å¦‚ä½•è§£å†³ï¼Ÿ" class="headerlink" title="4. ä»€ä¹ˆæ˜¯ CAS æ“ä½œï¼ŸABA é—®é¢˜å¦‚ä½•è§£å†³ï¼Ÿ"></a><strong>4. ä»€ä¹ˆæ˜¯ CAS æ“ä½œï¼ŸABA é—®é¢˜å¦‚ä½•è§£å†³ï¼Ÿ</strong></h2><ul><li><p><strong>CASï¼ˆCompare-And-Swapï¼‰</strong>ï¼š</p><ul><li>åŸå­æ“ä½œ</li><li>æ¯”è¾ƒå†…å­˜å€¼æ˜¯å¦ä¸ºé¢„æœŸå€¼ï¼Œå¦‚æœæ˜¯å°±æ›´æ–°</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CAS(V, A, B)</span><br></pre></td></tr></table></figure></li><li><p><strong>ABA é—®é¢˜</strong>ï¼š</p><ul><li>å€¼å…ˆä» A æ”¹æˆ Bï¼Œåˆæ”¹å› A</li><li>CAS æ— æ³•æ£€æµ‹å˜åŒ–ï¼Œå¯èƒ½å‡ºé”™</li></ul></li><li><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><ol><li><strong>ç‰ˆæœ¬å·æœºåˆ¶</strong>ï¼ˆAtomicStampedReferenceï¼‰</li><li><strong>åŠ é”</strong></li></ol></li></ul><hr><h2 id="5-ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨ï¼Ÿä¸¾ä¾‹çº¿ç¨‹å®‰å…¨ç±»"><a href="#5-ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨ï¼Ÿä¸¾ä¾‹çº¿ç¨‹å®‰å…¨ç±»" class="headerlink" title="5. ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨ï¼Ÿä¸¾ä¾‹çº¿ç¨‹å®‰å…¨ç±»"></a><strong>5. ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨ï¼Ÿä¸¾ä¾‹çº¿ç¨‹å®‰å…¨ç±»</strong></h2><ul><li><strong>å®šä¹‰</strong>ï¼šå¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œä¸ä¼šç ´åå¯¹è±¡çš„çŠ¶æ€ï¼Œå¹¶ä¿è¯æ­£ç¡®æ€§</li><li><strong>çº¿ç¨‹å®‰å…¨ç±»ç¤ºä¾‹</strong>ï¼š<ul><li>é›†åˆç±»ï¼š<code>Vector</code>, <code>ConcurrentHashMap</code>, <code>CopyOnWriteArrayList</code></li><li>åŸå­ç±»ï¼š<code>AtomicInteger</code>, <code>AtomicReference</code></li><li>å·¥å…·ç±»ï¼š<code>ThreadLocal</code>, <code>BlockingQueue</code></li></ul></li></ul><hr><h2 id="6-ThreadLocal-çš„åº•å±‚åŸç†ä¸å†…å­˜æ³„æ¼é—®é¢˜"><a href="#6-ThreadLocal-çš„åº•å±‚åŸç†ä¸å†…å­˜æ³„æ¼é—®é¢˜" class="headerlink" title="6. ThreadLocal çš„åº•å±‚åŸç†ä¸å†…å­˜æ³„æ¼é—®é¢˜"></a><strong>6. ThreadLocal çš„åº•å±‚åŸç†ä¸å†…å­˜æ³„æ¼é—®é¢˜</strong></h2><ul><li><strong>åŸç†</strong>ï¼š<ul><li>æ¯ä¸ªçº¿ç¨‹ç»´æŠ¤ä¸€ä¸ª <code>ThreadLocalMap</code></li><li>key æ˜¯ <strong>ThreadLocal å¯¹è±¡</strong></li><li>value æ˜¯å¯¹åº”çš„å€¼</li></ul></li><li><strong>å†…å­˜æ³„æ¼åŸå› </strong>ï¼š<ul><li>ThreadLocalMap çš„ key æ˜¯ <strong>å¼±å¼•ç”¨</strong></li><li>å¦‚æœ ThreadLocal å¯¹è±¡è¢«å›æ”¶ï¼Œä½†çº¿ç¨‹ä»å­˜æ´»ï¼Œvalue ä»ç„¶å­˜åœ¨</li></ul></li><li><strong>è§£å†³æ–¹æ³•</strong>ï¼š<ul><li>ä½¿ç”¨ <code>remove()</code> æ–¹æ³•</li><li>é¿å…é•¿ç”Ÿå‘½å‘¨æœŸçº¿ç¨‹å­˜å‚¨å¤§é‡ ThreadLocal</li></ul></li></ul><hr><h2 id="7-çº¿ç¨‹æ± çš„æ ¸å¿ƒå‚æ•°"><a href="#7-çº¿ç¨‹æ± çš„æ ¸å¿ƒå‚æ•°" class="headerlink" title="7. çº¿ç¨‹æ± çš„æ ¸å¿ƒå‚æ•°"></a><strong>7. çº¿ç¨‹æ± çš„æ ¸å¿ƒå‚æ•°</strong></h2><table><thead><tr><th>å‚æ•°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>corePoolSize</td><td>æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œå¸¸é©»çº¿ç¨‹</td></tr><tr><td>maximumPoolSize</td><td>æœ€å¤§çº¿ç¨‹æ•°</td></tr><tr><td>keepAliveTime</td><td>éæ ¸å¿ƒçº¿ç¨‹ç©ºé—²å­˜æ´»æ—¶é—´</td></tr><tr><td>workQueue</td><td>ç­‰å¾…é˜Ÿåˆ—ï¼Œç”¨äºå­˜æ”¾ä»»åŠ¡</td></tr><tr><td>threadFactory</td><td>çº¿ç¨‹åˆ›å»ºå·¥å‚</td></tr><tr><td>RejectedExecutionHandler</td><td>æ‹’ç»ç­–ç•¥</td></tr></tbody></table><hr><h2 id="8-ä»€ä¹ˆæ˜¯æ‹’ç»ç­–ç•¥"><a href="#8-ä»€ä¹ˆæ˜¯æ‹’ç»ç­–ç•¥" class="headerlink" title="8. ä»€ä¹ˆæ˜¯æ‹’ç»ç­–ç•¥"></a><strong>8. ä»€ä¹ˆæ˜¯æ‹’ç»ç­–ç•¥</strong></h2><ul><li><strong>è§¦å‘åœºæ™¯</strong>ï¼šçº¿ç¨‹æ± æ»¡äº†ï¼Œé˜Ÿåˆ—æ»¡äº†</li><li><strong>å¸¸è§ç­–ç•¥</strong>ï¼š<ol><li><strong>AbortPolicy</strong>ï¼šæŠ›å¼‚å¸¸ï¼Œé»˜è®¤</li><li><strong>CallerRunsPolicy</strong>ï¼šç”±è°ƒç”¨çº¿ç¨‹æ‰§è¡Œä»»åŠ¡</li><li><strong>DiscardPolicy</strong>ï¼šç›´æ¥ä¸¢å¼ƒä»»åŠ¡</li><li><strong>DiscardOldestPolicy</strong>ï¼šä¸¢å¼ƒé˜Ÿåˆ—ä¸­æœ€æ—§ä»»åŠ¡</li></ol></li></ul><hr><h2 id="9-Executors-æä¾›çš„å¸¸è§çº¿ç¨‹æ± "><a href="#9-Executors-æä¾›çš„å¸¸è§çº¿ç¨‹æ± " class="headerlink" title="9. Executors æä¾›çš„å¸¸è§çº¿ç¨‹æ± "></a><strong>9. Executors æä¾›çš„å¸¸è§çº¿ç¨‹æ± </strong></h2><table><thead><tr><th>çº¿ç¨‹æ± ç±»å‹</th><th>ç‰¹ç‚¹</th><th>ä½¿ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>FixedThreadPool</td><td>å›ºå®šçº¿ç¨‹æ•°</td><td>CPUå¯†é›†å‹ä»»åŠ¡</td></tr><tr><td>CachedThreadPool</td><td>å¯æ‰©å®¹çº¿ç¨‹æ± </td><td>çŸ­ç”Ÿå‘½å‘¨æœŸä»»åŠ¡</td></tr><tr><td>SingleThreadExecutor</td><td>å•çº¿ç¨‹é¡ºåºæ‰§è¡Œ</td><td>é¡ºåºä»»åŠ¡</td></tr><tr><td>ScheduledThreadPool</td><td>æ”¯æŒå®šæ—¶&#x2F;å‘¨æœŸæ‰§è¡Œ</td><td>å®šæ—¶ä»»åŠ¡</td></tr></tbody></table><p><strong>é¢è¯•æ‹“å±•</strong>ï¼š</p><ul><li>Executors.newFixedThreadPool ä¼šä½¿ç”¨ <strong>LinkedBlockingQueue</strong></li><li>CachedThreadPool ä½¿ç”¨ <strong>SynchronousQueue</strong>ï¼Œä»»åŠ¡ç›´æ¥äº¤ç»™çº¿ç¨‹</li></ul><hr><h2 id="10-Future-å’Œ-CompletableFuture-åŒºåˆ«"><a href="#10-Future-å’Œ-CompletableFuture-åŒºåˆ«" class="headerlink" title="10. Future å’Œ CompletableFuture åŒºåˆ«"></a><strong>10. Future å’Œ CompletableFuture åŒºåˆ«</strong></h2><table><thead><tr><th>ç‰¹æ€§</th><th>Future</th><th>CompletableFuture</th></tr></thead><tbody><tr><td>å¼‚æ­¥</td><td>æäº¤ä»»åŠ¡åå¯é˜»å¡è·å–ç»“æœ</td><td>å¯é“¾å¼å¼‚æ­¥æ“ä½œ</td></tr><tr><td>API</td><td>get() é˜»å¡</td><td>thenApply, thenAccept ç­‰é“¾å¼</td></tr><tr><td>å¼‚å¸¸å¤„ç†</td><td>é˜»å¡å¼ï¼Œæ•è· ExecutionException</td><td>æ”¯æŒ exceptionally&#x2F;handle</td></tr><tr><td>ç»„åˆä»»åŠ¡</td><td>ç»„åˆå›°éš¾</td><td>æ”¯æŒ allOf &#x2F; anyOf &#x2F; thenCombine</td></tr></tbody></table><p><strong>é¢è¯•ç‚¹</strong>ï¼š</p><ul><li>CompletableFuture é€‚åˆå¤šå¼‚æ­¥ä»»åŠ¡ç»„åˆ</li><li>FutureTask å¯ä½œä¸º Future çš„å®ç°ç±»</li></ul><hr><h3 id="ä¸ƒã€ç¼–è¯‘-è¿è¡Œæ—¶"><a href="#ä¸ƒã€ç¼–è¯‘-è¿è¡Œæ—¶" class="headerlink" title="ä¸ƒã€ç¼–è¯‘ &amp; è¿è¡Œæ—¶"></a>ä¸ƒã€ç¼–è¯‘ &amp; è¿è¡Œæ—¶</h3><hr><h2 id="1-Java-çš„åå°„æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿåº•å±‚åŸç†ï¼Ÿ"><a href="#1-Java-çš„åå°„æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿåº•å±‚åŸç†ï¼Ÿ" class="headerlink" title="1. Java çš„åå°„æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿåº•å±‚åŸç†ï¼Ÿ"></a><strong>1. Java çš„åå°„æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿåº•å±‚åŸç†ï¼Ÿ</strong></h2><ul><li><p><strong>æ¦‚å¿µ</strong>ï¼š</p><ul><li>åå°„æœºåˆ¶å…è®¸åœ¨è¿è¡Œæ—¶ <strong>è·å–ç±»çš„ä¿¡æ¯ã€å®ä¾‹åŒ–å¯¹è±¡ã€è®¿é—®å­—æ®µå’Œæ–¹æ³•</strong>ï¼Œè€Œä¸éœ€è¦åœ¨ç¼–è¯‘æœŸçŸ¥é“å…·ä½“ç±»å‹</li></ul></li><li><p><strong>å¸¸ç”¨ API</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Class&lt;?&gt; clazz = Class.forName(<span class="string">&quot;com.example.User&quot;</span>);</span><br><span class="line"><span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> clazz.newInstance();</span><br><span class="line"><span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> clazz.getMethod(<span class="string">&quot;sayHello&quot;</span>, String.class);</span><br><span class="line">method.invoke(obj, <span class="string">&quot;world&quot;</span>);</span><br></pre></td></tr></table></figure></li><li><p><strong>åº•å±‚åŸç†</strong>ï¼š</p><ul><li>JVM ä¸­ç±»å¯¹è±¡ <code>Class</code> å¯¹åº”å†…å­˜ä¸­çš„å…ƒæ•°æ®ï¼ˆæ–¹æ³•è¡¨ã€å­—æ®µè¡¨ã€å¸¸é‡æ± ï¼‰</li><li>é€šè¿‡ <strong>Native æ–¹æ³•</strong> è°ƒç”¨ï¼Œè®¿é—®ç±»çš„å…ƒæ•°æ®å’Œå¯¹è±¡å®ä¾‹</li></ul></li><li><p><strong>é¢è¯•æ‹“å±•</strong>ï¼š</p><ul><li>åå°„å¯è®¿é—®ç§æœ‰å­—æ®µ&#x2F;æ–¹æ³•ï¼ˆ<code>setAccessible(true)</code>ï¼‰</li><li>åå°„é€‚ç”¨äºæ¡†æ¶ï¼ˆSpringã€MyBatisï¼‰</li></ul></li></ul><hr><h2 id="2-ä¸ºä»€ä¹ˆåå°„æ€§èƒ½å·®ï¼ŸJDK-9-ä¹‹åå¦‚ä½•ä¼˜åŒ–ï¼Ÿ"><a href="#2-ä¸ºä»€ä¹ˆåå°„æ€§èƒ½å·®ï¼ŸJDK-9-ä¹‹åå¦‚ä½•ä¼˜åŒ–ï¼Ÿ" class="headerlink" title="2. ä¸ºä»€ä¹ˆåå°„æ€§èƒ½å·®ï¼ŸJDK 9 ä¹‹åå¦‚ä½•ä¼˜åŒ–ï¼Ÿ"></a><strong>2. ä¸ºä»€ä¹ˆåå°„æ€§èƒ½å·®ï¼ŸJDK 9 ä¹‹åå¦‚ä½•ä¼˜åŒ–ï¼Ÿ</strong></h2><ul><li><strong>æ€§èƒ½å·®åŸå› </strong>ï¼š<ol><li>æ¯æ¬¡è®¿é—®æ–¹æ³•&#x2F;å­—æ®µéƒ½è¦è¿›è¡ŒåŠ¨æ€è§£æ</li><li>JVM æ— æ³•åšå†…è”ä¼˜åŒ–ï¼ˆæ–¹æ³•è°ƒç”¨ä¸æ˜¯é™æ€ç»‘å®šï¼‰</li><li>éœ€è¦æ£€æŸ¥æƒé™ã€ç±»å‹è½¬æ¢</li></ol></li><li><strong>ä¼˜åŒ–æªæ–½</strong>ï¼š<ul><li><strong>JDK 7 åŠä»¥å</strong>ï¼š<code>MethodHandle</code> å’Œ <code>invokeDynamic</code></li><li><strong>JDK 9+</strong>ï¼šå¢å¼ºæ¨¡å—åŒ–ï¼ˆæ¨¡å—è¾¹ç•Œæ£€æŸ¥ä¼˜åŒ–ï¼‰</li><li><strong>çƒ­ç‚¹ç¼–è¯‘å™¨ JIT</strong> å¯ä»¥å¯¹åå°„è°ƒç”¨åšå†…è”</li></ul></li></ul><hr><h2 id="3-ä»€ä¹ˆæ˜¯åŠ¨æ€ä»£ç†ï¼ŸJDK-åŠ¨æ€ä»£ç†å’Œ-CGLIB-åŒºåˆ«ï¼Ÿ"><a href="#3-ä»€ä¹ˆæ˜¯åŠ¨æ€ä»£ç†ï¼ŸJDK-åŠ¨æ€ä»£ç†å’Œ-CGLIB-åŒºåˆ«ï¼Ÿ" class="headerlink" title="3. ä»€ä¹ˆæ˜¯åŠ¨æ€ä»£ç†ï¼ŸJDK åŠ¨æ€ä»£ç†å’Œ CGLIB åŒºåˆ«ï¼Ÿ"></a><strong>3. ä»€ä¹ˆæ˜¯åŠ¨æ€ä»£ç†ï¼ŸJDK åŠ¨æ€ä»£ç†å’Œ CGLIB åŒºåˆ«ï¼Ÿ</strong></h2><ul><li><p><strong>åŠ¨æ€ä»£ç†</strong>ï¼š</p><ul><li>åœ¨è¿è¡Œæ—¶ç”Ÿæˆä»£ç†å¯¹è±¡ï¼Œæ‹¦æˆªæ–¹æ³•è°ƒç”¨ï¼Œå¢å¼ºè¡Œä¸º</li></ul></li><li><p><strong>JDK åŠ¨æ€ä»£ç†</strong>ï¼š</p><ul><li>åŸºäºæ¥å£</li><li>ä½¿ç”¨ <code>Proxy.newProxyInstance</code></li><li>é€šè¿‡ <code>InvocationHandler.invoke</code> è°ƒç”¨</li></ul></li><li><p><strong>CGLIB</strong>ï¼š</p><ul><li>åŸºäºå­ç±»ç»§æ‰¿ï¼ˆæ— æ¥å£ä¹Ÿå¯ä»£ç†ï¼‰</li><li>ä½¿ç”¨ ASM å­—èŠ‚ç ç”Ÿæˆå­ç±»</li><li>æ³¨æ„ final ç±»&#x2F;æ–¹æ³•ä¸èƒ½è¢«ä»£ç†</li></ul></li><li><p><strong>å¯¹æ¯”</strong>ï¼š</p><table><thead><tr><th>ç‰¹æ€§</th><th>JDK åŠ¨æ€ä»£ç†</th><th>CGLIB</th></tr></thead><tbody><tr><td>æ˜¯å¦éœ€è¦æ¥å£</td><td>å¿…é¡»</td><td>ä¸éœ€è¦</td></tr><tr><td>åŸç†</td><td>Proxy + InvocationHandler</td><td>ASM å­—èŠ‚ç ç”Ÿæˆå­ç±»</td></tr><tr><td>æ€§èƒ½</td><td>ç•¥æ…¢</td><td>è¾ƒå¿«</td></tr><tr><td>å±€é™æ€§</td><td>æ— </td><td>final ç±»&#x2F;æ–¹æ³•ä¸å¯ä»£ç†</td></tr></tbody></table></li></ul><hr><h2 id="4-æ³¨è§£çš„åº•å±‚åŸç†æ˜¯ä»€ä¹ˆï¼Ÿè¿è¡Œæ—¶æ³¨è§£å¦‚ä½•å®ç°ï¼Ÿ"><a href="#4-æ³¨è§£çš„åº•å±‚åŸç†æ˜¯ä»€ä¹ˆï¼Ÿè¿è¡Œæ—¶æ³¨è§£å¦‚ä½•å®ç°ï¼Ÿ" class="headerlink" title="4. æ³¨è§£çš„åº•å±‚åŸç†æ˜¯ä»€ä¹ˆï¼Ÿè¿è¡Œæ—¶æ³¨è§£å¦‚ä½•å®ç°ï¼Ÿ"></a><strong>4. æ³¨è§£çš„åº•å±‚åŸç†æ˜¯ä»€ä¹ˆï¼Ÿè¿è¡Œæ—¶æ³¨è§£å¦‚ä½•å®ç°ï¼Ÿ</strong></h2><ul><li><strong>æ¦‚å¿µ</strong>ï¼š<ul><li>æ³¨è§£æ˜¯ä¸€ç§ <strong>å…ƒæ•°æ®</strong>ï¼Œç”¨äºç»™ç±»ã€æ–¹æ³•ã€å­—æ®µç­‰æä¾›ä¿¡æ¯</li></ul></li><li><strong>åº•å±‚åŸç†</strong>ï¼š<ul><li>ç¼–è¯‘æ—¶ç”Ÿæˆ <code>.class</code> æ–‡ä»¶ä¸­ <code>RuntimeVisibleAnnotations</code> å±æ€§</li><li>JVM é€šè¿‡ <code>java.lang.reflect.AnnotatedElement</code> è·å–</li></ul></li><li><strong>è¿è¡Œæ—¶æ³¨è§£</strong>ï¼š<ul><li><code>@Retention(RetentionPolicy.RUNTIME)</code></li><li>é€šè¿‡åå°„ API è¯»å–æ³¨è§£å¹¶æ‰§è¡Œé€»è¾‘</li></ul></li><li><strong>åº”ç”¨åœºæ™¯</strong>ï¼š<ul><li>Spring æ³¨è§£ï¼ˆ<code>@Autowired</code>ã€<code>@Service</code>ï¼‰</li><li>JPA æ³¨è§£ï¼ˆ<code>@Entity</code>ã€<code>@Column</code>ï¼‰</li></ul></li></ul><hr><h2 id="5-ClassLoader-çš„åŒäº²å§”æ´¾æ¨¡å‹æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#5-ClassLoader-çš„åŒäº²å§”æ´¾æ¨¡å‹æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="5. ClassLoader çš„åŒäº²å§”æ´¾æ¨¡å‹æ˜¯ä»€ä¹ˆï¼Ÿ"></a><strong>5. ClassLoader çš„åŒäº²å§”æ´¾æ¨¡å‹æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h2><ul><li><p><strong>åŸç†</strong>ï¼š</p><ul><li>å½“ç±»åŠ è½½è¯·æ±‚åˆ°æ¥æ—¶ï¼Œ<strong>å…ˆå§”æ‰˜çˆ¶ ClassLoader åŠ è½½</strong></li><li>å¦‚æœçˆ¶ ClassLoader åŠ è½½å¤±è´¥ï¼Œå†ç”±å­ ClassLoader åŠ è½½</li></ul></li><li><p><strong>ä¼˜ç‚¹</strong>ï¼š</p><ol><li>é¿å…é‡å¤åŠ è½½</li><li>ä¿è¯æ ¸å¿ƒç±»ï¼ˆå¦‚ <code>java.lang.*</code>ï¼‰å”¯ä¸€æ€§</li></ol></li><li><p><strong>ç¤ºæ„</strong>ï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Bootstrap -&gt; Extension -&gt; App -&gt; Custom</span><br></pre></td></tr></table></figure></li><li><p><strong>é¢è¯•æ‹“å±•</strong>ï¼š</p><ul><li>åŒäº²å§”æ´¾æ¨¡å‹æ˜¯ä¿è¯ JVM æ ¸å¿ƒç±»å®‰å…¨çš„é‡è¦æœºåˆ¶</li></ul></li></ul><hr><h2 id="6-å¦‚ä½•æ‰“ç ´åŒäº²å§”æ´¾ï¼Ÿ"><a href="#6-å¦‚ä½•æ‰“ç ´åŒäº²å§”æ´¾ï¼Ÿ" class="headerlink" title="6. å¦‚ä½•æ‰“ç ´åŒäº²å§”æ´¾ï¼Ÿ"></a><strong>6. å¦‚ä½•æ‰“ç ´åŒäº²å§”æ´¾ï¼Ÿ</strong></h2><ul><li>è‡ªå®šä¹‰ ClassLoader</li><li>åœ¨ <code>loadClass</code> ä¸­å…ˆåŠ è½½è‡ªå·±å®šä¹‰çš„ç±»ï¼Œå†å§”æ´¾çˆ¶ç±»ï¼ˆé€†å‘å§”æ´¾ï¼‰</li><li>æ³¨æ„ï¼šç ´ååŒäº²å§”æ´¾å¯èƒ½å¼•å‘ç±»å†²çªã€å†…å­˜æ³„æ¼</li></ul><hr><h2 id="7-ä»€ä¹ˆæ˜¯-SPIï¼ˆService-Provider-Interfaceï¼‰æœºåˆ¶ï¼Ÿ"><a href="#7-ä»€ä¹ˆæ˜¯-SPIï¼ˆService-Provider-Interfaceï¼‰æœºåˆ¶ï¼Ÿ" class="headerlink" title="7. ä»€ä¹ˆæ˜¯ SPIï¼ˆService Provider Interfaceï¼‰æœºåˆ¶ï¼Ÿ"></a><strong>7. ä»€ä¹ˆæ˜¯ SPIï¼ˆService Provider Interfaceï¼‰æœºåˆ¶ï¼Ÿ</strong></h2><ul><li><strong>æ¦‚å¿µ</strong>ï¼š<ul><li>Java æä¾›çš„ä¸€ç§æœåŠ¡å‘ç°æœºåˆ¶</li><li>é€šè¿‡æ¥å£ + é…ç½®æ–‡ä»¶ï¼ŒåŠ¨æ€åŠ è½½å®ç°ç±»</li></ul></li><li><strong>å®ç°</strong>ï¼š<ol><li>æ¥å£ <code>MyService</code></li><li>æ–‡ä»¶ <code>META-INF/services/com.example.MyService</code><ul><li>å†…å®¹ï¼šå®ç°ç±»å…¨é™å®šå</li></ul></li><li><code>ServiceLoader.load(MyService.class)</code> è‡ªåŠ¨åŠ è½½å®ç°ç±»</li></ol></li><li><strong>åº”ç”¨</strong>ï¼š<ul><li>JDBC é©±åŠ¨åŠ è½½</li><li>Logging æ¡†æ¶ï¼ˆSLF4Jï¼‰</li></ul></li></ul><hr><h2 id="8-Java-æ˜¯å¦‚ä½•å®ç°è·¨å¹³å°çš„ï¼Ÿ"><a href="#8-Java-æ˜¯å¦‚ä½•å®ç°è·¨å¹³å°çš„ï¼Ÿ" class="headerlink" title="8. Java æ˜¯å¦‚ä½•å®ç°è·¨å¹³å°çš„ï¼Ÿ"></a><strong>8. Java æ˜¯å¦‚ä½•å®ç°è·¨å¹³å°çš„ï¼Ÿ</strong></h2><ul><li><strong>åŸç†</strong>ï¼š<ol><li>Java ä»£ç  -&gt; ç¼–è¯‘æˆ <strong>å­—èŠ‚ç ï¼ˆ.classï¼‰</strong></li><li>JVM è´Ÿè´£å­—èŠ‚ç è§£é‡Šæˆ–å³æ—¶ç¼–è¯‘ï¼ˆJITï¼‰æ‰§è¡Œ</li><li>JVM å°†å­—èŠ‚ç æ˜ å°„åˆ°ä¸åŒæ“ä½œç³»ç»Ÿå’Œ CPU</li></ol></li><li><strong>é¢è¯•æ‹“å±•</strong>ï¼š<ul><li>å­—èŠ‚ç éªŒè¯æœºåˆ¶ç¡®ä¿å®‰å…¨æ€§</li><li>HotSpot JIT æä¾›æœ¬åœ°ä¼˜åŒ–</li></ul></li></ul><hr><h2 id="9-JITï¼ˆå³æ—¶ç¼–è¯‘å™¨ï¼‰ä¼˜åŒ–äº†å“ªäº›ä¸œè¥¿ï¼Ÿ"><a href="#9-JITï¼ˆå³æ—¶ç¼–è¯‘å™¨ï¼‰ä¼˜åŒ–äº†å“ªäº›ä¸œè¥¿ï¼Ÿ" class="headerlink" title="9. JITï¼ˆå³æ—¶ç¼–è¯‘å™¨ï¼‰ä¼˜åŒ–äº†å“ªäº›ä¸œè¥¿ï¼Ÿ"></a><strong>9. JITï¼ˆå³æ—¶ç¼–è¯‘å™¨ï¼‰ä¼˜åŒ–äº†å“ªäº›ä¸œè¥¿ï¼Ÿ</strong></h2><ul><li><strong>JITï¼ˆJust-In-Time Compilerï¼‰</strong>ï¼š<ul><li>å°†çƒ­ç‚¹å­—èŠ‚ç åŠ¨æ€ç¼–è¯‘æˆæœ¬åœ°æœºå™¨ç </li></ul></li><li><strong>ä¼˜åŒ–ç­–ç•¥</strong>ï¼š<ol><li><strong>æ–¹æ³•å†…è”</strong>ï¼šå‡å°‘æ–¹æ³•è°ƒç”¨å¼€é”€</li><li><strong>å¾ªç¯ä¼˜åŒ–</strong>ï¼šæ¶ˆé™¤å†—ä½™è®¡ç®—</li><li><strong>é€ƒé€¸åˆ†æ</strong>ï¼šæ ˆä¸Šåˆ†é…å¯¹è±¡</li><li><strong>é”æ¶ˆé™¤&#x2F;é”ç²—åŒ–</strong>ï¼šå‡å°‘é”å¼€é”€</li><li><strong>æŒ‡ä»¤é‡æ’åºä¼˜åŒ–</strong></li></ol></li></ul><hr><h2 id="10-ä»€ä¹ˆæ˜¯é€ƒé€¸åˆ†æï¼Ÿ"><a href="#10-ä»€ä¹ˆæ˜¯é€ƒé€¸åˆ†æï¼Ÿ" class="headerlink" title="10. ä»€ä¹ˆæ˜¯é€ƒé€¸åˆ†æï¼Ÿ"></a><strong>10. ä»€ä¹ˆæ˜¯é€ƒé€¸åˆ†æï¼Ÿ</strong></h2><ul><li><strong>æ¦‚å¿µ</strong>ï¼š<ul><li>åˆ†æå¯¹è±¡çš„å¼•ç”¨èŒƒå›´</li><li>åˆ¤æ–­å¯¹è±¡æ˜¯å¦â€œé€ƒé€¸â€å‡ºæ–¹æ³•æˆ–çº¿ç¨‹</li></ul></li><li><strong>ä¼˜åŒ–åº”ç”¨</strong>ï¼š<ol><li><strong>æ ˆä¸Šåˆ†é…</strong>ï¼šå¯¹è±¡ä¸é€ƒé€¸å¯ä»¥ç›´æ¥åˆ†é…åœ¨æ ˆä¸Š</li><li><strong>æ ‡é‡æ›¿æ¢</strong>ï¼šå°†å¯¹è±¡æ‹†è§£ä¸ºåŸºæœ¬ç±»å‹ï¼Œæé«˜ç¼“å­˜å‘½ä¸­</li><li><strong>é”æ¶ˆé™¤</strong>ï¼šå¯¹è±¡ä¸é€ƒé€¸ï¼Œsynchronized å¯è¢«æ¶ˆé™¤</li></ol></li><li><strong>é¢è¯•æ‹“å±•</strong>ï¼š<ul><li>JIT ç»“åˆé€ƒé€¸åˆ†æå¯æ˜¾è‘—æå‡æ€§èƒ½</li><li>é€‚ç”¨äºçŸ­ç”Ÿå‘½å‘¨æœŸå¯¹è±¡</li></ul></li></ul><hr><h3 id="å…«ã€å¸¸è§åœºæ™¯-è®¾è®¡"><a href="#å…«ã€å¸¸è§åœºæ™¯-è®¾è®¡" class="headerlink" title="å…«ã€å¸¸è§åœºæ™¯ &amp; è®¾è®¡"></a>å…«ã€å¸¸è§åœºæ™¯ &amp; è®¾è®¡</h3><hr><h2 id="1-å•ä¾‹æ¨¡å¼åœ¨-Java-ä¸­æœ‰å“ªäº›å®ç°æ–¹å¼ï¼Ÿå“ªç§æœ€ä¼˜ï¼Ÿ"><a href="#1-å•ä¾‹æ¨¡å¼åœ¨-Java-ä¸­æœ‰å“ªäº›å®ç°æ–¹å¼ï¼Ÿå“ªç§æœ€ä¼˜ï¼Ÿ" class="headerlink" title="1. å•ä¾‹æ¨¡å¼åœ¨ Java ä¸­æœ‰å“ªäº›å®ç°æ–¹å¼ï¼Ÿå“ªç§æœ€ä¼˜ï¼Ÿ"></a><strong>1. å•ä¾‹æ¨¡å¼åœ¨ Java ä¸­æœ‰å“ªäº›å®ç°æ–¹å¼ï¼Ÿå“ªç§æœ€ä¼˜ï¼Ÿ</strong></h2><ul><li><p><strong>å¸¸è§å®ç°æ–¹å¼</strong>ï¼š</p><ol><li><p><strong>é¥¿æ±‰å¼ï¼ˆé™æ€å¸¸é‡ï¼‰</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Singleton</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123; <span class="keyword">return</span> INSTANCE; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä¼˜ç‚¹ï¼šçº¿ç¨‹å®‰å…¨ï¼Œç®€å•</li><li>ç¼ºç‚¹ï¼šç±»åŠ è½½å³åˆå§‹åŒ–ï¼Œä¸æ”¯æŒå»¶è¿ŸåŠ è½½</li></ul></li><li><p><strong>æ‡’æ±‰å¼ï¼ˆåŠ é”ï¼‰</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton instance;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(instance == <span class="literal">null</span>) instance = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä¼˜ç‚¹ï¼šæ”¯æŒå»¶è¿ŸåŠ è½½</li><li>ç¼ºç‚¹ï¼šæ¯æ¬¡è®¿é—®éƒ½æœ‰åŒæ­¥å¼€é”€</li></ul></li><li><p><strong>åŒé‡æ£€æŸ¥é”ï¼ˆDouble-Checked Lockingï¼‰</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> Singleton instance;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(instance == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span>(Singleton.class) &#123;</span><br><span class="line">                <span class="keyword">if</span>(instance == <span class="literal">null</span>) instance = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä¼˜ç‚¹ï¼šçº¿ç¨‹å®‰å…¨ + å»¶è¿ŸåŠ è½½ + é«˜æ€§èƒ½</li><li><strong>æ¨è</strong></li></ul></li><li><p><strong>é™æ€å†…éƒ¨ç±»</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Holder</span> &#123; <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Singleton</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Singleton</span>(); &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123; <span class="keyword">return</span> Holder.INSTANCE; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åŸç†ï¼šJVM ä¿è¯ç±»åŠ è½½çº¿ç¨‹å®‰å…¨</li><li>ä¼˜ç‚¹ï¼šæ‡’åŠ è½½ + é«˜æ€§èƒ½</li><li><strong>æœ€ä½³å®è·µä¹‹ä¸€</strong></li></ul></li><li><p><strong>æšä¸¾å•ä¾‹</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Singleton</span> &#123; INSTANCE; &#125;</span><br></pre></td></tr></table></figure><ul><li>åŸç†ï¼šJVM ä¿è¯æšä¸¾ç±»å‹å•ä¾‹</li><li>ä¼˜ç‚¹ï¼šçº¿ç¨‹å®‰å…¨ã€é˜²æ­¢åå°„å’Œåºåˆ—åŒ–ç ´å</li><li><strong>æœ€ä½³å®è·µ</strong></li></ul></li></ol></li></ul><hr><h2 id="2-æ‡’æ±‰æ¨¡å¼å’Œé¥¿æ±‰æ¨¡å¼çš„åŒºåˆ«"><a href="#2-æ‡’æ±‰æ¨¡å¼å’Œé¥¿æ±‰æ¨¡å¼çš„åŒºåˆ«" class="headerlink" title="2. æ‡’æ±‰æ¨¡å¼å’Œé¥¿æ±‰æ¨¡å¼çš„åŒºåˆ«"></a><strong>2. æ‡’æ±‰æ¨¡å¼å’Œé¥¿æ±‰æ¨¡å¼çš„åŒºåˆ«</strong></h2><table><thead><tr><th>ç‰¹æ€§</th><th>æ‡’æ±‰æ¨¡å¼</th><th>é¥¿æ±‰æ¨¡å¼</th></tr></thead><tbody><tr><td>åŠ è½½æ—¶æœº</td><td>å»¶è¿ŸåŠ è½½ï¼Œç¬¬ä¸€æ¬¡ä½¿ç”¨</td><td>ç±»åŠ è½½å³åˆå§‹åŒ–</td></tr><tr><td>çº¿ç¨‹å®‰å…¨</td><td>éœ€åŠ é”&#x2F;åŒé‡æ£€æŸ¥</td><td>å¤©ç„¶çº¿ç¨‹å®‰å…¨</td></tr><tr><td>æ€§èƒ½</td><td>å¤šçº¿ç¨‹åŒæ­¥æœ‰å¼€é”€</td><td>æ— é¢å¤–å¼€é”€</td></tr><tr><td>å†…å­˜ä½¿ç”¨</td><td>æŒ‰éœ€åˆ†é…</td><td>ç±»åŠ è½½æ—¶åˆ†é…</td></tr></tbody></table><hr><h2 id="3-æšä¸¾å•ä¾‹ä¸ºä»€ä¹ˆæ˜¯æœ€ä½³å®è·µ"><a href="#3-æšä¸¾å•ä¾‹ä¸ºä»€ä¹ˆæ˜¯æœ€ä½³å®è·µ" class="headerlink" title="3. æšä¸¾å•ä¾‹ä¸ºä»€ä¹ˆæ˜¯æœ€ä½³å®è·µ"></a><strong>3. æšä¸¾å•ä¾‹ä¸ºä»€ä¹ˆæ˜¯æœ€ä½³å®è·µ</strong></h2><ul><li>JVM ä¿è¯æšä¸¾å®ä¾‹å”¯ä¸€æ€§</li><li><strong>é˜²æ­¢åå°„å’Œåºåˆ—åŒ–ç ´å</strong></li><li>å®ç°ç®€æ´ï¼Œæ— éœ€æ‰‹åŠ¨åŒæ­¥</li><li>é¢è¯•å¸¸è€ƒç‚¹ï¼šç›¸æ¯”åŒé‡æ£€æŸ¥é”æ›´å®‰å…¨</li></ul><hr><h2 id="4-ä¸ºä»€ä¹ˆè¦ç”¨å·¥å‚æ¨¡å¼ï¼Ÿ"><a href="#4-ä¸ºä»€ä¹ˆè¦ç”¨å·¥å‚æ¨¡å¼ï¼Ÿ" class="headerlink" title="4. ä¸ºä»€ä¹ˆè¦ç”¨å·¥å‚æ¨¡å¼ï¼Ÿ"></a><strong>4. ä¸ºä»€ä¹ˆè¦ç”¨å·¥å‚æ¨¡å¼ï¼Ÿ</strong></h2><ul><li><strong>ä½œç”¨</strong>ï¼š<ul><li>éšè—å¯¹è±¡åˆ›å»ºé€»è¾‘</li><li>è§£è€¦è°ƒç”¨æ–¹å’Œå®ç°ç±»</li></ul></li><li><strong>ç±»å‹</strong>ï¼š<ol><li><strong>ç®€å•å·¥å‚</strong>ï¼šé™æ€æ–¹æ³•è¿”å›å¯¹è±¡</li><li><strong>å·¥å‚æ–¹æ³•</strong>ï¼šå­ç±»å†³å®šåˆ›å»ºå“ªç§å¯¹è±¡</li><li><strong>æŠ½è±¡å·¥å‚</strong>ï¼šä¸€ç»„ç›¸å…³å¯¹è±¡çš„åˆ›å»º</li></ol></li><li><strong>ä¼˜åŠ¿</strong>ï¼š<ul><li>å¯æ‰©å±•æ€§é«˜</li><li>ç¬¦åˆå¼€é—­åŸåˆ™</li></ul></li></ul><hr><h2 id="5-è£…é¥°å™¨æ¨¡å¼å’Œä»£ç†æ¨¡å¼åŒºåˆ«"><a href="#5-è£…é¥°å™¨æ¨¡å¼å’Œä»£ç†æ¨¡å¼åŒºåˆ«" class="headerlink" title="5. è£…é¥°å™¨æ¨¡å¼å’Œä»£ç†æ¨¡å¼åŒºåˆ«"></a><strong>5. è£…é¥°å™¨æ¨¡å¼å’Œä»£ç†æ¨¡å¼åŒºåˆ«</strong></h2><table><thead><tr><th>ç‰¹æ€§</th><th>è£…é¥°å™¨æ¨¡å¼</th><th>ä»£ç†æ¨¡å¼</th></tr></thead><tbody><tr><td>ç›®çš„</td><td>åŠ¨æ€å¢å¼ºå¯¹è±¡åŠŸèƒ½</td><td>æ§åˆ¶å¯¹è±¡è®¿é—®</td></tr><tr><td>ç»“æ„</td><td>åŒ…è£…åŸå¯¹è±¡ï¼Œç»§æ‰¿æ¥å£</td><td>æŒæœ‰åŸå¯¹è±¡ï¼Œæ–¹æ³•å§”æ‰˜</td></tr><tr><td>åœºæ™¯</td><td>IO æµï¼ˆBufferedReaderï¼‰</td><td>è¿œç¨‹è°ƒç”¨ã€æƒé™æ§åˆ¶</td></tr><tr><td>åŠ¨æ€æ€§</td><td>é«˜</td><td>å¯ä»¥é€šè¿‡åŠ¨æ€ä»£ç†å®ç°</td></tr></tbody></table><hr><h2 id="6-Java-ä¸­çš„äº‹ä»¶ç›‘å¬æ¨¡å‹æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ"><a href="#6-Java-ä¸­çš„äº‹ä»¶ç›‘å¬æ¨¡å‹æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ" class="headerlink" title="6. Java ä¸­çš„äº‹ä»¶ç›‘å¬æ¨¡å‹æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ"></a><strong>6. Java ä¸­çš„äº‹ä»¶ç›‘å¬æ¨¡å‹æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ</strong></h2><ul><li><strong>æœºåˆ¶</strong>ï¼š<ol><li><strong>äº‹ä»¶æºï¼ˆEvent Sourceï¼‰</strong>ï¼šäº§ç”Ÿäº‹ä»¶</li><li><strong>äº‹ä»¶ç›‘å¬å™¨ï¼ˆListenerï¼‰</strong>ï¼šæ¥å£ï¼Œå®šä¹‰å›è°ƒæ–¹æ³•</li><li><strong>æ³¨å†Œä¸è§¦å‘</strong>ï¼šæºå¯¹è±¡ç»´æŠ¤ç›‘å¬å™¨åˆ—è¡¨ï¼Œäº‹ä»¶å‘ç”Ÿæ—¶é€šçŸ¥ç›‘å¬å™¨</li></ol></li><li><strong>å…¸å‹åº”ç”¨</strong>ï¼š<ul><li>Swing&#x2F;AWT äº‹ä»¶</li><li>Spring ApplicationEvent</li></ul></li></ul><hr><h2 id="7-ä¸ºä»€ä¹ˆ-Java-ä¸æ”¯æŒå¤šç»§æ‰¿ï¼Ÿ"><a href="#7-ä¸ºä»€ä¹ˆ-Java-ä¸æ”¯æŒå¤šç»§æ‰¿ï¼Ÿ" class="headerlink" title="7. ä¸ºä»€ä¹ˆ Java ä¸æ”¯æŒå¤šç»§æ‰¿ï¼Ÿ"></a><strong>7. ä¸ºä»€ä¹ˆ Java ä¸æ”¯æŒå¤šç»§æ‰¿ï¼Ÿ</strong></h2><ul><li><strong>åŸå› </strong>ï¼š<ul><li>é¿å… <strong>é’»çŸ³é—®é¢˜</strong>ï¼ˆå¤šç»§æ‰¿äº§ç”Ÿæ–¹æ³•å†²çªï¼‰</li><li>ç®€åŒ–å¯¹è±¡æ¨¡å‹ï¼Œä¿è¯ JVM ç±»å‹å®‰å…¨</li></ul></li><li><strong>æ›¿ä»£æ–¹æ¡ˆ</strong>ï¼š<ul><li>æ¥å£å¤šç»§æ‰¿ + é»˜è®¤æ–¹æ³•ï¼ˆJava 8+ï¼‰</li><li>ç»„åˆè®¾è®¡æ¨¡å¼ï¼ˆä¼˜å…ˆä½¿ç”¨ has-a è€Œä¸æ˜¯ is-aï¼‰</li></ul></li></ul><hr><h2 id="8-å¦‚ä½•ç”¨-Java-å®ç°å›è°ƒæœºåˆ¶ï¼Ÿ"><a href="#8-å¦‚ä½•ç”¨-Java-å®ç°å›è°ƒæœºåˆ¶ï¼Ÿ" class="headerlink" title="8. å¦‚ä½•ç”¨ Java å®ç°å›è°ƒæœºåˆ¶ï¼Ÿ"></a><strong>8. å¦‚ä½•ç”¨ Java å®ç°å›è°ƒæœºåˆ¶ï¼Ÿ</strong></h2><ul><li><p><strong>åŸç†</strong>ï¼š</p><ul><li>å°†å‡½æ•°å°è£…æˆå¯¹è±¡æˆ–æ¥å£ä¼ é€’ç»™å¦ä¸€ä¸ªå¯¹è±¡</li><li>ç”±è¢«è°ƒç”¨å¯¹è±¡åœ¨åˆé€‚æ—¶æœºè°ƒç”¨æ¥å£æ–¹æ³•</li></ul></li><li><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Callback</span> &#123; <span class="keyword">void</span> <span class="title function_">onDone</span><span class="params">(String result)</span>; &#125;</span><br><span class="line"><span class="keyword">void</span> <span class="title function_">asyncProcess</span><span class="params">(Callback callback)</span> &#123; <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; callback.onDone(<span class="string">&quot;ok&quot;</span>)).start(); &#125;</span><br></pre></td></tr></table></figure></li></ul><hr><h2 id="9-Java-ä¸­å¦‚ä½•å®ç°è§‚å¯Ÿè€…æ¨¡å¼ï¼Ÿ"><a href="#9-Java-ä¸­å¦‚ä½•å®ç°è§‚å¯Ÿè€…æ¨¡å¼ï¼Ÿ" class="headerlink" title="9. Java ä¸­å¦‚ä½•å®ç°è§‚å¯Ÿè€…æ¨¡å¼ï¼Ÿ"></a><strong>9. Java ä¸­å¦‚ä½•å®ç°è§‚å¯Ÿè€…æ¨¡å¼ï¼Ÿ</strong></h2><ul><li><p><strong>æœºåˆ¶</strong>ï¼š</p><ol><li><strong>Subjectï¼ˆè¢«è§‚å¯Ÿè€…ï¼‰</strong>ï¼šç»´æŠ¤è§‚å¯Ÿè€…åˆ—è¡¨ï¼Œæä¾›æ³¨å†Œ&#x2F;æ³¨é”€æ–¹æ³•</li><li><strong>Observerï¼ˆè§‚å¯Ÿè€…ï¼‰</strong>ï¼šæ¥å£ï¼Œå®šä¹‰ update æ–¹æ³•</li><li><strong>è§¦å‘äº‹ä»¶</strong>ï¼šSubject çŠ¶æ€å˜åŒ–æ—¶è°ƒç”¨æ‰€æœ‰ Observer çš„ update</li></ol></li><li><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Observer</span> &#123; <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(String msg)</span>; &#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Subject</span> &#123;</span><br><span class="line">    List&lt;Observer&gt; observers = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">addObserver</span><span class="params">(Observer o)</span> &#123; observers.add(o); &#125;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">notifyAllObservers</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">        observers.forEach(o -&gt; o.update(msg));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><hr><h2 id="10-Optional-çš„è®¾è®¡åˆè¡·æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#10-Optional-çš„è®¾è®¡åˆè¡·æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="10. Optional çš„è®¾è®¡åˆè¡·æ˜¯ä»€ä¹ˆï¼Ÿ"></a><strong>10. Optional çš„è®¾è®¡åˆè¡·æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h2><ul><li><p><strong>ç›®çš„</strong>ï¼š</p><ul><li>é¿å… null å€¼å¯¼è‡´çš„ <strong>NullPointerException</strong></li><li>æä¾›å‡½æ•°å¼ APIï¼Œæé«˜å¯è¯»æ€§</li></ul></li><li><p><strong>ä½¿ç”¨æ–¹å¼</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Optional&lt;String&gt; optional = Optional.ofNullable(getValue());</span><br><span class="line">optional.ifPresent(System.out::println);</span><br><span class="line"><span class="type">String</span> <span class="variable">val</span> <span class="operator">=</span> optional.orElse(<span class="string">&quot;default&quot;</span>);</span><br></pre></td></tr></table></figure></li><li><p><strong>ä¼˜åŠ¿</strong>ï¼š</p><ul><li>æ˜¾ç¤ºå¤„ç†ç¼ºå¤±å€¼</li><li>æ”¯æŒé“¾å¼è°ƒç”¨ã€å‡½æ•°å¼é£æ ¼</li></ul></li><li><p><strong>é¢è¯•æ‹“å±•</strong>ï¼š</p><ul><li>Optional ä¸é€‚åˆç”¨äºé›†åˆå±æ€§ï¼Œé¿å…æ»¥ç”¨</li></ul></li></ul><hr><h2 id="äºŒã€Java-å¹¶å‘ç¼–ç¨‹ï¼ˆ30é¢˜ï¼‰"><a href="#äºŒã€Java-å¹¶å‘ç¼–ç¨‹ï¼ˆ30é¢˜ï¼‰" class="headerlink" title="äºŒã€Java å¹¶å‘ç¼–ç¨‹ï¼ˆ30é¢˜ï¼‰"></a>äºŒã€Java å¹¶å‘ç¼–ç¨‹ï¼ˆ30é¢˜ï¼‰</h2><hr><h2 id="1-çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#1-çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="1. çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ"></a><strong>1. çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ</strong></h2><ul><li><strong>çŠ¶æ€</strong>ï¼š<ol><li><strong>NEW</strong>ï¼šåˆ›å»ºåï¼Œæœªè°ƒç”¨ <code>start()</code></li><li><strong>RUNNABLE</strong>ï¼šè°ƒç”¨ <code>start()</code>ï¼Œå¯è¿è¡Œï¼ˆçº¿ç¨‹è°ƒåº¦å™¨å†³å®šä½•æ—¶æ‰§è¡Œï¼‰</li><li><strong>BLOCKED</strong>ï¼šç­‰å¾…é”</li><li><strong>WAITING</strong>ï¼šæ— é™æœŸç­‰å¾…ï¼ˆ<code>Object.wait()</code> &#x2F; <code>LockSupport.park()</code>ï¼‰</li><li><strong>TIMED_WAITING</strong>ï¼šè¶…æ—¶ç­‰å¾…ï¼ˆ<code>sleep()</code>, <code>join(timeout)</code>ï¼‰</li><li><strong>TERMINATED</strong>ï¼šæ‰§è¡Œå®Œæ¯•</li></ol></li></ul><hr><h2 id="2-åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼"><a href="#2-åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼" class="headerlink" title="2. åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼"></a><strong>2. åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼</strong></h2><ol><li><strong>ç»§æ‰¿ Thread ç±»</strong></li><li><strong>å®ç° Runnable æ¥å£</strong></li><li><strong>å®ç° Callable + FutureTask</strong></li><li><strong>çº¿ç¨‹æ± ï¼ˆæ¨èï¼‰</strong></li></ol><hr><h2 id="3-Runnable-å’Œ-Callable-åŒºåˆ«"><a href="#3-Runnable-å’Œ-Callable-åŒºåˆ«" class="headerlink" title="3. Runnable å’Œ Callable åŒºåˆ«"></a><strong>3. Runnable å’Œ Callable åŒºåˆ«</strong></h2><table><thead><tr><th>ç‰¹æ€§</th><th>Runnable</th><th>Callable</th></tr></thead><tbody><tr><td>è¿”å›å€¼</td><td>æ— </td><td>å¯ä»¥æœ‰è¿”å›å€¼</td></tr><tr><td>å¼‚å¸¸</td><td>ä¸å¯æŠ›å‡ºæ£€æŸ¥å¼‚å¸¸</td><td>å¯ä»¥æŠ›å‡ºå¼‚å¸¸</td></tr><tr><td>æ‰§è¡Œæ–¹å¼</td><td>new Thread(runnable)</td><td>ExecutorService.submit(callable)</td></tr></tbody></table><hr><h2 id="4-Future-å’Œ-CompletableFuture-åŒºåˆ«"><a href="#4-Future-å’Œ-CompletableFuture-åŒºåˆ«" class="headerlink" title="4. Future å’Œ CompletableFuture åŒºåˆ«"></a><strong>4. Future å’Œ CompletableFuture åŒºåˆ«</strong></h2><ul><li><strong>Future</strong>ï¼š<ul><li>é˜»å¡å¼è·å–ç»“æœ</li><li>ä¸æ”¯æŒé“¾å¼å¼‚æ­¥å¤„ç†</li></ul></li><li><strong>CompletableFuture</strong>ï¼š<ul><li>æ”¯æŒé“¾å¼å¼‚æ­¥å¤„ç†ï¼ˆthenApply, thenCombine, exceptionallyï¼‰</li><li>å¯ç»„åˆå¤šä¸ªå¼‚æ­¥ä»»åŠ¡</li></ul></li></ul><hr><h2 id="5-ThreadLocal-åŸç†"><a href="#5-ThreadLocal-åŸç†" class="headerlink" title="5. ThreadLocal åŸç†"></a><strong>5. ThreadLocal åŸç†</strong></h2><ul><li>æ¯ä¸ªçº¿ç¨‹æŒæœ‰ä¸€ä¸ª <strong>ThreadLocalMap</strong></li><li>key æ˜¯ <strong>ThreadLocal å¯¹è±¡</strong>ï¼Œvalue æ˜¯çº¿ç¨‹ç§æœ‰å˜é‡</li><li>å†…å­˜æ³„æ¼é£é™©ï¼š<ul><li>ThreadLocal å¼±å¼•ç”¨è¢« GCï¼Œvalue æ²¡æœ‰è¢«å›æ”¶</li></ul></li><li>è§£å†³æ–¹æ³•ï¼š<ul><li>ä½¿ç”¨ <code>remove()</code> æ¸…ç†</li></ul></li></ul><hr><h2 id="6-synchronized-çš„é”ä¼˜åŒ–æœºåˆ¶"><a href="#6-synchronized-çš„é”ä¼˜åŒ–æœºåˆ¶" class="headerlink" title="6. synchronized çš„é”ä¼˜åŒ–æœºåˆ¶"></a><strong>6. synchronized çš„é”ä¼˜åŒ–æœºåˆ¶</strong></h2><ol><li><strong>åå‘é”</strong>ï¼šå‡å°‘æ— ç«äº‰å¼€é”€</li><li><strong>è½»é‡çº§é”</strong>ï¼šCAS + è‡ªæ—‹</li><li><strong>é‡é‡çº§é”</strong>ï¼šMonitor é˜»å¡çº¿ç¨‹</li><li><strong>é”æ¶ˆé™¤&#x2F;é”ç²—åŒ–</strong>ï¼šJIT ä¼˜åŒ–</li></ol><hr><h2 id="7-ReentrantLock-å®ç°åŸç†"><a href="#7-ReentrantLock-å®ç°åŸç†" class="headerlink" title="7. ReentrantLock å®ç°åŸç†"></a><strong>7. ReentrantLock å®ç°åŸç†</strong></h2><ul><li>åŸºäº <strong>AQSï¼ˆAbstractQueuedSynchronizerï¼‰</strong></li><li>å†…éƒ¨ç»´æŠ¤ä¸€ä¸ª <strong>state</strong> è¡¨ç¤ºé”çŠ¶æ€</li><li>é˜Ÿåˆ— FIFO ç®¡ç†ç­‰å¾…çº¿ç¨‹</li><li>æ”¯æŒå…¬å¹³é”&#x2F;éå…¬å¹³é”</li></ul><hr><h2 id="8-å…¬å¹³é”å’Œéå…¬å¹³é”åŒºåˆ«"><a href="#8-å…¬å¹³é”å’Œéå…¬å¹³é”åŒºåˆ«" class="headerlink" title="8. å…¬å¹³é”å’Œéå…¬å¹³é”åŒºåˆ«"></a><strong>8. å…¬å¹³é”å’Œéå…¬å¹³é”åŒºåˆ«</strong></h2><table><thead><tr><th>ç‰¹æ€§</th><th>å…¬å¹³é”</th><th>éå…¬å¹³é”</th></tr></thead><tbody><tr><td>åŠ é”é¡ºåº</td><td>FIFO</td><td>ä¸ä¿è¯</td></tr><tr><td>æ€§èƒ½</td><td>ä½</td><td>é«˜ï¼ˆçº¿ç¨‹äº‰æŠ¢ï¼‰</td></tr><tr><td>åœºæ™¯</td><td>é¿å…é¥¥é¥¿</td><td>é«˜æ€§èƒ½é”åœºæ™¯</td></tr></tbody></table><hr><h2 id="9-ä¹è§‚é”å’Œæ‚²è§‚é”åŒºåˆ«"><a href="#9-ä¹è§‚é”å’Œæ‚²è§‚é”åŒºåˆ«" class="headerlink" title="9. ä¹è§‚é”å’Œæ‚²è§‚é”åŒºåˆ«"></a><strong>9. ä¹è§‚é”å’Œæ‚²è§‚é”åŒºåˆ«</strong></h2><ul><li><strong>æ‚²è§‚é”</strong>ï¼šå‡è®¾ä¼šå‘ç”Ÿå†²çªï¼Œç›´æ¥åŠ é”ï¼ˆå¦‚ synchronized &#x2F; ReentrantLockï¼‰</li><li><strong>ä¹è§‚é”</strong>ï¼šå‡è®¾å†²çªå°‘ï¼Œä½¿ç”¨ CASï¼ˆå¦‚ Atomic ç±»ï¼‰</li></ul><hr><h2 id="10-AQS-åŸç†"><a href="#10-AQS-åŸç†" class="headerlink" title="10. AQS åŸç†"></a><strong>10. AQS åŸç†</strong></h2><ul><li><strong>æ ¸å¿ƒ</strong>ï¼šstate + CLH é˜Ÿåˆ—</li><li><strong>ç‰¹æ€§</strong>ï¼š<ul><li>ç‹¬å æ¨¡å¼ &#x2F; å…±äº«æ¨¡å¼</li><li>åŸºäº FIFO é˜Ÿåˆ—ç®¡ç†ç­‰å¾…çº¿ç¨‹</li></ul></li><li><strong>åº”ç”¨</strong>ï¼š<ul><li>ReentrantLockã€Semaphoreã€CountDownLatchã€FutureTask</li></ul></li></ul><hr><h2 id="11-CountDownLatch-å’Œ-CyclicBarrier-åŒºåˆ«"><a href="#11-CountDownLatch-å’Œ-CyclicBarrier-åŒºåˆ«" class="headerlink" title="11. CountDownLatch å’Œ CyclicBarrier åŒºåˆ«"></a><strong>11. CountDownLatch å’Œ CyclicBarrier åŒºåˆ«</strong></h2><table><thead><tr><th>ç‰¹æ€§</th><th>CountDownLatch</th><th>CyclicBarrier</th></tr></thead><tbody><tr><td>ä½¿ç”¨æ¬¡æ•°</td><td>ä¸€æ¬¡æ€§</td><td>å¯é‡å¤ä½¿ç”¨</td></tr><tr><td>åŠŸèƒ½</td><td>ç­‰å¾…çº¿ç¨‹å®Œæˆ</td><td>ç­‰å¾…çº¿ç¨‹åˆ°è¾¾åŒä¸€ç‚¹</td></tr><tr><td>åœºæ™¯</td><td>çº¿ç¨‹ç»“æŸåŒæ­¥</td><td>å¤šçº¿ç¨‹å¹¶è¡Œåˆ†æ®µ</td></tr></tbody></table><hr><h2 id="12-Semaphore-çš„å®ç°åŸç†"><a href="#12-Semaphore-çš„å®ç°åŸç†" class="headerlink" title="12. Semaphore çš„å®ç°åŸç†"></a><strong>12. Semaphore çš„å®ç°åŸç†</strong></h2><ul><li>æ§åˆ¶å¹¶å‘çº¿ç¨‹æ•°é‡</li><li>åŸºäº AQS çš„å…±äº«é”</li><li>acquire() è·å–è®¸å¯ï¼Œrelease() é‡Šæ”¾è®¸å¯</li></ul><hr><h2 id="13-Exchanger-çš„ä½¿ç”¨åœºæ™¯"><a href="#13-Exchanger-çš„ä½¿ç”¨åœºæ™¯" class="headerlink" title="13. Exchanger çš„ä½¿ç”¨åœºæ™¯"></a><strong>13. Exchanger çš„ä½¿ç”¨åœºæ™¯</strong></h2><ul><li>ä¸¤ä¸ªçº¿ç¨‹äº¤æ¢æ•°æ®</li><li>å…¸å‹åœºæ™¯ï¼šç”Ÿäº§è€…-æ¶ˆè´¹è€…çº¿ç¨‹äº¤æ¢ç¼“å†²åŒº</li></ul><hr><h2 id="14-ForkJoinPool-çš„åŸç†"><a href="#14-ForkJoinPool-çš„åŸç†" class="headerlink" title="14. ForkJoinPool çš„åŸç†"></a><strong>14. ForkJoinPool çš„åŸç†</strong></h2><ul><li><strong>å·¥ä½œçªƒå–ç®—æ³•</strong>ï¼š<ul><li>ç©ºé—²çº¿ç¨‹ä»å…¶ä»–çº¿ç¨‹é˜Ÿåˆ—ä¸­çªƒå–ä»»åŠ¡</li></ul></li><li>é€‚åˆ <strong>é€’å½’ä»»åŠ¡</strong></li><li>é€šè¿‡ <strong>ForkJoinTask</strong> é€’å½’æ‹†åˆ†è®¡ç®—</li></ul><hr><h2 id="15-CAS-æ“ä½œçš„åº•å±‚å®ç°"><a href="#15-CAS-æ“ä½œçš„åº•å±‚å®ç°" class="headerlink" title="15. CAS æ“ä½œçš„åº•å±‚å®ç°"></a><strong>15. CAS æ“ä½œçš„åº•å±‚å®ç°</strong></h2><ul><li>åŸºäº CPU <strong>åŸå­æŒ‡ä»¤ï¼ˆCMPXCHGï¼‰</strong></li><li>JVM <code>Unsafe</code> æä¾›æ”¯æŒ</li><li><strong>ä¼˜ç‚¹</strong>ï¼šæ— é”ã€çº¿ç¨‹å®‰å…¨</li><li><strong>ç¼ºç‚¹</strong>ï¼šABA é—®é¢˜</li></ul><hr><h2 id="16-ABA-é—®é¢˜åŠè§£å†³"><a href="#16-ABA-é—®é¢˜åŠè§£å†³" class="headerlink" title="16. ABA é—®é¢˜åŠè§£å†³"></a><strong>16. ABA é—®é¢˜åŠè§£å†³</strong></h2><ul><li><strong>é—®é¢˜</strong>ï¼šå€¼å…ˆ A â†’ B â†’ Aï¼ŒCAS æ— æ³•åˆ¤æ–­å˜åŒ–</li><li><strong>è§£å†³</strong>ï¼š<ul><li>ç‰ˆæœ¬å·æœºåˆ¶ï¼ˆAtomicStampedReferenceï¼‰</li><li>åŒé‡æ£€æŸ¥</li></ul></li></ul><hr><h2 id="17-Atomic-åŸå­ç±»åŸç†"><a href="#17-Atomic-åŸå­ç±»åŸç†" class="headerlink" title="17. Atomic åŸå­ç±»åŸç†"></a><strong>17. Atomic åŸå­ç±»åŸç†</strong></h2><ul><li>åŸºäº <strong>CAS + Unsafe + volatile</strong></li><li>å®ç°éé˜»å¡çº¿ç¨‹å®‰å…¨</li><li>ç¤ºä¾‹ï¼š<code>AtomicInteger</code> ä½¿ç”¨ <code>compareAndSwapInt</code></li></ul><hr><h2 id="18-BlockingQueue-å®ç°åŸç†"><a href="#18-BlockingQueue-å®ç°åŸç†" class="headerlink" title="18. BlockingQueue å®ç°åŸç†"></a><strong>18. BlockingQueue å®ç°åŸç†</strong></h2><ul><li>å†…éƒ¨ç»´æŠ¤ <strong>é” + æ¡ä»¶é˜Ÿåˆ—</strong></li><li>put é˜»å¡æ»¡é˜Ÿåˆ—ï¼Œtake é˜»å¡ç©ºé˜Ÿåˆ—</li><li>å¸¸ç”¨å®ç°ï¼š<ul><li>ArrayBlockingQueueï¼ˆæ•°ç»„ + ReentrantLockï¼‰</li><li>LinkedBlockingQueueï¼ˆé“¾è¡¨ + ReentrantLockï¼‰</li></ul></li></ul><hr><h2 id="19-ConcurrentHashMap-çš„åˆ†æ®µé”æœºåˆ¶"><a href="#19-ConcurrentHashMap-çš„åˆ†æ®µé”æœºåˆ¶" class="headerlink" title="19. ConcurrentHashMap çš„åˆ†æ®µé”æœºåˆ¶"></a><strong>19. ConcurrentHashMap çš„åˆ†æ®µé”æœºåˆ¶</strong></h2><ul><li>JDK 1.7ï¼š<ul><li><strong>Segment[] + synchronized</strong></li></ul></li><li>JDK 1.8ï¼š<ul><li><strong>CAS + synchronized é“¾è¡¨ + çº¢é»‘æ ‘ + Node</strong></li></ul></li><li>æ”¯æŒé«˜å¹¶å‘è¯»å†™</li></ul><hr><h2 id="20-ConcurrentHashMap-æ‰©å®¹æœºåˆ¶"><a href="#20-ConcurrentHashMap-æ‰©å®¹æœºåˆ¶" class="headerlink" title="20. ConcurrentHashMap æ‰©å®¹æœºåˆ¶"></a><strong>20. ConcurrentHashMap æ‰©å®¹æœºåˆ¶</strong></h2><ul><li>é‡‡ç”¨ <strong>åˆ†æ®µæ‰©å®¹ + CAS</strong></li><li>é“¾è¡¨è½¬çº¢é»‘æ ‘æé«˜æŸ¥æ‰¾æ€§èƒ½</li><li>æ‰©å®¹è¿‡ç¨‹ä¸­ä½¿ç”¨ <strong>è¿ç§»èŠ‚ç‚¹</strong></li></ul><hr><h2 id="21-CopyOnWriteArrayList-åŸç†"><a href="#21-CopyOnWriteArrayList-åŸç†" class="headerlink" title="21. CopyOnWriteArrayList åŸç†"></a><strong>21. CopyOnWriteArrayList åŸç†</strong></h2><ul><li>å†™æ—¶å¤åˆ¶ï¼š<ol><li>å†™æ“ä½œå¤åˆ¶æ•°ç»„</li><li>ä¿®æ”¹åæ›¿æ¢å¼•ç”¨</li></ol></li><li>é€‚åˆè¯»å¤šå†™å°‘åœºæ™¯</li></ul><hr><h2 id="22-çº¿ç¨‹æ± æ ¸å¿ƒå‚æ•°"><a href="#22-çº¿ç¨‹æ± æ ¸å¿ƒå‚æ•°" class="headerlink" title="22. çº¿ç¨‹æ± æ ¸å¿ƒå‚æ•°"></a><strong>22. çº¿ç¨‹æ± æ ¸å¿ƒå‚æ•°</strong></h2><table><thead><tr><th>å‚æ•°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>corePoolSize</td><td>æ ¸å¿ƒçº¿ç¨‹æ•°</td></tr><tr><td>maximumPoolSize</td><td>æœ€å¤§çº¿ç¨‹æ•°</td></tr><tr><td>keepAliveTime</td><td>éæ ¸å¿ƒçº¿ç¨‹å­˜æ´»æ—¶é—´</td></tr><tr><td>workQueue</td><td>ä»»åŠ¡é˜Ÿåˆ—</td></tr><tr><td>RejectedExecutionHandler</td><td>æ‹’ç»ç­–ç•¥</td></tr></tbody></table><hr><h2 id="23-çº¿ç¨‹æ± æ‹’ç»ç­–ç•¥"><a href="#23-çº¿ç¨‹æ± æ‹’ç»ç­–ç•¥" class="headerlink" title="23. çº¿ç¨‹æ± æ‹’ç»ç­–ç•¥"></a><strong>23. çº¿ç¨‹æ± æ‹’ç»ç­–ç•¥</strong></h2><ol><li>AbortPolicyï¼ˆé»˜è®¤ï¼ŒæŠ›å¼‚å¸¸ï¼‰</li><li>CallerRunsPolicyï¼ˆè°ƒç”¨çº¿ç¨‹æ‰§è¡Œï¼‰</li><li>DiscardPolicyï¼ˆä¸¢å¼ƒä»»åŠ¡ï¼‰</li><li>DiscardOldestPolicyï¼ˆä¸¢å¼ƒé˜Ÿåˆ—æœ€è€ä»»åŠ¡ï¼‰</li></ol><hr><h2 id="24-çº¿ç¨‹æ± å·¥ä½œæµç¨‹"><a href="#24-çº¿ç¨‹æ± å·¥ä½œæµç¨‹" class="headerlink" title="24. çº¿ç¨‹æ± å·¥ä½œæµç¨‹"></a><strong>24. çº¿ç¨‹æ± å·¥ä½œæµç¨‹</strong></h2><ol><li>æäº¤ä»»åŠ¡ â†’ æ”¾å…¥é˜Ÿåˆ—</li><li>æ ¸å¿ƒçº¿ç¨‹æœªæ»¡ â†’ åˆ›å»ºçº¿ç¨‹</li><li>é˜Ÿåˆ—æ»¡ â†’ åˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹</li><li>è¾¾åˆ°æœ€å¤§çº¿ç¨‹ â†’ è§¦å‘æ‹’ç»ç­–ç•¥</li></ol><hr><h2 id="25-ThreadPoolExecutor-vs-ScheduledThreadPoolExecutor"><a href="#25-ThreadPoolExecutor-vs-ScheduledThreadPoolExecutor" class="headerlink" title="25. ThreadPoolExecutor vs ScheduledThreadPoolExecutor"></a><strong>25. ThreadPoolExecutor vs ScheduledThreadPoolExecutor</strong></h2><table><thead><tr><th>ç‰¹æ€§</th><th>ThreadPoolExecutor</th><th>ScheduledThreadPoolExecutor</th></tr></thead><tbody><tr><td>åŠŸèƒ½</td><td>é€šç”¨çº¿ç¨‹æ± </td><td>æ”¯æŒå®šæ—¶ &#x2F; å‘¨æœŸä»»åŠ¡</td></tr><tr><td>é˜Ÿåˆ—</td><td>BlockingQueue</td><td>DelayQueue</td></tr><tr><td>åœºæ™¯</td><td>å¹¶å‘ä»»åŠ¡</td><td>å®šæ—¶ä»»åŠ¡</td></tr></tbody></table><hr><h2 id="26-ä¸ºä»€ä¹ˆä¸å»ºè®®ä½¿ç”¨-Executors-åˆ›å»ºçº¿ç¨‹æ± "><a href="#26-ä¸ºä»€ä¹ˆä¸å»ºè®®ä½¿ç”¨-Executors-åˆ›å»ºçº¿ç¨‹æ± " class="headerlink" title="26. ä¸ºä»€ä¹ˆä¸å»ºè®®ä½¿ç”¨ Executors åˆ›å»ºçº¿ç¨‹æ± "></a><strong>26. ä¸ºä»€ä¹ˆä¸å»ºè®®ä½¿ç”¨ Executors åˆ›å»ºçº¿ç¨‹æ± </strong></h2><ul><li>Executors ä¼šäº§ç”Ÿ <strong>æ— é™é˜Ÿåˆ—</strong>ï¼ˆå¦‚ newCachedThreadPoolï¼‰</li><li>å®¹æ˜“ <strong>OOM &#x2F; çº¿ç¨‹æ•°è¿‡å¤š</strong></li><li>æ¨èï¼šæ‰‹åŠ¨ä½¿ç”¨ <strong>ThreadPoolExecutor</strong> é…ç½®æ ¸å¿ƒå‚æ•°</li></ul><hr><h2 id="27-JMM-å†…å­˜å¯è§æ€§é—®é¢˜"><a href="#27-JMM-å†…å­˜å¯è§æ€§é—®é¢˜" class="headerlink" title="27. JMM å†…å­˜å¯è§æ€§é—®é¢˜"></a><strong>27. JMM å†…å­˜å¯è§æ€§é—®é¢˜</strong></h2><ul><li>å¤šçº¿ç¨‹è®¿é—®å…±äº«å˜é‡ï¼Œä¿®æ”¹ä¸ç«‹å³å¯è§</li><li><strong>è§£å†³æ–¹æ³•</strong>ï¼š<ul><li><code>volatile</code></li><li><code>synchronized</code> &#x2F; Lock</li></ul></li></ul><hr><h2 id="28-happens-before-è§„åˆ™"><a href="#28-happens-before-è§„åˆ™" class="headerlink" title="28. happens-before è§„åˆ™"></a><strong>28. happens-before è§„åˆ™</strong></h2><ul><li><strong>ä¿è¯æ“ä½œé¡ºåºä¸å¯è§æ€§</strong></li><li>å¸¸è§è§„åˆ™ï¼š<ol><li><strong>é”çš„è§£é” â†’ åŠ é”</strong></li><li><strong>volatile å†™ â†’ è¯»</strong></li><li><strong>çº¿ç¨‹ start() â†’ run()</strong></li><li><strong>çº¿ç¨‹ join() â†’ ç»“æŸ</strong></li></ol></li></ul><hr><h2 id="29-æ­»é”äº§ç”Ÿæ¡ä»¶åŠé¿å…"><a href="#29-æ­»é”äº§ç”Ÿæ¡ä»¶åŠé¿å…" class="headerlink" title="29. æ­»é”äº§ç”Ÿæ¡ä»¶åŠé¿å…"></a><strong>29. æ­»é”äº§ç”Ÿæ¡ä»¶åŠé¿å…</strong></h2><ul><li><strong>å››ä¸ªå¿…è¦æ¡ä»¶</strong>ï¼š<ol><li>äº’æ–¥</li><li>å æœ‰ä¸”ç­‰å¾…</li><li>ä¸å¯æŠ¢å </li><li>å¾ªç¯ç­‰å¾…</li></ol></li><li><strong>é¿å…æ–¹æ³•</strong>ï¼š<ul><li>é¿å…å¾ªç¯ç­‰å¾…ï¼ŒæŒ‰é¡ºåºåŠ é”</li><li>ä½¿ç”¨ tryLock + è¶…æ—¶</li><li>ä½¿ç”¨å•ä¸€é”</li></ul></li></ul><hr><h2 id="30-å¸¸è§å¹¶å‘å®¹å™¨åŠåŒºåˆ«"><a href="#30-å¸¸è§å¹¶å‘å®¹å™¨åŠåŒºåˆ«" class="headerlink" title="30. å¸¸è§å¹¶å‘å®¹å™¨åŠåŒºåˆ«"></a><strong>30. å¸¸è§å¹¶å‘å®¹å™¨åŠåŒºåˆ«</strong></h2><table><thead><tr><th>å®¹å™¨</th><th>ç‰¹æ€§</th></tr></thead><tbody><tr><td>ConcurrentHashMap</td><td>é«˜å¹¶å‘è¯»å†™ï¼Œåˆ†æ®µ&#x2F;é“¾è¡¨+çº¢é»‘æ ‘</td></tr><tr><td>CopyOnWriteArrayList</td><td>å†™æ—¶å¤åˆ¶ï¼Œè¯»å¤šå†™å°‘</td></tr><tr><td>ConcurrentLinkedQueue</td><td>éé˜»å¡</td></tr></tbody></table><p>é˜Ÿåˆ—ï¼ŒåŸºäº CAS |<br> | BlockingQueueï¼ˆArray&#x2F;Linkedï¼‰ | æ”¯æŒé˜»å¡ put&#x2F;take |<br> | ConcurrentSkipListMap | æœ‰åºï¼ŒåŸºäºè·³è¡¨ï¼Œçº¿ç¨‹å®‰å…¨ |</p><hr><h2 id="ä¸‰ã€JVM-ä¸æ€§èƒ½ä¼˜åŒ–ï¼ˆ30é¢˜ï¼‰"><a href="#ä¸‰ã€JVM-ä¸æ€§èƒ½ä¼˜åŒ–ï¼ˆ30é¢˜ï¼‰" class="headerlink" title="ä¸‰ã€JVM ä¸æ€§èƒ½ä¼˜åŒ–ï¼ˆ30é¢˜ï¼‰"></a>ä¸‰ã€JVM ä¸æ€§èƒ½ä¼˜åŒ–ï¼ˆ30é¢˜ï¼‰</h2><hr><h2 id="1-JVM-å†…å­˜ç»“æ„"><a href="#1-JVM-å†…å­˜ç»“æ„" class="headerlink" title="1. JVM å†…å­˜ç»“æ„"></a><strong>1. JVM å†…å­˜ç»“æ„</strong></h2><ul><li><strong>æ–¹æ³•åŒº &#x2F; å…ƒç©ºé—´ï¼ˆMetaspaceï¼‰</strong>ï¼šå­˜æ”¾ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡</li><li><strong>å †ï¼ˆHeapï¼‰</strong>ï¼šå¯¹è±¡å®ä¾‹ã€GC ç®¡ç†åŒº</li><li><strong>æ ˆï¼ˆStackï¼‰</strong>ï¼šæ–¹æ³•è°ƒç”¨ã€å±€éƒ¨å˜é‡</li><li><strong>ç¨‹åºè®¡æ•°å™¨ï¼ˆPCï¼‰</strong>ï¼šè®°å½•çº¿ç¨‹æ‰§è¡Œåœ°å€</li><li><strong>æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Stackï¼‰</strong>ï¼šæ‰§è¡Œ native æ–¹æ³•</li><li><strong>ç›´æ¥å†…å­˜ï¼ˆDirect Memoryï¼‰</strong>ï¼šå †å¤–å†…å­˜ï¼Œç”¨äº NIO</li></ul><hr><h2 id="2-å †å’Œæ ˆçš„åŒºåˆ«"><a href="#2-å †å’Œæ ˆçš„åŒºåˆ«" class="headerlink" title="2. å †å’Œæ ˆçš„åŒºåˆ«"></a><strong>2. å †å’Œæ ˆçš„åŒºåˆ«</strong></h2><table><thead><tr><th>ç‰¹æ€§</th><th>å †</th><th>æ ˆ</th></tr></thead><tbody><tr><td>å­˜å‚¨å†…å®¹</td><td>å¯¹è±¡å®ä¾‹</td><td>æ–¹æ³•è°ƒç”¨å¸§ã€å±€éƒ¨å˜é‡</td></tr><tr><td>ç”Ÿå‘½å‘¨æœŸ</td><td>GC ç®¡ç†</td><td>éšæ–¹æ³•ç»“æŸé‡Šæ”¾</td></tr><tr><td>çº¿ç¨‹å…±äº«</td><td>æ˜¯</td><td>å¦ï¼ˆçº¿ç¨‹ç§æœ‰ï¼‰</td></tr><tr><td>è®¿é—®é€Ÿåº¦</td><td>è¾ƒæ…¢</td><td>å¿«</td></tr><tr><td>å†…å­˜å¤§å°</td><td>å¤§</td><td>å°</td></tr></tbody></table><hr><h2 id="3-æ–°ç”Ÿä»£ã€è€å¹´ä»£ã€æ°¸ä¹…ä»£ï¼ˆå…ƒç©ºé—´ï¼‰çš„åŒºåˆ«"><a href="#3-æ–°ç”Ÿä»£ã€è€å¹´ä»£ã€æ°¸ä¹…ä»£ï¼ˆå…ƒç©ºé—´ï¼‰çš„åŒºåˆ«" class="headerlink" title="3. æ–°ç”Ÿä»£ã€è€å¹´ä»£ã€æ°¸ä¹…ä»£ï¼ˆå…ƒç©ºé—´ï¼‰çš„åŒºåˆ«"></a><strong>3. æ–°ç”Ÿä»£ã€è€å¹´ä»£ã€æ°¸ä¹…ä»£ï¼ˆå…ƒç©ºé—´ï¼‰çš„åŒºåˆ«</strong></h2><ul><li><strong>æ–°ç”Ÿä»£</strong>ï¼ˆYoung Generationï¼‰ï¼š<ul><li>å­˜æ”¾æ–°åˆ›å»ºå¯¹è±¡</li><li>åˆ†ä¸º Eden + 2 ä¸ª Survivor åŒº</li><li>Minor GC ä¸»è¦å‘ç”Ÿåœ¨æ­¤</li></ul></li><li><strong>è€å¹´ä»£</strong>ï¼ˆOld&#x2F;Tenured Generationï¼‰ï¼š<ul><li>é•¿å¯¿å‘½å¯¹è±¡</li><li>Full GC ä¸»è¦ä½œç”¨åŒºåŸŸ</li></ul></li><li><strong>æ°¸ä¹…ä»£ &#x2F; å…ƒç©ºé—´</strong>ï¼š<ul><li>å­˜æ”¾ç±»å…ƒæ•°æ®</li><li>Java 8+ ä½¿ç”¨ Metaspaceï¼ˆNative å†…å­˜ï¼‰</li></ul></li></ul><hr><h2 id="4-å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹"><a href="#4-å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹" class="headerlink" title="4. å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹"></a><strong>4. å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹</strong></h2><ol><li><strong>ç±»åŠ è½½æ£€æŸ¥</strong></li><li><strong>åˆ†é…å†…å­˜</strong>ï¼š<ul><li>å †ä¸Šåˆ†é…å¯¹è±¡ç©ºé—´ï¼ˆTLAB&#x2F;å¤§å¯¹è±¡ç›´æ¥åˆ†é…ï¼‰</li></ul></li><li><strong>åˆå§‹åŒ–é›¶å€¼</strong></li><li><strong>æ„é€ å™¨åˆå§‹åŒ–</strong></li><li><strong>å¼•ç”¨èµ‹å€¼</strong></li></ol><hr><h2 id="5-å¯¹è±¡çš„å†…å­˜åˆ†é…ç­–ç•¥"><a href="#5-å¯¹è±¡çš„å†…å­˜åˆ†é…ç­–ç•¥" class="headerlink" title="5. å¯¹è±¡çš„å†…å­˜åˆ†é…ç­–ç•¥"></a><strong>5. å¯¹è±¡çš„å†…å­˜åˆ†é…ç­–ç•¥</strong></h2><ul><li><strong>å¹´è½»ä»£åˆ†é…</strong>ï¼šTLABï¼ˆThread Local Allocation Bufferï¼‰</li><li><strong>å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£</strong>ï¼ˆå¦‚æ•°ç»„ &gt; 1MBï¼‰</li><li><strong>é•¿æœŸå­˜æ´»å¯¹è±¡æ™‹å‡åˆ°è€å¹´ä»£</strong></li><li><strong>æ ˆä¸Šåˆ†é…</strong>ï¼šé€šè¿‡é€ƒé€¸åˆ†æä¼˜åŒ–</li></ul><hr><h2 id="6-GC-Roots"><a href="#6-GC-Roots" class="headerlink" title="6. GC Roots"></a><strong>6. GC Roots</strong></h2><ul><li><strong>å¸¸è§ç±»å‹</strong>ï¼š<ul><li>æ ˆå¸§ä¸­çš„å¼•ç”¨å˜é‡</li><li>æ–¹æ³•åŒºé™æ€å˜é‡</li><li>å¸¸é‡å¼•ç”¨</li><li>æœ¬åœ°æ–¹æ³•æ ˆå¼•ç”¨</li></ul></li></ul><hr><h2 id="7-åƒåœ¾å›æ”¶ç®—æ³•"><a href="#7-åƒåœ¾å›æ”¶ç®—æ³•" class="headerlink" title="7. åƒåœ¾å›æ”¶ç®—æ³•"></a><strong>7. åƒåœ¾å›æ”¶ç®—æ³•</strong></h2><ul><li><strong>å¼•ç”¨è®¡æ•°</strong>ï¼ˆä¸å¯è§£å†³å¾ªç¯å¼•ç”¨ï¼‰</li><li><strong>å¯è¾¾æ€§åˆ†æ</strong>ï¼ˆGC Rootsï¼‰</li><li><strong>å…·ä½“å›æ”¶ç®—æ³•</strong>ï¼š<ul><li>æ ‡è®°-æ¸…é™¤</li><li>æ ‡è®°-æ•´ç†</li><li>å¤åˆ¶ç®—æ³•</li><li>åˆ†ä»£å›æ”¶</li></ul></li></ul><hr><h2 id="8-CMS-åƒåœ¾å›æ”¶å™¨æµç¨‹"><a href="#8-CMS-åƒåœ¾å›æ”¶å™¨æµç¨‹" class="headerlink" title="8. CMS åƒåœ¾å›æ”¶å™¨æµç¨‹"></a><strong>8. CMS åƒåœ¾å›æ”¶å™¨æµç¨‹</strong></h2><ol><li>åˆå§‹æ ‡è®°ï¼ˆStop-The-Worldï¼‰</li><li>å¹¶å‘æ ‡è®°ï¼ˆæ ‡è®°å¯å›æ”¶å¯¹è±¡ï¼‰</li><li>å¹¶å‘é¢„æ¸…ç†</li><li>é‡æ–°æ ‡è®°ï¼ˆStop-The-Worldï¼‰</li><li>å¹¶å‘æ¸…ç†ï¼ˆå›æ”¶è€å¹´ä»£ï¼‰</li></ol><ul><li><strong>ç‰¹ç‚¹</strong>ï¼šä½åœé¡¿ï¼Œä½†æœ‰æµ®åŠ¨åƒåœ¾å’Œå†…å­˜ç¢ç‰‡é—®é¢˜</li></ul><hr><h2 id="9-G1-åƒåœ¾å›æ”¶å™¨åŸç†"><a href="#9-G1-åƒåœ¾å›æ”¶å™¨åŸç†" class="headerlink" title="9. G1 åƒåœ¾å›æ”¶å™¨åŸç†"></a><strong>9. G1 åƒåœ¾å›æ”¶å™¨åŸç†</strong></h2><ul><li><strong>Regionï¼ˆåˆ†åŒºï¼‰ç®¡ç†å †</strong></li><li><strong>åˆ†ä»£+å¹¶è¡Œ+å¢é‡æ”¶é›†</strong></li><li><strong>åƒåœ¾å›æ”¶ç­–ç•¥</strong>ï¼š<ul><li>ä¼˜å…ˆå›æ”¶å›æ”¶æˆæœ¬ä½çš„ Region</li><li>å¹¶å‘æ ‡è®° + å¹¶è¡Œæ¸…ç†</li></ul></li><li><strong>ç›®æ ‡</strong>ï¼šæ§åˆ¶åœé¡¿æ—¶é—´</li><li><strong>ä¼˜åŠ¿</strong>ï¼šæ— ç¢ç‰‡ã€å¯é¢„æµ‹åœé¡¿</li></ul><hr><h2 id="10-ZGC-å’Œ-Shenandoah-ç‰¹ç‚¹"><a href="#10-ZGC-å’Œ-Shenandoah-ç‰¹ç‚¹" class="headerlink" title="10. ZGC å’Œ Shenandoah ç‰¹ç‚¹"></a><strong>10. ZGC å’Œ Shenandoah ç‰¹ç‚¹</strong></h2><ul><li><strong>ä½å»¶è¿Ÿ GC</strong>ï¼Œåœé¡¿æ—¶é—´ &lt; 10ms</li><li><strong>å¹¶å‘æ ‡è®° + å¹¶å‘å‹ç¼©</strong></li><li><strong>å†…å­˜å¯æ‰©å±•æ€§å¥½</strong></li><li>æ”¯æŒå¤§å†…å­˜ (&gt;100GB)</li><li>é¢è¯•å¸¸é—®åŒºåˆ«ï¼šZGC ä½¿ç”¨ <strong>Load Barrier</strong>ï¼ŒShenandoah ä½¿ç”¨ <strong>Region Pinning</strong></li></ul><hr><h2 id="11-Minor-GC-ä¸-Full-GC-åŒºåˆ«"><a href="#11-Minor-GC-ä¸-Full-GC-åŒºåˆ«" class="headerlink" title="11. Minor GC ä¸ Full GC åŒºåˆ«"></a><strong>11. Minor GC ä¸ Full GC åŒºåˆ«</strong></h2><table><thead><tr><th>ç‰¹æ€§</th><th>Minor GC</th><th>Full GC</th></tr></thead><tbody><tr><td>è§¦å‘åŒºåŸŸ</td><td>æ–°ç”Ÿä»£</td><td>æ•´ä¸ªå †ï¼ˆåŒ…æ‹¬è€å¹´ä»£ï¼‰</td></tr><tr><td>åœé¡¿æ—¶é—´</td><td>çŸ­</td><td>é•¿</td></tr><tr><td>é¢‘ç‡</td><td>é«˜</td><td>ä½</td></tr><tr><td>GC ç±»å‹</td><td>å¤åˆ¶ç®—æ³•</td><td>æ ‡è®°-æ•´ç† &#x2F; CMS &#x2F; G1</td></tr></tbody></table><hr><h2 id="12-OOM-å¸¸è§ç±»å‹åŠæ’æŸ¥"><a href="#12-OOM-å¸¸è§ç±»å‹åŠæ’æŸ¥" class="headerlink" title="12. OOM å¸¸è§ç±»å‹åŠæ’æŸ¥"></a><strong>12. OOM å¸¸è§ç±»å‹åŠæ’æŸ¥</strong></h2><ul><li><strong>Java Heap Space</strong>ï¼šå †å†…å­˜ä¸è¶³</li><li><strong>GC Overhead Limit</strong>ï¼šGC èŠ±è´¹è¿‡å¤šæ—¶é—´</li><li><strong>Metaspace</strong>ï¼šç±»å…ƒä¿¡æ¯è¿‡å¤š</li><li><strong>Direct Memory</strong>ï¼šå †å¤–å†…å­˜æº¢å‡º</li><li><strong>æ’æŸ¥å·¥å…·</strong>ï¼š<ul><li>jmapã€jstackã€VisualVMã€MAT</li></ul></li></ul><hr><h2 id="13-ç±»åŠ è½½å™¨åˆ†ç±»"><a href="#13-ç±»åŠ è½½å™¨åˆ†ç±»" class="headerlink" title="13. ç±»åŠ è½½å™¨åˆ†ç±»"></a><strong>13. ç±»åŠ è½½å™¨åˆ†ç±»</strong></h2><ul><li>Bootstrapï¼ˆæ ¹ç±»åŠ è½½å™¨ï¼‰</li><li>Extensionï¼ˆæ‰©å±•ç±»åŠ è½½å™¨ï¼‰</li><li>Applicationï¼ˆç³»ç»Ÿç±»åŠ è½½å™¨ï¼‰</li><li>è‡ªå®šä¹‰ ClassLoader</li></ul><hr><h2 id="14-åŒäº²å§”æ´¾æ¨¡å‹ç ´ååœºæ™¯"><a href="#14-åŒäº²å§”æ´¾æ¨¡å‹ç ´ååœºæ™¯" class="headerlink" title="14. åŒäº²å§”æ´¾æ¨¡å‹ç ´ååœºæ™¯"></a><strong>14. åŒäº²å§”æ´¾æ¨¡å‹ç ´ååœºæ™¯</strong></h2><ul><li>åŠ¨æ€åŠ è½½ä¸åŒç‰ˆæœ¬ç±»</li><li>çƒ­éƒ¨ç½²ã€æ’ä»¶åŒ–æ¡†æ¶ï¼ˆTomcatã€OSGiï¼‰</li></ul><hr><h2 id="15-JVM-å¸¸è§å‚æ•°è°ƒä¼˜"><a href="#15-JVM-å¸¸è§å‚æ•°è°ƒä¼˜" class="headerlink" title="15. JVM å¸¸è§å‚æ•°è°ƒä¼˜"></a><strong>15. JVM å¸¸è§å‚æ•°è°ƒä¼˜</strong></h2><ul><li><strong>å †å¤§å°</strong>ï¼š<code>-Xms -Xmx</code></li><li><strong>æ–°ç”Ÿä»£æ¯”ä¾‹</strong>ï¼š<code>-XX:NewRatio</code></li><li><strong>GC ç±»å‹</strong>ï¼š<code>-XX:+UseG1GC</code></li><li><strong>çº¿ç¨‹æ ˆå¤§å°</strong>ï¼š<code>-Xss</code></li><li><strong>Metaspace</strong>ï¼š<code>-XX:MetaspaceSize</code></li></ul><hr><h2 id="16-å†…å­˜æ³„æ¼-vs-å†…å­˜æº¢å‡º"><a href="#16-å†…å­˜æ³„æ¼-vs-å†…å­˜æº¢å‡º" class="headerlink" title="16. å†…å­˜æ³„æ¼ vs å†…å­˜æº¢å‡º"></a><strong>16. å†…å­˜æ³„æ¼ vs å†…å­˜æº¢å‡º</strong></h2><ul><li><strong>å†…å­˜æ³„æ¼</strong>ï¼šå¯¹è±¡ä¸å†ä½¿ç”¨ï¼Œä½†ä»æœ‰å¼•ç”¨</li><li><strong>å†…å­˜æº¢å‡ºï¼ˆOOMï¼‰</strong>ï¼šç”³è¯·å†…å­˜å¤±è´¥</li></ul><hr><h2 id="17-é€ƒé€¸åˆ†æ"><a href="#17-é€ƒé€¸åˆ†æ" class="headerlink" title="17. é€ƒé€¸åˆ†æ"></a><strong>17. é€ƒé€¸åˆ†æ</strong></h2><ul><li><strong>ä½œç”¨</strong>ï¼š<ul><li>åˆ†æå¯¹è±¡ä½œç”¨åŸŸ</li><li>æ ˆä¸Šåˆ†é…ã€é”æ¶ˆé™¤ã€åŒæ­¥ä¼˜åŒ–</li></ul></li><li><strong>JVM ä¼˜åŒ–</strong>ï¼š<ul><li>æ ˆä¸Šåˆ†é…ï¼ˆä¸å…¥å †ï¼‰</li><li>å»æ‰æ— ç”¨é”ï¼ˆé”æ¶ˆé™¤ï¼‰</li></ul></li></ul><hr><h2 id="18-æ–¹æ³•å†…è”"><a href="#18-æ–¹æ³•å†…è”" class="headerlink" title="18. æ–¹æ³•å†…è”"></a><strong>18. æ–¹æ³•å†…è”</strong></h2><ul><li>JIT ä¼˜åŒ–</li><li>å°æ–¹æ³•ç›´æ¥æ›¿æ¢è°ƒç”¨ï¼Œå‡å°‘æ–¹æ³•è°ƒç”¨å¼€é”€</li><li>å¢åŠ  CPU æŒ‡ä»¤å±€éƒ¨æ€§ï¼Œæé«˜æ€§èƒ½</li></ul><hr><h2 id="19-JIT-ç¼–è¯‘å™¨ä¼˜åŒ–"><a href="#19-JIT-ç¼–è¯‘å™¨ä¼˜åŒ–" class="headerlink" title="19. JIT ç¼–è¯‘å™¨ä¼˜åŒ–"></a><strong>19. JIT ç¼–è¯‘å™¨ä¼˜åŒ–</strong></h2><ul><li>æ–¹æ³•å†…è”</li><li>å¾ªç¯å±•å¼€</li><li>é€ƒé€¸åˆ†æ</li><li>å¸¸é‡æŠ˜å </li><li>é€ƒé€¸åˆ†æ + æ ˆä¸Šåˆ†é…</li></ul><hr><h2 id="20-Safepoint-æœºåˆ¶"><a href="#20-Safepoint-æœºåˆ¶" class="headerlink" title="20. Safepoint æœºåˆ¶"></a><strong>20. Safepoint æœºåˆ¶</strong></h2><ul><li>æ‰€æœ‰çº¿ç¨‹æš‚åœï¼Œè¿›è¡Œ GC æˆ–å…¶ä»–å…¨å±€æ“ä½œ</li><li>JVM å¯å®‰å…¨ä¿®æ”¹çº¿ç¨‹çŠ¶æ€</li></ul><hr><h2 id="21-Stop-The-World-STW"><a href="#21-Stop-The-World-STW" class="headerlink" title="21. Stop The World (STW)"></a><strong>21. Stop The World (STW)</strong></h2><ul><li><strong>å®šä¹‰</strong>ï¼šæš‚åœæ‰€æœ‰ç”¨æˆ·çº¿ç¨‹è¿›è¡Œ GC æˆ–å…¶ä»– JVM å†…éƒ¨æ“ä½œ</li><li><strong>å½±å“</strong>ï¼šåº”ç”¨åœé¡¿ï¼Œä½å»¶è¿Ÿåœºæ™¯éœ€æ§åˆ¶ STW æ—¶é—´</li></ul><hr><h2 id="22-Finalize-æ–¹æ³•é—®é¢˜"><a href="#22-Finalize-æ–¹æ³•é—®é¢˜" class="headerlink" title="22. Finalize æ–¹æ³•é—®é¢˜"></a><strong>22. Finalize æ–¹æ³•é—®é¢˜</strong></h2><ul><li>ä¸ç¡®å®šæ‰§è¡Œæ—¶é—´</li><li>æ€§èƒ½å¼€é”€å¤§</li><li>å¯å¯¼è‡´å¯¹è±¡â€œå¤æ´»â€ï¼Œå¢åŠ å†…å­˜å‹åŠ›</li><li><strong>æ›¿ä»£æ–¹æ¡ˆ</strong>ï¼štry-with-resources &#x2F; Cleaner</li></ul><hr><h2 id="23-JVM-å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯å›æ”¶"><a href="#23-JVM-å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯å›æ”¶" class="headerlink" title="23. JVM å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯å›æ”¶"></a><strong>23. JVM å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯å›æ”¶</strong></h2><ul><li><strong>å¯è¾¾æ€§åˆ†æ</strong>ï¼šä» GC Roots å‡ºå‘ï¼Œæœªè¢«å¯è¾¾çš„å¯¹è±¡å¯å›æ”¶</li></ul><hr><h2 id="24-TLABï¼ˆThread-Local-Allocation-Bufferï¼‰ä½œç”¨"><a href="#24-TLABï¼ˆThread-Local-Allocation-Bufferï¼‰ä½œç”¨" class="headerlink" title="24. TLABï¼ˆThread Local Allocation Bufferï¼‰ä½œç”¨"></a><strong>24. TLABï¼ˆThread Local Allocation Bufferï¼‰ä½œç”¨</strong></h2><ul><li>æ¯ä¸ªçº¿ç¨‹ç‹¬äº«ä¸€å— Eden å†…å­˜</li><li><strong>ä½œç”¨</strong>ï¼š<ul><li>å‡å°‘å¤šçº¿ç¨‹ç«äº‰</li><li>æé«˜å¯¹è±¡åˆ†é…æ•ˆç‡</li></ul></li></ul><hr><h2 id="25-Direct-Memory-ä¸ºä»€ä¹ˆä¼š-OOM"><a href="#25-Direct-Memory-ä¸ºä»€ä¹ˆä¼š-OOM" class="headerlink" title="25. Direct Memory ä¸ºä»€ä¹ˆä¼š OOM"></a><strong>25. Direct Memory ä¸ºä»€ä¹ˆä¼š OOM</strong></h2><ul><li>å †å¤–å†…å­˜ä¸è¶³</li><li>NIO Buffer ä½¿ç”¨ <code>Unsafe</code> åˆ†é…</li><li>ä¸å—å †å†…å­˜é™åˆ¶ï¼Œä½† JVM æ— æ³•ç›´æ¥ç®¡ç†</li></ul><hr><h2 id="26-Metaspace-ä½œç”¨"><a href="#26-Metaspace-ä½œç”¨" class="headerlink" title="26. Metaspace ä½œç”¨"></a><strong>26. Metaspace ä½œç”¨</strong></h2><ul><li>å­˜æ”¾ç±»å…ƒæ•°æ®</li><li>Java 8+ æ›¿ä»£æ°¸ä¹…ä»£</li><li>å¯ä»¥é€šè¿‡ <code>-XX:MetaspaceSize</code> é™åˆ¶</li></ul><hr><h2 id="27-Full-GC-è§¦å‘æ¡ä»¶"><a href="#27-Full-GC-è§¦å‘æ¡ä»¶" class="headerlink" title="27. Full GC è§¦å‘æ¡ä»¶"></a><strong>27. Full GC è§¦å‘æ¡ä»¶</strong></h2><ul><li>è€å¹´ä»£ç©ºé—´ä¸è¶³</li><li>æ°¸ä¹…ä»£ &#x2F; å…ƒç©ºé—´ä¸è¶³</li><li>System.gc() è°ƒç”¨</li><li>å†…å­˜åˆ†é…å¤±è´¥</li></ul><hr><h2 id="28-æŸ¥çœ‹-JVM-å†…å­˜ä½¿ç”¨æƒ…å†µ"><a href="#28-æŸ¥çœ‹-JVM-å†…å­˜ä½¿ç”¨æƒ…å†µ" class="headerlink" title="28. æŸ¥çœ‹ JVM å†…å­˜ä½¿ç”¨æƒ…å†µ"></a><strong>28. æŸ¥çœ‹ JVM å†…å­˜ä½¿ç”¨æƒ…å†µ</strong></h2><ul><li><code>jstat -gc &lt;pid&gt;</code></li><li><code>jmap -heap &lt;pid&gt;</code></li><li><code>VisualVM</code> &#x2F; <code>JConsole</code></li><li><code>MAT</code> åˆ†æ heap dump</li></ul><hr><h2 id="29-Arthas-å¸¸ç”¨å‘½ä»¤"><a href="#29-Arthas-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="29. Arthas å¸¸ç”¨å‘½ä»¤"></a><strong>29. Arthas å¸¸ç”¨å‘½ä»¤</strong></h2><ul><li><code>dashboard</code>ï¼šç³»ç»ŸæŒ‡æ ‡</li><li><code>thread</code>ï¼šçº¿ç¨‹çŠ¶æ€</li><li><code>heapdump</code>ï¼šå †è½¬å‚¨</li><li><code>monitor</code>ï¼šæ–¹æ³•è€—æ—¶</li><li><code>watch</code>ï¼šæ–¹æ³•å‚æ•°&#x2F;è¿”å›å€¼</li><li><code>jad</code>ï¼šåç¼–è¯‘ç±»</li></ul><hr><h2 id="30-JVM-è°ƒä¼˜å¸¸è§é¢è¯•é¢˜"><a href="#30-JVM-è°ƒä¼˜å¸¸è§é¢è¯•é¢˜" class="headerlink" title="30. JVM è°ƒä¼˜å¸¸è§é¢è¯•é¢˜"></a><strong>30. JVM è°ƒä¼˜å¸¸è§é¢è¯•é¢˜</strong></h2><ul><li>å †å¤§å°è®¾ç½®ç­–ç•¥</li><li>æ–°ç”Ÿä»£&#x2F;è€å¹´ä»£æ¯”ä¾‹</li><li>GC é€‰æ‹©ï¼ˆG1 &#x2F; CMS &#x2F; Parallelï¼‰</li><li>TLAB ä¸å¯¹è±¡åˆ†é…ä¼˜åŒ–</li><li>Full GC è§¦å‘æ¡ä»¶</li><li>å†…å­˜æ³„æ¼æ’æŸ¥ä¸ MAT ä½¿ç”¨</li></ul><hr><h2 id="å››ã€Spring-Spring-Bootï¼ˆ30é¢˜ï¼‰"><a href="#å››ã€Spring-Spring-Bootï¼ˆ30é¢˜ï¼‰" class="headerlink" title="å››ã€Spring &amp; Spring Bootï¼ˆ30é¢˜ï¼‰"></a>å››ã€Spring &amp; Spring Bootï¼ˆ30é¢˜ï¼‰</h2><h3 id="1-Spring-çš„-IoC-å®¹å™¨åŸç†ï¼Ÿ"><a href="#1-Spring-çš„-IoC-å®¹å™¨åŸç†ï¼Ÿ" class="headerlink" title="1. Spring çš„ IoC å®¹å™¨åŸç†ï¼Ÿ"></a>1. Spring çš„ IoC å®¹å™¨åŸç†ï¼Ÿ</h3><p><strong>æ ¸å¿ƒå›ç­”ï¼š</strong><br> IoCï¼ˆæ§åˆ¶åè½¬ï¼‰æ˜¯é€šè¿‡å®¹å™¨ç®¡ç†å¯¹è±¡åˆ›å»ºå’Œä¾èµ–æ³¨å…¥ï¼Œå¼€å‘è€…ä¸éœ€è¦æ‰‹åŠ¨ new å¯¹è±¡ï¼Œè€Œæ˜¯ç”± Spring å®¹å™¨ç»Ÿä¸€ç®¡ç†ã€‚</p><p><strong>æ·±å…¥è§£æï¼š</strong></p><ul><li>IoC å®¹å™¨çš„æ ¸å¿ƒæ˜¯ <strong>BeanFactory</strong> å’Œ <strong>ApplicationContext</strong>ã€‚</li><li>å·¥ä½œæµç¨‹ï¼š<ol><li><strong>é…ç½®è§£æ</strong>ï¼šè¯»å– XML &#x2F; æ³¨è§£ &#x2F; JavaConfigï¼›</li><li><strong>BeanDefinition</strong>ï¼šå°†é…ç½®è½¬æˆ BeanDefinitionï¼›</li><li><strong>Bean å®ä¾‹åŒ–</strong>ï¼šé€šè¿‡åå°„æˆ– CGLIB åˆ›å»ºå¯¹è±¡ï¼›</li><li><strong>ä¾èµ–æ³¨å…¥</strong>ï¼šæ ¹æ®æ„é€ æ–¹æ³• &#x2F; Setter &#x2F; @Autowired æ³¨å…¥ä¾èµ–ï¼›</li><li><strong>åˆå§‹åŒ–å›è°ƒ</strong>ï¼šæ‰§è¡Œ BeanPostProcessor &#x2F; InitializingBeanï¼›</li><li><strong>æ”¾å…¥å•ä¾‹æ± </strong>ï¼šå®¹å™¨ä¿å­˜å¯¹è±¡ä¾›å…¨å±€ä½¿ç”¨ã€‚</li></ol></li></ul><p><strong>å»¶ä¼¸æ€è€ƒï¼š</strong></p><ul><li>IoC æ˜¯ <strong>ä¾èµ–æŸ¥æ‰¾ï¼ˆDLï¼‰</strong> å’Œ <strong>ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰</strong> çš„ç»“åˆã€‚</li><li>é¢è¯•å¯èƒ½è¿½é—®ï¼šSpring å¦‚ä½•å®ç°å»¶è¿ŸåŠ è½½ï¼Ÿï¼ˆ@Lazy + å•ä¾‹æ± ç®¡ç†ï¼‰</li><li>å®æˆ˜ï¼šé…ç½®æ–‡ä»¶å°‘æ—¶ç”¨ XMLï¼Œå¤§é¡¹ç›®æ¨è <strong>JavaConfig + æ³¨è§£</strong>ã€‚</li></ul><hr><h3 id="2-Bean-çš„ç”Ÿå‘½å‘¨æœŸï¼Ÿ"><a href="#2-Bean-çš„ç”Ÿå‘½å‘¨æœŸï¼Ÿ" class="headerlink" title="2. Bean çš„ç”Ÿå‘½å‘¨æœŸï¼Ÿ"></a>2. Bean çš„ç”Ÿå‘½å‘¨æœŸï¼Ÿ</h3><p><strong>æ ¸å¿ƒå›ç­”ï¼š</strong><br> åˆ›å»º â†’ å±æ€§æ³¨å…¥ â†’ åˆå§‹åŒ– â†’ ä½¿ç”¨ â†’ é”€æ¯ã€‚</p><p><strong>æ·±å…¥è§£æï¼š</strong></p><ol><li><strong>å®ä¾‹åŒ–</strong>ï¼šé€šè¿‡åå°„åˆ›å»ºå¯¹è±¡ï¼›</li><li><strong>ä¾èµ–æ³¨å…¥</strong>ï¼šæ³¨å…¥å±æ€§ï¼›</li><li><strong>Aware æ¥å£å›è°ƒ</strong>ï¼šå¦‚ BeanNameAwareã€ApplicationContextAwareï¼›</li><li><strong>BeanPostProcessor å‰ç½®å¤„ç†</strong>ï¼šæ¯”å¦‚ @Autowired çš„å¤„ç†ï¼›</li><li><strong>åˆå§‹åŒ–æ–¹æ³•</strong>ï¼š@PostConstruct &#x2F; InitializingBean.afterPropertiesSet() &#x2F; init-methodï¼›</li><li><strong>BeanPostProcessor åç½®å¤„ç†</strong>ï¼›</li><li><strong>å°±ç»ªä½¿ç”¨</strong>ï¼›</li><li><strong>é”€æ¯å›è°ƒ</strong>ï¼š@PreDestroy &#x2F; DisposableBean.destroy() &#x2F; destroy-methodã€‚</li></ol><p><strong>å»¶ä¼¸æ€è€ƒï¼š</strong></p><ul><li>é¢è¯•å¸¸è¿½é—®ï¼šSpring å®¹å™¨å…³é—­æ—¶ï¼Œå•ä¾‹ Bean ä¼šè¢«é”€æ¯å—ï¼Ÿï¼ˆä¼šï¼Œè°ƒç”¨ destroy å›è°ƒï¼‰ã€‚</li><li>åŸå‹ä½œç”¨åŸŸ Bean ä¸ä¼šè¢«é”€æ¯ï¼Œéœ€è¦å¼€å‘è€…æ‰‹åŠ¨ç®¡ç†ã€‚</li></ul><hr><h3 id="3-BeanFactory-å’Œ-ApplicationContext-çš„åŒºåˆ«ï¼Ÿ"><a href="#3-BeanFactory-å’Œ-ApplicationContext-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="3. BeanFactory å’Œ ApplicationContext çš„åŒºåˆ«ï¼Ÿ"></a>3. BeanFactory å’Œ ApplicationContext çš„åŒºåˆ«ï¼Ÿ</h3><p><strong>æ ¸å¿ƒå›ç­”ï¼š</strong></p><ul><li><strong>BeanFactory</strong>ï¼šæœ€åŸºç¡€ IoC å®¹å™¨ï¼Œæ‡’åŠ è½½ï¼Œè½»é‡çº§ï¼›</li><li><strong>ApplicationContext</strong>ï¼šç»§æ‰¿ BeanFactoryï¼Œæ”¯æŒ AOPã€å›½é™…åŒ–ã€äº‹ä»¶æœºåˆ¶ã€è‡ªåŠ¨è£…é…ï¼Œé»˜è®¤é¢„å®ä¾‹åŒ–ã€‚</li></ul><p><strong>æ·±å…¥è§£æï¼š</strong></p><ul><li>BeanFactoryï¼šé¢å‘ä½èµ„æºç¯å¢ƒï¼ŒåŠŸèƒ½æœ‰é™ï¼›</li><li>ApplicationContextï¼šå¸¸ç”¨å®ç°æœ‰ ClassPathXmlApplicationContextã€AnnotationConfigApplicationContextã€‚</li></ul><p><strong>å»¶ä¼¸æ€è€ƒï¼š</strong></p><ul><li>é¢è¯•å¸¸é—®ï¼šä¸ºä»€ä¹ˆ ApplicationContext é»˜è®¤æ˜¯é¢„åŠ è½½ï¼Ÿï¼ˆå‡å°‘è¿è¡Œæ—¶æ€§èƒ½å¼€é”€ï¼Œå¯åŠ¨æ—¶å®Œæˆä¾èµ–æ£€æŸ¥ï¼‰ã€‚</li></ul><hr><h3 id="4-å•ä¾‹-Bean-å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿ"><a href="#4-å•ä¾‹-Bean-å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿ" class="headerlink" title="4. å•ä¾‹ Bean å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿ"></a>4. å•ä¾‹ Bean å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿ</h3><p><strong>æ ¸å¿ƒå›ç­”ï¼š</strong><br> Spring <strong>ä¸ä¿è¯å•ä¾‹ Bean çš„çº¿ç¨‹å®‰å…¨</strong>ï¼Œéœ€è¦å¼€å‘è€…åœ¨ä»£ç ä¸­ä¿è¯ã€‚</p><p><strong>æ·±å…¥è§£æï¼š</strong></p><ul><li>IoC å®¹å™¨ä¸­çš„å•ä¾‹ Bean æ˜¯ <strong>å¤šçº¿ç¨‹å…±äº«çš„</strong>ï¼›</li><li>å¸¸è§çš„çº¿ç¨‹å®‰å…¨æªæ–½ï¼š<ol><li><strong>æ— çŠ¶æ€è®¾è®¡</strong>ï¼ˆæ¨èï¼‰ï¼›</li><li><strong>ä½¿ç”¨ ThreadLocal ä¿å­˜çŠ¶æ€</strong>ï¼›</li><li><strong>æ–¹æ³•å†…éƒ¨ä½¿ç”¨å±€éƒ¨å˜é‡</strong>ï¼›</li><li><strong>å¿…è¦æ—¶åŠ é”ï¼ˆsynchronized &#x2F; Lockï¼‰</strong>ã€‚</li></ol></li></ul><p><strong>å»¶ä¼¸æ€è€ƒï¼š</strong></p><ul><li>é¢è¯•é™·é˜±ï¼šSpring å•ä¾‹ Bean æ˜¯ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿç­”ï¼šä¸æ˜¯ã€‚</li><li>ä¾‹å­ï¼šControllerã€Service é€šå¸¸æ˜¯æ— çŠ¶æ€çš„ï¼Œå¯ä»¥å®‰å…¨å•ä¾‹ã€‚</li></ul><hr><h3 id="5-Spring-AOP-çš„å®ç°åŸç†ï¼Ÿ"><a href="#5-Spring-AOP-çš„å®ç°åŸç†ï¼Ÿ" class="headerlink" title="5. Spring AOP çš„å®ç°åŸç†ï¼Ÿ"></a>5. Spring AOP çš„å®ç°åŸç†ï¼Ÿ</h3><p><strong>æ ¸å¿ƒå›ç­”ï¼š</strong><br> AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰é€šè¿‡ <strong>åŠ¨æ€ä»£ç†</strong> å®ç°ï¼Œåœ¨æ–¹æ³•æ‰§è¡Œå‰åæ’å…¥å¢å¼ºé€»è¾‘ã€‚</p><p><strong>æ·±å…¥è§£æï¼š</strong></p><ul><li>å®ç°æ–¹å¼ï¼š<ol><li><strong>JDK åŠ¨æ€ä»£ç†</strong>ï¼šåŸºäºæ¥å£ï¼›</li><li><strong>CGLIB ä»£ç†</strong>ï¼šåŸºäºå­ç±»å­—èŠ‚ç å¢å¼ºã€‚</li></ol></li><li>AOP æ ¸å¿ƒç»„ä»¶ï¼š<ul><li>JoinPointï¼ˆè¿æ¥ç‚¹ï¼‰ã€Pointcutï¼ˆåˆ‡ç‚¹ï¼‰ã€Adviceï¼ˆé€šçŸ¥ï¼‰ã€Weavingï¼ˆç»‡å…¥ï¼‰ã€Proxyï¼ˆä»£ç†å¯¹è±¡ï¼‰ã€‚</li></ul></li><li>AOP æµç¨‹ï¼šè°ƒç”¨ç›®æ ‡æ–¹æ³• â†’ ä»£ç†å¯¹è±¡æ‹¦æˆª â†’ æ‰§è¡Œåˆ‡é¢é€»è¾‘ â†’ ç»§ç»­æ‰§è¡ŒåŸæ–¹æ³•ã€‚</li></ul><p><strong>å»¶ä¼¸æ€è€ƒï¼š</strong></p><ul><li>é¢è¯•å®˜å¯èƒ½é—®ï¼šSpring é»˜è®¤ç”¨å“ªç§ä»£ç†ï¼Ÿ<ul><li>å¦‚æœæœ‰æ¥å£ â†’ JDK åŠ¨æ€ä»£ç†ï¼›</li><li>æ²¡æœ‰æ¥å£ â†’ CGLIBã€‚</li></ul></li><li>JDK ä»£ç†åªèƒ½åŸºäºæ¥å£ï¼ŒCGLIB å¯ä»¥åŸºäºç±»ã€‚</li></ul><hr><h3 id="6-JDK-åŠ¨æ€ä»£ç†å’Œ-CGLIB-çš„åŒºåˆ«ï¼Ÿ"><a href="#6-JDK-åŠ¨æ€ä»£ç†å’Œ-CGLIB-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="6. JDK åŠ¨æ€ä»£ç†å’Œ CGLIB çš„åŒºåˆ«ï¼Ÿ"></a>6. JDK åŠ¨æ€ä»£ç†å’Œ CGLIB çš„åŒºåˆ«ï¼Ÿ</h3><p><strong>æ ¸å¿ƒå›ç­”ï¼š</strong></p><ul><li>JDKï¼šåŸºäºæ¥å£ï¼Œç”Ÿæˆå®ç°ç±»ï¼›</li><li>CGLIBï¼šåŸºäºç»§æ‰¿ï¼Œç”Ÿæˆå­ç±»å­—èŠ‚ç ã€‚</li></ul><p><strong>æ·±å…¥è§£æï¼š</strong></p><ul><li>JDK åŠ¨æ€ä»£ç†ï¼šåˆ©ç”¨ <code>Proxy.newProxyInstance</code>ï¼Œæ€§èƒ½è¾ƒé«˜ï¼›</li><li>CGLIBï¼šåˆ©ç”¨ ASM å­—èŠ‚ç æ“ä½œç”Ÿæˆå­ç±»ï¼Œæ€§èƒ½ç¨æ…¢ï¼Œä½†æ”¯æŒç±»ä»£ç†ï¼›</li><li>Spring é»˜è®¤ä¼˜å…ˆä½¿ç”¨ JDKï¼Œå¦‚æœæ²¡æœ‰æ¥å£å†ç”¨ CGLIBã€‚</li></ul><p><strong>å»¶ä¼¸æ€è€ƒï¼š</strong></p><ul><li>é™åˆ¶ï¼šCGLIB æ— æ³•ä»£ç† <code>final</code> ç±» &#x2F; <code>final</code> æ–¹æ³•ï¼›</li><li>Spring Boot å¯é€šè¿‡ <code>spring.aop.proxy-target-class=true</code> å¼ºåˆ¶ä½¿ç”¨ CGLIBã€‚</li></ul><hr><h3 id="7-Spring-äº‹åŠ¡çš„ä¼ æ’­æœºåˆ¶ï¼Ÿ"><a href="#7-Spring-äº‹åŠ¡çš„ä¼ æ’­æœºåˆ¶ï¼Ÿ" class="headerlink" title="7. Spring äº‹åŠ¡çš„ä¼ æ’­æœºåˆ¶ï¼Ÿ"></a>7. Spring äº‹åŠ¡çš„ä¼ æ’­æœºåˆ¶ï¼Ÿ</h3><p><strong>æ ¸å¿ƒå›ç­”ï¼š</strong><br> äº‹åŠ¡ä¼ æ’­æœºåˆ¶å®šä¹‰äº†æ–¹æ³•åœ¨è°ƒç”¨æ—¶äº‹åŠ¡çš„è¾¹ç•Œï¼Œå¸¸è§ç±»å‹ï¼š</p><ul><li>REQUIREDï¼ˆé»˜è®¤ï¼‰ã€REQUIRES_NEWã€NESTEDã€SUPPORTSã€NOT_SUPPORTEDã€MANDATORYã€NEVERã€‚</li></ul><p><strong>æ·±å…¥è§£æï¼š</strong></p><ul><li><strong>REQUIRED</strong>ï¼šæœ‰äº‹åŠ¡å°±åŠ å…¥ï¼Œæ²¡æœ‰å°±æ–°å»ºï¼›</li><li><strong>REQUIRES_NEW</strong>ï¼šæŒ‚èµ·å½“å‰äº‹åŠ¡ï¼Œæ–°å»ºä¸€ä¸ªï¼›</li><li><strong>NESTED</strong>ï¼šåµŒå¥—äº‹åŠ¡ï¼ˆä¾èµ–ä¿å­˜ç‚¹ rollbackï¼‰ï¼›</li><li><strong>SUPPORTS</strong>ï¼šæœ‰å°±ç”¨ï¼Œæ²¡æœ‰å°±ä¸ç”¨ï¼›</li><li><strong>NOT_SUPPORTED</strong>ï¼šæŒ‚èµ·äº‹åŠ¡ï¼Œä»¥éäº‹åŠ¡è¿è¡Œï¼›</li><li><strong>MANDATORY</strong>ï¼šå¿…é¡»åœ¨äº‹åŠ¡ä¸­è°ƒç”¨ï¼›</li><li><strong>NEVER</strong>ï¼šå¿…é¡»åœ¨éäº‹åŠ¡ä¸­è¿è¡Œã€‚</li></ul><p><strong>å»¶ä¼¸æ€è€ƒï¼š</strong></p><ul><li>é¢è¯•é™·é˜±ï¼šåµŒå¥—äº‹åŠ¡å’Œæ–°äº‹åŠ¡çš„åŒºåˆ«ï¼Ÿ<ul><li>åµŒå¥—äº‹åŠ¡ä¾èµ–å¤–å±‚äº‹åŠ¡å›æ»šï¼›</li><li>æ–°äº‹åŠ¡äº’ç›¸ç‹¬ç«‹ã€‚</li></ul></li></ul><hr><h3 id="8-Spring-äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Ÿ"><a href="#8-Spring-äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Ÿ" class="headerlink" title="8. Spring äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Ÿ"></a>8. Spring äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Ÿ</h3><p><strong>æ ¸å¿ƒå›ç­”ï¼š</strong><br> äº‹åŠ¡éš”ç¦»çº§åˆ«è§£å†³å¹¶å‘é—®é¢˜ï¼ŒSpring æ”¯æŒæ•°æ®åº“çš„ 5 ç§éš”ç¦»çº§åˆ«ï¼š</p><ul><li>DEFAULTï¼ˆæ•°æ®åº“é»˜è®¤ï¼‰</li><li>READ_UNCOMMITTEDï¼ˆå¯èƒ½è„è¯»ï¼‰</li><li>READ_COMMITTEDï¼ˆé˜²è„è¯»ï¼‰</li><li>REPEATABLE_READï¼ˆé˜²è„è¯»ã€ä¸å¯é‡å¤è¯»ï¼‰</li><li>SERIALIZABLEï¼ˆé˜²è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»ï¼‰</li></ul><p><strong>æ·±å…¥è§£æï¼š</strong></p><ul><li>InnoDB é»˜è®¤æ˜¯ <strong>REPEATABLE_READ</strong>ï¼›</li><li>Oracle é»˜è®¤æ˜¯ <strong>READ_COMMITTED</strong>ã€‚</li></ul><p><strong>å»¶ä¼¸æ€è€ƒï¼š</strong></p><ul><li>é¢è¯•å¯èƒ½è¿½é—®ï¼šMySQL çš„ REPEATABLE_READ å¦‚ä½•é¿å…å¹»è¯»ï¼Ÿï¼ˆMVCC + é—´éš™é”ï¼‰ã€‚</li></ul><hr><h3 id="9-Transactional-çš„å®ç°åŸç†ï¼Ÿ"><a href="#9-Transactional-çš„å®ç°åŸç†ï¼Ÿ" class="headerlink" title="9. @Transactional çš„å®ç°åŸç†ï¼Ÿ"></a>9. @Transactional çš„å®ç°åŸç†ï¼Ÿ</h3><p><strong>æ ¸å¿ƒå›ç­”ï¼š</strong><br> @Transactional é€šè¿‡ <strong>AOP ä»£ç†</strong>ï¼Œåœ¨æ–¹æ³•æ‰§è¡Œå‰åæ§åˆ¶äº‹åŠ¡ã€‚</p><p><strong>æ·±å…¥è§£æï¼š</strong></p><ul><li>Spring å®¹å™¨è§£æ @Transactional â†’ ç”Ÿæˆä»£ç† â†’ åœ¨ä»£ç†æ–¹æ³•é‡Œæ‰§è¡Œäº‹åŠ¡å¢å¼ºé€»è¾‘ï¼š<ol><li>è·å–äº‹åŠ¡ç®¡ç†å™¨ï¼›</li><li>å¼€å¯äº‹åŠ¡ï¼›</li><li>æ‰§è¡Œç›®æ ‡æ–¹æ³•ï¼›</li><li>å¼‚å¸¸å›æ»š &#x2F; æ­£å¸¸æäº¤ï¼›</li><li>æ¸…ç†èµ„æºã€‚</li></ol></li></ul><p><strong>å»¶ä¼¸æ€è€ƒï¼š</strong></p><ul><li>é»˜è®¤åªå›æ»š RuntimeException å’Œ Errorï¼Œæ£€æŸ¥å¼‚å¸¸éœ€è¦ <code>rollbackFor</code>ã€‚</li><li>é¢è¯•å¸¸é—®ï¼šä¸ºä»€ä¹ˆ @Transactional æ–¹æ³•ç”¨ <code>private</code> ä¿®é¥°æ— æ•ˆï¼Ÿ<br> â†’ å› ä¸º AOP ä»£ç†æ— æ³•æ‹¦æˆª private æ–¹æ³•ã€‚</li></ul><hr><h3 id="10-å¾ªç¯ä¾èµ–å¦‚ä½•è§£å†³ï¼Ÿ"><a href="#10-å¾ªç¯ä¾èµ–å¦‚ä½•è§£å†³ï¼Ÿ" class="headerlink" title="10. å¾ªç¯ä¾èµ–å¦‚ä½•è§£å†³ï¼Ÿ"></a>10. å¾ªç¯ä¾èµ–å¦‚ä½•è§£å†³ï¼Ÿ</h3><p><strong>æ ¸å¿ƒå›ç­”ï¼š</strong><br> Spring é€šè¿‡ <strong>ä¸‰çº§ç¼“å­˜</strong> è§£å†³å•ä¾‹ Bean çš„å¾ªç¯ä¾èµ–ã€‚</p><p><strong>æ·±å…¥è§£æï¼š</strong></p><ul><li>ä¸‰çº§ç¼“å­˜ï¼š<ol><li>singletonObjectsï¼ˆæˆå“å¯¹è±¡ï¼‰</li><li>earlySingletonObjectsï¼ˆæå‰æš´éœ²çš„å¯¹è±¡ï¼ŒåŠæˆå“ï¼‰</li><li>singletonFactoriesï¼ˆå¯¹è±¡å·¥å‚ï¼Œæä¾›ä»£ç†å¯¹è±¡ï¼‰</li></ol></li><li>æµç¨‹ï¼šA â†’ ä¾èµ– B â†’ B ä¾èµ– A â†’ æå‰æš´éœ² A çš„å¼•ç”¨ç»™ B â†’ ä¾èµ–æ³¨å…¥æˆåŠŸã€‚</li></ul><p><strong>å»¶ä¼¸æ€è€ƒï¼š</strong></p><ul><li>åªèƒ½è§£å†³ <strong>å•ä¾‹ + setter æ³¨å…¥</strong> çš„å¾ªç¯ä¾èµ–ï¼›</li><li><strong>æ„é€ å™¨æ³¨å…¥å¾ªç¯ä¾èµ–</strong> æ— æ³•è§£å†³ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</li></ul><h3 id="11-Spring-çš„ä¸‰çº§ç¼“å­˜è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ"><a href="#11-Spring-çš„ä¸‰çº§ç¼“å­˜è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ" class="headerlink" title="11. Spring çš„ä¸‰çº§ç¼“å­˜è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ"></a>11. Spring çš„ä¸‰çº§ç¼“å­˜è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h3><p><strong>æ ¸å¿ƒå›ç­”ï¼š</strong><br> è§£å†³ <strong>å•ä¾‹ Bean çš„å¾ªç¯ä¾èµ–</strong>ï¼Œä¿è¯åœ¨åˆ›å»ºè¿‡ç¨‹ä¸­èƒ½æå‰æš´éœ²ä»£ç†å¯¹è±¡ã€‚</p><p><strong>æ·±å…¥è§£æï¼š</strong></p><ul><li>Spring å•ä¾‹æ± ç»´æŠ¤äº† <strong>ä¸‰çº§ç¼“å­˜</strong>ï¼š<ol><li><code>singletonObjects</code> â†’ ä¸€çº§ç¼“å­˜ï¼ˆå®Œå…¨åˆå§‹åŒ–çš„å•ä¾‹ï¼‰ï¼›</li><li><code>earlySingletonObjects</code> â†’ äºŒçº§ç¼“å­˜ï¼ˆæå‰æš´éœ²çš„åŠæˆå“å¯¹è±¡ï¼‰ï¼›</li><li><code>singletonFactories</code> â†’ ä¸‰çº§ç¼“å­˜ï¼ˆå¯¹è±¡å·¥å‚ï¼Œé€šå¸¸ç”Ÿæˆä»£ç†å¯¹è±¡ï¼‰ã€‚</li></ol></li><li>æµç¨‹ï¼š<ul><li>å½“ A ä¾èµ– Bï¼ŒB åˆä¾èµ– A æ—¶ï¼š<ol><li>åˆ›å»º A â†’ æ”¾å…¥ä¸‰çº§ç¼“å­˜ï¼›</li><li>B ä¾èµ– A æ—¶ï¼Œå…ˆä»ä¸‰çº§ç¼“å­˜æ‹¿åˆ° A çš„å·¥å‚ï¼Œæš´éœ²æå‰ä»£ç†å¯¹è±¡ â†’ æ”¾å…¥äºŒçº§ç¼“å­˜ï¼›</li><li>ç­‰ A å®Œæˆåˆå§‹åŒ–åï¼Œæ›¿æ¢ä¸ºä¸€çº§ç¼“å­˜ã€‚</li></ol></li></ul></li></ul><p><strong>å»¶ä¼¸æ€è€ƒï¼š</strong></p><ul><li>é¢è¯•å®˜å¯èƒ½è¿½é—®ï¼šä¸ºä»€ä¹ˆè¦ä¸‰çº§ç¼“å­˜ï¼Œä¸æ˜¯äºŒçº§å°±å¤Ÿäº†å—ï¼Ÿ<br> â†’ å› ä¸º AOP ä»£ç†å¯¹è±¡éœ€è¦é€šè¿‡å·¥å‚æå‰æš´éœ²ï¼Œä¸èƒ½åªæ”¾åŠæˆå“å¯¹è±¡ã€‚</li><li>åªæ”¯æŒ <strong>setter æ³¨å…¥çš„å¾ªç¯ä¾èµ–</strong>ï¼Œä¸æ”¯æŒ <strong>æ„é€ å‡½æ•°å¾ªç¯ä¾èµ–</strong>ã€‚</li></ul><hr><h3 id="12-Spring-MVC-çš„å·¥ä½œæµç¨‹ï¼Ÿ"><a href="#12-Spring-MVC-çš„å·¥ä½œæµç¨‹ï¼Ÿ" class="headerlink" title="12. Spring MVC çš„å·¥ä½œæµç¨‹ï¼Ÿ"></a>12. Spring MVC çš„å·¥ä½œæµç¨‹ï¼Ÿ</h3><p><strong>æ ¸å¿ƒå›ç­”ï¼š</strong><br> è¯·æ±‚ â†’ DispatcherServlet â†’ HandlerMapping â†’ HandlerAdapter â†’ Controller â†’ ViewResolver â†’ å“åº”ã€‚</p><p><strong>æ·±å…¥è§£æï¼š</strong></p><ol><li>ç”¨æˆ·è¯·æ±‚åˆ°è¾¾ DispatcherServletï¼›</li><li>DispatcherServlet è°ƒç”¨ HandlerMapping å¯»æ‰¾å¤„ç†å™¨ï¼›</li><li>é€šè¿‡ HandlerAdapter è°ƒç”¨å…·ä½“ Controllerï¼›</li><li>Controller æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼Œè¿”å› ModelAndViewï¼›</li><li>ViewResolver è§£æè§†å›¾ï¼›</li><li>DispatcherServlet æ¸²æŸ“å¹¶è¿”å›å“åº”ç»™å®¢æˆ·ç«¯ã€‚</li></ol><p><strong>å»¶ä¼¸æ€è€ƒï¼š</strong></p><ul><li>é¢è¯•å®˜å¸¸é—®ï¼šDispatcherServlet æ˜¯å•ä¾‹è¿˜æ˜¯å¤šä¾‹ï¼Ÿï¼ˆå•ä¾‹ï¼Œçº¿ç¨‹å®‰å…¨ä¾èµ–äºæ— çŠ¶æ€è®¾è®¡ï¼‰ã€‚</li><li>å®æˆ˜ï¼šå¯ä»¥ç”¨ <code>@RestController</code> ç›´æ¥è¿”å› JSONï¼Œçœç•¥ ViewResolverã€‚</li></ul><hr><h3 id="13-DispatcherServlet-çš„ä½œç”¨ï¼Ÿ"><a href="#13-DispatcherServlet-çš„ä½œç”¨ï¼Ÿ" class="headerlink" title="13. DispatcherServlet çš„ä½œç”¨ï¼Ÿ"></a>13. DispatcherServlet çš„ä½œç”¨ï¼Ÿ</h3><p><strong>æ ¸å¿ƒå›ç­”ï¼š</strong><br> Spring MVC çš„ <strong>å‰ç«¯æ§åˆ¶å™¨</strong>ï¼Œè´Ÿè´£è¯·æ±‚åˆ†å‘å’Œå“åº”æ¸²æŸ“ã€‚</p><p><strong>æ·±å…¥è§£æï¼š</strong></p><ul><li>èŒè´£ï¼š<ol><li>æ‹¦æˆªè¯·æ±‚ï¼›</li><li>è°ƒç”¨ HandlerMapping æ‰¾åˆ° Controllerï¼›</li><li>è°ƒç”¨ HandlerAdapter æ‰§è¡Œ Controllerï¼›</li><li>è°ƒç”¨ ViewResolver æ¸²æŸ“è§†å›¾ï¼›</li><li>è¿”å›å“åº”ã€‚</li></ol></li><li>æ ¸å¿ƒæ€æƒ³ï¼š<strong>ç»Ÿä¸€å…¥å£ï¼Œé›†ä¸­æ§åˆ¶</strong>ã€‚</li></ul><p><strong>å»¶ä¼¸æ€è€ƒï¼š</strong></p><ul><li>é¢è¯•è¿½é—®ï¼šDispatcherServlet åœ¨ Spring Boot ä¸­æ€ä¹ˆæ³¨å†Œçš„ï¼Ÿ<br> â†’ è‡ªåŠ¨é…ç½®ç±» <code>DispatcherServletAutoConfiguration</code> æ³¨å†Œã€‚</li></ul><hr><h3 id="14-Spring-Boot-çš„è‡ªåŠ¨è£…é…åŸç†ï¼Ÿ"><a href="#14-Spring-Boot-çš„è‡ªåŠ¨è£…é…åŸç†ï¼Ÿ" class="headerlink" title="14. Spring Boot çš„è‡ªåŠ¨è£…é…åŸç†ï¼Ÿ"></a>14. Spring Boot çš„è‡ªåŠ¨è£…é…åŸç†ï¼Ÿ</h3><p><strong>æ ¸å¿ƒå›ç­”ï¼š</strong><br> åŸºäº <code>@EnableAutoConfiguration</code> + <code>SpringFactoriesLoader</code> å®ç°ï¼Œæ ¹æ® classpath æ¡ä»¶åŠ è½½é…ç½®ç±»ã€‚</p><p><strong>æ·±å…¥è§£æï¼š</strong></p><ol><li><code>@SpringBootApplication</code> â†’ å¯ç”¨ <code>@EnableAutoConfiguration</code>ï¼›</li><li><code>SpringFactoriesLoader</code> è¯»å– <code>META-INF/spring.factories</code> æ–‡ä»¶ï¼›</li><li>æ ¹æ® <code>@Conditional</code> æ³¨è§£åˆ¤æ–­æ˜¯å¦åŠ è½½ï¼›</li><li>æŠŠåŒ¹é…çš„ Bean æ³¨å†Œåˆ°å®¹å™¨ã€‚</li></ol><p><strong>å»¶ä¼¸æ€è€ƒï¼š</strong></p><ul><li>é¢è¯•å®˜å¯èƒ½è¿½é—®ï¼šæ€ä¹ˆç¦ç”¨æŸä¸ªè‡ªåŠ¨é…ç½®ï¼Ÿ<br> â†’ <code>@SpringBootApplication(exclude = &#123;DataSourceAutoConfiguration.class&#125;)</code></li><li>æˆ–è€…åœ¨ <code>application.yml</code> ä¸­é…ç½® <code>spring.autoconfigure.exclude</code>ã€‚</li></ul><hr><h3 id="15-Spring-Boot-Starter-çš„æœºåˆ¶ï¼Ÿ"><a href="#15-Spring-Boot-Starter-çš„æœºåˆ¶ï¼Ÿ" class="headerlink" title="15. Spring Boot Starter çš„æœºåˆ¶ï¼Ÿ"></a>15. Spring Boot Starter çš„æœºåˆ¶ï¼Ÿ</h3><p><strong>æ ¸å¿ƒå›ç­”ï¼š</strong><br> Starter æ˜¯ä¸€ç»„ <strong>ä¾èµ–å°è£… + è‡ªåŠ¨é…ç½®</strong>ï¼Œç®€åŒ–ç¬¬ä¸‰æ–¹åº“é›†æˆã€‚</p><p><strong>æ·±å…¥è§£æï¼š</strong></p><ul><li>å‘½åè§„èŒƒï¼š<code>spring-boot-starter-xxx</code>ï¼›</li><li>ä¾èµ– Starter â†’ è‡ªåŠ¨å¼•å…¥å¿…è¦ä¾èµ– + è‡ªåŠ¨è£…é…ç±»ï¼›</li><li>ä¾‹å­ï¼š<code>spring-boot-starter-web</code> â†’ å¼•å…¥ Spring MVC + Tomcat + Jacksonï¼Œå¹¶è‡ªåŠ¨é…ç½® DispatcherServletã€‚</li></ul><p><strong>å»¶ä¼¸æ€è€ƒï¼š</strong></p><ul><li>é¢è¯•å®˜å¸¸é—®ï¼šæ€ä¹ˆå†™ä¸€ä¸ªè‡ªå®šä¹‰ Starterï¼Ÿ<ol><li>æä¾› <code>AutoConfiguration</code> ç±»ï¼›</li><li>åœ¨ <code>META-INF/spring.factories</code> æ³¨å†Œï¼›</li><li>æ‰“åŒ…å‘å¸ƒã€‚</li></ol></li></ul><hr><h3 id="16-ConfigurationProperties-å’Œ-Value-çš„åŒºåˆ«ï¼Ÿ"><a href="#16-ConfigurationProperties-å’Œ-Value-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="16. @ConfigurationProperties å’Œ @Value çš„åŒºåˆ«ï¼Ÿ"></a>16. @ConfigurationProperties å’Œ @Value çš„åŒºåˆ«ï¼Ÿ</h3><p><strong>æ ¸å¿ƒå›ç­”ï¼š</strong></p><ul><li><code>@Value</code>ï¼šå•ä¸ªå±æ€§æ³¨å…¥ï¼›</li><li><code>@ConfigurationProperties</code>ï¼šæ‰¹é‡ç»‘å®šé…ç½®ï¼Œæ”¯æŒç±»å‹å®‰å…¨ã€‚</li></ul><p><strong>æ·±å…¥è§£æï¼š</strong></p><ul><li><code>@Value(&quot;$&#123;key&#125;&quot;)</code>ï¼šåªèƒ½æ³¨å…¥å•ä¸ªå€¼ï¼›</li><li><code>@ConfigurationProperties(prefix = &quot;xxx&quot;)</code>ï¼šæŠŠé…ç½®æ–‡ä»¶ä¸­ <code>xxx.*</code> æ˜ å°„åˆ° JavaBeanã€‚</li><li><code>@ConfigurationProperties</code> æ›´é€‚åˆå¤æ‚é…ç½®å¯¹è±¡ã€‚</li></ul><p><strong>å»¶ä¼¸æ€è€ƒï¼š</strong></p><ul><li>é¢è¯•å®˜å¯èƒ½è¿½é—®ï¼šæ¨èç”¨å“ªä¸ªï¼Ÿ<br> â†’ <code>@ConfigurationProperties</code>ï¼Œå› ä¸ºæ”¯æŒæ ¡éªŒï¼ˆ<code>@Validated</code>ï¼‰ã€IDE æç¤ºã€‚</li><li>å®æˆ˜ï¼šæ•°æ®åº“é…ç½®å¸¸ç”¨ <code>@ConfigurationProperties</code>ã€‚</li></ul><hr><h3 id="17-Spring-Boot-å¦‚ä½•å®ç°çƒ­éƒ¨ç½²ï¼Ÿ"><a href="#17-Spring-Boot-å¦‚ä½•å®ç°çƒ­éƒ¨ç½²ï¼Ÿ" class="headerlink" title="17. Spring Boot å¦‚ä½•å®ç°çƒ­éƒ¨ç½²ï¼Ÿ"></a>17. Spring Boot å¦‚ä½•å®ç°çƒ­éƒ¨ç½²ï¼Ÿ</h3><p><strong>æ ¸å¿ƒå›ç­”ï¼š</strong><br> ä¸»è¦é€šè¿‡ <strong>Spring Boot DevTools</strong> æˆ– <strong>JRebel</strong>ã€‚</p><p><strong>æ·±å…¥è§£æï¼š</strong></p><ul><li>DevToolsï¼šç›‘æ§ classpath æ–‡ä»¶å˜åŒ–ï¼Œè§¦å‘ SpringContext é‡å¯ï¼›</li><li>JRebelï¼šå­—èŠ‚ç å¢å¼ºï¼Œåšåˆ°æ— æ„ŸçŸ¥çƒ­æ›¿æ¢ï¼›</li><li>IDEï¼ˆIntelliJ IDEA &#x2F; Eclipseï¼‰ä¹Ÿæ”¯æŒ Build è‡ªåŠ¨ reloadã€‚</li></ul><p><strong>å»¶ä¼¸æ€è€ƒï¼š</strong></p><ul><li>DevTools é€‚åˆå¼€å‘ï¼ŒJRebel æ›´å¼ºå¤§ä½†æ”¶è´¹ã€‚</li><li>ç”Ÿäº§ç¯å¢ƒä¸å»ºè®®çƒ­éƒ¨ç½²ï¼Œè€Œæ˜¯ç°åº¦å‘å¸ƒ&#x2F;æ»šåŠ¨æ›´æ–°ã€‚</li></ul><hr><h3 id="18-Spring-Boot-å¦‚ä½•å¤„ç†é…ç½®æ–‡ä»¶ï¼Ÿ"><a href="#18-Spring-Boot-å¦‚ä½•å¤„ç†é…ç½®æ–‡ä»¶ï¼Ÿ" class="headerlink" title="18. Spring Boot å¦‚ä½•å¤„ç†é…ç½®æ–‡ä»¶ï¼Ÿ"></a>18. Spring Boot å¦‚ä½•å¤„ç†é…ç½®æ–‡ä»¶ï¼Ÿ</h3><p><strong>æ ¸å¿ƒå›ç­”ï¼š</strong><br> Spring Boot è¯»å– <code>application.yml/properties</code>ï¼Œå¹¶æ”¯æŒå¤šç¯å¢ƒå’Œä¼˜å…ˆçº§åŠ è½½ã€‚</p><p><strong>æ·±å…¥è§£æï¼š</strong></p><ul><li>é»˜è®¤åŠ è½½é¡ºåºï¼š<ol><li>å‘½ä»¤è¡Œå‚æ•°ï¼›</li><li><code>application.properties</code> &#x2F; <code>application.yml</code>ï¼›</li><li>å¤–éƒ¨é…ç½®æ–‡ä»¶ï¼ˆconfig ç›®å½•ï¼‰ï¼›</li><li>é»˜è®¤é…ç½®ã€‚</li></ol></li><li>æ”¯æŒå¤šç¯å¢ƒï¼š<code>application-dev.yml</code>ã€<code>application-prod.yml</code>ï¼Œé€šè¿‡ <code>spring.profiles.active=dev</code> åˆ‡æ¢ã€‚</li></ul><p><strong>å»¶ä¼¸æ€è€ƒï¼š</strong></p><ul><li>é¢è¯•å®˜å¯èƒ½é—®ï¼šä¼˜å…ˆçº§è°æœ€é«˜ï¼Ÿ<br> â†’ å‘½ä»¤è¡Œå‚æ•°ã€‚</li><li>å®æˆ˜ï¼šç”Ÿäº§ç¯å¢ƒå¸¸ç”¨å¤–éƒ¨åŒ–é…ç½®ï¼ˆå¦‚ <code>--spring.config.location</code>ï¼‰ã€‚</li></ul><hr><h3 id="19-Conditional-æ³¨è§£çš„ä½œç”¨ï¼Ÿ"><a href="#19-Conditional-æ³¨è§£çš„ä½œç”¨ï¼Ÿ" class="headerlink" title="19. @Conditional æ³¨è§£çš„ä½œç”¨ï¼Ÿ"></a>19. @Conditional æ³¨è§£çš„ä½œç”¨ï¼Ÿ</h3><p><strong>æ ¸å¿ƒå›ç­”ï¼š</strong><br> ç”¨äº <strong>æ¡ä»¶è£…é…</strong>ï¼Œæ ¹æ®ç¯å¢ƒ &#x2F; é…ç½® &#x2F; Bean æ˜¯å¦å­˜åœ¨å†³å®šæ˜¯å¦åŠ è½½ Beanã€‚</p><p><strong>æ·±å…¥è§£æï¼š</strong></p><ul><li>å¸¸è§å®ç°ï¼š<ul><li><code>@ConditionalOnClass</code>ï¼ˆç±»å­˜åœ¨æ—¶è£…é…ï¼‰ï¼›</li><li><code>@ConditionalOnMissingBean</code>ï¼ˆæ²¡æœ‰ Bean æ—¶è£…é…ï¼‰ï¼›</li><li><code>@ConditionalOnProperty</code>ï¼ˆé…ç½®é¡¹æ»¡è¶³æ¡ä»¶æ—¶è£…é…ï¼‰ï¼›</li><li><code>@ConditionalOnWebApplication</code>ã€‚</li></ul></li><li>å¹¿æ³›ç”¨äºè‡ªåŠ¨é…ç½®ã€‚</li></ul><p><strong>å»¶ä¼¸æ€è€ƒï¼š</strong></p><ul><li>é¢è¯•è¿½é—®ï¼šæ€ä¹ˆå†™è‡ªå®šä¹‰æ¡ä»¶ï¼Ÿ<br> â†’ å®ç° <code>Condition</code> æ¥å£ï¼Œé‡å†™ <code>matches()</code> æ–¹æ³•ã€‚</li></ul><hr><h3 id="20-Spring-Boot-å¸¸è§çš„ä¼˜åŒ–ç‚¹ï¼Ÿ"><a href="#20-Spring-Boot-å¸¸è§çš„ä¼˜åŒ–ç‚¹ï¼Ÿ" class="headerlink" title="20. Spring Boot å¸¸è§çš„ä¼˜åŒ–ç‚¹ï¼Ÿ"></a>20. Spring Boot å¸¸è§çš„ä¼˜åŒ–ç‚¹ï¼Ÿ</h3><p><strong>æ ¸å¿ƒå›ç­”ï¼š</strong></p><ul><li>å¯åŠ¨ä¼˜åŒ–ï¼šæ‡’åŠ è½½ã€è£å‰ª Starterï¼›</li><li>å†…å­˜ä¼˜åŒ–ï¼šå‡å° Bean æ•°é‡ã€å¼•å…¥è½»é‡ç»„ä»¶ï¼›</li><li>æ•°æ®åº“ä¼˜åŒ–ï¼šè¿æ¥æ± ã€æ‰¹é‡æ“ä½œï¼›</li><li>ç”Ÿäº§ä¼˜åŒ–ï¼šActuator ç›‘æ§ã€å¤–éƒ¨åŒ–é…ç½®ã€‚</li></ul><p><strong>æ·±å…¥è§£æï¼š</strong></p><ol><li><strong>å¯åŠ¨æ€§èƒ½</strong>ï¼š<code>spring.main.lazy-initialization=true</code>ï¼›</li><li><strong>æ•°æ®åº“æ€§èƒ½</strong>ï¼šHikariCP è¿æ¥æ± ã€æ‰¹å¤„ç† SQLï¼›</li><li><strong>ç¼“å­˜ä¼˜åŒ–</strong>ï¼šæ•´åˆ Redisã€Caffeineï¼›</li><li><strong>æ—¥å¿—ä¼˜åŒ–</strong>ï¼šå¼‚æ­¥æ—¥å¿—ï¼ˆLogback AsyncAppenderï¼‰ï¼›</li><li><strong>éƒ¨ç½²ä¼˜åŒ–</strong>ï¼šåˆ†å±‚æ„å»ºï¼ˆLayered Jarï¼‰ã€Docker é•œåƒåŠ é€Ÿã€‚</li></ol><p><strong>å»¶ä¼¸æ€è€ƒï¼š</strong></p><ul><li>é¢è¯•å¸¸é—®ï¼šSpring Boot ä¸ºä»€ä¹ˆå¯åŠ¨æ¯” Spring æ…¢ï¼Ÿ<br> â†’ å› ä¸ºè¦åšè‡ªåŠ¨è£…é…å’Œç¯å¢ƒæ‰«æã€‚</li><li>å®æˆ˜ï¼šç”Ÿäº§ä¸­å¯ç”¨ <code>spring-context-indexer</code> åŠ å¿«å¯åŠ¨ã€‚</li></ul><hr><h3 id="21-Spring-Boot-çš„è‡ªåŠ¨é…ç½®åŸç†"><a href="#21-Spring-Boot-çš„è‡ªåŠ¨é…ç½®åŸç†" class="headerlink" title="21. Spring Boot çš„è‡ªåŠ¨é…ç½®åŸç†"></a><strong>21. Spring Boot çš„è‡ªåŠ¨é…ç½®åŸç†</strong></h3><p><strong>æ ¸å¿ƒå›ç­”</strong><br> Spring Boot çš„è‡ªåŠ¨é…ç½®åŸºäº <strong>SpringFactoriesLoader + @EnableAutoConfiguration + æ¡ä»¶æ³¨è§£ï¼ˆ@ConditionalXXXï¼‰</strong>ã€‚<br> å®ƒä¼šæ ¹æ® classpath ä¸­ä¾èµ–çš„ jar åŒ…å’Œå·²æœ‰ Bean è‡ªåŠ¨è£…é…æ‰€éœ€çš„é…ç½®ã€‚</p><p><strong>æ·±å…¥è§£æ</strong></p><ol><li><strong>å…³é”®å…¥å£</strong>ï¼š<ul><li><code>@SpringBootApplication</code> â†’ <code>@EnableAutoConfiguration</code> â†’ <code>AutoConfigurationImportSelector</code>ã€‚</li></ul></li><li><strong>é…ç½®æ¥æº</strong>ï¼š<ul><li><code>META-INF/spring.factories</code> æˆ– <code>META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports</code>ã€‚</li></ul></li><li><strong>æ¡ä»¶è£…é…</strong>ï¼š<ul><li>é€šè¿‡ <code>@ConditionalOnClass</code>ã€<code>@ConditionalOnMissingBean</code> ç­‰æ¥é¿å…é‡å¤é…ç½®ã€‚</li></ul></li><li><strong>è¿è¡Œæ—¶æµç¨‹</strong>ï¼š<ul><li>å¯åŠ¨æ—¶åŠ è½½æ‰€æœ‰å€™é€‰é…ç½®ç±» â†’ æ ¹æ®æ¡ä»¶ç­›é€‰ â†’ æ³¨å†Œ BeanDefinition â†’ å®ä¾‹åŒ– Beanã€‚</li></ul></li></ol><p><strong>å»¶ä¼¸æ€è€ƒ</strong></p><ul><li>é¢è¯•è¿½é—®ï¼šå¦‚ä½•æ’æŸ¥â€œä¸ºä»€ä¹ˆæŸä¸ª Bean æ²¡æœ‰ç”Ÿæ•ˆâ€ï¼Ÿ<br> â†’ ä½¿ç”¨ <code>--debug</code> å‚æ•°æŸ¥çœ‹ <strong>è‡ªåŠ¨é…ç½®æŠ¥å‘Š</strong>ã€‚</li><li>å®æˆ˜ï¼šå¦‚æœä¸æƒ³åŠ è½½æŸä¸ªè‡ªåŠ¨é…ç½®ï¼Œå¯ä»¥ç”¨ <code>@SpringBootApplication(exclude=XXXAutoConfiguration.class)</code>ã€‚</li></ul><hr><h3 id="22-Spring-Boot-çš„å¯åŠ¨æµç¨‹"><a href="#22-Spring-Boot-çš„å¯åŠ¨æµç¨‹" class="headerlink" title="22. Spring Boot çš„å¯åŠ¨æµç¨‹"></a><strong>22. Spring Boot çš„å¯åŠ¨æµç¨‹</strong></h3><p><strong>æ ¸å¿ƒå›ç­”</strong><br> å¯åŠ¨æµç¨‹ï¼š</p><ol><li>åˆ›å»º <code>SpringApplication</code> å¯¹è±¡ã€‚</li><li>å‡†å¤‡ç¯å¢ƒï¼ˆEnvironmentï¼‰ã€‚</li><li>åŠ è½½ ApplicationContextã€‚</li><li>è°ƒç”¨è‡ªåŠ¨é…ç½®ã€‚</li><li>å¯åŠ¨å†…åµŒå®¹å™¨ï¼ˆTomcat&#x2F;Jetty&#x2F;Nettyï¼‰ã€‚</li><li>æ‰§è¡Œ <code>CommandLineRunner</code> å’Œ <code>ApplicationRunner</code>ã€‚</li></ol><p><strong>æ·±å…¥è§£æ</strong></p><ul><li><strong>æºç å…¥å£</strong>ï¼š<code>SpringApplication.run()</code>ã€‚</li><li><strong>äº‹ä»¶ç›‘å¬</strong>ï¼š<ul><li><code>ApplicationStartingEvent</code>ï¼ˆæœ€æ—©äº‹ä»¶ï¼‰ï¼Œ</li><li><code>ApplicationReadyEvent</code>ï¼ˆå¯åŠ¨å®Œæˆï¼‰ã€‚</li></ul></li><li><strong>Bean åŠ è½½</strong>ï¼š<ul><li>å…ˆåŠ è½½ä¸»ç±»æ‰€åœ¨åŒ…åŠå­åŒ…çš„ç»„ä»¶ï¼ˆ<code>@ComponentScan</code>ï¼‰ã€‚</li><li>å†ç»“åˆè‡ªåŠ¨é…ç½®ã€‚</li></ul></li></ul><p><strong>å»¶ä¼¸æ€è€ƒ</strong></p><ul><li>é¢è¯•å®˜å¯èƒ½é—®ï¼š<strong>Spring Boot å¦‚ä½•æ”¯æŒå¤–éƒ¨é…ç½®ï¼Ÿ</strong><br> â†’ é€šè¿‡ <code>ConfigFileApplicationListener</code> è§£æ <code>application.properties</code> &#x2F; <code>application.yml</code> å¹¶æ³¨å…¥ Environmentã€‚</li></ul><hr><h3 id="23-Spring-Boot-çš„é…ç½®æ–‡ä»¶åŠ è½½é¡ºåº"><a href="#23-Spring-Boot-çš„é…ç½®æ–‡ä»¶åŠ è½½é¡ºåº" class="headerlink" title="23. Spring Boot çš„é…ç½®æ–‡ä»¶åŠ è½½é¡ºåº"></a><strong>23. Spring Boot çš„é…ç½®æ–‡ä»¶åŠ è½½é¡ºåº</strong></h3><p><strong>æ ¸å¿ƒå›ç­”</strong><br> Spring Boot çš„é…ç½®ä¼˜å…ˆçº§ï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š</p><ol><li>å‘½ä»¤è¡Œå‚æ•°</li><li><code>application.properties/yml</code>ï¼ˆåœ¨ <code>config/</code> &gt; å½“å‰ç›®å½• &gt; classpath ä¸‹ï¼‰</li><li>å¤–éƒ¨ç³»ç»Ÿç¯å¢ƒå˜é‡</li><li>JNDIã€ç³»ç»Ÿå±æ€§</li><li>é»˜è®¤é…ç½®</li></ol><p><strong>æ·±å…¥è§£æ</strong></p><ul><li><strong>å¤š profile</strong>ï¼š<code>application-dev.yml</code> ä¼šåœ¨ <code>--spring.profiles.active=dev</code> æ—¶è¦†ç›–é»˜è®¤é…ç½®ã€‚</li><li><strong>ä¼˜å…ˆçº§æ§åˆ¶</strong>ï¼šåŒä¸€å±æ€§å¤šæ¬¡å®šä¹‰æ—¶ï¼Œé«˜ä¼˜å…ˆçº§è¦†ç›–ä½ä¼˜å…ˆçº§ã€‚</li></ul><p><strong>å»¶ä¼¸æ€è€ƒ</strong></p><ul><li>é¢è¯•è¿½é—®ï¼šå¦‚æœé…ç½®å†²çªï¼Œå¦‚ä½•å¿«é€Ÿå®šä½ï¼Ÿ<br> â†’ å¯åŠ¨æ—¶åŠ å‚æ•° <code>--debug</code>ï¼ŒæŸ¥çœ‹é…ç½®æºå’Œä¼˜å…ˆçº§ã€‚</li></ul><hr><h3 id="24-Spring-Boot-å¦‚ä½•å®ç°çƒ­éƒ¨ç½²"><a href="#24-Spring-Boot-å¦‚ä½•å®ç°çƒ­éƒ¨ç½²" class="headerlink" title="24. Spring Boot å¦‚ä½•å®ç°çƒ­éƒ¨ç½²"></a><strong>24. Spring Boot å¦‚ä½•å®ç°çƒ­éƒ¨ç½²</strong></h3><p><strong>æ ¸å¿ƒå›ç­”</strong><br> é€šè¿‡ <strong>Spring Boot DevTools</strong> æˆ– <strong>JRebel</strong> å®ç°çƒ­éƒ¨ç½²ã€‚</p><p><strong>æ·±å…¥è§£æ</strong></p><ul><li><strong>DevTools åŸç†</strong>ï¼š<ul><li>ä½¿ç”¨ä¸¤ä¸ª ClassLoaderï¼š<ul><li>Base ClassLoaderï¼ˆç¬¬ä¸‰æ–¹ä¾èµ–ä¸ä¼šå˜ï¼‰ï¼Œ</li><li>Restart ClassLoaderï¼ˆè‡ªå·±ä»£ç ï¼Œæ”¹åŠ¨ååªé‡æ–°åŠ è½½ï¼‰ã€‚</li></ul></li></ul></li><li><strong>å±€é™æ€§</strong>ï¼šä¿®æ”¹ä¾èµ–åº“ä¸ä¼šè§¦å‘çƒ­éƒ¨ç½²ï¼Œåªèƒ½é‡å¯ã€‚</li></ul><p><strong>å»¶ä¼¸æ€è€ƒ</strong></p><ul><li>å®é™…å¼€å‘ä¸­æ¨èç”¨ <strong>DevTools + IDEA è‡ªåŠ¨æ„å»º</strong>ã€‚</li><li>é¢è¯•è¿½é—®ï¼šç”Ÿäº§ç¯å¢ƒå¦‚ä½•å®ç°çƒ­æ›´æ–°ï¼Ÿ<br> â†’ ä½¿ç”¨ Spring Cloud Config + åŠ¨æ€åˆ·æ–°ï¼ˆ<code>/actuator/refresh</code>ï¼‰ã€‚</li></ul><hr><h3 id="25-Spring-Boot-ä¸­çš„ç›‘æ§å’Œå¥åº·æ£€æŸ¥"><a href="#25-Spring-Boot-ä¸­çš„ç›‘æ§å’Œå¥åº·æ£€æŸ¥" class="headerlink" title="25. Spring Boot ä¸­çš„ç›‘æ§å’Œå¥åº·æ£€æŸ¥"></a><strong>25. Spring Boot ä¸­çš„ç›‘æ§å’Œå¥åº·æ£€æŸ¥</strong></h3><p><strong>æ ¸å¿ƒå›ç­”</strong><br> Spring Boot æä¾› <strong>Actuator æ¨¡å—</strong>ï¼Œå¯ç›‘æ§åº”ç”¨è¿è¡ŒçŠ¶æ€ã€‚</p><p><strong>æ·±å…¥è§£æ</strong></p><ul><li>å¸¸è§ç«¯ç‚¹ï¼š<ul><li><code>/actuator/health</code>ï¼ˆå¥åº·æ£€æŸ¥ï¼‰</li><li><code>/actuator/metrics</code>ï¼ˆæ€§èƒ½æŒ‡æ ‡ï¼‰</li><li><code>/actuator/env</code>ï¼ˆç¯å¢ƒå˜é‡ï¼‰</li><li><code>/actuator/beans</code>ï¼ˆå·²åŠ è½½ Beanï¼‰</li></ul></li><li>å¥åº·æ£€æŸ¥å¯æ‰©å±•ï¼šå®ç° <code>HealthIndicator</code> æ¥å£ï¼Œè‡ªå®šä¹‰æ£€æŸ¥é€»è¾‘ï¼ˆå¦‚ Redisã€MQï¼‰ã€‚</li></ul><p><strong>å»¶ä¼¸æ€è€ƒ</strong></p><ul><li>é¢è¯•è¿½é—®ï¼šå¦‚ä½•åœ¨ Kubernetes ä¸­ç»“åˆå¥åº·æ£€æŸ¥ï¼Ÿ<br> â†’ é…ç½® <strong>livenessProbe</strong> å’Œ <strong>readinessProbe</strong> è°ƒç”¨ <code>/actuator/health</code>ã€‚</li></ul><hr><h3 id="26-Spring-Boot-å¦‚ä½•é›†æˆæ•°æ®åº“ï¼ˆJDBCã€JPAã€MyBatisï¼‰"><a href="#26-Spring-Boot-å¦‚ä½•é›†æˆæ•°æ®åº“ï¼ˆJDBCã€JPAã€MyBatisï¼‰" class="headerlink" title="26. Spring Boot å¦‚ä½•é›†æˆæ•°æ®åº“ï¼ˆJDBCã€JPAã€MyBatisï¼‰"></a><strong>26. Spring Boot å¦‚ä½•é›†æˆæ•°æ®åº“ï¼ˆJDBCã€JPAã€MyBatisï¼‰</strong></h3><p><strong>æ ¸å¿ƒå›ç­”</strong><br> Spring Boot æä¾› <code>spring-boot-starter-jdbc</code>ã€<code>spring-boot-starter-data-jpa</code> ç­‰ starterï¼Œæ”¯æŒå¼€ç®±å³ç”¨ã€‚</p><p><strong>æ·±å…¥è§£æ</strong></p><ul><li><strong>JDBC</strong>ï¼šç›´æ¥æ“ä½œæ•°æ®åº“ï¼Œç»“åˆ <code>JdbcTemplate</code>ã€‚</li><li><strong>JPA</strong>ï¼šåŸºäº Hibernateï¼Œæ”¯æŒå£°æ˜å¼ ORMï¼ˆ<code>@Entity</code>ï¼‰ã€‚</li><li><strong>MyBatis</strong>ï¼šéœ€å¼•å…¥ç¬¬ä¸‰æ–¹ starterï¼ˆ<code>mybatis-spring-boot-starter</code>ï¼‰ï¼Œç”¨ <code>@MapperScan</code>ã€‚</li></ul><p><strong>å»¶ä¼¸æ€è€ƒ</strong></p><ul><li>é¢è¯•è¿½é—®ï¼š<strong>Spring Data JPA ä¸ MyBatis åŒºåˆ«ï¼Ÿ</strong><ul><li>JPA â†’ ORM è‡ªåŠ¨åŒ–ï¼Œé€‚åˆå¿«é€Ÿå¼€å‘ã€‚</li><li>MyBatis â†’ SQL æ‰‹å†™ï¼Œçµæ´»å¯æ§ï¼Œé€‚åˆå¤æ‚ä¸šåŠ¡ã€‚</li></ul></li></ul><hr><h3 id="27-Spring-Boot-å¦‚ä½•å®ç°æ—¥å¿—ç®¡ç†"><a href="#27-Spring-Boot-å¦‚ä½•å®ç°æ—¥å¿—ç®¡ç†" class="headerlink" title="27. Spring Boot å¦‚ä½•å®ç°æ—¥å¿—ç®¡ç†"></a><strong>27. Spring Boot å¦‚ä½•å®ç°æ—¥å¿—ç®¡ç†</strong></h3><p><strong>æ ¸å¿ƒå›ç­”</strong><br> Spring Boot é»˜è®¤ä½¿ç”¨ <strong>SLF4J + Logback</strong>ï¼Œå¯æ”¯æŒ Log4j2ã€‚</p><p><strong>æ·±å…¥è§£æ</strong></p><ul><li><strong>é…ç½®æ–¹å¼</strong>ï¼š<ul><li><code>application.yml</code> æˆ– <code>logback-spring.xml</code>ã€‚</li></ul></li><li><strong>æ—¥å¿—çº§åˆ«</strong>ï¼š<code>TRACE</code> &lt; <code>DEBUG</code> &lt; <code>INFO</code> &lt; <code>WARN</code> &lt; <code>ERROR</code>ã€‚</li><li><strong>å¤šç¯å¢ƒæ—¥å¿—</strong>ï¼š<ul><li><code>logback-spring.xml</code> + <code>springProfile</code> æ ‡ç­¾å¯åŒºåˆ† dev &#x2F; prodã€‚</li></ul></li></ul><p><strong>å»¶ä¼¸æ€è€ƒ</strong></p><ul><li>é¢è¯•è¿½é—®ï¼šå¦‚ä½•å°†æ—¥å¿—è¾“å‡ºåˆ° ELKï¼ˆElasticSearch + Logstash + Kibanaï¼‰ï¼Ÿ<br> â†’ ä½¿ç”¨ <code>logstash-logback-encoder</code>ã€‚</li></ul><hr><h3 id="28-Spring-Boot-å¦‚ä½•å¤„ç†è·¨åŸŸé—®é¢˜ï¼ˆCORSï¼‰"><a href="#28-Spring-Boot-å¦‚ä½•å¤„ç†è·¨åŸŸé—®é¢˜ï¼ˆCORSï¼‰" class="headerlink" title="28. Spring Boot å¦‚ä½•å¤„ç†è·¨åŸŸé—®é¢˜ï¼ˆCORSï¼‰"></a><strong>28. Spring Boot å¦‚ä½•å¤„ç†è·¨åŸŸé—®é¢˜ï¼ˆCORSï¼‰</strong></h3><p><strong>æ ¸å¿ƒå›ç­”</strong><br> é€šè¿‡ <strong>@CrossOrigin</strong> æˆ–å…¨å±€é…ç½® <code>CorsFilter</code>ã€‚</p><p><strong>æ·±å…¥è§£æ</strong></p><ul><li><p><strong>æ–¹å¼1ï¼šæ³¨è§£</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CrossOrigin(origins=&quot;http://example.com&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/api/data&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getData</span><span class="params">()</span> &#123; ... &#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>æ–¹å¼2ï¼šå…¨å±€é…ç½®</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> WebMvcConfigurer <span class="title function_">corsConfigurer</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WebMvcConfigurer</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addCorsMappings</span><span class="params">(CorsRegistry registry)</span> &#123;</span><br><span class="line">            registry.addMapping(<span class="string">&quot;/**&quot;</span>).allowedOrigins(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p><strong>å»¶ä¼¸æ€è€ƒ</strong></p><ul><li>é¢è¯•è¿½é—®ï¼šCORS å’Œ Nginx åå‘ä»£ç†è·¨åŸŸçš„åŒºåˆ«ï¼Ÿ<ul><li>CORS â†’ Spring Boot å¤„ç†ï¼Œé€‚åˆå•åº”ç”¨ã€‚</li><li>Nginx â†’ ç½‘å…³å±‚å¤„ç†ï¼Œé€‚åˆå¾®æœåŠ¡æ¶æ„ã€‚</li></ul></li></ul><hr><h3 id="29-Spring-Boot-ä¸­çš„å®‰å…¨æœºåˆ¶ï¼ˆSpring-Securityï¼‰"><a href="#29-Spring-Boot-ä¸­çš„å®‰å…¨æœºåˆ¶ï¼ˆSpring-Securityï¼‰" class="headerlink" title="29. Spring Boot ä¸­çš„å®‰å…¨æœºåˆ¶ï¼ˆSpring Securityï¼‰"></a><strong>29. Spring Boot ä¸­çš„å®‰å…¨æœºåˆ¶ï¼ˆSpring Securityï¼‰</strong></h3><p><strong>æ ¸å¿ƒå›ç­”</strong><br> Spring Security æä¾›è®¤è¯ï¼ˆAuthenticationï¼‰+ æˆæƒï¼ˆAuthorizationï¼‰ã€‚</p><p><strong>æ·±å…¥è§£æ</strong></p><ol><li><strong>è®¤è¯æµç¨‹</strong>ï¼š<ul><li>ç”¨æˆ·è¯·æ±‚ â†’ <code>UsernamePasswordAuthenticationFilter</code> â†’ AuthenticationManager â†’ UserDetailsService â†’ è®¤è¯æˆåŠŸ â†’ SecurityContext ä¿å­˜ä¿¡æ¯ã€‚</li></ul></li><li><strong>æˆæƒæœºåˆ¶</strong>ï¼š<ul><li>åŸºäº URLï¼ˆæ‹¦æˆªè·¯å¾„ï¼‰ã€æ–¹æ³•çº§ï¼ˆ<code>@PreAuthorize</code>ï¼‰ã€è¡¨è¾¾å¼ã€‚</li></ul></li><li><strong>é»˜è®¤ç”¨æˆ·</strong>ï¼šSpring Boot 2.x é»˜è®¤ç”Ÿæˆéšæœºå¯†ç ï¼ˆæ—¥å¿—ä¸­è¾“å‡ºï¼‰ã€‚</li></ol><p><strong>å»¶ä¼¸æ€è€ƒ</strong></p><ul><li>é¢è¯•è¿½é—®ï¼šå¦‚ä½•åœ¨ Spring Security ä¸­é›†æˆ JWTï¼Ÿ<ul><li>è‡ªå®šä¹‰è¿‡æ»¤å™¨ï¼Œè§£æ JWT å¹¶æ³¨å…¥ SecurityContextã€‚</li></ul></li></ul><hr><h3 id="30-å¦‚ä½•ä¼˜åŒ–-Spring-Boot-å¯åŠ¨é€Ÿåº¦"><a href="#30-å¦‚ä½•ä¼˜åŒ–-Spring-Boot-å¯åŠ¨é€Ÿåº¦" class="headerlink" title="30. å¦‚ä½•ä¼˜åŒ– Spring Boot å¯åŠ¨é€Ÿåº¦"></a><strong>30. å¦‚ä½•ä¼˜åŒ– Spring Boot å¯åŠ¨é€Ÿåº¦</strong></h3><p><strong>æ ¸å¿ƒå›ç­”</strong><br> ä¼˜åŒ–æ‰‹æ®µï¼šå‡å°‘è‡ªåŠ¨é…ç½®ã€å»¶è¿Ÿåˆå§‹åŒ–ã€å¼•å…¥è½»é‡ä¾èµ–ã€‚</p><p><strong>æ·±å…¥è§£æ</strong></p><ul><li><strong>å»¶è¿ŸåŠ è½½</strong>ï¼š<code>spring.main.lazy-initialization=true</code>ã€‚</li><li><strong>ç§»é™¤ä¸å¿…è¦çš„ starter</strong>ã€‚</li><li><strong>æœ¬åœ°è°ƒè¯•æ—¶è·³è¿‡å®‰å…¨&#x2F;ç›‘æ§é…ç½®</strong>ã€‚</li><li><strong>ä½¿ç”¨ GraalVM Native Image åŠ é€Ÿå¯åŠ¨</strong>ã€‚</li></ul><p><strong>å»¶ä¼¸æ€è€ƒ</strong></p><ul><li>é¢è¯•è¿½é—®ï¼šSpring Boot å¯åŠ¨æ…¢ï¼Œå¦‚ä½•æ’æŸ¥ï¼Ÿ<ul><li>ä½¿ç”¨ <code>--debug</code> å’Œ <code>ApplicationStartup</code> æŸ¥çœ‹ Bean åŠ è½½è€—æ—¶ã€‚</li></ul></li></ul><hr><h2 id="äº”ã€Spring-Cloudï¼ˆ30é¢˜ï¼‰"><a href="#äº”ã€Spring-Cloudï¼ˆ30é¢˜ï¼‰" class="headerlink" title="äº”ã€Spring Cloudï¼ˆ30é¢˜ï¼‰"></a>äº”ã€Spring Cloudï¼ˆ30é¢˜ï¼‰</h2><hr><h2 id="1-Spring-Cloud-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#1-Spring-Cloud-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1. Spring Cloud æ˜¯ä»€ä¹ˆï¼Ÿ"></a><strong>1. Spring Cloud æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h2><p><strong>æ ¸å¿ƒå›ç­”</strong><br> Spring Cloud æ˜¯åŸºäº Spring Boot çš„å¾®æœåŠ¡æ²»ç†æ¡†æ¶ï¼Œæä¾›äº†åˆ†å¸ƒå¼ç³»ç»Ÿæ‰€éœ€çš„å…¨å¥—ç»„ä»¶ï¼šæœåŠ¡æ³¨å†Œå‘ç°ã€è´Ÿè½½å‡è¡¡ã€é…ç½®ä¸­å¿ƒã€ç½‘å…³ã€ç†”æ–­é™æµã€é“¾è·¯è¿½è¸ªç­‰ã€‚</p><p><strong>æ·±å…¥åŸç†</strong></p><ul><li><strong>å®šä½</strong>ï¼šå¾®æœåŠ¡çš„ â€œç”Ÿæ€æ•´åˆè€…â€ï¼Œä¸æ˜¯å•ä¸€æŠ€æœ¯ï¼Œè€Œæ˜¯ä¸€å¥—è§£å†³æ–¹æ¡ˆã€‚</li><li><strong>æ ¸å¿ƒç»„ä»¶</strong>ï¼š<ul><li>Eurekaï¼ˆæ³¨å†Œä¸­å¿ƒï¼‰</li><li>Ribbon &#x2F; LoadBalancerï¼ˆå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ï¼‰</li><li>Feignï¼ˆå£°æ˜å¼è¿œç¨‹è°ƒç”¨ï¼‰</li><li>Hystrix &#x2F; Resilience4j &#x2F; Sentinelï¼ˆç†”æ–­é™æµï¼‰</li><li>Config Serverï¼ˆé…ç½®ä¸­å¿ƒï¼‰</li><li>Gatewayï¼ˆç½‘å…³ï¼‰</li><li>Sleuth + Zipkinï¼ˆé“¾è·¯è¿½è¸ªï¼‰</li></ul></li><li><strong>æœ¬è´¨</strong>ï¼šè§£å†³åˆ†å¸ƒå¼å¤æ‚æ€§ï¼Œé™ä½å¼€å‘é—¨æ§›ã€‚</li></ul><p><strong>é¢è¯•å»¶ä¼¸</strong></p><ul><li>Spring Cloud ä¸ Kubernetes Service Mesh çš„åŒºåˆ«ï¼šå‰è€… SDK æ¨¡å¼ï¼Œåè€… Sidecar æ¨¡å¼ã€‚</li></ul><hr><h2 id="2-Spring-Cloud-å’Œ-Dubbo-çš„åŒºåˆ«ï¼Ÿ"><a href="#2-Spring-Cloud-å’Œ-Dubbo-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="2. Spring Cloud å’Œ Dubbo çš„åŒºåˆ«ï¼Ÿ"></a><strong>2. Spring Cloud å’Œ Dubbo çš„åŒºåˆ«ï¼Ÿ</strong></h2><p><strong>æ ¸å¿ƒå›ç­”</strong></p><ul><li>Dubboï¼šé«˜æ€§èƒ½ RPC æ¡†æ¶ï¼Œæ ¸å¿ƒæ˜¯è¿œç¨‹è°ƒç”¨ã€‚</li><li>Spring Cloudï¼šå…¨å®¶æ¡¶å¼å¾®æœåŠ¡ç”Ÿæ€ï¼ŒåŠŸèƒ½æ›´å…¨é¢ã€‚</li></ul><p><strong>æ·±å…¥åŸç†</strong></p><ul><li>åè®®å±‚ï¼šDubbo ç”¨ TCP&#x2F;è‡ªå®šä¹‰åè®®ï¼Œæ€§èƒ½é«˜ï¼›Spring Cloud å¤šç”¨ REST&#x2F;HTTPã€‚</li><li>åŠŸèƒ½è¦†ç›–ï¼šDubbo ä¸»è¦åšæœåŠ¡è°ƒç”¨ï¼ŒSpring Cloud åŒ…å«æ³¨å†Œã€é…ç½®ã€ç†”æ–­ã€ç½‘å…³ç­‰ã€‚</li><li>æ¼”è¿›ï¼šDubbo3.0 å¼€å§‹æ”¯æŒ gRPC&#x2F;Triple åè®®ï¼Œä¸ Spring Cloud è¶Šæ¥è¶Šæ¥è¿‘ã€‚</li></ul><p><strong>é¢è¯•å»¶ä¼¸</strong></p><ul><li>å…¬å¸å†…ç½‘åœºæ™¯ï¼ˆè¿½æ±‚æ€§èƒ½ï¼‰ â†’ Dubboï¼›</li><li>å¤§è§„æ¨¡åˆ†å¸ƒå¼äº’è”ç½‘åœºæ™¯ï¼ˆè¿½æ±‚ç”Ÿæ€ï¼‰ â†’ Spring Cloudã€‚</li></ul><hr><h2 id="3-Eureka-çš„å·¥ä½œåŸç†ï¼Ÿ"><a href="#3-Eureka-çš„å·¥ä½œåŸç†ï¼Ÿ" class="headerlink" title="3. Eureka çš„å·¥ä½œåŸç†ï¼Ÿ"></a><strong>3. Eureka çš„å·¥ä½œåŸç†ï¼Ÿ</strong></h2><p><strong>æ ¸å¿ƒå›ç­”</strong><br> Eureka æ˜¯ Netflix å¼€æºçš„æ³¨å†Œä¸­å¿ƒï¼Œè´Ÿè´£ <strong>æœåŠ¡æ³¨å†Œä¸å‘ç°</strong>ï¼Œéµå¾ª <strong>AP</strong> åŸåˆ™ã€‚</p><p><strong>æ·±å…¥åŸç†</strong></p><ul><li><strong>æ³¨å†Œ</strong>ï¼šæœåŠ¡å¯åŠ¨åå°†è‡ªèº«ä¿¡æ¯ï¼ˆIPã€ç«¯å£ã€çŠ¶æ€ï¼‰æ³¨å†Œåˆ° Eureka Serverã€‚</li><li><strong>ç»­çº¦</strong>ï¼šæœåŠ¡å®šæœŸå‘é€å¿ƒè·³ï¼ˆé»˜è®¤ 30sï¼‰ã€‚</li><li><strong>ä¸‹çº¿</strong>ï¼šæœåŠ¡å…³é—­æ—¶å‘é€ä¸‹çº¿è¯·æ±‚ã€‚</li><li><strong>æ‹‰å–</strong>ï¼šå®¢æˆ·ç«¯å®šæœŸä» Server æ‹‰å–æ³¨å†Œè¡¨ï¼ˆé»˜è®¤ 30sï¼‰ï¼Œæœ¬åœ°ç¼“å­˜ï¼Œæé«˜å¯ç”¨æ€§ã€‚</li></ul><p><strong>é¢è¯•å»¶ä¼¸</strong></p><ul><li>é¢è¯•å®˜å¯èƒ½é—®ï¼šEureka ä¸ Zookeeper åŒºåˆ«ï¼Ÿ<ul><li>Eureka AP â†’ ä¿è¯å¯ç”¨æ€§ï¼ˆå³ä½¿éƒ¨åˆ†èŠ‚ç‚¹æŒ‚äº†ä»èƒ½æœåŠ¡ï¼‰ï¼›</li><li>Zookeeper CP â†’ å¼ºä¸€è‡´æ€§ï¼ˆé€‰ä¸¾å¯èƒ½å¯¼è‡´æœåŠ¡ä¸å¯ç”¨ï¼‰ã€‚</li></ul></li></ul><hr><h2 id="4-Eureka-çš„è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶ï¼Ÿ"><a href="#4-Eureka-çš„è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶ï¼Ÿ" class="headerlink" title="4. Eureka çš„è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶ï¼Ÿ"></a><strong>4. Eureka çš„è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶ï¼Ÿ</strong></h2><p><strong>æ ¸å¿ƒå›ç­”</strong><br> Eureka ä¼šåœ¨ç½‘ç»œåˆ†åŒºæˆ–å¿ƒè·³ä¸¢å¤±æ—¶ï¼Œ<strong>ä¸ç«‹å³ç§»é™¤æœåŠ¡å®ä¾‹</strong>ï¼Œä¿è¯å¯ç”¨æ€§ã€‚</p><p><strong>æ·±å…¥åŸç†</strong></p><ul><li>è§¦å‘æ¡ä»¶ï¼šåœ¨ 15 åˆ†é’Ÿå†…å¿ƒè·³å¤±è´¥æ¯”ä¾‹ &gt; 85%ã€‚</li><li>è¡Œä¸ºï¼š<ul><li>æš‚åœå‰”é™¤å¤±æ•ˆæœåŠ¡ã€‚</li><li>ä¿ç•™å·²æœ‰æ³¨å†Œè¡¨ï¼Œå…è®¸å®¢æˆ·ç«¯ç»§ç»­è·å–æœåŠ¡ã€‚</li></ul></li><li>å¥½å¤„ï¼šé˜²æ­¢å› ç½‘ç»œæŠ–åŠ¨å¯¼è‡´â€œæœåŠ¡é›ªå´©â€ã€‚</li></ul><p><strong>é¢è¯•å»¶ä¼¸</strong></p><ul><li>ç¼ºç‚¹ï¼šå¯èƒ½æŠŠå·²ç»å®•æœºçš„å®ä¾‹ç»§ç»­æš´éœ²å‡ºå»ã€‚</li><li>å¯é…ç½® <code>eureka.server.enable-self-preservation=false</code> æ¥å…³é—­ã€‚</li></ul><hr><h2 id="5-Ribbon-çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Ÿ"><a href="#5-Ribbon-çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Ÿ" class="headerlink" title="5. Ribbon çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Ÿ"></a><strong>5. Ribbon çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Ÿ</strong></h2><p><strong>æ ¸å¿ƒå›ç­”</strong><br> Ribbon æ˜¯å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ç»„ä»¶ï¼Œå¸¸è§ç­–ç•¥æœ‰ï¼š</p><ul><li>è½®è¯¢ï¼ˆRoundRobinï¼‰</li><li>éšæœºï¼ˆRandomï¼‰</li><li>æƒé‡ï¼ˆWeightedResponseTimeRuleï¼‰</li><li>æœ€å°å¹¶å‘ï¼ˆBestAvailableRuleï¼‰</li></ul><p><strong>æ·±å…¥åŸç†</strong><br> Ribbon åœ¨å®¢æˆ·ç«¯ç»´æŠ¤æœåŠ¡åˆ—è¡¨ï¼Œä»æ³¨å†Œä¸­å¿ƒæ‹‰å–åï¼Œæ ¹æ®ç­–ç•¥é€‰æ‹©ç›®æ ‡æœåŠ¡å‘èµ·è¯·æ±‚ã€‚</p><p><strong>é¢è¯•å»¶ä¼¸</strong></p><ul><li>ä¸ Nginx çš„åŒºåˆ«ï¼šRibbon æ˜¯ <strong>å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡</strong>ï¼ˆè°ƒç”¨æ–¹å†³å®šï¼‰ï¼ŒNginx æ˜¯ <strong>æœåŠ¡ç«¯è´Ÿè½½å‡è¡¡</strong>ï¼ˆè¯·æ±‚å…ˆåˆ°ä»£ç†ï¼‰ã€‚</li></ul><hr><h2 id="6-Ribbon-å’Œ-Nginx-çš„åŒºåˆ«ï¼Ÿ"><a href="#6-Ribbon-å’Œ-Nginx-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="6. Ribbon å’Œ Nginx çš„åŒºåˆ«ï¼Ÿ"></a><strong>6. Ribbon å’Œ Nginx çš„åŒºåˆ«ï¼Ÿ</strong></h2><p><strong>æ ¸å¿ƒå›ç­”</strong></p><ul><li>Ribbonï¼šå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ï¼Œæœ¬åœ°å†³å®šè°ƒç”¨å“ªå°æœåŠ¡ã€‚</li><li>Nginxï¼šæœåŠ¡ç«¯è´Ÿè½½å‡è¡¡ï¼Œæ‰€æœ‰æµé‡å…ˆç»è¿‡ä»£ç†ã€‚</li></ul><p><strong>æ·±å…¥åŸç†</strong></p><ul><li><strong>éƒ¨ç½²ä½ç½®</strong>ï¼šRibbon åœ¨è°ƒç”¨æ–¹åº”ç”¨ä¸­ï¼ŒNginx ç‹¬ç«‹éƒ¨ç½²ã€‚</li><li><strong>æ‰©å±•æ€§</strong>ï¼šRibbon ä¸ Eureka é…åˆï¼Œæ”¯æŒåŠ¨æ€ä¸Šä¸‹çº¿ï¼›Nginx éœ€æ‰‹åŠ¨æ”¹é…ç½®æˆ–å€ŸåŠ© Consul&#x2F;Keepalivedã€‚</li></ul><p><strong>é¢è¯•å»¶ä¼¸</strong></p><ul><li>é¢è¯•å®˜è¿½é—®ï¼šä¸ºä»€ä¹ˆå¾®æœåŠ¡æ›´å€¾å‘äº Ribbonï¼Ÿ<ul><li>å› ä¸ºå®¢æˆ·ç«¯æ¨¡å¼æ›´çµæ´»ï¼Œå¯ä»¥æ— æ„ŸçŸ¥æ‰©å®¹&#x2F;ç¼©å®¹ã€‚</li></ul></li></ul><hr><h2 id="7-Feign-çš„å·¥ä½œåŸç†ï¼Ÿ"><a href="#7-Feign-çš„å·¥ä½œåŸç†ï¼Ÿ" class="headerlink" title="7. Feign çš„å·¥ä½œåŸç†ï¼Ÿ"></a><strong>7. Feign çš„å·¥ä½œåŸç†ï¼Ÿ</strong></h2><p><strong>æ ¸å¿ƒå›ç­”</strong><br> Feign æ˜¯å£°æ˜å¼ HTTP å®¢æˆ·ç«¯ï¼Œé€šè¿‡æ¥å£ + æ³¨è§£çš„æ–¹å¼è°ƒç”¨è¿œç¨‹æœåŠ¡ã€‚</p><p><strong>æ·±å…¥åŸç†</strong></p><ul><li>è¿è¡Œæ—¶åŸºäº <strong>åŠ¨æ€ä»£ç†</strong>ï¼ˆJDK Proxyï¼‰ã€‚</li><li>ç»“åˆ Ribbon è´Ÿè½½å‡è¡¡ï¼Œè‡ªåŠ¨é€‰æ‹©æœåŠ¡å®ä¾‹ã€‚</li><li>å¯é›†æˆ Hystrix&#x2F;Sentinelï¼Œæ”¯æŒç†”æ–­ã€‚</li></ul><p><strong>é¢è¯•å»¶ä¼¸</strong></p><ul><li>é¢è¯•å®˜é—®ï¼šFeign å’Œ RestTemplate çš„åŒºåˆ«ï¼Ÿ<ul><li>RestTemplate â†’ ä»£ç ä¾µå…¥æ€§å¼ºï¼Œéœ€è¦æ‰‹åŠ¨æ‹¼æ¥è¯·æ±‚ã€‚</li><li>Feign â†’ å£°æ˜å¼ï¼Œæ›´ä¼˜é›…ã€‚</li></ul></li></ul><hr><h2 id="8-Feign-å¦‚ä½•æ”¯æŒç†”æ–­ï¼Ÿ"><a href="#8-Feign-å¦‚ä½•æ”¯æŒç†”æ–­ï¼Ÿ" class="headerlink" title="8. Feign å¦‚ä½•æ”¯æŒç†”æ–­ï¼Ÿ"></a><strong>8. Feign å¦‚ä½•æ”¯æŒç†”æ–­ï¼Ÿ</strong></h2><p><strong>æ ¸å¿ƒå›ç­”</strong><br> Feign å¯é›†æˆ Hystrix æˆ– Sentinelï¼Œé€šè¿‡ <strong>Fallback</strong> æä¾›é™çº§é€»è¾‘ã€‚</p><p><strong>æ·±å…¥åŸç†</strong></p><ul><li>Hystrixï¼šåœ¨è¯·æ±‚å¤±è´¥&#x2F;è¶…æ—¶æ—¶è°ƒç”¨ fallback æ–¹æ³•ã€‚</li><li>Sentinelï¼šé€šè¿‡æ³¨è§£ @SentinelResource + fallback å®ç°ã€‚</li></ul><p><strong>é¢è¯•å»¶ä¼¸</strong></p><ul><li>é¢è¯•å®˜è¿½é—®ï¼šç†”æ–­å’Œé™çº§åŒºåˆ«ï¼Ÿ<ul><li>ç†”æ–­ï¼šä¿æŠ¤ç³»ç»Ÿä¸è¢«æ‹–å®ã€‚</li><li>é™çº§ï¼šæä¾›å…œåº•é€»è¾‘ï¼Œä¿è¯ç”¨æˆ·ä½“éªŒã€‚</li></ul></li></ul><hr><h2 id="9-Hystrix-çš„å·¥ä½œåŸç†ï¼Ÿ"><a href="#9-Hystrix-çš„å·¥ä½œåŸç†ï¼Ÿ" class="headerlink" title="9. Hystrix çš„å·¥ä½œåŸç†ï¼Ÿ"></a><strong>9. Hystrix çš„å·¥ä½œåŸç†ï¼Ÿ</strong></h2><p><strong>æ ¸å¿ƒå›ç­”</strong><br> Hystrix é€šè¿‡ <strong>çº¿ç¨‹æ± éš”ç¦» + ç†”æ–­å™¨æœºåˆ¶</strong> ä¿æŠ¤æœåŠ¡ï¼Œé˜²æ­¢é›ªå´©æ•ˆåº”ã€‚</p><p><strong>æ·±å…¥åŸç†</strong></p><ul><li><strong>çº¿ç¨‹æ± éš”ç¦»</strong>ï¼šä¸åŒæœåŠ¡è°ƒç”¨ç”¨ä¸åŒçº¿ç¨‹æ± ï¼Œé¿å…ç›¸äº’å½±å“ã€‚</li><li><strong>ç†”æ–­æœºåˆ¶</strong>ï¼š<ul><li>ç»Ÿè®¡è¯·æ±‚å¤±è´¥ç‡ã€‚</li><li>è¾¾åˆ°é˜ˆå€¼ â†’ ç†”æ–­æ‰“å¼€ï¼Œç›´æ¥èµ° fallbackã€‚</li><li>ä¸€æ®µæ—¶é—´å â†’ å°è¯•åŠå¼€ï¼ŒæˆåŠŸåˆ™æ¢å¤ã€‚</li></ul></li></ul><p><strong>é¢è¯•å»¶ä¼¸</strong></p><ul><li>Hystrix å·²åœæ­¢ç»´æŠ¤ï¼Œæ¨èç”¨ Resilience4j æˆ– Sentinelã€‚</li></ul><hr><h2 id="10-Hystrix-çš„çº¿ç¨‹æ± éš”ç¦»å’Œä¿¡å·é‡éš”ç¦»ï¼Ÿ"><a href="#10-Hystrix-çš„çº¿ç¨‹æ± éš”ç¦»å’Œä¿¡å·é‡éš”ç¦»ï¼Ÿ" class="headerlink" title="10. Hystrix çš„çº¿ç¨‹æ± éš”ç¦»å’Œä¿¡å·é‡éš”ç¦»ï¼Ÿ"></a><strong>10. Hystrix çš„çº¿ç¨‹æ± éš”ç¦»å’Œä¿¡å·é‡éš”ç¦»ï¼Ÿ</strong></h2><p><strong>æ ¸å¿ƒå›ç­”</strong></p><ul><li><strong>çº¿ç¨‹æ± éš”ç¦»</strong>ï¼šæ¯ä¸ªä¾èµ–ç”¨ç‹¬ç«‹çº¿ç¨‹æ± ï¼Œé€‚åˆè€—æ—¶æ“ä½œã€‚</li><li><strong>ä¿¡å·é‡éš”ç¦»</strong>ï¼šé™åˆ¶å¹¶å‘æ•°ï¼Œä¸å¼€çº¿ç¨‹æ± ï¼Œé€‚åˆä½å»¶è¿Ÿæ“ä½œã€‚</li></ul><p><strong>æ·±å…¥åŸç†</strong></p><ul><li>çº¿ç¨‹æ± éš”ç¦»ï¼šå¼€é”€å¤§ï¼Œä½†æœ€å®‰å…¨ã€‚</li><li>ä¿¡å·é‡éš”ç¦»ï¼šè½»é‡ï¼Œä½†ä¸èƒ½é˜²æ­¢è°ƒç”¨é˜»å¡çº¿ç¨‹ã€‚</li></ul><p><strong>é¢è¯•å»¶ä¼¸</strong></p><ul><li>å®æˆ˜ç»éªŒï¼šå¤§å¤šæ•° IO è°ƒç”¨ç”¨çº¿ç¨‹æ± éš”ç¦»ï¼Œæœ¬åœ°è®¡ç®—æˆ–è½»é‡è°ƒç”¨ç”¨ä¿¡å·é‡éš”ç¦»ã€‚</li></ul><hr><h2 id="11-Resilience4j-å’Œ-Hystrix-åŒºåˆ«ï¼Ÿ"><a href="#11-Resilience4j-å’Œ-Hystrix-åŒºåˆ«ï¼Ÿ" class="headerlink" title="11. Resilience4j å’Œ Hystrix åŒºåˆ«ï¼Ÿ"></a><strong>11. Resilience4j å’Œ Hystrix åŒºåˆ«ï¼Ÿ</strong></h2><ul><li>Resilience4j åŸºäº Java 8 å‡½æ•°å¼æ¥å£ï¼Œæ›´è½»é‡ï¼Œæ”¯æŒç†”æ–­ã€é™æµã€é‡è¯•ã€éš”ç¦»ç­‰ï¼›</li><li>Hystrix å·²åœæ­¢ç»´æŠ¤ï¼ŒåŠŸèƒ½å•ä¸€ï¼ˆç†”æ–­+çº¿ç¨‹éš”ç¦»ï¼‰ã€‚</li><li>Resilience4j æ¨¡å—åŒ–ï¼Œå¯æŒ‰éœ€å¼•å…¥ã€‚</li></ul><hr><h2 id="12-Gateway-çš„æ ¸å¿ƒåŠŸèƒ½ï¼Ÿ"><a href="#12-Gateway-çš„æ ¸å¿ƒåŠŸèƒ½ï¼Ÿ" class="headerlink" title="12. Gateway çš„æ ¸å¿ƒåŠŸèƒ½ï¼Ÿ"></a><strong>12. Gateway çš„æ ¸å¿ƒåŠŸèƒ½ï¼Ÿ</strong></h2><ul><li><strong>è·¯ç”±è½¬å‘</strong>ï¼ˆæ ¹æ®è·¯å¾„ã€Headerã€å‚æ•°è½¬å‘è¯·æ±‚ï¼‰ã€‚</li><li><strong>è¿‡æ»¤å™¨æœºåˆ¶</strong>ï¼ˆç»Ÿä¸€é‰´æƒã€æ—¥å¿—ã€é™æµï¼‰ã€‚</li><li><strong>è´Ÿè½½å‡è¡¡</strong>ï¼ˆç»“åˆæ³¨å†Œä¸­å¿ƒï¼‰ã€‚</li><li><strong>åè®®æ”¯æŒ</strong>ï¼ˆWebSocketã€HTTPSï¼‰ã€‚</li></ul><hr><h2 id="13-Gateway-å’Œ-Zuul-çš„åŒºåˆ«ï¼Ÿ"><a href="#13-Gateway-å’Œ-Zuul-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="13. Gateway å’Œ Zuul çš„åŒºåˆ«ï¼Ÿ"></a><strong>13. Gateway å’Œ Zuul çš„åŒºåˆ«ï¼Ÿ</strong></h2><ul><li>Zuul1 åŸºäº Servletï¼Œé˜»å¡ IOï¼Œæ€§èƒ½å·®ã€‚</li><li>Gateway åŸºäº Netty + Reactorï¼Œæ”¯æŒå“åº”å¼ï¼Œæ€§èƒ½é«˜ã€‚</li><li>Zuul2 è™½ç„¶æ”¹ä¸ºå¼‚æ­¥ï¼Œä½†ç”Ÿæ€ä¸Š Gateway æ›´æ¨èã€‚</li></ul><hr><h2 id="14-Config-Server-çš„ä½œç”¨ï¼Ÿ"><a href="#14-Config-Server-çš„ä½œç”¨ï¼Ÿ" class="headerlink" title="14. Config Server çš„ä½œç”¨ï¼Ÿ"></a><strong>14. Config Server çš„ä½œç”¨ï¼Ÿ</strong></h2><ul><li>ç»Ÿä¸€ç®¡ç†å¾®æœåŠ¡é…ç½®ï¼Œæ”¯æŒ Gitã€SVN ç­‰å­˜å‚¨ã€‚</li><li>åŠ¨æ€åˆ·æ–°é…ç½®ï¼Œä¿è¯ç¯å¢ƒä¸€è‡´æ€§ã€‚</li><li>ä¸ Bus ç»“åˆå¯å¹¿æ’­åˆ·æ–°ã€‚</li></ul><hr><h2 id="15-Config-Server-å¦‚ä½•ä¿è¯é…ç½®å®æ—¶åˆ·æ–°ï¼Ÿ"><a href="#15-Config-Server-å¦‚ä½•ä¿è¯é…ç½®å®æ—¶åˆ·æ–°ï¼Ÿ" class="headerlink" title="15. Config Server å¦‚ä½•ä¿è¯é…ç½®å®æ—¶åˆ·æ–°ï¼Ÿ"></a><strong>15. Config Server å¦‚ä½•ä¿è¯é…ç½®å®æ—¶åˆ·æ–°ï¼Ÿ</strong></h2><ul><li>å®¢æˆ·ç«¯é€šè¿‡ <code>@RefreshScope</code> å®ç°åŠ¨æ€åˆ·æ–°ã€‚</li><li>æ‰‹åŠ¨è§¦å‘ <code>/actuator/refresh</code>ã€‚</li><li>ç»“åˆ Spring Cloud Busï¼Œå¯ç”¨æ¶ˆæ¯é˜Ÿåˆ—å¹¿æ’­åˆ·æ–°ã€‚</li></ul><hr><h2 id="16-Spring-Cloud-Bus-çš„åŸç†ï¼Ÿ"><a href="#16-Spring-Cloud-Bus-çš„åŸç†ï¼Ÿ" class="headerlink" title="16. Spring Cloud Bus çš„åŸç†ï¼Ÿ"></a><strong>16. Spring Cloud Bus çš„åŸç†ï¼Ÿ</strong></h2><ul><li>åº•å±‚åŸºäºæ¶ˆæ¯é˜Ÿåˆ—ï¼ˆKafkaã€RabbitMQï¼‰ã€‚</li><li>å½“é…ç½®å˜æ›´æ—¶ï¼ŒBus å¹¿æ’­äº‹ä»¶ï¼Œæ‰€æœ‰æœåŠ¡æ¥æ”¶å¹¶åˆ·æ–°é…ç½®ã€‚</li></ul><hr><h2 id="17-Sleuth-çš„ä½œç”¨ï¼Ÿ"><a href="#17-Sleuth-çš„ä½œç”¨ï¼Ÿ" class="headerlink" title="17. Sleuth çš„ä½œç”¨ï¼Ÿ"></a><strong>17. Sleuth çš„ä½œç”¨ï¼Ÿ</strong></h2><ul><li>åœ¨å¾®æœåŠ¡è°ƒç”¨é“¾è·¯ä¸­ï¼Œè‡ªåŠ¨ç”Ÿæˆ <strong>TraceId &#x2F; SpanId</strong>ã€‚</li><li>å®ç°è¯·æ±‚é“¾è·¯è¿½è¸ªï¼Œå®šä½æ€§èƒ½ç“¶é¢ˆã€‚</li></ul><hr><h2 id="18-Sleuth-ä¸-Zipkin-çš„å…³ç³»ï¼Ÿ"><a href="#18-Sleuth-ä¸-Zipkin-çš„å…³ç³»ï¼Ÿ" class="headerlink" title="18. Sleuth ä¸ Zipkin çš„å…³ç³»ï¼Ÿ"></a><strong>18. Sleuth ä¸ Zipkin çš„å…³ç³»ï¼Ÿ</strong></h2><ul><li>Sleuthï¼šè´Ÿè´£åŸ‹ç‚¹ã€ç”Ÿæˆæ—¥å¿—ã€‚</li><li>Zipkinï¼šè´Ÿè´£æ”¶é›†ã€å­˜å‚¨ã€å±•ç¤ºè°ƒç”¨é“¾æ•°æ®ã€‚</li></ul><hr><h2 id="19-åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªçš„åŸç†ï¼Ÿ"><a href="#19-åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªçš„åŸç†ï¼Ÿ" class="headerlink" title="19. åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªçš„åŸç†ï¼Ÿ"></a><strong>19. åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªçš„åŸç†ï¼Ÿ</strong></h2><ul><li>é€šè¿‡å”¯ä¸€ TraceId è´¯ç©¿æ•´ä¸ªè°ƒç”¨é“¾ã€‚</li><li>æ¯æ¬¡è¿œç¨‹è°ƒç”¨ç”Ÿæˆæ–°çš„ SpanIdã€‚</li><li>æ•°æ®ä¸ŠæŠ¥åˆ°é›†ä¸­å¼ç³»ç»Ÿï¼ˆZipkin&#x2F;Jaegerï¼‰ã€‚</li></ul><hr><h2 id="20-Spring-Cloud-Stream-çš„ä½œç”¨ï¼Ÿ"><a href="#20-Spring-Cloud-Stream-çš„ä½œç”¨ï¼Ÿ" class="headerlink" title="20. Spring Cloud Stream çš„ä½œç”¨ï¼Ÿ"></a><strong>20. Spring Cloud Stream çš„ä½œç”¨ï¼Ÿ</strong></h2><ul><li>å°è£…æ¶ˆæ¯ä¸­é—´ä»¶ï¼ˆKafka&#x2F;RabbitMQï¼‰ã€‚</li><li>æä¾›ç»Ÿä¸€ç¼–ç¨‹æ¨¡å‹ï¼Œå±è”½åº•å±‚å·®å¼‚ã€‚</li><li>æ”¯æŒæ¶ˆæ¯é©±åŠ¨æ¶æ„ã€‚</li></ul><hr><h2 id="21-æ¶ˆæ¯é©±åŠ¨æ¨¡å‹å’Œäº‹ä»¶é©±åŠ¨æ¨¡å‹åŒºåˆ«ï¼Ÿ"><a href="#21-æ¶ˆæ¯é©±åŠ¨æ¨¡å‹å’Œäº‹ä»¶é©±åŠ¨æ¨¡å‹åŒºåˆ«ï¼Ÿ" class="headerlink" title="21. æ¶ˆæ¯é©±åŠ¨æ¨¡å‹å’Œäº‹ä»¶é©±åŠ¨æ¨¡å‹åŒºåˆ«ï¼Ÿ"></a><strong>21. æ¶ˆæ¯é©±åŠ¨æ¨¡å‹å’Œäº‹ä»¶é©±åŠ¨æ¨¡å‹åŒºåˆ«ï¼Ÿ</strong></h2><ul><li>æ¶ˆæ¯é©±åŠ¨ï¼šå¼ºè°ƒè§£è€¦ï¼Œæ¶ˆæ¯å¯é æŠ•é€’ã€‚</li><li>äº‹ä»¶é©±åŠ¨ï¼šå¼ºè°ƒç³»ç»Ÿå¯¹äº‹ä»¶çš„å“åº”ã€‚</li><li>Spring Cloud Stream æ›´åæ¶ˆæ¯é©±åŠ¨ï¼Œä½†ä¹Ÿæ”¯æŒäº‹ä»¶æ¨¡å¼ã€‚</li></ul><hr><h2 id="22-Nacos-å’Œ-Eureka-çš„åŒºåˆ«ï¼Ÿ"><a href="#22-Nacos-å’Œ-Eureka-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="22. Nacos å’Œ Eureka çš„åŒºåˆ«ï¼Ÿ"></a><strong>22. Nacos å’Œ Eureka çš„åŒºåˆ«ï¼Ÿ</strong></h2><ul><li>Nacos é™¤äº†æœåŠ¡æ³¨å†Œå‘ç°ï¼Œè¿˜æä¾›é…ç½®ä¸­å¿ƒåŠŸèƒ½ã€‚</li><li>Nacos æ”¯æŒ <strong>AP&#x2F;CP æ¨¡å¼åˆ‡æ¢</strong>ï¼›Eureka å›ºå®š APã€‚</li><li>Nacos æä¾› UIï¼Œæ›´æ˜“è¿ç»´ã€‚</li></ul><hr><h2 id="23-Nacos-é…ç½®ä¸­å¿ƒå’Œæ³¨å†Œä¸­å¿ƒçš„å®ç°åŸç†ï¼Ÿ"><a href="#23-Nacos-é…ç½®ä¸­å¿ƒå’Œæ³¨å†Œä¸­å¿ƒçš„å®ç°åŸç†ï¼Ÿ" class="headerlink" title="23. Nacos é…ç½®ä¸­å¿ƒå’Œæ³¨å†Œä¸­å¿ƒçš„å®ç°åŸç†ï¼Ÿ"></a><strong>23. Nacos é…ç½®ä¸­å¿ƒå’Œæ³¨å†Œä¸­å¿ƒçš„å®ç°åŸç†ï¼Ÿ</strong></h2><ul><li>é…ç½®ä¸­å¿ƒï¼šåŸºäºæ¨æ‹‰ç»“åˆï¼ˆé•¿è½®è¯¢ + Server æ¨é€ï¼‰ã€‚</li><li>æ³¨å†Œä¸­å¿ƒï¼šåŸºäºå¿ƒè·³æœºåˆ¶ç»´æŠ¤æœåŠ¡å¥åº·çŠ¶æ€ã€‚</li></ul><hr><h2 id="24-Sentinel-çš„å·¥ä½œåŸç†ï¼Ÿ"><a href="#24-Sentinel-çš„å·¥ä½œåŸç†ï¼Ÿ" class="headerlink" title="24. Sentinel çš„å·¥ä½œåŸç†ï¼Ÿ"></a><strong>24. Sentinel çš„å·¥ä½œåŸç†ï¼Ÿ</strong></h2><ul><li>åŸºäº <strong>æ»‘åŠ¨çª—å£ç»Ÿè®¡</strong> è¯·æ±‚ QPSã€å“åº”æ—¶é—´ã€‚</li><li>æ”¯æŒå¤šç§é™æµã€ç†”æ–­ã€é™çº§è§„åˆ™ã€‚</li><li>ä¸ Dubbo&#x2F;Spring Cloud&#x2F;Feign æ— ç¼é›†æˆã€‚</li></ul><hr><h2 id="25-é™æµçš„å¸¸è§ç®—æ³•ï¼ˆä»¤ç‰Œæ¡¶ã€æ¼æ¡¶ï¼‰ï¼Ÿ"><a href="#25-é™æµçš„å¸¸è§ç®—æ³•ï¼ˆä»¤ç‰Œæ¡¶ã€æ¼æ¡¶ï¼‰ï¼Ÿ" class="headerlink" title="25. é™æµçš„å¸¸è§ç®—æ³•ï¼ˆä»¤ç‰Œæ¡¶ã€æ¼æ¡¶ï¼‰ï¼Ÿ"></a><strong>25. é™æµçš„å¸¸è§ç®—æ³•ï¼ˆä»¤ç‰Œæ¡¶ã€æ¼æ¡¶ï¼‰ï¼Ÿ</strong></h2><ul><li><strong>ä»¤ç‰Œæ¡¶</strong>ï¼šç³»ç»Ÿä»¥å›ºå®šé€Ÿç‡ç”Ÿæˆä»¤ç‰Œï¼Œè¯·æ±‚éœ€æ‹¿åˆ°ä»¤ç‰Œæ‰æ‰§è¡Œã€‚</li><li><strong>æ¼æ¡¶</strong>ï¼šè¯·æ±‚å…ˆè¿›å…¥æ¡¶ï¼Œç³»ç»Ÿä»¥å›ºå®šé€Ÿç‡å¤„ç†ï¼Œè¶…å‡ºåˆ™ä¸¢å¼ƒã€‚</li><li>åŒºåˆ«ï¼šä»¤ç‰Œæ¡¶å…è®¸çªå‘æµé‡ï¼Œæ¼æ¡¶æ›´å¹³æ»‘ã€‚</li></ul><hr><h2 id="26-ç†”æ–­å’Œé™çº§çš„åŒºåˆ«ï¼Ÿ"><a href="#26-ç†”æ–­å’Œé™çº§çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="26. ç†”æ–­å’Œé™çº§çš„åŒºåˆ«ï¼Ÿ"></a><strong>26. ç†”æ–­å’Œé™çº§çš„åŒºåˆ«ï¼Ÿ</strong></h2><ul><li>ç†”æ–­ï¼šç³»ç»Ÿä¿æŠ¤æœºåˆ¶ï¼Œæ‹’ç»è°ƒç”¨ï¼Œé˜²æ­¢é›ªå´©ã€‚</li><li>é™çº§ï¼šä¸šåŠ¡å…œåº•æ–¹æ¡ˆï¼Œè¿”å›å¤‡ç”¨ç»“æœã€‚</li><li>ç†”æ–­æ˜¯â€œç¡¬é˜²æŠ¤â€ï¼Œé™çº§æ˜¯â€œè½¯å…œåº•â€ã€‚</li></ul><hr><h2 id="27-CAP-å®šç†å’Œ-Spring-Cloud-çš„å…³ç³»ï¼Ÿ"><a href="#27-CAP-å®šç†å’Œ-Spring-Cloud-çš„å…³ç³»ï¼Ÿ" class="headerlink" title="27. CAP å®šç†å’Œ Spring Cloud çš„å…³ç³»ï¼Ÿ"></a><strong>27. CAP å®šç†å’Œ Spring Cloud çš„å…³ç³»ï¼Ÿ</strong></h2><ul><li>CAPï¼šä¸€è‡´æ€§ï¼ˆCï¼‰ã€å¯ç”¨æ€§ï¼ˆAï¼‰ã€åˆ†åŒºå®¹é”™æ€§ï¼ˆPï¼‰ã€‚</li><li>Eureka â†’ APï¼›Consul â†’ CPï¼›Nacos â†’ AP&#x2F;CP åˆ‡æ¢ã€‚</li></ul><hr><h2 id="28-Spring-Cloud-ä¸-Kubernetes-çš„å…³ç³»ï¼Ÿ"><a href="#28-Spring-Cloud-ä¸-Kubernetes-çš„å…³ç³»ï¼Ÿ" class="headerlink" title="28. Spring Cloud ä¸ Kubernetes çš„å…³ç³»ï¼Ÿ"></a><strong>28. Spring Cloud ä¸ Kubernetes çš„å…³ç³»ï¼Ÿ</strong></h2><ul><li>Spring Cloudï¼šååº”ç”¨å±‚ï¼Œå¼€å‘æ¡†æ¶ã€‚</li><li>Kubernetesï¼šååŸºç¡€è®¾æ–½ï¼Œå®¹å™¨ç¼–æ’ã€‚</li><li>å¯ç»“åˆä½¿ç”¨ï¼šSpring Cloud è´Ÿè´£åº”ç”¨æ²»ç†ï¼ŒK8s è´Ÿè´£èµ„æºè°ƒåº¦ã€‚</li></ul><hr><h2 id="29-å¾®æœåŠ¡ä¸­çš„ç°åº¦å‘å¸ƒï¼Ÿ"><a href="#29-å¾®æœåŠ¡ä¸­çš„ç°åº¦å‘å¸ƒï¼Ÿ" class="headerlink" title="29. å¾®æœåŠ¡ä¸­çš„ç°åº¦å‘å¸ƒï¼Ÿ"></a><strong>29. å¾®æœåŠ¡ä¸­çš„ç°åº¦å‘å¸ƒï¼Ÿ</strong></h2><ul><li>æŒ‡æ–°ç‰ˆæœ¬åªå¯¹éƒ¨åˆ†ç”¨æˆ·å¼€æ”¾ã€‚</li><li>å®ç°æ–¹å¼ï¼š<ul><li>Nginx&#x2F;Gateway æŒ‰ç”¨æˆ· ID æˆ–æµé‡æ¯”ä¾‹è·¯ç”±ã€‚</li><li>Service Meshï¼ˆIstioï¼‰æ”¯æŒæ›´çµæ´»çš„æµé‡æ§åˆ¶ã€‚</li></ul></li></ul><hr><h2 id="30-Spring-Cloud-å¦‚ä½•å®ç°æœåŠ¡ç½‘æ ¼ï¼Ÿ"><a href="#30-Spring-Cloud-å¦‚ä½•å®ç°æœåŠ¡ç½‘æ ¼ï¼Ÿ" class="headerlink" title="30. Spring Cloud å¦‚ä½•å®ç°æœåŠ¡ç½‘æ ¼ï¼Ÿ"></a><strong>30. Spring Cloud å¦‚ä½•å®ç°æœåŠ¡ç½‘æ ¼ï¼Ÿ</strong></h2><ul><li>åŸç”Ÿ Spring Cloud å SDK æ¨¡å¼ï¼Œç¼ºä¹æœåŠ¡ç½‘æ ¼èƒ½åŠ›ã€‚</li><li>å¯ç»“åˆ <strong>Spring Cloud + Istio&#x2F;Envoy</strong>ï¼Œå®ç°æµé‡æ²»ç†ã€è§‚æµ‹ã€ç†”æ–­ã€ç°åº¦ã€‚</li><li>è¶Šæ¥è¶Šå¤šå›¢é˜Ÿé‡‡ç”¨ <strong>Spring Cloud Alibaba + Service Mesh</strong> çš„æ··åˆæ–¹æ¡ˆã€‚</li></ul><hr><h2 id="å…­ã€å¾®æœåŠ¡æ¶æ„-åˆ†å¸ƒå¼ç³»ç»Ÿï¼ˆ30é¢˜ï¼‰"><a href="#å…­ã€å¾®æœåŠ¡æ¶æ„-åˆ†å¸ƒå¼ç³»ç»Ÿï¼ˆ30é¢˜ï¼‰" class="headerlink" title="å…­ã€å¾®æœåŠ¡æ¶æ„ &amp; åˆ†å¸ƒå¼ç³»ç»Ÿï¼ˆ30é¢˜ï¼‰"></a>å…­ã€å¾®æœåŠ¡æ¶æ„ &amp; åˆ†å¸ƒå¼ç³»ç»Ÿï¼ˆ30é¢˜ï¼‰</h2><hr><h2 id="1-ä»€ä¹ˆæ˜¯å¾®æœåŠ¡ï¼Ÿ"><a href="#1-ä»€ä¹ˆæ˜¯å¾®æœåŠ¡ï¼Ÿ" class="headerlink" title="1. ä»€ä¹ˆæ˜¯å¾®æœåŠ¡ï¼Ÿ"></a><strong>1. ä»€ä¹ˆæ˜¯å¾®æœåŠ¡ï¼Ÿ</strong></h2><p><strong>æ ¸å¿ƒå›ç­”</strong><br> å¾®æœåŠ¡æ˜¯ä¸€ç§æ¶æ„é£æ ¼ï¼Œå°†å•ä½“åº”ç”¨æ‹†åˆ†ä¸ºä¸€ç»„å°å‹ã€ç‹¬ç«‹éƒ¨ç½²çš„æœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡èšç„¦æŸä¸ªä¸šåŠ¡èƒ½åŠ›ï¼Œé€šè¿‡ APIï¼ˆHTTP&#x2F;gRPC&#x2F;MQï¼‰é€šä¿¡ã€‚</p><p><strong>æ·±å…¥åŸç†</strong></p><ul><li>æ¯ä¸ªæœåŠ¡ç‹¬ç«‹å¼€å‘ã€éƒ¨ç½²ã€æ‰©å®¹ã€‚</li><li>æœåŠ¡è‡ªæ²»ï¼šæœ‰è‡ªå·±çš„æ•°æ®åº“ã€ç¼“å­˜ã€é€»è¾‘ã€‚</li><li>é€šå¸¸ç»“åˆå®¹å™¨åŒ–ã€CI&#x2F;CDã€æœåŠ¡æ²»ç†æ¡†æ¶ï¼ˆå¦‚ Spring Cloudã€Dubboã€K8sï¼‰ã€‚</li></ul><p><strong>å»¶ä¼¸æ€è€ƒ</strong></p><ul><li>é¢è¯•è¿½é—®ï¼šå’Œå•ä½“åº”ç”¨åŒºåˆ«ï¼Ÿ â†’ å•ä½“è€¦åˆåº¦é«˜ï¼Œå¾®æœåŠ¡è§£è€¦ä½†æ›´å¤æ‚ã€‚</li></ul><hr><h2 id="2-å¾®æœåŠ¡ä¸-SOA-çš„åŒºåˆ«ï¼Ÿ"><a href="#2-å¾®æœåŠ¡ä¸-SOA-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="2. å¾®æœåŠ¡ä¸ SOA çš„åŒºåˆ«ï¼Ÿ"></a><strong>2. å¾®æœåŠ¡ä¸ SOA çš„åŒºåˆ«ï¼Ÿ</strong></h2><p><strong>æ ¸å¿ƒå›ç­”</strong></p><ul><li><strong>SOA</strong>ï¼šé¢å‘æœåŠ¡çš„æ¶æ„ï¼Œé€šå¸¸ä¾èµ– ESBï¼ˆä¼ä¸šæœåŠ¡æ€»çº¿ï¼‰ã€‚</li><li><strong>å¾®æœåŠ¡</strong>ï¼šè½»é‡çº§ã€å»ä¸­å¿ƒåŒ–ï¼Œå¼ºè°ƒå°è€Œç‹¬ç«‹ï¼Œå¸¸ç”¨ REST&#x2F;gRPCã€‚</li></ul><p><strong>æ·±å…¥åŸç†</strong></p><ul><li>SOA â†’ åä¼ä¸šå†…éƒ¨ï¼ŒæœåŠ¡è¾ƒå¤§ï¼Œä¾èµ–ç»Ÿä¸€ä¸­é—´ä»¶ï¼ˆå¦‚ ESBï¼‰ã€‚</li><li>å¾®æœåŠ¡ â†’ æœåŠ¡æ›´å°ï¼Œé¿å…å•ç‚¹ä¸­å¿ƒï¼Œå¼ºè°ƒå»ä¸­å¿ƒåŒ–è‡ªæ²»ã€‚</li></ul><p><strong>å»¶ä¼¸æ€è€ƒ</strong></p><ul><li>é¢è¯•è¿½é—®ï¼šä¸ºä»€ä¹ˆå¾®æœåŠ¡æ¯” SOA æ›´æµè¡Œï¼Ÿ â†’ äº‘åŸç”ŸèƒŒæ™¯ä¸‹ï¼Œå¾®æœåŠ¡æ›´é€‚åº”æ•æ·å¼€å‘å’Œå¿«é€Ÿè¿­ä»£ã€‚</li></ul><hr><h2 id="3-å¾®æœåŠ¡çš„ä¼˜ç¼ºç‚¹ï¼Ÿ"><a href="#3-å¾®æœåŠ¡çš„ä¼˜ç¼ºç‚¹ï¼Ÿ" class="headerlink" title="3. å¾®æœåŠ¡çš„ä¼˜ç¼ºç‚¹ï¼Ÿ"></a><strong>3. å¾®æœåŠ¡çš„ä¼˜ç¼ºç‚¹ï¼Ÿ</strong></h2><p><strong>æ ¸å¿ƒå›ç­”</strong></p><ul><li>ä¼˜ç‚¹ï¼šç‹¬ç«‹éƒ¨ç½²ã€æŠ€æœ¯å¤šæ ·æ€§ã€å¼¹æ€§ä¼¸ç¼©ã€å¿«é€Ÿè¿­ä»£ã€‚</li><li>ç¼ºç‚¹ï¼šåˆ†å¸ƒå¼å¤æ‚æ€§ã€è¿ç»´éš¾åº¦é«˜ã€æ•°æ®ä¸€è‡´æ€§æŒ‘æˆ˜ã€æœåŠ¡æ²»ç†æˆæœ¬é«˜ã€‚</li></ul><p><strong>å»¶ä¼¸æ€è€ƒ</strong></p><ul><li>é¢è¯•å®˜å¸¸é—®ï¼šä»€ä¹ˆæ—¶å€™ä¸é€‚åˆå¾®æœåŠ¡ï¼Ÿ â†’ ä¸šåŠ¡å°ã€å›¢é˜Ÿå°ã€ç³»ç»Ÿç®€å•æ—¶ã€‚</li></ul><hr><h2 id="4-å¾®æœåŠ¡çš„æ‹†åˆ†åŸåˆ™ï¼Ÿ"><a href="#4-å¾®æœåŠ¡çš„æ‹†åˆ†åŸåˆ™ï¼Ÿ" class="headerlink" title="4. å¾®æœåŠ¡çš„æ‹†åˆ†åŸåˆ™ï¼Ÿ"></a><strong>4. å¾®æœåŠ¡çš„æ‹†åˆ†åŸåˆ™ï¼Ÿ</strong></h2><p><strong>æ ¸å¿ƒå›ç­”</strong></p><ul><li>æŒ‰ä¸šåŠ¡è¾¹ç•Œï¼ˆDDD çš„é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼‰ã€‚</li><li>é«˜å†…èšã€ä½è€¦åˆã€‚</li><li>ä¸€ä¸ªæœåŠ¡åªèšç„¦ä¸€ä¸ªæ ¸å¿ƒä¸šåŠ¡èƒ½åŠ›ã€‚</li></ul><p><strong>æ·±å…¥åŸç†</strong></p><ul><li>æ‹†åˆ†æ–¹å¼ï¼šæŒ‰ä¸šåŠ¡ï¼ˆè®¢å•ã€ç”¨æˆ·ã€æ”¯ä»˜ï¼‰ã€æŒ‰åœºæ™¯ï¼ˆæ ¸å¿ƒ vs è¾…åŠ©ï¼‰ã€æŒ‰éåŠŸèƒ½éœ€æ±‚ï¼ˆæ€§èƒ½ç“¶é¢ˆç‚¹ï¼‰ã€‚</li></ul><p><strong>å»¶ä¼¸æ€è€ƒ</strong></p><ul><li>å¸¸è§é”™è¯¯ï¼šæŒ‰æ•°æ®åº“è¡¨æ‹†åˆ†ï¼Œå¯¼è‡´è¿‡åº¦ä¾èµ–è·¨æœåŠ¡è°ƒç”¨ã€‚</li></ul><hr><h2 id="5-å¦‚ä½•ä¿è¯å¾®æœåŠ¡ä¹‹é—´çš„æ•°æ®ä¸€è‡´æ€§ï¼Ÿ"><a href="#5-å¦‚ä½•ä¿è¯å¾®æœåŠ¡ä¹‹é—´çš„æ•°æ®ä¸€è‡´æ€§ï¼Ÿ" class="headerlink" title="5. å¦‚ä½•ä¿è¯å¾®æœåŠ¡ä¹‹é—´çš„æ•°æ®ä¸€è‡´æ€§ï¼Ÿ"></a><strong>5. å¦‚ä½•ä¿è¯å¾®æœåŠ¡ä¹‹é—´çš„æ•°æ®ä¸€è‡´æ€§ï¼Ÿ</strong></h2><p><strong>æ ¸å¿ƒå›ç­”</strong></p><ul><li>é¿å…å¼ºä¸€è‡´ï¼Œé‡‡ç”¨ <strong>æœ€ç»ˆä¸€è‡´æ€§</strong>ã€‚</li><li>æ–¹æ¡ˆï¼šåˆ†å¸ƒå¼äº‹åŠ¡ã€æ¶ˆæ¯é©±åŠ¨ã€è¡¥å¿æœºåˆ¶ã€‚</li></ul><p><strong>æ·±å…¥åŸç†</strong></p><ul><li>åŒæ­¥æ–¹æ¡ˆï¼šXAï¼ˆä¸¤é˜¶æ®µæäº¤ï¼‰ã€‚</li><li>å¼‚æ­¥æ–¹æ¡ˆï¼šTCCã€SAGAã€å¯é æ¶ˆæ¯ã€‚</li></ul><p><strong>å»¶ä¼¸æ€è€ƒ</strong></p><ul><li>é¢è¯•å®˜è¿½é—®ï¼šä½ åœ¨é¡¹ç›®ä¸­æ€ä¹ˆåšï¼Ÿ â†’ æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆäº‹åŠ¡æ¶ˆæ¯&#x2F;æœ¬åœ°æ¶ˆæ¯è¡¨ï¼‰ã€‚</li></ul><hr><h2 id="6-åˆ†å¸ƒå¼äº‹åŠ¡æœ‰å“ªäº›è§£å†³æ–¹æ¡ˆï¼Ÿ"><a href="#6-åˆ†å¸ƒå¼äº‹åŠ¡æœ‰å“ªäº›è§£å†³æ–¹æ¡ˆï¼Ÿ" class="headerlink" title="6. åˆ†å¸ƒå¼äº‹åŠ¡æœ‰å“ªäº›è§£å†³æ–¹æ¡ˆï¼Ÿ"></a><strong>6. åˆ†å¸ƒå¼äº‹åŠ¡æœ‰å“ªäº›è§£å†³æ–¹æ¡ˆï¼Ÿ</strong></h2><p><strong>æ ¸å¿ƒå›ç­”</strong></p><ul><li>XAï¼ˆä¸¤é˜¶æ®µæäº¤ï¼‰</li><li>TCCï¼ˆTry-Confirm-Cancelï¼‰</li><li>SAGAï¼ˆé•¿äº‹åŠ¡è¡¥å¿ï¼‰</li><li>æœ¬åœ°æ¶ˆæ¯è¡¨ &#x2F; äº‹åŠ¡æ¶ˆæ¯</li></ul><p><strong>æ·±å…¥åŸç†</strong></p><ul><li>XAï¼šå¼ºä¸€è‡´æ€§ï¼Œä½†æ€§èƒ½å·®ã€‚</li><li>TCCï¼šä¸šåŠ¡å…¥ä¾µé«˜ï¼Œä½†çµæ´»ã€‚</li><li>SAGAï¼šé•¿äº‹åŠ¡åœºæ™¯ï¼Œå¤±è´¥æ—¶ç”¨è¡¥å¿ã€‚</li><li>æœ¬åœ°æ¶ˆæ¯è¡¨ï¼šä¿è¯æœ€ç»ˆä¸€è‡´æ€§ã€‚</li></ul><hr><h2 id="7-TCCã€SAGAã€XA-çš„åŒºåˆ«ï¼Ÿ"><a href="#7-TCCã€SAGAã€XA-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="7. TCCã€SAGAã€XA çš„åŒºåˆ«ï¼Ÿ"></a><strong>7. TCCã€SAGAã€XA çš„åŒºåˆ«ï¼Ÿ</strong></h2><ul><li><strong>XA</strong>ï¼šæ•°æ®åº“å±‚ä¸¤é˜¶æ®µæäº¤ï¼Œå¼ºä¸€è‡´ï¼Œæ€§èƒ½å·®ã€‚</li><li><strong>TCC</strong>ï¼šåº”ç”¨å±‚ä¸‰æ­¥ï¼ˆé¢„ç•™èµ„æºã€ç¡®è®¤ã€å›æ»šï¼‰ï¼Œä¾µå…¥æ€§é«˜ã€‚</li><li><strong>SAGA</strong>ï¼šé•¿äº‹åŠ¡ï¼Œæ¯æ­¥éƒ½æœ‰è¡¥å¿åŠ¨ä½œï¼Œä¿è¯æœ€ç»ˆä¸€è‡´æ€§ã€‚</li></ul><hr><h2 id="8-æœ¬åœ°æ¶ˆæ¯è¡¨å’Œå¯é æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§ï¼Ÿ"><a href="#8-æœ¬åœ°æ¶ˆæ¯è¡¨å’Œå¯é æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§ï¼Ÿ" class="headerlink" title="8. æœ¬åœ°æ¶ˆæ¯è¡¨å’Œå¯é æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§ï¼Ÿ"></a><strong>8. æœ¬åœ°æ¶ˆæ¯è¡¨å’Œå¯é æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§ï¼Ÿ</strong></h2><ul><li>æœ¬åœ°æ¶ˆæ¯è¡¨ï¼šåœ¨æœ¬åœ°äº‹åŠ¡ä¸­å†™ä¸šåŠ¡è¡¨ + æ¶ˆæ¯è¡¨ â†’ MQ å¼‚æ­¥æŠ•é€’ â†’ æ¶ˆè´¹ç«¯ç¡®è®¤ã€‚</li><li>å¯é æ¶ˆæ¯ï¼šMQ æ”¯æŒäº‹åŠ¡ï¼ˆå¦‚ RocketMQ åŠæ¶ˆæ¯ï¼‰ï¼Œç¡®ä¿æ¶ˆæ¯å¿…è¾¾ï¼Œä¿è¯æœ€ç»ˆä¸€è‡´æ€§ã€‚</li></ul><hr><h2 id="9-åˆ†å¸ƒå¼é”çš„å®ç°æ–¹å¼ï¼Ÿ"><a href="#9-åˆ†å¸ƒå¼é”çš„å®ç°æ–¹å¼ï¼Ÿ" class="headerlink" title="9. åˆ†å¸ƒå¼é”çš„å®ç°æ–¹å¼ï¼Ÿ"></a><strong>9. åˆ†å¸ƒå¼é”çš„å®ç°æ–¹å¼ï¼Ÿ</strong></h2><ul><li>æ•°æ®åº“é”ï¼ˆæ‚²è§‚é”&#x2F;å”¯ä¸€ç´¢å¼•ï¼‰ã€‚</li><li>Redis åˆ†å¸ƒå¼é”ï¼ˆsetnx + expireï¼‰ã€‚</li><li>Zookeeper åˆ†å¸ƒå¼é”ï¼ˆä¸´æ—¶é¡ºåºèŠ‚ç‚¹ï¼‰ã€‚</li></ul><hr><h2 id="10-Redis-åˆ†å¸ƒå¼é”çš„ç¼ºé™·ï¼Ÿ"><a href="#10-Redis-åˆ†å¸ƒå¼é”çš„ç¼ºé™·ï¼Ÿ" class="headerlink" title="10. Redis åˆ†å¸ƒå¼é”çš„ç¼ºé™·ï¼Ÿ"></a><strong>10. Redis åˆ†å¸ƒå¼é”çš„ç¼ºé™·ï¼Ÿ</strong></h2><ul><li>å•ç‚¹é—®é¢˜ï¼ˆéœ€ Redis Cluster æˆ– Redlockï¼‰ã€‚</li><li>é”è¿‡æœŸå¯èƒ½å¯¼è‡´è¯¯é‡Šæ”¾ã€‚</li><li>ä¸èƒ½ä¿è¯ä¸¥æ ¼å…¬å¹³ã€‚</li></ul><hr><h2 id="11-Zookeeper-åˆ†å¸ƒå¼é”çš„å®ç°ï¼Ÿ"><a href="#11-Zookeeper-åˆ†å¸ƒå¼é”çš„å®ç°ï¼Ÿ" class="headerlink" title="11. Zookeeper åˆ†å¸ƒå¼é”çš„å®ç°ï¼Ÿ"></a><strong>11. Zookeeper åˆ†å¸ƒå¼é”çš„å®ç°ï¼Ÿ</strong></h2><ul><li>åˆ©ç”¨ <strong>ä¸´æ—¶é¡ºåºèŠ‚ç‚¹</strong>ï¼š<ul><li>å®¢æˆ·ç«¯åˆ›å»ºé¡ºåºèŠ‚ç‚¹ã€‚</li><li>åˆ¤æ–­è‡ªå·±æ˜¯å¦æ˜¯æœ€å°èŠ‚ç‚¹ â†’ è·å–é”ã€‚</li><li>ä¸æ˜¯åˆ™ç›‘å¬å‰ä¸€ä¸ªèŠ‚ç‚¹çš„åˆ é™¤äº‹ä»¶ã€‚</li></ul></li></ul><hr><h2 id="12-æ•°æ®åº“åˆ†åº“åˆ†è¡¨ç­–ç•¥ï¼Ÿ"><a href="#12-æ•°æ®åº“åˆ†åº“åˆ†è¡¨ç­–ç•¥ï¼Ÿ" class="headerlink" title="12. æ•°æ®åº“åˆ†åº“åˆ†è¡¨ç­–ç•¥ï¼Ÿ"></a><strong>12. æ•°æ®åº“åˆ†åº“åˆ†è¡¨ç­–ç•¥ï¼Ÿ</strong></h2><ul><li>å‚ç›´åˆ†åº“ï¼ˆæŒ‰ä¸šåŠ¡æ‹†åˆ†ï¼‰ã€‚</li><li>æ°´å¹³åˆ†è¡¨ï¼ˆæŒ‰ç”¨æˆ· IDã€æ—¶é—´åšåˆ†ç‰‡ï¼‰ã€‚</li><li>å¸¸è§è·¯ç”±æ–¹å¼ï¼šå“ˆå¸Œå–æ¨¡ã€èŒƒå›´ã€æ—¶é—´ã€‚</li></ul><hr><h2 id="13-æ°´å¹³æ‹†åˆ†ä¸å‚ç›´æ‹†åˆ†åŒºåˆ«ï¼Ÿ"><a href="#13-æ°´å¹³æ‹†åˆ†ä¸å‚ç›´æ‹†åˆ†åŒºåˆ«ï¼Ÿ" class="headerlink" title="13. æ°´å¹³æ‹†åˆ†ä¸å‚ç›´æ‹†åˆ†åŒºåˆ«ï¼Ÿ"></a><strong>13. æ°´å¹³æ‹†åˆ†ä¸å‚ç›´æ‹†åˆ†åŒºåˆ«ï¼Ÿ</strong></h2><ul><li><strong>æ°´å¹³æ‹†åˆ†</strong>ï¼šåŒä¸€å¼ è¡¨çš„æ•°æ®åˆ†åˆ°å¤šä¸ªåº“è¡¨ï¼ˆæŒ‰èŒƒå›´&#x2F;å“ˆå¸Œï¼‰ã€‚</li><li><strong>å‚ç›´æ‹†åˆ†</strong>ï¼šä¸åŒä¸šåŠ¡è¡¨æ”¾åˆ°ä¸åŒåº“ï¼ˆç”¨æˆ·åº“ã€è®¢å•åº“ï¼‰ã€‚</li></ul><hr><h2 id="14-åˆ†å¸ƒå¼-ID-ç”Ÿæˆæ–¹æ¡ˆï¼Ÿ"><a href="#14-åˆ†å¸ƒå¼-ID-ç”Ÿæˆæ–¹æ¡ˆï¼Ÿ" class="headerlink" title="14. åˆ†å¸ƒå¼ ID ç”Ÿæˆæ–¹æ¡ˆï¼Ÿ"></a><strong>14. åˆ†å¸ƒå¼ ID ç”Ÿæˆæ–¹æ¡ˆï¼Ÿ</strong></h2><ul><li>UUIDï¼ˆæ— åºï¼Œä¸é€‚åˆæ•°æ®åº“ï¼‰ã€‚</li><li>æ•°æ®åº“è‡ªå¢ IDï¼ˆå•ç‚¹ç“¶é¢ˆï¼‰ã€‚</li><li>Redis è‡ªå¢ã€‚</li><li>é›ªèŠ±ç®—æ³•ï¼ˆSnowflakeï¼‰ã€‚</li><li>Leafï¼ˆç¾å›¢å¼€æºï¼‰ã€‚</li></ul><hr><h2 id="15-é›ªèŠ±ç®—æ³•çš„åŸç†ï¼Ÿ"><a href="#15-é›ªèŠ±ç®—æ³•çš„åŸç†ï¼Ÿ" class="headerlink" title="15. é›ªèŠ±ç®—æ³•çš„åŸç†ï¼Ÿ"></a><strong>15. é›ªèŠ±ç®—æ³•çš„åŸç†ï¼Ÿ</strong></h2><ul><li>64 ä½é•¿æ•´å‹ï¼š<ul><li>æ—¶é—´æˆ³ï¼ˆ41 ä½ï¼‰</li><li>æœºå™¨ IDï¼ˆ10 ä½ï¼‰</li><li>åºåˆ—å·ï¼ˆ12 ä½ï¼‰</li></ul></li><li>ä¿è¯å…¨å±€å”¯ä¸€ã€æœ‰åºã€‚</li></ul><hr><h2 id="16-API-ç½‘å…³çš„ä½œç”¨ï¼Ÿ"><a href="#16-API-ç½‘å…³çš„ä½œç”¨ï¼Ÿ" class="headerlink" title="16. API ç½‘å…³çš„ä½œç”¨ï¼Ÿ"></a><strong>16. API ç½‘å…³çš„ä½œç”¨ï¼Ÿ</strong></h2><ul><li>ç»Ÿä¸€å…¥å£ï¼Œåšè·¯ç”±è½¬å‘ã€‚</li><li>é‰´æƒã€å®‰å…¨æ§åˆ¶ã€‚</li><li>æµé‡æ§åˆ¶ã€ç†”æ–­ã€é™çº§ã€‚</li><li>æ—¥å¿—ç›‘æ§ã€‚</li></ul><hr><h2 id="17-æœåŠ¡æ³¨å†Œä¸å‘ç°æœºåˆ¶ï¼Ÿ"><a href="#17-æœåŠ¡æ³¨å†Œä¸å‘ç°æœºåˆ¶ï¼Ÿ" class="headerlink" title="17. æœåŠ¡æ³¨å†Œä¸å‘ç°æœºåˆ¶ï¼Ÿ"></a><strong>17. æœåŠ¡æ³¨å†Œä¸å‘ç°æœºåˆ¶ï¼Ÿ</strong></h2><ul><li>æœåŠ¡å¯åŠ¨ â†’ æ³¨å†Œä¸­å¿ƒæ³¨å†Œï¼ˆIP&#x2F;ç«¯å£&#x2F;çŠ¶æ€ï¼‰ã€‚</li><li>è°ƒç”¨æ–¹ â†’ ä»æ³¨å†Œä¸­å¿ƒè·å–åœ°å€åˆ—è¡¨ã€‚</li><li>æ³¨å†Œä¸­å¿ƒ â†’ é€šè¿‡å¿ƒè·³ç»´æŒå¥åº·çŠ¶æ€ã€‚</li></ul><hr><h2 id="18-å¾®æœåŠ¡å¦‚ä½•ä¿è¯é«˜å¯ç”¨ï¼Ÿ"><a href="#18-å¾®æœåŠ¡å¦‚ä½•ä¿è¯é«˜å¯ç”¨ï¼Ÿ" class="headerlink" title="18. å¾®æœåŠ¡å¦‚ä½•ä¿è¯é«˜å¯ç”¨ï¼Ÿ"></a><strong>18. å¾®æœåŠ¡å¦‚ä½•ä¿è¯é«˜å¯ç”¨ï¼Ÿ</strong></h2><ul><li>æœåŠ¡å†—ä½™ï¼ˆå¤šå®ä¾‹éƒ¨ç½²ï¼‰ã€‚</li><li>è´Ÿè½½å‡è¡¡ã€‚</li><li>ç†”æ–­ã€é™çº§ã€é™æµã€‚</li><li>è‡ªåŠ¨æ•…éšœè½¬ç§»ï¼ˆK8s + æœåŠ¡æ²»ç†æ¡†æ¶ï¼‰ã€‚</li></ul><hr><h2 id="19-å¾®æœåŠ¡ä¸­çš„é™æµå’Œç†”æ–­ï¼Ÿ"><a href="#19-å¾®æœåŠ¡ä¸­çš„é™æµå’Œç†”æ–­ï¼Ÿ" class="headerlink" title="19. å¾®æœåŠ¡ä¸­çš„é™æµå’Œç†”æ–­ï¼Ÿ"></a><strong>19. å¾®æœåŠ¡ä¸­çš„é™æµå’Œç†”æ–­ï¼Ÿ</strong></h2><ul><li>é™æµï¼šæ§åˆ¶æµé‡ï¼Œä¿æŠ¤ç³»ç»Ÿï¼ˆä»¤ç‰Œæ¡¶&#x2F;æ¼æ¡¶ï¼‰ã€‚</li><li>ç†”æ–­ï¼šå½“ä¸‹æ¸¸æœåŠ¡å¼‚å¸¸æ—¶ï¼Œç›´æ¥å¤±è´¥å¹¶å¿«é€Ÿè¿”å›ã€‚</li></ul><hr><h2 id="20-å¾®æœåŠ¡å¦‚ä½•ä¿è¯å®‰å…¨æ€§ï¼Ÿ"><a href="#20-å¾®æœåŠ¡å¦‚ä½•ä¿è¯å®‰å…¨æ€§ï¼Ÿ" class="headerlink" title="20. å¾®æœåŠ¡å¦‚ä½•ä¿è¯å®‰å…¨æ€§ï¼Ÿ"></a><strong>20. å¾®æœåŠ¡å¦‚ä½•ä¿è¯å®‰å…¨æ€§ï¼Ÿ</strong></h2><ul><li>è®¤è¯æˆæƒï¼ˆOAuth2ã€JWTï¼‰ã€‚</li><li>HTTPSã€åŠ å¯†é€šä¿¡ã€‚</li><li>API ç½‘å…³ç»Ÿä¸€é‰´æƒã€‚</li><li>æ•°æ®è„±æ•ã€‚</li></ul><hr><h2 id="21-OAuth2-çš„åŸç†ï¼Ÿ"><a href="#21-OAuth2-çš„åŸç†ï¼Ÿ" class="headerlink" title="21. OAuth2 çš„åŸç†ï¼Ÿ"></a><strong>21. OAuth2 çš„åŸç†ï¼Ÿ</strong></h2><ul><li>åŸºäºä»¤ç‰Œçš„è®¤è¯æˆæƒåè®®ã€‚</li><li>å››ç§æ¨¡å¼ï¼šæˆæƒç ã€å¯†ç ã€å®¢æˆ·ç«¯å‡­è¯ã€ç®€åŒ–æ¨¡å¼ã€‚</li><li>å…¸å‹æµç¨‹ï¼šç”¨æˆ· â†’ æˆæƒæœåŠ¡å™¨ â†’ è·å– Token â†’ è°ƒç”¨èµ„æºæœåŠ¡å™¨ã€‚</li></ul><hr><h2 id="22-JWT-çš„ä½œç”¨ï¼Ÿ"><a href="#22-JWT-çš„ä½œç”¨ï¼Ÿ" class="headerlink" title="22. JWT çš„ä½œç”¨ï¼Ÿ"></a><strong>22. JWT çš„ä½œç”¨ï¼Ÿ</strong></h2><ul><li>JSON Web Tokenï¼Œä¸€ç§æ— çŠ¶æ€ä»¤ç‰Œã€‚</li><li>å†…å®¹åŒ…å«ä¸‰éƒ¨åˆ†ï¼šHeaderã€Payloadã€Signatureã€‚</li><li>é€‚åˆåˆ†å¸ƒå¼ç³»ç»Ÿåšè®¤è¯ï¼Œæ— éœ€å­˜å‚¨ Sessionã€‚</li></ul><hr><h2 id="23-å•ç‚¹ç™»å½•-SSO-çš„å®ç°ï¼Ÿ"><a href="#23-å•ç‚¹ç™»å½•-SSO-çš„å®ç°ï¼Ÿ" class="headerlink" title="23. å•ç‚¹ç™»å½• SSO çš„å®ç°ï¼Ÿ"></a><strong>23. å•ç‚¹ç™»å½• SSO çš„å®ç°ï¼Ÿ</strong></h2><ul><li>ç”¨æˆ·åªéœ€ç™»å½•ä¸€æ¬¡ï¼Œè·å–å…¨å±€ Token&#x2F;Sessionã€‚</li><li>å¸¸è§å®ç°ï¼šCASã€OAuth2ã€JWTã€‚</li><li>æ ¸å¿ƒï¼šç»Ÿä¸€è®¤è¯ä¸­å¿ƒã€‚</li></ul><hr><h2 id="24-é…ç½®ä¸­å¿ƒçš„ä½œç”¨ï¼Ÿ"><a href="#24-é…ç½®ä¸­å¿ƒçš„ä½œç”¨ï¼Ÿ" class="headerlink" title="24. é…ç½®ä¸­å¿ƒçš„ä½œç”¨ï¼Ÿ"></a><strong>24. é…ç½®ä¸­å¿ƒçš„ä½œç”¨ï¼Ÿ</strong></h2><ul><li>é›†ä¸­åŒ–é…ç½®ç®¡ç†ã€‚</li><li>æ”¯æŒåŠ¨æ€åˆ·æ–°ã€‚</li><li>ç¯å¢ƒéš”ç¦»ï¼ˆdev&#x2F;test&#x2F;prodï¼‰ã€‚</li></ul><hr><h2 id="25-å¾®æœåŠ¡ä¸­çš„ç›‘æ§ä½“ç³»ï¼Ÿ"><a href="#25-å¾®æœåŠ¡ä¸­çš„ç›‘æ§ä½“ç³»ï¼Ÿ" class="headerlink" title="25. å¾®æœåŠ¡ä¸­çš„ç›‘æ§ä½“ç³»ï¼Ÿ"></a><strong>25. å¾®æœåŠ¡ä¸­çš„ç›‘æ§ä½“ç³»ï¼Ÿ</strong></h2><ul><li>æŒ‡æ ‡ç›‘æ§ï¼šPrometheus + Grafanaã€‚</li><li>æ—¥å¿—ç›‘æ§ï¼šELKï¼ˆElasticsearch + Logstash + Kibanaï¼‰ã€‚</li><li>é“¾è·¯è¿½è¸ªï¼šSleuth + Zipkin&#x2F;Jaegerã€‚</li></ul><hr><h2 id="26-Prometheus-çš„åŸç†ï¼Ÿ"><a href="#26-Prometheus-çš„åŸç†ï¼Ÿ" class="headerlink" title="26. Prometheus çš„åŸç†ï¼Ÿ"></a><strong>26. Prometheus çš„åŸç†ï¼Ÿ</strong></h2><ul><li>åŸºäº Pull æ¨¡å‹ï¼Œå®šæœŸä»åº”ç”¨&#x2F;Exporter æ‹‰å–æŒ‡æ ‡ã€‚</li><li>TSDBï¼ˆæ—¶é—´åºåˆ—æ•°æ®åº“ï¼‰å­˜å‚¨æ•°æ®ã€‚</li><li>ç»“åˆ Grafana åšå¯è§†åŒ–ã€‚</li></ul><hr><h2 id="27-ELK-åœ¨å¾®æœåŠ¡ä¸­çš„åº”ç”¨ï¼Ÿ"><a href="#27-ELK-åœ¨å¾®æœåŠ¡ä¸­çš„åº”ç”¨ï¼Ÿ" class="headerlink" title="27. ELK åœ¨å¾®æœåŠ¡ä¸­çš„åº”ç”¨ï¼Ÿ"></a><strong>27. ELK åœ¨å¾®æœåŠ¡ä¸­çš„åº”ç”¨ï¼Ÿ</strong></h2><ul><li>Logstashï¼šæ—¥å¿—é‡‡é›†ã€‚</li><li>Elasticsearchï¼šæ—¥å¿—å­˜å‚¨ã€æœç´¢ã€‚</li><li>Kibanaï¼šæ—¥å¿—åˆ†æã€å¯è§†åŒ–ã€‚</li><li>ç”¨äºç»Ÿä¸€æ—¥å¿—å¹³å°ã€‚</li></ul><hr><h2 id="28-æœåŠ¡è°ƒç”¨é“¾è·¯è¿½è¸ªçš„æ„ä¹‰ï¼Ÿ"><a href="#28-æœåŠ¡è°ƒç”¨é“¾è·¯è¿½è¸ªçš„æ„ä¹‰ï¼Ÿ" class="headerlink" title="28. æœåŠ¡è°ƒç”¨é“¾è·¯è¿½è¸ªçš„æ„ä¹‰ï¼Ÿ"></a><strong>28. æœåŠ¡è°ƒç”¨é“¾è·¯è¿½è¸ªçš„æ„ä¹‰ï¼Ÿ</strong></h2><ul><li>è§£å†³â€œè°ƒç”¨é“¾ä¸æ¸…æ¥šâ€çš„é—®é¢˜ã€‚</li><li>å¿«é€Ÿå®šä½æ€§èƒ½ç“¶é¢ˆã€é”™è¯¯ä½ç½®ã€‚</li><li>æå‡è¿ç»´å¯è§‚æµ‹æ€§ã€‚</li></ul><hr><h2 id="29-æœåŠ¡é›ªå´©æ•ˆåº”æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#29-æœåŠ¡é›ªå´©æ•ˆåº”æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="29. æœåŠ¡é›ªå´©æ•ˆåº”æ˜¯ä»€ä¹ˆï¼Ÿ"></a><strong>29. æœåŠ¡é›ªå´©æ•ˆåº”æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h2><ul><li>ä¸€ä¸ªæœåŠ¡æ•…éšœ â†’ å¼•å‘è°ƒç”¨å®ƒçš„æœåŠ¡æ•…éšœ â†’ æœ€ç»ˆå¯¼è‡´æ•´ä¸ªç³»ç»Ÿå´©æºƒã€‚</li><li>åŸå› ï¼šä¾èµ–è°ƒç”¨æ— ä¿æŠ¤ï¼ˆæ— ç†”æ–­&#x2F;é™æµï¼‰ã€‚</li></ul><hr><h2 id="30-å¦‚ä½•è®¾è®¡ä¸€ä¸ªé«˜å¹¶å‘çš„å¾®æœåŠ¡ç³»ç»Ÿï¼Ÿ"><a href="#30-å¦‚ä½•è®¾è®¡ä¸€ä¸ªé«˜å¹¶å‘çš„å¾®æœåŠ¡ç³»ç»Ÿï¼Ÿ" class="headerlink" title="30. å¦‚ä½•è®¾è®¡ä¸€ä¸ªé«˜å¹¶å‘çš„å¾®æœåŠ¡ç³»ç»Ÿï¼Ÿ"></a><strong>30. å¦‚ä½•è®¾è®¡ä¸€ä¸ªé«˜å¹¶å‘çš„å¾®æœåŠ¡ç³»ç»Ÿï¼Ÿ</strong></h2><p><strong>æ ¸å¿ƒæ€è·¯</strong></p><ul><li>æ¶æ„ï¼šå¾®æœåŠ¡ + API ç½‘å…³ + æœåŠ¡æ²»ç†ã€‚</li><li>é«˜å¯ç”¨ï¼šè´Ÿè½½å‡è¡¡ã€å¤šå‰¯æœ¬ã€è‡ªåŠ¨æ•…éšœè½¬ç§»ã€‚</li><li>é«˜æ€§èƒ½ï¼šç¼“å­˜ï¼ˆRedisï¼‰ã€å¼‚æ­¥åŒ–ã€é™æµã€é™çº§ã€‚</li><li>æ•°æ®å±‚ï¼šåˆ†åº“åˆ†è¡¨ã€è¯»å†™åˆ†ç¦»ã€‚</li><li>å®‰å…¨ï¼šOAuth2&#x2F;JWTã€‚</li><li>å¯è§‚æµ‹æ€§ï¼šç›‘æ§ + æ—¥å¿— + é“¾è·¯è¿½è¸ªã€‚</li></ul><hr><h2 id="ä¸ƒã€æ•°æ®åº“-ç¼“å­˜ï¼ˆ30é¢˜ï¼‰"><a href="#ä¸ƒã€æ•°æ®åº“-ç¼“å­˜ï¼ˆ30é¢˜ï¼‰" class="headerlink" title="ä¸ƒã€æ•°æ®åº“ &amp; ç¼“å­˜ï¼ˆ30é¢˜ï¼‰"></a>ä¸ƒã€æ•°æ®åº“ &amp; ç¼“å­˜ï¼ˆ30é¢˜ï¼‰</h2><hr><h2 id="1-MySQL-çš„å­˜å‚¨å¼•æ“åŒºåˆ«"><a href="#1-MySQL-çš„å­˜å‚¨å¼•æ“åŒºåˆ«" class="headerlink" title="1. MySQL çš„å­˜å‚¨å¼•æ“åŒºåˆ«"></a><strong>1. MySQL çš„å­˜å‚¨å¼•æ“åŒºåˆ«</strong></h2><ul><li><strong>å­˜å‚¨å¼•æ“</strong>æ˜¯ MySQL ç®¡ç†æ•°æ®çš„åº•å±‚ç»„ä»¶ï¼Œå†³å®šäº†æ•°æ®å­˜å‚¨æ–¹å¼ã€äº‹åŠ¡æ”¯æŒã€é”æœºåˆ¶ã€ç´¢å¼•æ”¯æŒç­‰ã€‚</li><li><strong>ä¸»è¦å­˜å‚¨å¼•æ“</strong>ï¼š<ul><li><strong>InnoDB</strong>ï¼šäº‹åŠ¡å‹ï¼Œæ”¯æŒè¡Œçº§é”ã€å¤–é”®ã€MVCCã€å´©æºƒæ¢å¤ã€‚é€‚åˆé«˜å¹¶å‘ã€äº‹åŠ¡è¦æ±‚é«˜çš„åœºæ™¯ã€‚</li><li><strong>MyISAM</strong>ï¼šéäº‹åŠ¡å‹ï¼Œè¡¨çº§é”ï¼Œæ”¯æŒå…¨æ–‡ç´¢å¼•ã€‚é€‚åˆè¯»å¤šå†™å°‘ã€æ—¥å¿—æˆ–ç»Ÿè®¡ç±»è¡¨ã€‚</li><li><strong>Memory</strong>ï¼šæ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œè®¿é—®é€Ÿåº¦å¿«ï¼Œä½†æ–­ç”µæ•°æ®ä¸¢å¤±ã€‚é€‚åˆä¸´æ—¶è¡¨ã€‚</li><li><strong>Archive</strong>ï¼šå½’æ¡£å¼•æ“ï¼Œåªæ”¯æŒæ’å…¥å’ŒæŸ¥è¯¢ï¼Œä¸æ”¯æŒæ›´æ–°ï¼Œå‹ç¼©å­˜å‚¨ã€‚</li></ul></li><li><strong>é¢è¯•é‡ç‚¹</strong>ï¼š<ul><li>é€‰æ‹©å­˜å‚¨å¼•æ“éœ€æ ¹æ®ä¸šåŠ¡éœ€æ±‚ï¼šäº‹åŠ¡è¦æ±‚ã€å¹¶å‘é‡ã€æ•°æ®é‡å’Œæ¢å¤ç­–ç•¥ã€‚</li></ul></li></ul><hr><h2 id="2-InnoDB-å’Œ-MyISAM-çš„åŒºåˆ«"><a href="#2-InnoDB-å’Œ-MyISAM-çš„åŒºåˆ«" class="headerlink" title="2. InnoDB å’Œ MyISAM çš„åŒºåˆ«"></a><strong>2. InnoDB å’Œ MyISAM çš„åŒºåˆ«</strong></h2><table><thead><tr><th>ç‰¹æ€§</th><th>InnoDB</th><th>MyISAM</th></tr></thead><tbody><tr><td>äº‹åŠ¡</td><td>æ”¯æŒ ACID</td><td>ä¸æ”¯æŒ</td></tr><tr><td>é”ç±»å‹</td><td>è¡Œçº§é”+è¡¨é”</td><td>è¡¨çº§é”</td></tr><tr><td>å¤–é”®</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr><tr><td>å´©æºƒæ¢å¤</td><td>è‡ªåŠ¨æ¢å¤</td><td>éœ€æ‰‹åŠ¨ä¿®å¤</td></tr><tr><td>å…¨æ–‡ç´¢å¼•</td><td>5.6+ æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>å¹¶å‘åœºæ™¯</td><td>é«˜å¹¶å‘å†™+è¯»</td><td>è¯»å¤šå†™å°‘</td></tr><tr><td>é€‚ç”¨æ¡ˆä¾‹</td><td>é‡‘èã€ç”µå•†è®¢å•</td><td>æ—¥å¿—åˆ†æã€ç»Ÿè®¡è¡¨</td></tr></tbody></table><hr><h2 id="3-MySQL-äº‹åŠ¡ç‰¹æ€§"><a href="#3-MySQL-äº‹åŠ¡ç‰¹æ€§" class="headerlink" title="3. MySQL äº‹åŠ¡ç‰¹æ€§"></a><strong>3. MySQL äº‹åŠ¡ç‰¹æ€§</strong></h2><ul><li><strong>ACID åŸåˆ™</strong>ï¼š<ol><li><strong>åŸå­æ€§ï¼ˆAtomicï¼‰</strong>ï¼šäº‹åŠ¡å…¨éƒ¨æ‰§è¡Œæˆ–å…¨éƒ¨å›æ»šã€‚</li><li><strong>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰</strong>ï¼šäº‹åŠ¡æ‰§è¡Œå‰åæ•°æ®åº“çŠ¶æ€åˆæ³•ã€‚</li><li><strong>éš”ç¦»æ€§ï¼ˆIsolationï¼‰</strong>ï¼šäº‹åŠ¡äº’ä¸å¹²æ‰°ã€‚</li><li><strong>æŒä¹…æ€§ï¼ˆDurabilityï¼‰</strong>ï¼šæäº¤åæ•°æ®ä¸ä¼šä¸¢å¤±ã€‚</li></ol></li><li><strong>éš”ç¦»çº§åˆ«</strong>ï¼š<ul><li><strong>Read Uncommitted</strong>ï¼šå…è®¸è„è¯»ã€‚</li><li><strong>Read Committed</strong>ï¼šé˜²æ­¢è„è¯»ï¼Œä½†å¯èƒ½ä¸å¯é‡å¤è¯»ã€‚</li><li><strong>Repeatable Readï¼ˆé»˜è®¤ InnoDBï¼‰</strong>ï¼šé˜²æ­¢ä¸å¯é‡å¤è¯»ï¼Œé—´éš™é”è§£å†³å¹»è¯»ã€‚</li><li><strong>Serializable</strong>ï¼šå®Œå…¨ä¸²è¡Œæ‰§è¡Œï¼Œæ€§èƒ½æœ€ä½ï¼Œä½†å®Œå…¨éš”ç¦»ã€‚</li></ul></li><li><strong>é¢è¯•è¿½é—®</strong>ï¼šéš”ç¦»çº§åˆ«ä¸æ­»é”ã€æ€§èƒ½çš„æƒè¡¡ã€‚</li></ul><hr><h2 id="4-MVCC-çš„å®ç°åŸç†"><a href="#4-MVCC-çš„å®ç°åŸç†" class="headerlink" title="4. MVCC çš„å®ç°åŸç†"></a><strong>4. MVCC çš„å®ç°åŸç†</strong></h2><ul><li><strong>åŸç†</strong>ï¼š<ul><li>InnoDB ä¸ºæ¯è¡Œå¢åŠ éšè—åˆ— <code>trx_id</code> å’Œ <code>roll_pointer</code>ã€‚</li><li>æŸ¥è¯¢æ—¶æ ¹æ®äº‹åŠ¡ ID åˆ¤æ–­å“ªä¸€ç‰ˆæœ¬å¯è§ã€‚</li><li>è¯»æ“ä½œä¸é˜»å¡å†™æ“ä½œï¼Œå®ç° <strong>éé˜»å¡è¯»</strong>ã€‚</li></ul></li><li><strong>åº”ç”¨</strong>ï¼šæé«˜å¹¶å‘æ€§èƒ½ï¼Œé¿å…è¯»å†™äº’ç›¸é˜»å¡ã€‚</li><li><strong>é¢è¯•è¿½é—®</strong>ï¼šMVCC å¦‚ä½•å®ç° Repeatable Readï¼Œä¸ºä»€ä¹ˆä¸é”è¡¨ã€‚</li></ul><hr><h2 id="5-MySQL-çš„ç´¢å¼•ç±»å‹"><a href="#5-MySQL-çš„ç´¢å¼•ç±»å‹" class="headerlink" title="5. MySQL çš„ç´¢å¼•ç±»å‹"></a><strong>5. MySQL çš„ç´¢å¼•ç±»å‹</strong></h2><ul><li><strong>B+ æ ‘ç´¢å¼•</strong>ï¼šèŒƒå›´æŸ¥è¯¢ã€æ’åºï¼Œå¶å­èŠ‚ç‚¹æŒ‰é¡ºåºè¿æ¥ã€‚</li><li><strong>å“ˆå¸Œç´¢å¼•</strong>ï¼šç²¾ç¡®æŸ¥æ‰¾å¿«ï¼ˆMemory å¼•æ“ï¼‰ã€‚</li><li><strong>å…¨æ–‡ç´¢å¼•</strong>ï¼šæ–‡æœ¬æœç´¢ã€‚</li><li><strong>ç©ºé—´ç´¢å¼•</strong>ï¼šåœ°ç†ä¿¡æ¯æŸ¥è¯¢ï¼ˆR-Treeï¼‰ã€‚</li><li><strong>é¢è¯•è¿½é—®</strong>ï¼šä»€ä¹ˆæ—¶å€™é€‰æ‹©ç»„åˆç´¢å¼•ï¼Œè¦†ç›–ç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢ã€‚</li></ul><hr><h2 id="6-èšç°‡ç´¢å¼•-vs-éèšç°‡ç´¢å¼•"><a href="#6-èšç°‡ç´¢å¼•-vs-éèšç°‡ç´¢å¼•" class="headerlink" title="6. èšç°‡ç´¢å¼• vs éèšç°‡ç´¢å¼•"></a><strong>6. èšç°‡ç´¢å¼• vs éèšç°‡ç´¢å¼•</strong></h2><ul><li><strong>èšç°‡ç´¢å¼•</strong>ï¼š<ul><li>æ•°æ®è¡Œå­˜å‚¨é¡ºåºä¸ä¸»é”®é¡ºåºä¸€è‡´ã€‚</li><li>æŸ¥è¯¢èŒƒå›´ã€æ’åºæ•ˆç‡é«˜ã€‚</li></ul></li><li><strong>éèšç°‡ç´¢å¼•</strong>ï¼š<ul><li>ç´¢å¼•å­˜ key + ä¸»é”®ï¼Œå›è¡¨è·å–å…¶ä»–å­—æ®µã€‚</li></ul></li><li><strong>é¢è¯•è¿½é—®</strong>ï¼šèšç°‡ç´¢å¼•æ’å…¥é¡ºåºå¯¹æ€§èƒ½å½±å“ï¼Œå›è¡¨æˆæœ¬ã€‚</li></ul><hr><h2 id="7-B-æ ‘ç´¢å¼•åŸç†"><a href="#7-B-æ ‘ç´¢å¼•åŸç†" class="headerlink" title="7. B+ æ ‘ç´¢å¼•åŸç†"></a><strong>7. B+ æ ‘ç´¢å¼•åŸç†</strong></h2><ul><li>å†…èŠ‚ç‚¹ï¼šå­˜ key + å­èŠ‚ç‚¹æŒ‡é’ˆ</li><li>å¶å­èŠ‚ç‚¹ï¼šå­˜å®Œæ•´è®°å½•æˆ–æŒ‡é’ˆï¼Œå¹¶é“¾è¡¨è¿æ¥</li><li><strong>ç‰¹ç‚¹</strong>ï¼š<ul><li>æ”¯æŒèŒƒå›´æŸ¥è¯¢</li><li>ç£ç›˜ IO é«˜æ•ˆ</li></ul></li><li><strong>é¢è¯•è¿½é—®</strong>ï¼šä¸ºä»€ä¹ˆ MySQL é€‰æ‹© B+ æ ‘è€Œä¸æ˜¯ B æ ‘æˆ– Hashã€‚</li></ul><hr><h2 id="8-è¦†ç›–ç´¢å¼•-vs-å›è¡¨"><a href="#8-è¦†ç›–ç´¢å¼•-vs-å›è¡¨" class="headerlink" title="8. è¦†ç›–ç´¢å¼• vs å›è¡¨"></a><strong>8. è¦†ç›–ç´¢å¼• vs å›è¡¨</strong></h2><ul><li><strong>è¦†ç›–ç´¢å¼•</strong>ï¼šç´¢å¼•åŒ…å«æ‰€æœ‰æŸ¥è¯¢å­—æ®µï¼Œæ— éœ€è®¿é—®è¡¨ã€‚</li><li><strong>å›è¡¨</strong>ï¼šç´¢å¼•åªåŒ…å«éƒ¨åˆ†å­—æ®µï¼Œéœ€è¦é€šè¿‡ä¸»é”®æŸ¥è¡¨ã€‚</li><li><strong>ä¼˜åŒ–æ–¹æ³•</strong>ï¼šå°½é‡è®©çƒ­ç‚¹æŸ¥è¯¢ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼Œå‡å°‘ IOã€‚</li></ul><hr><h2 id="9-ç´¢å¼•ä¸‹æ¨ä¼˜åŒ–"><a href="#9-ç´¢å¼•ä¸‹æ¨ä¼˜åŒ–" class="headerlink" title="9. ç´¢å¼•ä¸‹æ¨ä¼˜åŒ–"></a><strong>9. ç´¢å¼•ä¸‹æ¨ä¼˜åŒ–</strong></h2><ul><li>WHERE æ¡ä»¶åœ¨å­˜å‚¨å¼•æ“å±‚è¿‡æ»¤ï¼Œå‡å°‘è¿”å›ä¸Šå±‚çš„æ•°æ®é‡ã€‚</li><li>ç‰¹åˆ«åœ¨ç»„åˆç´¢å¼•æˆ–å‡½æ•°æŸ¥è¯¢æ—¶æœ‰æ•ˆã€‚</li><li><strong>é¢è¯•è¿½é—®</strong>ï¼šç´¢å¼•ä¸‹æ¨èƒ½å¦åº”ç”¨äºé InnoDB å­˜å‚¨å¼•æ“ã€‚</li></ul><hr><h2 id="10-MySQL-é”æœºåˆ¶"><a href="#10-MySQL-é”æœºåˆ¶" class="headerlink" title="10. MySQL é”æœºåˆ¶"></a><strong>10. MySQL é”æœºåˆ¶</strong></h2><ul><li><strong>è¡¨é”</strong>ï¼šé”æ•´å¼ è¡¨ï¼Œä½å¹¶å‘ã€‚</li><li><strong>è¡Œé”</strong>ï¼šé”å•è¡Œï¼ŒInnoDB é»˜è®¤ã€‚</li><li><strong>æ„å‘é”</strong>ï¼šè¡¨çº§é”æ„å›¾ï¼Œé¿å…æ­»é”ã€‚</li><li><strong>é—´éš™é”</strong>ï¼šé˜²æ­¢å¹»è¯»ã€‚</li><li><strong>é¢è¯•è¿½é—®</strong>ï¼šè¡Œé”ã€è¡¨é”çš„å®ç°åŸç†ï¼Œé”å†²çªå¦‚ä½•å¤„ç†ã€‚</li></ul><hr><h2 id="11-è¡Œé”-vs-è¡¨é”"><a href="#11-è¡Œé”-vs-è¡¨é”" class="headerlink" title="11. è¡Œé” vs è¡¨é”"></a><strong>11. è¡Œé” vs è¡¨é”</strong></h2><ul><li>è¡Œé”ï¼šç²’åº¦å°ï¼Œé«˜å¹¶å‘ï¼Œäº‹åŠ¡å®‰å…¨ã€‚</li><li>è¡¨é”ï¼šç²’åº¦å¤§ï¼Œé€‚åˆæ‰¹é‡æ“ä½œã€‚</li><li><strong>åº”ç”¨åœºæ™¯</strong>ï¼šé«˜å¹¶å‘å†™ç”¨è¡Œé”ï¼Œæ‰¹é‡æ›´æ–°å¯ç”¨è¡¨é”ã€‚</li></ul><hr><h2 id="12-é—´éš™é”"><a href="#12-é—´éš™é”" class="headerlink" title="12. é—´éš™é”"></a><strong>12. é—´éš™é”</strong></h2><ul><li>é”å®šç´¢å¼•é—´éš™ï¼Œé˜²æ­¢å…¶ä»–äº‹åŠ¡æ’å…¥å¹»è¯»ã€‚</li><li>ä¸è®°å½•é”ç»“åˆå½¢æˆ <strong>Next-Key Lock</strong>ã€‚</li><li>é»˜è®¤åœ¨ Repeatable Read ä¸‹ä½¿ç”¨ã€‚</li></ul><hr><h2 id="13-æ­»é”æ’æŸ¥"><a href="#13-æ­»é”æ’æŸ¥" class="headerlink" title="13. æ­»é”æ’æŸ¥"></a><strong>13. æ­»é”æ’æŸ¥</strong></h2><ul><li><code>SHOW ENGINE INNODB STATUS\G</code> æŸ¥çœ‹æœ€æ–°æ­»é”ã€‚</li><li>ä¼˜åŒ–ï¼š<ol><li>ç»Ÿä¸€è®¿é—®è¡¨é¡ºåºã€‚</li><li>å°½é‡ç¼©çŸ­äº‹åŠ¡æ—¶é—´ã€‚</li><li>åŠ ç´¢å¼•å‡å°‘æ‰«æè¡Œæ•°ã€‚</li></ol></li></ul><hr><h2 id="14-SQL-æ‰§è¡Œè®¡åˆ’"><a href="#14-SQL-æ‰§è¡Œè®¡åˆ’" class="headerlink" title="14. SQL æ‰§è¡Œè®¡åˆ’"></a><strong>14. SQL æ‰§è¡Œè®¡åˆ’</strong></h2><ul><li>ä½¿ç”¨ <code>EXPLAIN</code> åˆ†æï¼š<ul><li>typeï¼šè®¿é—®ç±»å‹ï¼ˆALL &lt; INDEX &lt; REF &lt; CONSTï¼‰</li><li>keyï¼šä½¿ç”¨çš„ç´¢å¼•</li><li>rowsï¼šæ‰«æè¡Œæ•°</li><li>Extraï¼šå¦‚ Using index, Using temporary</li></ul></li></ul><hr><h2 id="15-æ…¢æŸ¥è¯¢ä¼˜åŒ–"><a href="#15-æ…¢æŸ¥è¯¢ä¼˜åŒ–" class="headerlink" title="15. æ…¢æŸ¥è¯¢ä¼˜åŒ–"></a><strong>15. æ…¢æŸ¥è¯¢ä¼˜åŒ–</strong></h2><ul><li>å»ºç´¢å¼•ï¼ˆè¦†ç›–ç´¢å¼•ã€ç»„åˆç´¢å¼•ï¼‰</li><li>é¿å… SELECT *</li><li>é¿å…åœ¨åˆ—ä¸Šå‡½æ•°æ“ä½œ</li><li>åˆ†åº“åˆ†è¡¨</li><li>ç¼“å­˜ï¼ˆRedis&#x2F;Caffeineï¼‰</li></ul><hr><h2 id="16-åˆ†åº“åˆ†è¡¨éš¾ç‚¹"><a href="#16-åˆ†åº“åˆ†è¡¨éš¾ç‚¹" class="headerlink" title="16. åˆ†åº“åˆ†è¡¨éš¾ç‚¹"></a><strong>16. åˆ†åº“åˆ†è¡¨éš¾ç‚¹</strong></h2><ul><li>è·¨åº“ joinã€åˆ†é¡µ</li><li>åˆ†å¸ƒå¼äº‹åŠ¡</li><li>å…¨å±€å”¯ä¸€ ID</li><li>æ•°æ®è·¯ç”±ã€è¿ç§»</li></ul><hr><h2 id="17-åˆ†å¸ƒå¼äº‹åŠ¡"><a href="#17-åˆ†å¸ƒå¼äº‹åŠ¡" class="headerlink" title="17. åˆ†å¸ƒå¼äº‹åŠ¡"></a><strong>17. åˆ†å¸ƒå¼äº‹åŠ¡</strong></h2><ul><li><strong>XA</strong>ï¼šä¸¤é˜¶æ®µæäº¤ï¼Œä¿è¯å¼ºä¸€è‡´æ€§ã€‚</li><li><strong>TCC</strong>ï¼šTry â†’ Confirm â†’ Cancelï¼Œä¸šåŠ¡è¡¥å¿æ“ä½œã€‚</li><li><strong>SAGA</strong>ï¼šé•¿äº‹åŠ¡è¡¥å¿ã€‚</li><li><strong>æœ¬åœ°æ¶ˆæ¯è¡¨ + MQ</strong>ï¼šæœ€ç»ˆä¸€è‡´æ€§ã€‚</li></ul><hr><h2 id="18-Redis-æ•°æ®ç»“æ„"><a href="#18-Redis-æ•°æ®ç»“æ„" class="headerlink" title="18. Redis æ•°æ®ç»“æ„"></a><strong>18. Redis æ•°æ®ç»“æ„</strong></h2><ul><li><strong>String</strong>ã€<strong>Hash</strong>ã€<strong>List</strong>ã€<strong>Set</strong>ã€<strong>Sorted Set</strong></li><li>Bitmapã€HyperLogLogã€Geo</li><li>åº”ç”¨ï¼šæ’è¡Œæ¦œã€è®¡æ•°ã€é›†åˆæ“ä½œã€åœ°ç†ä½ç½®ã€å¸ƒéš†è¿‡æ»¤å™¨</li></ul><hr><h2 id="19-Redis-ä¸ºä»€ä¹ˆå¿«"><a href="#19-Redis-ä¸ºä»€ä¹ˆå¿«" class="headerlink" title="19. Redis ä¸ºä»€ä¹ˆå¿«"></a><strong>19. Redis ä¸ºä»€ä¹ˆå¿«</strong></h2><ul><li>å…¨å†…å­˜å­˜å‚¨</li><li>å•çº¿ç¨‹ + epoll</li><li>é«˜æ•ˆæ•°æ®ç»“æ„</li><li>é¿å…é”ç«äº‰</li></ul><hr><h2 id="20-Redis-æŒä¹…åŒ–"><a href="#20-Redis-æŒä¹…åŒ–" class="headerlink" title="20. Redis æŒä¹…åŒ–"></a><strong>20. Redis æŒä¹…åŒ–</strong></h2><ul><li><strong>RDB</strong>ï¼šå®šæœŸå¿«ç…§</li><li><strong>AOF</strong>ï¼šå†™å‘½ä»¤æ—¥å¿—ï¼Œappend only</li><li><strong>æ··åˆæŒä¹…åŒ–</strong>ï¼šRDB + AOFï¼Œæé«˜å®‰å…¨æ€§ä¸æ•ˆç‡</li></ul><hr><h2 id="21-Redis-è¿‡æœŸç­–ç•¥"><a href="#21-Redis-è¿‡æœŸç­–ç•¥" class="headerlink" title="21. Redis è¿‡æœŸç­–ç•¥"></a><strong>21. Redis è¿‡æœŸç­–ç•¥</strong></h2><ul><li><strong>æƒ°æ€§åˆ é™¤</strong>ï¼šè®¿é—®æ—¶æ£€æŸ¥ TTL</li><li><strong>å®šæœŸåˆ é™¤</strong>ï¼šå‘¨æœŸæ€§æ‰«æ</li><li><strong>å®šæ—¶åˆ é™¤</strong>ï¼šæ¯ä¸ª key å•ç‹¬å®šæ—¶å™¨</li></ul><hr><h2 id="22-Redis-å†…å­˜æ·˜æ±°ç­–ç•¥"><a href="#22-Redis-å†…å­˜æ·˜æ±°ç­–ç•¥" class="headerlink" title="22. Redis å†…å­˜æ·˜æ±°ç­–ç•¥"></a><strong>22. Redis å†…å­˜æ·˜æ±°ç­–ç•¥</strong></h2><ul><li>noevictionã€allkeys-lruã€volatile-lruã€allkeys-lfuã€volatile-ttl</li><li>LRUï¼šæœ€è¿‘æœ€å°‘ä½¿ç”¨</li><li>LFUï¼šä½¿ç”¨é¢‘ç‡æœ€ä½</li><li>TTLï¼šä¸´æœŸä¼˜å…ˆæ·˜æ±°</li></ul><hr><h2 id="23-Redis-ä¸»ä»å¤åˆ¶"><a href="#23-Redis-ä¸»ä»å¤åˆ¶" class="headerlink" title="23. Redis ä¸»ä»å¤åˆ¶"></a><strong>23. Redis ä¸»ä»å¤åˆ¶</strong></h2><ul><li>å¼‚æ­¥å¤åˆ¶</li><li>å…¨é‡å¤åˆ¶ + å¢é‡å¤åˆ¶</li><li>è¯»å†™åˆ†ç¦»ï¼Œæå‡æ‰©å±•æ€§</li></ul><hr><h2 id="24-Redis-å“¨å…µæœºåˆ¶"><a href="#24-Redis-å“¨å…µæœºåˆ¶" class="headerlink" title="24. Redis å“¨å…µæœºåˆ¶"></a><strong>24. Redis å“¨å…µæœºåˆ¶</strong></h2><ul><li>ç›‘æ§ã€é€šçŸ¥ã€æ•…éšœè½¬ç§»</li><li>Sentinel æŠ•ç¥¨æœºåˆ¶åˆ‡æ¢ä¸»èŠ‚ç‚¹</li><li>é«˜å¯ç”¨æ¶æ„æ ¸å¿ƒç»„ä»¶</li></ul><hr><h2 id="25-Redis-é›†ç¾¤æ¨¡å¼"><a href="#25-Redis-é›†ç¾¤æ¨¡å¼" class="headerlink" title="25. Redis é›†ç¾¤æ¨¡å¼"></a><strong>25. Redis é›†ç¾¤æ¨¡å¼</strong></h2><ul><li>16384 ä¸ªå“ˆå¸Œæ§½åˆ†ç‰‡</li><li>Master + Slave</li><li>è·¨æ§½æ“ä½œæœ‰é™åˆ¶</li><li>é«˜å¯ç”¨ + æ°´å¹³æ‰©å±•</li></ul><hr><h2 id="26-Redis-åˆ†å¸ƒå¼é”"><a href="#26-Redis-åˆ†å¸ƒå¼é”" class="headerlink" title="26. Redis åˆ†å¸ƒå¼é”"></a><strong>26. Redis åˆ†å¸ƒå¼é”</strong></h2><ul><li><strong>å•æœº</strong>ï¼šSETNX + EXPIRE</li><li><strong>Redisson</strong>ï¼š<ul><li>è‡ªåŠ¨ç»­æœŸï¼ˆçœ‹é—¨ç‹—æœºåˆ¶ï¼‰</li><li>å¯é‡å…¥é”</li><li>å…¬å¹³é”</li></ul></li><li><strong>RedLock</strong>ï¼šå¤šèŠ‚ç‚¹å¼ºä¸€è‡´æ€§</li></ul><hr><h2 id="27-Redis-å¸¸è§é—®é¢˜"><a href="#27-Redis-å¸¸è§é—®é¢˜" class="headerlink" title="27. Redis å¸¸è§é—®é¢˜"></a><strong>27. Redis å¸¸è§é—®é¢˜</strong></h2><ul><li>å†…å­˜ä¸è¶³ &#x2F; OOM</li><li>çƒ­ç‚¹ key</li><li>bigkey å¯¼è‡´é˜»å¡</li><li>RDB fork é˜»å¡</li><li>ä¸»ä»å»¶è¿Ÿ</li></ul><hr><h2 id="28-ç¼“å­˜ç©¿é€ã€å‡»ç©¿ã€é›ªå´©"><a href="#28-ç¼“å­˜ç©¿é€ã€å‡»ç©¿ã€é›ªå´©" class="headerlink" title="28. ç¼“å­˜ç©¿é€ã€å‡»ç©¿ã€é›ªå´©"></a><strong>28. ç¼“å­˜ç©¿é€ã€å‡»ç©¿ã€é›ªå´©</strong></h2><ul><li><strong>ç©¿é€</strong>ï¼šä¸å­˜åœ¨æ•°æ®é¢‘ç¹è®¿é—® â†’ å¸ƒéš†è¿‡æ»¤å™¨</li><li><strong>å‡»ç©¿</strong>ï¼šçƒ­ç‚¹ key ç¬é—´å¤±æ•ˆ â†’ äº’æ–¥é”&#x2F;æ°¸ä¸è¿‡æœŸç¼“å­˜</li><li><strong>é›ªå´©</strong>ï¼šå¤§é‡ key åŒæ—¶è¿‡æœŸ â†’ TTL + éšæœºå€¼</li></ul><hr><h2 id="29-ç¼“å­˜ä¸æ•°æ®åº“ä¸€è‡´æ€§"><a href="#29-ç¼“å­˜ä¸æ•°æ®åº“ä¸€è‡´æ€§" class="headerlink" title="29. ç¼“å­˜ä¸æ•°æ®åº“ä¸€è‡´æ€§"></a><strong>29. ç¼“å­˜ä¸æ•°æ®åº“ä¸€è‡´æ€§</strong></h2><ul><li><strong>Cache Aside</strong>ï¼šå…ˆ DBï¼Œå†åˆ ç¼“å­˜</li><li><strong>åŒå†™</strong>ï¼šDB + ç¼“å­˜åŒæ­¥æ›´æ–°</li><li><strong>å¼‚æ­¥æ¶ˆæ¯</strong>ï¼šMQ + å»¶æ—¶é˜Ÿåˆ—ï¼Œå®ç°æœ€ç»ˆä¸€è‡´æ€§</li></ul><hr><h2 id="30-Redis-vs-Caffeine"><a href="#30-Redis-vs-Caffeine" class="headerlink" title="30. Redis vs Caffeine"></a><strong>30. Redis vs Caffeine</strong></h2><table><thead><tr><th>ç‰¹æ€§</th><th>Redis</th><th>Caffeine</th></tr></thead><tbody><tr><td>ç±»å‹</td><td>åˆ†å¸ƒå¼ç¼“å­˜</td><td>æœ¬åœ°ç¼“å­˜</td></tr><tr><td>æŒä¹…åŒ–</td><td>RDB &#x2F; AOF</td><td>ä¸æ”¯æŒ</td></tr><tr><td>é›†ç¾¤</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr><tr><td>è®¿é—®é€Ÿåº¦</td><td>æ¯«ç§’çº§</td><td>çº³ç§’çº§</td></tr><tr><td>åœºæ™¯</td><td>åˆ†å¸ƒå¼å…±äº«ï¼Œé«˜å¹¶å‘</td><td>æœ¬åœ°çƒ­ç‚¹ç¼“å­˜</td></tr></tbody></table><p><strong>æœ€ä½³å®è·µ</strong>ï¼šCaffeineï¼ˆæœ¬åœ°ç¼“å­˜ï¼‰+ Redisï¼ˆåˆ†å¸ƒå¼ç¼“å­˜ï¼‰+ DB â†’ å¤šçº§ç¼“å­˜ç»“æ„ã€‚</p><hr><h2 id="å…«ã€æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆ30é¢˜ï¼‰"><a href="#å…«ã€æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆ30é¢˜ï¼‰" class="headerlink" title="å…«ã€æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆ30é¢˜ï¼‰"></a>å…«ã€æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆ30é¢˜ï¼‰</h2><hr><h2 id="1-ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ"><a href="#1-ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ" class="headerlink" title="1. ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ"></a><strong>1. ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ</strong></h2><ul><li><strong>è§£è€¦ç³»ç»Ÿ</strong>ï¼šç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…ä¸ç›´æ¥è°ƒç”¨ï¼Œé€šè¿‡é˜Ÿåˆ—ä¼ é€’æ¶ˆæ¯ã€‚</li><li><strong>å¼‚æ­¥å¤„ç†</strong>ï¼šç”¨æˆ·è¯·æ±‚ä¸ç­‰å¾…åç«¯ä¸šåŠ¡å®Œæˆï¼Œæé«˜å“åº”é€Ÿåº¦ã€‚</li><li><strong>å‰Šå³°å¡«è°·</strong>ï¼šç¼“å†²é«˜å³°æµé‡ï¼Œé¿å…æ•°æ®åº“æˆ–æœåŠ¡å‹åŠ›è¿‡å¤§ã€‚</li><li><strong>å¯é ä¼ è¾“</strong>ï¼šé€šè¿‡æŒä¹…åŒ–ã€ACK æœºåˆ¶ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ã€‚</li><li><strong>å¯æ‰©å±•æ€§</strong>ï¼šå¢åŠ æ¶ˆè´¹è€…å¯æ°´å¹³æ‰©å±•ï¼Œæé«˜ç³»ç»Ÿååé‡ã€‚</li><li><strong>é¢è¯•è¿½é—®</strong>ï¼šä¸ºä»€ä¹ˆ MQ å¯ä»¥è§£å†³å¾®æœåŠ¡é—´è€¦åˆé—®é¢˜ï¼Ÿ</li></ul><hr><h2 id="2-æ¶ˆæ¯é˜Ÿåˆ—çš„ä¼˜ç¼ºç‚¹"><a href="#2-æ¶ˆæ¯é˜Ÿåˆ—çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="2. æ¶ˆæ¯é˜Ÿåˆ—çš„ä¼˜ç¼ºç‚¹"></a><strong>2. æ¶ˆæ¯é˜Ÿåˆ—çš„ä¼˜ç¼ºç‚¹</strong></h2><ul><li><strong>ä¼˜ç‚¹</strong>ï¼š<ul><li>å¼‚æ­¥å¤„ç†æå‡ååé‡</li><li>ç³»ç»Ÿè§£è€¦</li><li>æ”¯æŒå‰Šå³°å¡«è°·</li><li>æ¶ˆæ¯å¯é æ€§å¯æ§</li></ul></li><li><strong>ç¼ºç‚¹</strong>ï¼š<ul><li>ç³»ç»Ÿå¤æ‚åº¦å¢åŠ </li><li>æ¶ˆæ¯å»¶è¿Ÿ</li><li>é¡ºåºå’Œé‡å¤æ¶ˆè´¹éœ€è¦é¢å¤–å¤„ç†</li></ul></li><li><strong>ä¼˜åŒ–ç‚¹</strong>ï¼šç»“åˆå¹‚ç­‰è®¾è®¡ã€å»¶è¿Ÿé˜Ÿåˆ—å’Œæ‰¹é‡å¤„ç†</li></ul><hr><h2 id="3-RabbitMQ-æ ¸å¿ƒç»„ä»¶"><a href="#3-RabbitMQ-æ ¸å¿ƒç»„ä»¶" class="headerlink" title="3. RabbitMQ æ ¸å¿ƒç»„ä»¶"></a><strong>3. RabbitMQ æ ¸å¿ƒç»„ä»¶</strong></h2><ul><li><strong>Producer</strong>ï¼šå‘é€æ¶ˆæ¯</li><li><strong>Exchange</strong>ï¼šè·¯ç”±æ¶ˆæ¯ï¼ˆDirectã€Fanoutã€Topicã€Headersï¼‰</li><li><strong>Queue</strong>ï¼šå­˜å‚¨æ¶ˆæ¯</li><li><strong>Binding</strong>ï¼šç»‘å®š Exchange å’Œ Queue</li><li><strong>Consumer</strong>ï¼šæ¥æ”¶æ¶ˆæ¯</li><li><strong>åŸç†</strong>ï¼šExchange å†³å®šè·¯ç”±è§„åˆ™ï¼ŒQueue è´Ÿè´£ç¼“å†²å’ŒæŠ•é€’</li></ul><hr><h2 id="4-RabbitMQ-æ¶ˆæ¯ç¡®è®¤æœºåˆ¶"><a href="#4-RabbitMQ-æ¶ˆæ¯ç¡®è®¤æœºåˆ¶" class="headerlink" title="4. RabbitMQ æ¶ˆæ¯ç¡®è®¤æœºåˆ¶"></a><strong>4. RabbitMQ æ¶ˆæ¯ç¡®è®¤æœºåˆ¶</strong></h2><ul><li><strong>ç”Ÿäº§è€…ç«¯</strong>ï¼š<ul><li>Publisher Confirmï¼Œç¡®ä¿æ¶ˆæ¯å†™å…¥ Broker</li></ul></li><li><strong>æ¶ˆè´¹è€…ç«¯</strong>ï¼š<ul><li>è‡ªåŠ¨ ackï¼šæ¶ˆè´¹å³ç¡®è®¤</li><li>æ‰‹åŠ¨ ackï¼šæˆåŠŸå¤„ç†åç¡®è®¤</li></ul></li><li><strong>åº”ç”¨å®è·µ</strong>ï¼šæ‰‹åŠ¨ ack å¯å¤„ç†å¼‚å¸¸é‡è¯•ï¼Œä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±</li></ul><hr><h2 id="5-Kafka-æ ¸å¿ƒæ¦‚å¿µ"><a href="#5-Kafka-æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="5. Kafka æ ¸å¿ƒæ¦‚å¿µ"></a><strong>5. Kafka æ ¸å¿ƒæ¦‚å¿µ</strong></h2><ul><li><strong>Producer&#x2F;Consumer</strong>ï¼šæ¶ˆæ¯å‘é€å’Œæ¥æ”¶</li><li><strong>Topic&#x2F;Partition</strong>ï¼šä¸»é¢˜å’Œåˆ†åŒº</li><li><strong>Broker&#x2F;Cluster</strong>ï¼šèŠ‚ç‚¹å’Œé›†ç¾¤</li><li><strong>Consumer Group</strong>ï¼šæ¶ˆè´¹ç»„å®ç°è´Ÿè½½å‡è¡¡</li><li><strong>Offset</strong>ï¼šè®°å½•æ¶ˆè´¹ä½ç½®</li><li><strong>åŸç†</strong>ï¼šç”Ÿäº§è€…å†™å…¥ Partitionï¼Œæ¶ˆè´¹è€…æ ¹æ® Offset æ¶ˆè´¹</li></ul><hr><h2 id="6-Kafka-åˆ†åŒºæœºåˆ¶"><a href="#6-Kafka-åˆ†åŒºæœºåˆ¶" class="headerlink" title="6. Kafka åˆ†åŒºæœºåˆ¶"></a><strong>6. Kafka åˆ†åŒºæœºåˆ¶</strong></h2><ul><li><strong>Partition æé«˜å¹¶è¡Œ</strong></li><li><strong>åˆ†åŒºå†…é¡ºåºä¿è¯</strong></li><li><strong>è·¯ç”±ç­–ç•¥</strong>ï¼šé»˜è®¤è½®è¯¢ï¼Œæˆ– Key å“ˆå¸Œåˆ†åŒº</li><li><strong>é¢è¯•ç‚¹</strong>ï¼šå¦‚ä½•ä¿è¯å…¨å±€é¡ºåºï¼Ÿåªèƒ½ä¿è¯åˆ†åŒºå†…é¡ºåº</li></ul><hr><h2 id="7-Kafka-å‰¯æœ¬æœºåˆ¶"><a href="#7-Kafka-å‰¯æœ¬æœºåˆ¶" class="headerlink" title="7. Kafka å‰¯æœ¬æœºåˆ¶"></a><strong>7. Kafka å‰¯æœ¬æœºåˆ¶</strong></h2><ul><li><strong>Leader&#x2F;Follower ç»“æ„</strong></li><li><strong>åŒæ­¥æœºåˆ¶</strong>ï¼šISR åˆ—è¡¨è·Ÿéš Leader</li><li><strong>é«˜å¯ç”¨</strong>ï¼šLeader å¼‚å¸¸è‡ªåŠ¨åˆ‡æ¢</li><li><strong>é¢è¯•æ‹“å±•</strong>ï¼šå‰¯æœ¬åŒæ­¥æ¨¡å¼å¯¹æ€§èƒ½çš„å½±å“</li></ul><hr><h2 id="8-Kafka-ISR-åŸç†"><a href="#8-Kafka-ISR-åŸç†" class="headerlink" title="8. Kafka ISR åŸç†"></a><strong>8. Kafka ISR åŸç†</strong></h2><ul><li><strong>ISRï¼ˆIn-Sync Replicasï¼‰</strong>ï¼šè·Ÿä¸Š Leader çš„å‰¯æœ¬é›†åˆ</li><li><strong>æ¶ˆæ¯æäº¤è§„åˆ™</strong>ï¼šåªè¦ ISR å†…å‰¯æœ¬å†™å…¥æ‰ç®—æˆåŠŸ</li><li><strong>ä¼˜åŒ–</strong>ï¼šå‰¯æœ¬æ•°é‡ä¸ ACK ç­–ç•¥å¯è°ƒèŠ‚å¯é æ€§ä¸ååé‡</li></ul><hr><h2 id="9-Kafka-æ¶ˆè´¹ç»„åŸç†"><a href="#9-Kafka-æ¶ˆè´¹ç»„åŸç†" class="headerlink" title="9. Kafka æ¶ˆè´¹ç»„åŸç†"></a><strong>9. Kafka æ¶ˆè´¹ç»„åŸç†</strong></h2><ul><li>åŒä¸€ç»„å†…çš„æ¯ä¸ª Partition åªè¢«ä¸€ä¸ª Consumer æ¶ˆè´¹</li><li>å¤šç»„å¯é‡å¤æ¶ˆè´¹ï¼Œå®ç°å¹¿æ’­</li><li>æé«˜å¹¶è¡Œæ¶ˆè´¹ï¼Œå‡å°‘é‡å¤æ¶ˆè´¹</li><li><strong>æ‹“å±•</strong>ï¼šæ¶ˆè´¹ç»„é‡å¹³è¡¡ã€å†å‡è¡¡æœºåˆ¶</li></ul><hr><h2 id="10-Kafka-Offset-æäº¤æ–¹å¼"><a href="#10-Kafka-Offset-æäº¤æ–¹å¼" class="headerlink" title="10. Kafka Offset æäº¤æ–¹å¼"></a><strong>10. Kafka Offset æäº¤æ–¹å¼</strong></h2><ul><li>è‡ªåŠ¨æäº¤ï¼šæ¶ˆè´¹å®Œæˆåè‡ªåŠ¨æäº¤ Offset</li><li>æ‰‹åŠ¨æäº¤ï¼š<ul><li>åŒæ­¥æäº¤ï¼šé˜»å¡ç­‰å¾…</li><li>å¼‚æ­¥æäº¤ï¼šæ€§èƒ½é«˜ï¼Œå¯èƒ½ä¸¢å°‘é‡æ¶ˆæ¯</li></ul></li><li><strong>å®è·µ</strong>ï¼šç»“åˆäº‹åŠ¡å®ç° Exactly Once</li></ul><hr><h2 id="11-Kafka-é«˜ååé‡åŸç†"><a href="#11-Kafka-é«˜ååé‡åŸç†" class="headerlink" title="11. Kafka é«˜ååé‡åŸç†"></a><strong>11. Kafka é«˜ååé‡åŸç†</strong></h2><ul><li>é¡ºåºå†™ç£ç›˜ï¼Œé¿å…éšæœº IO</li><li>æ‰¹é‡å‘é€æ¶ˆæ¯ï¼Œå‡å°‘ç½‘ç»œå¼€é”€</li><li>é›¶æ‹·è´æœºåˆ¶ï¼Œå‡å°‘ CPU æ¶ˆè€—</li><li><strong>é¢è¯•æ‹“å±•</strong>ï¼šå¦‚ä½•è°ƒæ•´æ‰¹é‡å¤§å°æé«˜ååé‡</li></ul><hr><h2 id="12-Kafka-é›¶æ‹·è´æœºåˆ¶"><a href="#12-Kafka-é›¶æ‹·è´æœºåˆ¶" class="headerlink" title="12. Kafka é›¶æ‹·è´æœºåˆ¶"></a><strong>12. Kafka é›¶æ‹·è´æœºåˆ¶</strong></h2><ul><li>ç›´æ¥ä»ç£ç›˜ buffer ä¼ åˆ°ç½‘ç»œ bufferï¼Œæ— ç”¨æˆ·æ€å¤åˆ¶</li><li>åˆ©ç”¨ sendfile() æå‡å¤§æµé‡ä¼ è¾“æ•ˆç‡</li></ul><hr><h2 id="13-RocketMQ-æ ¸å¿ƒç‰¹ç‚¹"><a href="#13-RocketMQ-æ ¸å¿ƒç‰¹ç‚¹" class="headerlink" title="13. RocketMQ æ ¸å¿ƒç‰¹ç‚¹"></a><strong>13. RocketMQ æ ¸å¿ƒç‰¹ç‚¹</strong></h2><ul><li>é«˜å¯é ï¼Œé«˜æ€§èƒ½</li><li>é¡ºåºæ¶ˆæ¯ã€äº‹åŠ¡æ¶ˆæ¯åŸç”Ÿæ”¯æŒ</li><li>Broker æ— çŠ¶æ€ï¼Œæ˜“æ°´å¹³æ‰©å±•</li><li>æ”¯æŒå¤šè¯­è¨€å®¢æˆ·ç«¯</li><li>æ¶ˆæ¯å­˜å‚¨ï¼šCommitLog + ConsumeQueue + IndexFile</li></ul><hr><h2 id="14-RocketMQ-é¡ºåºæ¶ˆæ¯"><a href="#14-RocketMQ-é¡ºåºæ¶ˆæ¯" class="headerlink" title="14. RocketMQ é¡ºåºæ¶ˆæ¯"></a><strong>14. RocketMQ é¡ºåºæ¶ˆæ¯</strong></h2><ul><li>é€šè¿‡ Key å“ˆå¸Œæ˜ å°„åˆ°é˜Ÿåˆ—</li><li>é˜Ÿåˆ—å†…é¡ºåºä¸¥æ ¼ä¿è¯</li><li>åº”ç”¨åœºæ™¯ï¼šè®¢å•æ”¯ä»˜ã€æµæ°´å¤„ç†</li></ul><hr><h2 id="15-RocketMQ-äº‹åŠ¡æ¶ˆæ¯"><a href="#15-RocketMQ-äº‹åŠ¡æ¶ˆæ¯" class="headerlink" title="15. RocketMQ äº‹åŠ¡æ¶ˆæ¯"></a><strong>15. RocketMQ äº‹åŠ¡æ¶ˆæ¯</strong></h2><ul><li><strong>åŠæ¶ˆæ¯æœºåˆ¶</strong>ï¼š<ol><li>å‘é€åŠæ¶ˆæ¯åˆ° Broker</li><li>æ‰§è¡Œæœ¬åœ°äº‹åŠ¡</li><li>æäº¤æˆ–å›æ»šæ¶ˆæ¯</li></ol></li><li>ä¿è¯åˆ†å¸ƒå¼äº‹åŠ¡æœ€ç»ˆä¸€è‡´æ€§</li></ul><hr><h2 id="16-å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±"><a href="#16-å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±" class="headerlink" title="16. å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±"></a><strong>16. å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±</strong></h2><ul><li><strong>ç”Ÿäº§è€…ç«¯</strong>ï¼šç¡®è®¤æœºåˆ¶</li><li><strong>Brokerç«¯</strong>ï¼šæ¶ˆæ¯æŒä¹…åŒ–</li><li><strong>æ¶ˆè´¹è€…ç«¯</strong>ï¼šæ‰‹åŠ¨ ack + å¹‚ç­‰æ¶ˆè´¹</li></ul><hr><h2 id="17-å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸é‡å¤æ¶ˆè´¹"><a href="#17-å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸é‡å¤æ¶ˆè´¹" class="headerlink" title="17. å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸é‡å¤æ¶ˆè´¹"></a><strong>17. å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸é‡å¤æ¶ˆè´¹</strong></h2><ul><li>æ¶ˆæ¯å¹‚ç­‰ï¼šå”¯ä¸€ ID + æ•°æ®åº“å”¯ä¸€çº¦æŸ + Redis å»é‡</li><li>Kafka Exactly Once + äº‹åŠ¡å¤„ç†</li></ul><hr><h2 id="18-å¦‚ä½•ä¿è¯æ¶ˆæ¯æœ‰åº"><a href="#18-å¦‚ä½•ä¿è¯æ¶ˆæ¯æœ‰åº" class="headerlink" title="18. å¦‚ä½•ä¿è¯æ¶ˆæ¯æœ‰åº"></a><strong>18. å¦‚ä½•ä¿è¯æ¶ˆæ¯æœ‰åº</strong></h2><ul><li><strong>Kafka</strong>ï¼šPartition å†…é¡ºåº</li><li><strong>RocketMQ</strong>ï¼šé˜Ÿåˆ—å†…é¡ºåº</li><li><strong>æ³¨æ„</strong>ï¼šå¤š Partition å¹¶è¡Œå¯èƒ½å¯¼è‡´æ•´ä½“æ— åº</li></ul><hr><h2 id="19-æ¶ˆæ¯å †ç§¯è§£å†³åŠæ³•"><a href="#19-æ¶ˆæ¯å †ç§¯è§£å†³åŠæ³•" class="headerlink" title="19. æ¶ˆæ¯å †ç§¯è§£å†³åŠæ³•"></a><strong>19. æ¶ˆæ¯å †ç§¯è§£å†³åŠæ³•</strong></h2><ul><li>å¢åŠ æ¶ˆè´¹è€…æ•°é‡</li><li>æ‰©å±•é˜Ÿåˆ—åˆ†åŒº</li><li>æµé‡å‰Šå³°</li><li>æ¶ˆè´¹ç«¯æ‰¹é‡å¤„ç†ï¼Œæé«˜ååé‡</li></ul><hr><h2 id="20-å¦‚ä½•è®¾è®¡å»¶è¿Ÿé˜Ÿåˆ—"><a href="#20-å¦‚ä½•è®¾è®¡å»¶è¿Ÿé˜Ÿåˆ—" class="headerlink" title="20. å¦‚ä½•è®¾è®¡å»¶è¿Ÿé˜Ÿåˆ—"></a><strong>20. å¦‚ä½•è®¾è®¡å»¶è¿Ÿé˜Ÿåˆ—</strong></h2><ul><li><strong>RabbitMQ</strong>ï¼šTTL + Dead Letter Queue</li><li><strong>Kafka</strong>ï¼šå»¶è¿Ÿæ¶ˆæ¯æ’ä»¶ &#x2F; æ—¶é—´è½®</li><li><strong>Redis</strong>ï¼šSortedSet + è½®è¯¢</li><li><strong>åœºæ™¯</strong>ï¼šè®¢å•è¶…æ—¶ã€çŸ­ä¿¡å»¶è¿Ÿå‘é€</li></ul><hr><h2 id="21-æ­»ä¿¡é˜Ÿåˆ—ä½œç”¨"><a href="#21-æ­»ä¿¡é˜Ÿåˆ—ä½œç”¨" class="headerlink" title="21. æ­»ä¿¡é˜Ÿåˆ—ä½œç”¨"></a><strong>21. æ­»ä¿¡é˜Ÿåˆ—ä½œç”¨</strong></h2><ul><li>æ¶ˆè´¹å¤±è´¥æ¶ˆæ¯æ”¶é›†åˆ°æ­»ä¿¡é˜Ÿåˆ—</li><li>æ”¯æŒé‡è¯•ã€å‘Šè­¦å’Œé—®é¢˜æ’æŸ¥</li><li>æé«˜ç³»ç»Ÿå¯é æ€§</li></ul><hr><h2 id="22-å¹‚ç­‰å®ç°æ–¹å¼"><a href="#22-å¹‚ç­‰å®ç°æ–¹å¼" class="headerlink" title="22. å¹‚ç­‰å®ç°æ–¹å¼"></a><strong>22. å¹‚ç­‰å®ç°æ–¹å¼</strong></h2><ul><li>æ¶ˆæ¯å”¯ä¸€ ID</li><li>æ•°æ®åº“å”¯ä¸€çº¦æŸ</li><li>Redis å»é‡ç¼“å­˜</li><li>æœ¬åœ°äº‹åŠ¡ç»“åˆ MQ ä¿è¯å¹‚ç­‰</li></ul><hr><h2 id="23-æ¶ˆæ¯é˜Ÿåˆ—é™æµæ–¹å¼"><a href="#23-æ¶ˆæ¯é˜Ÿåˆ—é™æµæ–¹å¼" class="headerlink" title="23. æ¶ˆæ¯é˜Ÿåˆ—é™æµæ–¹å¼"></a><strong>23. æ¶ˆæ¯é˜Ÿåˆ—é™æµæ–¹å¼</strong></h2><ul><li>æ¶ˆè´¹è€…é™æµï¼šå¤„ç†é€Ÿç‡é™åˆ¶</li><li>ç”Ÿäº§è€…é™æµï¼šä»¤ç‰Œæ¡¶&#x2F;æ¼æ¡¶</li><li>Broker é˜Ÿåˆ—å®¹é‡é™åˆ¶ + æ‹’ç»ç­–ç•¥</li></ul><hr><h2 id="24-æ¶ˆæ¯é˜Ÿåˆ—ç›‘æ§"><a href="#24-æ¶ˆæ¯é˜Ÿåˆ—ç›‘æ§" class="headerlink" title="24. æ¶ˆæ¯é˜Ÿåˆ—ç›‘æ§"></a><strong>24. æ¶ˆæ¯é˜Ÿåˆ—ç›‘æ§</strong></h2><ul><li>æ¶ˆæ¯å †ç§¯é‡</li><li>æ¶ˆè´¹é€Ÿç‡</li><li>Broker å¥åº·çŠ¶æ€</li><li>å»¶è¿Ÿæ—¶é—´</li><li>å·¥å…·ï¼šPrometheus + Grafanaã€Kafka Managerã€RocketMQ Consoleã€RabbitMQ Management</li></ul><hr><h2 id="25-Kafka-vs-RabbitMQ"><a href="#25-Kafka-vs-RabbitMQ" class="headerlink" title="25. Kafka vs RabbitMQ"></a><strong>25. Kafka vs RabbitMQ</strong></h2><table><thead><tr><th>ç‰¹æ€§</th><th>Kafka</th><th>RabbitMQ</th></tr></thead><tbody><tr><td>æ¨¡å‹</td><td>Pub&#x2F;Sub + Queue</td><td>AMQP</td></tr><tr><td>æ¶ˆæ¯å­˜å‚¨</td><td>æŒä¹…åŒ–æ—¥å¿—</td><td>é˜Ÿåˆ—å­˜å‚¨</td></tr><tr><td>é¡ºåºä¿è¯</td><td>Partition å†…é¡ºåº</td><td>é˜Ÿåˆ—é¡ºåº</td></tr><tr><td>é«˜åå</td><td>é«˜ï¼ˆæ‰¹é‡ + é›¶æ‹·è´ï¼‰</td><td>ä¸­ç­‰</td></tr><tr><td>æ¶ˆè´¹æ¨¡å¼</td><td>Pull &#x2F; Push</td><td>Push</td></tr><tr><td>ä½¿ç”¨åœºæ™¯</td><td>å¤§æ•°æ®æµã€æ—¥å¿—ã€äº‹ä»¶é©±åŠ¨</td><td>ä»»åŠ¡é˜Ÿåˆ—ã€å¼‚æ­¥å¤„ç†ã€å¯é æŠ•é€’</td></tr></tbody></table><hr><h2 id="26-Kafka-vs-RocketMQ"><a href="#26-Kafka-vs-RocketMQ" class="headerlink" title="26. Kafka vs RocketMQ"></a><strong>26. Kafka vs RocketMQ</strong></h2><table><thead><tr><th>ç‰¹æ€§</th><th>Kafka</th><th>RocketMQ</th></tr></thead><tbody><tr><td>é¡ºåºæ¶ˆæ¯</td><td>Partition å†…é¡ºåº</td><td>é˜Ÿåˆ—å†…é¡ºåºå…¨å±€å¯æ§</td></tr><tr><td>äº‹åŠ¡æ¶ˆæ¯</td><td>é™åˆ¶è¾ƒå¤š</td><td>åŸç”Ÿæ”¯æŒ</td></tr><tr><td>å­˜å‚¨æ–¹å¼</td><td>CommitLog</td><td>CommitLog + ConsumeQueue + IndexFile</td></tr><tr><td>é«˜å¯ç”¨</td><td>ISR + å‰¯æœ¬</td><td>Master-Slave + HA</td></tr><tr><td>ç”Ÿæ€</td><td>Flinkã€Spark é›†æˆ</td><td>åˆ†å¸ƒå¼äº‹åŠ¡ã€æ”¯ä»˜ç³»ç»Ÿåº”ç”¨</td></tr></tbody></table><hr><h2 id="27-Pulsar-ç‰¹ç‚¹"><a href="#27-Pulsar-ç‰¹ç‚¹" class="headerlink" title="27. Pulsar ç‰¹ç‚¹"></a><strong>27. Pulsar ç‰¹ç‚¹</strong></h2><ul><li>å¤šç§Ÿæˆ·æ”¯æŒ</li><li>æŒä¹…åŒ–ä½¿ç”¨ BookKeeper</li><li>Topic å¯åˆ† Partition</li><li>æ”¯æŒäº‹åŠ¡ã€å»¶è¿Ÿæ¶ˆæ¯</li><li>Push&#x2F;Pull æ¶ˆè´¹æ¨¡å¼çµæ´»</li></ul><hr><h2 id="28-æ¶ˆæ¯ä¸­é—´ä»¶å¦‚ä½•ä¿è¯é«˜å¯ç”¨"><a href="#28-æ¶ˆæ¯ä¸­é—´ä»¶å¦‚ä½•ä¿è¯é«˜å¯ç”¨" class="headerlink" title="28. æ¶ˆæ¯ä¸­é—´ä»¶å¦‚ä½•ä¿è¯é«˜å¯ç”¨"></a><strong>28. æ¶ˆæ¯ä¸­é—´ä»¶å¦‚ä½•ä¿è¯é«˜å¯ç”¨</strong></h2><ul><li>å¤šå‰¯æœ¬ + è‡ªåŠ¨åˆ‡æ¢</li><li>Broker é›†ç¾¤</li><li>æ¶ˆæ¯æŒä¹…åŒ–</li><li>å®¢æˆ·ç«¯é‡è¯•</li><li>Zookeeper&#x2F;Controller ç®¡ç†å…ƒæ•°æ®</li></ul><hr><h2 id="29-æ¶ˆæ¯é˜Ÿåˆ—æ°´å¹³æ‰©å±•"><a href="#29-æ¶ˆæ¯é˜Ÿåˆ—æ°´å¹³æ‰©å±•" class="headerlink" title="29. æ¶ˆæ¯é˜Ÿåˆ—æ°´å¹³æ‰©å±•"></a><strong>29. æ¶ˆæ¯é˜Ÿåˆ—æ°´å¹³æ‰©å±•</strong></h2><ul><li>Kafkaï¼šå¢åŠ  Partition &#x2F; Broker</li><li>RabbitMQï¼šé›†ç¾¤ + Shovel&#x2F;Federation</li><li>RocketMQï¼šå¢åŠ  Broker + Topic åˆ†åŒº</li><li><strong>æ³¨æ„</strong>ï¼šåˆ†åŒºæ‰©å±•å¯èƒ½å½±å“é¡ºåºï¼Œéœ€è¦ Key è·¯ç”±</li></ul><hr><h2 id="30-æ¶ˆæ¯é˜Ÿåˆ—-vs-äº‹ä»¶æ€»çº¿"><a href="#30-æ¶ˆæ¯é˜Ÿåˆ—-vs-äº‹ä»¶æ€»çº¿" class="headerlink" title="30. æ¶ˆæ¯é˜Ÿåˆ— vs äº‹ä»¶æ€»çº¿"></a><strong>30. æ¶ˆæ¯é˜Ÿåˆ— vs äº‹ä»¶æ€»çº¿</strong></h2><ul><li>MQï¼šå…³æ³¨æ¶ˆæ¯å¯é æ€§ã€é¡ºåºã€ç¡®è®¤</li><li>EventBusï¼šå…³æ³¨è§£è€¦ã€å¹¿æ’­ã€è½»é‡çº§</li><li>MQ åå‘å¯é æŒä¹…åŒ–ï¼ŒEventBus åå‘ç³»ç»Ÿå†…éƒ¨äº‹ä»¶è§¦å‘</li></ul><hr><h2 id="ä¹ã€DevOps-å®¹å™¨åŒ–ï¼ˆ30é¢˜ï¼‰"><a href="#ä¹ã€DevOps-å®¹å™¨åŒ–ï¼ˆ30é¢˜ï¼‰" class="headerlink" title="ä¹ã€DevOps &amp; å®¹å™¨åŒ–ï¼ˆ30é¢˜ï¼‰"></a>ä¹ã€DevOps &amp; å®¹å™¨åŒ–ï¼ˆ30é¢˜ï¼‰</h2><hr><h2 id="1-CI-CD-çš„æµç¨‹"><a href="#1-CI-CD-çš„æµç¨‹" class="headerlink" title="1. CI&#x2F;CD çš„æµç¨‹"></a><strong>1. CI&#x2F;CD çš„æµç¨‹</strong></h2><ul><li><strong>CIï¼ˆContinuous Integrationï¼ŒæŒç»­é›†æˆï¼‰</strong>ï¼š<ul><li>å¼€å‘è€…æäº¤ä»£ç  â†’ è‡ªåŠ¨æ„å»º â†’ è‡ªåŠ¨å•å…ƒæµ‹è¯• â†’ è‡ªåŠ¨ç”Ÿæˆæ„å»ºäº§ç‰©</li></ul></li><li><strong>CDï¼ˆContinuous Delivery&#x2F;Deploymentï¼ŒæŒç»­äº¤ä»˜&#x2F;éƒ¨ç½²ï¼‰</strong>ï¼š<ul><li>è‡ªåŠ¨éƒ¨ç½²åˆ°æµ‹è¯•&#x2F;ç”Ÿäº§ç¯å¢ƒ â†’ è‡ªåŠ¨åŒ–éªŒè¯ â†’ ç”Ÿäº§å‘å¸ƒ</li></ul></li><li><strong>å·¥å…·é“¾</strong>ï¼š<ul><li>Jenkinsã€GitLab CIã€Argo CD</li></ul></li><li><strong>å®è·µè¦ç‚¹</strong>ï¼š<ul><li>æµç¨‹è‡ªåŠ¨åŒ–</li><li>ä¿è¯æ„å»ºäº§ç‰©å¯å›æ»š</li></ul></li><li><strong>é¢è¯•æ‹“å±•</strong>ï¼šCI&#x2F;CD ä¸ DevOps çš„å…³ç³»</li></ul><hr><h2 id="2-Jenkins-çš„ä½œç”¨"><a href="#2-Jenkins-çš„ä½œç”¨" class="headerlink" title="2. Jenkins çš„ä½œç”¨"></a><strong>2. Jenkins çš„ä½œç”¨</strong></h2><ul><li>è‡ªåŠ¨åŒ–æ„å»ºã€æµ‹è¯•ã€éƒ¨ç½²å·¥å…·</li><li><strong>æ ¸å¿ƒåŠŸèƒ½</strong>ï¼š<ul><li>æ”¯æŒå¤šç§ SCMï¼ˆGitã€SVNï¼‰</li><li>Pipeline ç®¡ç†</li><li>æ’ä»¶ç”Ÿæ€ä¸°å¯Œï¼ˆDockerã€K8s é›†æˆï¼‰</li></ul></li><li><strong>é¢è¯•è¿½é—®</strong>ï¼šPipeline å¦‚ä½•ä¿è¯æ„å»ºå¯é‡å¤ã€å¯å›æ»š</li></ul><hr><h2 id="3-Docker-æ ¸å¿ƒåŸç†"><a href="#3-Docker-æ ¸å¿ƒåŸç†" class="headerlink" title="3. Docker æ ¸å¿ƒåŸç†"></a><strong>3. Docker æ ¸å¿ƒåŸç†</strong></h2><ul><li><strong>å®¹å™¨åŒ–æŠ€æœ¯</strong>ï¼š<ul><li>Linux <strong>namespace</strong> éš”ç¦»ï¼ˆè¿›ç¨‹ã€ç½‘ç»œã€æ–‡ä»¶ç³»ç»Ÿï¼‰</li><li>Linux <strong>cgroups</strong> é™åˆ¶èµ„æºï¼ˆCPUã€å†…å­˜ï¼‰</li><li>**è”åˆæ–‡ä»¶ç³»ç»Ÿï¼ˆUnionFSï¼‰**å®ç°é•œåƒåˆ†å±‚</li></ul></li><li><strong>å®¹å™¨ â‰ˆ è½»é‡çº§è™šæ‹Ÿæœº</strong>ï¼Œå…±äº«å®¿ä¸» OS å†…æ ¸</li></ul><hr><h2 id="4-Docker-é•œåƒ-vs-å®¹å™¨"><a href="#4-Docker-é•œåƒ-vs-å®¹å™¨" class="headerlink" title="4. Docker é•œåƒ vs å®¹å™¨"></a><strong>4. Docker é•œåƒ vs å®¹å™¨</strong></h2><table><thead><tr><th>åŒºåˆ«</th><th>é•œåƒ</th><th>å®¹å™¨</th></tr></thead><tbody><tr><td>å®šä¹‰</td><td>åªè¯»æ¨¡æ¿</td><td>é•œåƒè¿è¡Œå®ä¾‹</td></tr><tr><td>å­˜å‚¨</td><td>åˆ†å±‚åªè¯»æ–‡ä»¶ç³»ç»Ÿ</td><td>è¯»å†™å±‚ + é•œåƒ</td></tr><tr><td>ç”Ÿå‘½å‘¨æœŸ</td><td>æ°¸ä¹…</td><td>ä¸´æ—¶ï¼Œå¯åœæ­¢&#x2F;åˆ é™¤</td></tr><tr><td>ç”¨é€”</td><td>æ„å»ºåº”ç”¨</td><td>è¿è¡Œåº”ç”¨</td></tr></tbody></table><hr><h2 id="5-Dockerfile-å¸¸ç”¨æŒ‡ä»¤"><a href="#5-Dockerfile-å¸¸ç”¨æŒ‡ä»¤" class="headerlink" title="5. Dockerfile å¸¸ç”¨æŒ‡ä»¤"></a><strong>5. Dockerfile å¸¸ç”¨æŒ‡ä»¤</strong></h2><ul><li><code>FROM</code>ï¼šåŸºç¡€é•œåƒ</li><li><code>RUN</code>ï¼šæ‰§è¡Œå‘½ä»¤æ„å»ºé•œåƒ</li><li><code>COPY</code>&#x2F;<code>ADD</code>ï¼šå¤åˆ¶æ–‡ä»¶åˆ°é•œåƒ</li><li><code>CMD</code>&#x2F;<code>ENTRYPOINT</code>ï¼šå®¹å™¨å¯åŠ¨å‘½ä»¤</li><li><code>EXPOSE</code>ï¼šå£°æ˜ç«¯å£</li><li><code>ENV</code>ï¼šç¯å¢ƒå˜é‡</li><li><strong>ä¼˜åŒ–</strong>ï¼šå‡å°‘é•œåƒå±‚ï¼Œé¡ºåºåˆç†ç¼“å­˜</li></ul><hr><h2 id="6-é•œåƒåˆ†å±‚æœºåˆ¶"><a href="#6-é•œåƒåˆ†å±‚æœºåˆ¶" class="headerlink" title="6. é•œåƒåˆ†å±‚æœºåˆ¶"></a><strong>6. é•œåƒåˆ†å±‚æœºåˆ¶</strong></h2><ul><li>é•œåƒæ¯æ¡æŒ‡ä»¤ç”Ÿæˆä¸€ä¸ªåªè¯»å±‚</li><li>è”åˆæ–‡ä»¶ç³»ç»Ÿï¼ˆUnionFSï¼‰å åŠ è¿™äº›å±‚</li><li>å®¹å™¨å¯åŠ¨æ—¶å¢åŠ è¯»å†™å±‚</li><li><strong>ä¼˜åŠ¿</strong>ï¼š<ul><li>å…±äº«å…¬å…±å±‚ï¼ŒèŠ‚çœç©ºé—´</li><li>æ”¯æŒå¢é‡æ„å»º</li></ul></li></ul><hr><h2 id="7-å®¹å™¨-vs-è™šæ‹Ÿæœº"><a href="#7-å®¹å™¨-vs-è™šæ‹Ÿæœº" class="headerlink" title="7. å®¹å™¨ vs è™šæ‹Ÿæœº"></a><strong>7. å®¹å™¨ vs è™šæ‹Ÿæœº</strong></h2><table><thead><tr><th>åŒºåˆ«</th><th>å®¹å™¨</th><th>è™šæ‹Ÿæœº</th></tr></thead><tbody><tr><td>å†…æ ¸</td><td>å…±äº«å®¿ä¸» OS å†…æ ¸</td><td>ç‹¬ç«‹ OS</td></tr><tr><td>å¯åŠ¨é€Ÿåº¦</td><td>ç§’çº§</td><td>åˆ†é’Ÿçº§</td></tr><tr><td>èµ„æºå ç”¨</td><td>è½»é‡</td><td>é‡é‡</td></tr><tr><td>éš”ç¦»</td><td>è¿›ç¨‹çº§</td><td>ç¡¬ä»¶çº§</td></tr></tbody></table><hr><h2 id="8-Kubernetes-æ ¸å¿ƒç»„ä»¶"><a href="#8-Kubernetes-æ ¸å¿ƒç»„ä»¶" class="headerlink" title="8. Kubernetes æ ¸å¿ƒç»„ä»¶"></a><strong>8. Kubernetes æ ¸å¿ƒç»„ä»¶</strong></h2><ul><li><strong>Master</strong>ï¼š<ul><li>API Serverï¼šæ¥æ”¶ç”¨æˆ·è¯·æ±‚</li><li>Schedulerï¼šPod è°ƒåº¦</li><li>Controller Managerï¼šçŠ¶æ€ç®¡ç†</li><li>etcdï¼šåˆ†å¸ƒå¼é…ç½®å­˜å‚¨</li></ul></li><li><strong>Node</strong>ï¼š<ul><li>Kubeletï¼šPod ç”Ÿå‘½å‘¨æœŸç®¡ç†</li><li>Kube-proxyï¼šæœåŠ¡ç½‘ç»œä»£ç†</li><li>Container Runtimeï¼ˆDocker&#x2F;CRI-Oï¼‰</li></ul></li></ul><hr><h2 id="9-Pod-ç”Ÿå‘½å‘¨æœŸ"><a href="#9-Pod-ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="9. Pod ç”Ÿå‘½å‘¨æœŸ"></a><strong>9. Pod ç”Ÿå‘½å‘¨æœŸ</strong></h2><ul><li><strong>Pending</strong> â†’ <strong>Running</strong> â†’ <strong>Succeeded&#x2F;Failed</strong></li><li><strong>çŠ¶æ€ç®¡ç†</strong>ï¼š<ul><li>initContainer â†’ main container â†’ postStop Hook</li></ul></li><li><strong>é¢è¯•ç‚¹</strong>ï¼šPod é‡å¯ç­–ç•¥ï¼ˆAlways&#x2F;OnFailure&#x2F;Neverï¼‰</li></ul><hr><h2 id="10-Deployment-vs-StatefulSet"><a href="#10-Deployment-vs-StatefulSet" class="headerlink" title="10. Deployment vs StatefulSet"></a><strong>10. Deployment vs StatefulSet</strong></h2><table><thead><tr><th>ç‰¹æ€§</th><th>Deployment</th><th>StatefulSet</th></tr></thead><tbody><tr><td>Pod æ ‡è¯†</td><td>æ— å›ºå®šåå­—</td><td>æœ‰å›ºå®šåå­—</td></tr><tr><td>é¡ºåºæ›´æ–°</td><td>å¯å¹¶è¡Œæ›´æ–°</td><td>ä¸¥æ ¼é¡ºåºæ›´æ–°</td></tr><tr><td>æŒä¹…åŒ–å­˜å‚¨</td><td>å…±äº«å·</td><td>ç‹¬ç«‹æŒä¹…å·</td></tr><tr><td>åº”ç”¨åœºæ™¯</td><td>æ— çŠ¶æ€æœåŠ¡</td><td>æ•°æ®åº“ã€Kafka Broker ç­‰çŠ¶æ€æœåŠ¡</td></tr></tbody></table><hr><h2 id="11-K8s-æœåŠ¡å‘ç°æœºåˆ¶"><a href="#11-K8s-æœåŠ¡å‘ç°æœºåˆ¶" class="headerlink" title="11. K8s æœåŠ¡å‘ç°æœºåˆ¶"></a><strong>11. K8s æœåŠ¡å‘ç°æœºåˆ¶</strong></h2><ul><li><strong>ClusterIP</strong>ï¼šé›†ç¾¤å†…éƒ¨è®¿é—®</li><li><strong>NodePort</strong>ï¼šèŠ‚ç‚¹ç«¯å£è®¿é—®</li><li><strong>LoadBalancer</strong>ï¼šå¤–éƒ¨è®¿é—®</li><li><strong>DNS + kube-proxy</strong>ï¼šPod åç§°è§£æ + iptables è½¬å‘</li></ul><hr><h2 id="12-ConfigMap-å’Œ-Secret"><a href="#12-ConfigMap-å’Œ-Secret" class="headerlink" title="12. ConfigMap å’Œ Secret"></a><strong>12. ConfigMap å’Œ Secret</strong></h2><table><thead><tr><th>ç‰¹æ€§</th><th>ConfigMap</th><th>Secret</th></tr></thead><tbody><tr><td>æ•°æ®ç±»å‹</td><td>æ˜æ–‡é…ç½®</td><td>Base64 ç¼–ç æ•æ„Ÿä¿¡æ¯</td></tr><tr><td>ä½¿ç”¨æ–¹å¼</td><td>Env&#x2F;Volume</td><td>Env&#x2F;Volume</td></tr><tr><td>å®‰å…¨æ€§</td><td>ä¸åŠ å¯†</td><td>åŠ å¯†å¯é›†æˆ KMS</td></tr></tbody></table><hr><h2 id="13-Ingress-çš„ä½œç”¨"><a href="#13-Ingress-çš„ä½œç”¨" class="headerlink" title="13. Ingress çš„ä½œç”¨"></a><strong>13. Ingress çš„ä½œç”¨</strong></h2><ul><li>é›†ç¾¤å¤–éƒ¨è®¿é—® Pod çš„å…¥å£</li><li>åŠŸèƒ½ï¼š<ul><li>è·¯ç”±åˆ°ä¸åŒæœåŠ¡</li><li>TLS ç»ˆç«¯</li><li>è´Ÿè½½å‡è¡¡</li></ul></li><li><strong>é¢è¯•ç‚¹</strong>ï¼šIngress Controller vs Service LB</li></ul><hr><h2 id="14-K8s-æ°´å¹³æ‰©ç¼©å®¹æœºåˆ¶"><a href="#14-K8s-æ°´å¹³æ‰©ç¼©å®¹æœºåˆ¶" class="headerlink" title="14. K8s æ°´å¹³æ‰©ç¼©å®¹æœºåˆ¶"></a><strong>14. K8s æ°´å¹³æ‰©ç¼©å®¹æœºåˆ¶</strong></h2><ul><li><strong>HPAï¼ˆHorizontal Pod Autoscalerï¼‰</strong>ï¼šæ ¹æ® CPUã€å†…å­˜æˆ–è‡ªå®šä¹‰æŒ‡æ ‡è°ƒæ•´ Pod æ•°é‡</li><li><strong>VPAï¼ˆVertical Pod Autoscalerï¼‰</strong>ï¼šè‡ªåŠ¨è°ƒæ•´ Pod èµ„æºé…ç½®</li><li><strong>Cluster Autoscaler</strong>ï¼šèŠ‚ç‚¹è‡ªåŠ¨æ‰©ç¼©å®¹</li></ul><hr><h2 id="15-K8s-æ»šåŠ¨æ›´æ–°æœºåˆ¶"><a href="#15-K8s-æ»šåŠ¨æ›´æ–°æœºåˆ¶" class="headerlink" title="15. K8s æ»šåŠ¨æ›´æ–°æœºåˆ¶"></a><strong>15. K8s æ»šåŠ¨æ›´æ–°æœºåˆ¶</strong></h2><ul><li><strong>Deployment</strong> æ»šåŠ¨æ›´æ–°ç­–ç•¥ï¼š<ul><li><code>maxUnavailable</code>ï¼šæœ€å¤§ä¸å¯ç”¨ Pod</li><li><code>maxSurge</code>ï¼šæœ€å¤§æ–°å¢ Pod</li></ul></li><li><strong>ä¿è¯æ— ä¸­æ–­å‡çº§</strong></li></ul><hr><h2 id="16-K8s-ç°åº¦å‘å¸ƒ"><a href="#16-K8s-ç°åº¦å‘å¸ƒ" class="headerlink" title="16. K8s ç°åº¦å‘å¸ƒ"></a><strong>16. K8s ç°åº¦å‘å¸ƒ</strong></h2><ul><li><strong>æ–¹æ³•</strong>ï¼š<ul><li>åˆ†æµæµé‡ï¼ˆIngress&#x2F;Service Meshï¼‰</li><li>å¤šç‰ˆæœ¬ Deployment</li><li>Canary Pod + è·¯ç”±æƒé‡</li></ul></li></ul><hr><h2 id="17-K8s-è°ƒåº¦ç­–ç•¥"><a href="#17-K8s-è°ƒåº¦ç­–ç•¥" class="headerlink" title="17. K8s è°ƒåº¦ç­–ç•¥"></a><strong>17. K8s è°ƒåº¦ç­–ç•¥</strong></h2><ul><li><strong>é»˜è®¤è°ƒåº¦</strong>ï¼šåŸºäºèµ„æºï¼ˆCPU&#x2F;Memoryï¼‰</li><li><strong>äº²å’Œæ€§&#x2F;åäº²å’Œæ€§</strong>ï¼š<ul><li>NodeAffinity</li><li>PodAffinity &#x2F; PodAntiAffinity</li></ul></li><li><strong>Taints &amp; Tolerations</strong>ï¼šèŠ‚ç‚¹æ±¡ç‚¹æ§åˆ¶ Pod è°ƒåº¦</li></ul><hr><h2 id="18-K8s-ç½‘ç»œæ¨¡å‹"><a href="#18-K8s-ç½‘ç»œæ¨¡å‹" class="headerlink" title="18. K8s ç½‘ç»œæ¨¡å‹"></a><strong>18. K8s ç½‘ç»œæ¨¡å‹</strong></h2><ul><li><strong>è¦æ±‚</strong>ï¼š<ul><li>Pod å¯ä»¥ç›´æ¥äº’ç›¸é€šä¿¡</li><li>Pod ä¸ Node é€šä¿¡</li></ul></li><li><strong>æ–¹æ¡ˆ</strong>ï¼š<ul><li>Flannelã€Calicoã€Cilium ç­‰</li></ul></li><li><strong>é¢è¯•ç‚¹</strong>ï¼šOverlay ç½‘ç»œ vs Underlay ç½‘ç»œ</li></ul><hr><h2 id="19-Service-Mesh-ä½œç”¨"><a href="#19-Service-Mesh-ä½œç”¨" class="headerlink" title="19. Service Mesh ä½œç”¨"></a><strong>19. Service Mesh ä½œç”¨</strong></h2><ul><li>é€æ˜é€šä¿¡ç®¡ç†</li><li>æµé‡æ§åˆ¶ã€ç†”æ–­ã€é™æµ</li><li>å¯è§‚å¯Ÿæ€§ï¼ˆTracingã€Metricsï¼‰</li><li>å®‰å…¨ï¼ˆmTLSï¼‰</li></ul><hr><h2 id="20-Istio-å·¥ä½œåŸç†"><a href="#20-Istio-å·¥ä½œåŸç†" class="headerlink" title="20. Istio å·¥ä½œåŸç†"></a><strong>20. Istio å·¥ä½œåŸç†</strong></h2><ul><li><strong>Sidecar Proxy</strong>ï¼šæ¯ä¸ª Pod æ³¨å…¥ Envoy</li><li><strong>æ§åˆ¶å¹³é¢ï¼ˆPilotï¼‰</strong>ï¼šä¸‹å‘è·¯ç”±è§„åˆ™</li><li><strong>Mixer &#x2F; Telemetry</strong>ï¼šé‡‡é›†æŒ‡æ ‡å’Œæ—¥å¿—</li><li><strong>åº”ç”¨</strong>ï¼š<ul><li>ç°åº¦å‘å¸ƒã€æµé‡é•œåƒã€æ•…éšœæ³¨å…¥ã€æœåŠ¡é—´å®‰å…¨é€šä¿¡</li></ul></li></ul><hr><h2 id="21-Helm-çš„ä½œç”¨"><a href="#21-Helm-çš„ä½œç”¨" class="headerlink" title="21. Helm çš„ä½œç”¨"></a><strong>21. Helm çš„ä½œç”¨</strong></h2><ul><li>Kubernetes åŒ…ç®¡ç†å·¥å…·</li><li><strong>åŠŸèƒ½</strong>ï¼š<ul><li>Chart æ¨¡æ¿åŒ–éƒ¨ç½²</li><li>ç‰ˆæœ¬ç®¡ç†</li><li>ä¸€é”®å‡çº§&#x2F;å›æ»š</li></ul></li><li><strong>é¢è¯•æ‹“å±•</strong>ï¼šHelm ä¸ Kustomize åŒºåˆ«</li></ul><hr><h2 id="22-K8s-å­˜å‚¨æ–¹æ¡ˆ"><a href="#22-K8s-å­˜å‚¨æ–¹æ¡ˆ" class="headerlink" title="22. K8s å­˜å‚¨æ–¹æ¡ˆ"></a><strong>22. K8s å­˜å‚¨æ–¹æ¡ˆ</strong></h2><ul><li><strong>ä¸´æ—¶å­˜å‚¨</strong>ï¼šemptyDir</li><li><strong>æŒä¹…å·</strong>ï¼šPersistentVolume + PersistentVolumeClaim</li><li><strong>å­˜å‚¨ç±»å‹</strong>ï¼š<ul><li>æœ¬åœ°å­˜å‚¨</li><li>NFS</li><li>Ceph &#x2F; GlusterFS</li><li>äº‘å­˜å‚¨ï¼ˆEBSã€OSSï¼‰</li></ul></li></ul><hr><h2 id="23-Prometheus-ç›‘æ§ä½“ç³»"><a href="#23-Prometheus-ç›‘æ§ä½“ç³»" class="headerlink" title="23. Prometheus ç›‘æ§ä½“ç³»"></a><strong>23. Prometheus ç›‘æ§ä½“ç³»</strong></h2><ul><li>Pull æ¨¡å‹é‡‡é›†æŒ‡æ ‡</li><li>TSDB å­˜å‚¨æ—¶é—´åºåˆ—æ•°æ®</li><li>AlertManager å‘Šè­¦</li><li>å¯ç›‘æ§ K8s ç»„ä»¶ã€Podã€åº”ç”¨æŒ‡æ ‡</li></ul><hr><h2 id="24-Grafana-çš„ä½œç”¨"><a href="#24-Grafana-çš„ä½œç”¨" class="headerlink" title="24. Grafana çš„ä½œç”¨"></a><strong>24. Grafana çš„ä½œç”¨</strong></h2><ul><li>å¯è§†åŒ– Prometheus æ•°æ®</li><li>ä»ªè¡¨ç›˜å®šåˆ¶</li><li>æ”¯æŒå¤šæ•°æ®æºï¼ˆInfluxDBã€ElasticSearchï¼‰</li><li>é¢è¯•ç‚¹ï¼šæŠ¥è­¦å¯è§†åŒ–å’Œå¤šç§Ÿæˆ·æ”¯æŒ</li></ul><hr><h2 id="25-K8s-å®‰å…¨æœºåˆ¶"><a href="#25-K8s-å®‰å…¨æœºåˆ¶" class="headerlink" title="25. K8s å®‰å…¨æœºåˆ¶"></a><strong>25. K8s å®‰å…¨æœºåˆ¶</strong></h2><ul><li><strong>è®¤è¯ï¼ˆAuthenticationï¼‰</strong>ï¼šToken &#x2F; X.509 &#x2F; OIDC</li><li><strong>æˆæƒï¼ˆAuthorizationï¼‰</strong>ï¼šRBAC</li><li><strong>ç½‘ç»œç­–ç•¥ï¼ˆNetworkPolicyï¼‰</strong></li><li><strong>Secret åŠ å¯†</strong></li></ul><hr><h2 id="26-å®¹å™¨èµ„æºé™åˆ¶"><a href="#26-å®¹å™¨èµ„æºé™åˆ¶" class="headerlink" title="26. å®¹å™¨èµ„æºé™åˆ¶"></a><strong>26. å®¹å™¨èµ„æºé™åˆ¶</strong></h2><ul><li><strong>CPU &#x2F; Memory</strong>ï¼šrequests &#x2F; limits</li><li><strong>QoS åˆ†ç±»</strong>ï¼š<ul><li>Guaranteedã€Burstableã€BestEffort</li></ul></li><li><strong>é¢è¯•ç‚¹</strong>ï¼šå®¹å™¨ OOM åŠé™æµç­–ç•¥</li></ul><hr><h2 id="27-Docker-Compose-ä½œç”¨"><a href="#27-Docker-Compose-ä½œç”¨" class="headerlink" title="27. Docker Compose ä½œç”¨"></a><strong>27. Docker Compose ä½œç”¨</strong></h2><ul><li>å¤šå®¹å™¨åº”ç”¨ç®¡ç†</li><li>æœ¬åœ°å¼€å‘ã€æµ‹è¯•</li><li>å£°æ˜å¼é…ç½®ç½‘ç»œã€ä¾èµ–å…³ç³»</li></ul><hr><h2 id="28-DevOps-æœ€ä½³å®è·µ"><a href="#28-DevOps-æœ€ä½³å®è·µ" class="headerlink" title="28. DevOps æœ€ä½³å®è·µ"></a><strong>28. DevOps æœ€ä½³å®è·µ</strong></h2><ul><li>æŒç»­é›†æˆ&#x2F;æŒç»­äº¤ä»˜</li><li>åŸºç¡€è®¾æ–½å³ä»£ç ï¼ˆIaCï¼‰</li><li>è‡ªåŠ¨åŒ–æµ‹è¯•ä¸éƒ¨ç½²</li><li>å¾®æœåŠ¡ + å®¹å™¨åŒ– + äº‘åŸç”Ÿ</li></ul><hr><h2 id="29-GitOps-ç†å¿µ"><a href="#29-GitOps-ç†å¿µ" class="headerlink" title="29. GitOps ç†å¿µ"></a><strong>29. GitOps ç†å¿µ</strong></h2><ul><li>å°† Git ä½œä¸ºå•ä¸€çœŸæº</li><li>K8s è‡ªåŠ¨åŒæ­¥ Git çŠ¶æ€</li><li>ä¼˜ç‚¹ï¼š<ul><li>å¯è¿½è¸ªã€å¯å›æ»š</li><li>æµç¨‹ç»Ÿä¸€ã€å¯å®¡è®¡</li></ul></li></ul><hr><h2 id="30-K8s-å¦‚ä½•ä¿è¯é«˜å¯ç”¨"><a href="#30-K8s-å¦‚ä½•ä¿è¯é«˜å¯ç”¨" class="headerlink" title="30. K8s å¦‚ä½•ä¿è¯é«˜å¯ç”¨"></a><strong>30. K8s å¦‚ä½•ä¿è¯é«˜å¯ç”¨</strong></h2><ul><li>Master èŠ‚ç‚¹å¤šå‰¯æœ¬ï¼ˆHAï¼‰</li><li>ETCD é›†ç¾¤å­˜å‚¨</li><li>Pod å¤šå‰¯æœ¬ + Deployment&#x2F;StatefulSet</li><li>Service + LoadBalancer æä¾›ç¨³å®šè®¿é—®</li><li>Cluster Autoscaler æ”¯æŒèŠ‚ç‚¹å¼¹æ€§æ‰©å±•</li></ul><hr><h2 id="åã€åœºæ™¯è®¾è®¡é¢˜ï¼ˆ30é¢˜ï¼‰"><a href="#åã€åœºæ™¯è®¾è®¡é¢˜ï¼ˆ30é¢˜ï¼‰" class="headerlink" title="åã€åœºæ™¯è®¾è®¡é¢˜ï¼ˆ30é¢˜ï¼‰"></a>åã€åœºæ™¯è®¾è®¡é¢˜ï¼ˆ30é¢˜ï¼‰</h2><ol><li>å¦‚ä½•è®¾è®¡ä¸€ä¸ªç§’æ€ç³»ç»Ÿï¼Ÿ</li><li>å¦‚ä½•è®¾è®¡ä¸€ä¸ªçŸ­é“¾ç³»ç»Ÿï¼Ÿ</li><li>å¦‚ä½•è®¾è®¡ä¸€ä¸ªåˆ†å¸ƒå¼ ID ç”Ÿæˆç³»ç»Ÿï¼Ÿ</li><li>å¦‚ä½•è®¾è®¡ä¸€ä¸ªé«˜å¯ç”¨ç¼“å­˜ç³»ç»Ÿï¼Ÿ</li><li>å¦‚ä½•è®¾è®¡ä¸€ä¸ªè®¢å•ç³»ç»Ÿï¼Ÿ</li><li>å¦‚ä½•è®¾è®¡ä¸€ä¸ªæ”¯ä»˜ç³»ç»Ÿï¼Ÿ</li><li>å¦‚ä½•è®¾è®¡ä¸€ä¸ªæ¶ˆæ¯æ¨é€ç³»ç»Ÿï¼Ÿ</li><li>å¦‚ä½•è®¾è®¡ä¸€ä¸ªæ—¥å¿—æ”¶é›†ç³»ç»Ÿï¼Ÿ</li><li>å¦‚ä½•è®¾è®¡ä¸€ä¸ªæœç´¢å¼•æ“ï¼Ÿ</li><li>å¦‚ä½•è®¾è®¡ä¸€ä¸ªæ¨èç³»ç»Ÿï¼Ÿ</li><li>å¦‚ä½•è®¾è®¡ä¸€ä¸ªåˆ†å¸ƒå¼é”ï¼Ÿ</li><li>å¦‚ä½•è®¾è®¡ä¸€ä¸ªç»Ÿä¸€é‰´æƒç³»ç»Ÿï¼Ÿ</li><li>å¦‚ä½•è®¾è®¡ä¸€ä¸ªé™æµç³»ç»Ÿï¼Ÿ</li><li>å¦‚ä½•è®¾è®¡ä¸€ä¸ªç°åº¦å‘å¸ƒç³»ç»Ÿï¼Ÿ</li><li>å¦‚ä½•è®¾è®¡ä¸€ä¸ªç”µå•†è´­ç‰©è½¦ï¼Ÿ</li><li>å¦‚ä½•è®¾è®¡ä¸€ä¸ªåº“å­˜ç³»ç»Ÿï¼Ÿ</li><li>å¦‚ä½•è®¾è®¡ä¸€ä¸ªåˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨ç³»ç»Ÿï¼Ÿ</li><li>å¦‚ä½•è®¾è®¡ä¸€ä¸ªå¾®æœåŠ¡ç½‘å…³ï¼Ÿ</li><li>å¦‚ä½•è®¾è®¡ä¸€ä¸ªåˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿï¼Ÿ</li><li>å¦‚ä½•è®¾è®¡ä¸€ä¸ªç›‘æ§æŠ¥è­¦ç³»ç»Ÿï¼Ÿ</li><li>å¦‚ä½•è®¾è®¡ä¸€ä¸ªé«˜å¹¶å‘èŠå¤©å®¤ï¼Ÿ</li><li>å¦‚ä½•è®¾è®¡ä¸€ä¸ªæ’è¡Œæ¦œç³»ç»Ÿï¼Ÿ</li><li>å¦‚ä½•è®¾è®¡ä¸€ä¸ªè¯„è®ºç³»ç»Ÿï¼Ÿ</li><li>å¦‚ä½•è®¾è®¡ä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡ç³»ç»Ÿï¼Ÿ</li><li>å¦‚ä½•è®¾è®¡ä¸€ä¸ªé«˜å¯ç”¨æ³¨å†Œä¸­å¿ƒï¼Ÿ</li><li>å¦‚ä½•è®¾è®¡ä¸€ä¸ªæ•°æ®åŒæ­¥ç³»ç»Ÿï¼Ÿ</li><li>å¦‚ä½•è®¾è®¡ä¸€ä¸ª API é™é€Ÿç³»ç»Ÿï¼Ÿ</li><li>å¦‚ä½•è®¾è®¡ä¸€ä¸ªé«˜å¯ç”¨çš„æ”¯ä»˜ç½‘å…³ï¼Ÿ</li><li>å¦‚ä½•è®¾è®¡ä¸€ä¸ªè·¨å¢ƒç”µå•†æ¶æ„ï¼Ÿ</li><li>å¦‚ä½•è®¾è®¡ä¸€ä¸ªé‡‘èçº§åˆ«çš„å¾®æœåŠ¡ç³»ç»Ÿï¼Ÿ</li></ol><hr>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> é¢è¯• </tag>
            
            <tag> é¢˜ç›® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é‡è¦çŸ¥è¯†ç‚¹</title>
      <link href="/2025/09/11/java%E7%9F%A5%E8%AF%86%E7%82%B9/"/>
      <url>/2025/09/11/java%E7%9F%A5%E8%AF%86%E7%82%B9/</url>
      
        <content type="html"><![CDATA[<hr><h1 id="ä¸€ã€ç½‘ç»œåŸºç¡€æ¦‚å¿µ"><a href="#ä¸€ã€ç½‘ç»œåŸºç¡€æ¦‚å¿µ" class="headerlink" title="ä¸€ã€ç½‘ç»œåŸºç¡€æ¦‚å¿µ"></a>ä¸€ã€ç½‘ç»œåŸºç¡€æ¦‚å¿µ</h1><ol><li><strong>ç½‘ç»œçš„å®šä¹‰</strong><br> ç½‘ç»œæ˜¯å¤šä¸ªè®¡ç®—æœºåŠé€šä¿¡è®¾å¤‡é€šè¿‡é€šä¿¡ä»‹è´¨äº’è”çš„ç³»ç»Ÿï¼Œç”¨äºä¿¡æ¯ä¼ è¾“ã€èµ„æºå…±äº«ã€ååŒå·¥ä½œã€‚<ul><li>æ ¸å¿ƒç›®æ ‡ï¼šå¯é ã€é«˜æ•ˆã€å¯æ‰©å±•çš„æ•°æ®ä¼ è¾“ã€‚</li><li>è®¾è®¡åŸåˆ™ï¼šåˆ†å±‚ã€æ¨¡å—åŒ–ã€æ¥å£æ ‡å‡†åŒ–ã€‚</li></ul></li><li><strong>æ•°æ®ä¼ è¾“æ–¹å¼</strong><ul><li><strong>å•å·¥</strong>ï¼šå•å‘ä¼ è¾“ï¼ˆç”µè§†å¹¿æ’­ï¼‰ã€‚</li><li><strong>åŠåŒå·¥</strong>ï¼šåŒå‘ä¼ è¾“ï¼Œä½†ä¸èƒ½åŒæ—¶å‘é€ï¼ˆå¯¹è®²æœºï¼‰ã€‚</li><li><strong>å…¨åŒå·¥</strong>ï¼šåŒå‘åŒæ—¶ä¼ è¾“ï¼ˆç”µè¯ã€ä»¥å¤ªç½‘äº¤æ¢æœºç«¯å£ï¼‰ã€‚</li></ul></li><li><strong>é€šä¿¡æ–¹å¼</strong><ul><li><strong>ç‚¹å¯¹ç‚¹</strong>ï¼šä¸¤ä¸ªèŠ‚ç‚¹ç›´æ¥é€šä¿¡ï¼ˆPPPï¼‰ã€‚</li><li><strong>å¹¿æ’­</strong>ï¼šå•ç‚¹å‘é€ï¼Œå¤šç‚¹æ¥æ”¶ï¼ˆEthernetï¼‰ã€‚</li><li><strong>ç»„æ’­</strong>ï¼šå•ç‚¹å‘é€ï¼Œç‰¹å®šç»„æ¥æ”¶ï¼ˆIP å¤šæ’­ï¼‰ã€‚</li></ul></li><li><strong>ç½‘ç»œåˆ†ç±»</strong><ul><li><strong>æŒ‰åœ°ç†èŒƒå›´</strong>ï¼šLANã€MANã€WANã€‚</li><li><strong>æŒ‰æ‹“æ‰‘ç»“æ„</strong>ï¼šæ˜Ÿå‹ã€æ€»çº¿å‹ã€ç¯å‹ã€æ··åˆå‹ã€‚</li><li><strong>æŒ‰è®¿é—®æ§åˆ¶æ–¹å¼</strong>ï¼šCSMA&#x2F;CDï¼ˆEthernetï¼‰ã€ä»¤ç‰Œç¯ï¼ˆToken Ringï¼‰ã€‚</li></ul></li></ol><hr><h1 id="äºŒã€OSI-ä¸ƒå±‚æ¨¡å‹"><a href="#äºŒã€OSI-ä¸ƒå±‚æ¨¡å‹" class="headerlink" title="äºŒã€OSI ä¸ƒå±‚æ¨¡å‹"></a>äºŒã€OSI ä¸ƒå±‚æ¨¡å‹</h1><p>OSI æ¨¡å‹å°†ç½‘ç»œé€šä¿¡åˆ’åˆ†ä¸ºä¸ƒå±‚ï¼Œæ¯å±‚è´Ÿè´£ç‰¹å®šåŠŸèƒ½ï¼Œç¡®ä¿æ¨¡å—åŒ–ä¸äº’æ“ä½œæ€§ã€‚</p><table><thead><tr><th>å±‚</th><th>åŠŸèƒ½</th><th>æ•°æ®å•ä½</th><th>å…¸å‹åè®®&#x2F;è®¾å¤‡</th><th>é¢è¯•æ˜“é—®ç‚¹</th></tr></thead><tbody><tr><td><strong>ç‰©ç†å±‚</strong></td><td>æ¯”ç‰¹æµä¼ è¾“ï¼Œç”µæ°”&#x2F;å…‰å­¦&#x2F;æœºæ¢°æ¥å£</td><td>æ¯”ç‰¹ Bit</td><td>ç½‘çº¿ã€å…‰çº¤ã€é›†çº¿å™¨ã€ç½‘å¡ç‰©ç†éƒ¨åˆ†ã€è°ƒåˆ¶è§£è°ƒå™¨</td><td>ç”µå‹ã€ä¼ è¾“é€Ÿç‡ã€åŒå·¥æ¨¡å¼ã€å…‰çº¤ä¸é“œç¼†åŒºåˆ«</td></tr><tr><td><strong>æ•°æ®é“¾è·¯å±‚</strong></td><td>èŠ‚ç‚¹é—´å¸§ä¼ è¾“ï¼Œå·®é”™æ§åˆ¶ã€æµé‡æ§åˆ¶ã€MAC åœ°å€</td><td>å¸§ Frame</td><td>ä»¥å¤ªç½‘ã€PPPã€äº¤æ¢æœºã€ç½‘æ¡¥</td><td>CSMA&#x2F;CD å·¥ä½œåŸç†ã€MAC åœ°å€æ ¼å¼ã€VLAN</td></tr><tr><td><strong>ç½‘ç»œå±‚</strong></td><td>ä¸»æœºåˆ°ä¸»æœºä¼ è¾“ï¼Œé€»è¾‘å¯»å€ã€è·¯ç”±ã€æ‹¥å¡æ§åˆ¶</td><td>æ•°æ®åŒ… Packet</td><td>IPã€ICMPã€IGMPã€è·¯ç”±å™¨</td><td>è·¯ç”±é€‰æ‹©ç®—æ³•ï¼ˆRIP&#x2F;OSPF&#x2F;BGPï¼‰ã€å­ç½‘æ©ç è®¡ç®—ã€NAT</td></tr><tr><td><strong>ä¼ è¾“å±‚</strong></td><td>ç«¯åˆ°ç«¯é€šä¿¡ï¼Œç«¯å£æ˜ å°„ã€åˆ†æ®µé‡ç»„ã€æµé‡æ§åˆ¶</td><td>æŠ¥æ–‡æ®µ Segment (TCP)ã€æ•°æ®æŠ¥ Datagram (UDP)</td><td>TCPã€UDP</td><td>TCP ä¸‰æ¬¡æ¡æ‰‹ã€å››æ¬¡æŒ¥æ‰‹ã€æ»‘åŠ¨çª—å£ã€ç«¯å£å·åˆ†ç±»</td></tr><tr><td><strong>ä¼šè¯å±‚</strong></td><td>ç®¡ç†åº”ç”¨ä¼šè¯ï¼Œæ•°æ®åŒæ­¥</td><td>ä¼šè¯æ•°æ®</td><td>NetBIOSã€RPCã€NFSã€SQL</td><td>æ–­ç‚¹ç»­ä¼ ã€ä¼šè¯ä¿æŒæœºåˆ¶</td></tr><tr><td><strong>è¡¨ç¤ºå±‚</strong></td><td>æ•°æ®è¡¨ç¤ºã€ç¼–ç ã€åŠ å¯†å‹ç¼©</td><td>è¡¨ç¤ºæ•°æ®</td><td>JPEGã€MPEGã€ASCIIã€Unicodeã€TLS&#x2F;SSL</td><td>å¤§ç«¯&#x2F;å°ç«¯ã€ç¼–ç è½¬æ¢ã€åŠ å¯†&#x2F;è§£å¯†æµç¨‹</td></tr><tr><td><strong>åº”ç”¨å±‚</strong></td><td>æä¾›ç”¨æˆ·æœåŠ¡ï¼Œç›´æ¥ä¸åº”ç”¨äº¤äº’</td><td>åº”ç”¨æ•°æ®</td><td>HTTPã€FTPã€SMTPã€POP3&#x2F;IMAPã€DNSã€Telnetã€SNMP</td><td>HTTP è¯·æ±‚&#x2F;å“åº”æŠ¥æ–‡ç»“æ„ã€DNS æŸ¥è¯¢æµç¨‹ã€FTP ä¸»åŠ¨&#x2F;è¢«åŠ¨æ¨¡å¼</td></tr></tbody></table><h3 id="1-ç‰©ç†å±‚æ·±åº¦"><a href="#1-ç‰©ç†å±‚æ·±åº¦" class="headerlink" title="1. ç‰©ç†å±‚æ·±åº¦"></a>1. ç‰©ç†å±‚æ·±åº¦</h3><ul><li><strong>ç”µæ°”ç‰¹æ€§</strong>ï¼šç”µå‹å¹…å€¼ã€é¢‘ç‡ã€ä¿¡å·è°ƒåˆ¶ã€‚</li><li><strong>ä¼ è¾“ä»‹è´¨å·®å¼‚</strong>ï¼š<ul><li>é“œç¼†ï¼ˆåŒç»çº¿ã€åŒè½´ï¼‰: æˆæœ¬ä½ã€æ˜“å¹²æ‰°ã€‚</li><li>å…‰çº¤: é«˜é€Ÿã€é•¿è·ç¦»ã€æŠ—ç”µç£å¹²æ‰°ã€‚</li></ul></li><li><strong>é¢è¯•å¸¸é—®</strong>ï¼šå…‰çº¤å•æ¨¡å’Œå¤šæ¨¡åŒºåˆ«ã€ç½‘å¡é€Ÿç‡ã€åŠåŒå·¥&#x2F;å…¨åŒå·¥ã€‚</li></ul><h3 id="2-æ•°æ®é“¾è·¯å±‚æ·±åº¦"><a href="#2-æ•°æ®é“¾è·¯å±‚æ·±åº¦" class="headerlink" title="2. æ•°æ®é“¾è·¯å±‚æ·±åº¦"></a>2. æ•°æ®é“¾è·¯å±‚æ·±åº¦</h3><ul><li><strong>MAC åœ°å€</strong>ï¼šå”¯ä¸€æ ‡è¯†ç½‘å¡ï¼Œ48 ä½ï¼ˆå‰ 24 ä½å‚å•†å·ï¼Œå 24 ä½è®¾å¤‡å·ï¼‰ã€‚</li><li><strong>æµé‡æ§åˆ¶</strong>ï¼š<ul><li>åœæ­¢ç­‰å¾…ï¼ˆStop-and-Waitï¼‰</li><li>æ»‘åŠ¨çª—å£ï¼ˆSliding Windowï¼‰</li></ul></li><li><strong>å·®é”™æ§åˆ¶</strong>ï¼šCRC æ ¡éªŒã€å¸§æ ¡éªŒåºåˆ— (FCS)ã€‚</li><li><strong>VLAN</strong>ï¼šé€»è¾‘åˆ†éš”ç½‘ç»œï¼Œå‡å°‘å¹¿æ’­é£æš´ã€‚</li></ul><h3 id="3-ç½‘ç»œå±‚æ·±åº¦"><a href="#3-ç½‘ç»œå±‚æ·±åº¦" class="headerlink" title="3. ç½‘ç»œå±‚æ·±åº¦"></a>3. ç½‘ç»œå±‚æ·±åº¦</h3><ul><li><strong>é€»è¾‘å¯»å€</strong>ï¼šIPv4&#x2F;IPv6</li><li><strong>å­ç½‘åˆ’åˆ†</strong>ï¼šCIDRã€VLSMã€‚</li><li><strong>è·¯ç”±åè®®</strong>ï¼š<ul><li><strong>RIP</strong>ï¼šè·³æ•°æœ€çŸ­ï¼Œæ”¶æ•›æ…¢ã€‚</li><li><strong>OSPF</strong>ï¼šé“¾è·¯çŠ¶æ€ï¼Œå¿«é€Ÿæ”¶æ•›ã€‚</li><li><strong>BGP</strong>ï¼šè‡ªæ²»ç³»ç»Ÿé—´ï¼Œç­–ç•¥è·¯ç”±ã€‚</li></ul></li><li><strong>NAT</strong>ï¼šç§ç½‘ IP è½¬æ¢ä¸ºå…¬ç½‘ IPï¼ŒèŠ‚çº¦ IPã€‚</li></ul><h3 id="4-ä¼ è¾“å±‚æ·±åº¦"><a href="#4-ä¼ è¾“å±‚æ·±åº¦" class="headerlink" title="4. ä¼ è¾“å±‚æ·±åº¦"></a>4. ä¼ è¾“å±‚æ·±åº¦</h3><h4 id="TCP"><a href="#TCP" class="headerlink" title="TCP"></a>TCP</h4><ul><li><strong>å¯é æ€§æœºåˆ¶</strong>ï¼š<ul><li>åºåˆ—å·ä¸ç¡®è®¤å·ã€‚</li><li>æ»‘åŠ¨çª—å£ã€‚</li><li>é‡ä¼ æœºåˆ¶ï¼ˆè¶…æ—¶&#x2F;å¿«é€Ÿé‡ä¼ ï¼‰ã€‚</li></ul></li><li><strong>ä¸‰æ¬¡æ¡æ‰‹ï¼ˆå»ºç«‹è¿æ¥ï¼‰</strong><ul><li><strong>ç¬¬ä¸€æ¬¡ (SYN)</strong>ï¼šå®¢æˆ·ç«¯è¯·æ±‚ï¼Œseq&#x3D;client_ISNã€‚</li><li><strong>ç¬¬äºŒæ¬¡ (SYN-ACK)</strong>ï¼šæœåŠ¡å™¨ç¡®è®¤å®¢æˆ·ç«¯ï¼Œseq&#x3D;server_ISN, ack&#x3D;client_ISN+1ã€‚</li><li><strong>ç¬¬ä¸‰æ¬¡ (ACK)</strong>ï¼šå®¢æˆ·ç«¯ç¡®è®¤æœåŠ¡å™¨ï¼Œack&#x3D;server_ISN+1ã€‚</li></ul></li><li><strong>å››æ¬¡æŒ¥æ‰‹ï¼ˆæ–­å¼€è¿æ¥ï¼‰</strong><ul><li>FIN&#x2F;ACK äº¤æ›¿å…³é—­åŒå‘ã€‚</li><li>TIME_WAIT: 2MSLï¼Œä¿è¯æœ€å ACK åˆ°è¾¾å¹¶é¿å…æ—§æŠ¥æ–‡å¹²æ‰°ã€‚</li></ul></li><li><strong>æµé‡æ§åˆ¶</strong>ï¼šæ»‘åŠ¨çª—å£</li><li><strong>æ‹¥å¡æ§åˆ¶</strong>ï¼šæ…¢å¯åŠ¨ã€æ‹¥å¡é¿å…ã€å¿«é€Ÿé‡ä¼ ã€å¿«é€Ÿæ¢å¤ã€‚</li></ul><h4 id="UDP"><a href="#UDP" class="headerlink" title="UDP"></a>UDP</h4><ul><li><strong>ç‰¹ç‚¹</strong>ï¼šæ— è¿æ¥ã€æ— åºã€ä¸ä¿è¯åˆ°è¾¾ã€‚</li><li><strong>åº”ç”¨</strong>ï¼šDNSã€VoIPã€è§†é¢‘ç›´æ’­ã€‚</li><li><strong>ä¼˜ç‚¹</strong>ï¼šä½å»¶è¿Ÿã€å¼€é”€å°ã€‚</li></ul><h3 id="5-ä¼šè¯å±‚æ·±åº¦"><a href="#5-ä¼šè¯å±‚æ·±åº¦" class="headerlink" title="5. ä¼šè¯å±‚æ·±åº¦"></a>5. ä¼šè¯å±‚æ·±åº¦</h3><ul><li><strong>ä¼šè¯ç®¡ç†</strong>ï¼š<ul><li>ä¼šè¯å»ºç«‹ã€ä¿æŒã€ç»ˆæ­¢ã€‚</li><li>æ•°æ®åŒæ­¥ç‚¹ï¼ˆæ–­ç‚¹ç»­ä¼ ï¼‰ã€‚</li></ul></li><li><strong>é¢è¯•ç‚¹</strong>ï¼šHTTP æ˜¯æ— çŠ¶æ€åè®®ï¼Œå¦‚ä½•å®ç°ä¼šè¯ä¿æŒï¼Ÿï¼ˆCookie&#x2F;Session&#x2F;Tokenï¼‰</li></ul><h3 id="6-è¡¨ç¤ºå±‚æ·±åº¦"><a href="#6-è¡¨ç¤ºå±‚æ·±åº¦" class="headerlink" title="6. è¡¨ç¤ºå±‚æ·±åº¦"></a>6. è¡¨ç¤ºå±‚æ·±åº¦</h3><ul><li><strong>æ•°æ®æ ¼å¼åŒ–</strong>ï¼šASCIIã€Unicodeã€EBCDICã€‚</li><li><strong>å‹ç¼©&#x2F;è§£å‹</strong>ï¼šJPEGã€MPEGã€ZIPã€‚</li><li><strong>åŠ å¯†&#x2F;è§£å¯†</strong>ï¼šTLS&#x2F;SSLï¼Œå®ç°å®‰å…¨é€šä¿¡ã€‚</li><li><strong>é¢è¯•ç‚¹</strong>ï¼šå¤§ç«¯å°ç«¯ï¼ŒBase64 ç¼–ç ã€‚</li></ul><h3 id="7-åº”ç”¨å±‚æ·±åº¦"><a href="#7-åº”ç”¨å±‚æ·±åº¦" class="headerlink" title="7. åº”ç”¨å±‚æ·±åº¦"></a>7. åº”ç”¨å±‚æ·±åº¦</h3><ul><li><strong>HTTP</strong>ï¼š<ul><li>è¯·æ±‚æ–¹æ³•ï¼šGET&#x2F;POST&#x2F;PUT&#x2F;DELETE&#x2F;OPTIONSã€‚</li><li>çŠ¶æ€ç ï¼š1xx-5xxã€‚</li></ul></li><li><strong>DNS</strong>ï¼š<ul><li>æŸ¥è¯¢ç±»å‹ï¼šA&#x2F;AAAA&#x2F;CNAME&#x2F;MXã€‚</li><li>é€’å½’&#x2F;è¿­ä»£æŸ¥è¯¢ã€‚</li></ul></li><li><strong>SMTP&#x2F;POP3&#x2F;IMAP</strong>ï¼š<ul><li>å‘é€ä¸æ¥æ”¶æµç¨‹ã€‚</li></ul></li><li><strong>é¢è¯•ç‚¹</strong>ï¼š<ul><li>FTP ä¸»åŠ¨&#x2F;è¢«åŠ¨æ¨¡å¼å·®å¼‚ã€‚</li><li>HTTPS æ¡æ‰‹æµç¨‹ï¼ˆè¯ä¹¦äº¤æ¢ + å¯¹ç§°å¯†é’¥ï¼‰ã€‚</li></ul></li></ul><hr><h1 id="ä¸‰ã€TCP-IP-åè®®æ—ï¼ˆè¯¦ç»†ç‰ˆï¼‰"><a href="#ä¸‰ã€TCP-IP-åè®®æ—ï¼ˆè¯¦ç»†ç‰ˆï¼‰" class="headerlink" title="ä¸‰ã€TCP&#x2F;IP åè®®æ—ï¼ˆè¯¦ç»†ç‰ˆï¼‰"></a>ä¸‰ã€TCP&#x2F;IP åè®®æ—ï¼ˆè¯¦ç»†ç‰ˆï¼‰</h1><table><thead><tr><th>å±‚</th><th>åŠŸèƒ½</th><th>åè®®</th><th>ç‰¹ç‚¹</th><th>é¢è¯•æ˜“é—®ç‚¹</th></tr></thead><tbody><tr><td>åº”ç”¨å±‚</td><td>ç”¨æˆ·åº”ç”¨æœåŠ¡</td><td>HTTPã€DNSã€FTPã€SMTP</td><td>ä¸ç”¨æˆ·äº¤äº’</td><td>HTTP çŠ¶æ€ç ã€DNS æŸ¥è¯¢è¿‡ç¨‹</td></tr><tr><td>ä¼ è¾“å±‚</td><td>ç«¯åˆ°ç«¯é€šä¿¡</td><td>TCPã€UDP</td><td>TCP å¯é ã€UDP é«˜æ•ˆ</td><td>ä¸‰æ¬¡æ¡æ‰‹ã€å››æ¬¡æŒ¥æ‰‹ã€æµé‡æ§åˆ¶</td></tr><tr><td>ç½‘ç»œå±‚</td><td>ä¸»æœºåˆ°ä¸»æœº</td><td>IPã€ICMPã€ARP</td><td>IP æ— è¿æ¥ã€è·¯ç”±é€‰æ‹©</td><td>å­ç½‘åˆ’åˆ†ã€NATã€ICMP æŠ¥æ–‡</td></tr><tr><td>ç½‘ç»œæ¥å£å±‚</td><td>ç‰©ç†é“¾è·¯ä¼ è¾“</td><td>Ethernetã€PPP</td><td>æ¯”ç‰¹ä¼ è¾“</td><td>MAC åœ°å€ã€å†²çªæ£€æµ‹</td></tr></tbody></table><hr><h3 id="TCP-ä¸‰æ¬¡æ¡æ‰‹æ€»ç»“"><a href="#TCP-ä¸‰æ¬¡æ¡æ‰‹æ€»ç»“" class="headerlink" title="TCP ä¸‰æ¬¡æ¡æ‰‹æ€»ç»“"></a>TCP ä¸‰æ¬¡æ¡æ‰‹æ€»ç»“</h3><ol><li>å®¢æˆ·ç«¯å‘é€ SYNï¼Œå‘ŠçŸ¥åˆå§‹åºåˆ—å·ã€‚</li><li>æœåŠ¡å™¨è¿”å› SYN-ACKï¼Œç¡®è®¤æ”¶åˆ° SYN å¹¶å‘ŠçŸ¥è‡ªèº«åºåˆ—å·ã€‚</li><li>å®¢æˆ·ç«¯ ACK ç¡®è®¤ï¼ŒåŒæ–¹ ESTABLISHEDã€‚</li></ol><h3 id="TCP-å››æ¬¡æŒ¥æ‰‹æ€»ç»“"><a href="#TCP-å››æ¬¡æŒ¥æ‰‹æ€»ç»“" class="headerlink" title="TCP å››æ¬¡æŒ¥æ‰‹æ€»ç»“"></a>TCP å››æ¬¡æŒ¥æ‰‹æ€»ç»“</h3><ol><li>ä¸»åŠ¨æ–¹ FINï¼Œå…³é—­å‘é€ã€‚</li><li>è¢«åŠ¨æ–¹ ACKï¼Œç¡®è®¤ã€‚</li><li>è¢«åŠ¨æ–¹ FINï¼Œå…³é—­å‘é€ã€‚</li><li>ä¸»åŠ¨æ–¹ ACKï¼Œè¿›å…¥ TIME_WAITï¼Œç­‰å¾… 2MSLã€‚</li></ol><hr><h2 id="ä¸€ã€TCP-ä¸-UDP-åŒºåˆ«ï¼ˆæ·±å…¥ç‰ˆï¼‰"><a href="#ä¸€ã€TCP-ä¸-UDP-åŒºåˆ«ï¼ˆæ·±å…¥ç‰ˆï¼‰" class="headerlink" title="ä¸€ã€TCP ä¸ UDP åŒºåˆ«ï¼ˆæ·±å…¥ç‰ˆï¼‰"></a>ä¸€ã€TCP ä¸ UDP åŒºåˆ«ï¼ˆæ·±å…¥ç‰ˆï¼‰</h2><table><thead><tr><th>ç‰¹æ€§</th><th>TCP</th><th>UDP</th></tr></thead><tbody><tr><td><strong>è¿æ¥æ–¹å¼</strong></td><td>é¢å‘è¿æ¥ï¼Œéœ€è¦ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥</td><td>æ— è¿æ¥ï¼Œç›´æ¥å‘é€æ•°æ®æŠ¥</td></tr><tr><td><strong>å¯é æ€§</strong></td><td>å¯é ä¼ è¾“ï¼Œç¡®ä¿æ•°æ®å®Œæ•´ã€æœ‰åºã€ä¸ä¸¢å¤±</td><td>ä¸å¯é ä¼ è¾“ï¼Œä¸èƒ½ä¿è¯é¡ºåºå’Œåˆ°è¾¾</td></tr><tr><td><strong>æ•°æ®å•ä½</strong></td><td>æŠ¥æ–‡æ®µ (Segment)</td><td>æ•°æ®æŠ¥ (Datagram)</td></tr><tr><td><strong>é€Ÿåº¦</strong></td><td>è¾ƒæ…¢ï¼Œéœ€è¦å»ºç«‹è¿æ¥ã€ç¡®è®¤å’Œé‡ä¼ æœºåˆ¶</td><td>å¿«ï¼Œæ— æ¡æ‰‹å’Œé‡ä¼ ï¼Œå¼€é”€å°</td></tr><tr><td><strong>ä¼ è¾“é¡ºåº</strong></td><td>ä¿è¯é¡ºåºï¼Œåºåˆ—å· + ACK ç¡®è®¤</td><td>ä¸ä¿è¯é¡ºåºï¼Œç‹¬ç«‹å‘é€</td></tr><tr><td><strong>æ‹¥å¡æ§åˆ¶</strong></td><td>æœ‰ï¼ŒTCP æ‹¥å¡æ§åˆ¶ç®—æ³•ï¼ˆæ…¢å¯åŠ¨ã€æ‹¥å¡é¿å…ã€å¿«é€Ÿé‡ä¼ ã€å¿«é€Ÿæ¢å¤ï¼‰</td><td>æ— </td></tr><tr><td><strong>åº”ç”¨åœºæ™¯</strong></td><td>æ–‡ä»¶ä¼ è¾“ (FTP)ã€ç½‘é¡µè®¿é—® (HTTP&#x2F;HTTPS)ã€é‚®ä»¶ (SMTP&#x2F;POP3)</td><td>å®æ—¶è§†é¢‘&#x2F;è¯­éŸ³ (VoIPã€ç›´æ’­)ã€DNS æŸ¥è¯¢ã€DHCP</td></tr><tr><td><strong>é¢è¯•æ‹“å±•ç‚¹</strong></td><td>TCP é€‚åˆå¯é æ€§è¦æ±‚é«˜çš„åœºæ™¯</td><td>UDP é€‚åˆä½å»¶è¿Ÿã€å¯å®¹å¿ä¸¢åŒ…çš„åœºæ™¯</td></tr></tbody></table><p><strong>é¢è¯•é—®æ³•ç¤ºä¾‹ï¼š</strong></p><ul><li>â€œTCP ä¸ºä»€ä¹ˆå¯é ï¼ŒUDP ä¸ºä»€ä¹ˆä¸å¯é ï¼Ÿâ€<br> <strong>å›ç­”è¦ç‚¹</strong>ï¼šTCP ä½¿ç”¨åºåˆ—å·ã€ACK ç¡®è®¤ã€é‡ä¼ æœºåˆ¶ã€æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶æ¥ä¿è¯å¯é æ€§ï¼›UDP æ²¡æœ‰è¿™äº›æœºåˆ¶ï¼Œç›´æ¥å‘é€æŠ¥æ–‡ï¼Œé€Ÿåº¦å¿«ï¼Œä½†ä¸ä¿è¯åˆ°è¾¾å’Œé¡ºåºã€‚</li></ul><hr><h2 id="äºŒã€ä¸‰æ¬¡æ¡æ‰‹çš„æ„ä¹‰ï¼ˆæ·±å…¥ç‰ˆï¼‰"><a href="#äºŒã€ä¸‰æ¬¡æ¡æ‰‹çš„æ„ä¹‰ï¼ˆæ·±å…¥ç‰ˆï¼‰" class="headerlink" title="äºŒã€ä¸‰æ¬¡æ¡æ‰‹çš„æ„ä¹‰ï¼ˆæ·±å…¥ç‰ˆï¼‰"></a>äºŒã€ä¸‰æ¬¡æ¡æ‰‹çš„æ„ä¹‰ï¼ˆæ·±å…¥ç‰ˆï¼‰</h2><p><strong>ä¸‰æ¬¡æ¡æ‰‹æ­¥éª¤å¤ä¹ </strong>ï¼š</p><ol><li><strong>å®¢æˆ·ç«¯ â†’ æœåŠ¡å™¨</strong>ï¼šSYN æŠ¥æ–‡ï¼Œè¯·æ±‚å»ºç«‹è¿æ¥ï¼Œå‘é€ client_ISNã€‚</li><li><strong>æœåŠ¡å™¨ â†’ å®¢æˆ·ç«¯</strong>ï¼šSYN-ACK æŠ¥æ–‡ï¼Œç¡®è®¤å®¢æˆ·ç«¯ SYNï¼Œå¹¶å‘é€ server_ISNã€‚</li><li><strong>å®¢æˆ·ç«¯ â†’ æœåŠ¡å™¨</strong>ï¼šACK æŠ¥æ–‡ï¼Œç¡®è®¤ server_ISNï¼Œè¿æ¥å»ºç«‹ã€‚</li></ol><p><strong>ä¸ºä»€ä¹ˆéœ€è¦ä¸‰æ¬¡æ¡æ‰‹ï¼Ÿ</strong></p><ol><li><strong>é˜²æ­¢æ—§è¿æ¥æŠ¥æ–‡è¯¯å»º</strong><ul><li>å¦‚æœåªæœ‰ä¸¤æ¬¡æ¡æ‰‹ï¼Œæ—§çš„ SYN æŠ¥æ–‡å¯èƒ½å»¶è¿Ÿåˆ°è¾¾ï¼ŒæœåŠ¡å™¨è¯¯è®¤ä¸ºæ˜¯æ–°è¿æ¥ã€‚</li><li>ä¸‰æ¬¡æ¡æ‰‹ç¡®ä¿å®¢æˆ·ç«¯ä¸»åŠ¨ç¡®è®¤ï¼ŒæœåŠ¡å™¨ä¸ä¼šå› ä¸ºæ—§æŠ¥æ–‡è¿›å…¥ ESTABLISHEDã€‚</li></ul></li><li><strong>åŒå‘ç¡®è®¤æ”¶å‘èƒ½åŠ›</strong><ul><li>ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼šå®¢æˆ·ç«¯å‘Šè¯‰æœåŠ¡å™¨å®ƒèƒ½å‘ã€‚</li><li>ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼šæœåŠ¡å™¨å‘Šè¯‰å®¢æˆ·ç«¯å®ƒèƒ½å‘ï¼Œä¹Ÿç¡®è®¤å®¢æˆ·ç«¯èƒ½å‘ã€‚</li><li>ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼šå®¢æˆ·ç«¯ç¡®è®¤æœåŠ¡å™¨èƒ½æ”¶ã€‚</li><li><strong>é¢è¯•å¸¸é—®æ‹“å±•</strong>ï¼šä¸ºä»€ä¹ˆç¬¬ä¸€æ¬¡æ¡æ‰‹æœåŠ¡å™¨ä¸ç›´æ¥è¿›å…¥ ESTABLISHEDï¼Ÿ<br> <strong>ç­”æ¡ˆ</strong>ï¼šæœåŠ¡å™¨ä¸èƒ½ç¡®å®šå®¢æˆ·ç«¯å·²ç»å‡†å¤‡å¥½æ¥æ”¶æ•°æ®ï¼Œéœ€ç¬¬ä¸‰æ¬¡æ¡æ‰‹ç¡®è®¤ã€‚</li></ul></li></ol><hr><h2 id="ä¸‰ã€TIME-WAIT-çš„æ„ä¹‰ï¼ˆæ·±å…¥ç‰ˆï¼‰"><a href="#ä¸‰ã€TIME-WAIT-çš„æ„ä¹‰ï¼ˆæ·±å…¥ç‰ˆï¼‰" class="headerlink" title="ä¸‰ã€TIME_WAIT çš„æ„ä¹‰ï¼ˆæ·±å…¥ç‰ˆï¼‰"></a>ä¸‰ã€TIME_WAIT çš„æ„ä¹‰ï¼ˆæ·±å…¥ç‰ˆï¼‰</h2><ul><li><strong>TCP å››æ¬¡æŒ¥æ‰‹åå®¢æˆ·ç«¯è¿›å…¥ TIME_WAIT</strong></li><li><strong>ä½œç”¨</strong>ï¼š<ol><li><strong>ç¡®ä¿æœ€å ACK èƒ½åˆ°è¾¾æœåŠ¡å™¨</strong><ul><li>å¦‚æœ ACK ä¸¢å¤±ï¼ŒæœåŠ¡å™¨ä¼šé‡å‘ FINï¼Œå®¢æˆ·ç«¯åœ¨ TIME_WAIT çŠ¶æ€å¯ä»¥é‡æ–°å“åº”ã€‚</li></ul></li><li><strong>é˜²æ­¢æ—§æŠ¥æ–‡å¹²æ‰°æ–°è¿æ¥</strong><ul><li>2MSLï¼ˆMaximum Segment Lifetimeï¼‰å†…ä¿è¯ç½‘ç»œä¸­æ—§æŠ¥æ–‡è¢«æ¸…é™¤ã€‚</li></ul></li></ol></li><li><strong>å…¸å‹é¢è¯•é—®æ³•</strong>ï¼š<ul><li>â€œä¸ºä»€ä¹ˆå®¢æˆ·ç«¯ä¸»åŠ¨å…³é—­è¿æ¥è¿›å…¥ TIME_WAITï¼Œè€ŒæœåŠ¡å™¨ä¸è¿›å…¥ï¼Ÿâ€<br> <strong>ç­”æ¡ˆ</strong>ï¼šä¸»åŠ¨å…³é—­æ–¹éœ€è¦ç¡®ä¿ ACK èƒ½åˆ°è¾¾è¢«åŠ¨å…³é—­æ–¹å¹¶é˜²æ­¢æ—§æŠ¥æ–‡å¹²æ‰°æ–°è¿æ¥ï¼›è¢«åŠ¨å…³é—­æ–¹åœ¨æ”¶åˆ° ACK åå³å¯å…³é—­ã€‚</li><li>â€œTIME_WAIT ä¸ºä»€ä¹ˆè¦ç­‰å¾… 2MSLï¼Ÿâ€<br> <strong>ç­”æ¡ˆ</strong>ï¼šMSL æ˜¯æŠ¥æ–‡åœ¨ç½‘ç»œä¸­çš„æœ€å¤§ç”Ÿå­˜æ—¶é—´ï¼Œç­‰å¾… 2MSL å¯ä»¥ç¡®ä¿æ‰€æœ‰å¯èƒ½æ»ç•™çš„æŠ¥æ–‡æ¶ˆå¤±ã€‚</li></ul></li></ul><hr><h2 id="å››ã€OSI-ä¸ƒå±‚-vs-TCP-IP-æ¨¡å‹ï¼ˆæ·±å…¥ç‰ˆï¼‰"><a href="#å››ã€OSI-ä¸ƒå±‚-vs-TCP-IP-æ¨¡å‹ï¼ˆæ·±å…¥ç‰ˆï¼‰" class="headerlink" title="å››ã€OSI ä¸ƒå±‚ vs TCP&#x2F;IP æ¨¡å‹ï¼ˆæ·±å…¥ç‰ˆï¼‰"></a>å››ã€OSI ä¸ƒå±‚ vs TCP&#x2F;IP æ¨¡å‹ï¼ˆæ·±å…¥ç‰ˆï¼‰</h2><table><thead><tr><th>æ¨¡å‹</th><th>å±‚æ•°</th><th>åŠŸèƒ½</th><th>é¢è¯•å…³æ³¨ç‚¹</th></tr></thead><tbody><tr><td><strong>OSI</strong></td><td>7 å±‚ï¼šåº”ç”¨ã€è¡¨ç¤ºã€ä¼šè¯ã€ä¼ è¾“ã€ç½‘ç»œã€æ•°æ®é“¾è·¯ã€ç‰©ç†</td><td>ç†è®ºæ¨¡å‹ï¼Œæè¿°ç½‘ç»œé€šä¿¡çš„å®Œæ•´åŠŸèƒ½</td><td>é¢è¯•å¸¸è€ƒâ€œæ¯å±‚åŠŸèƒ½ã€æ•°æ®å•ä½ã€åè®®ã€å…¸å‹è®¾å¤‡â€</td></tr><tr><td><strong>TCP&#x2F;IP</strong></td><td>4 å±‚ï¼šåº”ç”¨ã€ä¼ è¾“ã€ç½‘ç»œã€ç½‘ç»œæ¥å£</td><td>å®é™…äº’è”ç½‘ä½¿ç”¨çš„æ¨¡å‹ï¼Œç®€åŒ– OSIï¼Œç»“åˆå®é™…åè®®</td><td>é¢è¯•å¸¸è€ƒâ€œTCP&#x2F;IP ä¸ OSI çš„å¯¹åº”å…³ç³»ã€æ ¸å¿ƒåè®®ã€åº”ç”¨åœºæ™¯â€</td></tr></tbody></table><p><strong>OSI ä¸ TCP&#x2F;IP å¯¹åº”å…³ç³»</strong>ï¼š</p><ul><li>OSI åº”ç”¨&#x2F;è¡¨ç¤º&#x2F;ä¼šè¯å±‚ â†’ TCP&#x2F;IP åº”ç”¨å±‚</li><li>OSI ä¼ è¾“å±‚ â†’ TCP&#x2F;IP ä¼ è¾“å±‚</li><li>OSI ç½‘ç»œå±‚ â†’ TCP&#x2F;IP ç½‘ç»œå±‚</li><li>OSI æ•°æ®é“¾è·¯å±‚ + ç‰©ç†å±‚ â†’ TCP&#x2F;IP ç½‘ç»œæ¥å£å±‚</li></ul><p><strong>é¢è¯•æ‹“å±•ç‚¹</strong>ï¼š</p><ol><li>TCP&#x2F;IP ä¸ºä»€ä¹ˆåªæœ‰ 4 å±‚ï¼Ÿ<ul><li>å› ä¸ºå®é™…åº”ç”¨ä¸­ï¼Œè¡¨ç¤ºå±‚ä¸ä¼šè¯å±‚åŠŸèƒ½é€šå¸¸ç”±åº”ç”¨å±‚å®ç°ï¼Œç¡¬ä»¶è®¾å¤‡çš„ç‰©ç†å’Œé“¾è·¯å±‚å¯åˆå¹¶ã€‚</li></ul></li><li>OSI æ¨¡å‹ä¸ºä»€ä¹ˆé‡è¦ï¼Ÿ<ul><li>ç†è®ºæŒ‡å¯¼ï¼Œå¸®åŠ©ç†è§£ç½‘ç»œé€šä¿¡åˆ†å±‚è®¾è®¡ã€æ¨¡å—åŒ–ã€äº’æ“ä½œæ€§ã€‚</li></ul></li><li>é¢è¯•å¸¸é—®ï¼šOSI ä¸ƒå±‚æ¨¡å‹æ¯å±‚é¢è¯•é—®æ³•ç¤ºä¾‹<ul><li><strong>ç‰©ç†å±‚</strong>ï¼šåŒç»çº¿å’Œå…‰çº¤åŒºåˆ«ï¼Ÿå…¨åŒå·¥å’ŒåŠåŒå·¥åŒºåˆ«ï¼Ÿ</li><li><strong>æ•°æ®é“¾è·¯å±‚</strong>ï¼šMAC åœ°å€æ ¼å¼ï¼Ÿäº¤æ¢æœºä¸ç½‘æ¡¥åŒºåˆ«ï¼ŸVLAN åŸç†ï¼Ÿ</li><li><strong>ç½‘ç»œå±‚</strong>ï¼šIP åœ°å€åˆ†ç±»ï¼Ÿå­ç½‘æ©ç ï¼ŸRIP vs OSPFï¼Ÿ</li><li><strong>ä¼ è¾“å±‚</strong>ï¼šTCP&#x2F;UDP åŒºåˆ«ï¼Ÿä¸‰æ¬¡æ¡æ‰‹æµç¨‹ï¼Ÿæ»‘åŠ¨çª—å£åŸç†ï¼Ÿ</li><li><strong>ä¼šè¯å±‚</strong>ï¼šHTTP æ— çŠ¶æ€å¦‚ä½•å®ç°ä¼šè¯ä¿æŒï¼Ÿ</li><li><strong>è¡¨ç¤ºå±‚</strong>ï¼šç¼–ç è½¬æ¢ï¼Ÿå¤§ç«¯å°ç«¯ï¼ŸTLS åŠ å¯†æµç¨‹ï¼Ÿ</li><li><strong>åº”ç”¨å±‚</strong>ï¼šHTTP çŠ¶æ€ç ï¼ŸFTP ä¸»åŠ¨&#x2F;è¢«åŠ¨æ¨¡å¼ï¼ŸDNS æŸ¥è¯¢è¿‡ç¨‹ï¼Ÿ</li></ul></li></ol><hr><h2 id="1-ç‰©ç†å±‚"><a href="#1-ç‰©ç†å±‚" class="headerlink" title="1. ç‰©ç†å±‚"></a>1. ç‰©ç†å±‚</h2><p><strong>Q1ï¼šåŒç»çº¿å’Œå…‰çº¤åŒºåˆ«ï¼Ÿ</strong><br> <strong>A1</strong>ï¼š</p><table><thead><tr><th>ç‰¹æ€§</th><th>åŒç»çº¿</th><th>å…‰çº¤</th></tr></thead><tbody><tr><td>ä¼ è¾“ä»‹è´¨</td><td>é“œçº¿</td><td>å…‰çº¤ï¼ˆç»ç’ƒæˆ–å¡‘æ–™ï¼‰</td></tr><tr><td>ä¼ è¾“æ–¹å¼</td><td>ç”µä¿¡å·</td><td>å…‰ä¿¡å·</td></tr><tr><td>æŠ—å¹²æ‰°æ€§</td><td>å®¹æ˜“å—ç”µç£å¹²æ‰°</td><td>æŠ—ç”µç£å¹²æ‰°å¼º</td></tr><tr><td>ä¼ è¾“è·ç¦»</td><td>çŸ­ï¼ˆ100ç±³å·¦å³ï¼‰</td><td>é•¿ï¼ˆå¯è¾¾æ•°å…¬é‡Œï¼‰</td></tr><tr><td>ä¼ è¾“é€Ÿç‡</td><td>10Mbps~10Gbps</td><td>1Gbps~400Gbps</td></tr><tr><td>æˆæœ¬</td><td>ä½</td><td>é«˜</td></tr><tr><td><strong>é¢è¯•è¦ç‚¹</strong>ï¼šå…‰çº¤é€‚åˆé«˜é€Ÿã€é•¿è·ç¦»ã€æ•°æ®ä¸­å¿ƒæˆ–æ ¸å¿ƒç½‘ï¼ŒåŒç»çº¿é€‚åˆå±€åŸŸç½‘ã€‚</td><td></td><td></td></tr></tbody></table><p><strong>Q2ï¼šå…¨åŒå·¥å’ŒåŠåŒå·¥åŒºåˆ«ï¼Ÿ</strong><br> <strong>A2</strong>ï¼š</p><ul><li><strong>åŠåŒå·¥</strong>ï¼šæ•°æ®åŒå‘ä¼ è¾“ï¼Œä½†åŒä¸€æ—¶é—´åªèƒ½ä¸€ä¸ªæ–¹å‘ï¼ˆå¦‚å¯¹è®²æœºï¼‰ã€‚</li><li><strong>å…¨åŒå·¥</strong>ï¼šæ•°æ®åŒå‘ä¼ è¾“ï¼Œå¯åŒæ—¶æ”¶å‘ï¼ˆå¦‚ç°ä»£äº¤æ¢æœºç«¯å£ï¼‰ã€‚<br> <strong>é¢è¯•è¦ç‚¹</strong>ï¼šåŠåŒå·¥å®¹æ˜“å†²çªï¼Œéœ€è¦ CSMA&#x2F;CDï¼Œé™ä½æ•ˆç‡ï¼›å…¨åŒå·¥æ— éœ€å†²çªæ£€æµ‹ï¼Œé€Ÿç‡ç¿»å€ã€‚</li></ul><hr><h2 id="2-æ•°æ®é“¾è·¯å±‚"><a href="#2-æ•°æ®é“¾è·¯å±‚" class="headerlink" title="2. æ•°æ®é“¾è·¯å±‚"></a>2. æ•°æ®é“¾è·¯å±‚</h2><p><strong>Q1ï¼šMAC åœ°å€æ ¼å¼ï¼Ÿ</strong><br> <strong>A1</strong>ï¼š</p><ul><li>48 ä½äºŒè¿›åˆ¶ï¼Œé€šå¸¸å†™ä½œ 6 ç»„åå…­è¿›åˆ¶ï¼š<code>00:1A:2B:3C:4D:5E</code></li><li>å‰ 24 ä½ï¼šå‚å•†æ ‡è¯†ï¼ˆOUIï¼‰</li><li>å 24 ä½ï¼šç½‘å¡åºåˆ—å·</li><li>å”¯ä¸€æ ‡è¯†ç½‘å¡è®¾å¤‡<br> <strong>é¢è¯•è¦ç‚¹</strong>ï¼šMAC åœ°å€ç”¨äºå±€åŸŸç½‘å†…é€šä¿¡ï¼Œäº¤æ¢æœºé€šè¿‡ MAC è¡¨è½¬å‘å¸§ã€‚</li></ul><p><strong>Q2ï¼šäº¤æ¢æœºä¸ç½‘æ¡¥åŒºåˆ«ï¼Ÿ</strong></p><table><thead><tr><th>ç‰¹æ€§</th><th>ç½‘æ¡¥ (Bridge)</th><th>äº¤æ¢æœº (Switch)</th></tr></thead><tbody><tr><td>ç«¯å£æ•°</td><td>å°‘</td><td>å¤š</td></tr><tr><td>åŠŸèƒ½</td><td>è½¬å‘å¸§ã€è¿‡æ»¤å¹¿æ’­</td><td>è½¬å‘å¸§ã€å­¦ä¹  MACã€åˆ†å‰²å†²çªåŸŸ</td></tr><tr><td>æ€§èƒ½</td><td>è¾ƒä½</td><td>é«˜</td></tr><tr><td><strong>é¢è¯•è¦ç‚¹</strong>ï¼šäº¤æ¢æœºå¯ä»¥ç†è§£ä¸ºå¤šç«¯å£ç½‘æ¡¥ï¼Œéš”ç¦»å†²çªåŸŸï¼Œæ•ˆç‡æ›´é«˜ã€‚</td><td></td><td></td></tr></tbody></table><p><strong>Q3ï¼šVLAN åŸç†ï¼Ÿ</strong><br> <strong>A3</strong>ï¼š</p><ul><li>è™šæ‹Ÿå±€åŸŸç½‘ï¼ˆVirtual LANï¼‰åœ¨åŒä¸€ç‰©ç†äº¤æ¢æœºä¸Šåˆ’åˆ†ä¸åŒé€»è¾‘ç½‘æ®µã€‚</li><li>é€šè¿‡ <strong>802.1Q æ ‡ç­¾</strong> ç»™å¸§æ‰“æ ‡ç­¾ï¼Œå®ç°é€»è¾‘éš”ç¦»ã€‚</li><li>ä¼˜ç‚¹ï¼šéš”ç¦»å¹¿æ’­åŸŸï¼Œæé«˜å®‰å…¨æ€§å’Œç®¡ç†æ€§ã€‚<br> <strong>é¢è¯•è¦ç‚¹</strong>ï¼šåŒä¸€äº¤æ¢æœºå†…ä¸åŒ VLAN ä¹‹é—´é€šä¿¡éœ€è¦è·¯ç”±å™¨æˆ–ä¸‰å±‚äº¤æ¢æœºã€‚</li></ul><hr><h2 id="3-ç½‘ç»œå±‚"><a href="#3-ç½‘ç»œå±‚" class="headerlink" title="3. ç½‘ç»œå±‚"></a>3. ç½‘ç»œå±‚</h2><p><strong>Q1ï¼šIP åœ°å€åˆ†ç±»ï¼Ÿ</strong></p><table><thead><tr><th>ç±»åˆ«</th><th>èµ·å§‹ä½</th><th>èŒƒå›´</th><th>é»˜è®¤å­ç½‘æ©ç </th><th>ç”¨é€”</th></tr></thead><tbody><tr><td>A</td><td>0</td><td>1.0.0.0â€“126.255.255.255</td><td>255.0.0.0</td><td>å¤§å‹ç½‘ç»œ</td></tr><tr><td>B</td><td>10</td><td>128.0.0.0â€“191.255.255.255</td><td>255.255.0.0</td><td>ä¸­å‹ç½‘ç»œ</td></tr><tr><td>C</td><td>110</td><td>192.0.0.0â€“223.255.255.255</td><td>255.255.255.0</td><td>å°å‹ç½‘ç»œ</td></tr><tr><td>D</td><td>1110</td><td>224.0.0.0â€“239.255.255.255</td><td>N&#x2F;A</td><td>å¤šæ’­</td></tr><tr><td>E</td><td>1111</td><td>240.0.0.0â€“255.255.255.255</td><td>N&#x2F;A</td><td>å®éªŒ&#x2F;ä¿ç•™</td></tr></tbody></table><p><strong>Q2ï¼šå­ç½‘æ©ç ä½œç”¨ï¼Ÿ</strong></p><ul><li>ç”¨äºåŒºåˆ†ç½‘ç»œå·å’Œä¸»æœºå·ã€‚</li><li>é€šè¿‡æŒ‰ä½ä¸è¿ç®—ç¡®å®šåŒä¸€ç½‘æ®µå†…ä¸»æœºã€‚</li><li>é¢è¯•é—®æ³•ï¼šç»™ IP&#x2F;å­ç½‘æ©ç è®¡ç®—å¯ç”¨ä¸»æœºæ•°æˆ–å¹¿æ’­åœ°å€ã€‚</li></ul><p><strong>Q3ï¼šRIP vs OSPF</strong></p><table><thead><tr><th>ç‰¹æ€§</th><th>RIP</th><th>OSPF</th></tr></thead><tbody><tr><td>ç±»å‹</td><td>è·ç¦»çŸ¢é‡</td><td>é“¾è·¯çŠ¶æ€</td></tr><tr><td>æ”¶æ•›é€Ÿåº¦</td><td>æ…¢</td><td>å¿«</td></tr><tr><td>åº¦é‡</td><td>è·³æ•°</td><td>å¸¦å®½&#x2F;å»¶è¿Ÿ</td></tr><tr><td>ç¼ºç‚¹</td><td>è·¯å¾„å¯èƒ½ç¯è·¯</td><td>é…ç½®å¤æ‚</td></tr><tr><td><strong>é¢è¯•è¦ç‚¹</strong>ï¼šRIP ç®€å•ã€é€‚åˆå°ç½‘ç»œï¼›OSPF å¤æ‚ã€é€‚åˆå¤§å‹ç½‘ç»œã€‚</td><td></td><td></td></tr></tbody></table><hr><h2 id="4-ä¼ è¾“å±‚"><a href="#4-ä¼ è¾“å±‚" class="headerlink" title="4. ä¼ è¾“å±‚"></a>4. ä¼ è¾“å±‚</h2><p><strong>Q1ï¼šTCP&#x2F;UDP åŒºåˆ«</strong><br> è¯¦è§ä¸Šæ¡å›ç­”ã€‚</p><p><strong>Q2ï¼šä¸‰æ¬¡æ¡æ‰‹æµç¨‹</strong><br> è¯¦è§ä¸Šæ¡å›ç­”ï¼Œå¯ç”»å›¾è¾…åŠ©è¯´æ˜ã€‚</p><p><strong>Q3ï¼šæ»‘åŠ¨çª—å£åŸç†</strong></p><ul><li>TCP ä½¿ç”¨æ»‘åŠ¨çª—å£è¿›è¡Œæµé‡æ§åˆ¶ã€‚</li><li><strong>å‘é€æ–¹</strong>å¯å‘é€çª—å£å¤§å°å†…çš„æ•°æ®è€Œä¸å¿…ç­‰å¾… ACKã€‚</li><li><strong>æ¥æ”¶æ–¹</strong>é€šè¿‡çª—å£å¤§å°å‘ŠçŸ¥å¯æ¥æ”¶ç¼“å†²åŒºå®¹é‡ã€‚</li><li><strong>å¥½å¤„</strong>ï¼šæé«˜é“¾è·¯åˆ©ç”¨ç‡ï¼Œé¿å…é¢‘ç¹ç­‰å¾…ç¡®è®¤ã€‚</li><li>é¢è¯•é—®æ³•ï¼šæ»‘åŠ¨çª—å£ä¸åœæ­¢ç­‰å¾…åŒºåˆ«ï¼Ÿç­”æ¡ˆï¼šæ»‘åŠ¨çª—å£ä¸€æ¬¡å¯å‘é€å¤šæ®µï¼Œåœæ­¢ç­‰å¾…ä¸€æ¬¡åªèƒ½å‘é€ä¸€æ®µã€‚</li></ul><hr><h2 id="5-ä¼šè¯å±‚"><a href="#5-ä¼šè¯å±‚" class="headerlink" title="5. ä¼šè¯å±‚"></a>5. ä¼šè¯å±‚</h2><p><strong>Q1ï¼šHTTP æ— çŠ¶æ€å¦‚ä½•å®ç°ä¼šè¯ä¿æŒï¼Ÿ</strong></p><ul><li>HTTP æœ¬èº«æ— çŠ¶æ€ï¼Œæ¯æ¬¡è¯·æ±‚ç‹¬ç«‹ã€‚</li><li><strong>å®ç°æ–¹å¼</strong>ï¼š<ol><li><strong>Cookie</strong>ï¼šå®¢æˆ·ç«¯ä¿å­˜ä¼šè¯ IDï¼Œéšè¯·æ±‚å‘é€ã€‚</li><li><strong>Session</strong>ï¼šæœåŠ¡ç«¯ä¿å­˜ç”¨æˆ·çŠ¶æ€ï¼Œå®¢æˆ·ç«¯å‘é€æ ‡è¯†ã€‚</li><li><strong>Token&#x2F;JWT</strong>ï¼šæ— çŠ¶æ€æ–¹å¼ï¼Œå°†ç”¨æˆ·ä¿¡æ¯åŠ å¯†æ”¾åœ¨å®¢æˆ·ç«¯ã€‚</li></ol></li></ul><hr><h2 id="6-è¡¨ç¤ºå±‚"><a href="#6-è¡¨ç¤ºå±‚" class="headerlink" title="6. è¡¨ç¤ºå±‚"></a>6. è¡¨ç¤ºå±‚</h2><p><strong>Q1ï¼šç¼–ç è½¬æ¢</strong></p><ul><li>ASCIIã€UTF-8ã€Unicode ç­‰ï¼Œç”¨äºä¸åŒç³»ç»Ÿé—´å­—ç¬¦è¡¨ç¤ºå…¼å®¹ã€‚</li><li>é¢è¯•é—®æ³•ï¼šä¸­æ–‡ UTF-8 ç¼–ç å å¤šå°‘å­—èŠ‚ï¼Ÿ<br> <strong>ç­”æ¡ˆ</strong>ï¼šæ±‰å­— 3 å­—èŠ‚ï¼Œè‹±æ–‡ 1 å­—èŠ‚ã€‚</li></ul><p><strong>Q2ï¼šå¤§ç«¯å°ç«¯</strong></p><ul><li><strong>å¤§ç«¯</strong>ï¼ˆBig Endianï¼‰ï¼šé«˜ä½å­—èŠ‚å­˜æ”¾åœ¨ä½åœ°å€ã€‚</li><li><strong>å°ç«¯</strong>ï¼ˆLittle Endianï¼‰ï¼šä½ä½å­—èŠ‚å­˜æ”¾åœ¨ä½åœ°å€ã€‚</li><li>é¢è¯•é—®æ³•ï¼šç½‘ç»œä¼ è¾“ä½¿ç”¨å“ªç§ï¼Ÿ<br> <strong>ç­”æ¡ˆ</strong>ï¼šå¤§ç«¯ï¼ˆç½‘ç»œå­—èŠ‚åºï¼‰ã€‚</li></ul><p><strong>Q3ï¼šTLS åŠ å¯†æµç¨‹</strong></p><ol><li>å®¢æˆ·ç«¯å‘é€ ClientHelloï¼ˆæ”¯æŒåŠ å¯†ç®—æ³•ï¼‰ã€‚</li><li>æœåŠ¡å™¨è¿”å› ServerHelloï¼Œå‘é€è¯ä¹¦ã€‚</li><li>å®¢æˆ·ç«¯éªŒè¯è¯ä¹¦ï¼Œç”Ÿæˆä¼šè¯å¯†é’¥ã€‚</li><li>åŒæ–¹ç”¨ä¼šè¯å¯†é’¥åŠ å¯†é€šä¿¡ã€‚</li></ol><ul><li>é¢è¯•è¦ç‚¹ï¼šè®²æ¸…æ¥šâ€œè¯ä¹¦éªŒè¯â€å’Œâ€œå¯¹ç§°å¯†é’¥åŠ å¯†æ•°æ®â€ã€‚</li></ul><hr><h2 id="7-åº”ç”¨å±‚"><a href="#7-åº”ç”¨å±‚" class="headerlink" title="7. åº”ç”¨å±‚"></a>7. åº”ç”¨å±‚</h2><p><strong>Q1ï¼šHTTP çŠ¶æ€ç </strong></p><table><thead><tr><th>ç±»å‹</th><th>ç¤ºä¾‹</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>1xx</td><td>100 Continue</td><td>ä¿¡æ¯æ€§å“åº”</td></tr><tr><td>2xx</td><td>200 OK</td><td>æˆåŠŸ</td></tr><tr><td>3xx</td><td>301 Moved Permanently</td><td>é‡å®šå‘</td></tr><tr><td>4xx</td><td>404 Not Found</td><td>å®¢æˆ·ç«¯é”™è¯¯</td></tr><tr><td>5xx</td><td>500 Internal Server Error</td><td>æœåŠ¡å™¨é”™è¯¯</td></tr></tbody></table><p><strong>Q2ï¼šFTP ä¸»åŠ¨&#x2F;è¢«åŠ¨æ¨¡å¼</strong></p><ul><li><strong>ä¸»åŠ¨æ¨¡å¼</strong>ï¼šå®¢æˆ·ç«¯å»ºç«‹æ§åˆ¶è¿æ¥ï¼ŒæœåŠ¡å™¨ä¸»åŠ¨å»ºç«‹æ•°æ®è¿æ¥ã€‚</li><li><strong>è¢«åŠ¨æ¨¡å¼</strong>ï¼šå®¢æˆ·ç«¯å»ºç«‹æ§åˆ¶è¿æ¥å’Œæ•°æ®è¿æ¥ï¼ŒæœåŠ¡å™¨è¢«åŠ¨ç›‘å¬ã€‚</li><li>é¢è¯•è¦ç‚¹ï¼šè¢«åŠ¨æ¨¡å¼ç”¨äºå®¢æˆ·ç«¯åœ¨é˜²ç«å¢™åçš„æƒ…å†µã€‚</li></ul><p><strong>Q3ï¼šDNS æŸ¥è¯¢è¿‡ç¨‹</strong></p><ol><li>å®¢æˆ·ç«¯å‘æœ¬åœ° DNS å‘èµ·é€’å½’æŸ¥è¯¢ã€‚</li><li>æœ¬åœ° DNS å¦‚æœç¼“å­˜æ²¡æœ‰ï¼Œå‘æ ¹ DNS æŸ¥è¯¢ â†’ é¡¶çº§åŸŸ â†’ æƒå¨ DNSã€‚</li><li>æƒå¨ DNS è¿”å›è§£æç»“æœåˆ°æœ¬åœ° DNSï¼Œæœ¬åœ°è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li></ol><ul><li>é¢è¯•è¦ç‚¹ï¼šé€’å½’æŸ¥è¯¢ vs è¿­ä»£æŸ¥è¯¢åŒºåˆ«ã€‚</li></ul><hr><hr><h2 id="ä¸€ã€å‰åç«¯äº¤äº’çš„åŸºæœ¬æµç¨‹"><a href="#ä¸€ã€å‰åç«¯äº¤äº’çš„åŸºæœ¬æµç¨‹" class="headerlink" title="ä¸€ã€å‰åç«¯äº¤äº’çš„åŸºæœ¬æµç¨‹"></a><strong>ä¸€ã€å‰åç«¯äº¤äº’çš„åŸºæœ¬æµç¨‹</strong></h2><ol><li><strong>å‰ç«¯å‘èµ·è¯·æ±‚</strong><ul><li>ç”¨æˆ·åœ¨æµè§ˆå™¨æˆ–å®¢æˆ·ç«¯æ“ä½œï¼Œæ¯”å¦‚ç‚¹å‡»æŒ‰é’®ã€æäº¤è¡¨å•ã€‚</li><li>å‰ç«¯é€šè¿‡ HTTP&#x2F;HTTPS æˆ– WebSocket å‘åç«¯å‘é€è¯·æ±‚ã€‚</li><li>è¯·æ±‚åŒ…å«ï¼šURLã€è¯·æ±‚æ–¹æ³•ï¼ˆGET&#x2F;POST&#x2F;PUT&#x2F;DELETE ç­‰ï¼‰ã€è¯·æ±‚å¤´ï¼ˆHeaderï¼‰ã€è¯·æ±‚ä½“ï¼ˆBodyï¼ŒPOST&#x2F;PUT æ—¶ï¼‰å’Œå‚æ•°ã€‚</li></ul></li><li><strong>åç«¯æ¥æ”¶è¯·æ±‚</strong><ul><li>åç«¯æœåŠ¡å™¨ï¼ˆå¦‚ Java&#x2F;Springã€Node.jsã€Python Flask&#x2F;Djangoï¼‰è§£æè¯·æ±‚ã€‚</li><li>åç«¯æ ¹æ® URL è·¯å¾„ã€HTTP æ–¹æ³•åŒ¹é…è·¯ç”±åˆ°å¯¹åº”çš„å¤„ç†å‡½æ•°ï¼ˆController&#x2F;Handlerï¼‰ã€‚</li></ul></li><li><strong>åç«¯å¤„ç†è¯·æ±‚</strong><ul><li>åç«¯è¿›è¡Œä¸šåŠ¡é€»è¾‘å¤„ç†ï¼š<ul><li>æ•°æ®åº“æŸ¥è¯¢&#x2F;æ›´æ–°ï¼ˆCRUDï¼‰</li><li>è°ƒç”¨å…¶ä»–æœåŠ¡æˆ– API</li><li>æ•°æ®éªŒè¯ã€æƒé™æ ¡éªŒ</li></ul></li><li>å¤„ç†å®Œæˆåï¼Œç”Ÿæˆå“åº”æ•°æ®ï¼ˆé€šå¸¸ä¸º JSONã€XMLã€HTML æˆ–äºŒè¿›åˆ¶æ–‡ä»¶ï¼‰ã€‚</li></ul></li><li><strong>åç«¯è¿”å›å“åº”</strong><ul><li>å“åº”åŒ…å«ï¼šçŠ¶æ€ç ï¼ˆHTTP Status Codeï¼‰ã€å“åº”å¤´ã€å“åº”ä½“ï¼ˆBodyï¼‰ã€‚</li><li>çŠ¶æ€ç ç¤ºä¾‹ï¼š<ul><li>200 OKï¼šè¯·æ±‚æˆåŠŸ</li><li>201 Createdï¼šèµ„æºåˆ›å»ºæˆåŠŸ</li><li>400 Bad Requestï¼šè¯·æ±‚é”™è¯¯</li><li>401 Unauthorizedï¼šæœªæˆæƒ</li><li>500 Internal Server Errorï¼šæœåŠ¡å™¨é”™è¯¯</li></ul></li></ul></li><li><strong>å‰ç«¯æ¥æ”¶å“åº”</strong><ul><li>å‰ç«¯æ ¹æ®çŠ¶æ€ç åˆ¤æ–­è¯·æ±‚ç»“æœã€‚</li><li>å‰ç«¯è§£æå“åº”ä½“å¹¶æ›´æ–°ç•Œé¢ï¼ˆUIï¼‰ï¼Œä¾‹å¦‚æ¸²æŸ“æ•°æ®è¡¨æ ¼ã€æ˜¾ç¤ºæç¤ºä¿¡æ¯ã€‚</li><li>å¦‚æœæ˜¯å¼‚æ­¥è¯·æ±‚ï¼ˆAJAX&#x2F;Fetch&#x2F;axiosï¼‰ï¼Œå‰ç«¯å¯ä»¥åœ¨å›è°ƒæˆ– Promise ä¸­å¤„ç†å“åº”ã€‚</li></ul></li></ol><hr><h2 id="äºŒã€å‰åç«¯äº¤äº’æ–¹å¼"><a href="#äºŒã€å‰åç«¯äº¤äº’æ–¹å¼" class="headerlink" title="äºŒã€å‰åç«¯äº¤äº’æ–¹å¼"></a><strong>äºŒã€å‰åç«¯äº¤äº’æ–¹å¼</strong></h2><h3 id="1-HTTP-è¯·æ±‚-å“åº”æ¨¡å¼"><a href="#1-HTTP-è¯·æ±‚-å“åº”æ¨¡å¼" class="headerlink" title="1. HTTP è¯·æ±‚-å“åº”æ¨¡å¼"></a>1. <strong>HTTP è¯·æ±‚-å“åº”æ¨¡å¼</strong></h3><ul><li><strong>åŒæ­¥è¯·æ±‚</strong>ï¼ˆä¼ ç»Ÿè¡¨å•æäº¤ï¼‰ï¼šæµè§ˆå™¨æäº¤è¡¨å•ï¼Œç­‰å¾…å“åº”é¡µé¢åˆ·æ–°ã€‚</li><li><strong>å¼‚æ­¥è¯·æ±‚</strong>ï¼ˆAJAX&#x2F;Fetch&#x2F;axiosï¼‰ï¼šé¡µé¢ä¸åˆ·æ–°ï¼Œé€šè¿‡ JavaScript å¼‚æ­¥è·å–æ•°æ®ã€‚</li></ul><h3 id="2-WebSocket-å®æ—¶é€šä¿¡"><a href="#2-WebSocket-å®æ—¶é€šä¿¡" class="headerlink" title="2. WebSocket å®æ—¶é€šä¿¡"></a>2. <strong>WebSocket å®æ—¶é€šä¿¡</strong></h3><ul><li>å‰ç«¯ä¸åç«¯å»ºç«‹é•¿è¿æ¥ã€‚</li><li>å¯ä»¥å®æ—¶åŒå‘é€šä¿¡ï¼Œä¸éœ€è¦æ¯æ¬¡éƒ½å‘ HTTP è¯·æ±‚ã€‚</li><li>é€‚ç”¨åœºæ™¯ï¼šèŠå¤©åº”ç”¨ã€åœ¨çº¿æ¸¸æˆã€å®æ—¶ç›‘æ§ã€‚</li></ul><h3 id="3-Server-Sent-Eventsï¼ˆSSEï¼‰"><a href="#3-Server-Sent-Eventsï¼ˆSSEï¼‰" class="headerlink" title="3. Server-Sent Eventsï¼ˆSSEï¼‰"></a>3. <strong>Server-Sent Eventsï¼ˆSSEï¼‰</strong></h3><ul><li>åç«¯ä¸»åŠ¨å‘å‰ç«¯æ¨é€äº‹ä»¶æµã€‚</li><li>å•å‘é€šä¿¡ï¼ˆåç«¯ â†’ å‰ç«¯ï¼‰ã€‚</li><li>é€‚ç”¨äºæ¶ˆæ¯é€šçŸ¥ã€å®æ—¶æ•°æ®æ›´æ–°ã€‚</li></ul><h3 id="4-GraphQL"><a href="#4-GraphQL" class="headerlink" title="4. GraphQL"></a>4. <strong>GraphQL</strong></h3><ul><li>å‰ç«¯å‘é€ä¸€ä¸ªæŸ¥è¯¢è¯·æ±‚ï¼Œåç«¯æ ¹æ®æŸ¥è¯¢è¿”å›ç²¾ç¡®çš„æ•°æ®ã€‚</li><li>ç›¸æ¯” RESTï¼Œå¯ä»¥å‡å°‘å†—ä½™æ•°æ®ä¼ è¾“ã€‚</li></ul><hr><h2 id="ä¸‰ã€å‰åç«¯å“åº”ç¤ºä¾‹"><a href="#ä¸‰ã€å‰åç«¯å“åº”ç¤ºä¾‹" class="headerlink" title="ä¸‰ã€å‰åç«¯å“åº”ç¤ºä¾‹"></a><strong>ä¸‰ã€å‰åç«¯å“åº”ç¤ºä¾‹</strong></h2><p><strong>å‰ç«¯ï¼ˆJavaScript fetchï¼‰</strong>ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">fetch</span>(<span class="string">&quot;https://api.example.com/users&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">    <span class="attr">headers</span>: &#123;</span><br><span class="line">        <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!response.<span class="property">ok</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;ç½‘ç»œé”™è¯¯&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> response.<span class="title function_">json</span>();</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ç”¨æˆ·æ•°æ®:&quot;</span>, data);</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;è¯·æ±‚å¤±è´¥:&quot;</span>, err);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><strong>åç«¯ï¼ˆNode.js&#x2F;Expressï¼‰</strong>ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/users&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> users = [</span><br><span class="line">        &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&quot;Alice&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&quot;Bob&quot;</span>&#125;</span><br><span class="line">    ];</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">json</span>(users);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li>å‰ç«¯å‘èµ· GET è¯·æ±‚ â†’ åç«¯è¿”å› JSON â†’ å‰ç«¯è§£æ JSON æ›´æ–°é¡µé¢ã€‚</li></ul><hr><h2 id="å››ã€çŠ¶æ€ç ä¸å“åº”æµç¨‹"><a href="#å››ã€çŠ¶æ€ç ä¸å“åº”æµç¨‹" class="headerlink" title="å››ã€çŠ¶æ€ç ä¸å“åº”æµç¨‹"></a><strong>å››ã€çŠ¶æ€ç ä¸å“åº”æµç¨‹</strong></h2><table><thead><tr><th>çŠ¶æ€ç </th><th>å«ä¹‰</th><th>å‰ç«¯å¤„ç†æ–¹å¼</th></tr></thead><tbody><tr><td>200 OK</td><td>è¯·æ±‚æˆåŠŸ</td><td>è§£ææ•°æ®æ›´æ–° UI</td></tr><tr><td>201 Created</td><td>èµ„æºåˆ›å»ºæˆåŠŸ</td><td>å¯ä»¥è·³è½¬æˆ–æç¤ºæˆåŠŸ</td></tr><tr><td>400 Bad Request</td><td>è¯·æ±‚å‚æ•°é”™è¯¯</td><td>æç¤ºç”¨æˆ·æ£€æŸ¥è¾“å…¥</td></tr><tr><td>401 Unauthorized</td><td>æœªæˆæƒ</td><td>è·³è½¬ç™»å½•é¡µæˆ–è¯·æ±‚æˆæƒ</td></tr><tr><td>404 Not Found</td><td>èµ„æºä¸å­˜åœ¨</td><td>æ˜¾ç¤º 404 é¡µé¢</td></tr><tr><td>500 Internal Server Error</td><td>åç«¯é”™è¯¯</td><td>æ˜¾ç¤ºé”™è¯¯æç¤ºæˆ–é‡è¯•</td></tr></tbody></table><hr><h1 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h1><p>å¥½çš„ï¼Œæˆ‘æ¥ç»™ä½ æ•´ç†ä¸€ä»½ <strong>Linux å¸¸è§çŸ¥è¯†ç‚¹æ¸…å•</strong>ï¼Œæ¶µç›–åŸºç¡€å‘½ä»¤ã€ç³»ç»Ÿç®¡ç†ã€æƒé™ã€ç½‘ç»œã€è¿›ç¨‹ã€æ–‡ä»¶ç³»ç»Ÿç­‰æ–¹é¢ï¼Œé€‚åˆé¢è¯•æˆ–æ—¥å¸¸è¿ç»´å‚è€ƒã€‚æˆ‘ä¼šæŒ‰æ¨¡å—æ•´ç†ï¼Œå¹¶ç»™å‡ºé‡ç‚¹è¯´æ˜ã€‚</p><hr><h2 id="ä¸€ã€åŸºç¡€å‘½ä»¤"><a href="#ä¸€ã€åŸºç¡€å‘½ä»¤" class="headerlink" title="ä¸€ã€åŸºç¡€å‘½ä»¤"></a><strong>ä¸€ã€åŸºç¡€å‘½ä»¤</strong></h2><h3 id="1-æ–‡ä»¶å’Œç›®å½•æ“ä½œ"><a href="#1-æ–‡ä»¶å’Œç›®å½•æ“ä½œ" class="headerlink" title="1. æ–‡ä»¶å’Œç›®å½•æ“ä½œ"></a>1. æ–‡ä»¶å’Œç›®å½•æ“ä½œ</h3><table><thead><tr><th>å‘½ä»¤</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td><code>ls</code></td><td>åˆ—å‡ºç›®å½•å†…å®¹</td></tr><tr><td><code>cd</code></td><td>åˆ‡æ¢ç›®å½•</td></tr><tr><td><code>pwd</code></td><td>æŸ¥çœ‹å½“å‰è·¯å¾„</td></tr><tr><td><code>mkdir</code></td><td>åˆ›å»ºç›®å½•</td></tr><tr><td><code>rm</code></td><td>åˆ é™¤æ–‡ä»¶&#x2F;ç›®å½•ï¼ˆ<code>-r</code>é€’å½’ï¼‰</td></tr><tr><td><code>cp</code></td><td>å¤åˆ¶æ–‡ä»¶&#x2F;ç›®å½•</td></tr><tr><td><code>mv</code></td><td>ç§»åŠ¨æˆ–é‡å‘½å</td></tr><tr><td><code>find</code></td><td>æŸ¥æ‰¾æ–‡ä»¶</td></tr><tr><td><code>locate</code></td><td>å¿«é€ŸæŸ¥æ‰¾æ–‡ä»¶ï¼ˆéœ€æ›´æ–°ç´¢å¼•ï¼‰</td></tr></tbody></table><h3 id="2-æ–‡ä»¶æŸ¥çœ‹ä¸ç¼–è¾‘"><a href="#2-æ–‡ä»¶æŸ¥çœ‹ä¸ç¼–è¾‘" class="headerlink" title="2. æ–‡ä»¶æŸ¥çœ‹ä¸ç¼–è¾‘"></a>2. æ–‡ä»¶æŸ¥çœ‹ä¸ç¼–è¾‘</h3><table><thead><tr><th>å‘½ä»¤</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td><code>cat</code></td><td>æŸ¥çœ‹æ–‡ä»¶å†…å®¹</td></tr><tr><td><code>less</code> &#x2F; <code>more</code></td><td>åˆ†é¡µæµè§ˆ</td></tr><tr><td><code>head</code> &#x2F; <code>tail</code></td><td>æŸ¥çœ‹å¼€å¤´&#x2F;ç»“å°¾è¡Œ</td></tr><tr><td><code>grep</code></td><td>æ–‡ä»¶å†…å®¹æœç´¢</td></tr><tr><td><code>wc</code></td><td>ç»Ÿè®¡è¡Œæ•°ã€å­—æ•°ã€å­—ç¬¦æ•°</td></tr><tr><td><code>vim</code> &#x2F; <code>nano</code></td><td>æ–‡æœ¬ç¼–è¾‘</td></tr></tbody></table><hr><h2 id="äºŒã€ç”¨æˆ·ä¸æƒé™ç®¡ç†"><a href="#äºŒã€ç”¨æˆ·ä¸æƒé™ç®¡ç†" class="headerlink" title="äºŒã€ç”¨æˆ·ä¸æƒé™ç®¡ç†"></a><strong>äºŒã€ç”¨æˆ·ä¸æƒé™ç®¡ç†</strong></h2><h3 id="1-ç”¨æˆ·ç®¡ç†"><a href="#1-ç”¨æˆ·ç®¡ç†" class="headerlink" title="1. ç”¨æˆ·ç®¡ç†"></a>1. ç”¨æˆ·ç®¡ç†</h3><table><thead><tr><th>å‘½ä»¤</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td><code>useradd</code></td><td>æ·»åŠ ç”¨æˆ·</td></tr><tr><td><code>usermod</code></td><td>ä¿®æ”¹ç”¨æˆ·</td></tr><tr><td><code>passwd</code></td><td>ä¿®æ”¹ç”¨æˆ·å¯†ç </td></tr><tr><td><code>userdel</code></td><td>åˆ é™¤ç”¨æˆ·</td></tr><tr><td><code>id</code></td><td>æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯</td></tr></tbody></table><h3 id="2-æƒé™ç®¡ç†"><a href="#2-æƒé™ç®¡ç†" class="headerlink" title="2. æƒé™ç®¡ç†"></a>2. æƒé™ç®¡ç†</h3><table><thead><tr><th>å‘½ä»¤</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td><code>chmod</code></td><td>ä¿®æ”¹æ–‡ä»¶æƒé™ï¼ˆæ•°å­—&#x2F;ç¬¦å·æ¨¡å¼ï¼‰</td></tr><tr><td><code>chown</code></td><td>ä¿®æ”¹æ–‡ä»¶æ‰€æœ‰è€…</td></tr><tr><td><code>chgrp</code></td><td>ä¿®æ”¹æ–‡ä»¶æ‰€å±ç»„</td></tr><tr><td><code>umask</code></td><td>è®¾ç½®é»˜è®¤æƒé™æ©ç </td></tr><tr><td><code>sudo</code></td><td>ææƒæ‰§è¡Œå‘½ä»¤</td></tr></tbody></table><hr><h2 id="ä¸‰ã€è¿›ç¨‹ç®¡ç†"><a href="#ä¸‰ã€è¿›ç¨‹ç®¡ç†" class="headerlink" title="ä¸‰ã€è¿›ç¨‹ç®¡ç†"></a><strong>ä¸‰ã€è¿›ç¨‹ç®¡ç†</strong></h2><table><thead><tr><th>å‘½ä»¤</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td><code>ps</code></td><td>æŸ¥çœ‹è¿›ç¨‹</td></tr><tr><td><code>top</code> &#x2F; <code>htop</code></td><td>åŠ¨æ€æŸ¥çœ‹è¿›ç¨‹å’Œèµ„æº</td></tr><tr><td><code>kill</code> &#x2F; <code>killall</code></td><td>ç»“æŸè¿›ç¨‹</td></tr><tr><td><code>nice</code> &#x2F; <code>renice</code></td><td>è®¾ç½®è¿›ç¨‹ä¼˜å…ˆçº§</td></tr><tr><td><code>jobs</code> &#x2F; <code>fg</code> &#x2F; <code>bg</code></td><td>ä½œä¸šæ§åˆ¶ï¼ˆåå°&#x2F;å‰å°ï¼‰</td></tr></tbody></table><hr><h2 id="å››ã€ç½‘ç»œç®¡ç†"><a href="#å››ã€ç½‘ç»œç®¡ç†" class="headerlink" title="å››ã€ç½‘ç»œç®¡ç†"></a><strong>å››ã€ç½‘ç»œç®¡ç†</strong></h2><table><thead><tr><th>å‘½ä»¤</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td><code>ifconfig</code> &#x2F; <code>ip addr</code></td><td>æŸ¥çœ‹ç½‘å¡IPä¿¡æ¯</td></tr><tr><td><code>ping</code></td><td>æµ‹è¯•ç½‘ç»œè¿é€šæ€§</td></tr><tr><td><code>traceroute</code> &#x2F; <code>tracepath</code></td><td>è·¯ç”±è·Ÿè¸ª</td></tr><tr><td><code>netstat</code> &#x2F; <code>ss</code></td><td>æŸ¥çœ‹ç«¯å£&#x2F;è¿æ¥ä¿¡æ¯</td></tr><tr><td><code>curl</code> &#x2F; <code>wget</code></td><td>ä¸‹è½½æ–‡ä»¶æˆ–è®¿é—®URL</td></tr><tr><td><code>scp</code> &#x2F; <code>rsync</code></td><td>è¿œç¨‹å¤åˆ¶æ–‡ä»¶</td></tr><tr><td><code>iptables</code> &#x2F; <code>firewalld</code></td><td>é˜²ç«å¢™ç®¡ç†</td></tr></tbody></table><hr><h2 id="äº”ã€åŒ…ç®¡ç†"><a href="#äº”ã€åŒ…ç®¡ç†" class="headerlink" title="äº”ã€åŒ…ç®¡ç†"></a><strong>äº”ã€åŒ…ç®¡ç†</strong></h2><ul><li><strong>Debian&#x2F;Ubuntu ç³»åˆ—</strong>ï¼š<ul><li><code>apt update</code> &#x2F; <code>apt upgrade</code></li><li><code>apt install &lt;package&gt;</code> &#x2F; <code>apt remove &lt;package&gt;</code></li></ul></li><li><strong>RedHat&#x2F;CentOS ç³»åˆ—</strong>ï¼š<ul><li><code>yum install &lt;package&gt;</code> &#x2F; <code>yum remove &lt;package&gt;</code></li><li><code>dnf</code>ï¼ˆæ–°ç‰ˆæœ¬æ›¿ä»£ yumï¼‰</li></ul></li></ul><hr><h2 id="å…­ã€ç£ç›˜ä¸æ–‡ä»¶ç³»ç»Ÿç®¡ç†"><a href="#å…­ã€ç£ç›˜ä¸æ–‡ä»¶ç³»ç»Ÿç®¡ç†" class="headerlink" title="å…­ã€ç£ç›˜ä¸æ–‡ä»¶ç³»ç»Ÿç®¡ç†"></a><strong>å…­ã€ç£ç›˜ä¸æ–‡ä»¶ç³»ç»Ÿç®¡ç†</strong></h2><table><thead><tr><th>å‘½ä»¤</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td><code>df -h</code></td><td>æŸ¥çœ‹ç£ç›˜ç©ºé—´</td></tr><tr><td><code>du -h</code></td><td>æŸ¥çœ‹ç›®å½•&#x2F;æ–‡ä»¶å¤§å°</td></tr><tr><td><code>mount</code> &#x2F; <code>umount</code></td><td>æŒ‚è½½&#x2F;å¸è½½åˆ†åŒº</td></tr><tr><td><code>lsblk</code></td><td>æŸ¥çœ‹ç£ç›˜åˆ†åŒº</td></tr><tr><td><code>fdisk</code> &#x2F; <code>parted</code></td><td>åˆ†åŒºç®¡ç†</td></tr><tr><td><code>mkfs</code></td><td>æ ¼å¼åŒ–æ–‡ä»¶ç³»ç»Ÿ</td></tr><tr><td><code>fsck</code></td><td>æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿ</td></tr></tbody></table><hr><h2 id="ä¸ƒã€æ—¥å¿—ç®¡ç†"><a href="#ä¸ƒã€æ—¥å¿—ç®¡ç†" class="headerlink" title="ä¸ƒã€æ—¥å¿—ç®¡ç†"></a><strong>ä¸ƒã€æ—¥å¿—ç®¡ç†</strong></h2><table><thead><tr><th>æ–‡ä»¶&#x2F;å‘½ä»¤</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td><code>/var/log/messages</code></td><td>ç³»ç»Ÿæ—¥å¿—</td></tr><tr><td><code>/var/log/syslog</code></td><td>ç³»ç»Ÿäº‹ä»¶</td></tr><tr><td><code>/var/log/auth.log</code></td><td>ç”¨æˆ·ç™»å½•ä¸è®¤è¯</td></tr><tr><td><code>journalctl</code></td><td>æŸ¥çœ‹ systemd æ—¥å¿—</td></tr><tr><td><code>dmesg</code></td><td>æŸ¥çœ‹å†…æ ¸å¯åŠ¨å’Œç¡¬ä»¶æ—¥å¿—</td></tr></tbody></table><hr><h2 id="å…«ã€ç³»ç»Ÿç®¡ç†"><a href="#å…«ã€ç³»ç»Ÿç®¡ç†" class="headerlink" title="å…«ã€ç³»ç»Ÿç®¡ç†"></a><strong>å…«ã€ç³»ç»Ÿç®¡ç†</strong></h2><table><thead><tr><th>å‘½ä»¤</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td><code>uptime</code></td><td>ç³»ç»Ÿè¿è¡Œæ—¶é—´</td></tr><tr><td><code>uname -a</code></td><td>ç³»ç»Ÿä¿¡æ¯</td></tr><tr><td><code>free -h</code></td><td>å†…å­˜ä½¿ç”¨</td></tr><tr><td><code>vmstat</code></td><td>ç³»ç»Ÿèµ„æºç»Ÿè®¡</td></tr><tr><td><code>df -h</code></td><td>ç£ç›˜ä½¿ç”¨æƒ…å†µ</td></tr><tr><td><code>systemctl</code></td><td>ç®¡ç†æœåŠ¡ï¼ˆå¯åŠ¨&#x2F;åœæ­¢&#x2F;é‡å¯ï¼‰</td></tr><tr><td><code>crontab</code></td><td>å®šæ—¶ä»»åŠ¡ç®¡ç†</td></tr></tbody></table><hr><h2 id="ä¹ã€å‹ç¼©ä¸è§£å‹"><a href="#ä¹ã€å‹ç¼©ä¸è§£å‹" class="headerlink" title="ä¹ã€å‹ç¼©ä¸è§£å‹"></a><strong>ä¹ã€å‹ç¼©ä¸è§£å‹</strong></h2><table><thead><tr><th>å‘½ä»¤</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td><code>tar -cvf</code> &#x2F; <code>tar -xvf</code></td><td>æ‰“åŒ…&#x2F;è§£åŒ…</td></tr><tr><td><code>gzip</code> &#x2F; <code>gunzip</code></td><td>å‹ç¼©&#x2F;è§£å‹</td></tr><tr><td><code>zip</code> &#x2F; <code>unzip</code></td><td>å‹ç¼©&#x2F;è§£å‹</td></tr></tbody></table><hr><h2 id="åã€Shell-è„šæœ¬åŸºç¡€ï¼ˆè¯¦ç»†ç‰ˆï¼‰"><a href="#åã€Shell-è„šæœ¬åŸºç¡€ï¼ˆè¯¦ç»†ç‰ˆï¼‰" class="headerlink" title="åã€Shell è„šæœ¬åŸºç¡€ï¼ˆè¯¦ç»†ç‰ˆï¼‰"></a><strong>åã€Shell è„šæœ¬åŸºç¡€ï¼ˆè¯¦ç»†ç‰ˆï¼‰</strong></h2><h3 id="1-å˜é‡"><a href="#1-å˜é‡" class="headerlink" title="1. å˜é‡"></a>1. å˜é‡</h3><ul><li><strong>å®šä¹‰å˜é‡</strong>ï¼š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NAME=<span class="string">&quot;Charlotte&quot;</span></span><br><span class="line">AGE=25</span><br></pre></td></tr></table></figure><ul><li><strong>è®¿é—®å˜é‡</strong>ï¼š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="variable">$NAME</span></span><br></pre></td></tr></table></figure><ul><li><strong>åªè¯»å˜é‡</strong>ï¼š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">readonly</span> NAME</span><br></pre></td></tr></table></figure><ul><li><strong>ç¯å¢ƒå˜é‡</strong>ï¼š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:/new/path</span><br></pre></td></tr></table></figure><hr><h3 id="2-æ¡ä»¶åˆ¤æ–­"><a href="#2-æ¡ä»¶åˆ¤æ–­" class="headerlink" title="2. æ¡ä»¶åˆ¤æ–­"></a>2. æ¡ä»¶åˆ¤æ–­</h3><ul><li><strong>if è¯­å¥</strong>ï¼š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [ <span class="variable">$AGE</span> -ge 18 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;æˆå¹´äºº&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;æœªæˆå¹´äºº&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><ul><li><strong>å¸¸ç”¨æ¡ä»¶è¡¨è¾¾å¼</strong>ï¼š<table><thead><tr><th>è¡¨è¾¾å¼</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>-eq</code></td><td>ç­‰äº</td></tr><tr><td><code>-ne</code></td><td>ä¸ç­‰äº</td></tr><tr><td><code>-gt</code></td><td>å¤§äº</td></tr><tr><td><code>-lt</code></td><td>å°äº</td></tr><tr><td><code>-ge</code></td><td>å¤§äºç­‰äº</td></tr><tr><td><code>-le</code></td><td>å°äºç­‰äº</td></tr><tr><td><code>-f filename</code></td><td>æ–‡ä»¶å­˜åœ¨ä¸”ä¸ºæ™®é€šæ–‡ä»¶</td></tr><tr><td><code>-d dirname</code></td><td>ç›®å½•å­˜åœ¨</td></tr><tr><td><code>-x filename</code></td><td>å¯æ‰§è¡Œæ–‡ä»¶</td></tr></tbody></table></li></ul><hr><h3 id="3-å¾ªç¯è¯­å¥"><a href="#3-å¾ªç¯è¯­å¥" class="headerlink" title="3. å¾ªç¯è¯­å¥"></a>3. å¾ªç¯è¯­å¥</h3><ul><li><strong>for å¾ªç¯</strong>ï¼š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> 1 2 3 4 5; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;ç¬¬ <span class="variable">$i</span> æ¬¡å¾ªç¯&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><ul><li><strong>while å¾ªç¯</strong>ï¼š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">count=1</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$count</span> -le 5 ]; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;è®¡æ•° <span class="variable">$count</span>&quot;</span></span><br><span class="line">    count=$((count+<span class="number">1</span>))</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><ul><li><strong>until å¾ªç¯</strong>ï¼š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">count=1</span><br><span class="line"><span class="keyword">until</span> [ <span class="variable">$count</span> -gt 5 ]; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;è®¡æ•° <span class="variable">$count</span>&quot;</span></span><br><span class="line">    count=$((count+<span class="number">1</span>))</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><hr><h3 id="4-å‡½æ•°"><a href="#4-å‡½æ•°" class="headerlink" title="4. å‡½æ•°"></a>4. å‡½æ•°</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">greet</span></span>() &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Hello, <span class="variable">$1</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">greet <span class="string">&quot;Charlotte&quot;</span></span><br></pre></td></tr></table></figure><ul><li><code>$1</code> è¡¨ç¤ºå‡½æ•°ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°</li><li><code>$@</code> è¡¨ç¤ºæ‰€æœ‰å‚æ•°</li><li><code>return</code> è¿”å›çŠ¶æ€ç ï¼ˆ0è¡¨ç¤ºæˆåŠŸï¼Œé0è¡¨ç¤ºå¤±è´¥ï¼‰</li></ul><hr><h3 id="5-è¾“å…¥è¾“å‡º"><a href="#5-è¾“å…¥è¾“å‡º" class="headerlink" title="5. è¾“å…¥è¾“å‡º"></a>5. è¾“å…¥è¾“å‡º</h3><ul><li><strong>æ ‡å‡†è¾“å…¥&#x2F;è¾“å‡º&#x2F;é”™è¯¯</strong>ï¼š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Hello&quot;</span>         <span class="comment"># stdout</span></span><br><span class="line"><span class="built_in">read</span> name            <span class="comment"># stdin</span></span><br><span class="line"><span class="built_in">ls</span> nonexist 2&gt; error.log  <span class="comment"># stderré‡å®šå‘</span></span><br></pre></td></tr></table></figure><ul><li><strong>ç®¡é“ä¸é‡å®šå‘</strong>ï¼š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> file.txt | grep <span class="string">&quot;hello&quot;</span> &gt; result.txt</span><br></pre></td></tr></table></figure><hr><h3 id="6-è„šæœ¬æ‰§è¡Œæƒé™"><a href="#6-è„šæœ¬æ‰§è¡Œæƒé™" class="headerlink" title="6. è„šæœ¬æ‰§è¡Œæƒé™"></a>6. è„šæœ¬æ‰§è¡Œæƒé™</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x script.sh</span><br><span class="line">./script.sh</span><br></pre></td></tr></table></figure><hr><h3 id="7-å®ç”¨ç¤ºä¾‹"><a href="#7-å®ç”¨ç¤ºä¾‹" class="headerlink" title="7. å®ç”¨ç¤ºä¾‹"></a>7. å®ç”¨ç¤ºä¾‹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># ç»Ÿè®¡å½“å‰ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶æ•°</span></span><br><span class="line">count=$(<span class="built_in">ls</span> -l | grep <span class="string">&quot;^-&quot;</span> | <span class="built_in">wc</span> -l)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;å½“å‰ç›®å½•æ–‡ä»¶æ•°é‡: <span class="variable">$count</span>&quot;</span></span><br></pre></td></tr></table></figure><hr><h1 id="åä¸€ã€Linux-é¢è¯•å¸¸é—®çŸ¥è¯†ç‚¹ï¼ˆå…¨é¢ç‰ˆï¼‰"><a href="#åä¸€ã€Linux-é¢è¯•å¸¸é—®çŸ¥è¯†ç‚¹ï¼ˆå…¨é¢ç‰ˆï¼‰" class="headerlink" title="åä¸€ã€Linux é¢è¯•å¸¸é—®çŸ¥è¯†ç‚¹ï¼ˆå…¨é¢ç‰ˆï¼‰"></a><strong>åä¸€ã€Linux é¢è¯•å¸¸é—®çŸ¥è¯†ç‚¹ï¼ˆå…¨é¢ç‰ˆï¼‰</strong></h1><hr><h2 id="1-æ–‡ä»¶æƒé™ä¸æƒé™ç®¡ç†"><a href="#1-æ–‡ä»¶æƒé™ä¸æƒé™ç®¡ç†" class="headerlink" title="1. æ–‡ä»¶æƒé™ä¸æƒé™ç®¡ç†"></a><strong>1. æ–‡ä»¶æƒé™ä¸æƒé™ç®¡ç†</strong></h2><h3 id="æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼š"><a href="#æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼š" class="headerlink" title="æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼š"></a>æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼š</h3><ul><li><strong>æƒé™ç±»å‹</strong>ï¼šè¯»ï¼ˆrï¼‰ã€å†™ï¼ˆwï¼‰ã€æ‰§è¡Œï¼ˆxï¼‰</li><li><strong>ä¸‰ç±»ç”¨æˆ·</strong>ï¼š<ul><li>æ‹¥æœ‰è€…ï¼ˆuï¼‰</li><li>ç”¨æˆ·ç»„ï¼ˆgï¼‰</li><li>å…¶ä»–ç”¨æˆ·ï¼ˆoï¼‰</li></ul></li><li><strong>æƒé™è¡¨ç¤º</strong>ï¼š<ul><li>ç¬¦å·è¡¨ç¤ºæ³•ï¼š<code>rwxr-xr-x</code></li><li>æ•°å­—è¡¨ç¤ºæ³•ï¼š<code>chmod 755 file</code> â†’ 7&#x3D;rw, x; 5&#x3D;r-x; 5&#x3D;r-x</li></ul></li></ul><h3 id="é¢è¯•å¸¸é—®é—®é¢˜ï¼š"><a href="#é¢è¯•å¸¸é—®é—®é¢˜ï¼š" class="headerlink" title="é¢è¯•å¸¸é—®é—®é¢˜ï¼š"></a>é¢è¯•å¸¸é—®é—®é¢˜ï¼š</h3><ol><li><p><strong>å‘½ä»¤ chmodã€chownã€chgrp æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</strong></p><ul><li><code>chmod</code>ï¼šä¿®æ”¹æƒé™</li><li><code>chown</code>ï¼šä¿®æ”¹æ–‡ä»¶æ‰€æœ‰è€…</li><li><code>chgrp</code>ï¼šä¿®æ”¹æ–‡ä»¶æ‰€å±ç»„</li></ul></li><li><p><strong>ç¡¬é“¾æ¥å’Œè½¯é“¾æ¥åŒºåˆ«ï¼Ÿ</strong></p><table><thead><tr><th>é¡¹ç›®</th><th>ç¡¬é“¾æ¥</th><th>è½¯é“¾æ¥</th></tr></thead><tbody><tr><td>inode</td><td>ç›¸åŒ</td><td>ä¸åŒ</td></tr><tr><td>è·¨åˆ†åŒº</td><td>ä¸è¡Œ</td><td>å¯ä»¥</td></tr><tr><td>åˆ é™¤åŸæ–‡ä»¶</td><td>å†…å®¹ä»å­˜åœ¨</td><td>é“¾æ¥å¤±æ•ˆ</td></tr><tr><td>å‘½ä»¤</td><td><code>ln source target</code></td><td><code>ln -s source target</code></td></tr></tbody></table></li><li><p><strong>æ–‡ä»¶æè¿°ç¬¦å’Œé‡å®šå‘</strong></p><ul><li><code>0</code> stdin, <code>1</code> stdout, <code>2</code> stderr</li><li>ç¤ºä¾‹ï¼š<code>command &gt; out.log 2&gt;&amp;1</code> â†’ stdout å’Œ stderr éƒ½å†™å…¥ out.log</li></ul></li></ol><hr><h2 id="2-è¿›ç¨‹ä¸ä½œä¸šç®¡ç†"><a href="#2-è¿›ç¨‹ä¸ä½œä¸šç®¡ç†" class="headerlink" title="2. è¿›ç¨‹ä¸ä½œä¸šç®¡ç†"></a><strong>2. è¿›ç¨‹ä¸ä½œä¸šç®¡ç†</strong></h2><h3 id="æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼š-1"><a href="#æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼š-1" class="headerlink" title="æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼š"></a>æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼š</h3><ul><li><strong>æŸ¥çœ‹è¿›ç¨‹</strong>ï¼š<ul><li><code>ps aux</code>ã€<code>top</code>ã€<code>htop</code></li></ul></li><li><strong>ç»“æŸè¿›ç¨‹</strong>ï¼š<ul><li><code>kill PID</code>ã€<code>kill -9 PID</code>ã€<code>killall process_name</code></li></ul></li><li><strong>åå°&#x2F;å‰å°ä»»åŠ¡</strong>ï¼š<ul><li><code>&amp;</code>ï¼šåå°æ‰§è¡Œ</li><li><code>jobs</code>ï¼šæŸ¥çœ‹åå°ä»»åŠ¡</li><li><code>fg %1</code>ï¼šåˆ‡æ¢åˆ°å‰å°</li></ul></li><li><strong>ä¼˜å…ˆçº§</strong>ï¼š<ul><li><code>nice</code>ã€<code>renice</code> è®¾ç½® CPU ä¼˜å…ˆçº§</li></ul></li></ul><h3 id="é¢è¯•å¸¸é—®é—®é¢˜ï¼š-1"><a href="#é¢è¯•å¸¸é—®é—®é¢˜ï¼š-1" class="headerlink" title="é¢è¯•å¸¸é—®é—®é¢˜ï¼š"></a>é¢è¯•å¸¸é—®é—®é¢˜ï¼š</h3><ol><li><p><strong>å¦‚ä½•æŸ¥çœ‹ç«¯å£è¢«å“ªä¸ªè¿›ç¨‹å ç”¨ï¼Ÿ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lsof -i :8080</span><br><span class="line">netstat -tulpn | grep 8080</span><br><span class="line">ss -tulpn | grep 8080</span><br></pre></td></tr></table></figure></li><li><p><strong>å¦‚ä½•ç»ˆæ­¢å ç”¨ç«¯å£çš„è¿›ç¨‹ï¼Ÿ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">kill</span> -9 PID</span><br></pre></td></tr></table></figure></li></ol><hr><h2 id="3-æ–‡ä»¶ç³»ç»Ÿä¸ç£ç›˜ç®¡ç†"><a href="#3-æ–‡ä»¶ç³»ç»Ÿä¸ç£ç›˜ç®¡ç†" class="headerlink" title="3. æ–‡ä»¶ç³»ç»Ÿä¸ç£ç›˜ç®¡ç†"></a><strong>3. æ–‡ä»¶ç³»ç»Ÿä¸ç£ç›˜ç®¡ç†</strong></h2><h3 id="æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼š-2"><a href="#æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼š-2" class="headerlink" title="æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼š"></a>æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼š</h3><ul><li><code>df -h</code> æŸ¥çœ‹ç£ç›˜ç©ºé—´</li><li><code>du -h</code> æŸ¥çœ‹ç›®å½•å¤§å°</li><li><code>lsblk</code> æŸ¥çœ‹åˆ†åŒºä¿¡æ¯</li><li><code>mount / umount</code> æŒ‚è½½å¸è½½</li><li><code>fdisk / parted</code> åˆ†åŒº</li><li><code>mkfs</code> æ ¼å¼åŒ–æ–‡ä»¶ç³»ç»Ÿ</li><li><code>fsck</code> æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿ</li></ul><h3 id="é¢è¯•å¸¸é—®é—®é¢˜ï¼š-2"><a href="#é¢è¯•å¸¸é—®é—®é¢˜ï¼š-2" class="headerlink" title="é¢è¯•å¸¸é—®é—®é¢˜ï¼š"></a>é¢è¯•å¸¸é—®é—®é¢˜ï¼š</h3><ol><li><p><strong>ç¡¬é“¾æ¥å’Œè½¯é“¾æ¥åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></p></li><li><p><strong>å¦‚ä½•æŸ¥çœ‹ç£ç›˜ç©ºé—´å’Œä½¿ç”¨æƒ…å†µï¼Ÿ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">df</span> -h</span><br><span class="line"><span class="built_in">du</span> -sh /path/to/dir</span><br></pre></td></tr></table></figure></li></ol><hr><h2 id="4-ç½‘ç»œç®¡ç†"><a href="#4-ç½‘ç»œç®¡ç†" class="headerlink" title="4. ç½‘ç»œç®¡ç†"></a><strong>4. ç½‘ç»œç®¡ç†</strong></h2><h3 id="æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼š-3"><a href="#æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼š-3" class="headerlink" title="æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼š"></a>æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼š</h3><ul><li>æŸ¥çœ‹ IP åœ°å€ï¼š<code>ifconfig</code> &#x2F; <code>ip addr</code></li><li>æµ‹è¯•è¿é€šæ€§ï¼š<code>ping</code></li><li>è·¯ç”±è¿½è¸ªï¼š<code>traceroute</code> &#x2F; <code>tracepath</code></li><li>æŸ¥çœ‹ç«¯å£å’Œè¿æ¥ï¼š<code>netstat</code> &#x2F; <code>ss</code></li><li>ä¸‹è½½æ–‡ä»¶æˆ–è¯·æ±‚ URLï¼š<code>wget</code> &#x2F; <code>curl</code></li><li>è¿œç¨‹æ–‡ä»¶ä¼ è¾“ï¼š<code>scp</code> &#x2F; <code>rsync</code></li></ul><h3 id="é¢è¯•å¸¸é—®é—®é¢˜ï¼š-3"><a href="#é¢è¯•å¸¸é—®é—®é¢˜ï¼š-3" class="headerlink" title="é¢è¯•å¸¸é—®é—®é¢˜ï¼š"></a>é¢è¯•å¸¸é—®é—®é¢˜ï¼š</h3><ol><li><p><strong>å¦‚ä½•æŸ¥çœ‹ç½‘å¡ä¿¡æ¯ï¼Ÿ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ip addr show</span><br><span class="line">ifconfig -a</span><br></pre></td></tr></table></figure></li><li><p><strong>å¦‚ä½•è°ƒè¯•ç½‘ç»œè¿é€šæ€§ï¼Ÿ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ping 8.8.8.8</span><br><span class="line">traceroute www.baidu.com</span><br></pre></td></tr></table></figure></li><li><p><strong>å¦‚ä½•æŸ¥çœ‹ 8080 ç«¯å£å ç”¨ï¼Ÿ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ss -tulpn | grep 8080</span><br></pre></td></tr></table></figure></li></ol><hr><h2 id="5-ç”¨æˆ·ä¸ç»„ç®¡ç†"><a href="#5-ç”¨æˆ·ä¸ç»„ç®¡ç†" class="headerlink" title="5. ç”¨æˆ·ä¸ç»„ç®¡ç†"></a><strong>5. ç”¨æˆ·ä¸ç»„ç®¡ç†</strong></h2><h3 id="æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼š-4"><a href="#æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼š-4" class="headerlink" title="æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼š"></a>æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼š</h3><ul><li>æ·»åŠ ç”¨æˆ·ï¼š<code>useradd</code></li><li>åˆ é™¤ç”¨æˆ·ï¼š<code>userdel</code></li><li>ä¿®æ”¹ç”¨æˆ·ï¼š<code>usermod -aG group user</code></li><li>ä¿®æ”¹å¯†ç ï¼š<code>passwd user</code></li><li>æŸ¥çœ‹ç»„ä¿¡æ¯ï¼š<code>groups user</code></li><li>ææƒå‘½ä»¤ï¼š<code>sudo command</code></li></ul><h3 id="é¢è¯•å¸¸é—®é—®é¢˜ï¼š-4"><a href="#é¢è¯•å¸¸é—®é—®é¢˜ï¼š-4" class="headerlink" title="é¢è¯•å¸¸é—®é—®é¢˜ï¼š"></a>é¢è¯•å¸¸é—®é—®é¢˜ï¼š</h3><ol><li><p><strong>å¦‚ä½•ç»™ç”¨æˆ·åŠ å…¥æŸä¸ªç»„ï¼Ÿ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">usermod -aG dev user</span><br></pre></td></tr></table></figure></li><li><p><strong>å¦‚ä½•é™åˆ¶ç”¨æˆ·æƒé™ï¼Ÿ</strong></p><ul><li>ä½¿ç”¨ <code>chmod</code> è®¾ç½®æ–‡ä»¶æƒé™</li><li>ä½¿ç”¨ <code>sudoers</code> é…ç½®å‘½ä»¤æƒé™</li></ul></li></ol><hr><h2 id="6-Shell-è„šæœ¬åŸºç¡€"><a href="#6-Shell-è„šæœ¬åŸºç¡€" class="headerlink" title="6. Shell è„šæœ¬åŸºç¡€"></a><strong>6. Shell è„šæœ¬åŸºç¡€</strong></h2><h3 id="æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼š-5"><a href="#æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼š-5" class="headerlink" title="æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼š"></a>æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼š</h3><ul><li>å˜é‡ã€æ¡ä»¶åˆ¤æ–­ã€å¾ªç¯ã€å‡½æ•°</li><li>ç®¡é“ã€é‡å®šå‘ã€æ ‡å‡†è¾“å…¥è¾“å‡º</li><li>å¸¸ç”¨è„šæœ¬ç¤ºä¾‹ï¼š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> *.<span class="built_in">log</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;å¤„ç†æ–‡ä»¶: <span class="variable">$file</span>&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h3 id="é¢è¯•å¸¸é—®é—®é¢˜ï¼š-5"><a href="#é¢è¯•å¸¸é—®é—®é¢˜ï¼š-5" class="headerlink" title="é¢è¯•å¸¸é—®é—®é¢˜ï¼š"></a>é¢è¯•å¸¸é—®é—®é¢˜ï¼š</h3><ol><li><strong>å¦‚ä½•åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Ÿ</strong></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [ -f <span class="string">&quot;/path/to/file&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;æ–‡ä»¶å­˜åœ¨&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><ol><li><strong>å¦‚ä½•ç»Ÿè®¡ç›®å½•ä¸‹æ–‡ä»¶æ•°é‡ï¼Ÿ</strong></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">count=$(<span class="built_in">ls</span> -l | grep <span class="string">&quot;^-&quot;</span> | <span class="built_in">wc</span> -l)</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$count</span></span><br></pre></td></tr></table></figure><hr><h2 id="7-å®šæ—¶ä»»åŠ¡ï¼ˆCrontabï¼‰"><a href="#7-å®šæ—¶ä»»åŠ¡ï¼ˆCrontabï¼‰" class="headerlink" title="7. å®šæ—¶ä»»åŠ¡ï¼ˆCrontabï¼‰"></a><strong>7. å®šæ—¶ä»»åŠ¡ï¼ˆCrontabï¼‰</strong></h2><h3 id="æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼š-6"><a href="#æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼š-6" class="headerlink" title="æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼š"></a>æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼š</h3><ul><li>æŸ¥çœ‹ï¼š<code>crontab -l</code></li><li>ç¼–è¾‘ï¼š<code>crontab -e</code></li><li>æ—¶é—´æ ¼å¼ï¼š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">* * * * * <span class="built_in">command</span></span><br><span class="line">åˆ† æ—¶ æ—¥ æœˆ æ˜ŸæœŸ</span><br></pre></td></tr></table></figure><ul><li>ç¤ºä¾‹ï¼šæ¯å¤©å‡Œæ™¨ 2 ç‚¹å¤‡ä»½</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 2 * * * /home/user/backup.sh</span><br></pre></td></tr></table></figure><hr><h2 id="8-ç³»ç»Ÿæ—¥å¿—"><a href="#8-ç³»ç»Ÿæ—¥å¿—" class="headerlink" title="8. ç³»ç»Ÿæ—¥å¿—"></a><strong>8. ç³»ç»Ÿæ—¥å¿—</strong></h2><h3 id="æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼š-7"><a href="#æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼š-7" class="headerlink" title="æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼š"></a>æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼š</h3><ul><li>å¸¸ç”¨æ—¥å¿—è·¯å¾„ï¼š<table><thead><tr><th>æ–‡ä»¶</th><th>å†…å®¹</th></tr></thead><tbody><tr><td><code>/var/log/messages</code></td><td>ç³»ç»Ÿäº‹ä»¶</td></tr><tr><td><code>/var/log/syslog</code></td><td>ç³»ç»ŸæœåŠ¡æ—¥å¿—</td></tr><tr><td><code>/var/log/auth.log</code></td><td>ç™»å½•&#x2F;è®¤è¯æ—¥å¿—</td></tr><tr><td><code>/var/log/kern.log</code></td><td>å†…æ ¸æ—¥å¿—</td></tr><tr><td><code>journalctl</code></td><td>systemd æ—¥å¿—</td></tr></tbody></table></li><li>æŸ¥çœ‹æ—¥å¿—ï¼š</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tail -f /var/log/syslog</span><br><span class="line">journalctl -xe</span><br></pre></td></tr></table></figure><hr><h2 id="9-ç³»ç»Ÿç®¡ç†"><a href="#9-ç³»ç»Ÿç®¡ç†" class="headerlink" title="9. ç³»ç»Ÿç®¡ç†"></a><strong>9. ç³»ç»Ÿç®¡ç†</strong></h2><h3 id="æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼š-8"><a href="#æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼š-8" class="headerlink" title="æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼š"></a>æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼š</h3><ul><li>ç³»ç»Ÿä¿¡æ¯ï¼š<code>uname -a</code></li><li>å†…å­˜æŸ¥çœ‹ï¼š<code>free -h</code></li><li>CPU&#x2F;èµ„æºç»Ÿè®¡ï¼š<code>top</code> &#x2F; <code>vmstat</code></li><li>æœåŠ¡ç®¡ç†ï¼š<code>systemctl start/stop/restart/status service</code></li><li>ç³»ç»Ÿå¯åŠ¨æµç¨‹ï¼šBIOS â†’ Bootloader â†’ Kernel â†’ init&#x2F;systemd â†’ å¤šç”¨æˆ·æ¨¡å¼</li></ul><h3 id="é¢è¯•å¸¸é—®é—®é¢˜ï¼š-6"><a href="#é¢è¯•å¸¸é—®é—®é¢˜ï¼š-6" class="headerlink" title="é¢è¯•å¸¸é—®é—®é¢˜ï¼š"></a>é¢è¯•å¸¸é—®é—®é¢˜ï¼š</h3><ol><li><strong>å¦‚ä½•æŸ¥çœ‹ç³»ç»Ÿè¿è¡Œæ—¶é—´ï¼Ÿ</strong></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shelluptime</span><br></pre></td></tr></table></figure><ol><li><strong>å¦‚ä½•ç®¡ç†ç³»ç»ŸæœåŠ¡ï¼Ÿ</strong></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart nginx</span><br><span class="line">systemctl enable nginx</span><br><span class="line">systemctl status nginx</span><br></pre></td></tr></table></figure><hr><h2 id="10-ç»¼åˆç¤ºä¾‹ï¼ˆé¢è¯•é¢˜ï¼‰"><a href="#10-ç»¼åˆç¤ºä¾‹ï¼ˆé¢è¯•é¢˜ï¼‰" class="headerlink" title="10. ç»¼åˆç¤ºä¾‹ï¼ˆé¢è¯•é¢˜ï¼‰"></a><strong>10. ç»¼åˆç¤ºä¾‹ï¼ˆé¢è¯•é¢˜ï¼‰</strong></h2><ol><li><strong>å¦‚ä½•æŸ¥æ‰¾å ç”¨ CPU å‰ 5 çš„è¿›ç¨‹ï¼Ÿ</strong></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps aux --sort=-%cpu | head -n 6</span><br></pre></td></tr></table></figure><p>   2.<strong>å¦‚ä½•æŸ¥æ‰¾ 1 å°æ—¶å†…ä¿®æ”¹è¿‡çš„æ–‡ä»¶ï¼Ÿ</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /path/to/dir -type f -mmin -60</span><br></pre></td></tr></table></figure><p>   3.<strong>å¦‚ä½•å°†é”™è¯¯æ—¥å¿—å’Œè¾“å‡ºæ—¥å¿—å†™å…¥åŒä¸€ä¸ªæ–‡ä»¶ï¼Ÿ</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">command &gt; all.log 2&gt;&amp;1</span><br></pre></td></tr></table></figure><p>   4.<strong>å¦‚ä½•ç»™ç”¨æˆ·æ·»åŠ  sudo æƒé™ï¼Ÿ</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">usermod -aG sudo username</span><br></pre></td></tr></table></figure><hr><h1 id="MySQL-æ•°æ®åº“"><a href="#MySQL-æ•°æ®åº“" class="headerlink" title="MySQL æ•°æ®åº“"></a>MySQL æ•°æ®åº“</h1><h2 id="SQLè¯­å¥"><a href="#SQLè¯­å¥" class="headerlink" title="SQLè¯­å¥"></a>SQLè¯­å¥</h2><h2 id="1-DML-Data-Manipulation-Language-â€”-æ•°æ®æ“ä½œ"><a href="#1-DML-Data-Manipulation-Language-â€”-æ•°æ®æ“ä½œ" class="headerlink" title="1. DML (Data Manipulation Language) â€” æ•°æ®æ“ä½œ"></a>1. DML (Data Manipulation Language) â€” æ•°æ®æ“ä½œ</h2><p>ç”¨äºæ“ä½œæ•°æ®åº“ä¸­çš„æ•°æ®ã€‚</p><h3 id="1-1-SELECT-æŸ¥è¯¢"><a href="#1-1-SELECT-æŸ¥è¯¢" class="headerlink" title="1.1 SELECT æŸ¥è¯¢"></a>1.1 SELECT æŸ¥è¯¢</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-- æŸ¥è¯¢æŒ‡å®šåˆ—ï¼Œå¹¶å¯¹ç»“æœæ’åºã€åˆ†é¡µ</span><br><span class="line">SELECT column1, column2</span><br><span class="line">FROM table_name</span><br><span class="line">WHERE condition         -- è¿‡æ»¤æ¡ä»¶</span><br><span class="line">ORDER BY column DESC    -- æŒ‰åˆ—æ’åºï¼Œå¯ ASC æˆ– DESC</span><br><span class="line">LIMIT offset, count;    -- åˆ†é¡µæŸ¥è¯¢ï¼Œoffset: åç§»é‡, count: è¿”å›è¡Œæ•°</span><br></pre></td></tr></table></figure><h4 id="èšåˆå‡½æ•°"><a href="#èšåˆå‡½æ•°" class="headerlink" title="èšåˆå‡½æ•°"></a>èšåˆå‡½æ•°</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT COUNT(*), SUM(column), AVG(column), MAX(column), MIN(column)</span><br><span class="line">FROM table_name</span><br><span class="line">WHERE condition;</span><br></pre></td></tr></table></figure><h4 id="åˆ†ç»„æŸ¥è¯¢"><a href="#åˆ†ç»„æŸ¥è¯¢" class="headerlink" title="åˆ†ç»„æŸ¥è¯¢"></a>åˆ†ç»„æŸ¥è¯¢</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT column, COUNT(*)</span><br><span class="line">FROM table_name</span><br><span class="line">GROUP BY column       -- æŒ‰ column åˆ†ç»„</span><br><span class="line">HAVING COUNT(*) &gt; 1; -- åˆ†ç»„è¿‡æ»¤</span><br></pre></td></tr></table></figure><h4 id="è”æ¥æŸ¥è¯¢-JOIN"><a href="#è”æ¥æŸ¥è¯¢-JOIN" class="headerlink" title="è”æ¥æŸ¥è¯¢ (JOIN)"></a>è”æ¥æŸ¥è¯¢ (JOIN)</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">-- å†…è¿æ¥ï¼Œåªè¿”å›ä¸¤ä¸ªè¡¨ä¸­åŒ¹é…çš„è¡Œ</span><br><span class="line">SELECT a.*, b.*</span><br><span class="line">FROM table_a a</span><br><span class="line">INNER JOIN table_b b ON a.id = b.a_id;</span><br><span class="line"></span><br><span class="line">-- å·¦è¿æ¥ï¼Œè¿”å›å·¦è¡¨æ‰€æœ‰è¡ŒåŠåŒ¹é…å³è¡¨çš„è¡Œ</span><br><span class="line">SELECT a.*, b.*</span><br><span class="line">FROM table_a a</span><br><span class="line">LEFT JOIN table_b b ON a.id = b.a_id;</span><br><span class="line"></span><br><span class="line">-- å³è¿æ¥ï¼Œè¿”å›å³è¡¨æ‰€æœ‰è¡ŒåŠåŒ¹é…å·¦è¡¨çš„è¡Œ</span><br><span class="line">SELECT a.*, b.*</span><br><span class="line">FROM table_a a</span><br><span class="line">RIGHT JOIN table_b b ON a.id = b.a_id;</span><br><span class="line"></span><br><span class="line">-- å…¨è¿æ¥ (MySQL ä¸ç›´æ¥æ”¯æŒï¼Œç”¨ UNION ALL æ¨¡æ‹Ÿ)</span><br><span class="line">SELECT a.*, b.*</span><br><span class="line">FROM table_a a</span><br><span class="line">LEFT JOIN table_b b ON a.id = b.a_id</span><br><span class="line">UNION ALL</span><br><span class="line">SELECT a.*, b.*</span><br><span class="line">FROM table_a a</span><br><span class="line">RIGHT JOIN table_b b ON a.id = b.a_id</span><br><span class="line">WHERE a.id IS NULL;</span><br></pre></td></tr></table></figure><hr><h3 id="1-2-INSERT-æ’å…¥"><a href="#1-2-INSERT-æ’å…¥" class="headerlink" title="1.2 INSERT æ’å…¥"></a>1.2 INSERT æ’å…¥</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-- æŒ‡å®šåˆ—æ’å…¥</span><br><span class="line">INSERT INTO table_name (column1, column2)</span><br><span class="line">VALUES (value1, value2);</span><br><span class="line"></span><br><span class="line">-- æ’å…¥æ‰€æœ‰åˆ—</span><br><span class="line">INSERT INTO table_name</span><br><span class="line">VALUES (value1, value2, ...);</span><br></pre></td></tr></table></figure><hr><h3 id="1-3-UPDATE-æ›´æ–°"><a href="#1-3-UPDATE-æ›´æ–°" class="headerlink" title="1.3 UPDATE æ›´æ–°"></a>1.3 UPDATE æ›´æ–°</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">UPDATE table_name</span><br><span class="line">SET column1 = value1,</span><br><span class="line">    column2 = value2</span><br><span class="line">WHERE condition;  -- å¿…é¡»åŠ  WHEREï¼Œå¦åˆ™ä¼šæ›´æ–°æ‰€æœ‰è¡Œ</span><br></pre></td></tr></table></figure><hr><h3 id="1-4-DELETE-åˆ é™¤"><a href="#1-4-DELETE-åˆ é™¤" class="headerlink" title="1.4 DELETE åˆ é™¤"></a>1.4 DELETE åˆ é™¤</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DELETE FROM table_name</span><br><span class="line">WHERE condition; -- ä¸åŠ  WHERE ä¼šåˆ é™¤æ‰€æœ‰è¡Œï¼Œæ¯” TRUNCATE TABLE æ…¢</span><br></pre></td></tr></table></figure><hr><h2 id="2-DDL-Data-Definition-Language-â€”-æ•°æ®å®šä¹‰"><a href="#2-DDL-Data-Definition-Language-â€”-æ•°æ®å®šä¹‰" class="headerlink" title="2. DDL (Data Definition Language) â€” æ•°æ®å®šä¹‰"></a>2. DDL (Data Definition Language) â€” æ•°æ®å®šä¹‰</h2><p>ç”¨äºåˆ›å»ºã€ä¿®æ”¹å’Œåˆ é™¤æ•°æ®åº“å¯¹è±¡ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">-- åˆ›å»ºæ•°æ®åº“</span><br><span class="line">CREATE DATABASE database_name;</span><br><span class="line"></span><br><span class="line">-- åˆ›å»ºè¡¨</span><br><span class="line">CREATE TABLE table_name (</span><br><span class="line">    column1 datatype constraints,</span><br><span class="line">    column2 datatype constraints,</span><br><span class="line">    PRIMARY KEY (column_name)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">-- ä¿®æ”¹è¡¨ç»“æ„</span><br><span class="line">ALTER TABLE table_name ADD column_name datatype;</span><br><span class="line">ALTER TABLE table_name DROP COLUMN column_name;</span><br><span class="line">ALTER TABLE table_name MODIFY COLUMN column_name datatype;</span><br><span class="line"></span><br><span class="line">-- åˆ é™¤è¡¨</span><br><span class="line">DROP TABLE table_name;</span><br><span class="line"></span><br><span class="line">-- ç´¢å¼•æ“ä½œ</span><br><span class="line">CREATE INDEX index_name ON table_name (column_name);</span><br><span class="line">DROP INDEX index_name ON table_name;</span><br></pre></td></tr></table></figure><hr><h2 id="3-DCL-Data-Control-Language-â€”-æ•°æ®æƒé™æ§åˆ¶"><a href="#3-DCL-Data-Control-Language-â€”-æ•°æ®æƒé™æ§åˆ¶" class="headerlink" title="3. DCL (Data Control Language) â€” æ•°æ®æƒé™æ§åˆ¶"></a>3. DCL (Data Control Language) â€” æ•°æ®æƒé™æ§åˆ¶</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-- æˆæƒ</span><br><span class="line">GRANT privileges ON database.table TO &#x27;user&#x27;@&#x27;host&#x27;;</span><br><span class="line"></span><br><span class="line">-- æ’¤é”€æƒé™</span><br><span class="line">REVOKE privileges ON database.table FROM &#x27;user&#x27;@&#x27;host&#x27;;</span><br></pre></td></tr></table></figure><hr><h2 id="4-TCL-Transaction-Control-Language-â€”-äº‹åŠ¡æ§åˆ¶"><a href="#4-TCL-Transaction-Control-Language-â€”-äº‹åŠ¡æ§åˆ¶" class="headerlink" title="4. TCL (Transaction Control Language) â€” äº‹åŠ¡æ§åˆ¶"></a>4. TCL (Transaction Control Language) â€” äº‹åŠ¡æ§åˆ¶</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">-- å¼€å§‹äº‹åŠ¡</span><br><span class="line">START TRANSACTION; -- æˆ– BEGIN;</span><br><span class="line"></span><br><span class="line">-- æäº¤äº‹åŠ¡</span><br><span class="line">COMMIT;</span><br><span class="line"></span><br><span class="line">-- å›æ»šäº‹åŠ¡</span><br><span class="line">ROLLBACK;</span><br><span class="line"></span><br><span class="line">-- è®¾ç½®ä¿å­˜ç‚¹</span><br><span class="line">SAVEPOINT savepoint_name;</span><br></pre></td></tr></table></figure><hr><h2 id="5-EXPLAIN-æŸ¥è¯¢åˆ†æ-â€”-SQL-ä¼˜åŒ–æ ¸å¿ƒå·¥å…·"><a href="#5-EXPLAIN-æŸ¥è¯¢åˆ†æ-â€”-SQL-ä¼˜åŒ–æ ¸å¿ƒå·¥å…·" class="headerlink" title="5. EXPLAIN æŸ¥è¯¢åˆ†æ â€” SQL ä¼˜åŒ–æ ¸å¿ƒå·¥å…·"></a>5. EXPLAIN æŸ¥è¯¢åˆ†æ â€” SQL ä¼˜åŒ–æ ¸å¿ƒå·¥å…·</h2><p>ç”¨äºåˆ†æ SELECTï¼ˆæˆ– DMLï¼‰è¯­å¥çš„æ‰§è¡Œè®¡åˆ’ï¼Œåˆ¤æ–­æ˜¯å¦ä½¿ç”¨ç´¢å¼•ï¼Œä»¥åŠä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT * FROM table_name WHERE condition;</span><br></pre></td></tr></table></figure><h3 id="5-1-EXPLAIN-æ ¸å¿ƒå­—æ®µè§£æ"><a href="#5-1-EXPLAIN-æ ¸å¿ƒå­—æ®µè§£æ" class="headerlink" title="5.1 EXPLAIN æ ¸å¿ƒå­—æ®µè§£æ"></a>5.1 EXPLAIN æ ¸å¿ƒå­—æ®µè§£æ</h3><table><thead><tr><th>å­—æ®µ</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>id</td><td>æŸ¥è¯¢åºåˆ—å·ï¼Œè¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ï¼›ç›¸åŒ id æŒ‰é¡ºåºæ‰§è¡Œã€‚</td></tr><tr><td>select_type</td><td>æŸ¥è¯¢ç±»å‹ï¼šSIMPLE, PRIMARY, SUBQUERY, DEPENDENT SUBQUERY, UNION, DERIVED ç­‰ã€‚</td></tr><tr><td>table</td><td>æ­£åœ¨è®¿é—®çš„è¡¨åã€‚</td></tr><tr><td>partitions</td><td>åŒ¹é…çš„åˆ†åŒºä¿¡æ¯ï¼ˆå¦‚æœæœ‰åˆ†åŒºè¡¨ï¼‰ã€‚</td></tr><tr><td>type</td><td>è¿æ¥ç±»å‹&#x2F;è®¿é—®æ–¹å¼ï¼Œæ€§èƒ½ä»å¥½åˆ°å·®ï¼šsystem â†’ const â†’ eq_ref â†’ ref â†’ range â†’ index â†’ ALLã€‚</td></tr><tr><td>possible_keys</td><td>æŸ¥è¯¢å¯èƒ½ä½¿ç”¨çš„ç´¢å¼•ã€‚</td></tr><tr><td>key</td><td>å®é™…ä½¿ç”¨çš„ç´¢å¼•ï¼ŒNULL è¡¨ç¤ºæœªä½¿ç”¨ç´¢å¼•ã€‚</td></tr><tr><td>key_len</td><td>ä½¿ç”¨çš„ç´¢å¼•é•¿åº¦ï¼ˆå­—èŠ‚ï¼‰ï¼Œè¶ŠçŸ­è¶Šå¥½ã€‚</td></tr><tr><td>ref</td><td>è¡¨ç¤ºç´¢å¼•åˆ—ä¸å“ªä¸ªåˆ—æˆ–å¸¸é‡è¿›è¡Œæ¯”è¾ƒã€‚</td></tr><tr><td>rows</td><td>MySQL ä¼°è®¡è¦æ‰«æçš„è¡Œæ•°ï¼Œè¶Šå°‘è¶Šå¥½ã€‚</td></tr><tr><td>filtered</td><td>WHERE æ¡ä»¶è¿‡æ»¤è¡Œçš„ç™¾åˆ†æ¯”ï¼Œè¶Šé«˜è¶Šå¥½ã€‚</td></tr><tr><td>Extra</td><td>é¢å¤–ä¿¡æ¯ï¼Œé‡è¦ä¼˜åŒ–æŒ‡æ ‡ï¼š- <code>Using filesort</code>ï¼šéœ€è¦é¢å¤–æ’åºã€‚- <code>Using temporary</code>ï¼šéœ€è¦ä¸´æ—¶è¡¨å¤„ç†ã€‚- <code>Using index</code>ï¼šä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼ŒæŸ¥è¯¢æ•ˆç‡é«˜ã€‚- <code>Using where</code>ï¼šä½¿ç”¨ WHERE æ¡ä»¶è¿‡æ»¤ã€‚- <code>Using index condition</code>ï¼šç´¢å¼•æ¡ä»¶ä¸‹æ¨ï¼ˆICPï¼‰ã€‚- <code>Using join buffer</code>ï¼šè¿æ¥æŸ¥è¯¢æœªç”¨ç´¢å¼•ï¼Œä½¿ç”¨ç¼“å­˜ä¼˜åŒ–ã€‚</td></tr></tbody></table><hr><h3 id="5-2-type-ç±»å‹è¯´æ˜ï¼ˆè®¿é—®æ–¹å¼ï¼‰"><a href="#5-2-type-ç±»å‹è¯´æ˜ï¼ˆè®¿é—®æ–¹å¼ï¼‰" class="headerlink" title="5.2 type ç±»å‹è¯´æ˜ï¼ˆè®¿é—®æ–¹å¼ï¼‰"></a>5.2 type ç±»å‹è¯´æ˜ï¼ˆè®¿é—®æ–¹å¼ï¼‰</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">system  : è¡¨ä¸­åªæœ‰ä¸€è¡Œè®°å½•ï¼Œæ€§èƒ½æé«˜</span><br><span class="line">const   : é€šè¿‡ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•æŸ¥æ‰¾ï¼Œæœ€å¤šä¸€è¡Œ</span><br><span class="line">eq_ref   : å¯¹å‰è¡¨æ¯è¡Œç»„åˆè¯»å–ä¸€è¡Œï¼Œç”¨äºä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•è¿æ¥</span><br><span class="line">ref      : éå”¯ä¸€ç´¢å¼•ç­‰å€¼æŸ¥æ‰¾ï¼Œå¯èƒ½å¤šè¡Œ</span><br><span class="line">range    : èŒƒå›´æŸ¥æ‰¾ï¼Œä½¿ç”¨ç´¢å¼•</span><br><span class="line">index    : å…¨ç´¢å¼•æ‰«æï¼Œä¼˜äºå…¨è¡¨æ‰«æ</span><br><span class="line">ALL      : å…¨è¡¨æ‰«æï¼Œæ€§èƒ½æœ€å·®</span><br></pre></td></tr></table></figure><hr><h3 id="5-3-ä¼˜åŒ–å»ºè®®"><a href="#5-3-ä¼˜åŒ–å»ºè®®" class="headerlink" title="5.3 ä¼˜åŒ–å»ºè®®"></a>5.3 ä¼˜åŒ–å»ºè®®</h3><ol><li>å°½é‡ä½¿ç”¨ç´¢å¼•ï¼Œé¿å… <code>ALL</code> ç±»å‹ã€‚</li><li>ORDER BY &#x2F; GROUP BY å°½é‡ä½¿ç”¨ç´¢å¼•åˆ—ï¼Œé¿å… <code>Using filesort</code> æˆ– <code>Using temporary</code>ã€‚</li><li>è¦†ç›–ç´¢å¼•ï¼ˆ<code>Using index</code>ï¼‰èƒ½æ˜¾è‘—æé«˜æ€§èƒ½ã€‚</li><li>å¯¹å¤æ‚æŸ¥è¯¢ï¼Œä½¿ç”¨ EXPLAIN åˆ†æå¹¶è°ƒæ•´ç´¢å¼•æˆ– SQL ç»“æ„ã€‚</li><li>å¯¹ JOIN æŸ¥è¯¢ï¼Œä¿è¯è¿æ¥å­—æ®µæœ‰ç´¢å¼•ã€‚</li></ol><hr><h2 id="äº‹åŠ¡-Transaction"><a href="#äº‹åŠ¡-Transaction" class="headerlink" title="äº‹åŠ¡ (Transaction)"></a>äº‹åŠ¡ (Transaction)</h2><p>äº‹åŠ¡æ˜¯ä¸€ç»„æ“ä½œçš„é›†åˆï¼Œè¿™äº›æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚å®ƒå…·æœ‰å››å¤§ç‰¹æ€§ (ACID)ã€‚</p><ul><li><strong>ACID ç‰¹æ€§ï¼š</strong><ol><li><strong>åŸå­æ€§ (Atomicity)</strong>: äº‹åŠ¡æ˜¯æœ€å°çš„æ‰§è¡Œå•ä½ï¼Œä¸å¯å†åˆ†å‰²ã€‚äº‹åŠ¡ä¸­çš„æ‰€æœ‰æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸæäº¤ï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥å›æ»šåˆ°äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€ã€‚</li><li><strong>ä¸€è‡´æ€§ (Consistency)</strong>: äº‹åŠ¡æ‰§è¡Œå‰åï¼Œæ•°æ®åº“çš„å®Œæ•´æ€§çº¦æŸ (å¦‚ä¸»é”®å”¯ä¸€æ€§ã€å¤–é”®çº¦æŸã€æ£€æŸ¥çº¦æŸã€è‡ªå®šä¹‰ä¸šåŠ¡è§„åˆ™ ) æ²¡æœ‰è¢«ç ´åï¼Œæ•°æ®ä»ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€è½¬æ¢åˆ°å¦ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€ã€‚</li><li><strong>éš”ç¦»æ€§ (Isolation)</strong>: å¹¶å‘æ‰§è¡Œçš„äº‹åŠ¡ä¹‹é—´æ˜¯éš”ç¦»çš„ï¼Œä¸€ä¸ªäº‹åŠ¡çš„æ‰§è¡Œä¸åº”å½±å“å…¶ä»–äº‹åŠ¡çš„æ‰§è¡Œï¼Œåä¹‹äº¦ç„¶ã€‚äº‹åŠ¡çš„ä¸­é—´çŠ¶æ€å¯¹å…¶ä»–äº‹åŠ¡æ˜¯ä¸å¯è§çš„ã€‚</li><li><strong>æŒä¹…æ€§ (Durability)</strong>: ä¸€æ—¦äº‹åŠ¡æäº¤ï¼Œå®ƒå¯¹æ•°æ®åº“ä¸­æ•°æ®çš„æ”¹å˜å°±æ˜¯æ°¸ä¹…æ€§çš„ï¼Œå³ä½¿ç³»ç»Ÿå´©æºƒä¹Ÿä¸ä¼šä¸¢å¤±ã€‚</li></ol></li><li><strong>å¹¶å‘äº‹åŠ¡å¸¦æ¥çš„é—®é¢˜ï¼š</strong><ol><li><strong>è„è¯» (Dirty Read)</strong>: ä¸€ä¸ªäº‹åŠ¡è¯»å–äº†å¦ä¸€ä¸ªæœªæäº¤äº‹åŠ¡çš„æ•°æ®ã€‚å¦‚æœè¿™ä¸ªæœªæäº¤äº‹åŠ¡æœ€ç»ˆå›æ»šï¼Œé‚£ä¹ˆä¹‹å‰è¯»å–çš„æ•°æ®å°±æ˜¯â€œè„æ•°æ®â€ã€‚</li><li><strong>ä¸å¯é‡å¤è¯» (Non-Repeatable Read)</strong>ï¼šä¸€ä¸ªäº‹åŠ¡åœ¨ä¸¤æ¬¡ç›¸åŒçš„æŸ¥è¯¢ä¸­ï¼Œè¯»å–åˆ°äº†ä¸åŒçš„æ•°æ®ã€‚é€šå¸¸æ˜¯å› ä¸ºå¦ä¸€ä¸ªå·²æäº¤äº‹åŠ¡å¯¹è¿™äº›æ•°æ®è¿›è¡Œäº† UPDATE æˆ– DELETE æ“ä½œã€‚</li><li><strong>å¹»è¯» (Phantom Read)</strong>ï¼šä¸€ä¸ªäº‹åŠ¡åœ¨ä¸¤æ¬¡ç›¸åŒçš„æŸ¥è¯¢ä¸­ï¼Œè¯»å–åˆ°äº†ä¸åŒæ•°é‡çš„è¡Œã€‚é€šå¸¸æ˜¯å› ä¸ºå¦ä¸€ä¸ªå·²æäº¤äº‹åŠ¡å¯¹æ•°æ®è¿›è¡Œäº† INSERT æ“ä½œï¼Œå¯¼è‡´ç¬¬äºŒæ¬¡æŸ¥è¯¢å‡ºç°äº†ä¹‹å‰æ²¡æœ‰çš„è¡Œã€‚</li><li><strong>ä¸¢å¤±æ›´æ–° (Lost Update)</strong>ï¼šå½“ä¸¤ä¸ªäº‹åŠ¡éƒ½è¯»å–åŒä¸€æ•°æ®å¹¶è¿›è¡Œä¿®æ”¹æ—¶ï¼Œå…¶ä¸­ä¸€ä¸ªäº‹åŠ¡çš„ä¿®æ”¹è¦†ç›–äº†å¦ä¸€ä¸ªäº‹åŠ¡çš„ä¿®æ”¹ï¼Œå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚</li></ol></li><li><strong>äº‹åŠ¡éš”ç¦»çº§åˆ« (ä»ä½åˆ°é«˜)ï¼š</strong><ol><li><strong>READ UNCOMMITTED (è¯»æœªæäº¤)ï¼š</strong><ul><li>æœ€ä½çš„éš”ç¦»çº§åˆ«ã€‚</li><li>å…è®¸è„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯»ã€‚</li><li>æ€§èƒ½æœ€é«˜ï¼Œä½†æ•°æ®ä¸€è‡´æ€§æœ€å·®ã€‚</li></ul></li><li><strong>READ COMMITTED (è¯»å·²æäº¤)ï¼š</strong><ul><li>è§£å†³äº†è„è¯»é—®é¢˜ã€‚ä¸€ä¸ªäº‹åŠ¡åªèƒ½çœ‹åˆ°å…¶ä»–äº‹åŠ¡å·²ç»æäº¤çš„æ•°æ®ã€‚</li><li>ä»ç„¶å­˜åœ¨ä¸å¯é‡å¤è¯»å’Œå¹»è¯»é—®é¢˜ã€‚</li><li>å¤šæ•°æ•°æ®åº“ (å¦‚ Oracle, SQL Server) çš„é»˜è®¤éš”ç¦»çº§åˆ«ã€‚</li></ul></li><li><strong>REPEATABLE READ (å¯é‡å¤è¯»)ï¼š</strong><ul><li>MySQL (InnoDB å­˜å‚¨å¼•æ“) çš„é»˜è®¤éš”ç¦»çº§åˆ«ã€‚</li><li>è§£å†³äº†è„è¯»å’Œä¸å¯é‡å¤è¯»é—®é¢˜ã€‚åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œå¤šæ¬¡è¯»å–åŒä¸€æ•°æ®ä¼šå¾—åˆ°ç›¸åŒçš„ç»“æœ (é€šè¿‡ MVCC - å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶)ã€‚</li><li>ä»ç„¶å¯èƒ½å­˜åœ¨å¹»è¯»é—®é¢˜ (ä½†åœ¨ InnoDB é»˜è®¤éš”ç¦»çº§åˆ«ä¸‹ï¼Œé€šè¿‡é—´éš™é”è§£å†³äº†å¤§éƒ¨åˆ†å¹»è¯»é—®é¢˜)ã€‚</li></ul></li><li><strong>SERIALIZABLE (ä¸²è¡ŒåŒ–):</strong><ul><li>æœ€é«˜çš„éš”ç¦»çº§åˆ«ã€‚</li><li>å®Œå…¨è§£å†³äº†è„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯»é—®é¢˜ã€‚</li><li>å¼ºåˆ¶äº‹åŠ¡ä¸²è¡Œæ‰§è¡Œï¼Œé¿å…æ‰€æœ‰å¹¶å‘é—®é¢˜ã€‚</li><li>æ€§èƒ½æœ€ä½ï¼Œå› ä¸ºå®ƒç‰ºç‰²äº†å¹¶å‘æ€§ã€‚</li></ul></li></ol></li></ul><hr><h1 id="ç´¢å¼•-Index"><a href="#ç´¢å¼•-Index" class="headerlink" title="ç´¢å¼• (Index)"></a>ç´¢å¼• (Index)</h1><p>ç´¢å¼•æ˜¯å¸®åŠ© MySQL é«˜æ•ˆè·å–æ•°æ®çš„æ•°æ®ç»“æ„ã€‚å®ƒç±»ä¼¼äºä¹¦ç±çš„ç›®å½•ï¼Œå¯ä»¥å¿«é€Ÿå®šä½æ‰€éœ€æ•°æ®ï¼Œè€Œæ— éœ€æ‰«ææ•´ä¸ªè¡¨ã€‚</p><hr><h2 id="1-ç´¢å¼•çš„ä¼˜ç¼ºç‚¹"><a href="#1-ç´¢å¼•çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="1. ç´¢å¼•çš„ä¼˜ç¼ºç‚¹"></a>1. ç´¢å¼•çš„ä¼˜ç¼ºç‚¹</h2><h3 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><ul><li><strong>åŠ å¿«æ•°æ®æ£€ç´¢é€Ÿåº¦</strong>ï¼šé€šè¿‡ç´¢å¼•å¯ä»¥ç›´æ¥å®šä½åˆ°æ•°æ®ï¼Œé¿å…å…¨è¡¨æ‰«æã€‚</li><li><strong>å‡å°‘ I&#x2F;O æ¬¡æ•°</strong>ï¼šç´¢å¼•ç»“æ„æ¯”æ•°æ®è¡¨å°ï¼Œå‡å°‘ç£ç›˜è®¿é—®ã€‚</li><li><strong>ä¼˜åŒ–åˆ†ç»„å’Œæ’åº</strong>ï¼šåœ¨ <code>GROUP BY</code> å’Œ <code>ORDER BY</code> ä¸­ï¼Œå¯å‡å°‘ CPU æ¶ˆè€—ã€‚</li></ul><h3 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h3><ul><li><strong>ç»´æŠ¤æˆæœ¬</strong>ï¼šæ•°æ®å¢åŠ ã€æ›´æ–°æˆ–åˆ é™¤æ—¶ï¼Œç´¢å¼•ä¹Ÿéœ€è¦æ›´æ–°ã€‚</li><li><strong>å ç”¨å­˜å‚¨ç©ºé—´</strong>ï¼šç´¢å¼•æœ¬èº«ä¹Ÿéœ€è¦å ç”¨ç£ç›˜ã€‚</li><li><strong>å†™å…¥æ€§èƒ½å½±å“</strong>ï¼šè™½ç„¶æŸ¥è¯¢å¿«ï¼Œä½†å¯¹ <code>INSERT/UPDATE/DELETE</code> æœ‰ä¸€å®šæ€§èƒ½å¼€é”€ã€‚</li></ul><hr><h2 id="2-ç´¢å¼•åº•å±‚å®ç°-â€”-B-æ ‘"><a href="#2-ç´¢å¼•åº•å±‚å®ç°-â€”-B-æ ‘" class="headerlink" title="2. ç´¢å¼•åº•å±‚å®ç° â€” B+ æ ‘"></a>2. ç´¢å¼•åº•å±‚å®ç° â€” B+ æ ‘</h2><h3 id="B-æ ‘ç‰¹ç‚¹"><a href="#B-æ ‘ç‰¹ç‚¹" class="headerlink" title="B+ æ ‘ç‰¹ç‚¹"></a>B+ æ ‘ç‰¹ç‚¹</h3><ul><li><strong>æ•°æ®å­˜å‚¨</strong>ï¼šæ‰€æœ‰æ•°æ®éƒ½å­˜å‚¨åœ¨å¶å­èŠ‚ç‚¹ï¼Œéå¶å­èŠ‚ç‚¹ä»…å­˜å‚¨é”®å€¼ç”¨äºå¯¼èˆªã€‚</li><li><strong>å¶å­èŠ‚ç‚¹é“¾è¡¨</strong>ï¼šæ–¹ä¾¿èŒƒå›´æŸ¥è¯¢å’Œé¡ºåºéå†ã€‚</li><li><strong>æ ‘å±‚é«˜ä½</strong>ï¼šéå¶å­èŠ‚ç‚¹ä¸å­˜å‚¨æ•°æ®ï¼Œä¸€ä¸ªèŠ‚ç‚¹å¯å­˜å‚¨æ›´å¤šç´¢å¼•é”®ï¼Œé™ä½æ ‘é«˜åº¦ï¼Œå‡å°‘ç£ç›˜ I&#x2F;Oã€‚</li><li><strong>é€‚åˆç£ç›˜å­˜å‚¨</strong>ï¼šèŠ‚ç‚¹å¤§å°åŒ¹é…ç£ç›˜å—å¤§å°ï¼Œæœ€å¤§é™åº¦å‡å°‘ç£ç›˜å¯»é“æ¬¡æ•°ã€‚</li></ul><hr><h2 id="3-ç´¢å¼•åˆ†ç±»"><a href="#3-ç´¢å¼•åˆ†ç±»" class="headerlink" title="3. ç´¢å¼•åˆ†ç±»"></a>3. ç´¢å¼•åˆ†ç±»</h2><h3 id="3-1-ä¸»é”®ç´¢å¼•-Primary-Key-Index"><a href="#3-1-ä¸»é”®ç´¢å¼•-Primary-Key-Index" class="headerlink" title="3.1 ä¸»é”®ç´¢å¼• (Primary Key Index)"></a>3.1 ä¸»é”®ç´¢å¼• (Primary Key Index)</h3><ul><li>ç‰¹æ®Šçš„å”¯ä¸€ç´¢å¼•ï¼Œä¸€ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®ã€‚</li><li>ä¸å…è®¸ <code>NULL</code> å€¼ã€‚</li><li>é€šå¸¸æ˜¯ <strong>èšé›†ç´¢å¼•</strong> (InnoDB å­˜å‚¨å¼•æ“)ã€‚</li></ul><h3 id="3-2-å”¯ä¸€ç´¢å¼•-Unique-Index"><a href="#3-2-å”¯ä¸€ç´¢å¼•-Unique-Index" class="headerlink" title="3.2 å”¯ä¸€ç´¢å¼• (Unique Index)"></a>3.2 å”¯ä¸€ç´¢å¼• (Unique Index)</h3><ul><li>åˆ—å€¼å¿…é¡»å”¯ä¸€ï¼Œä½†å…è®¸å¤šä¸ª <code>NULL</code> å€¼ã€‚</li><li>SQL ç¤ºä¾‹ï¼š</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE UNIQUE INDEX idx_name ON table_name (column_name);</span><br></pre></td></tr></table></figure><h3 id="3-3-æ™®é€šç´¢å¼•-Normal-Index-Non-Unique-Index"><a href="#3-3-æ™®é€šç´¢å¼•-Normal-Index-Non-Unique-Index" class="headerlink" title="3.3 æ™®é€šç´¢å¼• (Normal Index &#x2F; Non-Unique Index)"></a>3.3 æ™®é€šç´¢å¼• (Normal Index &#x2F; Non-Unique Index)</h3><ul><li>æœ€åŸºæœ¬ç´¢å¼•ï¼Œæ²¡æœ‰å”¯ä¸€æ€§é™åˆ¶ã€‚</li><li>SQL ç¤ºä¾‹ï¼š</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE INDEX idx_name ON table_name (column_name);</span><br></pre></td></tr></table></figure><h3 id="3-4-å…¨æ–‡ç´¢å¼•-Fulltext-Index"><a href="#3-4-å…¨æ–‡ç´¢å¼•-Fulltext-Index" class="headerlink" title="3.4 å…¨æ–‡ç´¢å¼• (Fulltext Index)"></a>3.4 å…¨æ–‡ç´¢å¼• (Fulltext Index)</h3><ul><li>ç”¨äºå¤§æ–‡æœ¬å­—æ®µçš„æ¨¡ç³Šæœç´¢ã€‚</li><li>ä»…æ”¯æŒ MyISAM å’Œ InnoDBã€‚</li><li>SQL ç¤ºä¾‹ï¼š</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE FULLTEXT INDEX idx_name ON table_name (column_name);</span><br></pre></td></tr></table></figure><h3 id="3-5-å¤åˆç´¢å¼•-Composite-Multi-Column-Index"><a href="#3-5-å¤åˆç´¢å¼•-Composite-Multi-Column-Index" class="headerlink" title="3.5 å¤åˆç´¢å¼• (Composite &#x2F; Multi-Column Index)"></a>3.5 å¤åˆç´¢å¼• (Composite &#x2F; Multi-Column Index)</h3><ul><li>åœ¨å¤šåˆ—ä¸Šåˆ›å»ºçš„ç´¢å¼•ã€‚</li><li><strong>æœ€å·¦å‰ç¼€åŸåˆ™</strong>ï¼š<ul><li>æŸ¥è¯¢æ¡ä»¶ä½¿ç”¨å¤åˆç´¢å¼•çš„ç¬¬ä¸€åˆ—ï¼Œåˆ™æ•´ä¸ªç´¢å¼•å¯ç”¨ã€‚</li><li>ä»…ä½¿ç”¨éé¦–åˆ—ï¼Œåˆ™ç´¢å¼•å¯èƒ½æ— æ³•å®Œå…¨ä½¿ç”¨ã€‚</li></ul></li><li>SQL ç¤ºä¾‹ï¼š</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE INDEX idx_name ON table_name (column1, column2, column3);</span><br></pre></td></tr></table></figure><hr><h2 id="4-èšé›†ç´¢å¼•ä¸éèšé›†ç´¢å¼•"><a href="#4-èšé›†ç´¢å¼•ä¸éèšé›†ç´¢å¼•" class="headerlink" title="4. èšé›†ç´¢å¼•ä¸éèšé›†ç´¢å¼•"></a>4. èšé›†ç´¢å¼•ä¸éèšé›†ç´¢å¼•</h2><h3 id="4-1-èšé›†ç´¢å¼•-Clustered-Index"><a href="#4-1-èšé›†ç´¢å¼•-Clustered-Index" class="headerlink" title="4.1 èšé›†ç´¢å¼• (Clustered Index)"></a>4.1 èšé›†ç´¢å¼• (Clustered Index)</h3><ul><li><strong>å¶å­èŠ‚ç‚¹å­˜å‚¨å®Œæ•´æ•°æ®è¡Œ</strong>ã€‚</li><li>ä¸€ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªèšé›†ç´¢å¼•ï¼ˆé€šå¸¸æ˜¯ä¸»é”®ï¼‰ã€‚</li><li>æ•°æ®ç‰©ç†é¡ºåºä¸ç´¢å¼•é€»è¾‘é¡ºåºä¸€è‡´ã€‚</li><li>æŸ¥è¯¢æ•ˆç‡é«˜ï¼Œæ— éœ€å›è¡¨ã€‚</li><li>å†™å…¥å½±å“ï¼šæ’å…¥ã€æ›´æ–°ã€åˆ é™¤éœ€è¦ç»´æŠ¤ç‰©ç†é¡ºåºã€‚</li><li><strong>InnoDB å®ç°</strong>ï¼š<ul><li>ä¸»é”®ç´¢å¼•å³èšé›†ç´¢å¼•ã€‚</li><li>è‹¥æœªå®šä¹‰ä¸»é”®ï¼Œé€‰æ‹©å”¯ä¸€éç©ºç´¢å¼•ä½œä¸ºèšé›†ç´¢å¼•ï¼›è‹¥æ— ï¼Œåˆ™åˆ›å»ºéšè— 6 å­—èŠ‚ <code>row_id</code> ä½œä¸ºèšé›†ç´¢å¼•ã€‚</li></ul></li></ul><h3 id="4-2-éèšé›†ç´¢å¼•-Non-Clustered-Index"><a href="#4-2-éèšé›†ç´¢å¼•-Non-Clustered-Index" class="headerlink" title="4.2 éèšé›†ç´¢å¼• (Non-Clustered Index)"></a>4.2 éèšé›†ç´¢å¼• (Non-Clustered Index)</h3><ul><li><strong>å¶å­èŠ‚ç‚¹å­˜å‚¨ä¸»é”®æˆ–æŒ‡å‘æ•°æ®è¡Œçš„æŒ‡é’ˆ</strong>ã€‚</li><li>è¡¨å¯æœ‰å¤šä¸ªéèšé›†ç´¢å¼•ã€‚</li><li>æ•°æ®ç‰©ç†é¡ºåºä¸ç´¢å¼•é€»è¾‘é¡ºåºæ— å…³ã€‚</li><li>æŸ¥è¯¢éœ€å›è¡¨ï¼šè‹¥æŸ¥è¯¢åˆ—ä¸åœ¨ç´¢å¼•ä¸­ï¼Œéœ€è¦é€šè¿‡ç´¢å¼•æ‰¾åˆ°ä¸»é”®ï¼Œå†é€šè¿‡èšé›†ç´¢å¼•è·å–å®Œæ•´æ•°æ®ã€‚</li><li><strong>InnoDB å®ç°</strong>ï¼šæ‰€æœ‰éä¸»é”®ç´¢å¼•éƒ½æ˜¯éèšé›†ç´¢å¼•ã€‚</li></ul><hr><h2 id="5-ç´¢å¼•ä¼˜åŒ–ç­–ç•¥"><a href="#5-ç´¢å¼•ä¼˜åŒ–ç­–ç•¥" class="headerlink" title="5. ç´¢å¼•ä¼˜åŒ–ç­–ç•¥"></a>5. ç´¢å¼•ä¼˜åŒ–ç­–ç•¥</h2><h3 id="5-1-åˆ›å»ºç´¢å¼•çš„åˆ—é€‰æ‹©"><a href="#5-1-åˆ›å»ºç´¢å¼•çš„åˆ—é€‰æ‹©" class="headerlink" title="5.1 åˆ›å»ºç´¢å¼•çš„åˆ—é€‰æ‹©"></a>5.1 åˆ›å»ºç´¢å¼•çš„åˆ—é€‰æ‹©</h3><ul><li><strong>å¸¸ç”¨åˆ—</strong>ï¼š<code>WHERE</code>ã€<code>JOIN</code>ã€<code>ORDER BY</code> ä¸­é¢‘ç¹ä½¿ç”¨çš„åˆ—ã€‚</li><li><strong>é«˜åŒºåˆ†åº¦åˆ—</strong>ï¼šå”¯ä¸€å€¼å¤šçš„åˆ—æ›´é€‚åˆå»ºç«‹ç´¢å¼•ã€‚</li><li><strong>é¿å…</strong>ï¼š<ul><li>å°è¡¨æˆ–é¢‘ç¹æ›´æ–°è¡¨ä¸Šçš„ç´¢å¼•ã€‚</li><li>é‡å¤å€¼å¤šçš„åˆ—ä¸Šå»ºç´¢å¼•ã€‚</li></ul></li></ul><h3 id="5-2-éµå¾ªæœ€å·¦å‰ç¼€åŸåˆ™"><a href="#5-2-éµå¾ªæœ€å·¦å‰ç¼€åŸåˆ™" class="headerlink" title="5.2 éµå¾ªæœ€å·¦å‰ç¼€åŸåˆ™"></a>5.2 éµå¾ªæœ€å·¦å‰ç¼€åŸåˆ™</h3><ul><li>å¯¹å¤åˆç´¢å¼• <code>(a, b, c)</code>ï¼š</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">WHERE a = 1                -&gt; ç´¢å¼•å¯ç”¨</span><br><span class="line">WHERE a = 1 AND b = 2      -&gt; ç´¢å¼•å¯ç”¨</span><br><span class="line">WHERE b = 2                 -&gt; ç´¢å¼•æ— æ³•å®Œå…¨åˆ©ç”¨</span><br><span class="line">WHERE c = 3                 -&gt; ç´¢å¼•æ— æ³•å®Œå…¨åˆ©ç”¨</span><br></pre></td></tr></table></figure><h3 id="5-3-é¿å…ç´¢å¼•å¤±æ•ˆ"><a href="#5-3-é¿å…ç´¢å¼•å¤±æ•ˆ" class="headerlink" title="5.3 é¿å…ç´¢å¼•å¤±æ•ˆ"></a>5.3 é¿å…ç´¢å¼•å¤±æ•ˆ</h3><ul><li><strong>å‡½æ•°æˆ–è¡¨è¾¾å¼</strong>ï¼šå¦‚ <code>WHERE YEAR(date_column) = 2023</code></li><li><strong>éšå¼ç±»å‹è½¬æ¢</strong>ï¼šç´¢å¼•åˆ—ç±»å‹ä¸åŒäºæŸ¥è¯¢å€¼ç±»å‹</li><li><strong>OR æ¡ä»¶</strong>ï¼šé™¤éä¸¤è¾¹éƒ½æœ‰ç´¢å¼•ï¼Œä¸”ä¼˜åŒ–å™¨å†³å®šåˆå¹¶ç´¢å¼•</li><li><strong>å·¦æ¨¡ç³ŠåŒ¹é…</strong>ï¼š<code>LIKE &#39;%keyword&#39;</code></li><li><strong>ä¸ç­‰&#x2F;é IN</strong>ï¼š<code>!=</code> æˆ– <code>NOT IN</code></li></ul><h3 id="5-4-è¦†ç›–ç´¢å¼•-Covering-Index"><a href="#5-4-è¦†ç›–ç´¢å¼•-Covering-Index" class="headerlink" title="5.4 è¦†ç›–ç´¢å¼• (Covering Index)"></a>5.4 è¦†ç›–ç´¢å¼• (Covering Index)</h3><ul><li>æŸ¥è¯¢æ‰€éœ€åˆ—éƒ½åœ¨ç´¢å¼•ä¸­ï¼Œæ— éœ€å›è¡¨ï¼š</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT column_in_index</span><br><span class="line">FROM table_name</span><br><span class="line">WHERE indexed_column = value;</span><br></pre></td></tr></table></figure><h3 id="5-5-é˜²æ­¢å›è¡¨"><a href="#5-5-é˜²æ­¢å›è¡¨" class="headerlink" title="5.5 é˜²æ­¢å›è¡¨"></a>5.5 é˜²æ­¢å›è¡¨</h3><ul><li>å°½é‡è®© SELECT åˆ—è¢«ç´¢å¼•è¦†ç›–ï¼Œæˆ–åªæŸ¥è¯¢ä¸»é”®ã€‚</li></ul><h3 id="5-6-å®šæœŸç»´æŠ¤ç´¢å¼•"><a href="#5-6-å®šæœŸç»´æŠ¤ç´¢å¼•" class="headerlink" title="5.6 å®šæœŸç»´æŠ¤ç´¢å¼•"></a>5.6 å®šæœŸç»´æŠ¤ç´¢å¼•</h3><ul><li>é‡å»ºç´¢å¼•æˆ–ä¼˜åŒ–ç¢ç‰‡åŒ–ç´¢å¼•ï¼Œä¿æŒæ€§èƒ½ç¨³å®šã€‚</li></ul><hr><hr><h2 id="ä¸€ã€B-æ ‘çš„ç»“æ„ç‰¹ç‚¹"><a href="#ä¸€ã€B-æ ‘çš„ç»“æ„ç‰¹ç‚¹" class="headerlink" title="ä¸€ã€B+æ ‘çš„ç»“æ„ç‰¹ç‚¹"></a>ä¸€ã€B+æ ‘çš„ç»“æ„ç‰¹ç‚¹</h2><ol><li><strong>å¤šè·¯å¹³è¡¡æŸ¥æ‰¾æ ‘</strong>ï¼šMySQLï¼ˆInnoDBï¼‰ä½¿ç”¨çš„æ˜¯ <strong>B+æ ‘ç´¢å¼•</strong>ï¼Œä¸åŒäºäºŒå‰æ ‘ï¼Œä¸€ä¸ªèŠ‚ç‚¹èƒ½å­˜å‚¨å¤§é‡ keyã€‚</li><li><strong>éå¶å­èŠ‚ç‚¹</strong>ï¼šåªå­˜å‚¨ <strong>ç´¢å¼•é”®å€¼ + å­èŠ‚ç‚¹æŒ‡é’ˆ</strong>ï¼Œä¸å­˜æ”¾çœŸå®æ•°æ®ã€‚</li><li><strong>å¶å­èŠ‚ç‚¹</strong>ï¼šå­˜æ”¾ <strong>å®Œæ•´çš„æ•°æ®è¡Œï¼ˆèšç°‡ç´¢å¼•ï¼‰</strong> æˆ– <strong>ä¸»é”®å€¼ï¼ˆè¾…åŠ©ç´¢å¼•ï¼‰</strong>ï¼Œå¹¶ä¸”é€šè¿‡ <strong>åŒå‘é“¾è¡¨</strong> ç›¸è¿ï¼Œä¾¿äºèŒƒå›´æŸ¥è¯¢ã€‚</li><li><strong>æœ‰åºæ€§</strong>ï¼šç´¢å¼•é”®åœ¨èŠ‚ç‚¹å†…æ˜¯æœ‰åºå­˜å‚¨çš„ï¼Œé€‚åˆäºŒåˆ†æŸ¥æ‰¾ã€‚</li></ol><hr><h2 id="äºŒã€å®šä½è¿‡ç¨‹ï¼ˆç²¾ç¡®æŸ¥æ‰¾æŸæ¡è®°å½•ï¼‰"><a href="#äºŒã€å®šä½è¿‡ç¨‹ï¼ˆç²¾ç¡®æŸ¥æ‰¾æŸæ¡è®°å½•ï¼‰" class="headerlink" title="äºŒã€å®šä½è¿‡ç¨‹ï¼ˆç²¾ç¡®æŸ¥æ‰¾æŸæ¡è®°å½•ï¼‰"></a>äºŒã€å®šä½è¿‡ç¨‹ï¼ˆç²¾ç¡®æŸ¥æ‰¾æŸæ¡è®°å½•ï¼‰</h2><p>å‡è®¾æœ‰ä¸€å¼ è¡¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE user (</span><br><span class="line">    id INT PRIMARY KEY,   -- èšç°‡ç´¢å¼•</span><br><span class="line">    name VARCHAR(50),</span><br><span class="line">    age INT</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>ç´¢å¼•ç±»å‹ï¼š</p><ul><li><strong>èšç°‡ç´¢å¼•ï¼ˆClustered Indexï¼‰</strong>ï¼šå¶å­èŠ‚ç‚¹å­˜å‚¨æ•´è¡Œè®°å½•ã€‚</li><li><strong>è¾…åŠ©ç´¢å¼•ï¼ˆSecondary Indexï¼‰</strong>ï¼šå¶å­èŠ‚ç‚¹å­˜å‚¨ä¸»é”®å€¼ï¼Œå†å›è¡¨æŸ¥è¯¢æ•´è¡Œã€‚</li></ul><hr><h3 id="1-ç²¾ç¡®æŸ¥æ‰¾ï¼ˆä¸»é”®æŸ¥æ‰¾ï¼‰"><a href="#1-ç²¾ç¡®æŸ¥æ‰¾ï¼ˆä¸»é”®æŸ¥æ‰¾ï¼‰" class="headerlink" title="1. ç²¾ç¡®æŸ¥æ‰¾ï¼ˆä¸»é”®æŸ¥æ‰¾ï¼‰"></a>1. ç²¾ç¡®æŸ¥æ‰¾ï¼ˆä¸»é”®æŸ¥æ‰¾ï¼‰</h3><p>ä¾‹å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM user WHERE id = 25;</span><br></pre></td></tr></table></figure><p>å®šä½æ­¥éª¤ï¼š</p><ol><li>ä» <strong>æ ¹èŠ‚ç‚¹</strong> å¼€å§‹ï¼Œæ ¹æ® <code>id</code> å€¼è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼Œæ‰¾åˆ°å¯¹åº”çš„å­èŠ‚ç‚¹æŒ‡é’ˆã€‚</li><li>è¿›å…¥ <strong>ä¸­é—´èŠ‚ç‚¹</strong>ï¼Œé‡å¤äºŒåˆ†æŸ¥æ‰¾ï¼Œç»§ç»­å‘ä¸‹ã€‚</li><li>è¿›å…¥ <strong>å¶å­èŠ‚ç‚¹</strong>ï¼Œæ‰¾åˆ°é”®å€¼ &#x3D; 25 çš„ä½ç½®ã€‚</li><li>å› ä¸ºæ˜¯ <strong>èšç°‡ç´¢å¼•</strong>ï¼Œå¶å­èŠ‚ç‚¹å­˜æ”¾äº†å®Œæ•´è¡Œè®°å½•ï¼Œç›´æ¥è¿”å›ã€‚</li></ol><hr><h3 id="2-è¾…åŠ©ç´¢å¼•æŸ¥æ‰¾ï¼ˆéä¸»é”®æŸ¥æ‰¾ï¼‰"><a href="#2-è¾…åŠ©ç´¢å¼•æŸ¥æ‰¾ï¼ˆéä¸»é”®æŸ¥æ‰¾ï¼‰" class="headerlink" title="2. è¾…åŠ©ç´¢å¼•æŸ¥æ‰¾ï¼ˆéä¸»é”®æŸ¥æ‰¾ï¼‰"></a>2. è¾…åŠ©ç´¢å¼•æŸ¥æ‰¾ï¼ˆéä¸»é”®æŸ¥æ‰¾ï¼‰</h3><p>ä¾‹å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM user WHERE name = &#x27;Tom&#x27;;</span><br></pre></td></tr></table></figure><p>å®šä½æ­¥éª¤ï¼š</p><ol><li>è¿›å…¥ <strong>è¾…åŠ©ç´¢å¼• B+æ ‘</strong>ï¼Œä»æ ¹ â†’ ä¸­é—´èŠ‚ç‚¹ â†’ å¶å­èŠ‚ç‚¹ï¼Œæ‰¾åˆ° <code>name = &#39;Tom&#39;</code> å¯¹åº”çš„è®°å½•ã€‚</li><li>å¶å­èŠ‚ç‚¹å­˜æ”¾çš„ä¸æ˜¯æ•´è¡Œæ•°æ®ï¼Œè€Œæ˜¯ <strong>ä¸»é”®å€¼ï¼ˆidï¼‰</strong>ã€‚</li><li>æ ¹æ®ä¸»é”®å€¼ï¼Œå†å›åˆ° <strong>èšç°‡ç´¢å¼• B+æ ‘</strong> ä¸­ï¼Œèµ°ä¸€æ¬¡æŸ¥æ‰¾è¿‡ç¨‹ï¼Œå®šä½åˆ°æ•´è¡Œæ•°æ®ã€‚</li></ol><p>è¿™å°±æ˜¯æ‰€è°“çš„ <strong>å›è¡¨</strong>ã€‚</p><hr><h2 id="ä¸‰ã€ä¸ºä»€ä¹ˆèƒ½â€œç²¾ç¡®å®šä½â€"><a href="#ä¸‰ã€ä¸ºä»€ä¹ˆèƒ½â€œç²¾ç¡®å®šä½â€" class="headerlink" title="ä¸‰ã€ä¸ºä»€ä¹ˆèƒ½â€œç²¾ç¡®å®šä½â€"></a>ä¸‰ã€ä¸ºä»€ä¹ˆèƒ½â€œç²¾ç¡®å®šä½â€</h2><ol><li><strong>æœ‰åºå­˜å‚¨</strong> â†’ èŠ‚ç‚¹å†…å¯ä»¥äºŒåˆ†æŸ¥æ‰¾ï¼Œå¿«é€Ÿç¼©å°èŒƒå›´ã€‚</li><li><strong>æ ‘é«˜è¾ƒä½</strong> â†’ InnoDB ä¸€èˆ¬ 3<del>4 å±‚å°±èƒ½å­˜ä¸‹ç™¾ä¸‡çº§æ•°æ®ï¼Œæ¯æ¬¡æŸ¥æ‰¾åªéœ€ç£ç›˜ I&#x2F;O 3</del>4 æ¬¡ã€‚</li><li><strong>èšç°‡ç´¢å¼•</strong> â†’ ç›´æ¥åœ¨å¶å­èŠ‚ç‚¹æ‰¾åˆ°å®Œæ•´è¡Œï¼Œé¿å…é¢å¤–è·³è½¬ã€‚</li><li><strong>è¾…åŠ©ç´¢å¼• + ä¸»é”®ç´¢å¼•</strong> â†’ é€šè¿‡ä¸¤æ¬¡ B+æ ‘æŸ¥æ‰¾ï¼Œä¾ç„¶èƒ½ç²¾ç¡®å®šä½ã€‚</li></ol><hr><h2 id="å››ã€ç±»æ¯”ç†è§£"><a href="#å››ã€ç±»æ¯”ç†è§£" class="headerlink" title="å››ã€ç±»æ¯”ç†è§£"></a>å››ã€ç±»æ¯”ç†è§£</h2><p>B+æ ‘å°±åƒä¸€ä¸ªâ€œå›¾ä¹¦é¦†ç›®å½•â€ï¼š</p><ul><li><strong>æ ¹èŠ‚ç‚¹</strong> &#x3D; å›¾ä¹¦é¦†çš„â€œç›®å½•ç´¢å¼•é¡µâ€</li><li><strong>ä¸­é—´èŠ‚ç‚¹</strong> &#x3D; åˆ†åŒºç›®å½•</li><li><strong>å¶å­èŠ‚ç‚¹</strong> &#x3D; ä¹¦æ¶ï¼ˆæ”¾ä¹¦æˆ–è€…ä¹¦çš„ç¼–å·ï¼‰</li><li><strong>èšç°‡ç´¢å¼•</strong> &#x3D; ç›´æ¥æ‰¾åˆ°ä¹¦æœ¬</li><li><strong>è¾…åŠ©ç´¢å¼•</strong> &#x3D; å…ˆæ‰¾åˆ°ä¹¦çš„ç¼–å·ï¼Œå†å»å¦ä¸€ä¸ªä¹¦æ¶æ‰¾ä¹¦</li></ul><hr><p>ğŸ‘‰ æ€»ç»“ä¸€å¥ï¼š<br> <strong>MySQL é€šè¿‡ B+æ ‘çš„æœ‰åºæ€§å’Œåˆ†å±‚æŸ¥æ‰¾æœºåˆ¶ï¼Œä»æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹é€çº§å®šä½ï¼Œæœ€ç»ˆåœ¨å¶å­èŠ‚ç‚¹æ‰¾åˆ°ç›®æ ‡è®°å½•ï¼ˆä¸»é”®ç´¢å¼•ç›´æ¥æ‹¿æ•°æ®ï¼Œè¾…åŠ©ç´¢å¼•è¿˜éœ€å›è¡¨ï¼‰ã€‚</strong></p><p>è¦ä¸è¦æˆ‘å¸®ä½ ç”»ä¸€å¼  <strong>B+æ ‘ç²¾ç¡®æŸ¥æ‰¾çš„å›¾è§£æµç¨‹</strong>ï¼Œå½¢è±¡åŒ–å±•ç¤ºâ€œæŸ¥æ‰¾æŸæ¡è®°å½•â€çš„è·¯å¾„ï¼Ÿ</p><ul><li><h4 id="SQLä¼˜åŒ–"><a href="#SQLä¼˜åŒ–" class="headerlink" title="SQLä¼˜åŒ–"></a>SQLä¼˜åŒ–</h4><img src="https://i-blog.csdnimg.cn/blog_migrate/bfe55c106fb1ceb9316542c424cecf9f.png" alt="å›¾ç‰‡"></li></ul><hr><h1 id="MySQL-å­˜å‚¨å¼•æ“"><a href="#MySQL-å­˜å‚¨å¼•æ“" class="headerlink" title="MySQL å­˜å‚¨å¼•æ“"></a>MySQL å­˜å‚¨å¼•æ“</h1><p>MySQL æ”¯æŒå¤šç§å­˜å‚¨å¼•æ“ï¼Œæ¯ç§å­˜å‚¨å¼•æ“åœ¨äº‹åŠ¡æ”¯æŒã€é”æœºåˆ¶ã€ç´¢å¼•ç±»å‹ã€é€‚ç”¨åœºæ™¯ç­‰æ–¹é¢æœ‰æ‰€ä¸åŒã€‚</p><table><thead><tr><th>å­˜å‚¨å¼•æ“</th><th>ç‰¹æ€§</th><th>é”æœºåˆ¶</th><th>äº‹åŠ¡æ”¯æŒ</th><th>ç´¢å¼•ç±»å‹</th><th>å´©æºƒæ¢å¤</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>InnoDB (é»˜è®¤)</strong></td><td>- æ”¯æŒäº‹åŠ¡ï¼ˆACIDï¼‰- æ”¯æŒè¡Œçº§é”- æ”¯æŒå¤–é”®çº¦æŸ- æ”¯æŒå´©æºƒæ¢å¤- é»˜è®¤èšé›†ç´¢å¼•- MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰</td><td>è¡Œçº§é”</td><td>æ”¯æŒ</td><td>èšé›†ç´¢å¼•ï¼ˆå¶å­èŠ‚ç‚¹å­˜å‚¨æ•°æ®è¡Œï¼‰</td><td>æ”¯æŒ redo log &#x2F; undo log</td><td>äº‹åŠ¡æ€§åº”ç”¨ã€é«˜å¹¶å‘è¯»å†™ã€æ•°æ®å®Œæ•´æ€§è¦æ±‚é«˜çš„åœºæ™¯ï¼ˆå¦‚ç”µå•†ã€é‡‘èï¼‰</td></tr><tr><td><strong>MyISAM</strong></td><td>- ä¸æ”¯æŒäº‹åŠ¡- ä¸æ”¯æŒå¤–é”®- éèšé›†ç´¢å¼•- SELECT COUNT(*) å¿«</td><td>è¡¨çº§é”</td><td>ä¸æ”¯æŒ</td><td>éèšé›†ç´¢å¼•ï¼ˆå¶å­èŠ‚ç‚¹å­˜å‚¨æ•°æ®åœ°å€ï¼‰</td><td>ä¸æ”¯æŒ</td><td>åªè¯»æˆ–è¯»å¤šå†™å°‘ã€å¯¹äº‹åŠ¡æ€§è¦æ±‚ä¸é«˜ï¼Œéœ€è¦é¢‘ç¹ COUNT(*) çš„åº”ç”¨ï¼ˆå¦‚æ—¥å¿—ã€æ•°æ®ä»“åº“ï¼‰</td></tr><tr><td><strong>Memory (HEAP)</strong></td><td>- æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œé€Ÿåº¦å¿«- é‡å¯æ•°æ®ä¸¢å¤±</td><td>è¡¨çº§é”</td><td>ä¸æ”¯æŒ</td><td>å“ˆå¸Œç´¢å¼•ï¼ˆé»˜è®¤ï¼Œå¯ç”¨ BTREEï¼‰</td><td>ä¸æ”¯æŒ</td><td>ä¸´æ—¶è¡¨ã€ç¼“å­˜ã€å¿«é€Ÿè®¡ç®—</td></tr><tr><td><strong>Archive</strong></td><td>- é«˜åº¦å‹ç¼©ï¼ŒèŠ‚çœç©ºé—´- æ”¯æŒé«˜é€Ÿæ’å…¥å’ŒæŸ¥è¯¢- ä¸æ”¯æŒæ›´æ–°å’Œåˆ é™¤</td><td>è¡¨çº§é”</td><td>ä¸æ”¯æŒ</td><td>éèšé›†ç´¢å¼•</td><td>ä¸æ”¯æŒ</td><td>å­˜å‚¨å†å²æ•°æ®ã€ä¸å¸¸è®¿é—®çš„æ•°æ®ä»“åº“</td></tr><tr><td><strong>CSV</strong></td><td>- æ•°æ®ä»¥ CSV æ–‡ä»¶æ ¼å¼å­˜å‚¨- æ˜“äºä¸å…¶ä»–åº”ç”¨äº¤æ¢</td><td>è¡¨çº§é”</td><td>ä¸æ”¯æŒ</td><td>æ— ç´¢å¼•æˆ–ç®€å•ç´¢å¼•</td><td>ä¸æ”¯æŒ</td><td>æ•°æ®å¯¼å…¥å¯¼å‡ºã€äº¤æ¢æ•°æ®æ–‡ä»¶</td></tr></tbody></table><hr><h2 id="é¢å¤–è¯´æ˜"><a href="#é¢å¤–è¯´æ˜" class="headerlink" title="é¢å¤–è¯´æ˜"></a>é¢å¤–è¯´æ˜</h2><ol><li><strong>InnoDB é€æ¸æˆä¸ºé»˜è®¤å¼•æ“</strong>ï¼šMySQL 5.5 ä¹‹åï¼ŒInnoDB å–ä»£ MyISAMï¼Œæˆä¸ºäº‹åŠ¡å‹åº”ç”¨é¦–é€‰ã€‚</li><li><strong>ç´¢å¼•å’Œé”æœºåˆ¶åŒºåˆ«</strong>ï¼š<ul><li>è¡Œçº§é”ï¼šå¹¶å‘æ€§èƒ½é«˜ï¼Œé”ç²’åº¦å°ã€‚</li><li>è¡¨çº§é”ï¼šå¹¶å‘æ€§èƒ½ä½ï¼Œé€‚åˆè¯»å¤šå†™å°‘åœºæ™¯ã€‚</li></ul></li><li><strong>å´©æºƒæ¢å¤</strong>ï¼š<ul><li>InnoDB é€šè¿‡ <strong>redo log</strong> å’Œ <strong>undo log</strong> ä¿è¯æ•°æ®æŒä¹…æ€§å’Œäº‹åŠ¡å›æ»šã€‚</li><li>MyISAM å’Œ Memory ä¸æ”¯æŒäº‹åŠ¡æˆ–å´©æºƒæ¢å¤ã€‚</li></ul></li><li><strong>å­˜å‚¨ä¼˜åŒ–é€‰æ‹©</strong>ï¼š<ul><li>é«˜å¹¶å‘ã€äº‹åŠ¡æ€§åº”ç”¨ â†’ <strong>InnoDB</strong></li><li>åªè¯»æˆ–æ—¥å¿—åˆ†æ â†’ <strong>MyISAM</strong></li><li>ä¸´æ—¶è®¡ç®—&#x2F;ç¼“å­˜ â†’ <strong>Memory</strong></li><li>å†å²å½’æ¡£æ•°æ® â†’ <strong>Archive</strong></li><li>æ•°æ®äº¤æ¢ â†’ <strong>CSV</strong></li></ul></li></ol><hr><h2 id="MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰ï¼š"><a href="#MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰ï¼š" class="headerlink" title="MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰ï¼š"></a>MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰ï¼š</h2><p>å¥½çš„ï¼Œæˆ‘ä»¬æ¥æ·±å…¥æ¢è®¨ä¸€ä¸‹ <strong>MVCC (Multi-Version Concurrency Control)</strong>ï¼Œå¹¶åˆ†æä¸€äº›å¸¸è§çš„é¢è¯•é¢˜ã€‚</p><hr><h3 id="ä»€ä¹ˆæ˜¯-MVCCï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯-MVCCï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ MVCCï¼Ÿ"></a><strong>ä»€ä¹ˆæ˜¯ MVCCï¼Ÿ</strong></h3><p><strong>MVCC</strong>ï¼Œå³<strong>å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶</strong>ï¼Œæ˜¯ä¸€ç§åœ¨æ•°æ®åº“ä¸­ç”¨äºè§£å†³å¹¶å‘è®¿é—®é—®é¢˜çš„æ–¹æ³•ã€‚å®ƒä¸æ˜¯é€šè¿‡åŠ é”çš„æ–¹å¼æ¥æ§åˆ¶å¹¶å‘ï¼Œè€Œæ˜¯é€šè¿‡<strong>ä¸ºæ¯ä¸ªäº‹åŠ¡ç”Ÿæˆä¸€ä¸ªæ•°æ®å¿«ç…§</strong>ï¼Œè®©è¯»æ“ä½œåœ¨å¿«ç…§ä¸Šè¿›è¡Œã€‚</p><p>ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªâ€œæ—¶å…‰æœºâ€ã€‚å½“ä¸€ä¸ªäº‹åŠ¡å¼€å§‹æ—¶ï¼Œæ•°æ®åº“ä¼šä¸ºå®ƒâ€œæ‹ä¸€å¼ ç…§ç‰‡â€ï¼Œä¹Ÿå°±æ˜¯ç”Ÿæˆä¸€ä¸ªæ•°æ®å¿«ç…§ã€‚è¿™ä¸ªäº‹åŠ¡çš„æ‰€æœ‰è¯»æ“ä½œéƒ½åªä¼šçœ‹åˆ°è¿™ä¸ªå¿«ç…§é‡Œçš„æ•°æ®ï¼Œè€Œä¸ä¼šå—åˆ°å…¶ä»–å¹¶å‘äº‹åŠ¡ä¿®æ”¹çš„å½±å“ã€‚è¿™æ ·ï¼Œè¯»æ“ä½œå°±ä¸éœ€è¦ç­‰å¾…å†™é”é‡Šæ”¾ï¼Œä»è€Œå®ç°äº†<strong>è¯»å†™åˆ†ç¦»</strong>ï¼Œå¤§å¤§æé«˜äº†å¹¶å‘æ€§èƒ½ã€‚</p><p>ç®€è€Œè¨€ä¹‹ï¼ŒMVCC çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š</p><ul><li><strong>è¯»ä¸åŠ é”</strong>ï¼šè¯»å–æ•°æ®æ—¶ï¼Œç›´æ¥ä»æ•°æ®çš„å†å²ç‰ˆæœ¬ä¸­è¯»å–ï¼Œä¸éœ€è¦ç­‰å¾…å…¶ä»–äº‹åŠ¡çš„å†™é”ã€‚</li><li><strong>å†™ä¸é˜»å¡è¯»</strong>ï¼šå†™æ“ä½œä¿®æ”¹æ•°æ®æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç‰ˆæœ¬ï¼Œè€Œæ—§ç‰ˆæœ¬ä¾ç„¶ä¿ç•™ï¼Œä¾›å…¶ä»–è¯»äº‹åŠ¡ä½¿ç”¨ã€‚</li></ul><hr><h3 id="MVCC-çš„å®ç°åŸç†"><a href="#MVCC-çš„å®ç°åŸç†" class="headerlink" title="MVCC çš„å®ç°åŸç†"></a><strong>MVCC çš„å®ç°åŸç†</strong></h3><p>MVCC çš„å®ç°é€šå¸¸ä¾èµ–äºä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒè¦ç´ ï¼š</p><ol><li><p>éšè—åˆ—ï¼ˆHidden Columnsï¼‰ï¼š</p><p>æ¯ä¸ªè¡¨éƒ½ä¼šæœ‰å‡ ä¸ªéšè—çš„åˆ—ï¼Œç”¨äºè®°å½•ç‰ˆæœ¬ä¿¡æ¯ï¼š</p><ul><li><strong>DB_TRX_ID</strong>ï¼šäº‹åŠ¡ IDï¼Œè®°å½•æœ€è¿‘ä¸€æ¬¡ä¿®æ”¹æ•°æ®çš„äº‹åŠ¡ IDã€‚</li><li><strong>DB_ROLL_PTR</strong>ï¼šå›æ»šæŒ‡é’ˆï¼ŒæŒ‡å‘è¿™æ¡è®°å½•çš„ä¸Šä¸€ä¸ªç‰ˆæœ¬ã€‚</li><li><strong>DB_ROW_ID</strong>ï¼šè¡Œ IDï¼Œæ˜¯æ’å…¥æ–°è¡Œæ—¶åˆ†é…çš„éšè— IDï¼Œå½“ä¸»é”®æ˜¯å­—ç¬¦ä¸²æ—¶ï¼Œå¯èƒ½ç”¨äºè¾…åŠ©ç´¢å¼•ã€‚</li></ul></li><li><p>Undo Log (å›æ»šæ—¥å¿—)ï¼š</p><p>Undo Log è®°å½•äº†æ•°æ®åœ¨è¢«ä¿®æ”¹ä¹‹å‰çš„å€¼ã€‚æ¯æ¬¡ä¿®æ”¹æ•°æ®æ—¶ï¼Œéƒ½ä¼šå°†ä¿®æ”¹å‰çš„æ•°æ®ç‰ˆæœ¬è®°å½•åœ¨ Undo Log ä¸­ï¼Œå¹¶é€šè¿‡å›æ»šæŒ‡é’ˆ DB_ROLL_PTR å°†æ–°ç‰ˆæœ¬ä¸æ—§ç‰ˆæœ¬è¿æ¥èµ·æ¥ï¼Œå½¢æˆä¸€ä¸ªç‰ˆæœ¬é“¾ã€‚è¿™æ ·ï¼Œé€šè¿‡ç‰ˆæœ¬é“¾ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿½æº¯åˆ°è¿™æ¡æ•°æ®çš„å†å²ç‰ˆæœ¬ã€‚</p></li><li><p>Read View (è¯»è§†å›¾)ï¼š</p><p>Read View æ˜¯ MVCC çš„æ ¸å¿ƒï¼Œå®ƒæ˜¯ä¸€ä¸ªåœ¨äº‹åŠ¡å¯åŠ¨æ—¶ç”Ÿæˆçš„ã€ç”¨æ¥åˆ¤æ–­æŸä¸ªæ•°æ®ç‰ˆæœ¬å¯¹å½“å‰äº‹åŠ¡æ˜¯å¦å¯è§çš„æ•°æ®å¿«ç…§ã€‚å®ƒä¸»è¦åŒ…å«ä»¥ä¸‹å‡ ä¸ªå…³é”®ä¿¡æ¯ï¼š</p><ul><li><code>m_ids</code>ï¼šåœ¨ç”Ÿæˆ <code>Read View</code> æ—¶ï¼Œå½“å‰ç³»ç»Ÿä¸­<strong>æ‰€æœ‰æ´»è·ƒäº‹åŠ¡</strong>çš„ ID åˆ—è¡¨ã€‚</li><li><code>min_trx_id</code>ï¼šåœ¨ç”Ÿæˆ <code>Read View</code> æ—¶ï¼Œ<code>m_ids</code> ä¸­æœ€å°çš„äº‹åŠ¡ IDã€‚</li><li><code>max_trx_id</code>ï¼šåœ¨ç”Ÿæˆ <code>Read View</code> æ—¶ï¼Œç³»ç»Ÿå°†è¦åˆ†é…ç»™ä¸‹ä¸€ä¸ªäº‹åŠ¡çš„ IDã€‚</li><li><code>creator_trx_id</code>ï¼šåˆ›å»º <code>Read View</code> çš„äº‹åŠ¡ IDã€‚</li></ul><p>å½“ä¸€ä¸ªäº‹åŠ¡æƒ³è¦è¯»å–ä¸€æ¡æ•°æ®æ—¶ï¼Œä¼šæ ¹æ® <code>Read View</code> çš„è§„åˆ™æ¥åˆ¤æ–­è¿™æ¡æ•°æ®çš„**<code>DB_TRX_ID</code>**æ˜¯å¦å¯è§ã€‚</p><ul><li>å¦‚æœ <code>DB_TRX_ID</code> å°äº <code>min_trx_id</code>ï¼Œè¯´æ˜è¿™ä¸ªä¿®æ”¹æ“ä½œåœ¨å½“å‰äº‹åŠ¡å¯åŠ¨å‰å°±å·²ç»æäº¤äº†ï¼Œæ•°æ®<strong>å¯è§</strong>ã€‚</li><li>å¦‚æœ <code>DB_TRX_ID</code> å¤§äºç­‰äº <code>max_trx_id</code>ï¼Œè¯´æ˜è¿™ä¸ªä¿®æ”¹æ“ä½œæ˜¯åœ¨å½“å‰äº‹åŠ¡å¯åŠ¨åæ‰å‘ç”Ÿçš„ï¼Œæ•°æ®<strong>ä¸å¯è§</strong>ã€‚</li><li>å¦‚æœ <code>DB_TRX_ID</code> åœ¨ <code>min_trx_id</code> å’Œ <code>max_trx_id</code> ä¹‹é—´ï¼Œé‚£ä¹ˆéœ€è¦åˆ¤æ–­ <code>DB_TRX_ID</code> æ˜¯å¦åœ¨ <code>m_ids</code> åˆ—è¡¨ä¸­ã€‚å¦‚æœåœ¨ï¼Œè¯´æ˜è¿™ä¸ªä¿®æ”¹æ“ä½œæ˜¯å’Œå½“å‰äº‹åŠ¡åŒæ—¶å¯åŠ¨çš„ï¼Œæ•°æ®<strong>ä¸å¯è§</strong>ï¼›å¦‚æœä¸åœ¨ï¼Œè¯´æ˜è¿™ä¸ªä¿®æ”¹æ“ä½œåœ¨å½“å‰äº‹åŠ¡å¯åŠ¨å‰å°±å·²ç»æäº¤äº†ï¼Œæ•°æ®<strong>å¯è§</strong>ã€‚</li></ul><p>å¦‚æœå½“å‰ç‰ˆæœ¬ä¸å¯è§ï¼Œäº‹åŠ¡å°±ä¼šé€šè¿‡å›æ»šæŒ‡é’ˆ <code>DB_ROLL_PTR</code> æ²¿ç€ç‰ˆæœ¬é“¾æ‰¾åˆ°ä¸Šä¸€ç‰ˆæœ¬ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ª<strong>å¯è§</strong>çš„ç‰ˆæœ¬ã€‚</p></li></ol><hr><h3 id="é¢è¯•é¢˜åˆ†æ"><a href="#é¢è¯•é¢˜åˆ†æ" class="headerlink" title="é¢è¯•é¢˜åˆ†æ"></a><strong>é¢è¯•é¢˜åˆ†æ</strong></h3><h4 id="1-ä»€ä¹ˆæ˜¯-MVCCï¼Ÿå®ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ"><a href="#1-ä»€ä¹ˆæ˜¯-MVCCï¼Ÿå®ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ" class="headerlink" title="1. ä»€ä¹ˆæ˜¯ MVCCï¼Ÿå®ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ"></a><strong>1. ä»€ä¹ˆæ˜¯ MVCCï¼Ÿå®ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ</strong></h4><p><strong>å›ç­”è¦ç‚¹ï¼š</strong></p><ul><li><strong>æ¦‚å¿µ</strong>ï¼šå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼Œé€šè¿‡ç»´æŠ¤æ•°æ®å†å²ç‰ˆæœ¬å®ç°å¹¶å‘ã€‚</li><li><strong>è§£å†³é—®é¢˜</strong>ï¼šåœ¨æ•°æ®åº“éš”ç¦»çº§åˆ«ä¸º**è¯»å·²æäº¤ï¼ˆRCï¼‰<strong>å’Œ</strong>å¯é‡å¤è¯»ï¼ˆRRï¼‰**æ—¶ï¼Œå®ç°äº†è¯»å†™ä¸å†²çªã€‚å®ƒè§£å†³äº† <strong>è¯»å†™é”å†²çª</strong> å’Œ <strong>è„è¯»</strong> é—®é¢˜ï¼Œä½†æ— æ³•å®Œå…¨è§£å†³å¹»è¯»ã€‚</li><li><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šè¯»æ“ä½œè¯»å–æ•°æ®å¿«ç…§ï¼Œå†™æ“ä½œåˆ›å»ºæ–°ç‰ˆæœ¬ã€‚</li></ul><h4 id="2-MVCC-æ˜¯å¦‚ä½•å®ç°å¯é‡å¤è¯»ï¼ˆRepeatable-Readï¼‰çš„ï¼Ÿ"><a href="#2-MVCC-æ˜¯å¦‚ä½•å®ç°å¯é‡å¤è¯»ï¼ˆRepeatable-Readï¼‰çš„ï¼Ÿ" class="headerlink" title="2. MVCC æ˜¯å¦‚ä½•å®ç°å¯é‡å¤è¯»ï¼ˆRepeatable Readï¼‰çš„ï¼Ÿ"></a><strong>2. MVCC æ˜¯å¦‚ä½•å®ç°å¯é‡å¤è¯»ï¼ˆRepeatable Readï¼‰çš„ï¼Ÿ</strong></h4><p><strong>å›ç­”è¦ç‚¹ï¼š</strong></p><ul><li><strong>æ ¸å¿ƒ</strong>ï¼š<code>Read View</code> çš„åˆ›å»ºæ—¶æœºã€‚</li><li><strong>å¯é‡å¤è¯»</strong>ï¼šäº‹åŠ¡åœ¨ç¬¬ä¸€æ¬¡è¯»æ“ä½œæ—¶åˆ›å»º <code>Read View</code>ï¼Œå¹¶ä¸”åœ¨<strong>æ•´ä¸ªäº‹åŠ¡çš„ç”Ÿå‘½å‘¨æœŸå†…éƒ½ä½¿ç”¨è¿™ä¸ª Read View</strong>ã€‚è¿™æ„å‘³ç€æ— è®ºäº‹åŠ¡ä¸­æ‰§è¡Œå¤šå°‘æ¬¡è¯»ï¼Œçœ‹åˆ°çš„éƒ½æ˜¯åŒä¸€ä¸ªæ•°æ®å¿«ç…§ï¼Œæ‰€ä»¥èƒ½ä¿è¯å¤šæ¬¡è¯»å–ç»“æœä¸€è‡´ã€‚</li><li><strong>è¯»å·²æäº¤</strong>ï¼šç›¸æ¯”ä¹‹ä¸‹ï¼Œè¯»å·²æäº¤çš„éš”ç¦»çº§åˆ«æ˜¯<strong>æ¯æ¬¡æ‰§è¡Œè¯»æ“ä½œæ—¶éƒ½é‡æ–°ç”Ÿæˆä¸€ä¸ª Read View</strong>ã€‚å› æ­¤ï¼Œå¦‚æœå…¶ä»–äº‹åŠ¡åœ¨ä¸¤æ¬¡è¯»æ“ä½œä¹‹é—´æäº¤äº†ä¿®æ”¹ï¼Œç¬¬äºŒæ¬¡è¯»å°±èƒ½çœ‹åˆ°æ–°æ•°æ®ï¼Œå¯¼è‡´ä¸å¯é‡å¤è¯»ã€‚</li></ul><h4 id="3-MVCC-èƒ½è§£å†³å¹»è¯»å—ï¼Ÿ"><a href="#3-MVCC-èƒ½è§£å†³å¹»è¯»å—ï¼Ÿ" class="headerlink" title="3. MVCC èƒ½è§£å†³å¹»è¯»å—ï¼Ÿ"></a><strong>3. MVCC èƒ½è§£å†³å¹»è¯»å—ï¼Ÿ</strong></h4><p><strong>å›ç­”è¦ç‚¹ï¼š</strong></p><ul><li><strong>éƒ¨åˆ†è§£å†³ï¼Œä½†ä¸èƒ½å®Œå…¨è§£å†³ã€‚</strong></li><li><strong>å¹»è¯»ï¼ˆPhantom Readï¼‰</strong>ï¼šå½“ä¸€ä¸ªäº‹åŠ¡åœ¨ä¸¤æ¬¡æŸ¥è¯¢ä¹‹é—´ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡æ’å…¥äº†æ–°çš„æ•°æ®ï¼Œå¯¼è‡´ç¬¬ä¸€æ¬¡æŸ¥è¯¢ä¸å­˜åœ¨çš„æ•°æ®ï¼Œç¬¬äºŒæ¬¡æŸ¥è¯¢å´å‡ºç°äº†ã€‚</li><li><strong>MVCC çš„ä½œç”¨</strong>ï¼šMVCC å¯ä»¥é˜²æ­¢<strong>æ›´æ–°å¹»è¯»</strong>ï¼ˆå³ä¸€ä¸ªäº‹åŠ¡åœ¨ä¸¤æ¬¡æŸ¥è¯¢ä¹‹é—´ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡æ›´æ–°äº†æ•°æ®ï¼‰ï¼Œå› ä¸ºå®ƒæ€»æ˜¯è¯»å–äº‹åŠ¡å¯åŠ¨æ—¶çš„å¿«ç…§ã€‚</li><li><strong>æ— æ³•è§£å†³</strong>ï¼šMVCC æ— æ³•å®Œå…¨è§£å†³<strong>æ’å…¥å¹»è¯»</strong>ã€‚ä¾‹å¦‚ï¼Œäº‹åŠ¡ A ä¸¤æ¬¡æŸ¥è¯¢ <code>WHERE id &gt; 10</code>ï¼Œä½†åœ¨ä¸¤æ¬¡æŸ¥è¯¢ä¹‹é—´ï¼Œäº‹åŠ¡ B æ’å…¥äº†ä¸€æ¡ <code>id=11</code> çš„è®°å½•å¹¶æäº¤ã€‚è™½ç„¶äº‹åŠ¡ A çš„ <code>Read View</code> çœ‹ä¸åˆ°è¿™æ¡æ–°è®°å½•ï¼Œä½†å¦‚æœäº‹åŠ¡ A æ‰§è¡Œ <code>UPDATE ... WHERE id &gt; 10</code> æ—¶ï¼Œå®ƒä¼šå‘ç°è¿™æ¡æ–°è®°å½•å¹¶å¯¹å…¶åŠ é”ï¼Œä»è€Œæ›´æ–°æˆåŠŸã€‚è¿™ä¼šæ‰“ç ´å¯é‡å¤è¯»çš„æ‰¿è¯ºã€‚</li><li><strong>InnoDB çš„è§£å†³æ–¹æ¡ˆ</strong>ï¼šInnoDB æ•°æ®åº“åœ¨ <code>å¯é‡å¤è¯»</code> éš”ç¦»çº§åˆ«ä¸‹ï¼Œé™¤äº† MVCCï¼Œè¿˜ä¼šç»“åˆ**é—´éš™é”ï¼ˆGap Lockï¼‰**æ¥å½»åº•è§£å†³å¹»è¯»é—®é¢˜ã€‚</li></ul><h4 id="4-Undo-Log-å’Œ-Redo-Log-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#4-Undo-Log-å’Œ-Redo-Log-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="4. Undo Log å’Œ Redo Log æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a><strong>4. Undo Log å’Œ Redo Log æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></h4><p><strong>å›ç­”è¦ç‚¹ï¼š</strong></p><ul><li><strong>Undo Log (å›æ»šæ—¥å¿—)</strong>ï¼š<ul><li><strong>ä½œç”¨</strong>ï¼šç”¨äº<strong>å›æ»šäº‹åŠ¡</strong>å’Œå®ç° <strong>MVCC</strong>ã€‚</li><li><strong>è®°å½•å†…å®¹</strong>ï¼šè®°å½•çš„æ˜¯<strong>æ•°æ®ä¿®æ”¹å‰</strong>çš„ç‰ˆæœ¬ã€‚</li><li><strong>ç”Ÿå‘½å‘¨æœŸ</strong>ï¼šåœ¨äº‹åŠ¡æäº¤åï¼Œå¦‚æœæ•°æ®æœ‰å…¶ä»–äº‹åŠ¡åœ¨ä½¿ç”¨ï¼ˆç”¨äº MVCCï¼‰ï¼Œ<code>Undo Log</code> ä¾ç„¶ä¿ç•™ï¼›å¦‚æœæ²¡æœ‰ï¼Œ<code>Undo Log</code> ä¼šè¢«æ¸…é™¤ã€‚</li></ul></li><li><strong>Redo Log (é‡åšæ—¥å¿—)</strong>ï¼š<ul><li><strong>ä½œç”¨</strong>ï¼šç”¨äºä¿è¯äº‹åŠ¡çš„<strong>æŒä¹…æ€§</strong>ã€‚</li><li><strong>è®°å½•å†…å®¹</strong>ï¼šè®°å½•çš„æ˜¯<strong>æ•°æ®ä¿®æ”¹å</strong>çš„æ—¥å¿—ï¼Œæ¯”å¦‚â€œæŸæŸé¡µçš„æŸæŸåç§»é‡æ”¹æˆäº†æŸæŸå€¼â€ã€‚</li><li><strong>ç”Ÿå‘½å‘¨æœŸ</strong>ï¼šåœ¨æ•°æ®åŒæ­¥åˆ°ç£ç›˜åï¼Œ<code>Redo Log</code> å°±ä¼šè¢«æ¸…é™¤ã€‚</li><li><strong>ä½œç”¨ç‚¹</strong>ï¼š<code>Redo Log</code> ä½œç”¨äº<strong>å´©æºƒæ¢å¤</strong>ã€‚å½“æ•°æ®åº“å‘ç”Ÿå®•æœºæ—¶ï¼Œå¯ä»¥æ ¹æ® <code>Redo Log</code> å°†å·²æäº¤ä½†å°šæœªå†™å…¥ç£ç›˜çš„æ•°æ®é‡æ–°å†™å…¥ï¼Œä»¥ä¿è¯æ•°æ®ä¸ä¸¢å¤±ã€‚</li></ul></li></ul><h2 id="MySQLæ—¥å¿—"><a href="#MySQLæ—¥å¿—" class="headerlink" title="MySQLæ—¥å¿—"></a>MySQLæ—¥å¿—</h2><p>MySQLçš„æ—¥å¿—ç³»ç»Ÿæ˜¯å…¶æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ(DBMS)ä¸­è‡³å…³é‡è¦çš„ç»„æˆéƒ¨åˆ†ï¼Œæ‰®æ¼”ç€ç›‘æ§ã€å®¡è®¡ã€æ•…éšœæ¢å¤å’Œæ•°æ®å¤åˆ¶ç­‰å¤šç§å…³é”®è§’è‰²ã€‚ç”¨æˆ·æåˆ°çš„é”™è¯¯æ—¥å¿—ã€æŸ¥è¯¢æ—¥å¿—ã€æ…¢æŸ¥è¯¢æ—¥å¿—ã€äº‹åŠ¡æ—¥å¿—å’ŒäºŒè¿›åˆ¶æ—¥å¿—æ„æˆäº†MySQLæ—¥å¿—ä½“ç³»çš„æ ¸å¿ƒã€‚ä¸‹é¢å°†å¯¹è¿™äº›ä¸»è¦æ—¥å¿—è¿›è¡Œè¯¦ç»†çš„æ¢³ç†å’Œè§£æã€‚</p><h2 id="1-é”™è¯¯æ—¥å¿—-Error-Log"><a href="#1-é”™è¯¯æ—¥å¿—-Error-Log" class="headerlink" title="1. é”™è¯¯æ—¥å¿—(Error Log)"></a>1. é”™è¯¯æ—¥å¿—(Error Log)</h2><p>é”™è¯¯æ—¥å¿—æ˜¯MySQLä¸­æœ€åŸºç¡€çš„æ—¥å¿—ä¹‹ä¸€ï¼Œå®ƒè®°å½•äº†mysqldæœåŠ¡å™¨å¯åŠ¨ã€è¿è¡Œå’Œå…³é—­è¿‡ç¨‹ä¸­é‡åˆ°çš„æ‰€æœ‰ä¸¥é‡é”™è¯¯å’Œè­¦å‘Šã€‚</p><ul><li>ä¸»è¦å†…å®¹ï¼š<ul><li>æœåŠ¡å™¨å¯åŠ¨å’Œå…³é—­çš„è¯¦ç»†ä¿¡æ¯ã€‚</li><li>è¿è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿçš„é”™è¯¯ï¼Œä¾‹å¦‚è¡¨æŸåã€æ— æ³•è®¿é—®ç‰¹å®šæ–‡ä»¶ç­‰ã€‚</li><li>äº‹ä»¶è°ƒåº¦å™¨è¿è¡Œå‡ºé”™æ—¶çš„ä¿¡æ¯ã€‚</li><li>åœ¨ä¸»ä»å¤åˆ¶æ¶æ„ä¸­ï¼Œä»æœåŠ¡å™¨ä¸Šå¯åŠ¨å’Œå…³é—­å¤åˆ¶çº¿ç¨‹ï¼Œè¿æ¥ä¸»æœåŠ¡å™¨æ—¶å‘ç”Ÿçš„é”™è¯¯ç­‰ã€‚</li></ul></li><li>ä½œç”¨ï¼šé”™è¯¯æ—¥å¿—æ˜¯è¯Šæ–­å’Œè§£å†³MySQLæœåŠ¡å™¨é—®é¢˜çš„é¦–è¦å·¥å…·ã€‚å½“æ•°æ®åº“æ— æ³•å¯åŠ¨æˆ–è¿è¡Œå¼‚å¸¸æ—¶ï¼Œåº”é¦–å…ˆæ£€æŸ¥æ­¤æ—¥å¿—ã€‚</li><li>é…ç½®ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œé”™è¯¯æ—¥å¿—æ˜¯å¼€å¯çš„ã€‚å…¶æ–‡ä»¶åé€šå¸¸ä¸º<hostname>.errï¼Œä½äºæ•°æ®ç›®å½•(datadir)ä¸‹ã€‚å¯ä»¥é€šè¿‡åœ¨my.cnfæˆ–my.inié…ç½®æ–‡ä»¶ä¸­è®¾ç½®log_errorå˜é‡æ¥æŒ‡å®šå…¶è·¯å¾„ã€‚</li></ul><h2 id="2-æŸ¥è¯¢æ—¥å¿—-Query-Log-é€šç”¨æŸ¥è¯¢æ—¥å¿—-General-Query-Log"><a href="#2-æŸ¥è¯¢æ—¥å¿—-Query-Log-é€šç”¨æŸ¥è¯¢æ—¥å¿—-General-Query-Log" class="headerlink" title="2. æŸ¥è¯¢æ—¥å¿—(Query Log)&#x2F;é€šç”¨æŸ¥è¯¢æ—¥å¿—(General Query Log)"></a>2. æŸ¥è¯¢æ—¥å¿—(Query Log)&#x2F;é€šç”¨æŸ¥è¯¢æ—¥å¿—(General Query Log)</h2><p>é€šç”¨æŸ¥è¯¢æ—¥å¿—è®°å½•äº†MySQLæœåŠ¡å™¨æ¥æ”¶åˆ°çš„æ¯ä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥å’Œæ‰§è¡Œçš„æ¯ä¸€æ¡SQLè¯­å¥ã€‚</p><ul><li>ä¸»è¦å†…å®¹ï¼š<ul><li>å®¢æˆ·ç«¯çš„è¿æ¥ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¿æ¥æ—¶é—´ã€ç”¨æˆ·åå’Œä¸»æœºã€‚</li><li>å®¢æˆ·ç«¯å‘é€ç»™æœåŠ¡å™¨çš„æ‰€æœ‰SQLè¯­å¥ï¼Œæ— è®ºå…¶æ˜¯å¦æ­£ç¡®æ‰§è¡Œã€‚</li></ul></li><li>ä½œç”¨ï¼šè¯¥æ—¥å¿—å¯¹äºæ•°æ®åº“çš„å®¡è®¡å’Œé—®é¢˜æ’æŸ¥éå¸¸æœ‰ç”¨ï¼Œå¯ä»¥ç²¾ç¡®å¤ç°ç”¨æˆ·çš„æ“ä½œåºåˆ—ã€‚ç„¶è€Œï¼Œç”±äºå®ƒä¼šè®°å½•æ‰€æœ‰æ“ä½œï¼Œå¯¹ç³»ç»Ÿæ€§èƒ½ä¼šäº§ç”Ÿæ˜¾è‘—å½±å“ï¼Œå¹¶ä¼šè¿…é€Ÿå ç”¨å¤§é‡ç£ç›˜ç©ºé—´ã€‚å› æ­¤ï¼Œä¸å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­é•¿æœŸå¼€å¯ã€‚</li><li>é…ç½®ï¼šé»˜è®¤å…³é—­ã€‚å¯ä»¥é€šè¿‡è®¾ç½®general_logä¸ºONæ¥å¯ç”¨ï¼Œå¹¶ä½¿ç”¨general_log_fileæŒ‡å®šæ—¥å¿—æ–‡ä»¶è·¯å¾„ã€‚</li></ul><h2 id="3-æ…¢æŸ¥è¯¢æ—¥å¿—-Slow-Query-Log"><a href="#3-æ…¢æŸ¥è¯¢æ—¥å¿—-Slow-Query-Log" class="headerlink" title="3. æ…¢æŸ¥è¯¢æ—¥å¿—(Slow Query Log)"></a>3. æ…¢æŸ¥è¯¢æ—¥å¿—(Slow Query Log)</h2><p>æ…¢æŸ¥è¯¢æ—¥å¿—ç”¨äºè®°å½•æ‰§è¡Œæ—¶é—´è¶…è¿‡æŒ‡å®šé˜ˆå€¼çš„SQLæŸ¥è¯¢è¯­å¥ï¼Œæ˜¯æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–çš„å…³é”®å·¥å…·ã€‚</p><ul><li>ä¸»è¦å†…å®¹ï¼š<ul><li>æ‰§è¡Œæ—¶é—´è¶…è¿‡long_query_timeé˜ˆå€¼çš„SQLè¯­å¥ã€‚</li><li>æŸ¥è¯¢æ‰§è¡Œæ—¶çš„ç›¸å…³ä¿¡æ¯ï¼Œå¦‚æ‰§è¡Œæ—¶é—´ã€é”å®šæ—¶é—´ã€æ‰«æçš„è¡Œæ•°ã€è¿”å›çš„è¡Œæ•°ä»¥åŠæ‰§è¡Œè¯¥æŸ¥è¯¢çš„ç”¨æˆ·å’Œä¸»æœºã€‚</li></ul></li><li>ä½œç”¨ï¼šé€šè¿‡åˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œå¼€å‘è€…å’Œæ•°æ®åº“ç®¡ç†å‘˜(DBA)å¯ä»¥å®šä½åˆ°æ•ˆç‡ä½ä¸‹çš„SQLè¯­å¥ï¼Œå¹¶é’ˆå¯¹æ€§åœ°è¿›è¡Œä¼˜åŒ–ï¼Œä¾‹å¦‚æ·»åŠ ç´¢å¼•ã€æ”¹å†™æŸ¥è¯¢ç­‰ã€‚</li><li>é…ç½®ï¼šé»˜è®¤å…³é—­ã€‚éœ€åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®slow_query_logä¸ºONå¼€å¯ã€‚long_query_timeå‚æ•°ç”¨äºè®¾å®šæ…¢æŸ¥è¯¢çš„æ—¶é—´é˜ˆå€¼(å•ä½ï¼šç§’)ï¼Œslow_query_log_fileç”¨äºæŒ‡å®šæ—¥å¿—æ–‡ä»¶ä½ç½®ã€‚log_queries_not_using_indexeså‚æ•°è¿˜å¯ä»¥è®°å½•æœªä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢ã€‚</li></ul><h2 id="4-äº‹åŠ¡æ—¥å¿—-Transaction-Log"><a href="#4-äº‹åŠ¡æ—¥å¿—-Transaction-Log" class="headerlink" title="4. äº‹åŠ¡æ—¥å¿—(Transaction Log)"></a>4. äº‹åŠ¡æ—¥å¿—(Transaction Log)</h2><p>ç”¨æˆ·æåˆ°çš„â€äº‹åŠ¡æ—¥å¿—â€åœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼Œä¸»è¦ç”±ä¸¤ç§æ—¥å¿—æ„æˆï¼šé‡åšæ—¥å¿—(Redo Log)å’Œå›æ»šæ—¥å¿—(Undo Log)ã€‚å®ƒä»¬å…±åŒä¿è¯äº†äº‹åŠ¡çš„ACIDç‰¹æ€§(åŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§ã€æŒä¹…æ€§)ã€‚</p><ul><li>é‡åšæ—¥å¿—(Redo Log):<ul><li>ä½œç”¨ï¼šä¿è¯äº‹åŠ¡çš„æŒä¹…æ€§ã€‚å®ƒè®°å½•äº†æ•°æ®è¢«ä¿®æ”¹åçš„ç‰©ç†å˜åŒ–ã€‚å½“äº‹åŠ¡æäº¤åï¼Œå³ä½¿æ•°æ®å°šæœªå®Œå…¨å†™å…¥æ•°æ®æ–‡ä»¶ï¼Œåªè¦Redo Logå·²ç»æŒä¹…åŒ–ï¼Œåœ¨æ•°æ®åº“å‘ç”Ÿå´©æºƒæ—¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡é‡æ”¾Redo Logæ¥æ¢å¤å·²æäº¤çš„äº‹åŠ¡ï¼Œç¡®ä¿æ•°æ®ä¸ä¸¢å¤±ã€‚è¿™ç§æŠ€æœ¯è¢«ç§°ä¸ºé¢„å†™æ—¥å¿—(Write-Ahead Logging, WAL)ã€‚</li><li>ç‰¹ç‚¹ï¼šRedo Logæ˜¯ä»¥å¾ªç¯å†™çš„æ–¹å¼è®°å½•åœ¨è¿ç»­çš„ç‰©ç†æ–‡ä»¶ä¸­ï¼Œå¤§å°å›ºå®šã€‚</li></ul></li><li>å›æ»šæ—¥å¿—(Undo Log):<ul><li>ä½œç”¨ï¼šä¿è¯äº‹åŠ¡çš„åŸå­æ€§å’Œå®ç°å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶(MVCC)ã€‚Undo Logè®°å½•çš„æ˜¯æ•°æ®è¢«ä¿®æ”¹å‰çš„çŠ¶æ€ã€‚å½“äº‹åŠ¡éœ€è¦å›æ»šæ—¶ï¼Œå¯ä»¥é€šè¿‡Undo Logå°†æ•°æ®æ¢å¤åˆ°ä¿®æ”¹ä¹‹å‰çš„ç‰ˆæœ¬ã€‚åŒæ—¶ï¼Œåœ¨è¯»å·²æäº¤(Read Committed)å’Œå¯é‡å¤è¯»(Repeatable Read)éš”ç¦»çº§åˆ«ä¸‹ï¼Œå½“ä¸€ä¸ªäº‹åŠ¡éœ€è¦è¯»å–è¢«å¦ä¸€ä¸ªæœªæäº¤äº‹åŠ¡ä¿®æ”¹çš„è¡Œæ—¶ï¼Œä¼šé€šè¿‡Undo Logè¯»å–è¯¥è¡Œä¹‹å‰çš„ç‰ˆæœ¬ï¼Œä»è€Œå®ç°éé”å®šè¯»ã€‚</li><li>ç‰¹ç‚¹ï¼šUndo Logé€»è¾‘ä¸Šè®°å½•äº†æ¯ä¸ªä¿®æ”¹æ“ä½œçš„é€†æ“ä½œã€‚</li></ul></li></ul><h2 id="5-äºŒè¿›åˆ¶æ—¥å¿—-Binary-Log-Binlog"><a href="#5-äºŒè¿›åˆ¶æ—¥å¿—-Binary-Log-Binlog" class="headerlink" title="5. äºŒè¿›åˆ¶æ—¥å¿—(Binary Log&#x2F;Binlog)"></a>5. äºŒè¿›åˆ¶æ—¥å¿—(Binary Log&#x2F;Binlog)</h2><p>äºŒè¿›åˆ¶æ—¥å¿—æ˜¯MySQLä¸­åŠŸèƒ½æœ€å¼ºå¤§ã€ç”¨é€”æœ€å¹¿æ³›çš„æ—¥å¿—ä¹‹ä¸€ã€‚å®ƒä»¥äºŒè¿›åˆ¶æ ¼å¼è®°å½•äº†æ‰€æœ‰ä¿®æ”¹æ•°æ®åº“æ•°æ®çš„æ“ä½œ(DML)ä»¥åŠæ•°æ®å®šä¹‰è¯­è¨€(DDL)çš„æ“ä½œï¼Œä½†ä¸åŒ…æ‹¬SELECTå’ŒSHOWç­‰ä¸ä¿®æ”¹æ•°æ®çš„æŸ¥è¯¢ã€‚</p><ul><li>ä¸»è¦å†…å®¹ï¼šè®°å½•äº†å¯¼è‡´æ•°æ®å‘ç”Ÿæ›´æ”¹çš„æ‰€æœ‰äº‹ä»¶ã€‚æ ¹æ®æ ¼å¼ä¸åŒï¼Œå¯ä»¥è®°å½•ä¸ºSQLè¯­å¥(STATEMENTæ ¼å¼)ã€è¡Œçš„å˜æ›´(ROWæ ¼å¼)æˆ–ä¸¤è€…çš„æ··åˆ(MIXEDæ ¼å¼)ã€‚</li><li>ä¸»è¦ä½œç”¨ï¼š<ul><li>æ•°æ®æ¢å¤(Point-in-Time Recovery)ï¼šé€šè¿‡å¤‡ä»½çš„æ•°æ®æ–‡ä»¶å’Œä¹‹åçš„äºŒè¿›åˆ¶æ—¥å¿—ï¼Œå¯ä»¥å°†æ•°æ®åº“æ¢å¤åˆ°è¿‡å»çš„ä»»æ„ä¸€ä¸ªæ—¶é—´ç‚¹ã€‚</li><li>ä¸»ä»å¤åˆ¶(Replication)ï¼šåœ¨ä¸»ä»æ¶æ„ä¸­ï¼Œä¸»æœåŠ¡å™¨å°†äºŒè¿›åˆ¶æ—¥å¿—ä¼ é€ç»™ä»æœåŠ¡å™¨ï¼Œä»æœåŠ¡å™¨é‡æ”¾è¿™äº›æ—¥å¿—ä¸­çš„äº‹ä»¶ï¼Œä»è€Œå®ç°ä¸ä¸»æœåŠ¡å™¨çš„æ•°æ®åŒæ­¥ã€‚</li></ul></li><li>é…ç½®ï¼šé»˜è®¤æƒ…å†µä¸‹å¯èƒ½å…³é—­ï¼Œéœ€è¦é€šè¿‡é…ç½®æ–‡ä»¶ä¸­çš„log_biné€‰é¡¹æ¥å¯ç”¨ã€‚å¯ç”¨åï¼Œä¼šç”Ÿæˆä¸€ä¸ªç´¢å¼•æ–‡ä»¶(é»˜è®¤ä¸º<hostname>-bin.index)å’Œä¸€ç³»åˆ—çš„äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ã€‚</li></ul><h2 id="æ‰©å±•ï¼šä¸­ç»§æ—¥å¿—-Relay-Log"><a href="#æ‰©å±•ï¼šä¸­ç»§æ—¥å¿—-Relay-Log" class="headerlink" title="æ‰©å±•ï¼šä¸­ç»§æ—¥å¿—(Relay Log)"></a>æ‰©å±•ï¼šä¸­ç»§æ—¥å¿—(Relay Log)</h2><p>åœ¨ä¸»ä»å¤åˆ¶ç¯å¢ƒä¸­ï¼Œè¿˜æœ‰ä¸€ä¸ªé‡è¦çš„æ—¥å¿—ç±»å‹â€”â€”ä¸­ç»§æ—¥å¿—ã€‚</p><ul><li>ä½œç”¨ï¼šä»æœåŠ¡å™¨çš„I&#x2F;Oçº¿ç¨‹ä»ä¸»æœåŠ¡å™¨è·å–äºŒè¿›åˆ¶æ—¥å¿—ï¼Œå¹¶å°†å…¶å†™å…¥æœ¬åœ°çš„ä¸­ç»§æ—¥å¿—ä¸­ã€‚ç„¶åï¼Œä»æœåŠ¡å™¨çš„SQLçº¿ç¨‹è¯»å–ä¸­ç»§æ—¥å¿—ä¸­çš„äº‹ä»¶ï¼Œå¹¶åœ¨ä»æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼Œä»¥å®ç°æ•°æ®åŒæ­¥ã€‚</li><li>ç‰¹ç‚¹ï¼šä¸­ç»§æ—¥å¿—çš„æ ¼å¼ä¸äºŒè¿›åˆ¶æ—¥å¿—å®Œå…¨ç›¸åŒã€‚å®ƒçš„å­˜åœ¨ä½¿å¾—ä»æœåŠ¡å™¨çš„I&#x2F;Oå’ŒSQLæ‰§è¡Œå¯ä»¥è§£è€¦ï¼Œå³ä½¿åœ¨ç½‘ç»œä¸ç¨³å®šçš„æƒ…å†µä¸‹ï¼Œåªè¦I&#x2F;Oçº¿ç¨‹å°†æ—¥å¿—æ‹‰åˆ°æœ¬åœ°ï¼ŒSQLçº¿ç¨‹å°±å¯ä»¥æŒç»­æ‰§è¡Œã€‚</li></ul><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><table><thead><tr><th>æ—¥å¿—ç±»å‹</th><th>ä¸»è¦ä½œç”¨</th><th>ç”Ÿäº§ç¯å¢ƒå»ºè®®</th></tr></thead><tbody><tr><td>é”™è¯¯æ—¥å¿—</td><td>è®°å½•æœåŠ¡å™¨å¯åœå’Œè¿è¡Œé”™è¯¯</td><td>å§‹ç»ˆå¼€å¯</td></tr><tr><td>æŸ¥è¯¢æ—¥å¿—</td><td>è®°å½•æ‰€æœ‰è¿æ¥å’ŒSQLè¯­å¥ï¼Œç”¨äºå®¡è®¡</td><td>é»˜è®¤å…³é—­ï¼Œä»…åœ¨è°ƒè¯•æ—¶çŸ­æœŸå¼€å¯</td></tr><tr><td>æ…¢æŸ¥è¯¢æ—¥å¿—</td><td>è®°å½•æ‰§è¡Œç¼“æ…¢çš„SQLï¼Œç”¨äºæ€§èƒ½ä¼˜åŒ–</td><td>å»ºè®®å¼€å¯</td></tr><tr><td>äº‹åŠ¡æ—¥å¿—</td><td></td><td></td></tr><tr><td>- Redo Log</td><td>ä¿è¯äº‹åŠ¡æŒä¹…æ€§ï¼Œç”¨äºå´©æºƒæ¢å¤</td><td>InnoDBå¼•æ“æ ¸å¿ƒç»„ä»¶ï¼Œå§‹ç»ˆå¼€å¯</td></tr><tr><td>- Undo Log</td><td>ä¿è¯äº‹åŠ¡åŸå­æ€§ï¼Œæ”¯æŒMVCC</td><td>InnoDBå¼•æ“æ ¸å¿ƒç»„ä»¶ï¼Œå§‹ç»ˆå¼€å¯</td></tr><tr><td>äºŒè¿›åˆ¶æ—¥å¿—</td><td>æ•°æ®æ¢å¤ã€ä¸»ä»å¤åˆ¶</td><td>å¼ºçƒˆå»ºè®®å¼€å¯ï¼Œå°¤å…¶æ˜¯éœ€è¦æ•°æ®æ¢å¤å’Œå¤åˆ¶çš„åœºæ™¯</td></tr><tr><td>ä¸­ç»§æ—¥å¿—</td><td>ä¸»ä»å¤åˆ¶ä¸­ï¼Œä»åº“ç”¨äºæš‚å­˜ä¸»åº“çš„äºŒè¿›åˆ¶æ—¥å¿—</td><td>åœ¨ä»æœåŠ¡å™¨ä¸Šè‡ªåŠ¨åˆ›å»ºå’Œç®¡ç†</td></tr></tbody></table><h2 id="MySQLä¸­çš„é”"><a href="#MySQLä¸­çš„é”" class="headerlink" title="MySQLä¸­çš„é”"></a>MySQLä¸­çš„é”</h2><h2 id="ç¬¬ä¸€éƒ¨åˆ†ï¼šæ•°æ®åº“é”ç³»ç»Ÿ"><a href="#ç¬¬ä¸€éƒ¨åˆ†ï¼šæ•°æ®åº“é”ç³»ç»Ÿ" class="headerlink" title="ç¬¬ä¸€éƒ¨åˆ†ï¼šæ•°æ®åº“é”ç³»ç»Ÿ"></a>ç¬¬ä¸€éƒ¨åˆ†ï¼šæ•°æ®åº“é”ç³»ç»Ÿ</h2><h3 id="1-é”çš„åˆ†ç±»ä½“ç³»"><a href="#1-é”çš„åˆ†ç±»ä½“ç³»" class="headerlink" title="1. é”çš„åˆ†ç±»ä½“ç³»"></a>1. é”çš„åˆ†ç±»ä½“ç³»</h3><h4 id="1-1-æŒ‰é”ç²’åº¦çš„å±‚æ¬¡åˆ†ç±»"><a href="#1-1-æŒ‰é”ç²’åº¦çš„å±‚æ¬¡åˆ†ç±»" class="headerlink" title="1.1 æŒ‰é”ç²’åº¦çš„å±‚æ¬¡åˆ†ç±»"></a>1.1 æŒ‰é”ç²’åº¦çš„å±‚æ¬¡åˆ†ç±»</h4><p><strong>è¡¨çº§é”ï¼ˆTable-Level Lockï¼‰</strong> è¡¨çº§é”æ˜¯æœ€ç²—ç²’åº¦çš„é”æœºåˆ¶ï¼Œä¸€æ¬¡é”å®šæ•´ä¸ªè¡¨çš„æ‰€æœ‰æ•°æ®ã€‚MyISAMå­˜å‚¨å¼•æ“ä¸»è¦ä½¿ç”¨è¡¨çº§é”ï¼Œå…¶å†…éƒ¨ç»´æŠ¤ä¸€ä¸ªå…¨å±€çš„è¡¨é”åˆ—è¡¨ã€‚å½“çº¿ç¨‹éœ€è¦è®¿é—®è¡¨æ—¶ï¼Œé¦–å…ˆæ£€æŸ¥è¡¨é”çŠ¶æ€ï¼Œå¦‚æœè¡¨å·²è¢«å…¶ä»–çº¿ç¨‹ä»¥ä¸å…¼å®¹æ¨¡å¼é”å®šï¼Œåˆ™å½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾…é˜Ÿåˆ—ã€‚è¡¨çº§é”çš„ä¼˜åŠ¿åœ¨äºé”ç®¡ç†å¼€é”€æå°ï¼Œåªéœ€è¦ç»´æŠ¤å°‘é‡çš„é”å¯¹è±¡ï¼›ç¼ºç‚¹æ˜¯å¹¶å‘åº¦æä½ï¼Œå³ä½¿è®¿é—®ä¸åŒè¡Œçš„æ“ä½œä¹Ÿä¼šç›¸äº’é˜»å¡ã€‚</p><p><strong>é¡µçº§é”ï¼ˆPage-Level Lockï¼‰</strong> é¡µçº§é”é”å®šæ•°æ®é¡µï¼Œæ˜¯è¡¨çº§é”å’Œè¡Œçº§é”çš„æŠ˜ä¸­æ–¹æ¡ˆã€‚BDBå­˜å‚¨å¼•æ“ä½¿ç”¨é¡µçº§é”ï¼Œæ¯ä¸ªæ•°æ®é¡µé€šå¸¸åŒ…å«å¤šæ¡è®°å½•ã€‚é¡µçº§é”çš„å®ç°éœ€è¦åœ¨é¡µå¤´ç»´æŠ¤é”ä¿¡æ¯ï¼ŒåŒ…æ‹¬é”æ¨¡å¼ã€æŒæœ‰è€…ä¿¡æ¯ç­‰ã€‚è¿™ç§é”ç²’åº¦åœ¨ç©ºé—´å±€éƒ¨æ€§è¾ƒå¥½çš„åº”ç”¨ä¸­è¡¨ç°ä¼˜ç§€ï¼Œå› ä¸ºç›¸å…³çš„æ•°æ®é€šå¸¸å­˜å‚¨åœ¨ç›¸é‚»çš„é¡µé¢ä¸­ã€‚</p><p><strong>è¡Œçº§é”ï¼ˆRow-Level Lockï¼‰</strong> è¡Œçº§é”æ˜¯æœ€ç»†ç²’åº¦çš„é”æœºåˆ¶ï¼ŒInnoDBå­˜å‚¨å¼•æ“çš„æ ¸å¿ƒç‰¹æ€§ã€‚è¡Œé”çš„å®ç°ä¾èµ–äºç´¢å¼•ç»“æ„ï¼Œå®é™…ä¸Šé”å®šçš„æ˜¯ç´¢å¼•è®°å½•è€Œä¸æ˜¯æ•°æ®è¡Œæœ¬èº«ã€‚å½“æŸ¥è¯¢æ²¡æœ‰ä½¿ç”¨ç´¢å¼•æ—¶ï¼ŒInnoDBä¼šæ‰«ææ•´ä¸ªè¡¨å¹¶å¯¹æ‰€æœ‰è®°å½•åŠ é”ï¼Œé€€åŒ–ä¸ºç±»ä¼¼è¡¨é”çš„è¡Œä¸ºã€‚è¡Œçº§é”æä¾›æœ€é«˜çš„å¹¶å‘åº¦ï¼Œä½†ä¹Ÿå¸¦æ¥æœ€å¤§çš„ç®¡ç†å¼€é”€ã€‚</p><h4 id="1-2-æŒ‰é”æ¨¡å¼çš„åŠŸèƒ½åˆ†ç±»"><a href="#1-2-æŒ‰é”æ¨¡å¼çš„åŠŸèƒ½åˆ†ç±»" class="headerlink" title="1.2 æŒ‰é”æ¨¡å¼çš„åŠŸèƒ½åˆ†ç±»"></a>1.2 æŒ‰é”æ¨¡å¼çš„åŠŸèƒ½åˆ†ç±»</h4><p><strong>å…±äº«é”ï¼ˆShared Lock, Sé”ï¼‰</strong> å…±äº«é”å…è®¸å¤šä¸ªäº‹åŠ¡åŒæ—¶è¯»å–åŒä¸€èµ„æºï¼Œä½†é˜»æ­¢ä»»ä½•äº‹åŠ¡ä¿®æ”¹è¯¥èµ„æºã€‚åœ¨InnoDBä¸­ï¼Œå…±äº«é”é€šè¿‡åœ¨é”å¯¹è±¡çš„type_modeå­—æ®µä¸­è®¾ç½®LOCK_Sæ ‡å¿—ä½æ¥æ ‡è¯†ã€‚å¤šä¸ªå…±äº«é”å¯ä»¥å¹¶å­˜ï¼Œè¿™æ˜¯é€šè¿‡é”å…¼å®¹æ€§çŸ©é˜µæ¥åˆ¤æ–­çš„ã€‚å…±äº«é”çš„è·å–ç›¸å¯¹ç®€å•ï¼Œåªéœ€è¦æ£€æŸ¥æ˜¯å¦å­˜åœ¨å†²çªçš„æ’ä»–é”ã€‚</p><p><strong>æ’ä»–é”ï¼ˆExclusive Lock, Xé”ï¼‰</strong> æ’ä»–é”æä¾›ç‹¬å è®¿é—®ï¼ŒåŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªäº‹åŠ¡æŒæœ‰èµ„æºçš„æ’ä»–é”ã€‚æ’ä»–é”ä¸ä»»ä½•å…¶ä»–é”éƒ½ä¸å…¼å®¹ï¼ŒåŒ…æ‹¬å…±äº«é”å’Œå…¶ä»–æ’ä»–é”ã€‚åœ¨InnoDBå®ç°ä¸­ï¼Œæ’ä»–é”çš„è·å–éœ€è¦ç­‰å¾…æ‰€æœ‰ç°æœ‰çš„é”é‡Šæ”¾ï¼Œè¿™é€šè¿‡ç­‰å¾…é˜Ÿåˆ—æœºåˆ¶æ¥å®ç°ã€‚</p><p><strong>æ„å‘é”ï¼ˆIntention Lockï¼‰</strong> æ„å‘é”æ˜¯ä¸€ç§è¡¨çº§é”ï¼Œç”¨äºè¡¨æ˜äº‹åŠ¡åœ¨è¡¨çš„æŸäº›è¡Œä¸ŠæŒæœ‰æˆ–å³å°†è¯·æ±‚æŸç§ç±»å‹çš„é”ã€‚æ„å‘å…±äº«é”ï¼ˆISï¼‰è¡¨ç¤ºäº‹åŠ¡æ„å›¾åœ¨æŸäº›è¡Œä¸Šè·å–å…±äº«é”ï¼Œæ„å‘æ’ä»–é”ï¼ˆIXï¼‰è¡¨ç¤ºäº‹åŠ¡æ„å›¾åœ¨æŸäº›è¡Œä¸Šè·å–æ’ä»–é”ã€‚æ„å‘é”çš„å¼•å…¥å¤§å¤§ç®€åŒ–äº†è¡¨çº§æ“ä½œçš„é”å†²çªæ£€æµ‹ï¼Œé¿å…äº†éå†æ‰€æœ‰è¡Œé”çš„å¼€é”€ã€‚</p><h4 id="1-3-æŒ‰é”ç®—æ³•çš„å®ç°åˆ†ç±»"><a href="#1-3-æŒ‰é”ç®—æ³•çš„å®ç°åˆ†ç±»" class="headerlink" title="1.3 æŒ‰é”ç®—æ³•çš„å®ç°åˆ†ç±»"></a>1.3 æŒ‰é”ç®—æ³•çš„å®ç°åˆ†ç±»</h4><p><strong>è®°å½•é”ï¼ˆRecord Lockï¼‰</strong> è®°å½•é”é”å®šç´¢å¼•ä¸­çš„ä¸€æ¡å…·ä½“è®°å½•ï¼Œæ˜¯æœ€åŸºæœ¬çš„è¡Œçº§é”å½¢å¼ã€‚åœ¨InnoDBçš„å®ç°ä¸­ï¼Œè®°å½•é”é€šè¿‡åœ¨B+æ ‘çš„å¶å­èŠ‚ç‚¹è®°å½•ä¸Šè®¾ç½®é”æ ‡è®°æ¥å®ç°ã€‚é”å¯¹è±¡ä¸­çš„heap_noå­—æ®µç²¾ç¡®æ ‡è¯†è¢«é”å®šçš„è®°å½•åœ¨é¡µé¢ä¸­çš„ä½ç½®ã€‚è®°å½•é”åªèƒ½é˜²æ­¢å…¶ä»–äº‹åŠ¡ä¿®æ”¹æˆ–åˆ é™¤è¯¥è®°å½•ï¼Œä½†ä¸èƒ½é˜²æ­¢åœ¨è¯¥è®°å½•å‰åæ’å…¥æ–°è®°å½•ã€‚</p><p><strong>é—´éš™é”ï¼ˆGap Lockï¼‰</strong> é—´éš™é”é”å®šç´¢å¼•è®°å½•ä¹‹é—´çš„é—´éš™ï¼Œé˜²æ­¢å…¶ä»–äº‹åŠ¡åœ¨è¯¥é—´éš™ä¸­æ’å…¥æ–°è®°å½•ã€‚é—´éš™é”çš„èŒƒå›´æ˜¯å¼€åŒºé—´ï¼Œä¸åŒ…å«è¾¹ç•Œè®°å½•æœ¬èº«ã€‚InnoDBé€šè¿‡æ¯”è¾ƒç´¢å¼•é”®å€¼æ¥ç¡®å®šé—´éš™çš„è¾¹ç•Œï¼Œå¯¹äºå¤åˆç´¢å¼•ï¼Œé—´éš™çš„æ¯”è¾ƒéœ€è¦è€ƒè™‘æ‰€æœ‰é”®å€¼åˆ—çš„ç»„åˆã€‚é—´éš™é”ä¹‹é—´ä¸å†²çªï¼Œå¤šä¸ªäº‹åŠ¡å¯ä»¥åŒæ—¶æŒæœ‰ç›¸åŒé—´éš™çš„é—´éš™é”ã€‚</p><p><strong>ä¸´é”®é”ï¼ˆNext-Key Lockï¼‰</strong> ä¸´é”®é”æ˜¯è®°å½•é”å’Œé—´éš™é”çš„ç»„åˆï¼Œé”å®šä¸€ä¸ªè®°å½•ä»¥åŠè¯¥è®°å½•å‰é¢çš„é—´éš™ã€‚è¿™æ˜¯InnoDBåœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹çš„é»˜è®¤é”ç®—æ³•ã€‚ä¸´é”®é”æœ‰æ•ˆè§£å†³äº†å¹»è¯»é—®é¢˜ï¼Œå› ä¸ºå®ƒä¸ä»…é”å®šå·²å­˜åœ¨çš„è®°å½•ï¼Œè¿˜é”å®šäº†å¯èƒ½æ’å…¥æ–°è®°å½•çš„ä½ç½®ã€‚ä¸´é”®é”çš„èŒƒå›´æ˜¯å·¦å¼€å³é—­åŒºé—´ã€‚</p><h3 id="2-InnoDBé”ç³»ç»Ÿçš„æ·±å±‚å®ç°"><a href="#2-InnoDBé”ç³»ç»Ÿçš„æ·±å±‚å®ç°" class="headerlink" title="2. InnoDBé”ç³»ç»Ÿçš„æ·±å±‚å®ç°"></a>2. InnoDBé”ç³»ç»Ÿçš„æ·±å±‚å®ç°</h3><h4 id="2-1-é”å¯¹è±¡çš„æ•°æ®ç»“æ„è®¾è®¡"><a href="#2-1-é”å¯¹è±¡çš„æ•°æ®ç»“æ„è®¾è®¡" class="headerlink" title="2.1 é”å¯¹è±¡çš„æ•°æ®ç»“æ„è®¾è®¡"></a>2.1 é”å¯¹è±¡çš„æ•°æ®ç»“æ„è®¾è®¡</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">lock_t</span> &#123;</span></span><br><span class="line">    <span class="type">trx_t</span>* trx;           <span class="comment">// æ‹¥æœ‰è¯¥é”çš„äº‹åŠ¡</span></span><br><span class="line">    UT_LIST_NODE_T(<span class="type">lock_t</span>) trx_locks; <span class="comment">// äº‹åŠ¡é”é“¾è¡¨èŠ‚ç‚¹</span></span><br><span class="line">    <span class="type">dict_table_t</span>* tab_lock; <span class="comment">// è¡¨é”ä¿¡æ¯</span></span><br><span class="line">    <span class="type">dict_index_t</span>* index;    <span class="comment">// ç´¢å¼•ä¿¡æ¯</span></span><br><span class="line">    <span class="type">hash_node_t</span> hash;       <span class="comment">// å“ˆå¸Œè¡¨èŠ‚ç‚¹</span></span><br><span class="line">    ulint type_mode;        <span class="comment">// é”ç±»å‹å’Œæ¨¡å¼</span></span><br><span class="line">    ulint n_bits;          <span class="comment">// ä½å›¾å¤§å°</span></span><br><span class="line">    ulint n_granted_locks; <span class="comment">// å·²æˆäºˆçš„é”æ•°é‡</span></span><br><span class="line">    ulint n_waiting_locks; <span class="comment">// ç­‰å¾…çš„é”æ•°é‡</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>é”å“ˆå¸Œè¡¨çš„è®¾è®¡ï¼š</strong> InnoDBä½¿ç”¨ä¸€ä¸ªå…¨å±€çš„é”å“ˆå¸Œè¡¨æ¥ç®¡ç†æ‰€æœ‰çš„é”å¯¹è±¡ï¼Œå“ˆå¸Œå‡½æ•°åŸºäºspace_idå’Œpage_noè®¡ç®—ã€‚æ¯ä¸ªå“ˆå¸Œæ¡¶åŒ…å«ä¸€ä¸ªé”å¯¹è±¡é“¾è¡¨ï¼Œç›¸åŒé¡µé¢çš„æ‰€æœ‰é”å¯¹è±¡éƒ½é“¾æ¥åœ¨åŒä¸€ä¸ªæ¡¶ä¸­ã€‚è¿™ç§è®¾è®¡æ”¯æŒå¿«é€Ÿçš„é”æŸ¥æ‰¾å’Œå†²çªæ£€æµ‹ï¼Œæ—¶é—´å¤æ‚åº¦æ¥è¿‘O(1)ã€‚</p><p><strong>é”ä½å›¾çš„ç²¾å·§è®¾è®¡ï¼š</strong> å¯¹äºé¡µé¢çº§åˆ«çš„é”ç®¡ç†ï¼ŒInnoDBä½¿ç”¨ä½å›¾æ¥æ ‡è¯†é¡µé¢ä¸­å“ªäº›è®°å½•è¢«é”å®šã€‚æ¯ä¸ªè®°å½•å¯¹åº”ä½å›¾ä¸­çš„ä¸€ä½ï¼Œè®¾ç½®ä¸º1è¡¨ç¤ºè¯¥è®°å½•è¢«é”å®šã€‚è¿™ç§å‹ç¼©è¡¨ç¤ºæ³•å¤§å¤§èŠ‚çœäº†å†…å­˜ç©ºé—´ï¼Œç‰¹åˆ«æ˜¯åœ¨é”å®šå¤§é‡è®°å½•æ—¶ã€‚ä½å›¾æ“ä½œä½¿ç”¨é«˜æ•ˆçš„ä½è¿ç®—æŒ‡ä»¤ï¼Œæ”¯æŒå¿«é€Ÿçš„é”çŠ¶æ€æŸ¥è¯¢å’Œæ›´æ–°ã€‚</p><h4 id="2-2-æ­»é”æ£€æµ‹çš„é«˜çº§ç®—æ³•"><a href="#2-2-æ­»é”æ£€æµ‹çš„é«˜çº§ç®—æ³•" class="headerlink" title="2.2 æ­»é”æ£€æµ‹çš„é«˜çº§ç®—æ³•"></a>2.2 æ­»é”æ£€æµ‹çš„é«˜çº§ç®—æ³•</h4><p><strong>å¢é‡å¼æ­»é”æ£€æµ‹ï¼š</strong> InnoDBä¸æ˜¯æ¯æ¬¡éƒ½é‡æ–°æ„å»ºæ•´ä¸ªç­‰å¾…å›¾ï¼Œè€Œæ˜¯é‡‡ç”¨å¢é‡å¼æ£€æµ‹ã€‚å½“æ–°çš„ç­‰å¾…å…³ç³»å»ºç«‹æ—¶ï¼Œç®—æ³•åªæ£€æŸ¥ä»æ–°ç­‰å¾…è€…å¼€å§‹çš„è·¯å¾„æ˜¯å¦å½¢æˆç¯ã€‚è¿™ç§ä¼˜åŒ–å¤§å¤§å‡å°‘äº†æ£€æµ‹çš„è®¡ç®—å¼€é”€ï¼Œç‰¹åˆ«æ˜¯åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹æ•ˆæœæ˜¾è‘—ã€‚</p><p><strong>æ­»é”æ£€æµ‹çš„ä¼˜å…ˆçº§è°ƒåº¦ï¼š</strong> æ­»é”æ£€æµ‹å™¨è¿è¡Œåœ¨ç‹¬ç«‹çš„åå°çº¿ç¨‹ä¸­ï¼Œå…·æœ‰è¾ƒé«˜çš„è°ƒåº¦ä¼˜å…ˆçº§ã€‚æ£€æµ‹é¢‘ç‡æ ¹æ®ç³»ç»Ÿè´Ÿè½½åŠ¨æ€è°ƒæ•´ï¼šåœ¨é«˜å¹¶å‘æ—¶å¢åŠ æ£€æµ‹é¢‘ç‡ï¼Œåœ¨ä½è´Ÿè½½æ—¶é™ä½é¢‘ç‡ä»¥èŠ‚çœCPUèµ„æºã€‚æ£€æµ‹å™¨è¿˜ä¼šç»´æŠ¤ç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ­»é”å‘ç”Ÿé¢‘ç‡ã€å¹³å‡è§£å†³æ—¶é—´ç­‰ï¼Œç”¨äºç³»ç»Ÿè°ƒä¼˜ã€‚</p><p><strong>å¤æ‚æ­»é”åœºæ™¯çš„å¤„ç†ï¼š</strong> å®é™…ç”Ÿäº§ç¯å¢ƒä¸­å¯èƒ½å‡ºç°æ¶‰åŠå¤šä¸ªèµ„æºç±»å‹çš„å¤æ‚æ­»é”ï¼Œæ¯”å¦‚åŒæ—¶æ¶‰åŠè¡Œé”ã€è¡¨é”ã€å’Œå¤–é”®çº¦æŸé”çš„æ­»é”ã€‚InnoDBçš„æ­»é”æ£€æµ‹å™¨éœ€è¦æ„å»ºä¸€ä¸ªå¤šå±‚æ¬¡çš„ç­‰å¾…å›¾ï¼ŒåŒ…å«ä¸åŒç±»å‹çš„èµ„æºèŠ‚ç‚¹å’Œç­‰å¾…è¾¹ã€‚è§£å†³è¿™ç±»æ­»é”æ—¶ï¼Œéœ€è¦è€ƒè™‘ä¸åŒé”ç±»å‹çš„å›æ»šä»£ä»·ã€‚</p><h4 id="2-3-MVCCä¸é”çš„æ·±åº¦é›†æˆ"><a href="#2-3-MVCCä¸é”çš„æ·±åº¦é›†æˆ" class="headerlink" title="2.3 MVCCä¸é”çš„æ·±åº¦é›†æˆ"></a>2.3 MVCCä¸é”çš„æ·±åº¦é›†æˆ</h4><p><strong>ReadViewçš„å†…éƒ¨ç»“æ„ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ReadView</span> &#123;</span></span><br><span class="line">    <span class="type">trx_id_t</span> low_limit_id;    <span class="comment">// ç”ŸæˆReadViewæ—¶çš„ä¸‹ä¸€ä¸ªäº‹åŠ¡ID</span></span><br><span class="line">    <span class="type">trx_id_t</span> up_limit_id;     <span class="comment">// ç”ŸæˆReadViewæ—¶æœ€å°çš„æ´»è·ƒäº‹åŠ¡ID</span></span><br><span class="line">    <span class="type">trx_id_t</span> creator_trx_id;  <span class="comment">// åˆ›å»ºReadViewçš„äº‹åŠ¡ID</span></span><br><span class="line">    <span class="type">trx_ids_t</span> m_ids;          <span class="comment">// ç”ŸæˆReadViewæ—¶çš„æ´»è·ƒäº‹åŠ¡IDåˆ—è¡¨</span></span><br><span class="line">    m_low_limit_no;           <span class="comment">// æœ€å¤§çš„äº‹åŠ¡ç¼–å·</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>ç‰ˆæœ¬å¯è§æ€§çš„åˆ¤æ–­ç®—æ³•ï¼š</strong> å½“äº‹åŠ¡è¯»å–è®°å½•æ—¶ï¼Œéœ€è¦åˆ¤æ–­è®°å½•çš„æŸä¸ªç‰ˆæœ¬æ˜¯å¦å¯¹å½“å‰äº‹åŠ¡å¯è§ã€‚åˆ¤æ–­é€»è¾‘åŸºäºè®°å½•çš„DB_TRX_IDå­—æ®µå’ŒReadViewçš„ä¿¡æ¯ï¼šå¦‚æœDB_TRX_IDå°äºup_limit_idï¼Œåˆ™è¯¥ç‰ˆæœ¬å¯¹æ‰€æœ‰äº‹åŠ¡å¯è§ï¼›å¦‚æœDB_TRX_IDå¤§äºç­‰äºlow_limit_idï¼Œåˆ™è¯¥ç‰ˆæœ¬å¯¹å½“å‰äº‹åŠ¡ä¸å¯è§ï¼›å¦‚æœDB_TRX_IDåœ¨ä¸¤è€…ä¹‹é—´ï¼Œåˆ™éœ€è¦æ£€æŸ¥æ˜¯å¦åœ¨æ´»è·ƒäº‹åŠ¡åˆ—è¡¨ä¸­ã€‚</p><p><strong>undo logçš„é“¾å¼ç»“æ„ï¼š</strong> æ¯ä¸ªäº‹åŠ¡çš„undo logå½¢æˆä¸€ä¸ªé“¾å¼ç»“æ„ï¼Œè®°å½•äº†è¯¥äº‹åŠ¡çš„æ‰€æœ‰ä¿®æ”¹æ“ä½œã€‚undo logä¸ä»…ç”¨äºäº‹åŠ¡å›æ»šï¼Œè¿˜ç”¨äºMVCCçš„ç‰ˆæœ¬æ„å»ºã€‚å½“éœ€è¦æ„å»ºæŸä¸ªå†å²ç‰ˆæœ¬æ—¶ï¼ŒInnoDBä¼šä»å½“å‰ç‰ˆæœ¬å¼€å§‹ï¼Œæ²¿ç€undo logé“¾å‘å‰å›æº¯ï¼Œé€æ­¥åº”ç”¨é€†å‘æ“ä½œç›´åˆ°è¾¾åˆ°ç›®æ ‡ç‰ˆæœ¬ã€‚</p><h3 id="3-æ•°æ®åº“é”çš„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥"><a href="#3-æ•°æ®åº“é”çš„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥" class="headerlink" title="3. æ•°æ®åº“é”çš„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥"></a>3. æ•°æ®åº“é”çš„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥</h3><h4 id="3-1-é”ç­‰å¾…çš„è‡ªé€‚åº”ç­–ç•¥"><a href="#3-1-é”ç­‰å¾…çš„è‡ªé€‚åº”ç­–ç•¥" class="headerlink" title="3.1 é”ç­‰å¾…çš„è‡ªé€‚åº”ç­–ç•¥"></a>3.1 é”ç­‰å¾…çš„è‡ªé€‚åº”ç­–ç•¥</h4><p><strong>ç­‰å¾…æ—¶é—´çš„åŠ¨æ€è°ƒæ•´ï¼š</strong> InnoDBå®ç°äº†è‡ªé€‚åº”çš„é”ç­‰å¾…ç­–ç•¥ï¼Œæ ¹æ®ç³»ç»Ÿè´Ÿè½½å’Œé”ç«äº‰æƒ…å†µåŠ¨æ€è°ƒæ•´ç­‰å¾…è¶…æ—¶æ—¶é—´ã€‚åœ¨ä½è´Ÿè½½æ—¶å»¶é•¿ç­‰å¾…æ—¶é—´ä»¥å‡å°‘ä¸å¿…è¦çš„å›æ»šï¼Œåœ¨é«˜è´Ÿè½½æ—¶ç¼©çŸ­ç­‰å¾…æ—¶é—´ä»¥å¿«é€Ÿé‡Šæ”¾èµ„æºã€‚è¿™ç§ç­–ç•¥é€šè¿‡ç»´æŠ¤ç³»ç»Ÿçº§çš„ç»Ÿè®¡ä¿¡æ¯æ¥å®ç°ï¼ŒåŒ…æ‹¬å¹³å‡é”æŒæœ‰æ—¶é—´ã€é”ç«äº‰é¢‘ç‡ç­‰ã€‚</p><p><strong>ç­‰å¾…é˜Ÿåˆ—çš„ä¼˜å…ˆçº§ç®¡ç†ï¼š</strong> å¯¹äºåŒä¸€èµ„æºçš„å¤šä¸ªç­‰å¾…è€…ï¼ŒInnoDBå¯ä»¥æ ¹æ®äº‹åŠ¡çš„é‡è¦æ€§ã€ç­‰å¾…æ—¶é—´ã€èµ„æºæ¶ˆè€—ç­‰å› ç´ è¿›è¡Œä¼˜å…ˆçº§æ’åºã€‚é«˜ä¼˜å…ˆçº§çš„äº‹åŠ¡å¯ä»¥ä¼˜å…ˆè·å¾—é”ï¼Œè¿™å¯¹äºå…³é”®ä¸šåŠ¡æ“ä½œç‰¹åˆ«é‡è¦ã€‚ä¼˜å…ˆçº§çš„è®¡ç®—è€ƒè™‘å¤šä¸ªç»´åº¦ï¼ŒåŒ…æ‹¬äº‹åŠ¡çš„å¹´é¾„ã€ä¿®æ”¹çš„æ•°æ®é‡ã€æ˜¯å¦ä¸ºåªè¯»äº‹åŠ¡ç­‰ã€‚</p><h4 id="3-2-ç´¢å¼•è®¾è®¡å¯¹é”æ€§èƒ½çš„å½±å“"><a href="#3-2-ç´¢å¼•è®¾è®¡å¯¹é”æ€§èƒ½çš„å½±å“" class="headerlink" title="3.2 ç´¢å¼•è®¾è®¡å¯¹é”æ€§èƒ½çš„å½±å“"></a>3.2 ç´¢å¼•è®¾è®¡å¯¹é”æ€§èƒ½çš„å½±å“</h4><p><strong>è¦†ç›–ç´¢å¼•ä¸é”èŒƒå›´ä¼˜åŒ–ï¼š</strong> å½“æŸ¥è¯¢èƒ½å¤Ÿé€šè¿‡è¦†ç›–ç´¢å¼•è·å–æ‰€æœ‰éœ€è¦çš„æ•°æ®æ—¶ï¼ŒInnoDBåªéœ€è¦åœ¨äºŒçº§ç´¢å¼•ä¸ŠåŠ é”ï¼Œè€Œä¸éœ€è¦å›è¡¨è®¿é—®èšç°‡ç´¢å¼•ã€‚è¿™å¤§å¤§å‡å°‘äº†é”çš„æ•°é‡å’ŒèŒƒå›´ï¼Œæé«˜äº†å¹¶å‘æ€§èƒ½ã€‚è¦†ç›–ç´¢å¼•çš„è®¾è®¡éœ€è¦ä»”ç»†åˆ†ææŸ¥è¯¢æ¨¡å¼ï¼Œå°†ç»å¸¸ä¸€èµ·è®¿é—®çš„åˆ—ç»„åˆæˆå¤åˆç´¢å¼•ã€‚</p><p><strong>ç´¢å¼•å‰ç¼€é•¿åº¦å¯¹é”ç²’åº¦çš„å½±å“ï¼š</strong> å¯¹äºå­—ç¬¦ä¸²ç±»å‹çš„ç´¢å¼•ï¼Œå‰ç¼€é•¿åº¦çš„é€‰æ‹©ç›´æ¥å½±å“é”çš„ç²’åº¦ã€‚è¾ƒçŸ­çš„å‰ç¼€å¯èƒ½å¯¼è‡´å¤šä¸ªä¸åŒçš„å€¼æ˜ å°„åˆ°ç›¸åŒçš„ç´¢å¼•å‰ç¼€ï¼Œä»è€Œæ‰©å¤§é”çš„èŒƒå›´ï¼›è¾ƒé•¿çš„å‰ç¼€æä¾›æ›´ç²¾ç¡®çš„é”å®šï¼Œä½†å¢åŠ äº†ç´¢å¼•çš„å­˜å‚¨å¼€é”€ã€‚æœ€ä¼˜å‰ç¼€é•¿åº¦éœ€è¦åœ¨é”ç²’åº¦å’Œå­˜å‚¨æ•ˆç‡ä¹‹é—´å¹³è¡¡ã€‚</p><h4 id="3-3-äº‹åŠ¡è®¾è®¡å¯¹é”æ€§èƒ½çš„ä¼˜åŒ–"><a href="#3-3-äº‹åŠ¡è®¾è®¡å¯¹é”æ€§èƒ½çš„ä¼˜åŒ–" class="headerlink" title="3.3 äº‹åŠ¡è®¾è®¡å¯¹é”æ€§èƒ½çš„ä¼˜åŒ–"></a>3.3 äº‹åŠ¡è®¾è®¡å¯¹é”æ€§èƒ½çš„ä¼˜åŒ–</h4><p><strong>äº‹åŠ¡è¾¹ç•Œçš„ç²¾ç»†æ§åˆ¶ï¼š</strong> äº‹åŠ¡è¾¹ç•Œçš„è®¾è®¡ç›´æ¥å½±å“é”çš„æŒæœ‰æ—¶é—´ã€‚é•¿äº‹åŠ¡ä¼šé•¿æ—¶é—´æŒæœ‰é”ï¼Œé˜»å¡å…¶ä»–äº‹åŠ¡çš„æ‰§è¡Œã€‚ä¼˜åŒ–ç­–ç•¥åŒ…æ‹¬ï¼šå°†å¤§äº‹åŠ¡æ‹†åˆ†ä¸ºå¤šä¸ªå°äº‹åŠ¡ï¼Œå‡å°‘æ¯ä¸ªäº‹åŠ¡çš„é”æŒæœ‰æ—¶é—´ï¼›å°†åªè¯»æ“ä½œå’Œå†™æ“ä½œåˆ†ç¦»ï¼Œåªè¯»æ“ä½œä½¿ç”¨å¿«ç…§è¯»é¿å…åŠ é”ï¼›åœ¨äº‹åŠ¡ä¸­ä¼˜å…ˆæ‰§è¡Œå¯èƒ½å¤±è´¥çš„æ“ä½œï¼Œå‡å°‘æ— æ•ˆé”æŒæœ‰ã€‚</p><p><strong>æ‰¹é‡æ“ä½œçš„é”ä¼˜åŒ–ï¼š</strong> å¯¹äºæ‰¹é‡æ’å…¥ã€æ›´æ–°ã€åˆ é™¤æ“ä½œï¼Œå¯ä»¥é‡‡ç”¨ç‰¹æ®Šçš„é”ç­–ç•¥ã€‚æ¯”å¦‚æ‰¹é‡æ’å…¥æ—¶å¯ä»¥ä½¿ç”¨INSERT â€¦ ON DUPLICATE KEY UPDATEè¯­æ³•ï¼Œå‡å°‘é”å†²çªï¼›æ‰¹é‡æ›´æ–°æ—¶å¯ä»¥æŒ‰ç…§ç´¢å¼•é¡ºåºè¿›è¡Œï¼Œé¿å…æ­»é”ï¼›æ‰¹é‡åˆ é™¤æ—¶å¯ä»¥åˆ†æ‰¹è¿›è¡Œï¼Œé¿å…é•¿æ—¶é—´æŒæœ‰å¤§é‡é”ã€‚</p><h2 id="è¡Œé”ï¼ˆRow-Lockï¼‰"><a href="#è¡Œé”ï¼ˆRow-Lockï¼‰" class="headerlink" title="è¡Œé”ï¼ˆRow Lockï¼‰"></a>è¡Œé”ï¼ˆRow Lockï¼‰</h2><h2 id="InnoDBçš„è¡Œé”å®ç°"><a href="#InnoDBçš„è¡Œé”å®ç°" class="headerlink" title="InnoDBçš„è¡Œé”å®ç°"></a>InnoDBçš„è¡Œé”å®ç°</h2><p>InnoDBæ˜¯MySQLä¸­æ”¯æŒè¡Œé”çš„ä¸»è¦å­˜å‚¨å¼•æ“ï¼š<br>å®ç°åŸç†ï¼š</p><ol><li>å½“äº‹åŠ¡éœ€è¦é”å®šæŸè¡Œæ—¶ï¼ŒInnoDBä¼šåœ¨è¯¥è¡Œå¯¹åº”çš„ç´¢å¼•è®°å½•ä¸ŠåŠ é”</li><li>å¦‚æœæ²¡æœ‰ç´¢å¼•ï¼Œä¼šé”å®šæ•´ä¸ªè¡¨ï¼ˆå®é™…æ˜¯é”å®šæ‰€æœ‰è¡Œï¼‰</li><li>é”ä¿¡æ¯å­˜å‚¨åœ¨å†…å­˜ä¸­çš„å“ˆå¸Œè¡¨ç»“æ„ä¸­</li></ol><h2 id="è¡¨é”ï¼ˆTable-Lockï¼‰"><a href="#è¡¨é”ï¼ˆTable-Lockï¼‰" class="headerlink" title="è¡¨é”ï¼ˆTable Lockï¼‰"></a>è¡¨é”ï¼ˆTable Lockï¼‰</h2><h2 id="MyISAMçš„è¡¨é”å®ç°"><a href="#MyISAMçš„è¡¨é”å®ç°" class="headerlink" title="MyISAMçš„è¡¨é”å®ç°"></a>MyISAMçš„è¡¨é”å®ç°</h2><p>MyISAMåªæ”¯æŒè¡¨çº§é”</p><ol><li>ç»´æŠ¤ä¸€ä¸ªå…¨å±€çš„è¡¨é”é˜Ÿåˆ—</li><li>å†™é”å…·æœ‰æ›´é«˜ä¼˜å…ˆçº§</li><li>é”ä¿¡æ¯å­˜å‚¨åœ¨æœåŠ¡å™¨å±‚é¢</li></ol><h1 id="JavaåŸºç¡€çŸ¥è¯†"><a href="#JavaåŸºç¡€çŸ¥è¯†" class="headerlink" title="JavaåŸºç¡€çŸ¥è¯†"></a>JavaåŸºç¡€çŸ¥è¯†</h1><h2 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h2><hr><h3 id="å…«ä¸ªåŸºæœ¬æ•°æ®ç±»å‹ï¼ˆPrimitive-Data-Typesï¼‰"><a href="#å…«ä¸ªåŸºæœ¬æ•°æ®ç±»å‹ï¼ˆPrimitive-Data-Typesï¼‰" class="headerlink" title="å…«ä¸ªåŸºæœ¬æ•°æ®ç±»å‹ï¼ˆPrimitive Data Typesï¼‰"></a><strong>å…«ä¸ªåŸºæœ¬æ•°æ®ç±»å‹ï¼ˆPrimitive Data Typesï¼‰</strong></h3><h4 id="1-æ•´å‹"><a href="#1-æ•´å‹" class="headerlink" title="1. æ•´å‹"></a><strong>1. æ•´å‹</strong></h4><p>æ•´å‹ç”¨äºå­˜å‚¨ä¸å¸¦å°æ•°çš„æ•´æ•°ã€‚Java æä¾›äº†å››ç§æ•´å‹ï¼Œå®ƒä»¬çš„åŒºåˆ«åœ¨äºæ‰€å å†…å­˜ç©ºé—´çš„å¤§å°ï¼Œä»è€Œå½±å“å¯å­˜å‚¨çš„æ•°å€¼èŒƒå›´ã€‚</p><ul><li><strong>byte</strong><ul><li>å¤§å°ï¼š1 å­—èŠ‚ï¼ˆ8 ä½ï¼‰</li><li>èŒƒå›´ï¼šâˆ’128 åˆ° 127</li><li>ç”¨é€”ï¼šä¸»è¦ç”¨äºèŠ‚çœå†…å­˜ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†å¤§é‡æ•°æ®æ—¶ï¼Œä¾‹å¦‚åœ¨æ–‡ä»¶æˆ–ç½‘ç»œä¼ è¾“ä¸­ã€‚</li></ul></li><li><strong>short</strong><ul><li>å¤§å°ï¼š2 å­—èŠ‚ï¼ˆ16 ä½ï¼‰</li><li>èŒƒå›´ï¼šâˆ’32768 åˆ° 32767</li><li>ç”¨é€”ï¼šåŒæ ·ç”¨äºèŠ‚çœå†…å­˜ï¼Œæ¯” <code>byte</code> çš„èŒƒå›´æ›´å¤§ã€‚</li></ul></li><li><strong>int</strong><ul><li>å¤§å°ï¼š4 å­—èŠ‚ï¼ˆ32 ä½ï¼‰</li><li>èŒƒå›´ï¼šçº¦ âˆ’2.1Ã—109 åˆ° 2.1Ã—109</li><li>ç”¨é€”ï¼šè¿™æ˜¯<strong>æœ€å¸¸ç”¨</strong>çš„æ•´å‹ï¼Œé€šå¸¸ç”¨æ¥è¡¨ç¤ºæ™®é€šçš„æ•´æ•°ã€‚</li></ul></li><li><strong>long</strong><ul><li>å¤§å°ï¼š8 å­—èŠ‚ï¼ˆ64 ä½ï¼‰</li><li>èŒƒå›´ï¼šçº¦ âˆ’9.2Ã—1018 åˆ° 9.2Ã—1018</li><li>ç”¨é€”ï¼šå½“ <code>int</code> ç±»å‹çš„èŒƒå›´ä¸è¶³ä»¥å­˜å‚¨ä¸€ä¸ªå¤§æ•°æ—¶ä½¿ç”¨ï¼Œä¾‹å¦‚å¤„ç†æ—¶é—´æˆ³ã€æ–‡ä»¶å¤§å°ç­‰ã€‚åœ¨æ•°å€¼åé¢éœ€è¦åŠ ä¸Š <code>L</code> æˆ– <code>l</code> æ¥è¡¨ç¤ºï¼Œä¾‹å¦‚ <code>long myLong = 100L;</code>ã€‚</li></ul></li></ul><h4 id="2-æµ®ç‚¹å‹"><a href="#2-æµ®ç‚¹å‹" class="headerlink" title="2. æµ®ç‚¹å‹"></a><strong>2. æµ®ç‚¹å‹</strong></h4><p>æµ®ç‚¹å‹ç”¨äºå­˜å‚¨å¸¦æœ‰å°æ•°ç‚¹çš„æ•°å€¼ã€‚</p><ul><li><strong>float</strong><ul><li>å¤§å°ï¼š4 å­—èŠ‚ï¼ˆ32 ä½ï¼‰</li><li>ç”¨é€”ï¼šå•ç²¾åº¦æµ®ç‚¹æ•°ï¼Œæœ‰æ•ˆä½æ•°ä¸º 6-7 ä½ã€‚åœ¨æ•°å€¼åé¢éœ€è¦åŠ ä¸Š <code>F</code> æˆ– <code>f</code> æ¥è¡¨ç¤ºï¼Œä¾‹å¦‚ <code>float myFloat = 3.14f;</code>ã€‚</li></ul></li><li><strong>double</strong><ul><li>å¤§å°ï¼š8 å­—èŠ‚ï¼ˆ64 ä½ï¼‰</li><li>ç”¨é€”ï¼šåŒç²¾åº¦æµ®ç‚¹æ•°ï¼Œæœ‰æ•ˆä½æ•°ä¸º 15-16 ä½ã€‚è¿™æ˜¯<strong>æœ€å¸¸ç”¨</strong>çš„æµ®ç‚¹å‹ï¼ŒJava é»˜è®¤çš„æµ®ç‚¹æ•°ç±»å‹å°±æ˜¯ <code>double</code>ã€‚</li></ul></li></ul><blockquote><p><strong>æ³¨æ„</strong>ï¼šæµ®ç‚¹æ•°å­˜åœ¨ç²¾åº¦é—®é¢˜ï¼Œä¸é€‚åˆç”¨äºç²¾ç¡®çš„é‡‘èè®¡ç®—ã€‚å¦‚æœéœ€è¦ç²¾ç¡®è®¡ç®—ï¼Œåº”ä½¿ç”¨ <code>java.math.BigDecimal</code> ç±»ã€‚</p></blockquote><h4 id="3-å­—ç¬¦å‹"><a href="#3-å­—ç¬¦å‹" class="headerlink" title="3. å­—ç¬¦å‹"></a><strong>3. å­—ç¬¦å‹</strong></h4><ul><li><strong>char</strong><ul><li>å¤§å°ï¼š2 å­—èŠ‚ï¼ˆ16 ä½ï¼‰</li><li>ç”¨é€”ï¼šå­˜å‚¨å•ä¸ªå­—ç¬¦ã€‚åœ¨ Java ä¸­ï¼Œ<code>char</code> é‡‡ç”¨ Unicode ç¼–ç ï¼Œå¯ä»¥è¡¨ç¤ºåŒ…æ‹¬ä¸­æ–‡åœ¨å†…çš„æ‰€æœ‰å­—ç¬¦ã€‚å®ƒå¯ä»¥ç”¨å•å¼•å· <code>&#39;</code> æ‹¬èµ·æ¥ï¼Œä¾‹å¦‚ <code>char myChar = &#39;A&#39;;</code>ã€‚</li></ul></li></ul><h4 id="4-å¸ƒå°”å‹"><a href="#4-å¸ƒå°”å‹" class="headerlink" title="4. å¸ƒå°”å‹"></a><strong>4. å¸ƒå°”å‹</strong></h4><ul><li><strong>boolean</strong><ul><li>å¤§å°ï¼šåœ¨å†…å­˜ä¸­é€šå¸¸è¢«è§†ä¸º 1 ä½ï¼Œä½†åœ¨æ•°ç»„ä¸­ä¼šå ç”¨ 1 å­—èŠ‚ã€‚</li><li>ç”¨é€”ï¼šç”¨äºå­˜å‚¨ <code>true</code> æˆ– <code>false</code>ï¼Œè¡¨ç¤ºé€»è¾‘å€¼ã€‚</li></ul></li></ul><p><img src="https://raw.githubusercontent.com/charlotte030710/blog_images/main/image-20250915211633091.png" alt="image-20250915211633091"></p><h3 id="è‡ªåŠ¨æ‹†è£…ç®±çš„æœ¬è´¨"><a href="#è‡ªåŠ¨æ‹†è£…ç®±çš„æœ¬è´¨" class="headerlink" title="è‡ªåŠ¨æ‹†è£…ç®±çš„æœ¬è´¨"></a>è‡ªåŠ¨æ‹†è£…ç®±çš„æœ¬è´¨</h3><hr><p><strong>è‡ªåŠ¨æ‹†è£…ç®±</strong>æ˜¯ Java ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶æœŸï¼Œæ ¹æ®ä»£ç çš„è¯­æ³•ï¼Œ<strong>è‡ªåŠ¨</strong>å°†åŸºæœ¬æ•°æ®ç±»å‹å’Œå…¶å¯¹åº”çš„åŒ…è£…ç±»å‹ä¹‹é—´è¿›è¡Œè½¬æ¢çš„ä¸€ç§æœºåˆ¶ã€‚è¿™åœ¨ Java 5 ä¹‹åè¢«å¼•å…¥ï¼Œå¤§å¤§ç®€åŒ–äº†ä»£ç ï¼Œè®©å¼€å‘è€…å¯ä»¥åƒæ“ä½œåŸºæœ¬ç±»å‹ä¸€æ ·æ“ä½œåŒ…è£…ç±»å‹ã€‚</p><ul><li><strong>è£…ç®±ï¼ˆBoxingï¼‰</strong>ï¼šå°†åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆå¦‚ <code>int</code>ï¼‰è½¬æ¢ä¸ºå¯¹åº”çš„åŒ…è£…ç±»å‹ï¼ˆ<code>Integer</code>ï¼‰ã€‚</li><li><strong>æ‹†ç®±ï¼ˆUnboxingï¼‰</strong>ï¼šå°†åŒ…è£…ç±»å‹ï¼ˆ<code>Integer</code>ï¼‰è½¬æ¢ä¸ºå¯¹åº”çš„åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆ<code>int</code>ï¼‰ã€‚</li></ul><h3 id="è‡ªåŠ¨æ‹†è£…ç®±çš„åº•å±‚åŸç†"><a href="#è‡ªåŠ¨æ‹†è£…ç®±çš„åº•å±‚åŸç†" class="headerlink" title="è‡ªåŠ¨æ‹†è£…ç®±çš„åº•å±‚åŸç†"></a>è‡ªåŠ¨æ‹†è£…ç®±çš„åº•å±‚åŸç†</h3><hr><p>è¿™å¹¶é JVM çš„ç‰¹æ€§ï¼Œè€Œæ˜¯<strong>ç¼–è¯‘å™¨</strong>çš„â€œéšœçœ¼æ³•â€ã€‚å½“ä½ åœ¨ Java ä»£ç ä¸­ä½¿ç”¨è‡ªåŠ¨æ‹†è£…ç®±æ—¶ï¼Œç¼–è¯‘å™¨ä¼šåœ¨ä½ çœ‹ä¸è§çš„åœ°æ–¹ï¼Œè‡ªåŠ¨æ’å…¥å¯¹åº”çš„ <code>valueOf()</code> å’Œ <code>xxxValue()</code> æ–¹æ³•ã€‚</p><h4 id="1-è‡ªåŠ¨è£…ç®±çš„åŸç†"><a href="#1-è‡ªåŠ¨è£…ç®±çš„åŸç†" class="headerlink" title="1. è‡ªåŠ¨è£…ç®±çš„åŸç†"></a>1. è‡ªåŠ¨è£…ç®±çš„åŸç†</h4><p>å½“ä½ å†™ä¸‹ <code>Integer a = 100;</code> è¿™æ ·çš„ä»£ç æ—¶ï¼Œç¼–è¯‘å™¨ä¼šå°†å…¶è‡ªåŠ¨è½¬æ¢ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Integer</span> <span class="variable">a</span> <span class="operator">=</span> Integer.valueOf(<span class="number">100</span>);</span><br></pre></td></tr></table></figure><p>è¿™å°±æ˜¯è‡ªåŠ¨è£…ç®±çš„æœ¬è´¨ã€‚å®ƒè°ƒç”¨äº†åŒ…è£…ç±»çš„é™æ€æ–¹æ³• <strong>valueOf()</strong>ã€‚</p><p><strong>Integer.valueOf() çš„ç‰¹æ®Šä¹‹å¤„</strong>ï¼š</p><p>ä¸ºäº†èŠ‚çœå†…å­˜å¹¶æé«˜æ€§èƒ½ï¼Œ<code>Integer</code> ç±»å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ª <strong>ç¼“å­˜</strong>ã€‚è¿™ä¸ªç¼“å­˜çš„èŒƒå›´é€šå¸¸æ˜¯ <strong>-128 åˆ° 127</strong>ã€‚</p><p>å½“ <code>valueOf()</code> æ–¹æ³•ä¼ å…¥çš„å€¼åœ¨è¿™ä¸ªèŒƒå›´å†…æ—¶ï¼Œå®ƒä¼šç›´æ¥ä»ç¼“å­˜ä¸­è¿”å›å¯¹åº”çš„ <code>Integer</code> å¯¹è±¡ï¼Œè€Œä¸æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚</p><p>æ‰€ä»¥ï¼Œå½“ä½ æ‰§è¡Œä»¥ä¸‹ä»£ç æ—¶ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Integer</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line"><span class="type">Integer</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line">System.out.println(a == b);</span><br></pre></td></tr></table></figure><p>ç»“æœæ˜¯ <code>true</code>ï¼Œå› ä¸º <code>a</code> å’Œ <code>b</code> éƒ½æŒ‡å‘äº†ç¼“å­˜ä¸­çš„åŒä¸€ä¸ªå¯¹è±¡ã€‚</p><p>ä½†å¦‚æœå€¼è¶…å‡ºè¿™ä¸ªèŒƒå›´ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Integer</span> <span class="variable">c</span> <span class="operator">=</span> <span class="number">200</span>;</span><br><span class="line"><span class="type">Integer</span> <span class="variable">d</span> <span class="operator">=</span> <span class="number">200</span>;</span><br><span class="line">System.out.println(c == d);</span><br></pre></td></tr></table></figure><p>ç»“æœå°±æ˜¯ <code>false</code>ï¼Œå› ä¸ºæ¯æ¬¡éƒ½ä¼šåˆ›å»ºæ–°çš„ <code>Integer</code> å¯¹è±¡ã€‚è¿™ä¸ªç¼“å­˜ä¼˜åŒ–æœºåˆ¶ä¹Ÿå­˜åœ¨äº <code>Byte</code>, <code>Short</code>, <code>Long</code> å’Œ <code>Character</code> ç±»å‹ä¸­ã€‚</p><h4 id="2-è‡ªåŠ¨æ‹†ç®±çš„åŸç†"><a href="#2-è‡ªåŠ¨æ‹†ç®±çš„åŸç†" class="headerlink" title="2. è‡ªåŠ¨æ‹†ç®±çš„åŸç†"></a>2. è‡ªåŠ¨æ‹†ç®±çš„åŸç†</h4><p>å½“ä½ å†™ä¸‹ <code>int i = a;</code> è¿™æ ·çš„ä»£ç ï¼ˆå…¶ä¸­ <code>a</code> æ˜¯ä¸€ä¸ª <code>Integer</code> å¯¹è±¡ï¼‰æ—¶ï¼Œç¼–è¯‘å™¨ä¼šå°†å…¶è‡ªåŠ¨è½¬æ¢ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> a.intValue();</span><br></pre></td></tr></table></figure><p>è¿™å°±æ˜¯è‡ªåŠ¨æ‹†ç®±çš„æœ¬è´¨ã€‚å®ƒè°ƒç”¨äº†åŒ…è£…ç±»çš„å®ä¾‹æ–¹æ³• <strong>xxxValue()</strong>ï¼ˆå¦‚ <code>intValue()</code>, <code>doubleValue()</code> ç­‰ï¼‰ã€‚</p><hr><h3 id="æ³¨æ„äº‹é¡¹ä¸æ½œåœ¨é—®é¢˜"><a href="#æ³¨æ„äº‹é¡¹ä¸æ½œåœ¨é—®é¢˜" class="headerlink" title="æ³¨æ„äº‹é¡¹ä¸æ½œåœ¨é—®é¢˜"></a>æ³¨æ„äº‹é¡¹ä¸æ½œåœ¨é—®é¢˜</h3><p>è™½ç„¶è‡ªåŠ¨æ‹†è£…ç®±è®©ä»£ç æ›´ç®€æ´ï¼Œä½†å¦‚æœä¸äº†è§£å…¶åŸç†ï¼Œå¯èƒ½ä¼šå¼•å‘ä¸€äº›é—®é¢˜ï¼š</p><ul><li><p><strong>NullPointerException</strong>ï¼šå¦‚æœä¸€ä¸ªåŒ…è£…ç±»å‹ä¸º <code>null</code>ï¼Œåœ¨è¿›è¡Œè‡ªåŠ¨æ‹†ç®±æ—¶ï¼Œä¼šè°ƒç”¨ <code>null</code> å¯¹è±¡çš„ <code>intValue()</code> æ–¹æ³•ï¼Œä»è€ŒæŠ›å‡º <code>NullPointerException</code>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Integer</span> <span class="variable">i</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i; <span class="comment">// è¿™é‡Œä¼šæŠ›å‡º NullPointerException</span></span><br></pre></td></tr></table></figure></li><li><p><strong>æ€§èƒ½é—®é¢˜</strong>ï¼šåœ¨å¾ªç¯ä¸­é¢‘ç¹åœ°è¿›è¡Œè‡ªåŠ¨è£…ç®±å’Œæ‹†ç®±ï¼Œä¼šä¸æ–­åœ°åˆ›å»ºå’Œé”€æ¯å¯¹è±¡ï¼Œè¿™ä¼šå¢åŠ åƒåœ¾å›æ”¶ï¼ˆGCï¼‰çš„è´Ÿæ‹…ï¼Œå½±å“ç¨‹åºæ€§èƒ½ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç³Ÿç³•çš„å†™æ³•</span></span><br><span class="line"><span class="type">Integer</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>; k &lt; <span class="number">10000</span>; k++) &#123;</span><br><span class="line">    sum += k; <span class="comment">// æ¯æ¬¡å¾ªç¯éƒ½ä¼šè¿›è¡Œä¸€æ¬¡æ‹†ç®±å’Œä¸€æ¬¡è£…ç®±</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åº”è¯¥ä½¿ç”¨åŸºæœ¬æ•°æ®ç±»å‹æ¥é¿å…è¿™ç§å¼€é”€ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ›´å¥½çš„å†™æ³•</span></span><br><span class="line"><span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>; k &lt; <span class="number">10000</span>; k++) &#123;</span><br><span class="line">    sum += k;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="ä»€ä¹ˆæ˜¯é™æ€å˜é‡ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯é™æ€å˜é‡ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯é™æ€å˜é‡ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯é™æ€å˜é‡ï¼Ÿ</h3><p>åœ¨ Java ä¸­ï¼Œé™æ€å˜é‡ï¼ˆStatic Variableï¼‰ï¼Œä¹Ÿç§°ä¸ºç±»å˜é‡ï¼ˆClass Variableï¼‰ï¼Œæ˜¯ä½¿ç”¨ <strong>static å…³é”®å­—</strong> ä¿®é¥°çš„å˜é‡ã€‚å®ƒå±äº <strong>ç±»</strong>ï¼Œè€Œä¸æ˜¯ç±»çš„ä»»ä½•ä¸€ä¸ª <strong>å®ä¾‹å¯¹è±¡</strong>ã€‚</p><p>è¿™æ„å‘³ç€ï¼Œä¸ç®¡ä½ åˆ›å»ºäº†å¤šå°‘ä¸ªç±»çš„å¯¹è±¡ï¼Œé™æ€å˜é‡åœ¨å†…å­˜ä¸­éƒ½åªæœ‰<strong>ä¸€ä»½</strong>ï¼Œå¹¶ä¸”è¿™å”¯ä¸€çš„ä¸€ä»½æ•°æ®è¢«è¯¥ç±»çš„æ‰€æœ‰å¯¹è±¡å…±äº«ã€‚</p><p><strong>ä»£ç ç¤ºä¾‹ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="comment">// å®ä¾‹å˜é‡</span></span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é™æ€å˜é‡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">company</span> <span class="operator">=</span> <span class="string">&quot;Google&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š</p><ul><li><code>name</code> æ˜¯ä¸€ä¸ª<strong>å®ä¾‹å˜é‡</strong>ã€‚æ¯ä¸ª <code>User</code> å¯¹è±¡éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„ <code>name</code> å±æ€§ï¼Œ<code>user1</code> çš„ <code>name</code> å’Œ <code>user2</code> çš„ <code>name</code> äº’ä¸å½±å“ã€‚</li><li><code>company</code> æ˜¯ä¸€ä¸ª<strong>é™æ€å˜é‡</strong>ã€‚æ— è®ºä½ åˆ›å»ºå¤šå°‘ä¸ª <code>User</code> å¯¹è±¡ï¼Œå®ƒä»¬å…±äº«åŒä¸€ä¸ª <code>company</code> å˜é‡ã€‚å¦‚æœä½ ä¿®æ”¹äº† <code>company</code> çš„å€¼ï¼Œæ‰€æœ‰ <code>User</code> å¯¹è±¡çš„ <code>company</code> å±æ€§éƒ½ä¼šè·Ÿç€æ”¹å˜ã€‚</li></ul><hr><h3 id="é™æ€å˜é‡çš„å†…å­˜åˆ†é…ä¸ç”Ÿå‘½å‘¨æœŸ"><a href="#é™æ€å˜é‡çš„å†…å­˜åˆ†é…ä¸ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="é™æ€å˜é‡çš„å†…å­˜åˆ†é…ä¸ç”Ÿå‘½å‘¨æœŸ"></a>é™æ€å˜é‡çš„å†…å­˜åˆ†é…ä¸ç”Ÿå‘½å‘¨æœŸ</h3><ul><li><strong>å†…å­˜åˆ†é…</strong>ï¼šé™æ€å˜é‡åœ¨ç±»åŠ è½½æ—¶ï¼Œè¢«åˆ†é…åˆ° <strong>æ–¹æ³•åŒºï¼ˆMethod Areaï¼‰</strong> çš„ <strong>é™æ€åŒº</strong> ä¸­ã€‚è¿™ä¸å®ä¾‹å˜é‡ä¸åŒï¼Œå®ä¾‹å˜é‡æ˜¯åœ¨åˆ›å»ºå¯¹è±¡æ—¶ï¼Œéšç€å¯¹è±¡ä¸€èµ·åˆ†é…åœ¨ <strong>å †ï¼ˆHeapï¼‰</strong> ä¸­ã€‚</li><li><strong>ç”Ÿå‘½å‘¨æœŸ</strong>ï¼šé™æ€å˜é‡çš„ç”Ÿå‘½å‘¨æœŸä¸ç±»çš„ç”Ÿå‘½å‘¨æœŸç›¸åŒã€‚å½“ç±»è¢«åŠ è½½æ—¶ï¼Œé™æ€å˜é‡è¢«åˆ›å»ºï¼›å½“ç±»è¢«å¸è½½æ—¶ï¼Œé™æ€å˜é‡æ‰ä¼šè¢«é”€æ¯ã€‚</li></ul><p>å› ä¸ºå®ƒçš„ç”Ÿå‘½å‘¨æœŸè´¯ç©¿æ•´ä¸ªç¨‹åºè¿è¡Œè¿‡ç¨‹ï¼Œæ‰€ä»¥ä¹Ÿå¸¸å¸¸è¢«ç§°ä¸ºâ€œå…¨å±€å˜é‡â€ã€‚</p><hr><h3 id="å¦‚ä½•è®¿é—®é™æ€å˜é‡ï¼Ÿ"><a href="#å¦‚ä½•è®¿é—®é™æ€å˜é‡ï¼Ÿ" class="headerlink" title="å¦‚ä½•è®¿é—®é™æ€å˜é‡ï¼Ÿ"></a>å¦‚ä½•è®¿é—®é™æ€å˜é‡ï¼Ÿ</h3><p>è®¿é—®é™æ€å˜é‡æœ‰ä¸¤ç§æ–¹å¼ï¼Œä½†æ¨èä½¿ç”¨ç¬¬ä¸€ç§ï¼Œå› ä¸ºå®ƒæ›´ç¬¦åˆé™æ€å˜é‡â€œå±äºç±»â€çš„ç‰¹æ€§ã€‚</p><ol><li><p>é€šè¿‡ç±»åè®¿é—®ï¼ˆæ¨èï¼‰</p><p>è¿™æ˜¯æœ€å¸¸è§ã€æœ€è§„èŒƒçš„è®¿é—®æ–¹å¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(User.company); <span class="comment">// è¾“å‡º: Google</span></span><br></pre></td></tr></table></figure></li><li><p>é€šè¿‡å¯¹è±¡å®ä¾‹è®¿é—®ï¼ˆä¸æ¨èï¼‰</p><p>è™½ç„¶å¯ä»¥é€šè¿‡å¯¹è±¡å®ä¾‹æ¥è®¿é—®é™æ€å˜é‡ï¼Œä½†ç¼–è¯‘å™¨ä¼šå‘å‡ºè­¦å‘Šï¼Œå› ä¸ºå®ƒå¯èƒ½ä¼šé€ æˆæ··æ·†ï¼Œè®©äººè¯¯ä»¥ä¸ºé™æ€å˜é‡æ˜¯å®ä¾‹ç‰¹æœ‰çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">User</span> <span class="variable">user1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;Alice&quot;</span>);</span><br><span class="line">System.out.println(user1.company); <span class="comment">// è¾“å‡º: Google</span></span><br></pre></td></tr></table></figure></li></ol><hr><h3 id="é™æ€å˜é‡çš„åº”ç”¨åœºæ™¯"><a href="#é™æ€å˜é‡çš„åº”ç”¨åœºæ™¯" class="headerlink" title="é™æ€å˜é‡çš„åº”ç”¨åœºæ™¯"></a>é™æ€å˜é‡çš„åº”ç”¨åœºæ™¯</h3><p>é™æ€å˜é‡å› å…¶â€œå…¨å±€å”¯ä¸€â€çš„ç‰¹æ€§ï¼Œéå¸¸é€‚åˆä»¥ä¸‹åœºæ™¯ï¼š</p><ol><li><p><strong>è®¡æ•°å™¨</strong>ï¼šéœ€è¦ç»Ÿè®¡æŸä¸ªç±»è¢«åˆ›å»ºäº†å¤šå°‘æ¬¡ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªé™æ€å˜é‡ä½œä¸ºè®¡æ•°å™¨ã€‚æ¯æ¬¡åˆ›å»ºå¯¹è±¡æ—¶ï¼Œå°±åœ¨æ„é€ å‡½æ•°ä¸­å¯¹è¯¥é™æ€å˜é‡è¿›è¡Œè‡ªå¢æ“ä½œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Counter</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Counter</span><span class="params">()</span> &#123;</span><br><span class="line">        count++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>å…±äº«é…ç½®</strong>ï¼šå½“æŸäº›æ•°æ®æ˜¯æ‰€æœ‰å¯¹è±¡å…±æœ‰çš„ï¼Œæ¯”å¦‚å…¬å¸åç§°ã€é¡¹ç›®åç§°ã€æ•°æ®åº“è¿æ¥æ± ç­‰ï¼Œå¯ä»¥å°†å®ƒä»¬å®šä¹‰ä¸ºé™æ€å˜é‡ï¼Œæ–¹ä¾¿æ‰€æœ‰å¯¹è±¡å…±äº«å’Œè®¿é—®ã€‚</p></li><li><p><strong>å¸¸é‡</strong>ï¼šå®šä¹‰ç¨‹åºä¸­ä¸ä¼šæ”¹å˜çš„å¸¸é‡ï¼Œé€šå¸¸ç»“åˆ <code>final</code> å…³é”®å­—ä¸€èµ·ä½¿ç”¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SERVER_URL</span> <span class="operator">=</span> <span class="string">&quot;http://api.example.com&quot;</span>;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å®šä¹‰çš„å¸¸é‡å¯ä»¥åœ¨æ•´ä¸ªç¨‹åºä¸­è¢«å®‰å…¨åœ°è®¿é—®ã€‚</p></li></ol><hr><h3 id="é™æ€å˜é‡çš„ç¼ºç‚¹ä¸æ³¨æ„äº‹é¡¹"><a href="#é™æ€å˜é‡çš„ç¼ºç‚¹ä¸æ³¨æ„äº‹é¡¹" class="headerlink" title="é™æ€å˜é‡çš„ç¼ºç‚¹ä¸æ³¨æ„äº‹é¡¹"></a>é™æ€å˜é‡çš„ç¼ºç‚¹ä¸æ³¨æ„äº‹é¡¹</h3><ul><li><strong>çº¿ç¨‹å®‰å…¨é—®é¢˜</strong>ï¼šç”±äºé™æ€å˜é‡æ˜¯æ‰€æœ‰çº¿ç¨‹å…±äº«çš„ï¼Œå½“å¤šä¸ªçº¿ç¨‹åŒæ—¶ä¿®æ”¹å®ƒæ—¶ï¼Œå¯èƒ½ä¼šå‘ç”Ÿæ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨é™æ€å˜é‡æ—¶ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„<strong>çº¿ç¨‹å®‰å…¨</strong>ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨åŒæ­¥é”æˆ–åŸå­ç±»ï¼ˆå¦‚ <code>AtomicInteger</code>ï¼‰æ¥ä¿è¯å¹¶å‘å®‰å…¨ã€‚</li><li><strong>è¿‡åº¦ä½¿ç”¨é—®é¢˜</strong>ï¼šæ»¥ç”¨é™æ€å˜é‡å¯èƒ½ä¼šå¯¼è‡´ç¨‹åºè€¦åˆåº¦è¿‡é«˜ï¼Œä¸åˆ©äºå•å…ƒæµ‹è¯•å’Œä»£ç ç»´æŠ¤ã€‚å› ä¸ºé™æ€å˜é‡æ— æ³•é€šè¿‡ä¾èµ–æ³¨å…¥è¿›è¡Œæ›¿æ¢ï¼Œæµ‹è¯•æ—¶éš¾ä»¥æ¨¡æ‹Ÿæˆ–éš”ç¦»å…¶çŠ¶æ€ã€‚</li></ul><p><code>new</code> å…³é”®å­—åœ¨ Java ä¸­æ˜¯ç”¨æ¥<strong>åˆ›å»ºå¯¹è±¡å®ä¾‹</strong>çš„ã€‚å½“ä½ åœ¨ä»£ç ä¸­ä½¿ç”¨ <code>new</code> å…³é”®å­—æ—¶ï¼Œå®ƒä¼šæ‰§è¡Œä»¥ä¸‹ä¸‰ä¸ªå…³é”®æ­¥éª¤ï¼š</p><h3 id="1-åˆ†é…å†…å­˜"><a href="#1-åˆ†é…å†…å­˜" class="headerlink" title="1. åˆ†é…å†…å­˜"></a>1. åˆ†é…å†…å­˜</h3><p><code>new</code> å…³é”®å­—ä¼šè®¡ç®—æ–°åˆ›å»ºå¯¹è±¡æ‰€éœ€çš„å†…å­˜å¤§å°ï¼Œå¹¶åœ¨ <strong>å †ï¼ˆHeapï¼‰</strong> ä¸Šä¸ºè¿™ä¸ªå¯¹è±¡åˆ†é…ä¸€å—å†…å­˜ç©ºé—´ã€‚è¿™å—å†…å­˜åŒ…å«äº†æ‰€æœ‰å®ä¾‹å˜é‡ï¼Œä»¥åŠæŒ‡å‘è¯¥ç±»ä¿¡æ¯çš„æŒ‡é’ˆï¼ˆä¾‹å¦‚ï¼Œè¯¥ç±»çš„<strong>æ–¹æ³•åŒº</strong>ä¸­çš„ç±»å…ƒä¿¡æ¯ï¼‰ã€‚</p><h3 id="2-åˆå§‹åŒ–å®ä¾‹å˜é‡"><a href="#2-åˆå§‹åŒ–å®ä¾‹å˜é‡" class="headerlink" title="2. åˆå§‹åŒ–å®ä¾‹å˜é‡"></a>2. åˆå§‹åŒ–å®ä¾‹å˜é‡</h3><p>å†…å­˜åˆ†é…å®Œæˆåï¼ŒJava ä¼šå¯¹å®ä¾‹å˜é‡è¿›è¡Œåˆå§‹åŒ–ã€‚</p><ul><li>å¦‚æœåœ¨å®šä¹‰æ—¶ç»™å˜é‡èµ‹äº†åˆå§‹å€¼ï¼Œé‚£ä¹ˆå®ƒä»¬ä¼šæŒ‰ç…§ä»£ç ä¸­çš„å€¼è¿›è¡Œåˆå§‹åŒ–ã€‚</li><li>å¦‚æœæ²¡æœ‰æ˜ç¡®èµ‹å€¼ï¼Œé‚£ä¹ˆå®ƒä»¬ä¼šè¢«èµ‹äºˆé»˜è®¤å€¼ï¼š<code>int</code> ä¸º 0ï¼Œ<code>boolean</code> ä¸º <code>false</code>ï¼Œå¼•ç”¨ç±»å‹ä¸º <code>null</code> ç­‰ã€‚</li></ul><h3 id="3-è°ƒç”¨æ„é€ æ–¹æ³•"><a href="#3-è°ƒç”¨æ„é€ æ–¹æ³•" class="headerlink" title="3. è°ƒç”¨æ„é€ æ–¹æ³•"></a>3. è°ƒç”¨æ„é€ æ–¹æ³•</h3><p>åˆå§‹åŒ–å®ä¾‹å˜é‡ä¹‹åï¼Œ<code>new</code> å…³é”®å­—ä¼šè°ƒç”¨ç±»çš„<strong>æ„é€ æ–¹æ³•</strong>ã€‚æ„é€ æ–¹æ³•çš„ä¸»è¦ä½œç”¨æ˜¯å®Œæˆå¯¹è±¡çš„æœ€ç»ˆåˆå§‹åŒ–å·¥ä½œï¼Œä¾‹å¦‚ä¸ºå®ä¾‹å˜é‡èµ‹ä¸Šæ›´å…·ä½“çš„å€¼ã€‚</p><hr><h3 id="new-å…³é”®å­—ä¸æ„é€ æ–¹æ³•çš„å…³ç³»"><a href="#new-å…³é”®å­—ä¸æ„é€ æ–¹æ³•çš„å…³ç³»" class="headerlink" title="new å…³é”®å­—ä¸æ„é€ æ–¹æ³•çš„å…³ç³»"></a><code>new</code> å…³é”®å­—ä¸æ„é€ æ–¹æ³•çš„å…³ç³»</h3><p>å¾ˆå¤šäººä¼šæŠŠ <code>new</code> å…³é”®å­—å’Œæ„é€ æ–¹æ³•æ··ä¸ºä¸€è°ˆï¼Œä½†å®ƒä»¬æ˜¯ä¸¤ä¸ªä¸åŒçš„æ¦‚å¿µã€‚</p><ul><li><strong>new å…³é”®å­—</strong> æ˜¯ä¸€ä¸ª<strong>æ“ä½œç¬¦</strong>ï¼Œè´Ÿè´£<strong>åˆ›å»ºå¯¹è±¡</strong>å¹¶<strong>åˆ†é…å†…å­˜</strong>ã€‚</li><li><strong>æ„é€ æ–¹æ³•</strong> æ˜¯ä¸€ä¸ª<strong>ç‰¹æ®Šæ–¹æ³•</strong>ï¼Œè´Ÿè´£<strong>åˆå§‹åŒ–å¯¹è±¡</strong>ã€‚</li></ul><p>ä½ å¯ä»¥æŠŠå®ƒä»¬æƒ³è±¡æˆè¿™æ ·ï¼š</p><ul><li><code>new</code> å°±åƒæ˜¯å·¥å‚çš„æµæ°´çº¿ï¼Œè´Ÿè´£åˆ¶é€ ä¸€ä¸ªç©ºå£³äº§å“ï¼ˆå¯¹è±¡ï¼‰ã€‚</li><li>æ„é€ æ–¹æ³•å°±åƒæ˜¯æµæ°´çº¿ä¸Šçš„å·¥äººï¼Œè´Ÿè´£ç»™è¿™ä¸ªäº§å“å¡«å……å†…å®¹ï¼ˆåˆå§‹åŒ–ï¼‰ã€‚</li></ul><p><code>new</code> å…³é”®å­—çš„ä½œç”¨æ˜¯<strong>å®ä¾‹åŒ–</strong>ï¼Œè€Œæ„é€ æ–¹æ³•çš„ä½œç”¨æ˜¯<strong>åˆå§‹åŒ–</strong>ã€‚åªæœ‰é€šè¿‡ <code>new</code> å…³é”®å­—ï¼Œä½ æ‰èƒ½è°ƒç”¨æ„é€ æ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚</p><h3 id="new-å…³é”®å­—çš„å±€é™æ€§"><a href="#new-å…³é”®å­—çš„å±€é™æ€§" class="headerlink" title="new å…³é”®å­—çš„å±€é™æ€§"></a><code>new</code> å…³é”®å­—çš„å±€é™æ€§</h3><p>è™½ç„¶ <code>new</code> æ˜¯æœ€å¸¸è§çš„å¯¹è±¡åˆ›å»ºæ–¹å¼ï¼Œä½†å®ƒä¹Ÿæœ‰ä¸€äº›å±€é™æ€§ï¼š</p><ul><li><strong>å¼ºè€¦åˆ</strong>ï¼šç›´æ¥ä½¿ç”¨ <code>new</code> ä¼šåœ¨ä»£ç ä¸­åˆ›å»ºå¯¹å…·ä½“ç±»çš„ä¾èµ–ï¼Œä¸åˆ©äºä»£ç è§£è€¦å’Œå•å…ƒæµ‹è¯•ã€‚</li><li><strong>æ— æ³•çµæ´»åˆ›å»º</strong>ï¼šä½ æ— æ³•é€šè¿‡ <code>new</code> å…³é”®å­—æ¥åŠ¨æ€åœ°å†³å®šåˆ›å»ºå“ªä¸ªç±»çš„å®ä¾‹ï¼Œä¹Ÿæ— æ³•åœ¨åˆ›å»ºå¯¹è±¡æ—¶è¿›è¡Œä¸€äº›é¢å¤–çš„é€»è¾‘å¤„ç†ã€‚</li></ul><p>å› æ­¤ï¼Œåœ¨å¾ˆå¤šè®¾è®¡æ¨¡å¼å’Œæ¡†æ¶ä¸­ï¼Œä¼šä½¿ç”¨å…¶ä»–æ–¹å¼æ¥ä»£æ›¿ <code>new</code>ï¼Œæ¯”å¦‚ï¼š</p><ul><li><strong>åå°„</strong>ï¼šé€šè¿‡ <code>Class.forName().newInstance()</code> æ¥åˆ›å»ºå¯¹è±¡ã€‚</li><li><strong>å·¥å‚æ¨¡å¼</strong>ï¼šé€šè¿‡å·¥å‚æ–¹æ³•æˆ–æŠ½è±¡å·¥å‚æ¥åˆ›å»ºå¯¹è±¡ã€‚</li><li><strong>ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰æ¡†æ¶</strong>ï¼šå¦‚ Spring æ¡†æ¶ï¼Œé€šè¿‡é…ç½®æ–‡ä»¶æˆ–æ³¨è§£è‡ªåŠ¨åˆ›å»ºå’Œç®¡ç†å¯¹è±¡ã€‚</li></ul><h2 id="Object"><a href="#Object" class="headerlink" title="Object"></a>Object</h2><ul><li><pre><code class="language-java"> /**  * native æ–¹æ³•ï¼Œç”¨äºè¿”å›å½“å‰è¿è¡Œæ—¶å¯¹è±¡çš„ Class å¯¹è±¡ï¼Œä½¿ç”¨äº† final å…³é”®å­—ä¿®é¥°ï¼Œæ•…ä¸å…è®¸å­ç±»é‡å†™ã€‚  */ public final native Class&lt;?&gt; getClass() /**  * native æ–¹æ³•ï¼Œç”¨äºè¿”å›å¯¹è±¡çš„å“ˆå¸Œç ï¼Œä¸»è¦ä½¿ç”¨åœ¨å“ˆå¸Œè¡¨ä¸­ï¼Œæ¯”å¦‚ JDK ä¸­çš„HashMapã€‚  */ public native int hashCode() /**  * ç”¨äºæ¯”è¾ƒ 2 ä¸ªå¯¹è±¡çš„å†…å­˜åœ°å€æ˜¯å¦ç›¸ç­‰ï¼ŒString ç±»å¯¹è¯¥æ–¹æ³•è¿›è¡Œäº†é‡å†™ä»¥ç”¨äºæ¯”è¾ƒå­—ç¬¦ä¸²çš„å€¼æ˜¯å¦ç›¸ç­‰ã€‚  */ public boolean equals(Object obj) /**  * native æ–¹æ³•ï¼Œç”¨äºåˆ›å»ºå¹¶è¿”å›å½“å‰å¯¹è±¡çš„ä¸€ä»½æ‹·è´ã€‚  */ protected native Object clone() throws CloneNotSupportedException /**  * è¿”å›ç±»çš„åå­—å®ä¾‹çš„å“ˆå¸Œç çš„ 16 è¿›åˆ¶çš„å­—ç¬¦ä¸²ã€‚å»ºè®® Object æ‰€æœ‰çš„å­ç±»éƒ½é‡å†™è¿™ä¸ªæ–¹æ³•ã€‚  */ public String toString() /**  * native æ–¹æ³•ï¼Œå¹¶ä¸”ä¸èƒ½é‡å†™ã€‚å”¤é†’ä¸€ä¸ªåœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„çº¿ç¨‹(ç›‘è§†å™¨ç›¸å½“äºå°±æ˜¯é”çš„æ¦‚å¿µ)ã€‚å¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹åœ¨ç­‰å¾…åªä¼šä»»æ„å”¤é†’ä¸€ä¸ªã€‚  */ public final native void notify() /**  * native æ–¹æ³•ï¼Œå¹¶ä¸”ä¸èƒ½é‡å†™ã€‚è·Ÿ notify ä¸€æ ·ï¼Œå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯ä¼šå”¤é†’åœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„æ‰€æœ‰çº¿ç¨‹ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªçº¿ç¨‹ã€‚  */ public final native void notifyAll() /**  * nativeæ–¹æ³•ï¼Œå¹¶ä¸”ä¸èƒ½é‡å†™ã€‚æš‚åœçº¿ç¨‹çš„æ‰§è¡Œã€‚æ³¨æ„ï¼šsleep æ–¹æ³•æ²¡æœ‰é‡Šæ”¾é”ï¼Œè€Œ wait æ–¹æ³•é‡Šæ”¾äº†é” ï¼Œtimeout æ˜¯ç­‰å¾…æ—¶é—´ã€‚  */ public final native void wait(long timeout) throws InterruptedException /**  * å¤šäº† nanos å‚æ•°ï¼Œè¿™ä¸ªå‚æ•°è¡¨ç¤ºé¢å¤–æ—¶é—´ï¼ˆä»¥çº³ç§’ä¸ºå•ä½ï¼ŒèŒƒå›´æ˜¯ 0-999999ï¼‰ã€‚ æ‰€ä»¥è¶…æ—¶çš„æ—¶é—´è¿˜éœ€è¦åŠ ä¸Š nanos çº³ç§’ã€‚ã€‚  */ public final void wait(long timeout, int nanos) throws InterruptedException /**  * è·Ÿä¹‹å‰çš„2ä¸ªwaitæ–¹æ³•ä¸€æ ·ï¼Œåªä¸è¿‡è¯¥æ–¹æ³•ä¸€ç›´ç­‰å¾…ï¼Œæ²¡æœ‰è¶…æ—¶æ—¶é—´è¿™ä¸ªæ¦‚å¿µ  */ public final void wait() throws InterruptedException /**  * å®ä¾‹è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„æ—¶å€™è§¦å‘çš„æ“ä½œ  */ protected void finalize() throws Throwable &#123; &#125; <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    ------</span><br><span class="line"></span><br><span class="line">    ## `Object` ç±»çš„æ‰€æœ‰æ–¹æ³•</span><br><span class="line"></span><br><span class="line">    #### 1. `public final native Class&lt;?&gt; getClass()`</span><br><span class="line"></span><br><span class="line">    è¿”å›å½“å‰æ­£åœ¨è¿è¡Œçš„å¯¹è±¡çš„ **Class** å¯¹è±¡ã€‚è¿™ä¸ªæ–¹æ³•æ˜¯ **final** çš„ï¼Œè¿™æ„å‘³ç€ä½ ä¸èƒ½é‡å†™å®ƒã€‚å®ƒé€šå¸¸ç”¨äºåå°„ï¼ˆReflectionï¼‰ï¼Œè®©ä½ åœ¨è¿è¡Œæ—¶è·å–å¯¹è±¡çš„ç±»å‹ä¿¡æ¯ã€‚</span><br><span class="line"></span><br><span class="line">    #### 2. `public native int hashCode()`</span><br><span class="line"></span><br><span class="line">    è¿”å›å¯¹è±¡çš„ **å“ˆå¸Œç ** å€¼ã€‚è¿™ä¸ªå“ˆå¸Œå€¼é€šå¸¸ç”¨äºåŸºäºå“ˆå¸Œçš„é›†åˆï¼Œå¦‚ `HashMap`ã€`HashSet` å’Œ `HashTable`ã€‚**hashCode() å’Œ equals() å¿…é¡»ä¿æŒä¸€è‡´**ï¼šå¦‚æœä¸¤ä¸ªå¯¹è±¡ `equals()` è¿”å› `true`ï¼Œé‚£ä¹ˆå®ƒä»¬çš„ `hashCode()` ä¹Ÿå¿…é¡»ç›¸ç­‰ã€‚</span><br><span class="line"></span><br><span class="line">    #### 3. `public boolean equals(Object obj)`</span><br><span class="line"></span><br><span class="line">    æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰ã€‚**Object** ç±»çš„é»˜è®¤å®ç°æ˜¯æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„**å†…å­˜åœ°å€**ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸ºäº†æ¯”è¾ƒå¯¹è±¡çš„å†…å®¹ï¼Œä½ éœ€è¦æ ¹æ®ä¸šåŠ¡é€»è¾‘**é‡å†™**è¿™ä¸ªæ–¹æ³•ã€‚</span><br><span class="line"></span><br><span class="line">    #### 4. `protected native Object clone() throws CloneNotSupportedException`</span><br><span class="line"></span><br><span class="line">    åˆ›å»ºå¹¶è¿”å›å½“å‰å¯¹è±¡çš„**æµ…æ‹·è´**ã€‚è¦ä½¿ç”¨ `clone()` æ–¹æ³•ï¼Œä½ çš„ç±»å¿…é¡»å®ç°**`Cloneable`**æ¥å£ï¼Œå¦åˆ™ä¼šæŠ›å‡º `CloneNotSupportedException` å¼‚å¸¸ã€‚</span><br><span class="line"></span><br><span class="line">    #### 5. `public String toString()`</span><br><span class="line"></span><br><span class="line">    è¿”å›å¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤ºã€‚é»˜è®¤è¿”å› `â€œç±»å@å¯¹è±¡çš„å“ˆå¸Œç çš„æ— ç¬¦å·åå…­è¿›åˆ¶è¡¨ç¤ºâ€`ã€‚ä¸ºäº†æä¾›æœ‰æ„ä¹‰çš„å­—ç¬¦ä¸²æè¿°ï¼Œé€šå¸¸éœ€è¦**é‡å†™**è¿™ä¸ªæ–¹æ³•ã€‚</span><br><span class="line"></span><br><span class="line">    #### 6. `public final native void notify()`</span><br><span class="line"></span><br><span class="line">    å”¤é†’åœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ï¼ˆmonitorï¼‰ä¸Šç­‰å¾…çš„**ä¸€ä¸ª**çº¿ç¨‹ã€‚è¿™ä¸ªæ–¹æ³•å¿…é¡»åœ¨ `synchronized` ä»£ç å—ä¸­è°ƒç”¨ï¼Œå¦åˆ™ä¼šæŠ›å‡º `IllegalMonitorStateException`ã€‚</span><br><span class="line"></span><br><span class="line">    #### 7. `public final native void notifyAll()`</span><br><span class="line"></span><br><span class="line">    å”¤é†’åœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„**æ‰€æœ‰**çº¿ç¨‹ã€‚ä¸ `notify()` ä¸€æ ·ï¼Œå®ƒä¹Ÿå¿…é¡»åœ¨ `synchronized` ä»£ç å—ä¸­è°ƒç”¨ã€‚</span><br><span class="line"></span><br><span class="line">    #### 8. `public final native void wait(long timeout) throws InterruptedException`</span><br><span class="line"></span><br><span class="line">    è®©å½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œå¹¶é‡Šæ”¾å®ƒæ‰€æŒæœ‰çš„é”ï¼Œç›´åˆ°å…¶ä»–çº¿ç¨‹è°ƒç”¨ `notify()` æˆ– `notifyAll()`ï¼Œæˆ–è€…ç­‰å¾…æ—¶é—´è¶…æ—¶ã€‚</span><br><span class="line"></span><br><span class="line">    #### 9. `public final void wait() throws InterruptedException`</span><br><span class="line"></span><br><span class="line">    ä¸ `wait(long timeout)` ç±»ä¼¼ï¼Œä½†å®ƒä¼š**æ— é™æœŸ**åœ°ç­‰å¾…ï¼Œç›´åˆ°è¢«å”¤é†’ã€‚</span><br><span class="line"></span><br><span class="line">    #### 10. `public final void wait(long timeout, int nanos) throws InterruptedException`</span><br><span class="line"></span><br><span class="line">    æ›´ç²¾ç¡®çš„ `wait()` æ–¹æ³•ï¼Œå…è®¸ä»¥æ¯«ç§’å’Œçº³ç§’ä¸ºå•ä½æŒ‡å®šç­‰å¾…æ—¶é—´ã€‚</span><br><span class="line"></span><br><span class="line">    #### 11. `protected void finalize() throws Throwable`</span><br><span class="line"></span><br><span class="line">    å½“åƒåœ¾å›æ”¶å™¨ç¡®å®šæ²¡æœ‰å¯¹è¯¥å¯¹è±¡çš„å¼•ç”¨æ—¶ï¼Œåƒåœ¾å›æ”¶å™¨ä¼šåœ¨è¯¥å¯¹è±¡ä¸Šè°ƒç”¨æ­¤æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•ç”¨äºåœ¨å¯¹è±¡è¢«é”€æ¯å‰æ‰§è¡Œä¸€äº›æ¸…ç†å·¥ä½œã€‚**ä¸æ¨è**ä½¿ç”¨ `finalize()`ï¼Œå› ä¸ºå®ƒä¸ä¿è¯ä½•æ—¶æ‰§è¡Œï¼Œç”šè‡³å¯èƒ½ä¸æ‰§è¡Œï¼Œå¹¶ä¸”ä¼šå½±å“åƒåœ¾å›æ”¶æ€§èƒ½ã€‚ç°ä»£ Java ä¸­åº”ä½¿ç”¨ `try-with-resources` æˆ–å…¶ä»–èµ„æºç®¡ç†æ–¹å¼ã€‚</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">## **String ç±»å‹**</span><br><span class="line"></span><br><span class="line">### 1. å­—èŠ‚å’Œå­—ç¬¦çš„åŒºåˆ«ï¼Ÿ</span><br><span class="line"></span><br><span class="line">å­—èŠ‚æ˜¯å­˜å‚¨å®¹é‡çš„åŸºæœ¬å•ä½ï¼›å­—ç¬¦æ˜¯æ•°å­—ã€å­—æ¯ã€æ±‰å­—ä»¥åŠå…¶ä»–è¯­è¨€çš„å„ç§ç¬¦å·ï¼›1 å­—èŠ‚ = 8 ä¸ªäºŒè¿›åˆ¶å•ä½ï¼Œä¸€ä¸ªå­—ç¬¦ç”±ä¸€ä¸ªå­—èŠ‚æˆ–å¤šä¸ªå­—èŠ‚çš„äºŒè¿›åˆ¶å•ä½ç»„æˆã€‚</span><br><span class="line"></span><br><span class="line">------</span><br><span class="line"></span><br><span class="line">### 2. String ä¸ºä»€ä¹ˆè¦è®¾è®¡ä¸ºä¸å¯å˜ç±»ï¼Ÿ</span><br><span class="line"></span><br><span class="line">åœ¨ Java ä¸­å°† String è®¾è®¡æˆä¸å¯å˜çš„æ˜¯ç»¼åˆè€ƒè™‘åˆ°å„ç§å› ç´ çš„ç»“æœã€‚ä¸»è¦çš„åŸå› ä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ç‚¹ï¼š</span><br><span class="line"></span><br><span class="line">- **å­—ç¬¦ä¸²å¸¸é‡æ± çš„éœ€è¦**ï¼šå­—ç¬¦ä¸²å¸¸é‡æ± æ˜¯ Java å †å†…å­˜ä¸­ä¸€ä¸ªç‰¹æ®Šçš„å­˜å‚¨åŒºåŸŸ, å½“åˆ›å»ºä¸€ä¸ª String å¯¹è±¡æ—¶ï¼Œå‡å¦‚æ­¤å­—ç¬¦ä¸²å€¼å·²ç»å­˜åœ¨äºå¸¸é‡æ± ä¸­ï¼Œåˆ™ä¸ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œè€Œæ˜¯å¼•ç”¨å·²ç»å­˜åœ¨çš„å¯¹è±¡ï¼›</span><br><span class="line">- **å…è®¸ String å¯¹è±¡ç¼“å­˜ HashCode**ï¼šJava ä¸­ String å¯¹è±¡çš„å“ˆå¸Œç è¢«é¢‘ç¹åœ°ä½¿ç”¨, æ¯”å¦‚åœ¨ HashMap ç­‰å®¹å™¨ä¸­ã€‚å­—ç¬¦ä¸²ä¸å˜æ€§ä¿è¯äº† hash ç çš„å”¯ä¸€æ€§ï¼Œå› æ­¤å¯ä»¥æ”¾å¿ƒåœ°è¿›è¡Œç¼“å­˜ã€‚è¿™ä¹Ÿæ˜¯ä¸€ç§æ€§èƒ½ä¼˜åŒ–æ‰‹æ®µï¼Œæ„å‘³ç€ä¸å¿…æ¯æ¬¡éƒ½å»è®¡ç®—æ–°çš„å“ˆå¸Œç ï¼›</span><br><span class="line">- **String è¢«è®¸å¤šçš„ Java ç±»(åº“)ç”¨æ¥å½“åšå‚æ•°**ï¼Œä¾‹å¦‚ï¼šç½‘ç»œè¿æ¥åœ°å€ URLã€æ–‡ä»¶è·¯å¾„ pathã€è¿˜æœ‰åå°„æœºåˆ¶æ‰€éœ€è¦çš„ String å‚æ•°ç­‰, å‡è‹¥ String ä¸æ˜¯å›ºå®šä¸å˜çš„ï¼Œå°†ä¼šå¼•èµ·å„ç§å®‰å…¨éšæ‚£ã€‚</span><br><span class="line"></span><br><span class="line">------</span><br><span class="line"></span><br><span class="line">### 3. Stringã€StringBuilderã€StringBuffer çš„åŒºåˆ«ï¼Ÿ</span><br><span class="line"></span><br><span class="line">stringç±»ä¸èƒ½è¢«ç»§æ‰¿ï¼Œå› ä¸ºè¢«finalä¿®é¥°</span><br><span class="line"></span><br><span class="line">- **String**ï¼šç”¨äºå­—ç¬¦ä¸²æ“ä½œï¼Œå±äºä¸å¯å˜ç±»ï¼›ã€è¡¥å……ï¼šString ä¸æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼Œæ˜¯å¼•ç”¨ç±»å‹ï¼Œåº•å±‚ç”¨ char æ•°ç»„å®ç°çš„ã€‘</span><br><span class="line">- **StringBuilder**ï¼šä¸ StringBuffer ç±»ä¼¼ï¼Œéƒ½æ˜¯å­—ç¬¦ä¸²ç¼“å†²åŒºï¼Œä½†çº¿ç¨‹ä¸å®‰å…¨ï¼›</span><br><span class="line">- **StringBuffer**ï¼šä¹Ÿç”¨äºå­—ç¬¦ä¸²æ“ä½œï¼Œä¸åŒä¹‹å¤„æ˜¯ StringBuffer å±äºå¯å˜ç±»ï¼Œå¯¹æ–¹æ³•åŠ äº†åŒæ­¥é”ï¼Œçº¿ç¨‹å®‰å…¨</span><br><span class="line"></span><br><span class="line">StringBufferçš„è¡¥å……è¯´æ˜ï¼šStringBuffer ä¸­å¹¶ä¸æ˜¯æ‰€æœ‰æ–¹æ³•éƒ½ä½¿ç”¨äº† Synchronized ä¿®é¥°æ¥å®ç°åŒæ­¥ï¼š</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line">@Override public StringBuffer insert(int dstOffset, CharSequence s) &#123; // Note, synchronization achieved via invocations of other StringBuffer methods // after narrowing of s to specific type // Ditto for toStringCache clearing super.insert(dstOffset, s); return this; &#125;</span><br></pre></td></tr></table></figure></code></pre></li></ul><p>æ‰§è¡Œæ•ˆç‡ï¼šStringBuilder &gt; StringBuffer &gt; String</p><hr><h3 id="4-String-å­—ç¬¦ä¸²ä¿®æ”¹å®ç°çš„åŸç†ï¼Ÿ"><a href="#4-String-å­—ç¬¦ä¸²ä¿®æ”¹å®ç°çš„åŸç†ï¼Ÿ" class="headerlink" title="4. String å­—ç¬¦ä¸²ä¿®æ”¹å®ç°çš„åŸç†ï¼Ÿ"></a>4. String å­—ç¬¦ä¸²ä¿®æ”¹å®ç°çš„åŸç†ï¼Ÿ</h3><p>å½“ç”¨ String ç±»å‹æ¥å¯¹å­—ç¬¦ä¸²è¿›è¡Œä¿®æ”¹æ—¶ï¼Œå…¶å®ç°æ–¹æ³•æ˜¯é¦–å…ˆåˆ›å»ºä¸€ä¸ª StringBufferï¼Œå…¶æ¬¡è°ƒç”¨ StringBuffer çš„ <code>append()</code> æ–¹æ³•ï¼Œæœ€åè°ƒç”¨ StringBuffer çš„ <code>toString()</code> æ–¹æ³•æŠŠç»“æœè¿”å›ã€‚</p><hr><h3 id="5-String-str-â€œiâ€-ä¸-String-str-new-String-â€œiâ€-ä¸€æ ·å—ï¼Ÿ"><a href="#5-String-str-â€œiâ€-ä¸-String-str-new-String-â€œiâ€-ä¸€æ ·å—ï¼Ÿ" class="headerlink" title="5. String str &#x3D; â€œiâ€ ä¸ String str &#x3D; new String(â€œiâ€) ä¸€æ ·å—ï¼Ÿ"></a>5. String str &#x3D; â€œiâ€ ä¸ String str &#x3D; new String(â€œiâ€) ä¸€æ ·å—ï¼Ÿ</h3><p>ä¸ä¸€æ ·ï¼Œå› ä¸ºå†…å­˜çš„åˆ†é…æ–¹å¼ä¸ä¸€æ ·ã€‚<code>String str = &quot;i&quot;</code> çš„æ–¹å¼ï¼ŒJava è™šæ‹Ÿæœºä¼šå°†å…¶åˆ†é…åˆ°å¸¸é‡æ± ä¸­ï¼›è€Œ <code>String str = new String(&quot;i&quot;)</code> åˆ™ä¼šè¢«åˆ†åˆ°å †å†…å­˜ä¸­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str1</span> <span class="operator">=</span> <span class="string">&quot;abc&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str2</span> <span class="operator">=</span> <span class="string">&quot;abc&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">str4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line">        System.out.println(str1 == str2);</span><br><span class="line">        System.out.println(str1 == str3);</span><br><span class="line">        System.out.println(str3 == str4);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// true</span></span><br><span class="line"><span class="comment">// false</span></span><br><span class="line"><span class="comment">// false</span></span><br><span class="line">System.out.println(str3.equals(str4)); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>åœ¨æ‰§è¡Œ <code>String str1 = &quot;abc&quot;</code> çš„æ—¶å€™ï¼ŒJVM ä¼šé¦–å…ˆæ£€æŸ¥å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æ˜¯å¦å·²ç»å­˜åœ¨è¯¥å­—ç¬¦ä¸²å¯¹è±¡ï¼Œå¦‚æœå·²ç»å­˜åœ¨ï¼Œé‚£ä¹ˆå°±ä¸ä¼šå†åˆ›å»ºäº†ï¼Œç›´æ¥è¿”å›è¯¥å­—ç¬¦ä¸²åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„å†…å­˜åœ°å€ï¼›å¦‚æœè¯¥å­—ç¬¦ä¸²è¿˜ä¸å­˜åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ï¼Œé‚£ä¹ˆå°±ä¼šåœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­åˆ›å»ºè¯¥å­—ç¬¦ä¸²å¯¹è±¡ï¼Œç„¶åå†è¿”å›ã€‚æ‰€ä»¥åœ¨æ‰§è¡Œ <code>String str2 = &quot;abc&quot;</code> çš„æ—¶å€™ï¼Œå› ä¸ºå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å·²ç»å­˜åœ¨â€œabcâ€å­—ç¬¦ä¸²å¯¹è±¡äº†ï¼Œå°±ä¸ä¼šåœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å†æ¬¡åˆ›å»ºäº†ï¼Œæ‰€ä»¥æ ˆå†…å­˜ä¸­ str1 å’Œ str2 çš„å†…å­˜åœ°å€éƒ½æ˜¯æŒ‡å‘ â€œabcâ€ åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„ä½ç½®ï¼Œæ‰€ä»¥ <code>str1 = str2</code> çš„è¿è¡Œç»“æœä¸º trueã€‚</p><p>è€Œåœ¨æ‰§è¡Œ <code>String str3 = new String(&quot;abc&quot;)</code> çš„æ—¶å€™ï¼ŒJVM ä¼šé¦–å…ˆæ£€æŸ¥å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æ˜¯å¦å·²ç»å­˜åœ¨â€œabcâ€å­—ç¬¦ä¸²ï¼Œå¦‚æœå·²ç»å­˜åœ¨ï¼Œåˆ™ä¸ä¼šåœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å†åˆ›å»ºäº†ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™å°±ä¼šåœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­åˆ›å»º â€œabcâ€ å­—ç¬¦ä¸²å¯¹è±¡ï¼Œç„¶åå†åˆ°å †å†…å­˜ä¸­å†åˆ›å»ºä¸€ä»½å­—ç¬¦ä¸²å¯¹è±¡ï¼ŒæŠŠå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„ â€œabcâ€ å­—ç¬¦ä¸²å†…å®¹æ‹·è´åˆ°å†…å­˜ä¸­çš„å­—ç¬¦ä¸²å¯¹è±¡ä¸­ï¼Œç„¶åè¿”å›å †å†…å­˜ä¸­è¯¥å­—ç¬¦ä¸²çš„å†…å­˜åœ°å€ï¼Œå³æ ˆå†…å­˜ä¸­å­˜å‚¨çš„åœ°å€æ˜¯å †å†…å­˜ä¸­å¯¹è±¡çš„å†…å­˜åœ°å€ã€‚<code>String str4 = new String(&quot;abc&quot;)</code> æ˜¯åœ¨å †å†…å­˜ä¸­åˆåˆ›å»ºäº†ä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥ <code>str3 == str4</code> è¿è¡Œçš„ç»“æœæ˜¯ falseã€‚str1ã€str2ã€str3ã€str4 åœ¨å†…å­˜ä¸­çš„å­˜å‚¨çŠ¶å†µå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><hr><h3 id="6-String-ç±»çš„å¸¸ç”¨æ–¹æ³•éƒ½æœ‰é‚£äº›ï¼Ÿ"><a href="#6-String-ç±»çš„å¸¸ç”¨æ–¹æ³•éƒ½æœ‰é‚£äº›ï¼Ÿ" class="headerlink" title="6. String ç±»çš„å¸¸ç”¨æ–¹æ³•éƒ½æœ‰é‚£äº›ï¼Ÿ"></a>6. String ç±»çš„å¸¸ç”¨æ–¹æ³•éƒ½æœ‰é‚£äº›ï¼Ÿ</h3><ul><li><code>indexOf()</code>ï¼šè¿”å›æŒ‡å®šå­—ç¬¦çš„ç´¢å¼•ã€‚</li><li><code>charAt()</code>ï¼šè¿”å›æŒ‡å®šç´¢å¼•å¤„çš„å­—ç¬¦ã€‚</li><li><code>replace()</code>ï¼šå­—ç¬¦ä¸²æ›¿æ¢ã€‚</li><li><code>trim()</code>ï¼šå»é™¤å­—ç¬¦ä¸²ä¸¤ç«¯ç©ºç™½ã€‚</li><li><code>split()</code>ï¼šåˆ†å‰²å­—ç¬¦ä¸²ï¼Œè¿”å›ä¸€ä¸ªåˆ†å‰²åçš„å­—ç¬¦ä¸²æ•°ç»„ã€‚</li><li><code>getBytes()</code>ï¼šè¿”å›å­—ç¬¦ä¸²çš„ byte ç±»å‹æ•°ç»„ã€‚</li><li><code>length()</code>ï¼šè¿”å›å­—ç¬¦ä¸²é•¿åº¦ã€‚</li><li><code>toLowerCase()</code>ï¼šå°†å­—ç¬¦ä¸²è½¬æˆå°å†™å­—æ¯ã€‚</li><li><code>toUpperCase()</code>ï¼šå°†å­—ç¬¦ä¸²è½¬æˆå¤§å†™å­—ç¬¦ã€‚</li><li><code>substring()</code>ï¼šæˆªå–å­—ç¬¦ä¸²ã€‚</li><li><code>equals()</code>ï¼šå­—ç¬¦ä¸²æ¯”è¾ƒã€‚</li></ul><hr><h3 id="7-final-ä¿®é¥°-StringBuffer-åè¿˜å¯ä»¥-append-å—ï¼Ÿ"><a href="#7-final-ä¿®é¥°-StringBuffer-åè¿˜å¯ä»¥-append-å—ï¼Ÿ" class="headerlink" title="7. final ä¿®é¥° StringBuffer åè¿˜å¯ä»¥ append å—ï¼Ÿ"></a>7. final ä¿®é¥° StringBuffer åè¿˜å¯ä»¥ append å—ï¼Ÿ</h3><p>å¯ä»¥ã€‚<code>final</code> ä¿®é¥°çš„æ˜¯ä¸€ä¸ªå¼•ç”¨å˜é‡ï¼Œé‚£ä¹ˆè¿™ä¸ªå¼•ç”¨å§‹ç»ˆåªèƒ½æŒ‡å‘è¿™ä¸ªå¯¹è±¡ï¼Œä½†æ˜¯è¿™ä¸ªå¯¹è±¡å†…éƒ¨çš„å±æ€§æ˜¯å¯ä»¥å˜åŒ–çš„ã€‚</p><p>å®˜æ–¹æ–‡æ¡£è§£é‡Šï¼š<code>once a final variable has been assigned, it always contains the same value. If a final variable holds a reference to an object, then the state of the object may be changed by operations on the object, but the variable will always refer to the same object.</code></p><p><code>String</code> æ˜¯ä¸€ä¸ªéå¸¸ç‰¹æ®Šçš„ç±»å‹ï¼Œå®ƒ<strong>ä¸æ˜¯åŸºæœ¬æ•°æ®ç±»å‹</strong>ï¼Œè€Œæ˜¯ä¸€ä¸ª<strong>å¼•ç”¨æ•°æ®ç±»å‹ï¼ˆReference Data Typeï¼‰</strong>ã€‚</p><h4 id="String-çš„æ ¸å¿ƒç‰¹æ€§"><a href="#String-çš„æ ¸å¿ƒç‰¹æ€§" class="headerlink" title="String çš„æ ¸å¿ƒç‰¹æ€§"></a><strong>String çš„æ ¸å¿ƒç‰¹æ€§</strong></h4><ol><li><strong>ä¸å¯å˜æ€§ï¼ˆImmutabilityï¼‰</strong><ul><li><code>String</code> å¯¹è±¡ä¸€æ—¦è¢«åˆ›å»ºï¼Œå®ƒçš„å€¼å°±ä¸èƒ½è¢«æ”¹å˜ã€‚</li><li>å½“ä½ å¯¹ <code>String</code> è¿›è¡Œä¿®æ”¹æ“ä½œæ—¶ï¼Œæ¯”å¦‚æ‹¼æ¥å­—ç¬¦ä¸²ï¼Œå®é™…ä¸Šæ˜¯<strong>åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ String å¯¹è±¡</strong>ï¼Œè€ŒåŸå§‹å¯¹è±¡æ²¡æœ‰æ”¹å˜ã€‚</li><li>è¿™ç§ä¸å¯å˜æ€§ä½¿å¾— <code>String</code> å¯¹è±¡æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¯ä»¥åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­è¢«å®‰å…¨åœ°å…±äº«ã€‚</li></ul></li><li><strong>String çš„åˆ›å»º</strong><ul><li><strong>å­—é¢é‡æ–¹å¼</strong>ï¼š<code>String s = &quot;hello&quot;;</code><ul><li>è¿™ç§æ–¹å¼åˆ›å»ºçš„å­—ç¬¦ä¸²ä¼šè¢«å­˜å‚¨åœ¨**å­—ç¬¦ä¸²å¸¸é‡æ± ï¼ˆString Poolï¼‰**ä¸­ã€‚</li><li>å½“åˆ›å»ºç¬¬äºŒä¸ªå€¼ä¸º <code>&quot;hello&quot;</code> çš„å­—ç¬¦ä¸²æ—¶ï¼ŒJVM ä¼šç›´æ¥ä»å¸¸é‡æ± ä¸­è¿”å›å·²å­˜åœ¨çš„å¯¹è±¡å¼•ç”¨ï¼Œè€Œä¸ä¼šåˆ›å»ºæ–°çš„å¯¹è±¡ã€‚è¿™æ˜¯ä¸€ç§é‡è¦çš„å†…å­˜ä¼˜åŒ–ã€‚</li></ul></li><li><strong>new å…³é”®å­—æ–¹å¼</strong>ï¼š<code>String s = new String(&quot;hello&quot;);</code><ul><li>è¿™ç§æ–¹å¼ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ <code>String</code> å¯¹è±¡åœ¨å †ï¼ˆHeapï¼‰ä¸­ã€‚å³ä½¿å¸¸é‡æ± ä¸­å·²ç»å­˜åœ¨ <code>&quot;hello&quot;</code>ï¼Œä¹Ÿä¼šåœ¨å †ä¸­å†åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚</li></ul></li></ul></li></ol><h4 id="String-çš„å¸¸ç”¨æ–¹æ³•"><a href="#String-çš„å¸¸ç”¨æ–¹æ³•" class="headerlink" title="String çš„å¸¸ç”¨æ–¹æ³•"></a><strong>String çš„å¸¸ç”¨æ–¹æ³•</strong></h4><ul><li><strong>æ‹¼æ¥</strong>ï¼š<ul><li>ä½¿ç”¨ <code>+</code> è¿ç®—ç¬¦ï¼š<code>String s3 = s1 + s2;</code></li><li>ä½¿ç”¨ <code>concat()</code> æ–¹æ³•ï¼š<code>s1.concat(s2);</code></li><li>æ¨èä½¿ç”¨ <code>StringBuilder</code> æˆ– <code>StringBuffer</code> è¿›è¡Œå¤§é‡å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œå› ä¸ºå®ƒä»¬æ˜¯å¯å˜çš„ï¼Œæ•ˆç‡æ›´é«˜ã€‚</li></ul></li><li><strong>æ¯”è¾ƒ</strong>ï¼š<ul><li><code>equals()</code>ï¼šæ¯”è¾ƒå­—ç¬¦ä¸²çš„å†…å®¹ï¼Œè¿”å› <code>boolean</code> ç±»å‹ã€‚</li><li><code>equalsIgnoreCase()</code>ï¼šå¿½ç•¥å¤§å°å†™æ¯”è¾ƒå­—ç¬¦ä¸²å†…å®¹ã€‚</li><li><code>==</code>ï¼šæ¯”è¾ƒçš„æ˜¯<strong>å¯¹è±¡çš„å¼•ç”¨åœ°å€</strong>ï¼Œåªæœ‰å½“ä¸¤ä¸ªå¼•ç”¨æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡æ—¶æ‰ä¸º <code>true</code>ã€‚</li></ul></li><li><strong>æŸ¥æ‰¾</strong>ï¼š<ul><li><code>indexOf(char)</code>ï¼šæŸ¥æ‰¾å­—ç¬¦ç¬¬ä¸€æ¬¡å‡ºç°çš„ç´¢å¼•ã€‚</li><li><code>contains(String)</code>ï¼šåˆ¤æ–­æ˜¯å¦åŒ…å«æŸä¸ªå­å­—ç¬¦ä¸²ã€‚</li></ul></li><li><strong>ä¿®æ”¹</strong>ï¼š<ul><li><code>replace(oldChar, newChar)</code>ï¼šæ›¿æ¢å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦ã€‚</li><li><code>substring(beginIndex, endIndex)</code>ï¼šæˆªå–å­å­—ç¬¦ä¸²ã€‚</li></ul></li></ul><h4 id="ä¸ºä»€ä¹ˆä¸ç”¨-char-æ•°ç»„ä»£æ›¿-Stringï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆä¸ç”¨-char-æ•°ç»„ä»£æ›¿-Stringï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä¸ç”¨ char æ•°ç»„ä»£æ›¿ Stringï¼Ÿ"></a><strong>ä¸ºä»€ä¹ˆä¸ç”¨ char æ•°ç»„ä»£æ›¿ Stringï¼Ÿ</strong></h4><p>è™½ç„¶ <code>String</code> å†…éƒ¨ä¹Ÿæ˜¯ç”¨ <code>char</code> æ•°ç»„å®ç°çš„ï¼Œä½† <code>String</code> çš„ä¸å¯å˜æ€§æä¾›äº†å¾ˆå¤šä¼˜åŠ¿ï¼š</p><ul><li><strong>å®‰å…¨æ€§</strong>ï¼šä½œä¸ºæ–¹æ³•å‚æ•°æ—¶ï¼Œå¯ä»¥é˜²æ­¢æ–¹æ³•å†…éƒ¨ä¿®æ”¹åŸå§‹å­—ç¬¦ä¸²ã€‚</li><li><strong>çº¿ç¨‹å®‰å…¨</strong>ï¼šå¯ä»¥åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å…±äº«ã€‚</li><li><strong>å“ˆå¸Œç ç¼“å­˜</strong>ï¼š<code>String</code> çš„å“ˆå¸Œç ä¼šè¢«ç¼“å­˜ï¼Œåœ¨ä½œä¸º <code>HashMap</code> çš„é”®æ—¶ï¼Œæ€§èƒ½æ›´å¥½ã€‚</li></ul><hr><h3 id="åŸºæœ¬ç±»å‹ä¸-String-çš„è½¬æ¢"><a href="#åŸºæœ¬ç±»å‹ä¸-String-çš„è½¬æ¢" class="headerlink" title="åŸºæœ¬ç±»å‹ä¸ String çš„è½¬æ¢"></a><strong>åŸºæœ¬ç±»å‹ä¸ String çš„è½¬æ¢</strong></h3><ul><li><strong>åŸºæœ¬ç±»å‹è½¬ String</strong>ï¼š<ul><li><code>String.valueOf(int i)</code></li><li><code>Integer.toString(int i)</code></li><li><code>&quot;&quot; + i</code></li></ul></li><li><strong>String è½¬åŸºæœ¬ç±»å‹</strong>ï¼š<ul><li><code>Integer.parseInt(&quot;123&quot;)</code></li><li><code>Double.parseDouble(&quot;3.14&quot;)</code></li><li><code>Float.parseFloat(&quot;1.23&quot;)</code></li><li>ç­‰ç­‰ã€‚</li></ul></li></ul><blockquote><p><strong>æ³¨æ„</strong>ï¼š<code>String</code> è½¬åŸºæœ¬ç±»å‹æ—¶ï¼Œå¦‚æœå­—ç¬¦ä¸²æ ¼å¼ä¸æ­£ç¡®ï¼Œä¼šæŠ›å‡º <code>NumberFormatException</code>ã€‚</p></blockquote><p><code>&amp;</code> å’Œ <code>&amp;&amp;</code> åœ¨ Java ä¸­éƒ½æ˜¯é€»è¾‘ä¸è¿ç®—ç¬¦ï¼Œä½†å®ƒä»¬ä¹‹é—´æœ‰ä¸€ä¸ªè‡³å…³é‡è¦çš„åŒºåˆ«ï¼š<strong>çŸ­è·¯ç‰¹æ€§</strong>ã€‚</p><hr><h3 id="ï¼ˆé€»è¾‘ä¸-æŒ‰ä½ä¸ï¼‰"><a href="#ï¼ˆé€»è¾‘ä¸-æŒ‰ä½ä¸ï¼‰" class="headerlink" title="&amp;ï¼ˆé€»è¾‘ä¸ &#x2F; æŒ‰ä½ä¸ï¼‰"></a><code>&amp;</code>ï¼ˆé€»è¾‘ä¸ &#x2F; æŒ‰ä½ä¸ï¼‰</h3><p><code>&amp;</code> è¿ç®—ç¬¦æœ‰ä¸¤ç§ä¸åŒçš„ç”¨é€”ï¼Œå–å†³äºå®ƒçš„æ“ä½œæ•°ç±»å‹ã€‚</p><p><strong>1. é€»è¾‘ä¸ï¼ˆå½“æ“ä½œæ•°ä¸º boolean ç±»å‹æ—¶ï¼‰</strong></p><p>å½“ <code>&amp;</code> çš„ä¸¤è¾¹æ˜¯å¸ƒå°”è¡¨è¾¾å¼æ—¶ï¼Œå®ƒæ‰§è¡Œ<strong>éçŸ­è·¯é€»è¾‘ä¸</strong>ã€‚è¿™æ„å‘³ç€æ— è®ºç¬¬ä¸€ä¸ªè¡¨è¾¾å¼çš„ç»“æœæ˜¯ <code>true</code> è¿˜æ˜¯ <code>false</code>ï¼Œå®ƒéƒ½ä¼š<strong>ç»§ç»­è®¡ç®—</strong>ç¬¬äºŒä¸ªè¡¨è¾¾å¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="literal">true</span> &amp; (++a &gt; <span class="number">10</span>)) &#123;</span><br><span class="line">    <span class="comment">// å³ä½¿ç¬¬ä¸€ä¸ªè¡¨è¾¾å¼æ˜¯ trueï¼Œç¬¬äºŒä¸ªè¡¨è¾¾å¼ (++a &gt; 10) ä¹Ÿä¼šè¢«æ‰§è¡Œã€‚</span></span><br><span class="line">    <span class="comment">// a çš„å€¼ä¼šå˜ä¸º 11ã€‚</span></span><br><span class="line">&#125;</span><br><span class="line">System.out.println(a); <span class="comment">// è¾“å‡º 11</span></span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ<code>++a</code> æ€»æ˜¯ä¼šè¢«æ‰§è¡Œï¼Œ<code>a</code> çš„å€¼æœ€ç»ˆä¼šå¢åŠ ã€‚</p><p><strong>2. æŒ‰ä½ä¸ï¼ˆå½“æ“ä½œæ•°ä¸ºæ•´æ•°ç±»å‹æ—¶ï¼‰</strong></p><p>å½“ <code>&amp;</code> çš„ä¸¤è¾¹æ˜¯æ•´æ•°ç±»å‹ï¼ˆå¦‚ <code>int</code>, <code>long</code> ç­‰ï¼‰æ—¶ï¼Œå®ƒæ‰§è¡Œ<strong>æŒ‰ä½ä¸è¿ç®—</strong>ã€‚å®ƒå°†ä¸¤ä¸ªæ•°çš„äºŒè¿›åˆ¶ä½è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœå¯¹åº”çš„ä½éƒ½æ˜¯ <code>1</code>ï¼Œåˆ™ç»“æœä½æ˜¯ <code>1</code>ï¼Œå¦åˆ™æ˜¯ <code>0</code>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">5</span>;  <span class="comment">// äºŒè¿›åˆ¶ 0101</span></span><br><span class="line"><span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> <span class="number">3</span>;  <span class="comment">// äºŒè¿›åˆ¶ 0011</span></span><br><span class="line"><span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> x &amp; y; <span class="comment">// äºŒè¿›åˆ¶ 0001</span></span><br><span class="line">System.out.println(result); <span class="comment">// è¾“å‡º 1</span></span><br></pre></td></tr></table></figure><h3 id="ï¼ˆçŸ­è·¯é€»è¾‘ä¸ï¼‰"><a href="#ï¼ˆçŸ­è·¯é€»è¾‘ä¸ï¼‰" class="headerlink" title="&amp;&amp;ï¼ˆçŸ­è·¯é€»è¾‘ä¸ï¼‰"></a><code>&amp;&amp;</code>ï¼ˆçŸ­è·¯é€»è¾‘ä¸ï¼‰</h3><p><code>&amp;&amp;</code> è¿ç®—ç¬¦åªç”¨äºå¸ƒå°”ç±»å‹çš„æ“ä½œï¼Œå®ƒæ‰§è¡Œ<strong>çŸ­è·¯é€»è¾‘ä¸</strong>ã€‚</p><p>**çŸ­è·¯ï¼ˆShort-circuitingï¼‰**æ˜¯ <code>&amp;&amp;</code> æœ€é‡è¦çš„ç‰¹æ€§ã€‚å¦‚æœç¬¬ä¸€ä¸ªè¡¨è¾¾å¼çš„ç»“æœæ˜¯ <code>false</code>ï¼Œé‚£ä¹ˆæ•´ä¸ªè¡¨è¾¾å¼çš„ç»“æœå¿…å®šæ˜¯ <code>false</code>ï¼Œå› æ­¤ <code>&amp;&amp;</code> ä¼šç«‹å³åœæ­¢è®¡ç®—ï¼Œ<strong>ä¸å†æ‰§è¡Œ</strong>ç¬¬äºŒä¸ªè¡¨è¾¾å¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="literal">false</span> &amp;&amp; (++a &gt; <span class="number">10</span>)) &#123;</span><br><span class="line">    <span class="comment">// ç¬¬ä¸€ä¸ªè¡¨è¾¾å¼æ˜¯ falseï¼Œæ•´ä¸ªæ¡ä»¶å·²ç¡®å®šä¸º falseã€‚</span></span><br><span class="line">    <span class="comment">// ç¬¬äºŒä¸ªè¡¨è¾¾å¼ (++a &gt; 10) ä¸ä¼šè¢«æ‰§è¡Œã€‚</span></span><br><span class="line">    <span class="comment">// a çš„å€¼ä¿æŒä¸å˜ã€‚</span></span><br><span class="line">&#125;</span><br><span class="line">System.out.println(a); <span class="comment">// è¾“å‡º 10</span></span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>++a</code> æ°¸è¿œä¸ä¼šè¢«æ‰§è¡Œï¼Œå› ä¸ºå®ƒä½äºçŸ­è·¯æ“ä½œçš„å³ä¾§ã€‚</p><hr><h3 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><table><thead><tr><th>ç‰¹æ€§</th><th><code>&amp;</code></th><th><code>&amp;&amp;</code></th></tr></thead><tbody><tr><td><strong>åŠŸèƒ½</strong></td><td>é€»è¾‘ä¸ã€æŒ‰ä½ä¸</td><td>ä»…ä¸ºé€»è¾‘ä¸</td></tr><tr><td><strong>çŸ­è·¯</strong></td><td>ä¸çŸ­è·¯</td><td>çŸ­è·¯</td></tr><tr><td><strong>è®¡ç®—</strong></td><td>å§‹ç»ˆè®¡ç®—ç¬¬äºŒä¸ªè¡¨è¾¾å¼</td><td>å½“ç¬¬ä¸€ä¸ªè¡¨è¾¾å¼ä¸º <code>false</code> æ—¶ï¼Œä¸è®¡ç®—ç¬¬äºŒä¸ªè¡¨è¾¾å¼</td></tr><tr><td><strong>é€‚ç”¨ç±»å‹</strong></td><td><code>boolean</code> å’Œæ•´æ•°ç±»å‹</td><td>ä»… <code>boolean</code></td></tr><tr><td><strong>æ€§èƒ½</strong></td><td>å¯èƒ½æ¯” <code>&amp;&amp;</code> æ…¢ï¼ˆå¦‚æœç¬¬ä¸€ä¸ªè¡¨è¾¾å¼ä¸º <code>false</code>ï¼‰</td><td>é€šå¸¸æ¯” <code>&amp;</code> å¿«ï¼ˆå½“ç¬¬ä¸€ä¸ªè¡¨è¾¾å¼ä¸º <code>false</code> æ—¶ï¼‰</td></tr></tbody></table><p>åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œ<strong>ä¼˜å…ˆä½¿ç”¨ &amp;&amp;</strong>ã€‚å› ä¸ºå®ƒèƒ½æé«˜ä»£ç æ•ˆç‡ï¼Œå¹¶åœ¨é¿å… <code>NullPointerException</code> ç­‰é—®é¢˜æ—¶éå¸¸æœ‰ç”¨ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨ &amp;&amp; é¿å…ç©ºæŒ‡é’ˆå¼‚å¸¸</span></span><br><span class="line"><span class="keyword">if</span> (list != <span class="literal">null</span> &amp;&amp; list.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœ list ä¸º nullï¼Œç¬¬äºŒä¸ªè¡¨è¾¾å¼ä¸ä¼šè¢«æ‰§è¡Œï¼Œç¨‹åºä¸ä¼šæŠ¥é”™ã€‚</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€Œ <code>&amp;</code> é€šå¸¸åªåœ¨éœ€è¦<strong>ä¸¤ä¸ªè¡¨è¾¾å¼éƒ½å¿…é¡»æ‰§è¡Œ</strong>çš„ç‰¹å®šåœºæ™¯ä¸‹ä½¿ç”¨ï¼Œæˆ–è€…ç”¨äºæŒ‰ä½è¿ç®—ã€‚</p><h2 id="å¼‚å¸¸"><a href="#å¼‚å¸¸" class="headerlink" title="å¼‚å¸¸"></a>å¼‚å¸¸</h2><p><img src="C:\Users\19501\Desktop\types-of-exceptions-in-java.png" alt="types-of-exceptions-in-java"></p><h3 id="Exception-å’Œ-Error-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#Exception-å’Œ-Error-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="Exception å’Œ Error æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a><a href="#exception-%E5%92%8C-error-%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB">Exception å’Œ Error æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</a></h3><p>åœ¨ Java ä¸­ï¼Œæ‰€æœ‰çš„å¼‚å¸¸éƒ½æœ‰ä¸€ä¸ªå…±åŒçš„ç¥–å…ˆ <code>java.lang</code> åŒ…ä¸­çš„ <code>Throwable</code> ç±»ã€‚<code>Throwable</code> ç±»æœ‰ä¸¤ä¸ªé‡è¦çš„å­ç±»:</p><ul><li><strong>Exception</strong> :ç¨‹åºæœ¬èº«å¯ä»¥å¤„ç†çš„å¼‚å¸¸ï¼Œå¯ä»¥é€šè¿‡ <code>catch</code> æ¥è¿›è¡Œæ•è·ã€‚<code>Exception</code> åˆå¯ä»¥åˆ†ä¸º Checked Exception (å—æ£€æŸ¥å¼‚å¸¸ï¼Œå¿…é¡»å¤„ç†) å’Œ Unchecked Exception (ä¸å—æ£€æŸ¥å¼‚å¸¸ï¼Œå¯ä»¥ä¸å¤„ç†)ã€‚</li><li><strong>Error</strong>ï¼š<code>Error</code> å±äºç¨‹åºæ— æ³•å¤„ç†çš„é”™è¯¯ ï¼Œæˆ‘ä»¬æ²¡åŠæ³•é€šè¿‡ <code>catch</code> æ¥è¿›è¡Œæ•è·ä¸å»ºè®®é€šè¿‡<code>catch</code>æ•è· ã€‚ä¾‹å¦‚ Java è™šæ‹Ÿæœºè¿è¡Œé”™è¯¯ï¼ˆ<code>Virtual MachineError</code>ï¼‰ã€è™šæ‹Ÿæœºå†…å­˜ä¸å¤Ÿé”™è¯¯(<code>OutOfMemoryError</code>)ã€ç±»å®šä¹‰é”™è¯¯ï¼ˆ<code>NoClassDefFoundError</code>ï¼‰ç­‰ ã€‚è¿™äº›å¼‚å¸¸å‘ç”Ÿæ—¶ï¼ŒJava è™šæ‹Ÿæœºï¼ˆJVMï¼‰ä¸€èˆ¬ä¼šé€‰æ‹©çº¿ç¨‹ç»ˆæ­¢ã€‚</li></ul><h3 id="â­ï¸Checked-Exception-å’Œ-Unchecked-Exception-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#â­ï¸Checked-Exception-å’Œ-Unchecked-Exception-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="â­ï¸Checked Exception å’Œ Unchecked Exception æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a><a href="#%E2%AD%90%EF%B8%8Fchecked-exception-%E5%92%8C-unchecked-exception-%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB">â­ï¸Checked Exception å’Œ Unchecked Exception æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</a></h3><p><strong>Checked Exception</strong>Â å³ å—æ£€æŸ¥å¼‚å¸¸ ï¼ŒJava ä»£ç åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå—æ£€æŸ¥å¼‚å¸¸æ²¡æœ‰è¢«Â <code>catch</code>æˆ–è€…<code>throws</code>Â å…³é”®å­—å¤„ç†çš„è¯ï¼Œå°±æ²¡åŠæ³•é€šè¿‡ç¼–è¯‘ã€‚ </p><p>é™¤äº†<code>RuntimeException</code>åŠå…¶å­ç±»ä»¥å¤–ï¼Œå…¶ä»–çš„<code>Exception</code>ç±»åŠå…¶å­ç±»éƒ½å±äºå—æ£€æŸ¥å¼‚å¸¸ ã€‚å¸¸è§çš„å—æ£€æŸ¥å¼‚å¸¸æœ‰ï¼šIO ç›¸å…³çš„å¼‚å¸¸ã€<code>ClassNotFoundException</code>ã€<code>SQLException</code>â€¦ã€‚</p><p><strong>Unchecked Exception</strong> å³ <strong>ä¸å—æ£€æŸ¥å¼‚å¸¸</strong> ï¼ŒJava ä»£ç åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ ï¼Œæˆ‘ä»¬å³ä½¿ä¸å¤„ç†ä¸å—æ£€æŸ¥å¼‚å¸¸ä¹Ÿå¯ä»¥æ­£å¸¸é€šè¿‡ç¼–è¯‘ã€‚</p><p><code>RuntimeException</code> åŠå…¶å­ç±»éƒ½ç»Ÿç§°ä¸ºéå—æ£€æŸ¥å¼‚å¸¸ï¼Œå¸¸è§çš„æœ‰ï¼ˆå»ºè®®è®°ä¸‹æ¥ï¼Œæ—¥å¸¸å¼€å‘ä¸­ä¼šç»å¸¸ç”¨åˆ°ï¼‰ï¼š</p><ul><li><code>NullPointerException</code>(ç©ºæŒ‡é’ˆé”™è¯¯)</li><li><code>IllegalArgumentException</code>(å‚æ•°é”™è¯¯æ¯”å¦‚æ–¹æ³•å…¥å‚ç±»å‹é”™è¯¯)</li><li><code>NumberFormatException</code>ï¼ˆå­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—æ ¼å¼é”™è¯¯ï¼Œ<code>IllegalArgumentException</code>çš„å­ç±»ï¼‰</li><li><code>ArrayIndexOutOfBoundsException</code>ï¼ˆæ•°ç»„è¶Šç•Œé”™è¯¯ï¼‰</li><li><code>ClassCastException</code>ï¼ˆç±»å‹è½¬æ¢é”™è¯¯ï¼‰</li><li><code>ArithmeticException</code>ï¼ˆç®—æœ¯é”™è¯¯ï¼‰</li><li><code>SecurityException</code> ï¼ˆå®‰å…¨é”™è¯¯æ¯”å¦‚æƒé™ä¸å¤Ÿï¼‰</li><li><code>UnsupportedOperationException</code>(ä¸æ”¯æŒçš„æ“ä½œé”™è¯¯æ¯”å¦‚é‡å¤åˆ›å»ºåŒä¸€ç”¨æˆ·)</li><li>â€¦â€¦</li></ul><hr><h3 id="Throwable-ç±»å¸¸ç”¨æ–¹æ³•æœ‰å“ªäº›ï¼Ÿ"><a href="#Throwable-ç±»å¸¸ç”¨æ–¹æ³•æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="Throwable ç±»å¸¸ç”¨æ–¹æ³•æœ‰å“ªäº›ï¼Ÿ"></a><a href="#throwable-%E7%B1%BB%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95%E6%9C%89%E5%93%AA%E4%BA%9B">Throwable ç±»å¸¸ç”¨æ–¹æ³•æœ‰å“ªäº›ï¼Ÿ</a></h3><ul><li><code>String getMessage()</code>: è¿”å›å¼‚å¸¸å‘ç”Ÿæ—¶çš„è¯¦ç»†ä¿¡æ¯</li><li><code>String toString()</code>: è¿”å›å¼‚å¸¸å‘ç”Ÿæ—¶çš„ç®€è¦æè¿°</li><li><code>String getLocalizedMessage()</code>: è¿”å›å¼‚å¸¸å¯¹è±¡çš„æœ¬åœ°åŒ–ä¿¡æ¯ã€‚ä½¿ç”¨ <code>Throwable</code> çš„å­ç±»è¦†ç›–è¿™ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”Ÿæˆæœ¬åœ°åŒ–ä¿¡æ¯ã€‚å¦‚æœå­ç±»æ²¡æœ‰è¦†ç›–è¯¥æ–¹æ³•ï¼Œåˆ™è¯¥æ–¹æ³•è¿”å›çš„ä¿¡æ¯ä¸ <code>getMessage()</code>è¿”å›çš„ç»“æœç›¸åŒ</li><li><code>void printStackTrace()</code>: åœ¨æ§åˆ¶å°ä¸Šæ‰“å° <code>Throwable</code> å¯¹è±¡å°è£…çš„å¼‚å¸¸ä¿¡æ¯</li></ul><h3 id="try-catch-finally-å¦‚ä½•ä½¿ç”¨ï¼Ÿ"><a href="#try-catch-finally-å¦‚ä½•ä½¿ç”¨ï¼Ÿ" class="headerlink" title="try-catch-finally å¦‚ä½•ä½¿ç”¨ï¼Ÿ"></a><a href="#try-catch-finally-%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8">try-catch-finally å¦‚ä½•ä½¿ç”¨ï¼Ÿ</a></h3><hr><p><code>try</code>å—ï¼šç”¨äºæ•è·å¼‚å¸¸ã€‚å…¶åå¯æ¥é›¶ä¸ªæˆ–å¤šä¸ª <code>catch</code> å—ï¼Œå¦‚æœæ²¡æœ‰ <code>catch</code> å—ï¼Œåˆ™å¿…é¡»è·Ÿä¸€ä¸ª <code>finally</code> å—ã€‚</p><p><code>catch</code>å—ï¼šç”¨äºå¤„ç† try æ•è·åˆ°çš„å¼‚å¸¸ã€‚</p><p><code>finally</code> å—ï¼šæ— è®ºæ˜¯å¦æ•è·æˆ–å¤„ç†å¼‚å¸¸ï¼Œ<code>finally</code> å—é‡Œçš„è¯­å¥éƒ½ä¼šè¢«æ‰§è¡Œã€‚å½“åœ¨ <code>try</code> å—æˆ– <code>catch</code> å—ä¸­é‡åˆ° <code>return</code> è¯­å¥æ—¶ï¼Œ<code>finally</code> è¯­å¥å—å°†åœ¨æ–¹æ³•è¿”å›ä¹‹å‰è¢«æ‰§è¡Œã€‚</p><h3 id="5-Error-å’Œ-Exception-çš„åŒºåˆ«ï¼Ÿ"><a href="#5-Error-å’Œ-Exception-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="5. Error å’Œ Exception çš„åŒºåˆ«ï¼Ÿ"></a>5. Error å’Œ Exception çš„åŒºåˆ«ï¼Ÿ</h3><p>Error ç±»å’Œ Exception ç±»çš„çˆ¶ç±»éƒ½æ˜¯ Throwable ç±»ã€‚ä¸»è¦åŒºåˆ«å¦‚ä¸‹ï¼š</p><ul><li><strong>Error ç±»</strong>ï¼šä¸€èˆ¬æ˜¯æŒ‡ä¸è™šæ‹Ÿæœºç›¸å…³çš„é—®é¢˜ï¼Œå¦‚ï¼šç³»ç»Ÿå´©æºƒã€è™šæ‹Ÿæœºé”™è¯¯ã€å†…å­˜ç©ºé—´ä¸è¶³ã€æ–¹æ³•è°ƒç”¨æ ˆæº¢å‡ºç­‰ã€‚è¿™ç±»é”™è¯¯å°†ä¼šå¯¼è‡´åº”ç”¨ç¨‹åºä¸­æ–­ï¼Œä»…é ç¨‹åºæœ¬èº«æ— æ³•æ¢å¤å’Œé¢„é˜²ï¼›</li><li><strong>Exception ç±»</strong>ï¼šåˆ†ä¸ºè¿è¡Œæ—¶å¼‚å¸¸å’Œå—æ£€æŸ¥çš„å¼‚å¸¸ã€‚</li></ul><hr><h3 id="6-è¿è¡Œæ—¶å¼‚å¸¸ä¸å—æ£€å¼‚å¸¸æœ‰ä½•å¼‚åŒï¼Ÿ"><a href="#6-è¿è¡Œæ—¶å¼‚å¸¸ä¸å—æ£€å¼‚å¸¸æœ‰ä½•å¼‚åŒï¼Ÿ" class="headerlink" title="6. è¿è¡Œæ—¶å¼‚å¸¸ä¸å—æ£€å¼‚å¸¸æœ‰ä½•å¼‚åŒï¼Ÿ"></a>6. è¿è¡Œæ—¶å¼‚å¸¸ä¸å—æ£€å¼‚å¸¸æœ‰ä½•å¼‚åŒï¼Ÿ</h3><ul><li><strong>è¿è¡Œæ—¶å¼‚å¸¸</strong>ï¼šå¦‚ï¼šç©ºæŒ‡é’ˆå¼‚å¸¸ã€æŒ‡å®šçš„ç±»æ‰¾ä¸åˆ°ã€æ•°ç»„è¶Šç•Œã€æ–¹æ³•ä¼ é€’å‚æ•°é”™è¯¯ã€æ•°æ®ç±»å‹è½¬æ¢é”™è¯¯ã€‚å¯ä»¥ç¼–è¯‘é€šè¿‡ï¼Œä½†æ˜¯ä¸€è¿è¡Œå°±åœæ­¢äº†ï¼Œç¨‹åºä¸ä¼šè‡ªå·±å¤„ç†ï¼›</li><li><strong>å—æ£€æŸ¥å¼‚å¸¸</strong>ï¼šè¦ä¹ˆç”¨ <code>try ... catch...</code> æ•è·ï¼Œè¦ä¹ˆç”¨ <code>throws</code> å£°æ˜æŠ›å‡ºï¼Œäº¤ç»™çˆ¶ç±»å¤„ç†ã€‚</li></ul><hr><h3 id="7-throw-å’Œ-throws-çš„åŒºåˆ«ï¼Ÿ"><a href="#7-throw-å’Œ-throws-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="7. throw å’Œ throws çš„åŒºåˆ«ï¼Ÿ"></a>7. throw å’Œ throws çš„åŒºåˆ«ï¼Ÿ</h3><ul><li><strong>throw</strong>ï¼šåœ¨æ–¹æ³•ä½“å†…éƒ¨ï¼Œè¡¨ç¤ºæŠ›å‡ºå¼‚å¸¸ï¼Œç”±æ–¹æ³•ä½“å†…éƒ¨çš„è¯­å¥å¤„ç†ï¼›<code>throw</code> æ˜¯å…·ä½“å‘å¤–æŠ›å‡ºå¼‚å¸¸çš„åŠ¨ä½œï¼Œæ‰€ä»¥å®ƒæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸å®ä¾‹ï¼›</li><li><strong>throws</strong>ï¼šåœ¨æ–¹æ³•å£°æ˜åé¢ï¼Œè¡¨ç¤ºå¦‚æœæŠ›å‡ºå¼‚å¸¸ï¼Œç”±è¯¥æ–¹æ³•çš„è°ƒç”¨è€…æ¥å¤„ç†ï¼›è¡¨ç¤ºå‡ºç°å¼‚å¸¸çš„å¯èƒ½æ€§ï¼Œå¹¶ä¸ä¸€å®šä¼šå‘ç”Ÿè¿™ç§å¼‚å¸¸ã€‚</li></ul><hr><h3 id="8-å¸¸è§çš„å¼‚å¸¸ç±»æœ‰å“ªäº›ï¼Ÿ"><a href="#8-å¸¸è§çš„å¼‚å¸¸ç±»æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="8. å¸¸è§çš„å¼‚å¸¸ç±»æœ‰å“ªäº›ï¼Ÿ"></a>8. å¸¸è§çš„å¼‚å¸¸ç±»æœ‰å“ªäº›ï¼Ÿ</h3><ul><li><strong>NullPointerException</strong>ï¼šå½“åº”ç”¨ç¨‹åºè¯•å›¾è®¿é—®ç©ºå¯¹è±¡æ—¶ï¼Œåˆ™æŠ›å‡ºè¯¥å¼‚å¸¸ã€‚</li><li><strong>SQLException</strong>ï¼šæä¾›å…³äºæ•°æ®åº“è®¿é—®é”™è¯¯æˆ–å…¶ä»–é”™è¯¯ä¿¡æ¯çš„å¼‚å¸¸ã€‚</li><li><strong>IndexOutOfBoundsException</strong>ï¼šæŒ‡ç¤ºæŸæ’åºç´¢å¼•ï¼ˆä¾‹å¦‚å¯¹æ•°ç»„ã€å­—ç¬¦ä¸²æˆ–å‘é‡çš„æ’åºï¼‰è¶…å‡ºèŒƒå›´æ—¶æŠ›å‡ºã€‚</li><li><strong>FileNotFoundException</strong>ï¼šå½“è¯•å›¾æ‰“å¼€æŒ‡å®šè·¯å¾„åè¡¨ç¤ºçš„æ–‡ä»¶å¤±è´¥æ—¶ï¼ŒæŠ›å‡ºæ­¤å¼‚å¸¸ã€‚</li><li><strong>IOException</strong>ï¼šå½“å‘ç”ŸæŸç§ I&#x2F;O å¼‚å¸¸æ—¶ï¼ŒæŠ›å‡ºæ­¤å¼‚å¸¸ã€‚æ­¤ç±»æ˜¯å¤±è´¥æˆ–ä¸­æ–­çš„ I&#x2F;O æ“ä½œç”Ÿæˆçš„å¼‚å¸¸çš„é€šç”¨ç±»ã€‚</li><li><strong>ClassCastException</strong>ï¼šå½“è¯•å›¾å°†å¯¹è±¡å¼ºåˆ¶è½¬æ¢ä¸ºä¸æ˜¯å®ä¾‹çš„å­ç±»æ—¶ï¼ŒæŠ›å‡ºè¯¥å¼‚å¸¸ã€‚</li><li><strong>IllegalArgumentException</strong>ï¼šæŠ›å‡ºçš„å¼‚å¸¸è¡¨æ˜å‘æ–¹æ³•ä¼ é€’äº†ä¸€ä¸ªä¸åˆæ³•æˆ–ä¸æ­£ç¡®çš„å‚æ•°ã€‚</li></ul><hr><h3 id="9-ä¸»çº¿ç¨‹å¯ä»¥æ•è·åˆ°å­çº¿ç¨‹çš„å¼‚å¸¸å—ï¼Ÿ"><a href="#9-ä¸»çº¿ç¨‹å¯ä»¥æ•è·åˆ°å­çº¿ç¨‹çš„å¼‚å¸¸å—ï¼Ÿ" class="headerlink" title="9. ä¸»çº¿ç¨‹å¯ä»¥æ•è·åˆ°å­çº¿ç¨‹çš„å¼‚å¸¸å—ï¼Ÿ"></a>9. ä¸»çº¿ç¨‹å¯ä»¥æ•è·åˆ°å­çº¿ç¨‹çš„å¼‚å¸¸å—ï¼Ÿ</h3><p>çº¿ç¨‹è®¾è®¡çš„ç†å¿µï¼šâ€œçº¿ç¨‹çš„é—®é¢˜åº”è¯¥çº¿ç¨‹å®ƒè‡ªå·±æœ¬èº«æ¥è§£å†³ï¼Œè€Œä¸è¦å§”æ‰˜åˆ°å¤–éƒ¨â€ã€‚</p><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœä¸åšç‰¹æ®Šçš„å¤„ç†ï¼Œåœ¨ä¸»çº¿ç¨‹ä¸­æ˜¯ä¸èƒ½å¤Ÿæ•è·åˆ°å­çº¿ç¨‹ä¸­çš„å¼‚å¸¸çš„ã€‚å¦‚æœæƒ³è¦åœ¨ä¸»çº¿ç¨‹ä¸­æ•è·å­çº¿ç¨‹çš„å¼‚å¸¸ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å¦‚ä¸‹çš„æ–¹å¼è¿›è¡Œå¤„ç†ï¼Œä½¿ç”¨ <code>Thread</code> çš„é™æ€æ–¹æ³• <code>Thread.setDefaultUncaughtExceptionHandler(new MyUncaughtExceptionHandle());</code>é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸»çº¿ç¨‹<strong>ä¸èƒ½ç›´æ¥</strong>æ•è·åˆ°å­çº¿ç¨‹ä¸­æŠ›å‡ºçš„å¼‚å¸¸ã€‚è¿™æ˜¯å› ä¸ºçº¿ç¨‹æ˜¯ç‹¬ç«‹çš„æ‰§è¡Œæµï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„è°ƒç”¨æ ˆã€‚å½“å­çº¿ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œå¦‚æœè¯¥å¼‚å¸¸æ²¡æœ‰è¢«å­çº¿ç¨‹å†…éƒ¨çš„ <code>try-catch</code> å—æ•è·ï¼Œå®ƒä¼šæ²¿ç€å­çº¿ç¨‹çš„è°ƒç”¨æ ˆå‘ä¸Šå†’æ³¡ï¼Œæœ€ç»ˆå¯¼è‡´å­çº¿ç¨‹ç»ˆæ­¢ã€‚è¿™ä¸ªå¼‚å¸¸ä¸ä¼šä¼ é€’åˆ°ä¸»çº¿ç¨‹çš„è°ƒç”¨æ ˆä¸­ï¼Œå› æ­¤ä¸»çº¿ç¨‹æ— æ³•æ„ŸçŸ¥æˆ–æ•è·å®ƒã€‚</p><p>è¿™ä¸ªè®¾è®¡ç†å¿µè¢«ç§°ä¸ºâ€œçº¿ç¨‹çš„é—®é¢˜åº”è¯¥ç”±çº¿ç¨‹è‡ªå·±æœ¬èº«æ¥è§£å†³ï¼Œè€Œä¸æ˜¯å§”æ‰˜åˆ°å¤–éƒ¨â€ã€‚</p><hr><h3 id="æ•è·å­çº¿ç¨‹å¼‚å¸¸çš„æ–¹æ³•"><a href="#æ•è·å­çº¿ç¨‹å¼‚å¸¸çš„æ–¹æ³•" class="headerlink" title="æ•è·å­çº¿ç¨‹å¼‚å¸¸çš„æ–¹æ³•"></a>æ•è·å­çº¿ç¨‹å¼‚å¸¸çš„æ–¹æ³•</h3><p>è™½ç„¶ä¸»çº¿ç¨‹æ— æ³•ç›´æ¥æ•è·å­çº¿ç¨‹å¼‚å¸¸ï¼Œä½† Java æä¾›äº†ä¸¤ç§æœºåˆ¶æ¥å¤„ç†è¿™ç§æƒ…å†µï¼Œå…è®¸ä½ åœ¨ä¸»çº¿ç¨‹æˆ–å…¶ä»–çº¿ç¨‹ä¸­å¯¹å­çº¿ç¨‹çš„å¼‚å¸¸è¿›è¡Œå¤„ç†ï¼š</p><h4 id="1-ä½¿ç”¨-try-catch-åœ¨å­çº¿ç¨‹å†…éƒ¨å¤„ç†"><a href="#1-ä½¿ç”¨-try-catch-åœ¨å­çº¿ç¨‹å†…éƒ¨å¤„ç†" class="headerlink" title="1. ä½¿ç”¨ try-catch åœ¨å­çº¿ç¨‹å†…éƒ¨å¤„ç†"></a>1. ä½¿ç”¨ <code>try-catch</code> åœ¨å­çº¿ç¨‹å†…éƒ¨å¤„ç†</h4><p>è¿™æ˜¯æœ€ç›´æ¥ä¹Ÿæœ€æ¨èçš„æ–¹å¼ã€‚åœ¨å­çº¿ç¨‹çš„ <code>run()</code> æ–¹æ³•ä¸­ï¼Œç”¨ <code>try-catch</code> å—å°†å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„ä»£ç åŒ…å›´èµ·æ¥ã€‚è¿™æ ·ï¼Œå¼‚å¸¸å°±ä¼šåœ¨å­çº¿ç¨‹å†…éƒ¨è¢«æ•è·å¹¶å¤„ç†ï¼Œä½ å¯ä»¥é€‰æ‹©è®°å½•æ—¥å¿—ã€å‘é€é€šçŸ¥ï¼Œæˆ–è€…æ‰§è¡Œå…¶ä»–æ¢å¤æ“ä½œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyRunnable</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// å¯èƒ½ä¼šæŠ›å‡ºå¼‚å¸¸çš„ä»£ç </span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Exception from child thread&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// åœ¨å­çº¿ç¨‹ä¸­æ•è·å¹¶å¤„ç†å¼‚å¸¸</span></span><br><span class="line">            System.err.println(<span class="string">&quot;å­çº¿ç¨‹æ•è·åˆ°å¼‚å¸¸: &quot;</span> + e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">MyRunnable</span>());</span><br><span class="line">        thread.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-è®¾ç½®æœªæ•è·å¼‚å¸¸å¤„ç†å™¨-UncaughtExceptionHandler"><a href="#2-è®¾ç½®æœªæ•è·å¼‚å¸¸å¤„ç†å™¨-UncaughtExceptionHandler" class="headerlink" title="2. è®¾ç½®æœªæ•è·å¼‚å¸¸å¤„ç†å™¨ (UncaughtExceptionHandler)"></a>2. è®¾ç½®æœªæ•è·å¼‚å¸¸å¤„ç†å™¨ (<code>UncaughtExceptionHandler</code>)</h4><p>å½“ä½ æ— æ³•åœ¨å­çº¿ç¨‹å†…éƒ¨å¤„ç†æ‰€æœ‰å¼‚å¸¸æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ <code>UncaughtExceptionHandler</code>ã€‚è¿™æ˜¯ä¸€ä¸ªåœ¨çº¿ç¨‹å› æœªæ•è·å¼‚å¸¸è€Œçªç„¶ç»ˆæ­¢æ—¶è¢«è°ƒç”¨çš„å›è°ƒæ¥å£ã€‚ä½ å¯ä»¥ä¸ºæ¯ä¸ªçº¿ç¨‹æˆ–æ‰€æœ‰çº¿ç¨‹è®¾ç½®ä¸€ä¸ªé»˜è®¤çš„å¤„ç†å™¨ã€‚</p><p><strong>A. ä¸ºå•ä¸ªçº¿ç¨‹è®¾ç½®å¤„ç†å™¨</strong></p><p>ä½ å¯ä»¥ä¸ºç‰¹å®šçš„ <code>Thread</code> å®ä¾‹è®¾ç½®ä¸€ä¸ª <code>UncaughtExceptionHandler</code>ã€‚å½“è¯¥çº¿ç¨‹å‘ç”Ÿæœªæ•è·å¼‚å¸¸æ—¶ï¼ŒJVM ä¼šè°ƒç”¨ä½ æä¾›çš„å¤„ç†å™¨çš„ <code>uncaughtException()</code> æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Exception from child thread!&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">thread.setUncaughtExceptionHandler(<span class="keyword">new</span> <span class="title class_">Thread</span>.UncaughtExceptionHandler() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">uncaughtException</span><span class="params">(Thread t, Throwable e)</span> &#123;</span><br><span class="line">        System.err.println(<span class="string">&quot;åœ¨ä¸»çº¿ç¨‹ä¸­æ•è·åˆ°å­çº¿ç¨‹ [&quot;</span> + t.getName() + <span class="string">&quot;] çš„å¼‚å¸¸: &quot;</span> + e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">thread.start();</span><br></pre></td></tr></table></figure><p><strong>B. ä¸ºæ‰€æœ‰çº¿ç¨‹è®¾ç½®é»˜è®¤å¤„ç†å™¨</strong></p><p>å¦‚æœä½ æƒ³ä¸ºæ‰€æœ‰çº¿ç¨‹ï¼ˆåŒ…æ‹¬çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ï¼‰è®¾ç½®ä¸€ä¸ªé€šç”¨çš„å¼‚å¸¸å¤„ç†é€»è¾‘ï¼Œå¯ä»¥ä½¿ç”¨ <code>Thread.setDefaultUncaughtExceptionHandler()</code>ã€‚è¿™ä¸ªå¤„ç†å™¨ä¼šåœ¨æ²¡æœ‰ä»»ä½•ç‰¹å®šå¤„ç†å™¨çš„çº¿ç¨‹ä¸Šè¢«è°ƒç”¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨ä¸»çº¿ç¨‹ä¸­è®¾ç½®å…¨å±€é»˜è®¤å¤„ç†å™¨</span></span><br><span class="line">Thread.setDefaultUncaughtExceptionHandler(<span class="keyword">new</span> <span class="title class_">Thread</span>.UncaughtExceptionHandler() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">uncaughtException</span><span class="params">(Thread t, Throwable e)</span> &#123;</span><br><span class="line">        System.err.println(<span class="string">&quot;å…¨å±€å¤„ç†å™¨æ•è·åˆ°çº¿ç¨‹ [&quot;</span> + t.getName() + <span class="string">&quot;] çš„å¼‚å¸¸: &quot;</span> + e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å­çº¿ç¨‹ä¸­æŠ›å‡ºæœªå¤„ç†çš„å¼‚å¸¸</span></span><br><span class="line"><span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Global uncaught exception&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">thread.start();</span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“-2"><a href="#æ€»ç»“-2" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ul><li><strong>ä¸»çº¿ç¨‹</strong>ä¸èƒ½ç›´æ¥æ•è·<strong>å­çº¿ç¨‹</strong>çš„å¼‚å¸¸ï¼Œå› ä¸ºå®ƒä»¬æ˜¯ç‹¬ç«‹çš„æ‰§è¡Œæµã€‚</li><li>è¦å¤„ç†å­çº¿ç¨‹çš„å¼‚å¸¸ï¼Œæœ€ç®€å•çš„æ–¹æ³•æ˜¯<strong>åœ¨å­çº¿ç¨‹å†…éƒ¨ä½¿ç”¨ try-catch å—</strong>ã€‚</li><li>å¦‚æœéœ€è¦åœ¨ä¸»çº¿ç¨‹ä¸­æ„ŸçŸ¥å’Œå¤„ç†å­çº¿ç¨‹çš„å¼‚å¸¸ï¼Œå¯ä»¥ä½¿ç”¨ <code>Thread</code> æä¾›çš„**<code>UncaughtExceptionHandler</code>**æœºåˆ¶ã€‚ä½ å¯ä»¥ä¸ºç‰¹å®šçº¿ç¨‹æˆ–æ‰€æœ‰çº¿ç¨‹è®¾ç½®ä¸€ä¸ªå¤„ç†å™¨ï¼Œå½“çº¿ç¨‹å› æœªæ•è·å¼‚å¸¸è€Œç»ˆæ­¢æ—¶ï¼Œè¿™ä¸ªå¤„ç†å™¨ä¼šè¢«è°ƒç”¨ã€‚</li></ul><hr><h2 id="åˆ›å»ºå¯¹è±¡ï¼š"><a href="#åˆ›å»ºå¯¹è±¡ï¼š" class="headerlink" title="åˆ›å»ºå¯¹è±¡ï¼š"></a>åˆ›å»ºå¯¹è±¡ï¼š</h2><p>å¥½çš„ï¼ŒJava ä¸­åˆ›å»ºå¯¹è±¡çš„æ–¹å¼æœ‰å¤šç§ï¼Œé™¤äº†æœ€å¸¸è§çš„ <code>new</code> å…³é”®å­—ï¼Œè¿˜æœ‰å…¶ä»–å‡ ç§é‡è¦çš„æŠ€æœ¯ã€‚ä¸‹é¢æˆ‘ä»¬æ¥è¯¦ç»†è§£æè¿™å››ç§åˆ›å»ºå¯¹è±¡çš„æ–¹æ³•ã€‚</p><hr><h3 id="1-ä½¿ç”¨-new-å…³é”®å­—"><a href="#1-ä½¿ç”¨-new-å…³é”®å­—" class="headerlink" title="1. ä½¿ç”¨ new å…³é”®å­—"></a>1. ä½¿ç”¨ <code>new</code> å…³é”®å­—</h3><p>è¿™æ˜¯æœ€å¸¸è§ã€æœ€ç›´æ¥çš„åˆ›å»ºå¯¹è±¡æ–¹å¼ã€‚å½“ä½ ä½¿ç”¨ <code>new</code> å…³é”®å­—æ—¶ï¼Œå®ƒä¼šè°ƒç”¨ç±»çš„<strong>æ„é€ å™¨</strong>æ¥åˆå§‹åŒ–å¯¹è±¡ã€‚</p><p><strong>åŸç†ï¼š</strong></p><ol><li><strong>åˆ†é…å†…å­˜ï¼š</strong> JVM åœ¨å †ï¼ˆHeapï¼‰ä¸Šä¸ºæ–°å¯¹è±¡åˆ†é…æ‰€éœ€çš„å†…å­˜ç©ºé—´ã€‚</li><li><strong>é»˜è®¤åˆå§‹åŒ–ï¼š</strong> æˆå‘˜å˜é‡ä¼šè¢«èµ‹äºˆé»˜è®¤å€¼ï¼ˆä¾‹å¦‚ï¼Œ<code>int</code> ä¸º <code>0</code>ï¼Œ<code>boolean</code> ä¸º <code>false</code>ï¼Œå¼•ç”¨ç±»å‹ä¸º <code>null</code>ï¼‰ã€‚</li><li><strong>è°ƒç”¨æ„é€ å™¨ï¼š</strong> JVM è°ƒç”¨æŒ‡å®šçš„æ„é€ å™¨æ¥æ‰§è¡Œåˆå§‹åŒ–ä»£ç ã€‚æ„é€ å™¨ä¸­çš„ä»£ç ä¼šè¦†ç›–ä¹‹å‰çš„é»˜è®¤å€¼ã€‚</li><li><strong>è¿”å›å¼•ç”¨ï¼š</strong> å¯¹è±¡åˆ›å»ºå®Œæˆåï¼Œ<code>new</code> è¡¨è¾¾å¼ä¼šè¿”å›è¯¥å¯¹è±¡åœ¨å†…å­˜ä¸­çš„å¼•ç”¨ã€‚</li></ol><p><strong>ä¼˜ç‚¹ï¼š</strong></p><ul><li>ç®€å•ç›´è§‚ï¼Œä»£ç å¯è¯»æ€§å¥½ã€‚</li><li>å¯ä»¥è°ƒç”¨ä»»ä½•å¯è®¿é—®çš„æ„é€ å™¨ï¼ˆåŒ…æ‹¬æœ‰å‚å’Œæ— å‚ï¼‰ã€‚</li></ul><p><strong>ç¼ºç‚¹ï¼š</strong></p><ul><li>æ¯æ¬¡è°ƒç”¨ <code>new</code> éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œå¼€é”€è¾ƒå¤§ã€‚</li></ul><p><strong>ç¤ºä¾‹ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨ new å…³é”®å­—åˆ›å»ºå¯¹è±¡</span></span><br><span class="line"><span class="type">MyObject</span> <span class="variable">obj1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyObject</span>();</span><br><span class="line"><span class="type">MyObject</span> <span class="variable">obj2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyObject</span>(<span class="string">&quot;hello&quot;</span>);</span><br></pre></td></tr></table></figure><hr><h3 id="2-ä½¿ç”¨-Class-ç±»çš„-newInstance-æ–¹æ³•ï¼ˆåå°„ï¼‰"><a href="#2-ä½¿ç”¨-Class-ç±»çš„-newInstance-æ–¹æ³•ï¼ˆåå°„ï¼‰" class="headerlink" title="2. ä½¿ç”¨ Class ç±»çš„ newInstance() æ–¹æ³•ï¼ˆåå°„ï¼‰"></a>2. ä½¿ç”¨ <code>Class</code> ç±»çš„ <code>newInstance()</code> æ–¹æ³•ï¼ˆåå°„ï¼‰</h3><p><code>Class.forName().newInstance()</code> æ˜¯é€šè¿‡<strong>åå°„</strong>æ¥åˆ›å»ºå¯¹è±¡çš„æ–¹å¼ã€‚</p><p><strong>åŸç†ï¼š</strong></p><ol><li><strong>åŠ è½½ç±»ï¼š</strong> <code>Class.forName()</code> æ–¹æ³•æ ¹æ®ç±»çš„å…¨é™å®šåï¼ˆå¦‚ <code>&quot;com.example.MyObject&quot;</code>ï¼‰åŠ è½½ç±»ï¼Œå¹¶è¿”å›å¯¹åº”çš„ <code>Class</code> å¯¹è±¡ã€‚</li><li><strong>åˆ›å»ºå®ä¾‹ï¼š</strong> <code>newInstance()</code> æ–¹æ³•ä¼šè°ƒç”¨è¯¥ç±»çš„<strong>æ— å‚æ„é€ å™¨</strong>æ¥åˆ›å»ºå¯¹è±¡ã€‚</li></ol><p><strong>æ³¨æ„ï¼š</strong></p><ul><li><code>newInstance()</code> è¦æ±‚ç±»å¿…é¡»æœ‰ä¸€ä¸ªæ— å‚çš„æ„é€ å™¨ï¼Œä¸”è¯¥æ„é€ å™¨å¿…é¡»æ˜¯å¯è§çš„ï¼ˆ<code>public</code>ï¼‰ã€‚</li><li>Java 9 ä¹‹åï¼Œ<code>Class.newInstance()</code> è¢«æ ‡è®°ä¸º<strong>è¿‡æ—¶ï¼ˆdeprecatedï¼‰</strong>ã€‚</li><li>åœ¨ç°ä»£ Java ä¸­ï¼Œæ›´æ¨èä½¿ç”¨ <code>Constructor</code> ç±»çš„ <code>newInstance()</code> æ–¹æ³•ï¼Œå› ä¸ºå®ƒèƒ½å¤Ÿè°ƒç”¨<strong>æœ‰å‚</strong>æ„é€ å™¨ï¼Œå¹¶ä¸”å¯ä»¥å¤„ç†æ„é€ å™¨æŠ›å‡ºçš„å¼‚å¸¸ã€‚</li></ul><p><strong>ä¼˜ç‚¹ï¼š</strong></p><ul><li>å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°åˆ›å»ºå¯¹è±¡ï¼Œéå¸¸çµæ´»ã€‚</li><li>é€‚ç”¨äºå·¥å‚æ¨¡å¼ã€ä¾èµ–æ³¨å…¥ï¼ˆå¦‚ Springï¼‰ç­‰åœºæ™¯ã€‚</li></ul><p><strong>ç¼ºç‚¹ï¼š</strong></p><ul><li>æ€§èƒ½æ¯” <code>new</code> å…³é”®å­—å·®ï¼Œå› ä¸ºæ¶‰åŠåå°„æœºåˆ¶ã€‚</li><li>å¦‚æœç±»æ²¡æœ‰æ— å‚æ„é€ å™¨æˆ–æ„é€ å™¨ä¸å¯è®¿é—®ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</li><li>æ²¡æœ‰ç¼–è¯‘æ—¶æ£€æŸ¥ï¼Œé”™è¯¯åªèƒ½åœ¨è¿è¡Œæ—¶å‘ç°ã€‚</li></ul><p><strong>ç¤ºä¾‹ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨ Class.forName().newInstance() åˆ›å»ºå¯¹è±¡</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    Class&lt;?&gt; clazz = Class.forName(<span class="string">&quot;com.example.MyObject&quot;</span>);</span><br><span class="line">    <span class="type">MyObject</span> <span class="variable">obj</span> <span class="operator">=</span> (MyObject) clazz.newInstance();</span><br><span class="line">&#125; <span class="keyword">catch</span> (InstantiationException | IllegalAccessException | ClassNotFoundException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="3-ä½¿ç”¨-clone-æ–¹æ³•"><a href="#3-ä½¿ç”¨-clone-æ–¹æ³•" class="headerlink" title="3. ä½¿ç”¨ clone() æ–¹æ³•"></a>3. ä½¿ç”¨ <code>clone()</code> æ–¹æ³•</h3><p><code>clone()</code> æ–¹æ³•é€šè¿‡<strong>å¤åˆ¶</strong>ç°æœ‰å¯¹è±¡æ¥åˆ›å»ºæ–°å¯¹è±¡ï¼Œè€Œä¸æ˜¯é‡æ–°æ„é€ ã€‚å®ƒå±äº <code>Object</code> ç±»çš„ä¸€ä¸ª <code>protected</code> æ–¹æ³•ã€‚</p><p><strong>åŸç†ï¼š</strong></p><ol><li><strong>å®ç°æ¥å£ï¼š</strong> è¦ä½¿ç”¨ <code>clone()</code> æ–¹æ³•ï¼Œä½ çš„ç±»å¿…é¡»å®ç° <code>Cloneable</code> æ¥å£ã€‚è¿™ä¸ªæ¥å£æ˜¯ä¸€ä¸ª<strong>æ ‡è®°æ¥å£</strong>ï¼Œæœ¬èº«æ²¡æœ‰ä»»ä½•æ–¹æ³•ï¼Œä½†å®ƒå‘Šè¯‰ JVM è¿™ä¸ªç±»å¯ä»¥è¢«å…‹éš†ã€‚</li><li><strong>é‡å†™æ–¹æ³•ï¼š</strong> ä½ éœ€è¦é‡å†™ <code>Object</code> ç±»çš„ <code>clone()</code> æ–¹æ³•ï¼Œå¹¶å°†å…¶è®¿é—®ä¿®é¥°ç¬¦æ”¹ä¸º <code>public</code>ã€‚</li><li><strong>æ‰§è¡Œå…‹éš†ï¼š</strong> <code>clone()</code> æ–¹æ³•ä¼šåˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œå¹¶å°†ç°æœ‰å¯¹è±¡çš„å­—æ®µå€¼<strong>é€ä¸€å¤åˆ¶</strong>åˆ°æ–°å¯¹è±¡ä¸­ã€‚è¿™æ˜¯ä¸€ç§<strong>æµ…æ‹·è´ï¼ˆshallow copyï¼‰</strong>ã€‚å¦‚æœä½ çš„å¯¹è±¡åŒ…å«å¼•ç”¨ç±»å‹çš„æˆå‘˜ï¼Œé‚£ä¹ˆæ–°å¯¹è±¡å’Œæ—§å¯¹è±¡å°†å…±äº«åŒä¸€ä¸ªå¼•ç”¨ã€‚</li></ol><p><strong>ä¼˜ç‚¹ï¼š</strong></p><ul><li>å…‹éš†ä¸€ä¸ªå¯¹è±¡æ¯”ä½¿ç”¨ <code>new</code> å…³é”®å­—åˆ›å»ºå¯¹è±¡æ›´å¿«ï¼Œå› ä¸ºå®ƒè·³è¿‡äº†æ„é€ å™¨çš„åˆå§‹åŒ–è¿‡ç¨‹ã€‚</li><li>åœ¨éœ€è¦å¤§é‡åˆ›å»ºç›¸åŒæˆ–ç›¸ä¼¼å¯¹è±¡æ—¶ï¼Œæ˜¯ä¸€ç§æœ‰æ•ˆçš„æ€§èƒ½ä¼˜åŒ–æ‰‹æ®µã€‚</li></ul><p><strong>ç¼ºç‚¹ï¼š</strong></p><ul><li><code>clone()</code> æ–¹æ³•é»˜è®¤æ˜¯æµ…æ‹·è´ï¼Œå¦‚æœéœ€è¦æ·±æ‹·è´ï¼ˆdeep copyï¼‰ï¼Œéœ€è¦æ‰‹åŠ¨å®ç°ã€‚</li><li><code>Cloneable</code> æ¥å£å’Œ <code>clone()</code> æ–¹æ³•çš„è®¾è®¡æœ‰äº›â€œåç›´è§‰â€ï¼Œå®¹æ˜“å‡ºç°é—®é¢˜ã€‚</li></ul><p><strong>ç¤ºä¾‹ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç±»éœ€è¦å®ç° Cloneable æ¥å£å¹¶é‡å†™ clone() æ–¹æ³•</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyObject</span> <span class="keyword">implements</span> <span class="title class_">Cloneable</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.clone();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ clone() æ–¹æ³•åˆ›å»ºå¯¹è±¡</span></span><br><span class="line"><span class="type">MyObject</span> <span class="variable">original</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyObject</span>();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="type">MyObject</span> <span class="variable">cloned</span> <span class="operator">=</span> (MyObject) original.clone();</span><br><span class="line">&#125; <span class="keyword">catch</span> (CloneNotSupportedException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="4-ååºåˆ—åŒ–ï¼ˆDeserializationï¼‰"><a href="#4-ååºåˆ—åŒ–ï¼ˆDeserializationï¼‰" class="headerlink" title="4. ååºåˆ—åŒ–ï¼ˆDeserializationï¼‰"></a>4. ååºåˆ—åŒ–ï¼ˆDeserializationï¼‰</h3><p>ååºåˆ—åŒ–æ˜¯æŒ‡å°†å­—èŠ‚æµ<strong>æ¢å¤æˆ</strong> Java å¯¹è±¡çš„è¿‡ç¨‹ã€‚</p><p><strong>åŸç†ï¼š</strong></p><ol><li><strong>åºåˆ—åŒ–ï¼š</strong> é¦–å…ˆï¼Œä¸€ä¸ªå¯¹è±¡å¿…é¡»æ˜¯**å¯åºåˆ—åŒ–ï¼ˆ<code>Serializable</code>ï¼‰**çš„ï¼Œå³å®ƒå®ç°äº† <code>Serializable</code> æ¥å£ã€‚</li><li><strong>å†™å…¥æµï¼š</strong> åºåˆ—åŒ–å°±æ˜¯å°†å¯¹è±¡çš„çŠ¶æ€ï¼ˆæˆå‘˜å˜é‡çš„å€¼ï¼‰å†™å…¥ä¸€ä¸ªå­—èŠ‚æµä¸­ï¼ˆä¾‹å¦‚ï¼Œå†™å…¥æ–‡ä»¶æˆ–ç½‘ç»œï¼‰ã€‚</li><li><strong>ååºåˆ—åŒ–ï¼š</strong> ååºåˆ—åŒ–åˆ™æ˜¯ä»å­—èŠ‚æµä¸­è¯»å–æ•°æ®ï¼Œå¹¶é‡å»ºï¼ˆre-createï¼‰åŸå§‹å¯¹è±¡ã€‚è¿™ä¸ªè¿‡ç¨‹<strong>ä¸ä¼šè°ƒç”¨æ„é€ å™¨</strong>ã€‚</li></ol><p><strong>ä¼˜ç‚¹ï¼š</strong></p><ul><li>å¯ä»¥å°†å¯¹è±¡æŒä¹…åŒ–åˆ°ç£ç›˜æˆ–åœ¨ç½‘ç»œä¸­ä¼ è¾“ï¼Œè¿™å¯¹äºåˆ†å¸ƒå¼ç³»ç»Ÿå’Œç¼“å­˜éå¸¸é‡è¦ã€‚</li><li>å¯ä»¥è·¨è¿›ç¨‹ç”šè‡³è·¨æœºå™¨ä¼ è¾“å¯¹è±¡ã€‚</li></ul><p><strong>ç¼ºç‚¹ï¼š</strong></p><ul><li>åªæœ‰å®ç°äº† <code>Serializable</code> æ¥å£çš„ç±»æ‰èƒ½è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚</li><li>å¦‚æœå¯¹è±¡çš„ç‰ˆæœ¬ä¸å…¼å®¹ï¼Œååºåˆ—åŒ–å¯èƒ½ä¼šå¤±è´¥ã€‚</li><li>å­˜åœ¨å®‰å…¨é£é™©ï¼Œå› ä¸ºå®ƒèƒ½å¤Ÿç»•è¿‡æ„é€ å™¨ï¼Œå¦‚æœè®¾è®¡ä¸å½“å¯èƒ½å¯¼è‡´ä¸ä¸€è‡´çš„çŠ¶æ€ã€‚</li></ul><p><strong>ç¤ºä¾‹ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯¹è±¡å¿…é¡»å®ç° Serializable æ¥å£</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyObject</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åºåˆ—åŒ–</span></span><br><span class="line"><span class="keyword">try</span> (<span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;object.ser&quot;</span>))) &#123;</span><br><span class="line">    oos.writeObject(<span class="keyword">new</span> <span class="title class_">MyObject</span>(<span class="string">&quot;test&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ååºåˆ—åŒ–</span></span><br><span class="line"><span class="keyword">try</span> (<span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;object.ser&quot;</span>))) &#123;</span><br><span class="line">    <span class="type">MyObject</span> <span class="variable">obj</span> <span class="operator">=</span> (MyObject) ois.readObject();</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException | ClassNotFoundException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“-3"><a href="#æ€»ç»“-3" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>è¿™å››ç§åˆ›å»ºå¯¹è±¡çš„æ–¹å¼å„æœ‰ä¼˜åŠ£å’Œé€‚ç”¨åœºæ™¯ï¼š</p><ul><li><strong>new</strong>ï¼šæœ€å¸¸ç”¨ï¼Œç”¨äº<strong>å¸¸è§„</strong>çš„å¯¹è±¡åˆ›å»ºã€‚</li><li><strong>åå°„</strong>ï¼šç”¨äº<strong>è¿è¡Œæ—¶åŠ¨æ€</strong>åˆ›å»ºå¯¹è±¡ï¼Œå¸¸ç”¨äºæ¡†æ¶å¼€å‘ã€‚</li><li><strong>clone()</strong>ï¼šç”¨äº<strong>å¿«é€Ÿå¤åˆ¶</strong>ç°æœ‰å¯¹è±¡ï¼Œä»¥æé«˜æ€§èƒ½ã€‚</li><li><strong>ååºåˆ—åŒ–</strong>ï¼šç”¨äºå°†å¯¹è±¡<strong>æŒä¹…åŒ–</strong>æˆ–åœ¨<strong>ç½‘ç»œä¼ è¾“</strong>ä¸­é‡å»ºã€‚</li></ul><p>ç†è§£è¿™äº›åˆ›å»ºå¯¹è±¡çš„æ–¹å¼ï¼Œå¯ä»¥è®©ä½ åœ¨ä¸åŒçš„ç¼–ç¨‹åœºæ™¯ä¸­åšå‡ºæ›´æ˜æ™ºçš„é€‰æ‹©ã€‚</p><p>æ·±æ‹·è´å’Œæµ…æ‹·è´æ˜¯ Java å¯¹è±¡å¤åˆ¶æ—¶éœ€è¦ç†è§£çš„ä¸¤ä¸ªé‡è¦æ¦‚å¿µã€‚å®ƒä»¬ä¸»è¦é€šè¿‡ <code>clone()</code> æ–¹æ³•æˆ–åºåˆ—åŒ–æ¥å®ç°ã€‚</p><h3 id="æµ…æ‹·è´ï¼ˆShallow-Copyï¼‰"><a href="#æµ…æ‹·è´ï¼ˆShallow-Copyï¼‰" class="headerlink" title="æµ…æ‹·è´ï¼ˆShallow Copyï¼‰"></a>æµ…æ‹·è´ï¼ˆShallow Copyï¼‰</h3><p><strong>æµ…æ‹·è´</strong>åªå¤åˆ¶å¯¹è±¡æœ¬èº«ï¼Œä»¥åŠå…¶åŸºæœ¬æ•°æ®ç±»å‹çš„å­—æ®µã€‚å¯¹äºå¼•ç”¨ç±»å‹çš„å­—æ®µï¼Œå®ƒ<strong>åªå¤åˆ¶å¼•ç”¨åœ°å€</strong>ï¼Œæ–°æ—§å¯¹è±¡ä¼šå…±äº«åŒä¸€å—å†…å­˜ä¸­çš„å¼•ç”¨æ•°æ®ã€‚</p><h4 id="å®ç°æ–¹å¼ï¼šclone-æ–¹æ³•"><a href="#å®ç°æ–¹å¼ï¼šclone-æ–¹æ³•" class="headerlink" title="å®ç°æ–¹å¼ï¼šclone() æ–¹æ³•"></a>å®ç°æ–¹å¼ï¼š<code>clone()</code> æ–¹æ³•</h4><p>Java ä¸­çš„æµ…æ‹·è´é€šå¸¸é€šè¿‡å®ç° <code>Cloneable</code> æ¥å£å¹¶é‡å†™ <code>Object</code> ç±»çš„ <code>clone()</code> æ–¹æ³•æ¥å®ç°ã€‚</p><p><strong>æ­¥éª¤ï¼š</strong></p><ol><li>è®©ä½ çš„ç±»å®ç° <code>java.lang.Cloneable</code> æ¥å£ã€‚è¿™æ˜¯ä¸€ä¸ªæ ‡è®°æ¥å£ï¼Œå‘Šè¯‰ JVM è¿™ä¸ªç±»çš„å®ä¾‹å¯ä»¥è¢«å…‹éš†ã€‚</li><li>é‡å†™ <code>Object</code> ç±»çš„ <code>clone()</code> æ–¹æ³•ï¼Œå¹¶å°†å…¶å¯è§æ€§æ”¹ä¸º <code>public</code>ã€‚</li><li>åœ¨é‡å†™çš„æ–¹æ³•ä¸­è°ƒç”¨ <code>super.clone()</code>ã€‚</li></ol><p><strong>ç¤ºä¾‹ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Address</span> &#123;</span><br><span class="line">    String city;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Address</span><span class="params">(String city)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.city = city;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> <span class="keyword">implements</span> <span class="title class_">Cloneable</span> &#123;</span><br><span class="line">    String name;</span><br><span class="line">    Address address; <span class="comment">// å¼•ç”¨ç±»å‹</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">(String name, Address address)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException &#123;</span><br><span class="line">        <span class="comment">// è¿™æ˜¯æµ…æ‹·è´çš„å®ç°</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.clone();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShallowCopyExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> CloneNotSupportedException &#123;</span><br><span class="line">        <span class="type">Address</span> <span class="variable">addr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Address</span>(<span class="string">&quot;Beijing&quot;</span>);</span><br><span class="line">        <span class="type">Student</span> <span class="variable">originalStudent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;Zhangsan&quot;</span>, addr);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä½¿ç”¨æµ…æ‹·è´</span></span><br><span class="line">        <span class="type">Student</span> <span class="variable">clonedStudent</span> <span class="operator">=</span> (Student) originalStudent.clone();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;--- æµ…æ‹·è´å‰ ---&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;åŸå§‹å­¦ç”Ÿåœ°å€: &quot;</span> + originalStudent.address.city);</span><br><span class="line">        System.out.println(<span class="string">&quot;å…‹éš†å­¦ç”Ÿåœ°å€: &quot;</span> + clonedStudent.address.city);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¿®æ”¹å…‹éš†å¯¹è±¡çš„å¼•ç”¨ç±»å‹å­—æ®µ</span></span><br><span class="line">        clonedStudent.address.city = <span class="string">&quot;Shanghai&quot;</span>;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;\n--- æµ…æ‹·è´å ---&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;åŸå§‹å­¦ç”Ÿåœ°å€: &quot;</span> + originalStudent.address.city); <span class="comment">// åŸå§‹å¯¹è±¡çš„åœ°å€ä¹Ÿå˜äº†</span></span><br><span class="line">        System.out.println(<span class="string">&quot;å…‹éš†å­¦ç”Ÿåœ°å€: &quot;</span> + clonedStudent.address.city);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è¾“å‡ºï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">--- æµ…æ‹·è´å‰ ---</span><br><span class="line">åŸå§‹å­¦ç”Ÿåœ°å€: Beijing</span><br><span class="line">å…‹éš†å­¦ç”Ÿåœ°å€: Beijing</span><br><span class="line"></span><br><span class="line">--- æµ…æ‹·è´å ---</span><br><span class="line">åŸå§‹å­¦ç”Ÿåœ°å€: Shanghai</span><br><span class="line">å…‹éš†å­¦ç”Ÿåœ°å€: Shanghai</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œä¿®æ”¹å…‹éš†å¯¹è±¡çš„åœ°å€ï¼ŒåŸå§‹å¯¹è±¡çš„åœ°å€ä¹Ÿéšä¹‹æ”¹å˜ï¼Œè¿™æ­£æ˜¯æµ…æ‹·è´çš„ç‰¹ç‚¹ã€‚</p><hr><h3 id="æ·±æ‹·è´ï¼ˆDeep-Copyï¼‰"><a href="#æ·±æ‹·è´ï¼ˆDeep-Copyï¼‰" class="headerlink" title="æ·±æ‹·è´ï¼ˆDeep Copyï¼‰"></a>æ·±æ‹·è´ï¼ˆDeep Copyï¼‰</h3><p><strong>æ·±æ‹·è´</strong>ä¼šåˆ›å»ºä¸€ä¸ªå®Œå…¨ç‹¬ç«‹çš„æ–°å¯¹è±¡ï¼Œä¸ä»…å¤åˆ¶åŸºæœ¬æ•°æ®ç±»å‹ï¼Œè¿˜ä¼š<strong>é€’å½’åœ°å¤åˆ¶</strong>æ‰€æœ‰å¼•ç”¨ç±»å‹å­—æ®µæŒ‡å‘çš„å¯¹è±¡ã€‚æ–°æ—§å¯¹è±¡ä¹‹é—´äº’ä¸å½±å“ã€‚</p><h4 id="å®ç°æ–¹å¼ä¸€ï¼šæ‰‹åŠ¨å®ç°é€’å½’å¤åˆ¶"><a href="#å®ç°æ–¹å¼ä¸€ï¼šæ‰‹åŠ¨å®ç°é€’å½’å¤åˆ¶" class="headerlink" title="å®ç°æ–¹å¼ä¸€ï¼šæ‰‹åŠ¨å®ç°é€’å½’å¤åˆ¶"></a>å®ç°æ–¹å¼ä¸€ï¼šæ‰‹åŠ¨å®ç°é€’å½’å¤åˆ¶</h4><p>åœ¨é‡å†™çš„ <code>clone()</code> æ–¹æ³•ä¸­ï¼Œå¯¹å¼•ç”¨ç±»å‹çš„å­—æ®µè¿›è¡Œ<strong>å•ç‹¬çš„å…‹éš†</strong>ã€‚</p><p>ç¤ºä¾‹ï¼š</p><p>ä¿®æ”¹ä¸Šé¢çš„ Student ç±»ï¼Œå®ç°æ·±æ‹·è´ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Address</span> <span class="keyword">implements</span> <span class="title class_">Cloneable</span> &#123;</span><br><span class="line">    String city;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Address</span><span class="params">(String city)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.city = city;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Address ç±»ä¹Ÿå¿…é¡»é‡å†™ clone()</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.clone();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> <span class="keyword">implements</span> <span class="title class_">Cloneable</span> &#123;</span><br><span class="line">    String name;</span><br><span class="line">    Address address;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">(String name, Address address)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException &#123;</span><br><span class="line">        <span class="comment">// å…ˆè¿›è¡Œæµ…æ‹·è´</span></span><br><span class="line">        <span class="type">Student</span> <span class="variable">clonedStudent</span> <span class="operator">=</span> (Student) <span class="built_in">super</span>.clone();</span><br><span class="line">        <span class="comment">// ç„¶åå¯¹å¼•ç”¨ç±»å‹çš„å­—æ®µè¿›è¡Œæ·±å±‚æ‹·è´</span></span><br><span class="line">        clonedStudent.address = (Address) <span class="built_in">this</span>.address.clone();</span><br><span class="line">        <span class="keyword">return</span> clonedStudent;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeepCopyExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> CloneNotSupportedException &#123;</span><br><span class="line">        <span class="type">Address</span> <span class="variable">addr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Address</span>(<span class="string">&quot;Beijing&quot;</span>);</span><br><span class="line">        <span class="type">Student</span> <span class="variable">originalStudent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;Zhangsan&quot;</span>, addr);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä½¿ç”¨æ·±æ‹·è´</span></span><br><span class="line">        <span class="type">Student</span> <span class="variable">clonedStudent</span> <span class="operator">=</span> (Student) originalStudent.clone();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;--- æ·±æ‹·è´å‰ ---&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;åŸå§‹å­¦ç”Ÿåœ°å€: &quot;</span> + originalStudent.address.city);</span><br><span class="line">        System.out.println(<span class="string">&quot;å…‹éš†å­¦ç”Ÿåœ°å€: &quot;</span> + clonedStudent.address.city);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¿®æ”¹å…‹éš†å¯¹è±¡çš„å¼•ç”¨ç±»å‹å­—æ®µ</span></span><br><span class="line">        clonedStudent.address.city = <span class="string">&quot;Shanghai&quot;</span>;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;\n--- æ·±æ‹·è´å ---&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;åŸå§‹å­¦ç”Ÿåœ°å€: &quot;</span> + originalStudent.address.city); <span class="comment">// åŸå§‹å¯¹è±¡æ²¡æœ‰æ”¹å˜</span></span><br><span class="line">        System.out.println(<span class="string">&quot;å…‹éš†å­¦ç”Ÿåœ°å€: &quot;</span> + clonedStudent.address.city);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è¾“å‡ºï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">--- æ·±æ‹·è´å‰ ---</span><br><span class="line">åŸå§‹å­¦ç”Ÿåœ°å€: Beijing</span><br><span class="line">å…‹éš†å­¦ç”Ÿåœ°å€: Beijing</span><br><span class="line"></span><br><span class="line">--- æ·±æ‹·è´å ---</span><br><span class="line">åŸå§‹å­¦ç”Ÿåœ°å€: Beijing</span><br><span class="line">å…‹éš†å­¦ç”Ÿåœ°å€: Shanghai</span><br></pre></td></tr></table></figure><p>è¿™æ¬¡ï¼Œä¿®æ”¹å…‹éš†å¯¹è±¡çš„åœ°å€ï¼ŒåŸå§‹å¯¹è±¡æ²¡æœ‰å—åˆ°å½±å“ã€‚</p><h4 id="å®ç°æ–¹å¼äºŒï¼šåºåˆ—åŒ–ä¸ååºåˆ—åŒ–"><a href="#å®ç°æ–¹å¼äºŒï¼šåºåˆ—åŒ–ä¸ååºåˆ—åŒ–" class="headerlink" title="å®ç°æ–¹å¼äºŒï¼šåºåˆ—åŒ–ä¸ååºåˆ—åŒ–"></a>å®ç°æ–¹å¼äºŒï¼šåºåˆ—åŒ–ä¸ååºåˆ—åŒ–</h4><p>è¿™æ˜¯ä¸€ç§æ›´ç®€å•ã€é€šç”¨çš„æ·±æ‹·è´æ–¹æ³•ï¼Œç‰¹åˆ«é€‚ç”¨äºå¯¹è±¡ç»“æ„å¤æ‚çš„æƒ…å†µã€‚</p><p><strong>æ­¥éª¤ï¼š</strong></p><ol><li>è®©æ‰€æœ‰ç›¸å…³ç±»ï¼ˆåŒ…æ‹¬å¼•ç”¨ç±»å‹ï¼‰éƒ½å®ç° <code>java.io.Serializable</code> æ¥å£ã€‚</li><li>å°†å¯¹è±¡å†™å…¥ä¸€ä¸ªå­—èŠ‚æµä¸­ï¼ˆåºåˆ—åŒ–ï¼‰ã€‚</li><li>å†ä»å­—èŠ‚æµä¸­è¯»å‡ºæ–°çš„å¯¹è±¡ï¼ˆååºåˆ—åŒ–ï¼‰ã€‚</li></ol><p><strong>ç¤ºä¾‹ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Address</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    String city;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Address</span><span class="params">(String city)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.city = city;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    String name;</span><br><span class="line">    Address address;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">(String name, Address address)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SerializationDeepCopyExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Address</span> <span class="variable">addr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Address</span>(<span class="string">&quot;Beijing&quot;</span>);</span><br><span class="line">        <span class="type">Student</span> <span class="variable">originalStudent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;Zhangsan&quot;</span>, addr);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åºåˆ—åŒ–å’Œååºåˆ—åŒ–å®ç°æ·±æ‹·è´</span></span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">bos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(bos);</span><br><span class="line">        oos.writeObject(originalStudent);</span><br><span class="line">        oos.close();</span><br><span class="line">        </span><br><span class="line">        <span class="type">ByteArrayInputStream</span> <span class="variable">bis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(bos.toByteArray());</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(bis);</span><br><span class="line">        <span class="type">Student</span> <span class="variable">clonedStudent</span> <span class="operator">=</span> (Student) ois.readObject();</span><br><span class="line">        ois.close();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;--- æ·±æ‹·è´å‰ ---&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;åŸå§‹å­¦ç”Ÿåœ°å€: &quot;</span> + originalStudent.address.city);</span><br><span class="line">        System.out.println(<span class="string">&quot;å…‹éš†å­¦ç”Ÿåœ°å€: &quot;</span> + clonedStudent.address.city);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¿®æ”¹å…‹éš†å¯¹è±¡çš„å¼•ç”¨ç±»å‹å­—æ®µ</span></span><br><span class="line">        clonedStudent.address.city = <span class="string">&quot;Shanghai&quot;</span>;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;\n--- æ·±æ‹·è´å ---&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;åŸå§‹å­¦ç”Ÿåœ°å€: &quot;</span> + originalStudent.address.city);</span><br><span class="line">        System.out.println(<span class="string">&quot;å…‹éš†å­¦ç”Ÿåœ°å€: &quot;</span> + clonedStudent.address.city);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•ä»£ç è™½ç„¶å¤šï¼Œä½†å¯¹äºå¤æ‚çš„å¯¹è±¡å›¾æ¥è¯´ï¼Œå®ƒæ¯”æ‰‹åŠ¨é€’å½’å®ç°è¦ç®€å•å¾—å¤šï¼Œå› ä¸ºå®ƒä¼šè‡ªåŠ¨å¤„ç†æ‰€æœ‰åµŒå¥—å¯¹è±¡çš„æ‹·è´ã€‚</p><h2 id="æ¥å£å’ŒæŠ½è±¡ç±»ï¼š"><a href="#æ¥å£å’ŒæŠ½è±¡ç±»ï¼š" class="headerlink" title="æ¥å£å’ŒæŠ½è±¡ç±»ï¼š"></a>æ¥å£å’ŒæŠ½è±¡ç±»ï¼š</h2><p>åœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œ<strong>æŠ½è±¡ç±»ï¼ˆabstract classï¼‰å’Œæ¥å£ï¼ˆinterfaceï¼‰éƒ½æ˜¯ç”¨äºå®ç°å¤šæ€</strong>çš„é‡è¦æ¦‚å¿µï¼Œå®ƒä»¬å…è®¸ä½ å®šä¹‰ä¸€ä¸ªé€šç”¨çš„å¥‘çº¦ï¼Œç„¶åè®©å…·ä½“çš„ç±»å»å®ç°è¿™ä¸ªå¥‘çº¦ã€‚è™½ç„¶å®ƒä»¬çš„ç›®çš„ç›¸ä¼¼ï¼Œä½†åœ¨ç”¨é€”ã€è®¾è®¡å’Œå®ç°ä¸Šå­˜åœ¨ä¸€äº›å…³é”®åŒºåˆ«ã€‚</p><hr><h3 id="æŠ½è±¡ç±»"><a href="#æŠ½è±¡ç±»" class="headerlink" title="æŠ½è±¡ç±»"></a>æŠ½è±¡ç±»</h3><p>æŠ½è±¡ç±»æ˜¯ä¸€ä¸ªä¸èƒ½è¢«å®ä¾‹åŒ–çš„ç±»ï¼Œå®ƒé€šå¸¸åŒ…å«<strong>æŠ½è±¡æ–¹æ³•</strong>ï¼ˆæ²¡æœ‰å…·ä½“å®ç°çš„æ–¹æ³•ï¼‰å’Œ<strong>å…·ä½“æ–¹æ³•</strong>ï¼ˆæœ‰å…·ä½“å®ç°çš„æ–¹æ³•ï¼‰ã€‚</p><p><strong>ä¸»è¦ç‰¹ç‚¹ï¼š</strong></p><ul><li><strong>è¯­æ³•ï¼š</strong> ä½¿ç”¨ <code>abstract</code> å…³é”®å­—æ¥å£°æ˜ç±»å’ŒæŠ½è±¡æ–¹æ³•ã€‚</li><li><strong>æ–¹æ³•ï¼š</strong> å¯ä»¥åŒæ—¶åŒ…å«æŠ½è±¡æ–¹æ³•å’Œå…·ä½“æ–¹æ³•ã€‚æŠ½è±¡æ–¹æ³•å¿…é¡»åœ¨å­ç±»ä¸­è¢«å®ç°ï¼Œå…·ä½“æ–¹æ³•åˆ™å¯ä»¥é€‰æ‹©æ€§åœ°è¢«é‡å†™ã€‚</li><li><strong>æˆå‘˜å˜é‡ï¼š</strong> å¯ä»¥åŒ…å«æˆå‘˜å˜é‡ï¼ŒåŒ…æ‹¬ <code>private</code>ã€<code>protected</code> å’Œ <code>public</code> ç­‰ä¿®é¥°ç¬¦ã€‚</li><li><strong>ç»§æ‰¿ï¼š</strong> ä¸€ä¸ªå­ç±»<strong>åªèƒ½ç»§æ‰¿ä¸€ä¸ª</strong>æŠ½è±¡ç±»ã€‚å¦‚æœå­ç±»ä¸æ˜¯æŠ½è±¡ç±»ï¼Œå®ƒå¿…é¡»å®ç°æ‰€æœ‰çˆ¶æŠ½è±¡ç±»ä¸­çš„æŠ½è±¡æ–¹æ³•ã€‚</li><li><strong>æ„é€ å™¨ï¼š</strong> æŠ½è±¡ç±»å¯ä»¥æœ‰æ„é€ å™¨ï¼Œä½†ä¸èƒ½ç›´æ¥ç”¨ <code>new</code> å…³é”®å­—æ¥åˆ›å»ºå®ä¾‹ã€‚å®ƒçš„æ„é€ å™¨ä¸»è¦ç”¨äºåœ¨å­ç±»ä¸­é€šè¿‡ <code>super</code> å…³é”®å­—è°ƒç”¨ï¼Œä»¥åˆå§‹åŒ–çˆ¶ç±»çš„æˆå‘˜ã€‚</li><li><strong>ç›®çš„ï¼š</strong> é€šå¸¸ç”¨äºå®šä¹‰ä¸€ç±»äº‹ç‰©å…±åŒçš„<strong>å±æ€§å’Œè¡Œä¸º</strong>ã€‚å®ƒä»£è¡¨ä¸€ç§â€œis-aâ€ï¼ˆæ˜¯ä¸€ç§ï¼‰çš„å…³ç³»ï¼Œæ¯”å¦‚â€œçŒ«æ˜¯ä¸€ç§åŠ¨ç‰©â€ï¼Œ<code>Cat</code> ç±»ç»§æ‰¿ <code>Animal</code> æŠ½è±¡ç±»ã€‚</li></ul><p>ä½¿ç”¨åœºæ™¯ï¼š</p><p>å½“ä½ éœ€è¦å®šä¹‰ä¸€ä¸ªæ¨¡æ¿ï¼Œå…¶ä¸­ä¸€äº›æ–¹æ³•æ˜¯é€šç”¨çš„ï¼ˆå·²å®ç°ï¼‰ï¼Œè€Œå¦ä¸€äº›æ–¹æ³•æ˜¯éœ€è¦å­ç±»æ ¹æ®è‡ªèº«ç‰¹ç‚¹å»å®ç°çš„ï¼ŒæŠ½è±¡ç±»æ˜¯ç†æƒ³é€‰æ‹©ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ª Shape æŠ½è±¡ç±»å¯ä»¥å®šä¹‰ä¸€ä¸ªé€šç”¨çš„ draw() æŠ½è±¡æ–¹æ³•ï¼Œä½†æ¯ä¸ªå…·ä½“çš„å½¢çŠ¶ï¼ˆCircleï¼ŒRectangleï¼‰éƒ½æœ‰è‡ªå·±ç‹¬ç‰¹çš„ç»˜åˆ¶æ–¹å¼ã€‚åŒæ—¶ï¼Œå®ƒè¿˜å¯ä»¥æœ‰ä¸€ä¸ªå…·ä½“çš„ getColor() æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="comment">// æŠ½è±¡æ–¹æ³•ï¼Œå­ç±»å¿…é¡»å®ç°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">makeSound</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…·ä½“æ–¹æ³•ï¼Œæ‰€æœ‰å­ç±»éƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨æˆ–é‡å†™</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sleep</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Zzz...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span> <span class="keyword">extends</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">makeSound</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Woof woof&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="æ¥å£"><a href="#æ¥å£" class="headerlink" title="æ¥å£"></a>æ¥å£</h3><p>æ¥å£æ˜¯ä¸€ä¸ªå®Œå…¨æŠ½è±¡çš„â€œç±»â€ï¼Œå®ƒå®šä¹‰äº†ä¸€ç»„<strong>å¥‘çº¦æˆ–è§„èŒƒ</strong>ï¼Œå…¶ä¸­åªåŒ…å«æŠ½è±¡æ–¹æ³•å’Œå¸¸é‡ã€‚è‡ª Java 8 ä¹‹åï¼Œæ¥å£ä¹Ÿå¯ä»¥åŒ…å«é»˜è®¤æ–¹æ³•ï¼ˆdefault methodï¼‰å’Œé™æ€æ–¹æ³•ã€‚</p><p><strong>ä¸»è¦ç‰¹ç‚¹ï¼š</strong></p><ul><li><strong>è¯­æ³•ï¼š</strong> ä½¿ç”¨ <code>interface</code> å…³é”®å­—å£°æ˜ã€‚</li><li><strong>æ–¹æ³•ï¼š</strong> åœ¨ Java 8 ä¹‹å‰ï¼Œæ¥å£ä¸­çš„æ–¹æ³•é»˜è®¤éƒ½æ˜¯ <code>public abstract</code> çš„ï¼Œå¯ä»¥çœç•¥è¿™ä¸¤ä¸ªå…³é”®å­—ã€‚è‡ª Java 8 ä¹‹åï¼Œå¯ä»¥æœ‰ <code>default</code> å’Œ <code>static</code> æ–¹æ³•ã€‚è‡ª Java 9 ä¹‹åï¼Œè¿˜å¯ä»¥æœ‰ <code>private</code> æ–¹æ³•ã€‚</li><li><strong>æˆå‘˜å˜é‡ï¼š</strong> æ¥å£ä¸­çš„æˆå‘˜å˜é‡é»˜è®¤æ˜¯ <code>public static final</code> çš„ï¼Œä¹Ÿå³å¸¸é‡ã€‚</li><li><strong>å®ç°ï¼š</strong> ä¸€ä¸ªç±»å¯ä»¥<strong>å®ç°ï¼ˆimplementsï¼‰å¤šä¸ª</strong>æ¥å£ï¼Œä»è€Œå…‹æœäº†å•ç»§æ‰¿çš„é™åˆ¶ã€‚</li><li><strong>ç›®çš„ï¼š</strong> ä¸»è¦ç”¨äºå®šä¹‰ä¸€ä¸ª<strong>èƒ½åŠ›æˆ–è¡Œä¸º</strong>ã€‚å®ƒä»£è¡¨ä¸€ç§â€œcan-doâ€ï¼ˆèƒ½åšï¼‰çš„å…³ç³»ï¼Œæ¯”å¦‚ä¸€ä¸ª <code>Car</code> ç±»å¯ä»¥å®ç° <code>Driveable</code> æ¥å£ï¼Œä¸€ä¸ª <code>Bird</code> ç±»å¯ä»¥å®ç° <code>Flyable</code> æ¥å£ã€‚å®ƒæ˜¯ä¸€ç§å¯¹è¡Œä¸ºçš„æŠ½è±¡ã€‚</li></ul><p>ä½¿ç”¨åœºæ™¯ï¼š</p><p>å½“ä½ éœ€è¦å®šä¹‰ä¸€ç§èƒ½åŠ›ï¼Œè€Œè¿™ç§èƒ½åŠ›å¯ä»¥è¢«ä¸åŒç±»åˆ«çš„å¯¹è±¡å…±äº«æ—¶ï¼Œæ¥å£éå¸¸æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼ŒFlyable æ¥å£å¯ä»¥è¢« Airplaneã€Bird æˆ– Superman ç­‰å®Œå…¨ä¸ç›¸å…³çš„ç±»å®ç°ï¼Œå› ä¸ºå®ƒä»¬éƒ½å…·æœ‰â€œé£è¡Œâ€çš„èƒ½åŠ›ã€‚</p><p>Java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Flyable</span> &#123;</span><br><span class="line">    <span class="comment">// æŠ½è±¡æ–¹æ³•ï¼Œé»˜è®¤ public abstract</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">fly</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Java 8 ä¹‹åå…è®¸çš„é»˜è®¤æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">glide</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Gliding through the air...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Bird</span> <span class="keyword">implements</span> <span class="title class_">Flyable</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fly</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Flapping wings to fly.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="æ ¸å¿ƒåŒºåˆ«æ€»ç»“"><a href="#æ ¸å¿ƒåŒºåˆ«æ€»ç»“" class="headerlink" title="æ ¸å¿ƒåŒºåˆ«æ€»ç»“"></a>æ ¸å¿ƒåŒºåˆ«æ€»ç»“</h3><table><thead><tr><th>ç‰¹æ€§</th><th>æŠ½è±¡ç±»ï¼ˆAbstract Classï¼‰</th><th>æ¥å£ï¼ˆInterfaceï¼‰</th></tr></thead><tbody><tr><td><strong>ç»§æ‰¿&#x2F;å®ç°</strong></td><td><code>extends</code>ï¼Œå•ç»§æ‰¿</td><td><code>implements</code>ï¼Œå¤šå®ç°</td></tr><tr><td><strong>æ–¹æ³•</strong></td><td>å¯åŒ…å«æŠ½è±¡æ–¹æ³•å’Œå…·ä½“æ–¹æ³•</td><td>ä»…åŒ…å«æŠ½è±¡æ–¹æ³•ï¼ˆJava 8+ å¯æœ‰ <code>default</code>ã€<code>static</code> æ–¹æ³•ï¼‰</td></tr><tr><td><strong>æˆå‘˜å˜é‡</strong></td><td>å„ç§ç±»å‹å˜é‡ï¼ŒåŒ…æ‹¬å¸¸é‡å’Œéå¸¸é‡</td><td>åªèƒ½æ˜¯ <code>public static final</code> å¸¸é‡</td></tr><tr><td><strong>æ„é€ å™¨</strong></td><td>å¯ä»¥æœ‰</td><td>ä¸èƒ½æœ‰</td></tr><tr><td><strong>å¯è®¿é—®æ€§</strong></td><td>æˆå‘˜å¯ä»¥æ˜¯ <code>private</code>, <code>protected</code> æˆ– <code>public</code></td><td>æ–¹æ³•é»˜è®¤æ˜¯ <code>public</code>ï¼Œå˜é‡é»˜è®¤æ˜¯ <code>public static final</code></td></tr><tr><td><strong>ç›®çš„</strong></td><td>å®šä¹‰ä¸€ç±»äº‹ç‰©çš„<strong>å…±åŒç‰¹å¾å’Œè¡Œä¸º</strong>ï¼Œä»£è¡¨â€œis-aâ€å…³ç³»</td><td>å®šä¹‰ä¸€ç§<strong>èƒ½åŠ›æˆ–è¡Œä¸º</strong>ï¼Œä»£è¡¨â€œcan-doâ€å…³ç³»</td></tr></tbody></table><p>10ã€æŠ½è±¡ç±»å’Œæ¥å£æœ‰ï§½ä¹ˆåŒºåˆ«ï¼Ÿ</p><p>ï¼ˆ1ï¼‰æŠ½è±¡ç±»ä¸­å¯ä»¥å®šä¹‰æ„é€ å‡½æ•°ï¼Œæ¥å£ï¥§èƒ½å®šä¹‰æ„é€ å‡½æ•°ï¼› </p><p>ï¼ˆ2ï¼‰æŠ½è±¡ç±»ä¸­å¯ä»¥æœ‰æŠ½è±¡æ–¹æ³•å’Œå…·ä½“â½…æ–¹æ³•ï¼Œè€Œæ¥å£ä¸­åªèƒ½æœ‰æŠ½è±¡æ–¹æ³•ï¼ˆpublic abstractï¼‰ï¼› </p><p>ï¼ˆ3ï¼‰æŠ½è±¡ç±»ä¸­çš„æˆå‘˜æƒé™å¯ä»¥æ˜¯ publicã€é»˜è®¤ã€protectedï¼ˆæŠ½è±¡ç±»ä¸­æŠ½è±¡æ–¹æ³•å°±æ˜¯ä¸ºäº†é‡å†™ï¼Œæ‰€ä»¥ï¥§èƒ½è¢« private ä¿®é¥°ï¼‰ï¼Œè€Œæ¥å£ä¸­çš„æˆå‘˜åªå¯ä»¥æ˜¯ publicï¼ˆæ–¹æ³•é»˜è®¤ï¼špublic abstratã€æˆå‘˜å˜ï¥¾é»˜è®¤ï¼špublic static finalï¼‰ï¼›</p><p> ï¼ˆ4ï¼‰æŠ½è±¡ç±»ä¸­å¯ä»¥åŒ…å«é™æ€æ–¹æ³•ï¼Œè€Œæ¥å£ä¸­ä¸ï¥§å¯ä»¥åŒ…å«é™æ€æ–¹æ³•ï¼›</p><p> JDK 8 ä¸­çš„æ”¹å˜ï¼š</p><p>1ã€åœ¨ JDK1.8ä¸­ï¼Œå…è®¸åœ¨æ¥â¼å£ä¸­åŒ…å«å¸¦æœ‰å…·ä½“å®ç°çš„â½…æ–¹æ³•ï¼Œä½¿ç”¨ default ä¿®é¥°ï¼Œè¿™ç±»â½…æ–¹æ³•å°±æ˜¯é»˜è®¤æ–¹æ³•ã€‚ 2ã€æŠ½è±¡ç±»ä¸­å¯ä»¥åŒ…å«é™æ€æ–¹æ³•ï¼Œåœ¨ JDK1.8 ä¹‹å‰æ¥å£ä¸­ä¸ï¥§èƒ½åŒ…å«é™æ€æ–¹æ³•ï¼ŒJDK1.8 ä»¥åå¯ä»¥åŒ…å«ã€‚ä¹‹å‰ï¥§èƒ½åŒ…å«æ˜¯å› ä¸ºï¼Œæ¥å£ä¸å¯ä»¥å®ç°æ–¹æ³•ï¼Œåªå¯ä»¥å®šä¹‰æ–¹æ³•ï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨é™æ€æ–¹æ³•ï¼ˆå› ä¸ºé™æ€æ–¹æ³•å¿…é¡»å®ç°ï¼‰ã€‚ç°åœ¨å¯ä»¥åŒ… å«äº†ï¼Œåªèƒ½ç›´æ¥ç”¨æ¥å£è°ƒç”¨é™æ€â½…æ–¹æ³•ã€‚JDK1.8 ä»ç„¶ä¸å¯ä»¥åŒ…å«é™æ€ä»£ç å—ã€‚ </p><h3 id="é¢è¯•å®˜å¯èƒ½ä¼šé—®çš„æ·±å…¥é—®é¢˜"><a href="#é¢è¯•å®˜å¯èƒ½ä¼šé—®çš„æ·±å…¥é—®é¢˜" class="headerlink" title="é¢è¯•å®˜å¯èƒ½ä¼šé—®çš„æ·±å…¥é—®é¢˜"></a>é¢è¯•å®˜å¯èƒ½ä¼šé—®çš„æ·±å…¥é—®é¢˜</h3><ul><li><strong>ä¸ºä»€ä¹ˆ Java è¦åŒæ—¶ä¿ç•™æŠ½è±¡ç±»å’Œæ¥å£ï¼Ÿ</strong><ul><li>æŠ½è±¡ç±»ä¾§é‡äº<strong>ä»£ç å¤ç”¨</strong>ï¼Œé€šè¿‡å…·ä½“æ–¹æ³•å‡å°‘å­ç±»çš„é‡å¤ä»£ç ï¼Œå¹¶å¼ºåˆ¶å­ç±»å®ç°æŸäº›ç‰¹å®šè¡Œä¸ºã€‚</li><li>æ¥å£ä¾§é‡äº<strong>åŠŸèƒ½æ‰©å±•å’Œè§£è€¦</strong>ï¼Œå…è®¸ä¸ç›¸å…³çš„ç±»æ‹¥æœ‰ç›¸åŒçš„è¡Œä¸ºï¼Œå®ç°æ›´çµæ´»çš„è®¾è®¡ï¼ŒåŒæ—¶é¿å…å¤šç»§æ‰¿å¸¦æ¥çš„å¤æ‚æ€§ã€‚</li></ul></li><li><strong>ä»€ä¹ˆæ—¶å€™ç”¨æŠ½è±¡ç±»ï¼Œä»€ä¹ˆæ—¶å€™ç”¨æ¥å£ï¼Ÿ</strong><ul><li>å¦‚æœä½ æƒ³åœ¨ç±»å±‚æ¬¡ç»“æ„ä¸­<strong>å…±äº«ä»£ç </strong>ï¼Œå¹¶ä¸”è¿™ç§å…³ç³»æ˜¯ä¸€ç§**â€œis-aâ€å…³ç³»**ï¼Œä½¿ç”¨æŠ½è±¡ç±»ã€‚</li><li>å¦‚æœä½ æƒ³ä¸ºä¸ç›¸å…³çš„ç±»<strong>å®šä¹‰é€šç”¨çš„è¡Œä¸º</strong>ï¼Œå¹¶ä¸”å¸Œæœ›ä¸€ä¸ªç±»èƒ½æ‹¥æœ‰å¤šç§èƒ½åŠ›ï¼Œä½¿ç”¨æ¥å£ã€‚</li></ul></li><li><strong>Java 8 çš„é»˜è®¤æ–¹æ³•å¯¹æ¥å£å’ŒæŠ½è±¡ç±»çš„åŒºåˆ«æœ‰ä»€ä¹ˆå½±å“ï¼Ÿ</strong><ul><li>é»˜è®¤æ–¹æ³•çš„å¼•å…¥æ¨¡ç³Šäº†ä¸¤è€…çš„ä¸€äº›ç•Œé™ï¼Œæ¥å£ç°åœ¨ä¹Ÿå¯ä»¥æä¾›æ–¹æ³•çš„é»˜è®¤å®ç°ï¼Œä½¿å¾—æ¥å£çš„èƒ½åŠ›æ›´å¼ºã€‚</li><li>ä½†æ˜¯ï¼Œæœ¬è´¨åŒºåˆ«ä»ç„¶å­˜åœ¨ï¼š<strong>æŠ½è±¡ç±»å¯ä»¥æœ‰çŠ¶æ€ï¼ˆé final æˆå‘˜å˜é‡ï¼‰ï¼Œè€Œæ¥å£ä¸èƒ½ã€‚</strong> æŠ½è±¡ç±»å¯ä»¥å…±äº«çŠ¶æ€å’Œå…·ä½“å®ç°ï¼Œæ¥å£åˆ™æ›´å…³æ³¨è¡Œä¸ºçš„å¥‘çº¦ã€‚</li></ul></li></ul><p>ç®€å•æ¥è¯´ï¼ŒæŠ½è±¡ç±»æ˜¯<strong>æ¨¡æ¿</strong>ï¼Œæä¾›äº†éª¨æ¶å’Œéƒ¨åˆ†å®ç°ï¼›æ¥å£æ˜¯<strong>å¥‘çº¦</strong>ï¼Œåªè§„å®šäº†è¡Œä¸ºã€‚ç†è§£äº†è¿™ä¸€ç‚¹ï¼Œå°±èƒ½å¾ˆå¥½åœ°åº”å¯¹è¿™ç±»é¢è¯•é¢˜ã€‚</p><hr><p>å¥½çš„ï¼Œæˆ‘å¸®ä½ ç³»ç»Ÿæ•´ç† <strong>ä»£ç†æ¨¡å¼ï¼ˆProxy Patternï¼‰</strong> çš„æ¦‚å¿µã€åˆ†ç±»å’Œç‰¹ç‚¹ï¼Œå¹¶é™„å¸¦æ˜“æ‡‚ç¤ºä¾‹ã€‚</p><hr><h1 id="ä»£ç†æ¨¡å¼ï¼ˆProxy-Patternï¼‰"><a href="#ä»£ç†æ¨¡å¼ï¼ˆProxy-Patternï¼‰" class="headerlink" title="ä»£ç†æ¨¡å¼ï¼ˆProxy Patternï¼‰"></a>ä»£ç†æ¨¡å¼ï¼ˆProxy Patternï¼‰</h1><p>ä»£ç†æ¨¡å¼æ˜¯ä¸€ç§ <strong>ç»“æ„å‹è®¾è®¡æ¨¡å¼</strong>ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š<strong>ä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ç§ä»£ç†ä»¥æ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®</strong>ã€‚<br> ä»£ç†å¯¹è±¡ï¼ˆProxyï¼‰å……å½“çœŸå®å¯¹è±¡ï¼ˆReal Subjectï¼‰çš„æ›¿èº«ï¼Œå®¢æˆ·ç«¯é€šè¿‡ä»£ç†è®¿é—®çœŸå®å¯¹è±¡ï¼Œè€Œä»£ç†å¯ä»¥åœ¨è®¿é—®å‰åè¿›è¡Œå¢å¼ºæ“ä½œï¼ˆå¦‚æƒé™æ ¡éªŒã€å»¶è¿ŸåŠ è½½ã€æ—¥å¿—è®°å½•ç­‰ï¼‰ã€‚</p><hr><h2 id="1-ä»£ç†æ¨¡å¼çš„ç»„æˆ"><a href="#1-ä»£ç†æ¨¡å¼çš„ç»„æˆ" class="headerlink" title="1. ä»£ç†æ¨¡å¼çš„ç»„æˆ"></a>1. ä»£ç†æ¨¡å¼çš„ç»„æˆ</h2><ol><li><strong>Subjectï¼ˆæŠ½è±¡ä¸»é¢˜ï¼‰</strong><ul><li>å®šä¹‰çœŸå®å¯¹è±¡å’Œä»£ç†å¯¹è±¡çš„å…¬å…±æ¥å£ï¼Œå®¢æˆ·ç«¯é€šè¿‡è¿™ä¸ªæ¥å£è®¿é—®å¯¹è±¡ã€‚</li></ul></li><li><strong>RealSubjectï¼ˆçœŸå®ä¸»é¢˜ï¼‰</strong><ul><li>çœŸæ­£çš„ä¸šåŠ¡é€»è¾‘å¯¹è±¡ï¼Œå®ç° Subject æ¥å£ã€‚</li></ul></li><li><strong>Proxyï¼ˆä»£ç†ç±»ï¼‰</strong><ul><li>é€šè¿‡å®ç° Subject æ¥å£ï¼Œå†…éƒ¨æŒæœ‰ RealSubject çš„å¼•ç”¨ã€‚</li><li>å¯åœ¨è°ƒç”¨çœŸå®å¯¹è±¡æ–¹æ³•å‰åæ·»åŠ é¢å¤–åŠŸèƒ½ã€‚</li></ul></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">// ç¤ºä¾‹</span><br><span class="line">interface Subject &#123;</span><br><span class="line">    void request();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// çœŸå®å¯¹è±¡</span><br><span class="line">class RealSubject implements Subject &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void request() &#123;</span><br><span class="line">        System.out.println(&quot;çœŸå®å¯¹è±¡å¤„ç†è¯·æ±‚&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ä»£ç†å¯¹è±¡</span><br><span class="line">class ProxySubject implements Subject &#123;</span><br><span class="line">    private RealSubject real;</span><br><span class="line"></span><br><span class="line">    public ProxySubject(RealSubject real) &#123;</span><br><span class="line">        this.real = real;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void request() &#123;</span><br><span class="line">        System.out.println(&quot;ä»£ç†å‰å¤„ç†&quot;);</span><br><span class="line">        real.request(); // è°ƒç”¨çœŸå®å¯¹è±¡</span><br><span class="line">        System.out.println(&quot;ä»£ç†åå¤„ç†&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ä½¿ç”¨</span><br><span class="line">public class Client &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        RealSubject real = new RealSubject();</span><br><span class="line">        ProxySubject proxy = new ProxySubject(real);</span><br><span class="line">        proxy.request();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="2-ä»£ç†æ¨¡å¼çš„å‡ ç§ç±»å‹åŠç‰¹ç‚¹"><a href="#2-ä»£ç†æ¨¡å¼çš„å‡ ç§ç±»å‹åŠç‰¹ç‚¹" class="headerlink" title="2. ä»£ç†æ¨¡å¼çš„å‡ ç§ç±»å‹åŠç‰¹ç‚¹"></a>2. ä»£ç†æ¨¡å¼çš„å‡ ç§ç±»å‹åŠç‰¹ç‚¹</h2><table><thead><tr><th>ç±»å‹</th><th>ç‰¹ç‚¹</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>é™æ€ä»£ç†ï¼ˆStatic Proxyï¼‰</strong></td><td>- ä»£ç†ç±»åœ¨ç¼–è¯‘æ—¶å°±ç¡®å®š- ä»£ç†ç±»ä¸çœŸå®å¯¹è±¡å®ç°ç›¸åŒæ¥å£- ä¼˜ç‚¹ï¼šç®€å•æ˜“æ‡‚ï¼Œç¼–è¯‘æ—¶æ£€æŸ¥å®‰å…¨- ç¼ºç‚¹ï¼šæ¯ä¸€ä¸ªçœŸå®å¯¹è±¡éƒ½éœ€è¦å¯¹åº”ä»£ç†ç±»ï¼Œä»£ç†ç±»æ•°é‡å¤šï¼Œæ‰©å±•æ€§å·®</td><td>æƒé™æ§åˆ¶ã€æ—¥å¿—è®°å½•ç­‰å›ºå®šåŠŸèƒ½çš„å¢å¼º</td></tr><tr><td><strong>åŠ¨æ€ä»£ç†ï¼ˆDynamic Proxyï¼‰</strong></td><td>- è¿è¡Œæ—¶åˆ›å»ºä»£ç†ç±»- Java æä¾› <strong>JDK åŠ¨æ€ä»£ç†</strong>ï¼ˆæ¥å£ï¼‰å’Œ <strong>CGLIB åŠ¨æ€ä»£ç†</strong>ï¼ˆç»§æ‰¿å­ç±»ï¼‰- ä¼˜ç‚¹ï¼šå‡å°‘ä»£ç†ç±»æ•°é‡ï¼Œå¢å¼ºå¯æ‰©å±•æ€§- ç¼ºç‚¹ï¼šè¿è¡Œæ—¶ç”Ÿæˆå­—èŠ‚ç ï¼Œæ€§èƒ½ç¨ä½</td><td>AOPã€äº‹åŠ¡ç®¡ç†ã€æ—¥å¿—è®°å½•ã€RPC è°ƒç”¨</td></tr><tr><td><strong>å¼ºåˆ¶ä»£ç†ï¼ˆForce Proxyï¼‰</strong></td><td>- çœŸå®å¯¹è±¡åªèƒ½é€šè¿‡ä»£ç†è®¿é—®- å®¢æˆ·ç«¯æ— æ³•ç›´æ¥è®¿é—®çœŸå®å¯¹è±¡</td><td>éœ€è¦ä¸¥æ ¼æ§åˆ¶è®¿é—®æƒé™çš„åœºæ™¯</td></tr><tr><td><strong>è¿œç¨‹ä»£ç†ï¼ˆRemote Proxyï¼‰</strong></td><td>- ä¸ºè¿œç¨‹å¯¹è±¡æä¾›æœ¬åœ°ä»£ç†ï¼Œéšè—ç½‘ç»œé€šä¿¡ç»†èŠ‚</td><td>RPC è°ƒç”¨ã€åˆ†å¸ƒå¼ç³»ç»Ÿ</td></tr><tr><td><strong>è™šæ‹Ÿä»£ç†ï¼ˆVirtual Proxyï¼‰</strong></td><td>- å»¶è¿Ÿåˆ›å»ºæˆ–åŠ è½½çœŸå®å¯¹è±¡- ä»£ç†å¯¹è±¡åœ¨éœ€è¦æ—¶æ‰åˆ›å»ºçœŸå®å¯¹è±¡</td><td>å¤§å¯¹è±¡å»¶è¿ŸåŠ è½½ã€æ‡’åŠ è½½åœºæ™¯</td></tr><tr><td><strong>ä¿æŠ¤ä»£ç†ï¼ˆProtection Proxyï¼‰</strong></td><td>- æ§åˆ¶çœŸå®å¯¹è±¡çš„è®¿é—®æƒé™- æ ¹æ®ä¸åŒç”¨æˆ·æƒé™è¿”å›ä¸åŒç»“æœ</td><td>æƒé™æ§åˆ¶ã€å®‰å…¨ç®¡ç†</td></tr><tr><td><strong>ç¼“å­˜ä»£ç†ï¼ˆCache Proxyï¼‰</strong></td><td>- å¯¹ç»“æœè¿›è¡Œç¼“å­˜ï¼Œå‡å°‘çœŸå®å¯¹è±¡é‡å¤è®¡ç®—</td><td>é¢‘ç¹æŸ¥è¯¢ã€è®¡ç®—é‡å¤§çš„åœºæ™¯</td></tr></tbody></table><hr><h3 id="3-ä»£ç†æ¨¡å¼çš„ä¼˜ç¼ºç‚¹"><a href="#3-ä»£ç†æ¨¡å¼çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="3. ä»£ç†æ¨¡å¼çš„ä¼˜ç¼ºç‚¹"></a>3. ä»£ç†æ¨¡å¼çš„ä¼˜ç¼ºç‚¹</h3><p><strong>ä¼˜ç‚¹</strong>ï¼š</p><ol><li>å®¢æˆ·ç«¯ä¸çœŸå®å¯¹è±¡è§£è€¦ï¼Œé€šè¿‡ä»£ç†å¯ä»¥çµæ´»å¢å¼ºåŠŸèƒ½ã€‚</li><li>å¯ä»¥æ§åˆ¶è®¿é—®ã€å»¶è¿ŸåŠ è½½ã€è®°å½•æ—¥å¿—ç­‰ã€‚</li><li>å¢å¼ºå¯¹è±¡åŠŸèƒ½è€Œä¸ä¿®æ”¹åŸå§‹ç±»ã€‚</li></ol><p><strong>ç¼ºç‚¹</strong>ï¼š</p><ol><li>å¢åŠ ç³»ç»Ÿå¤æ‚æ€§ï¼Œä»£ç†ç±»å¯èƒ½å¢åŠ é¢å¤–å±‚æ¬¡ã€‚</li><li>å¯¹æ€§èƒ½æœ‰ä¸€å®šå½±å“ï¼ˆå°¤å…¶æ˜¯åŠ¨æ€ä»£ç†æˆ–è¿œç¨‹ä»£ç†ï¼‰ã€‚</li></ol><hr><h3 id="å¦‚ä½•å®ç°åŠ¨æ€ä»£ç†ï¼Ÿ"><a href="#å¦‚ä½•å®ç°åŠ¨æ€ä»£ç†ï¼Ÿ" class="headerlink" title="å¦‚ä½•å®ç°åŠ¨æ€ä»£ç†ï¼Ÿ"></a>å¦‚ä½•å®ç°åŠ¨æ€ä»£ç†ï¼Ÿ</h3><p>åŠ¨æ€ä»£ç†çš„æ ¸å¿ƒæ€æƒ³æ˜¯åœ¨<strong>è¿è¡Œæ—¶</strong>åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œç”¨äºåœ¨ä¸ä¿®æ”¹åŸå§‹ç±»ä»£ç çš„æƒ…å†µä¸‹ï¼Œä¸ºå¯¹è±¡æ·»åŠ é¢å¤–çš„åŠŸèƒ½ï¼ˆå¦‚æ—¥å¿—è®°å½•ã€æ€§èƒ½ç›‘æ§ã€äº‹åŠ¡ç®¡ç†ç­‰ï¼‰ã€‚Java æä¾›äº†ä¸¤ç§ä¸»è¦çš„åŠ¨æ€ä»£ç†å®ç°æ–¹å¼ï¼š<strong>JDK åŠ¨æ€ä»£ç†</strong>å’Œ <strong>CGLIB åŠ¨æ€ä»£ç†</strong>ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬é‡ç‚¹è§£æ JDK åŠ¨æ€ä»£ç†çš„å®ç°ï¼Œå®ƒä¾èµ–äºæ¥å£ã€‚</p><hr><h4 id="æ ¸å¿ƒç»„ä»¶"><a href="#æ ¸å¿ƒç»„ä»¶" class="headerlink" title="æ ¸å¿ƒç»„ä»¶"></a>æ ¸å¿ƒç»„ä»¶</h4><p>JDK åŠ¨æ€ä»£ç†çš„å®ç°ä¸»è¦ä¾èµ–äºä»¥ä¸‹ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶ï¼š</p><ol><li><strong>æ¥å£ (Interface)</strong>ï¼šä»£ç†å¯¹è±¡å’Œè¢«ä»£ç†å¯¹è±¡å¿…é¡»å®ç°åŒä¸€ä¸ªæˆ–ä¸€ç»„æ¥å£ã€‚è¿™æ˜¯ JDK åŠ¨æ€ä»£ç†çš„åŸºç¡€ï¼Œå®ƒå¼ºåˆ¶ä»£ç†å¯¹è±¡å’Œè¢«ä»£ç†å¯¹è±¡å…·æœ‰ç›¸åŒçš„å…¬å…±è¡Œä¸ºã€‚</li><li><strong>InvocationHandler</strong>ï¼šè¿™æ˜¯åŠ¨æ€ä»£ç†çš„<strong>æ ¸å¿ƒå¤„ç†é€»è¾‘</strong>ã€‚ä½ éœ€è¦åœ¨å…¶ä¸­å®ç° <code>invoke</code> æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•åŒ…å«äº†ä»£ç†å¯¹è±¡è¢«è°ƒç”¨æ—¶è¦æ‰§è¡Œçš„æ‰€æœ‰é€»è¾‘ã€‚</li><li><strong>Proxy</strong>ï¼šè¿™æ˜¯ä¸€ä¸ªå·¥å…·ç±»ï¼Œç”¨äºåŠ¨æ€ç”Ÿæˆä»£ç†å¯¹è±¡ã€‚ä½ ä¸èƒ½ç›´æ¥åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œè€Œæ˜¯é€šè¿‡ <code>Proxy</code> ç±»çš„é™æ€æ–¹æ³•æ¥å®Œæˆã€‚</li></ol><h4 id="å®ç°æ­¥éª¤"><a href="#å®ç°æ­¥éª¤" class="headerlink" title="å®ç°æ­¥éª¤"></a>å®ç°æ­¥éª¤</h4><p>åŠ¨æ€ä»£ç†çš„æ•´ä¸ªè¿‡ç¨‹å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š</p><ol><li><strong>å®šä¹‰æ¥å£</strong>ï¼šé¦–å…ˆï¼Œä½ éœ€è¦å®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œå£°æ˜è¢«ä»£ç†å¯¹è±¡å’Œä»£ç†å¯¹è±¡å…±åŒæ‹¥æœ‰çš„æ–¹æ³•ã€‚</li><li><strong>åˆ›å»ºè¢«ä»£ç†å¯¹è±¡ï¼ˆç›®æ ‡å¯¹è±¡ï¼‰</strong>ï¼šåˆ›å»ºä¸€ä¸ªç±»ï¼Œå®ç°ä¸Šä¸€æ­¥å®šä¹‰çš„æ¥å£ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬çœŸæ­£è¦ä»£ç†çš„å¯¹è±¡ã€‚</li><li><strong>ç¼–å†™ InvocationHandler</strong>ï¼šåˆ›å»ºä¸€ä¸ªå¤„ç†ç±»ï¼Œå®ƒå®ç° <code>InvocationHandler</code> æ¥å£ï¼Œå¹¶é‡å†™ <code>invoke</code> æ–¹æ³•ã€‚åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œä½ å°†ï¼š<ul><li>æ¥æ”¶è¢«ä»£ç†å¯¹è±¡çš„å®ä¾‹ã€‚</li><li>åœ¨è°ƒç”¨åŸå§‹æ–¹æ³•<strong>ä¹‹å‰</strong>æ‰§è¡Œä¸€äº›é¢„å¤„ç†é€»è¾‘ã€‚</li><li>é€šè¿‡ <code>method.invoke(ç›®æ ‡å¯¹è±¡, args)</code> è°ƒç”¨è¢«ä»£ç†å¯¹è±¡çš„åŸå§‹æ–¹æ³•ã€‚</li><li>åœ¨è°ƒç”¨åŸå§‹æ–¹æ³•<strong>ä¹‹å</strong>æ‰§è¡Œä¸€äº›åå¤„ç†é€»è¾‘ã€‚</li></ul></li><li><strong>ä½¿ç”¨ Proxy ç±»ç”Ÿæˆä»£ç†å¯¹è±¡</strong>ï¼šè°ƒç”¨ <code>Proxy</code> ç±»çš„é™æ€æ–¹æ³• <code>newProxyInstance()</code> æ¥åˆ›å»ºä»£ç†å¯¹è±¡ã€‚è¿™ä¸ªæ–¹æ³•éœ€è¦ä¸‰ä¸ªå‚æ•°ï¼š<ul><li><strong>ClassLoader loader</strong>ï¼šç”¨äºåŠ è½½ä»£ç†ç±»çš„ç±»åŠ è½½å™¨ã€‚é€šå¸¸ä½¿ç”¨è¢«ä»£ç†å¯¹è±¡çš„ç±»åŠ è½½å™¨ã€‚</li><li><strong>Class&lt;?&gt;[] interfaces</strong>ï¼šä¸€ä¸ªæ¥å£æ•°ç»„ï¼Œä»£ç†å¯¹è±¡éœ€è¦å®ç°çš„æ¥å£ã€‚</li><li><strong>InvocationHandler handler</strong>ï¼šå®ç°äº† <code>InvocationHandler</code> çš„å¯¹è±¡ï¼Œå®ƒåŒ…å«äº†ä»£ç†çš„é€»è¾‘ã€‚</li></ul></li></ol><hr><h4 id="invoke-æ–¹æ³•çš„å‚æ•°è§£æ"><a href="#invoke-æ–¹æ³•çš„å‚æ•°è§£æ" class="headerlink" title="invoke() æ–¹æ³•çš„å‚æ•°è§£æ"></a><code>invoke()</code> æ–¹æ³•çš„å‚æ•°è§£æ</h4><p><code>InvocationHandler</code> æ¥å£çš„ <code>invoke()</code> æ–¹æ³•ç­¾åå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable</span><br></pre></td></tr></table></figure><ul><li><strong>proxy</strong>ï¼šè¿™ä¸ªå‚æ•°æ˜¯<strong>ä»£ç†å¯¹è±¡æœ¬èº«</strong>çš„å¼•ç”¨ã€‚åœ¨ <code>invoke</code> æ–¹æ³•å†…éƒ¨ï¼Œä½ åº”è¯¥é¿å…ç›´æ¥è°ƒç”¨ <code>proxy</code> çš„æ–¹æ³•ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´æ— é™é€’å½’è°ƒç”¨ã€‚</li><li><strong>method</strong>ï¼šä»£è¡¨æ­£åœ¨è¢«è°ƒç”¨çš„æ–¹æ³•ï¼Œå®ƒæ˜¯ <code>java.lang.reflect.Method</code> ç±»å‹çš„å¯¹è±¡ã€‚ä½ å¯ä»¥é€šè¿‡å®ƒè·å–æ–¹æ³•åã€å‚æ•°ç±»å‹ã€è¿”å›å€¼ç±»å‹ç­‰ä¿¡æ¯ã€‚</li><li><strong>args</strong>ï¼šä¸€ä¸ª <code>Object</code> æ•°ç»„ï¼ŒåŒ…å«äº†è°ƒç”¨åŸå§‹æ–¹æ³•æ—¶ä¼ é€’çš„æ‰€æœ‰å‚æ•°ã€‚</li></ul><p>é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼ŒJVM ä¼šåœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆä¸€ä¸ªå®ç°äº†æŒ‡å®šæ¥å£ã€å¹¶ç»§æ‰¿è‡ª <code>Proxy</code> ç±»çš„å­—èŠ‚ç ï¼Œå°†å…¶åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¹¶æœ€ç»ˆè¿”å›ä¸€ä¸ªä»£ç†å¯¹è±¡å®ä¾‹ã€‚æ‰€æœ‰å¯¹ä»£ç†å¯¹è±¡æ–¹æ³•çš„è°ƒç”¨éƒ½ä¼šè¢«è‡ªåŠ¨è½¬å‘åˆ° <code>InvocationHandler</code> çš„ <code>invoke</code> æ–¹æ³•ä¸­ï¼Œä»è€Œå®ç°äº†å¯¹åŸå§‹æ–¹æ³•çš„å¢å¼ºå’Œæ§åˆ¶ã€‚</p><p>Proxy ç±»çš„ä½œç”¨æ˜¯åŠ¨æ€åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡çš„ç±»ã€‚å®ƒæä¾›äº†è®¸å¤šçš„æ–¹æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬ç”¨å¾—æœ€å¤šçš„å°±æ˜¯ <code>newProxyInstance</code> è¿™ä¸ªæ–¹æ³•ï¼š</p><p><code>public static Object newProxyInstance(ClassLoader loader, Class[] interfaces, InvocationHandler handler) throws IllegalArgumentException</code></p><ul><li><code>loader</code>ï¼šä¸€ä¸ª ClassLoader å¯¹è±¡ï¼Œå®šä¹‰äº†ç”±å“ªä¸ª ClassLoader å¯¹è±¡æ¥å¯¹ç”Ÿæˆçš„ä»£ç†å¯¹è±¡è¿›è¡ŒåŠ è½½ï¼›</li><li><code>interfaces</code>ï¼šä¸€ä¸ª Interface å¯¹è±¡çš„æ•°ç»„ï¼Œè¡¨ç¤ºçš„æ˜¯æˆ‘å°†è¦ç»™æˆ‘éœ€è¦ä»£ç†çš„å¯¹è±¡æä¾›ä¸€ç»„ä»€ä¹ˆæ¥å£ï¼Œå¦‚æœæˆ‘æä¾›äº†ä¸€ç»„æ¥å£ç»™å®ƒï¼Œé‚£ä¹ˆè¿™ä¸ªä»£ç†å¯¹è±¡å°±å®£ç§°å®ç°äº†è¯¥æ¥å£(å¤šæ€)ï¼Œè¿™æ ·æˆ‘å°±èƒ½è°ƒç”¨è¿™ç»„æ¥å£ä¸­çš„æ–¹æ³•äº†ã€‚</li><li><code>handler</code>ï¼šä¸€ä¸ª InvocationHandler å¯¹è±¡ï¼Œè¡¨ç¤ºçš„æ˜¯å½“æˆ‘è¿™ä¸ªåŠ¨æ€ä»£ç†å¯¹è±¡åœ¨è°ƒç”¨æ–¹æ³•çš„æ—¶å€™ï¼Œä¼šå…³è”åˆ°å“ªä¸€ä¸ª InvocationHandler å¯¹è±¡ä¸Šã€‚</li></ul><p>é€šè¿‡ <code>Proxy.newProxyInstance</code> åˆ›å»ºçš„ä»£ç†å¯¹è±¡æ˜¯åœ¨ Jvm è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆçš„ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒå¹¶ä¸æ˜¯æˆ‘ä»¬çš„ InvocationHandler ç±»å‹ï¼Œä¹Ÿä¸æ˜¯æˆ‘ä»¬å®šä¹‰çš„é‚£ç»„æ¥å£çš„ç±»å‹ï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆçš„ä¸€ä¸ªå¯¹è±¡ã€‚</p><h2 id="æˆå‘˜ç±»ï¼š"><a href="#æˆå‘˜ç±»ï¼š" class="headerlink" title="æˆå‘˜ç±»ï¼š"></a>æˆå‘˜ç±»ï¼š</h2><p>æˆ‘å·²ç»ä¸ºæ‚¨å°†ä¹‹å‰å…³äº<strong>æˆå‘˜ç±»åˆ†ç±»</strong>çš„è¯¦ç»†è§£æå’Œè¡¨æ ¼æ€»ç»“è¿›è¡Œäº†åˆå¹¶ï¼Œä»¥æä¾›ä¸€ä¸ªæ›´å…¨é¢ã€æ›´æ˜“äºç†è§£çš„å›ç­”ã€‚</p><hr><p>åœ¨ Java ä¸­ï¼Œä¸€ä¸ªç±»å¯ä»¥å®šä¹‰åœ¨å¦ä¸€ä¸ªç±»çš„å†…éƒ¨ï¼Œè¿™ç§ç±»è¢«ç§°ä¸º<strong>æˆå‘˜ç±»ï¼ˆMember Classï¼‰</strong>ï¼Œä¹Ÿè¢«ç§°ä¸º<strong>åµŒå¥—ç±»ï¼ˆNested Classï¼‰</strong>ã€‚æ ¹æ®å…¶å®šä¹‰æ–¹å¼å’Œç‰¹æ€§ï¼Œæˆå‘˜ç±»ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å››ç§ç±»å‹ï¼š</p><h3 id="1-é™æ€æˆå‘˜ç±»ï¼ˆStatic-Member-Classï¼‰"><a href="#1-é™æ€æˆå‘˜ç±»ï¼ˆStatic-Member-Classï¼‰" class="headerlink" title="1. é™æ€æˆå‘˜ç±»ï¼ˆStatic Member Classï¼‰"></a>1. é™æ€æˆå‘˜ç±»ï¼ˆStatic Member Classï¼‰</h3><p><strong>é™æ€æˆå‘˜ç±»</strong>æ˜¯ä½¿ç”¨ <code>static</code> å…³é”®å­—ä¿®é¥°çš„å†…éƒ¨ç±»ã€‚å®ƒä¸å¤–éƒ¨ç±»çš„å®ä¾‹æ²¡æœ‰å…³è”ï¼Œå¯ä»¥åƒè®¿é—®é™æ€å˜é‡ä¸€æ ·ï¼Œç›´æ¥é€šè¿‡å¤–éƒ¨ç±»åæ¥åˆ›å»ºå®ƒçš„å®ä¾‹ã€‚</p><ul><li><strong>ç‰¹ç‚¹</strong>:<ul><li>æ— æ³•ç›´æ¥è®¿é—®å¤–éƒ¨ç±»çš„éé™æ€æˆå‘˜ï¼Œä½†å¯ä»¥è®¿é—®å¤–éƒ¨ç±»çš„é™æ€æˆå‘˜ã€‚</li></ul></li><li><strong>é€‚ç”¨åœºæ™¯</strong>:<ul><li>å½“ä¸€ä¸ªç±»ä¸å¤–éƒ¨ç±»é€»è¾‘ä¸Šç´§å¯†ç›¸å…³ï¼Œä½†åˆä¸éœ€è¦è®¿é—®å¤–éƒ¨ç±»çš„å®ä¾‹æˆå‘˜æ—¶ï¼Œä½¿ç”¨é™æ€æˆå‘˜ç±»ã€‚å®ƒå¸¸ç”¨äºä½œä¸ºå¤–éƒ¨ç±»çš„è¾…åŠ©å·¥å…·ç±»ï¼Œæ¯”å¦‚åœ¨ä¸€ä¸ª <code>LinkedList</code> ç±»ä¸­å®šä¹‰ä¸€ä¸ª <code>Node</code> é™æ€æˆå‘˜ç±»æ¥è¡¨ç¤ºé“¾è¡¨èŠ‚ç‚¹ã€‚</li></ul></li></ul><h3 id="2-å†…éƒ¨ç±»ï¼ˆInner-Classï¼‰"><a href="#2-å†…éƒ¨ç±»ï¼ˆInner-Classï¼‰" class="headerlink" title="2. å†…éƒ¨ç±»ï¼ˆInner Classï¼‰"></a>2. å†…éƒ¨ç±»ï¼ˆInner Classï¼‰</h3><p><strong>å†…éƒ¨ç±»</strong>æ˜¯æ²¡æœ‰è¢« <code>static</code> å…³é”®å­—ä¿®é¥°çš„åµŒå¥—ç±»ã€‚å®ƒä¸å¤–éƒ¨ç±»çš„å®ä¾‹ç´§å¯†ç›¸è¿ï¼Œå¿…é¡»ä¾é™„äºä¸€ä¸ªå¤–éƒ¨ç±»çš„å®ä¾‹æ‰èƒ½è¢«åˆ›å»ºã€‚</p><ul><li><strong>ç‰¹ç‚¹</strong>:<ul><li>å¯ä»¥ç›´æ¥è®¿é—®å¤–éƒ¨ç±»çš„<strong>æ‰€æœ‰æˆå‘˜</strong>ï¼ŒåŒ…æ‹¬ç§æœ‰æˆå‘˜ã€‚è¿™æ˜¯å†…éƒ¨ç±»æœ€å¼ºå¤§çš„ç‰¹æ€§ã€‚</li></ul></li><li><strong>é€‚ç”¨åœºæ™¯</strong>:<ul><li>å½“ä¸€ä¸ªç±»çš„å®ä¾‹éœ€è¦ç›´æ¥è®¿é—®å¤–éƒ¨ç±»çš„ç§æœ‰çŠ¶æ€æ—¶ï¼Œä½¿ç”¨å†…éƒ¨ç±»ã€‚å®ƒå¸¸ç”¨äºå®ç°æŸäº›ç‰¹å®šåŠŸèƒ½çš„å›è°ƒæ¥å£ã€‚</li></ul></li></ul><h3 id="3-å±€éƒ¨å†…éƒ¨ç±»ï¼ˆLocal-Inner-Classï¼‰"><a href="#3-å±€éƒ¨å†…éƒ¨ç±»ï¼ˆLocal-Inner-Classï¼‰" class="headerlink" title="3. å±€éƒ¨å†…éƒ¨ç±»ï¼ˆLocal Inner Classï¼‰"></a>3. å±€éƒ¨å†…éƒ¨ç±»ï¼ˆLocal Inner Classï¼‰</h3><p><strong>å±€éƒ¨å†…éƒ¨ç±»</strong>æ˜¯å®šä¹‰åœ¨æ–¹æ³•æˆ–ä»£ç å—å†…éƒ¨çš„ç±»ã€‚å®ƒåªèƒ½åœ¨å®šä¹‰å®ƒçš„æ–¹æ³•æˆ–ä»£ç å—å†…éƒ¨è¢«è®¿é—®å’Œå®ä¾‹åŒ–ã€‚</p><ul><li><strong>ç‰¹ç‚¹</strong>:<ul><li>æ— æ³•ä½¿ç”¨è®¿é—®ä¿®é¥°ç¬¦ï¼ˆå¦‚ <code>public</code>ï¼‰ã€‚</li><li>å¯ä»¥è®¿é—®å¤–éƒ¨ç±»çš„æ‰€æœ‰æˆå‘˜ï¼Œä½†åªèƒ½è®¿é—®å…¶æ‰€åœ¨æ–¹æ³•ä¸­çš„ <strong>final æˆ–äº‹å®ä¸Šçš„ final</strong> å±€éƒ¨å˜é‡ã€‚</li></ul></li><li><strong>é€‚ç”¨åœºæ™¯</strong>:<ul><li>å½“æŸä¸ªæ–¹æ³•ä¸­éœ€è¦ä¸€ä¸ªåªç”¨ä¸€æ¬¡çš„å¤æ‚å¯¹è±¡æˆ–å·¥å…·ç±»æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å±€éƒ¨å†…éƒ¨ç±»ï¼Œä»¥é¿å…åœ¨ç±»çº§åˆ«åˆ›å»ºä¸å¿…è¦çš„æˆå‘˜ã€‚</li></ul></li></ul><h3 id="4-åŒ¿åå†…éƒ¨ç±»ï¼ˆAnonymous-Inner-Classï¼‰"><a href="#4-åŒ¿åå†…éƒ¨ç±»ï¼ˆAnonymous-Inner-Classï¼‰" class="headerlink" title="4. åŒ¿åå†…éƒ¨ç±»ï¼ˆAnonymous Inner Classï¼‰"></a>4. åŒ¿åå†…éƒ¨ç±»ï¼ˆAnonymous Inner Classï¼‰</h3><p><strong>åŒ¿åå†…éƒ¨ç±»</strong>æ˜¯ä¸€ç§æ²¡æœ‰åå­—çš„å±€éƒ¨å†…éƒ¨ç±»ï¼Œé€šå¸¸ç”¨äºåˆ›å»ºä¸€ä¸ªåªä½¿ç”¨ä¸€æ¬¡çš„ç±»çš„å®ä¾‹ã€‚</p><ul><li><strong>ç‰¹ç‚¹</strong>:<ul><li>æ²¡æœ‰åå­—ï¼Œå› æ­¤æ— æ³•è¢«å¤ç”¨ã€‚</li><li>å¿…é¡»åœ¨<strong>åˆ›å»ºå®ä¾‹</strong>çš„åŒæ—¶å®šä¹‰ç±»çš„å®ç°ã€‚</li><li>æ— æ³•å®šä¹‰æ„é€ å™¨ã€‚</li><li>å¯ä»¥å®ç°ä¸€ä¸ªæ¥å£æˆ–ç»§æ‰¿ä¸€ä¸ªç±»ã€‚</li></ul></li><li><strong>é€‚ç”¨åœºæ™¯</strong>:<ul><li>æœ€å¸¸ç”¨äºå®ç°äº‹ä»¶ç›‘å¬å™¨æˆ–åˆ›å»ºçº¿ç¨‹ï¼Œå°¤å…¶æ˜¯åœ¨éœ€è¦ç®€æ´åœ°å®ç°æŸä¸ªæ¥å£çš„å•ä¸ªæ–¹æ³•æ—¶ã€‚</li></ul></li></ul><hr><h3 id="åŒ¿åå†…éƒ¨ç±»ä¸­çš„å±€éƒ¨å˜é‡ä¸ºä»€ä¹ˆåªèƒ½ç”¨-finalï¼Ÿ"><a href="#åŒ¿åå†…éƒ¨ç±»ä¸­çš„å±€éƒ¨å˜é‡ä¸ºä»€ä¹ˆåªèƒ½ç”¨-finalï¼Ÿ" class="headerlink" title="åŒ¿åå†…éƒ¨ç±»ä¸­çš„å±€éƒ¨å˜é‡ä¸ºä»€ä¹ˆåªèƒ½ç”¨ finalï¼Ÿ"></a>åŒ¿åå†…éƒ¨ç±»ä¸­çš„å±€éƒ¨å˜é‡ä¸ºä»€ä¹ˆåªèƒ½ç”¨ <code>final</code>ï¼Ÿ</h3><p>è¿™ä¸ªé™åˆ¶çš„æ ¹æœ¬åŸå› åœ¨äº<strong>ç”Ÿå‘½å‘¨æœŸï¼ˆLifecycleï¼‰</strong>ã€‚</p><ol><li><strong>å±€éƒ¨å˜é‡çš„ç”Ÿå‘½å‘¨æœŸ</strong>ï¼šå±€éƒ¨å˜é‡ï¼ˆå¦‚æ–¹æ³•ä¸­çš„å‚æ•°æˆ–å˜é‡ï¼‰æ˜¯åœ¨æ–¹æ³•è¢«è°ƒç”¨æ—¶åˆ›å»ºçš„ï¼Œå­˜å‚¨åœ¨**æ ˆï¼ˆStackï¼‰**ä¸Šã€‚å½“æ–¹æ³•æ‰§è¡Œå®Œæ¯•ï¼Œè¿™äº›å˜é‡å°±ä¼šè¢«é”€æ¯ã€‚</li><li><strong>åŒ¿åå†…éƒ¨ç±»çš„ç”Ÿå‘½å‘¨æœŸ</strong>ï¼šåŒ¿åå†…éƒ¨ç±»çš„å®ä¾‹é€šå¸¸ä¼šä½œä¸ºä¸€ä¸ªå¯¹è±¡è¢«ä¼ é€’æˆ–ä¿å­˜ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸå¯èƒ½<strong>æ¯”åˆ›å»ºå®ƒçš„æ–¹æ³•æ›´é•¿</strong>ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½ä¼šå°†ä¸€ä¸ªå®ç°äº†äº‹ä»¶ç›‘å¬å™¨çš„åŒ¿åå†…éƒ¨ç±»å®ä¾‹ä½œä¸ºå‚æ•°ä¼ é€’ç»™ä¸€ä¸ª UI ç»„ä»¶ï¼Œå½“æ–¹æ³•è¿”å›åï¼Œè¿™ä¸ªç›‘å¬å™¨å¯¹è±¡å¯èƒ½ä»ç„¶å­˜åœ¨å¹¶ç­‰å¾…äº‹ä»¶è§¦å‘ã€‚</li></ol><p><strong>é—®é¢˜å‡ºç°ï¼š</strong></p><p>å¦‚æœåŒ¿åå†…éƒ¨ç±»å¯ä»¥è®¿é—®å’Œä¿®æ”¹ä¸€ä¸ªé <code>final</code> çš„å±€éƒ¨å˜é‡ï¼Œé‚£ä¹ˆå½“åˆ›å»ºå®ƒçš„æ–¹æ³•æ‰§è¡Œå®Œæ¯•ã€å±€éƒ¨å˜é‡è¢«é”€æ¯åï¼ŒåŒ¿åå†…éƒ¨ç±»çš„å®ä¾‹ä»ç„¶å­˜åœ¨ã€‚å½“å®ƒè¯•å›¾è®¿é—®è¿™ä¸ªå·²ç»ä¸å­˜åœ¨çš„å˜é‡æ—¶ï¼Œå°±ä¼šå¼•å‘ä¸€ä¸ª**æ‚¬ç©ºå¼•ç”¨ï¼ˆDangling Referenceï¼‰**çš„é”™è¯¯ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒJava ç¼–è¯‘å™¨é‡‡å–äº†ä»¥ä¸‹ç­–ç•¥ï¼š</p><ul><li><strong>å°†å±€éƒ¨å˜é‡å¤åˆ¶ä¸€ä»½</strong>ï¼šå½“åŒ¿åå†…éƒ¨ç±»è®¿é—®ä¸€ä¸ªå±€éƒ¨å˜é‡æ—¶ï¼Œç¼–è¯‘å™¨ä¼šä¸ºå®ƒåœ¨<strong>å †ï¼ˆHeapï¼‰ä¸Šåˆ›å»ºä¸€ä¸ªå‰¯æœ¬</strong>ã€‚è¿™ä¸ªå‰¯æœ¬ä¼šå’ŒåŒ¿åå†…éƒ¨ç±»å®ä¾‹ä¸€èµ·å­˜å‚¨ï¼Œä»è€Œç¡®ä¿åŒ¿åå†…éƒ¨ç±»åœ¨ä»»ä½•æ—¶å€™éƒ½èƒ½è®¿é—®åˆ°è¿™ä¸ªå€¼ã€‚</li><li><strong>å¼ºåˆ¶ final ä¿è¯ä¸€è‡´æ€§</strong>ï¼šå¦‚æœå…è®¸ä¿®æ”¹åŸå§‹çš„å±€éƒ¨å˜é‡ï¼Œè€ŒåŒ¿åå†…éƒ¨ç±»ä½¿ç”¨çš„æ˜¯å®ƒçš„å‰¯æœ¬ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´åŸå§‹å˜é‡å’Œå‰¯æœ¬ä¹‹é—´çš„æ•°æ®ä¸ä¸€è‡´ã€‚ä¸ºäº†é¿å…è¿™ç§æ··ä¹±ï¼ŒJava å¼ºåˆ¶è¦æ±‚è¢«åŒ¿åå†…éƒ¨ç±»è®¿é—®çš„å±€éƒ¨å˜é‡å¿…é¡»æ˜¯ <code>final</code> çš„ï¼Œä»¥ç¡®ä¿å…¶å€¼ä¸å¯å˜ã€‚<code>final</code> å…³é”®å­—ä¿è¯äº†åŸå§‹å˜é‡å’Œå‰¯æœ¬çš„å€¼å§‹ç»ˆç›¸åŒã€‚</li></ul><h3 id="Java-8-ä¹‹åçš„æ”¹å˜ï¼šâ€œäº‹å®ä¸Šçš„-finalâ€ï¼ˆEffectively-Finalï¼‰"><a href="#Java-8-ä¹‹åçš„æ”¹å˜ï¼šâ€œäº‹å®ä¸Šçš„-finalâ€ï¼ˆEffectively-Finalï¼‰" class="headerlink" title="Java 8 ä¹‹åçš„æ”¹å˜ï¼šâ€œäº‹å®ä¸Šçš„ finalâ€ï¼ˆEffectively Finalï¼‰"></a>Java 8 ä¹‹åçš„æ”¹å˜ï¼šâ€œäº‹å®ä¸Šçš„ <code>final</code>â€ï¼ˆEffectively Finalï¼‰</h3><p>åœ¨ Java 8 ä¹‹åï¼Œä¸ºäº†ç®€åŒ–ä»£ç ï¼Œè¿™ä¸ªè§„åˆ™æœ‰äº†ä¸€äº›æ”¾æ¾ã€‚ä½ ä¸å†éœ€è¦æ˜¾å¼åœ°ä½¿ç”¨ <code>final</code> å…³é”®å­—ã€‚åªè¦ä¸€ä¸ªå±€éƒ¨å˜é‡åœ¨å®šä¹‰å<strong>æ²¡æœ‰è¢«é‡æ–°èµ‹å€¼</strong>ï¼Œå®ƒå°±ä¼šè¢«ç¼–è¯‘å™¨è‡ªåŠ¨è§†ä¸ºâ€œ<strong>äº‹å®ä¸Šçš„ final</strong>â€ã€‚</p><p>è¿™ä½¿å¾—ä»£ç çœ‹èµ·æ¥æ›´ç®€æ´ï¼Œä½†<strong>æœ¬è´¨ä¸Šçš„é™åˆ¶å¹¶æ²¡æœ‰æ”¹å˜</strong>ï¼šåŒ¿åå†…éƒ¨ç±»ä»ç„¶åªèƒ½è®¿é—®é‚£äº›å€¼åœ¨æ–¹æ³•æ‰§è¡ŒæœŸé—´ä¸ä¼šæ”¹å˜çš„å±€éƒ¨å˜é‡ã€‚</p><p><strong>ç¤ºä¾‹ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doSomething</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;Alice&quot;</span>; <span class="comment">// äº‹å®ä¸Šçš„ final</span></span><br><span class="line">    <span class="comment">// name = &quot;Bob&quot;; // å¦‚æœåœ¨è¿™é‡Œé‡æ–°èµ‹å€¼ï¼Œåˆ™ä¼šç¼–è¯‘é”™è¯¯</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="comment">// åŒ¿åå†…éƒ¨ç±»è®¿é—®å±€éƒ¨å˜é‡</span></span><br><span class="line">            System.out.println(<span class="string">&quot;Hello, &quot;</span> + name);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>name</code> å˜é‡æ²¡æœ‰è¢« <code>final</code> ä¿®é¥°ï¼Œä½†åœ¨å®ƒè¢«åŒ¿åå†…éƒ¨ç±»è®¿é—®åæ²¡æœ‰è¢«ä¿®æ”¹ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨ä¼šå°†å…¶è§†ä¸ºäº‹å®ä¸Šçš„ <code>final</code>ï¼Œä»£ç å¯ä»¥æ­£å¸¸ç¼–è¯‘å’Œè¿è¡Œã€‚ä½†å¦‚æœä½ å°è¯•åœ¨ <code>doSomething</code> æ–¹æ³•çš„ <code>new Thread</code> ä¹‹åä¿®æ”¹ <code>name</code>ï¼Œç¼–è¯‘å™¨å°±ä¼šæŠ¥é”™ã€‚</p><hr><h3 id="æ€»ç»“è¡¨æ ¼"><a href="#æ€»ç»“è¡¨æ ¼" class="headerlink" title="æ€»ç»“è¡¨æ ¼"></a>æ€»ç»“è¡¨æ ¼</h3><table><thead><tr><th>ç±»å‹</th><th>å…³é”®å­—</th><th>å®šä¹‰ä½ç½®</th><th>è®¿é—®å¤–éƒ¨ç±»æˆå‘˜</th><th>åˆ›å»ºæ–¹å¼</th></tr></thead><tbody><tr><td><strong>é™æ€æˆå‘˜ç±»</strong></td><td><code>static</code></td><td>åœ¨å¤–éƒ¨ç±»å†…éƒ¨</td><td>åªèƒ½è®¿é—®å¤–éƒ¨ç±»çš„ <strong>é™æ€æˆå‘˜</strong></td><td><code>new Outer.StaticInner();</code></td></tr><tr><td><strong>å†…éƒ¨ç±»</strong></td><td>æ— </td><td>åœ¨å¤–éƒ¨ç±»å†…éƒ¨</td><td>å¯è®¿é—®å¤–éƒ¨ç±»çš„<strong>æ‰€æœ‰æˆå‘˜</strong></td><td><code>new Outer().new Inner();</code></td></tr><tr><td><strong>å±€éƒ¨å†…éƒ¨ç±»</strong></td><td>æ— </td><td>åœ¨æ–¹æ³•æˆ–ä»£ç å—å†…éƒ¨</td><td>å¯è®¿é—®å¤–éƒ¨æˆå‘˜å’Œ <strong>final å±€éƒ¨å˜é‡</strong></td><td>åªèƒ½åœ¨å®šä¹‰å®ƒçš„æ–¹æ³•å†…éƒ¨åˆ›å»º</td></tr><tr><td><strong>åŒ¿åå†…éƒ¨ç±»</strong></td><td>æ— </td><td>åœ¨æ–¹æ³•æˆ–ä»£ç å—å†…éƒ¨</td><td>åŒå±€éƒ¨å†…éƒ¨ç±»</td><td><code>new Interface/Class() &#123; ... &#125;;</code></td></tr></tbody></table><p>åŒ¿åå†…éƒ¨ç±»ã€å‡½æ•°å¼æ¥å£å’Œ Lambda è¡¨è¾¾å¼æ˜¯ Java è¯­è¨€åœ¨ä¸æ–­æ¼”è¿›è¿‡ç¨‹ä¸­ï¼Œä¸ºäº†ç®€åŒ–ä»£ç å’Œæ”¯æŒå‡½æ•°å¼ç¼–ç¨‹è€Œå¼•å…¥çš„é‡è¦ç‰¹æ€§ã€‚å®ƒä»¬ç»å¸¸åœ¨é¢è¯•ä¸­è¢«ä¸€èµ·è€ƒå¯Ÿï¼Œå› ä¸ºå®ƒä»¬ä¹‹é—´å­˜åœ¨æ¼”å˜å’Œæ›¿ä»£çš„å…³ç³»ã€‚</p><hr><h3 id="1-åŒ¿åå†…éƒ¨ç±»-Anonymous-Inner-Class"><a href="#1-åŒ¿åå†…éƒ¨ç±»-Anonymous-Inner-Class" class="headerlink" title="1. åŒ¿åå†…éƒ¨ç±» (Anonymous Inner Class)"></a>1. åŒ¿åå†…éƒ¨ç±» (Anonymous Inner Class)</h3><p><strong>åŒ¿åå†…éƒ¨ç±»</strong>æ˜¯ä¸€ç§æ²¡æœ‰åå­—çš„å±€éƒ¨å†…éƒ¨ç±»ï¼Œé€šå¸¸ç”¨äºåˆ›å»ºä¸€ä¸ªåªä½¿ç”¨ä¸€æ¬¡çš„ç±»çš„å®ä¾‹ã€‚</p><ul><li><strong>æ ¸å¿ƒç‰¹ç‚¹</strong>:<ul><li><strong>æ²¡æœ‰åå­—</strong>: æ— æ³•è¢«å¤ç”¨ã€‚</li><li><strong>åˆ›å»ºæ—¶å®šä¹‰</strong>: å¿…é¡»åœ¨åˆ›å»ºå®ä¾‹çš„åŒæ—¶å®šä¹‰ç±»çš„å®ç°ã€‚</li><li><strong>åªèƒ½å®ç°ä¸€ä¸ª</strong>: å®ƒå¯ä»¥å®ç°ä¸€ä¸ªæ¥å£æˆ–ç»§æ‰¿ä¸€ä¸ªç±»ï¼Œä½†ä¸èƒ½ä¸¤è€…éƒ½åšã€‚</li></ul></li><li><strong>ç”¨é€”</strong>:<ul><li>ä¸»è¦ç”¨äºç®€åŒ–ä»£ç ï¼Œç‰¹åˆ«æ˜¯å½“ä¸€ä¸ªç±»åªè¢«ä½¿ç”¨ä¸€æ¬¡ï¼Œä¸”å…¶å®ç°éå¸¸ç®€å•æ—¶ã€‚</li><li>å¸¸è§çš„åº”ç”¨åœºæ™¯æ˜¯äº‹ä»¶ç›‘å¬å™¨ï¼ˆ<code>ActionListener</code>ï¼‰ã€çº¿ç¨‹ï¼ˆ<code>Runnable</code>ï¼‰ç­‰ã€‚</li></ul></li></ul><p>ç¤ºä¾‹:</p><p>åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œå®ç° Runnable æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello from an anonymous inner class!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">t.start();</span><br></pre></td></tr></table></figure><hr><h3 id="2-å‡½æ•°å¼æ¥å£-Functional-Interface"><a href="#2-å‡½æ•°å¼æ¥å£-Functional-Interface" class="headerlink" title="2. å‡½æ•°å¼æ¥å£ (Functional Interface)"></a>2. å‡½æ•°å¼æ¥å£ (Functional Interface)</h3><p><strong>å‡½æ•°å¼æ¥å£</strong>æ˜¯æŒ‡<strong>åªåŒ…å«ä¸€ä¸ªæŠ½è±¡æ–¹æ³•</strong>çš„æ¥å£ã€‚å®ƒå¯ä»¥åŒ…å«å…¶ä»–é»˜è®¤æ–¹æ³•ï¼ˆ<code>default</code>ï¼‰ã€é™æ€æ–¹æ³•ï¼ˆ<code>static</code>ï¼‰å’Œæ¥è‡ª <code>Object</code> ç±»çš„æ–¹æ³•ï¼ˆå¦‚ <code>equals</code>ï¼‰ã€‚</p><ul><li><strong>æ ¸å¿ƒç‰¹ç‚¹</strong>:<ul><li><strong>ä¸€ä¸ªæŠ½è±¡æ–¹æ³•</strong>: è¿™æ˜¯å‡½æ•°å¼æ¥å£çš„å”¯ä¸€å¼ºåˆ¶è¦æ±‚ã€‚</li><li><strong>@FunctionalInterface æ³¨è§£</strong>: è¿™æ˜¯ä¸€ä¸ªå¯é€‰çš„æ³¨è§£ï¼Œä½†å¼ºçƒˆæ¨èä½¿ç”¨ã€‚å®ƒä¼šå¸®åŠ©ç¼–è¯‘å™¨æ£€æŸ¥è¯¥æ¥å£æ˜¯å¦æ»¡è¶³å‡½æ•°å¼æ¥å£çš„å®šä¹‰ï¼Œå¦‚æœè¿åäº†è§„åˆ™ï¼Œå°±ä¼šæŠ¥é”™ã€‚</li></ul></li></ul><p><strong>ç”¨é€”</strong>:</p><ul><li>å®ƒä¸º Lambda è¡¨è¾¾å¼æä¾›äº†ä¸€ä¸ª<strong>ç›®æ ‡ç±»å‹</strong>ã€‚Lambda è¡¨è¾¾å¼çš„æœ¬è´¨å°±æ˜¯å‡½æ•°å¼æ¥å£çš„ä¸€ä¸ªåŒ¿åå®ç°ã€‚</li><li><code>java.util.function</code> åŒ…ä¸­å®šä¹‰äº†å¤§é‡çš„å‡½æ•°å¼æ¥å£ï¼Œå¦‚ <code>Predicate</code>ã€<code>Consumer</code>ã€<code>Function</code> å’Œ <code>Supplier</code>ï¼Œå®ƒä»¬æ˜¯ Java 8 Stream API çš„åŸºç¡€ã€‚</li></ul><p>ç¤ºä¾‹:</p><p>ä¸€ä¸ªè‡ªå®šä¹‰çš„å‡½æ•°å¼æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">MyFunctionalInterface</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">sayHello</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="3-Lambda-è¡¨è¾¾å¼-Lambda-Expression"><a href="#3-Lambda-è¡¨è¾¾å¼-Lambda-Expression" class="headerlink" title="3. Lambda è¡¨è¾¾å¼ (Lambda Expression)"></a>3. Lambda è¡¨è¾¾å¼ (Lambda Expression)</h3><p><strong>Lambda è¡¨è¾¾å¼</strong>æ˜¯ Java 8 å¼•å…¥çš„ä¸€ä¸ªæ–°ç‰¹æ€§ï¼Œå®ƒæä¾›äº†ä¸€ç§ç®€æ´çš„æ–¹å¼æ¥è¡¨ç¤º<strong>å‡½æ•°å¼æ¥å£çš„å®ç°</strong>ã€‚Lambda è¡¨è¾¾å¼å¯ä»¥è¢«çœ‹ä½œæ˜¯åŒ¿åå†…éƒ¨ç±»çš„<strong>ç®€åŒ–ç‰ˆæœ¬</strong>ï¼Œç”¨äºå®ç°åªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•çš„æ¥å£ã€‚</p><ul><li><strong>è¯­æ³•</strong>: <code>(å‚æ•°åˆ—è¡¨) -&gt; &#123; æ–¹æ³•ä½“ &#125;</code></li><li><strong>æ ¸å¿ƒç‰¹ç‚¹</strong>:<ul><li><strong>ç®€æ´</strong>: æå¤§åœ°å‡å°‘äº†ä»£ç é‡ï¼Œçœå»äº†åŒ¿åå†…éƒ¨ç±»çš„è®¸å¤šæ ·æ¿ä»£ç ã€‚</li><li><strong>å‡½æ•°å¼ç¼–ç¨‹</strong>: ä½¿å¾— Java èƒ½å¤Ÿæ›´æ–¹ä¾¿åœ°æ”¯æŒå‡½æ•°å¼ç¼–ç¨‹èŒƒå¼ï¼Œå¦‚å°†å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’ã€‚</li><li><strong>ç±»å‹æ¨æ–­</strong>: ç¼–è¯‘å™¨å¯ä»¥æ ¹æ®ä¸Šä¸‹æ–‡è‡ªåŠ¨æ¨æ–­å‚æ•°ç±»å‹ã€‚</li></ul></li></ul><p>ç¤ºä¾‹:</p><p>ä½¿ç”¨ Lambda è¡¨è¾¾å¼å®ç°ä¸Šé¢çš„ Runnable æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; System.out.println(<span class="string">&quot;Hello from a Lambda expression!&quot;</span>));</span><br><span class="line">t.start();</span><br></pre></td></tr></table></figure><hr><h3 id="å¸¸è§çš„é¢è¯•é—®é¢˜"><a href="#å¸¸è§çš„é¢è¯•é—®é¢˜" class="headerlink" title="å¸¸è§çš„é¢è¯•é—®é¢˜"></a>å¸¸è§çš„é¢è¯•é—®é¢˜</h3><h4 id="1-åŒ¿åå†…éƒ¨ç±»ã€Lambda-è¡¨è¾¾å¼å’Œå‡½æ•°å¼æ¥å£ä¹‹é—´çš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#1-åŒ¿åå†…éƒ¨ç±»ã€Lambda-è¡¨è¾¾å¼å’Œå‡½æ•°å¼æ¥å£ä¹‹é—´çš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1. åŒ¿åå†…éƒ¨ç±»ã€Lambda è¡¨è¾¾å¼å’Œå‡½æ•°å¼æ¥å£ä¹‹é—´çš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿ"></a>1. åŒ¿åå†…éƒ¨ç±»ã€Lambda è¡¨è¾¾å¼å’Œå‡½æ•°å¼æ¥å£ä¹‹é—´çš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿ</h4><ul><li><strong>æ¼”å˜å…³ç³»</strong>: åŒ¿åå†…éƒ¨ç±»æ˜¯ Java æ—©æœŸç”¨äºå®ç°æ¥å£æˆ–æŠ½è±¡ç±»çš„å•ä¸€æ–¹æ³•çš„ç¬¨é‡æ–¹å¼ã€‚å‡½æ•°å¼æ¥å£çš„å‡ºç°ï¼Œä¸º Lambda è¡¨è¾¾å¼æä¾›äº†ä¸€ä¸ª<strong>ç›®æ ‡ç±»å‹</strong>ã€‚Lambda è¡¨è¾¾å¼å°±æ˜¯å¯¹åªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•çš„åŒ¿åå†…éƒ¨ç±»çš„ä¸€ç§<strong>è¯­æ³•ç³–</strong>ï¼Œå®ƒæå¤§åœ°ç®€åŒ–äº†ä»£ç ã€‚</li><li><strong>æœ¬è´¨</strong>: Lambda è¡¨è¾¾å¼æ˜¯å‡½æ•°å¼æ¥å£çš„ä¸€ä¸ª<strong>åŒ¿åå®ç°</strong>ã€‚</li></ul><h4 id="2-ä¸ºä»€ä¹ˆ-Lambda-è¡¨è¾¾å¼åªèƒ½å®ç°å‡½æ•°å¼æ¥å£ï¼Ÿ"><a href="#2-ä¸ºä»€ä¹ˆ-Lambda-è¡¨è¾¾å¼åªèƒ½å®ç°å‡½æ•°å¼æ¥å£ï¼Ÿ" class="headerlink" title="2. ä¸ºä»€ä¹ˆ Lambda è¡¨è¾¾å¼åªèƒ½å®ç°å‡½æ•°å¼æ¥å£ï¼Ÿ"></a>2. ä¸ºä»€ä¹ˆ Lambda è¡¨è¾¾å¼åªèƒ½å®ç°å‡½æ•°å¼æ¥å£ï¼Ÿ</h4><p>Lambda è¡¨è¾¾å¼çš„è¯­æ³•ï¼ˆ<code>(å‚æ•°) -&gt; &#123;æ–¹æ³•ä½“&#125;</code>ï¼‰æœ¬èº«å°±åªé€‚ç”¨äºå®ç°<strong>ä¸€ä¸ªæ–¹æ³•</strong>ã€‚å¦‚æœä¸€ä¸ªæ¥å£æœ‰ä¸¤ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œç¼–è¯‘å™¨æ— æ³•ç¡®å®š Lambda è¡¨è¾¾å¼çš„ <code>()</code> å’Œ <code>&#123;&#125;</code> å¯¹åº”çš„æ˜¯å“ªä¸ªæ–¹æ³•ï¼Œå› æ­¤ä¼šæŠ¥é”™ã€‚</p><h4 id="3-Lambda-è¡¨è¾¾å¼å’ŒåŒ¿åå†…éƒ¨ç±»åœ¨ä½¿ç”¨-this-å…³é”®å­—æ—¶æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#3-Lambda-è¡¨è¾¾å¼å’ŒåŒ¿åå†…éƒ¨ç±»åœ¨ä½¿ç”¨-this-å…³é”®å­—æ—¶æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="3. Lambda è¡¨è¾¾å¼å’ŒåŒ¿åå†…éƒ¨ç±»åœ¨ä½¿ç”¨ this å…³é”®å­—æ—¶æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>3. Lambda è¡¨è¾¾å¼å’ŒåŒ¿åå†…éƒ¨ç±»åœ¨ä½¿ç”¨ <code>this</code> å…³é”®å­—æ—¶æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h4><ul><li><strong>åŒ¿åå†…éƒ¨ç±»</strong>: åŒ¿åå†…éƒ¨ç±»æœ‰è‡ªå·±çš„ä½œç”¨åŸŸã€‚å®ƒå†…éƒ¨çš„ <code>this</code> å…³é”®å­—æŒ‡å‘çš„æ˜¯<strong>åŒ¿åå†…éƒ¨ç±»è‡ªèº«çš„å®ä¾‹</strong>ã€‚</li><li><strong>Lambda è¡¨è¾¾å¼</strong>: Lambda è¡¨è¾¾å¼æ²¡æœ‰è‡ªå·±çš„ä½œç”¨åŸŸã€‚å®ƒå†…éƒ¨çš„ <code>this</code> å…³é”®å­—æŒ‡å‘çš„æ˜¯<strong>å…¶å®šä¹‰æ‰€åœ¨ç±»çš„å®ä¾‹</strong>ã€‚</li></ul><p><strong>ç¤ºä¾‹</strong>:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">public class OuterClass &#123;</span><br><span class="line">    private String name = &quot;Outer&quot;;</span><br><span class="line"></span><br><span class="line">    public void testLambda() &#123;</span><br><span class="line">        Runnable r = () -&gt; &#123;</span><br><span class="line">            System.out.println(this.name); // è¿™é‡Œçš„ this æŒ‡å‘ OuterClass å®ä¾‹</span><br><span class="line">        &#125;;</span><br><span class="line">        new Thread(r).start();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public void testAnonymous() &#123;</span><br><span class="line">        Runnable r = new Runnable() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void run() &#123;</span><br><span class="line">                // System.out.println(this.name); // ç¼–è¯‘é”™è¯¯ï¼ŒåŒ¿åå†…éƒ¨ç±»æ²¡æœ‰ name å­—æ®µ</span><br><span class="line">                System.out.println(OuterClass.this.name); // å¿…é¡»ç”¨ OuterClass.this</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        new Thread(r).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4-Lambda-è¡¨è¾¾å¼æ•è·çš„å±€éƒ¨å˜é‡ä¸ºä»€ä¹ˆå¿…é¡»æ˜¯-final-çš„ï¼Ÿ"><a href="#4-Lambda-è¡¨è¾¾å¼æ•è·çš„å±€éƒ¨å˜é‡ä¸ºä»€ä¹ˆå¿…é¡»æ˜¯-final-çš„ï¼Ÿ" class="headerlink" title="4. Lambda è¡¨è¾¾å¼æ•è·çš„å±€éƒ¨å˜é‡ä¸ºä»€ä¹ˆå¿…é¡»æ˜¯ final çš„ï¼Ÿ"></a>4. Lambda è¡¨è¾¾å¼æ•è·çš„å±€éƒ¨å˜é‡ä¸ºä»€ä¹ˆå¿…é¡»æ˜¯ <code>final</code> çš„ï¼Ÿ</h4><p>å’ŒåŒ¿åå†…éƒ¨ç±»ä¸€æ ·ï¼ŒLambda è¡¨è¾¾å¼ä¼š<strong>æ•è·</strong>å…¶å¤–éƒ¨ä½œç”¨åŸŸçš„å±€éƒ¨å˜é‡ã€‚è¿™äº›å˜é‡åœ¨ Lambda è¡¨è¾¾å¼çš„ç”Ÿå‘½å‘¨æœŸä¸­æ˜¯ä¸å¯å˜çš„ï¼Œå› ä¸ºå®ƒä»¬è¢«å¤åˆ¶åˆ°äº†å †ä¸­ã€‚åœ¨ Java 8 ä¹‹å‰ï¼Œä½ éœ€è¦æ˜¾å¼åœ°ç”¨ <code>final</code> ä¿®é¥°ï¼›è‡ª Java 8 ä¹‹åï¼Œåªè¦å˜é‡æ²¡æœ‰è¢«é‡æ–°èµ‹å€¼ï¼Œå®ƒå°±æ˜¯**â€œäº‹å®ä¸Šçš„ <code>final</code>â€**ï¼Œå¯ä»¥çœç•¥ <code>final</code> å…³é”®å­—ã€‚</p><h2 id="Lambdaè¡¨è¾¾å¼ï¼š"><a href="#Lambdaè¡¨è¾¾å¼ï¼š" class="headerlink" title="Lambdaè¡¨è¾¾å¼ï¼š"></a>Lambdaè¡¨è¾¾å¼ï¼š</h2><p>Lambda è¡¨è¾¾å¼æ˜¯ Java 8 å¼•å…¥çš„è¯­æ³•ç³–ï¼Œå®ƒè®©ä½ å¯ä»¥ç”¨æ›´ç®€æ´çš„æ–¹å¼å®ç°<strong>å‡½æ•°å¼æ¥å£</strong>ã€‚å®ƒçš„åº•å±‚å®ç°æœºåˆ¶æ¯”ä½ æƒ³è±¡çš„è¦å¤æ‚ï¼Œä½†æ ¸å¿ƒæ€æƒ³æ˜¯åˆ©ç”¨äº†æ–°çš„å­—èŠ‚ç æŒ‡ä»¤å’Œæ–¹æ³•ã€‚</p><hr><h3 id="Lambda-è¡¨è¾¾å¼çš„åº•å±‚å®ç°"><a href="#Lambda-è¡¨è¾¾å¼çš„åº•å±‚å®ç°" class="headerlink" title="Lambda è¡¨è¾¾å¼çš„åº•å±‚å®ç°"></a>Lambda è¡¨è¾¾å¼çš„åº•å±‚å®ç°</h3><p>Lambda è¡¨è¾¾å¼çš„åº•å±‚å®ç°ä¾èµ–äºä¸¤ä¸ªå…³é”®æŠ€æœ¯ï¼š</p><ol><li><strong>invokedynamic æŒ‡ä»¤</strong></li><li><strong>æ–¹æ³•å¥æŸ„ï¼ˆMethod Handleï¼‰</strong></li></ol><p>åœ¨ Java 7 ä¹‹å‰ï¼ŒJVM ä¸­åªæœ‰å››ç§è°ƒç”¨æ–¹æ³•çš„æŒ‡ä»¤ï¼š<code>invokevirtual</code>ã€<code>invokeinterface</code>ã€<code>invokespecial</code> å’Œ <code>invokestatic</code>ã€‚è¿™äº›æŒ‡ä»¤éƒ½æ˜¯<strong>é™æ€</strong>ç»‘å®šçš„ï¼Œæ„å‘³ç€åœ¨ç¼–è¯‘æ—¶å°±ç¡®å®šäº†è°ƒç”¨çš„ç›®æ ‡æ–¹æ³•ã€‚</p><p>ç„¶è€Œï¼ŒLambda è¡¨è¾¾å¼çš„è°ƒç”¨æ˜¯<strong>åŠ¨æ€</strong>çš„ã€‚ç¼–è¯‘å™¨åœ¨å¤„ç† Lambda è¡¨è¾¾å¼æ—¶ï¼Œå¹¶ä¸çŸ¥é“å®ƒä¼šå…·ä½“è°ƒç”¨å“ªä¸ªæ–¹æ³•ã€‚å› æ­¤ï¼ŒJava 7 å¼•å…¥äº† <strong>invokedynamic</strong> æŒ‡ä»¤ï¼Œå®ƒå…è®¸åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°è§£æå’Œç»‘å®šæ–¹æ³•è°ƒç”¨ã€‚</p><hr><h4 id="ç¼–è¯‘æ—¶ï¼šç”Ÿæˆ-invokedynamic-æŒ‡ä»¤"><a href="#ç¼–è¯‘æ—¶ï¼šç”Ÿæˆ-invokedynamic-æŒ‡ä»¤" class="headerlink" title="ç¼–è¯‘æ—¶ï¼šç”Ÿæˆ invokedynamic æŒ‡ä»¤"></a>ç¼–è¯‘æ—¶ï¼šç”Ÿæˆ <code>invokedynamic</code> æŒ‡ä»¤</h4><p>å½“ä½ ç¼–å†™ä¸€ä¸ª Lambda è¡¨è¾¾å¼æ—¶ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Runnable</span> <span class="variable">r</span> <span class="operator">=</span> () -&gt; System.out.println(<span class="string">&quot;Hello&quot;</span>);</span><br></pre></td></tr></table></figure><p>Java ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶å¹¶ä¸ä¼šç›´æ¥ç”Ÿæˆä¸€ä¸ªåŒ¿åå†…éƒ¨ç±»ã€‚ç›¸åï¼Œå®ƒä¼šåšä»¥ä¸‹äº‹æƒ…ï¼š</p><ol><li><strong>å°† Lambda è¡¨è¾¾å¼ä½“è½¬æ¢ä¸ºä¸€ä¸ªç§æœ‰æ–¹æ³•</strong>ï¼šç¼–è¯‘å™¨ä¼šæŠŠ <code>System.out.println(&quot;Hello&quot;)</code> è¿™æ®µä»£ç æå–å‡ºæ¥ï¼Œç”Ÿæˆä¸€ä¸ª<strong>æ–°çš„ç§æœ‰æ–¹æ³•</strong>ï¼Œé€šå¸¸æ˜¯ <code>private static</code> æˆ– <code>private</code> ç±»å‹ï¼Œå¹¶å¸¦æœ‰ç‰¹æ®Šçš„å‘½åè§„åˆ™ï¼ˆæ¯”å¦‚ <code>lambda$main$0</code>ï¼‰ã€‚è¿™ä¸ªæ–°æ–¹æ³•åŒ…å«äº† Lambda è¡¨è¾¾å¼çš„å®é™…é€»è¾‘ã€‚</li><li><strong>ç”Ÿæˆ invokedynamic æŒ‡ä»¤</strong>ï¼šåœ¨ Lambda è¡¨è¾¾å¼å‡ºç°çš„åœ°æ–¹ï¼Œç¼–è¯‘å™¨ä¼šç”Ÿæˆä¸€æ¡ <code>invokedynamic</code> æŒ‡ä»¤ã€‚è¿™æ¡æŒ‡ä»¤ä¸ä¼šç›´æ¥è°ƒç”¨ä¸Šä¸€æ­¥ç”Ÿæˆçš„ç§æœ‰æ–¹æ³•ã€‚ç›¸åï¼Œå®ƒæŒ‡å‘ä¸€ä¸ª<strong>å¼•å¯¼æ–¹æ³•ï¼ˆBootstrap Methodï¼‰</strong>ã€‚</li></ol><p><code>invokedynamic</code> æŒ‡ä»¤çš„ç»“æ„å¤§è‡´å¦‚ä¸‹ï¼š</p><p><code>invokedynamic #0:run:()Ljava/lang/Runnable;</code></p><ul><li><code>#0</code> æ˜¯ä¸€ä¸ªå¸¸é‡æ± ç´¢å¼•ï¼ŒæŒ‡å‘å¼•å¯¼æ–¹æ³•ï¼ˆé€šå¸¸æ˜¯ <code>java.lang.invoke.LambdaMetafactory.metafactory</code>ï¼‰ã€‚</li><li><code>run</code> æ˜¯å‡½æ•°å¼æ¥å£ä¸­æŠ½è±¡æ–¹æ³•çš„åç§°ã€‚</li><li><code>()Ljava/lang/Runnable;</code> æ˜¯å‡½æ•°å¼æ¥å£çš„ç­¾åã€‚</li></ul><h4 id="è¿è¡Œæ—¶ï¼šåŠ¨æ€ç»‘å®š"><a href="#è¿è¡Œæ—¶ï¼šåŠ¨æ€ç»‘å®š" class="headerlink" title="è¿è¡Œæ—¶ï¼šåŠ¨æ€ç»‘å®š"></a>è¿è¡Œæ—¶ï¼šåŠ¨æ€ç»‘å®š</h4><p>å½“ JVM æ‰§è¡Œåˆ° <code>invokedynamic</code> æŒ‡ä»¤æ—¶ï¼Œå®ƒä¼šæ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š</p><ol><li><strong>è°ƒç”¨å¼•å¯¼æ–¹æ³•</strong>ï¼šJVM ä¼šè°ƒç”¨ <code>LambdaMetafactory.metafactory</code> å¼•å¯¼æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•æ˜¯ Lambda è¡¨è¾¾å¼çš„**â€œå·¥å‚â€<strong>ï¼Œå®ƒè´Ÿè´£ç”Ÿæˆä¸€ä¸ª</strong>æ–¹æ³•å¥æŸ„ï¼ˆMethod Handleï¼‰**ã€‚</li><li><strong>ç”Ÿæˆæ–¹æ³•å¥æŸ„</strong>ï¼šæ–¹æ³•å¥æŸ„æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ã€ç±»ä¼¼äº <code>java.lang.reflect.Method</code> çš„å¼•ç”¨ï¼Œä½†å®ƒæ›´é«˜æ•ˆï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨ã€‚å®ƒæŒ‡å‘ç¼–è¯‘æ—¶ç”Ÿæˆçš„é‚£ä¸ªç§æœ‰æ–¹æ³•ï¼ˆå³ Lambda è¡¨è¾¾å¼çš„å®é™…é€»è¾‘ï¼‰ã€‚</li><li><strong>ç”Ÿæˆè°ƒç”¨ç‚¹å¯¹è±¡</strong>ï¼š<code>LambdaMetafactory.metafactory</code> è¿”å›ä¸€ä¸ª**<code>CallSite</code>**å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡æŒæœ‰ä¸€ä¸ªæŒ‡å‘æ–¹æ³•å¥æŸ„çš„å¼•ç”¨ã€‚è¿™ä¸ª <code>CallSite</code> ä¼šè¢«ç¼“å­˜èµ·æ¥ã€‚</li><li><strong>æ‰§è¡Œæ–¹æ³•è°ƒç”¨</strong>ï¼š<code>invokedynamic</code> æŒ‡ä»¤ä¼šç›´æ¥è·³è½¬åˆ° <code>CallSite</code> å¯¹è±¡ä¸­çš„æ–¹æ³•å¥æŸ„ï¼Œç„¶åæ‰§è¡Œå®é™…çš„ Lambda è¡¨è¾¾å¼ä»£ç ã€‚</li></ol><h3 id="Lambda-è¡¨è¾¾å¼ä¸åŒ¿åå†…éƒ¨ç±»çš„åŒºåˆ«"><a href="#Lambda-è¡¨è¾¾å¼ä¸åŒ¿åå†…éƒ¨ç±»çš„åŒºåˆ«" class="headerlink" title="Lambda è¡¨è¾¾å¼ä¸åŒ¿åå†…éƒ¨ç±»çš„åŒºåˆ«"></a>Lambda è¡¨è¾¾å¼ä¸åŒ¿åå†…éƒ¨ç±»çš„åŒºåˆ«</h3><p>ç†è§£åº•å±‚å®ç°åï¼Œä¸¤è€…åœ¨æ€§èƒ½å’Œè®¾è®¡ä¸Šæœ‰ä¸€äº›å…³é”®åŒºåˆ«ï¼š</p><table><thead><tr><th>ç‰¹æ€§</th><th>Lambda è¡¨è¾¾å¼</th><th>åŒ¿åå†…éƒ¨ç±»</th></tr></thead><tbody><tr><td><strong>ç”Ÿæˆæ–¹å¼</strong></td><td>åŠ¨æ€ç”Ÿæˆç§æœ‰æ–¹æ³•å’Œ <code>invokedynamic</code> æŒ‡ä»¤</td><td>ç¼–è¯‘æ—¶ç”Ÿæˆç‹¬ç«‹çš„ <code>.class</code> æ–‡ä»¶</td></tr><tr><td><strong>æ€§èƒ½</strong></td><td>é€šå¸¸æ›´å¿«ã€‚<strong>invokedynamic ä¼˜åŒ–äº†æ€§èƒ½</strong>ï¼Œé¿å…äº†æ¯æ¬¡éƒ½åˆ›å»ºæ–°å¯¹è±¡å’Œæ‰§è¡Œ <code>invokespecial</code> æŒ‡ä»¤ã€‚</td><td>æ¯æ¬¡ä½¿ç”¨éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡å®ä¾‹ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªé¢å¤–çš„ç±»æ–‡ä»¶ã€‚</td></tr><tr><td><strong>ä½œç”¨åŸŸ</strong></td><td>æ²¡æœ‰è‡ªå·±çš„ä½œç”¨åŸŸï¼Œ<code>this</code> å…³é”®å­—æŒ‡å‘å¤–éƒ¨ç±»çš„å®ä¾‹ã€‚</td><td>æœ‰è‡ªå·±çš„ä½œç”¨åŸŸï¼Œ<code>this</code> å…³é”®å­—æŒ‡å‘åŒ¿åå†…éƒ¨ç±»å®ä¾‹æœ¬èº«ã€‚</td></tr><tr><td><strong>å†…å­˜å¼€é”€</strong></td><td><strong>æ›´å°</strong>ã€‚ç”±äºé‡‡ç”¨äº†æ–¹æ³•å¥æŸ„ï¼Œé¿å…äº†ä¸ºæ¯ä¸ª Lambda è¡¨è¾¾å¼åˆ›å»ºç‹¬ç«‹çš„åŒ¿åç±»å¯¹è±¡ã€‚</td><td>ä¼šäº§ç”Ÿé¢å¤–çš„ <code>.class</code> æ–‡ä»¶å’Œå¯¹è±¡å®ä¾‹ï¼Œå†…å­˜å¼€é”€æ›´å¤§ã€‚</td></tr></tbody></table><p>æ€»ç»“æ¥è¯´ï¼ŒLambda è¡¨è¾¾å¼çš„åº•å±‚å®ç°æ˜¯ä¸€ç§<strong>å»¶è¿Ÿåˆ›å»º</strong>å’Œ<strong>åŠ¨æ€ç»‘å®š</strong>çš„æœºåˆ¶ã€‚ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶åªç•™ä¸‹ä¸€ä¸ªè°ƒç”¨æŒ‡ä»¤ï¼Œå°†çœŸæ­£çš„å®ç°å·¥ä½œæ¨è¿Ÿåˆ°è¿è¡Œæ—¶ã€‚è¿™ç§è®¾è®¡ä½¿å¾— Lambda è¡¨è¾¾å¼åœ¨ä¿æŒä»£ç ç®€æ´çš„åŒæ—¶ï¼Œä¹Ÿå¸¦æ¥äº†æ›´é«˜çš„æ€§èƒ½ã€‚</p><h2 id="switchè¯­å¥æ”¯æŒçš„æ•°æ®ç±»å‹ï¼š"><a href="#switchè¯­å¥æ”¯æŒçš„æ•°æ®ç±»å‹ï¼š" class="headerlink" title="switchè¯­å¥æ”¯æŒçš„æ•°æ®ç±»å‹ï¼š"></a>switchè¯­å¥æ”¯æŒçš„æ•°æ®ç±»å‹ï¼š</h2><p><code>switch</code> è¯­å¥æ˜¯ Java ä¸­ä¸€ä¸ªéå¸¸å®ç”¨çš„æ§åˆ¶æµè¯­å¥ï¼Œå®ƒèƒ½å¤Ÿæ ¹æ®å˜é‡çš„å€¼æ¥é€‰æ‹©ä¸åŒçš„æ‰§è¡Œè·¯å¾„ã€‚ä» Java 7 å¼€å§‹ï¼Œ<code>switch</code> è¯­å¥æ”¯æŒçš„æ•°æ®ç±»å‹æœ‰äº†æ˜¾è‘—çš„æ‰©å±•ã€‚</p><p><code>switch</code> è¯­å¥ä½œç”¨çš„æ•°æ®ç±»å‹åŒ…æ‹¬ï¼š</p><hr><h3 id="1-åŸºæœ¬æ•°æ®ç±»å‹"><a href="#1-åŸºæœ¬æ•°æ®ç±»å‹" class="headerlink" title="1. åŸºæœ¬æ•°æ®ç±»å‹"></a><strong>1. åŸºæœ¬æ•°æ®ç±»å‹</strong></h3><ul><li><strong>byte</strong></li><li><strong>short</strong></li><li><strong>char</strong></li><li><strong>int</strong></li></ul><p><strong>æ³¨æ„ï¼š</strong></p><ul><li><code>switch</code> è¯­å¥ä¸æ”¯æŒ <code>long</code>ã€<code>float</code>ã€<code>double</code> æˆ– <code>boolean</code> ç±»å‹ã€‚</li><li>å¦‚æœä½ çš„å˜é‡æ˜¯ <code>long</code> ç±»å‹ï¼Œä½ éœ€è¦å°†å…¶å¼ºåˆ¶è½¬æ¢ä¸º <code>int</code> ç±»å‹æ‰èƒ½åœ¨ <code>switch</code> ä¸­ä½¿ç”¨ï¼Œä½†è¿™å¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±ï¼Œé€šå¸¸ä¸æ¨èã€‚</li></ul><hr><h3 id="2-åŒ…è£…ç±»"><a href="#2-åŒ…è£…ç±»" class="headerlink" title="2. åŒ…è£…ç±»"></a><strong>2. åŒ…è£…ç±»</strong></h3><ul><li><strong>Byte</strong></li><li><strong>Short</strong></li><li><strong>Character</strong></li><li><strong>Integer</strong></li></ul><p>è¿™æ˜¯å› ä¸º Java ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶ä¼šè¿›è¡Œ<strong>è‡ªåŠ¨æ‹†ç®±ï¼ˆautounboxingï¼‰</strong>ï¼Œå°†åŒ…è£…ç±»å¯¹è±¡è‡ªåŠ¨è½¬æ¢ä¸ºå¯¹åº”çš„åŸºæœ¬æ•°æ®ç±»å‹ã€‚</p><hr><h3 id="3-æšä¸¾ç±»å‹-enum"><a href="#3-æšä¸¾ç±»å‹-enum" class="headerlink" title="3. æšä¸¾ç±»å‹ (enum)"></a><strong>3. æšä¸¾ç±»å‹ (enum)</strong></h3><ul><li><strong>ä» Java 5 å¼€å§‹</strong>ï¼Œ<code>switch</code> è¯­å¥å¼€å§‹æ”¯æŒæšä¸¾ç±»å‹ã€‚</li><li>ä½¿ç”¨æšä¸¾å¯ä»¥ä½¿ä»£ç æ›´å…·å¯è¯»æ€§å’Œå®‰å…¨æ€§ï¼Œå› ä¸ºç¼–è¯‘å™¨ä¼šæ£€æŸ¥æ‰€æœ‰ <code>case</code> æ ‡ç­¾æ˜¯å¦å¯¹åº”äº†æšä¸¾ä¸­çš„æœ‰æ•ˆå¸¸é‡ã€‚</li></ul><p><strong>ç¤ºä¾‹ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Day</span> &#123;</span><br><span class="line">    MONDAY, TUESDAY, WEDNESDAY, THURSDAY, FRIDAY, SATURDAY, SUNDAY</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">Day</span> <span class="variable">day</span> <span class="operator">=</span> Day.MONDAY;</span><br><span class="line"><span class="keyword">switch</span> (day) &#123;</span><br><span class="line">    <span class="keyword">case</span> MONDAY:</span><br><span class="line">        System.out.println(<span class="string">&quot;It&#x27;s Monday.&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> SUNDAY:</span><br><span class="line">        System.out.println(<span class="string">&quot;It&#x27;s Sunday.&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        System.out.println(<span class="string">&quot;It&#x27;s a weekday.&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="4-String-ç±»å‹"><a href="#4-String-ç±»å‹" class="headerlink" title="4. String ç±»å‹"></a><strong>4. String ç±»å‹</strong></h3><ul><li><strong>ä» Java 7 å¼€å§‹</strong>ï¼Œ<code>switch</code> è¯­å¥å¼€å§‹æ”¯æŒ <code>String</code> ç±»å‹ã€‚</li><li>è¿™ä¸ªç‰¹æ€§æå¤§åœ°ç®€åŒ–äº†åŸºäºå­—ç¬¦ä¸²çš„æ¡ä»¶åˆ¤æ–­ä»£ç ï¼Œé¿å…äº†å¤§é‡çš„ <code>if-else if-else</code> é“¾ã€‚</li><li>åœ¨åº•å±‚ï¼Œç¼–è¯‘å™¨é€šè¿‡ <code>String</code> å¯¹è±¡çš„ <code>hashCode()</code> å’Œ <code>equals()</code> æ–¹æ³•æ¥æ‰§è¡Œ <code>switch</code> é€»è¾‘ã€‚</li></ul><p><strong>ç¤ºä¾‹ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">fruit</span> <span class="operator">=</span> <span class="string">&quot;apple&quot;</span>;</span><br><span class="line"><span class="keyword">switch</span> (fruit) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;apple&quot;</span>:</span><br><span class="line">        System.out.println(<span class="string">&quot;You chose an apple.&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;orange&quot;</span>:</span><br><span class="line">        System.out.println(<span class="string">&quot;You chose an orange.&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        System.out.println(<span class="string">&quot;Unknown fruit.&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="æ€»ç»“-4"><a href="#æ€»ç»“-4" class="headerlink" title="æ€»ç»“"></a><strong>æ€»ç»“</strong></h3><table><thead><tr><th>æ”¯æŒç±»å‹</th><th>ç‰ˆæœ¬</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td><code>byte</code>, <code>short</code>, <code>char</code>, <code>int</code></td><td>æ‰€æœ‰ç‰ˆæœ¬</td><td><code>switch</code> çš„åŸºç¡€ç±»å‹ã€‚</td></tr><tr><td><code>Byte</code>, <code>Short</code>, <code>Character</code>, <code>Integer</code></td><td>æ‰€æœ‰ç‰ˆæœ¬</td><td>è‡ªåŠ¨æ‹†ç®±æœºåˆ¶ä½¿å…¶å¯ç”¨ã€‚</td></tr><tr><td><code>enum</code></td><td>Java 5+</td><td>å¢å¼ºä»£ç çš„å¯è¯»æ€§å’Œå®‰å…¨æ€§ã€‚</td></tr><tr><td><code>String</code></td><td>Java 7+</td><td>æå¤§åœ°ç®€åŒ–äº†å­—ç¬¦ä¸²åˆ¤æ–­é€»è¾‘ã€‚</td></tr></tbody></table><p>è®°ä½ï¼Œæ— è®ºä½¿ç”¨å“ªç§ç±»å‹ï¼Œ<code>case</code> æ ‡ç­¾åé¢çš„å€¼éƒ½å¿…é¡»æ˜¯<strong>ç¼–è¯‘æ—¶å¸¸é‡</strong>ã€‚</p><h2 id="é”"><a href="#é”" class="headerlink" title="é”"></a>é”</h2><h3 id="1-å†…ç½®é”ï¼šsynchronized-å…³é”®å­—"><a href="#1-å†…ç½®é”ï¼šsynchronized-å…³é”®å­—" class="headerlink" title="1. å†…ç½®é”ï¼šsynchronized å…³é”®å­—"></a>1. å†…ç½®é”ï¼š<code>synchronized</code> å…³é”®å­—</h3><p><code>synchronized</code>æ˜¯Javaè¯­è¨€å±‚é¢çš„åŒæ­¥æœºåˆ¶ï¼Œä½¿ç”¨èµ·æ¥ç›¸å¯¹ç®€å•ã€‚å®ƒå¯ä»¥ä¿®é¥°æ–¹æ³•æˆ–ä»£ç å—ï¼Œç”±JVMè´Ÿè´£åŠ é”å’Œé‡Šæ”¾é”ï¼Œå¼€å‘è€…ä¸éœ€è¦æ‰‹åŠ¨ç®¡ç†ã€‚</p><ul><li><strong>åŒæ­¥æ–¹æ³•ï¼š</strong> å½“ä½ ç”¨<code>synchronized</code>ä¿®é¥°ä¸€ä¸ªéé™æ€æ–¹æ³•æ—¶ï¼Œé”å¯¹è±¡æ˜¯è¿™ä¸ªæ–¹æ³•çš„å®ä¾‹å¯¹è±¡ï¼ˆ<code>this</code>ï¼‰ã€‚å½“ä¸€ä¸ªçº¿ç¨‹è¿›å…¥è¿™ä¸ªåŒæ­¥æ–¹æ³•æ—¶ï¼Œå®ƒä¼šè·å¾—è¯¥å®ä¾‹çš„é”ï¼Œå…¶ä»–çº¿ç¨‹å°±æ— æ³•è¿›å…¥è¿™ä¸ªå®ä¾‹çš„ä»»ä½•åŒæ­¥æ–¹æ³•ï¼Œç›´åˆ°å®ƒé‡Šæ”¾é”ã€‚</li><li><strong>åŒæ­¥é™æ€æ–¹æ³•ï¼š</strong> å½“<code>synchronized</code>ä¿®é¥°ä¸€ä¸ªé™æ€æ–¹æ³•æ—¶ï¼Œé”å¯¹è±¡æ˜¯è¯¥ç±»çš„<code>Class</code>å¯¹è±¡ã€‚è¿™æ„å‘³ç€æ‰€æœ‰çº¿ç¨‹åœ¨è®¿é—®è¿™ä¸ªç±»çš„ä»»ä½•åŒæ­¥é™æ€æ–¹æ³•æ—¶éƒ½ä¼šäº‰æŠ¢åŒä¸€æŠŠé”ï¼Œæ— è®ºæœ‰å¤šå°‘ä¸ªå®ä¾‹ã€‚</li><li><strong>åŒæ­¥ä»£ç å—ï¼š</strong> <code>synchronized (object)</code>ã€‚è¿™æ˜¯æœ€çµæ´»çš„ä½¿ç”¨æ–¹å¼ï¼Œä½ å¯ä»¥æŒ‡å®šä»»ä½•å¯¹è±¡ä½œä¸ºé”ã€‚é€šè¿‡ç¼©å°åŒæ­¥èŒƒå›´ï¼Œå¯ä»¥å‡å°‘é”çš„æŒæœ‰æ—¶é—´ï¼Œä»è€Œæé«˜ç¨‹åºçš„å¹¶å‘æ€§èƒ½ã€‚</li></ul><p><strong>synchronizedçš„ç‰¹ç‚¹ï¼š</strong></p><ul><li><strong>å¯é‡å…¥æ€§ï¼ˆReentrantï¼‰ï¼š</strong> ä¸€ä¸ªçº¿ç¨‹å¯ä»¥é‡å¤è·å–å®ƒå·²ç»æŒæœ‰çš„é”ï¼Œé¿å…æ­»é”ã€‚</li><li><strong>éå…¬å¹³æ€§ï¼ˆUnfairï¼‰ï¼š</strong> é»˜è®¤æƒ…å†µä¸‹ï¼Œçº¿ç¨‹è·å–é”çš„é¡ºåºæ˜¯ä¸ç¡®å®šçš„ï¼Œå…ˆæ¥çš„ä¸ä¸€å®šå…ˆå¾—åˆ°ã€‚</li><li><strong>é”çš„å‡çº§ï¼š</strong> ä¸ºäº†ä¼˜åŒ–æ€§èƒ½ï¼Œ<code>synchronized</code>é”çš„å®ç°ç»å†äº†ä»<strong>åå‘é”</strong>ã€<strong>è½»é‡çº§é”</strong>åˆ°<strong>é‡é‡çº§é”</strong>çš„å‡çº§è¿‡ç¨‹ã€‚è¿™ä½¿å¾—åœ¨ç«äº‰ä¸æ¿€çƒˆçš„æƒ…å†µä¸‹ï¼ŒåŠ é”çš„å¼€é”€éå¸¸å°ã€‚</li><li><strong>å†…å­˜å¯è§æ€§ï¼ˆVisibilityï¼‰ï¼š</strong> <code>synchronized</code>å¯ä»¥ä¿è¯å½“ä¸€ä¸ªçº¿ç¨‹é‡Šæ”¾é”æ—¶ï¼Œå®ƒå¯¹å…±äº«å˜é‡æ‰€åšçš„ä¿®æ”¹ä¼šç«‹å³åˆ·æ–°åˆ°ä¸»å†…å­˜ï¼Œè€Œå½“å¦ä¸€ä¸ªçº¿ç¨‹è·å–é”æ—¶ï¼Œå®ƒä¼šä»ä¸»å†…å­˜ä¸­è¯»å–æœ€æ–°çš„å˜é‡å€¼ã€‚è¿™æ˜¯ç”±Javaå†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰çš„<code>happens-before</code>è§„åˆ™ä¿è¯çš„ã€‚</li></ul><h3 id="åº•å±‚å®ç°æœºåˆ¶"><a href="#åº•å±‚å®ç°æœºåˆ¶" class="headerlink" title="åº•å±‚å®ç°æœºåˆ¶"></a>åº•å±‚å®ç°æœºåˆ¶</h3><p>synchronizedæœ¬è´¨ä¸Šæ˜¯åŸºäºJVMçš„**å†…ç½®é”ï¼ˆIntrinsic Lockï¼‰**å®ç°çš„ã€‚æ¯ä¸ªJavaå¯¹è±¡éƒ½å¤©ç”Ÿå…·å¤‡ä¸€ä¸ªç›‘è§†å™¨é”ï¼ˆMonitorï¼‰ï¼Œè¿™æ˜¯JVMçº§åˆ«çš„åŸç”Ÿæ”¯æŒã€‚</p><p><strong>ç›‘è§†å™¨çš„å·¥ä½œåŸç†ï¼š</strong></p><ul><li>å½“çº¿ç¨‹è¿›å…¥synchronizedä»£ç å—æ—¶ï¼Œä¼šæ‰§è¡ŒmonitorenteræŒ‡ä»¤è·å–å¯¹è±¡çš„ç›‘è§†å™¨</li><li>å½“çº¿ç¨‹é€€å‡ºæ—¶ï¼Œæ‰§è¡ŒmonitorexitæŒ‡ä»¤é‡Šæ”¾ç›‘è§†å™¨</li><li>å¦‚æœè·å–å¤±è´¥ï¼Œçº¿ç¨‹ä¼šè¢«é˜»å¡åœ¨æ“ä½œç³»ç»Ÿçº§åˆ«</li></ul><h3 id="é”å‡çº§çš„æ¼”è¿›è¿‡ç¨‹"><a href="#é”å‡çº§çš„æ¼”è¿›è¿‡ç¨‹" class="headerlink" title="é”å‡çº§çš„æ¼”è¿›è¿‡ç¨‹"></a>é”å‡çº§çš„æ¼”è¿›è¿‡ç¨‹</h3><p>synchronizedçš„æ€§èƒ½ä¼˜åŒ–ç»å†äº†ä¸€ä¸ªå¤æ‚çš„æ¼”è¿›è¿‡ç¨‹ï¼Œä»æœ€åˆçš„é‡é‡çº§é”é€æ­¥ä¼˜åŒ–ï¼š</p><p><strong>åå‘é”é˜¶æ®µï¼š</strong><br>å½“åªæœ‰ä¸€ä¸ªçº¿ç¨‹åå¤è¿›å…¥åŒæ­¥å—æ—¶ï¼ŒJVMä¼šå°†é”åå‘äºè¿™ä¸ªçº¿ç¨‹ã€‚æ­¤æ—¶çš„å¼€é”€æä½ï¼Œå‡ ä¹ç­‰åŒäºæ— é”æ“ä½œã€‚å¯¹è±¡å¤´ä¸­ä¼šè®°å½•åå‘çš„çº¿ç¨‹IDï¼Œåç»­è¯¥çº¿ç¨‹è¿›å…¥æ—¶ç›´æ¥é€šè¿‡ç®€å•çš„æ¯”è¾ƒå°±èƒ½è·å–é”ã€‚</p><p><strong>è½»é‡çº§é”é˜¶æ®µï¼š</strong><br>å½“æœ‰å…¶ä»–çº¿ç¨‹å¼€å§‹ç«äº‰æ—¶ï¼Œåå‘é”ä¼šå‡çº§ä¸ºè½»é‡çº§é”ã€‚JVMåœ¨å½“å‰çº¿ç¨‹çš„æ ˆå¸§ä¸­åˆ›å»ºé”è®°å½•ï¼ˆLock Recordï¼‰ï¼Œé€šè¿‡CASæ“ä½œå°è¯•å°†å¯¹è±¡å¤´çš„Mark Wordæ›¿æ¢ä¸ºæŒ‡å‘é”è®°å½•çš„æŒ‡é’ˆã€‚è¿™ä¸ªè¿‡ç¨‹é¿å…äº†æ“ä½œç³»ç»Ÿå±‚é¢çš„é˜»å¡ã€‚</p><p><strong>é‡é‡çº§é”é˜¶æ®µï¼š</strong><br>å½“CASæ“ä½œå¤±è´¥æ¬¡æ•°è¿‡å¤šæˆ–è€…æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶ç«äº‰æ—¶ï¼Œé”ä¼šè†¨èƒ€ä¸ºé‡é‡çº§é”ã€‚æ­¤æ—¶ä¼šåˆ›å»ºMonitorå¯¹è±¡ï¼Œåˆ©ç”¨æ“ä½œç³»ç»Ÿçš„äº’æ–¥é‡ï¼ˆMutexï¼‰æ¥å®ç°åŒæ­¥ï¼Œæ¶‰åŠç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„åˆ‡æ¢ã€‚</p><p>å¥½çš„ï¼Œæˆ‘å¸®ä½ æŠŠ <strong>JVM é”å‡çº§è¿‡ç¨‹</strong> ä¼˜åŒ–æ’ç‰ˆï¼Œæ•´ç†æˆæ¡ç†æ¸…æ™°ã€æ˜“äºç†è§£çš„ç‰ˆæœ¬ï¼Œå¹¶åŠ ä¸Šä¸€äº›æ³¨é‡Šè¯´æ˜ï¼Œè®©æ•´ä¸ªæµç¨‹æ›´ç›´è§‚ã€‚</p><hr><h1 id="JVM-é”çš„å‡çº§è¿‡ç¨‹"><a href="#JVM-é”çš„å‡çº§è¿‡ç¨‹" class="headerlink" title="JVM é”çš„å‡çº§è¿‡ç¨‹"></a>JVM é”çš„å‡çº§è¿‡ç¨‹</h1><p>JVM çš„å¯¹è±¡é”åœ¨å¤šçº¿ç¨‹è®¿é—®æ—¶ä¼šç»å† <strong>åå‘é” â†’ è½»é‡çº§é” â†’ é‡é‡çº§é”</strong> çš„å‡çº§è¿‡ç¨‹ã€‚ä¸‹é¢è¯¦ç»†è¯´æ˜æ¯ä¸€æ­¥ã€‚</p><hr><h2 id="1-æ™®é€šå¯¹è±¡ï¼ˆæ— é”çŠ¶æ€ï¼‰"><a href="#1-æ™®é€šå¯¹è±¡ï¼ˆæ— é”çŠ¶æ€ï¼‰" class="headerlink" title="1. æ™®é€šå¯¹è±¡ï¼ˆæ— é”çŠ¶æ€ï¼‰"></a>1. æ™®é€šå¯¹è±¡ï¼ˆæ— é”çŠ¶æ€ï¼‰</h2><ul><li>å¯¹è±¡æœªè¢«ä»»ä½•çº¿ç¨‹æŒæœ‰é”æ—¶ï¼š<ul><li>Mark Word ä¸­è®°å½• <strong>å¯¹è±¡çš„ HashCode</strong>ã€‚</li><li>é”æ ‡å¿—ä½ï¼š<code>01</code>ï¼ˆè¡¨ç¤ºæ— é”ï¼‰ã€‚</li><li>æ˜¯å¦åå‘é”ä½ï¼š<code>0</code>ã€‚</li></ul></li></ul><blockquote><p>æ­¤æ—¶å¯¹è±¡åªæ˜¯æ™®é€šå¯¹è±¡ï¼Œæ²¡æœ‰åŒæ­¥é”ã€‚</p></blockquote><hr><h2 id="2-åå‘é”åˆå§‹åŒ–ï¼ˆç¬¬ä¸€æ¬¡åŠ é”ï¼‰"><a href="#2-åå‘é”åˆå§‹åŒ–ï¼ˆç¬¬ä¸€æ¬¡åŠ é”ï¼‰" class="headerlink" title="2. åå‘é”åˆå§‹åŒ–ï¼ˆç¬¬ä¸€æ¬¡åŠ é”ï¼‰"></a>2. åå‘é”åˆå§‹åŒ–ï¼ˆç¬¬ä¸€æ¬¡åŠ é”ï¼‰</h2><ul><li>çº¿ç¨‹ <strong>A</strong> è·å–é”ï¼š<ul><li>é”æ ‡å¿—ä½ä»ä¸º <code>01</code>ï¼ˆæ— é”æ ‡å¿—ï¼‰ã€‚</li><li>åå‘é”æ ‡å¿—ä½æ”¹ä¸º <code>1</code>ï¼Œè¡¨ç¤ºå¯¹è±¡è¿›å…¥ <strong>åå‘é”çŠ¶æ€</strong>ã€‚</li><li>Mark Word çš„å‰ 23 bit ä¿å­˜ <strong>çº¿ç¨‹ A çš„çº¿ç¨‹ ID</strong>ã€‚</li></ul></li></ul><blockquote><p>åå‘é”ç”¨äºä¼˜åŒ–å•çº¿ç¨‹è®¿é—®é”çš„æ€§èƒ½ï¼Œå‡å°‘åŒæ­¥å¼€é”€ã€‚</p></blockquote><hr><h2 id="3-åå‘é”é‡å…¥ï¼ˆçº¿ç¨‹-A-å†æ¬¡è·å–é”ï¼‰"><a href="#3-åå‘é”é‡å…¥ï¼ˆçº¿ç¨‹-A-å†æ¬¡è·å–é”ï¼‰" class="headerlink" title="3. åå‘é”é‡å…¥ï¼ˆçº¿ç¨‹ A å†æ¬¡è·å–é”ï¼‰"></a>3. åå‘é”é‡å…¥ï¼ˆçº¿ç¨‹ A å†æ¬¡è·å–é”ï¼‰</h2><ul><li>çº¿ç¨‹ <strong>A</strong> å†æ¬¡å°è¯•è·å–é”ï¼š<ul><li>JVM æ£€æŸ¥å¯¹è±¡æ ‡å¿—ä½ï¼š<ul><li>é”æ ‡å¿—ä½ <code>01</code></li><li>åå‘é”ä½ <code>1</code></li><li>Mark Word ä¸­çº¿ç¨‹ ID &#x3D; A çš„ ID</li></ul></li><li>ç”±äºçº¿ç¨‹ A å·²æŒæœ‰åå‘é”ï¼Œç›´æ¥è¿›å…¥åŒæ­¥ä»£ç ï¼Œæ— éœ€ CAS æ“ä½œã€‚</li></ul></li></ul><blockquote><p>åå‘é”å…è®¸çº¿ç¨‹é‡å¤è·å–é”ï¼Œæ€§èƒ½å¼€é”€æä½ã€‚</p></blockquote><hr><h2 id="4-åå‘é”ç«äº‰ï¼ˆçº¿ç¨‹-B-å°è¯•è·å–é”ï¼‰"><a href="#4-åå‘é”ç«äº‰ï¼ˆçº¿ç¨‹-B-å°è¯•è·å–é”ï¼‰" class="headerlink" title="4. åå‘é”ç«äº‰ï¼ˆçº¿ç¨‹ B å°è¯•è·å–é”ï¼‰"></a>4. åå‘é”ç«äº‰ï¼ˆçº¿ç¨‹ B å°è¯•è·å–é”ï¼‰</h2><ul><li>çº¿ç¨‹ <strong>B</strong> å°è¯•è·å–é”ï¼š<ul><li>JVM æ£€æŸ¥å¯¹è±¡åå‘é”ï¼š<ul><li>é”æ ‡å¿—ä½ <code>01</code></li><li>åå‘é”ä½ <code>1</code></li><li>Mark Word ä¸­çº¿ç¨‹ ID â‰  B</li></ul></li><li>çº¿ç¨‹ B <strong>å°è¯•é€šè¿‡ CAS æŠ¢é”</strong>ï¼š<ul><li>æˆåŠŸï¼šåå‘é”åˆ‡æ¢åˆ°çº¿ç¨‹ Bï¼ŒMark Word æ›´æ–°ä¸º B çš„çº¿ç¨‹ ID</li><li>å¤±è´¥ï¼šè¡¨ç¤ºç«äº‰å­˜åœ¨ï¼Œè¿›å…¥ä¸‹ä¸€æ­¥å‡çº§è½»é‡çº§é”</li></ul></li></ul></li></ul><blockquote><p>åå‘é”ç«äº‰å¤±è´¥æ—¶ï¼Œè¯´æ˜é”å¼€å§‹æœ‰å¤šçº¿ç¨‹è®¿é—®ï¼Œéœ€è¦å‡çº§é”çŠ¶æ€ã€‚</p></blockquote><hr><h2 id="5-è½»é‡çº§é”ï¼ˆLightweight-Lockï¼‰"><a href="#5-è½»é‡çº§é”ï¼ˆLightweight-Lockï¼‰" class="headerlink" title="5. è½»é‡çº§é”ï¼ˆLightweight Lockï¼‰"></a>5. è½»é‡çº§é”ï¼ˆLightweight Lockï¼‰</h2><ul><li>JVM ä¸ºå½“å‰çº¿ç¨‹åœ¨ <strong>æ ˆå¸§</strong>ä¸­åˆ†é…ä¸€å—ç©ºé—´ï¼Œç§°ä¸º <strong>é”è®°å½•åŒºï¼ˆLock Recordï¼‰</strong>ï¼š<ul><li>ä¿å­˜æŒ‡å‘å¯¹è±¡ Mark Word çš„æŒ‡é’ˆ</li></ul></li><li>å¯¹è±¡ Mark Word ä¿å­˜æŒ‡å‘é”è®°å½•åŒºçš„æŒ‡é’ˆ</li><li>CAS æ“ä½œåŒæ—¶æ›´æ–°ä¸¤å¤„æŒ‡é’ˆï¼š<ul><li>æˆåŠŸï¼šçº¿ç¨‹è·å¾—è½»é‡çº§é”ï¼Œæ‰§è¡ŒåŒæ­¥ä»£ç ï¼Œé”æ ‡å¿—ä½æ”¹ä¸º <code>00</code>ï¼ˆè½»é‡çº§é”çŠ¶æ€ï¼‰</li><li>å¤±è´¥ï¼šç«äº‰æ¿€çƒˆï¼Œè¿›å…¥è‡ªæ—‹é˜¶æ®µ</li></ul></li></ul><blockquote><p>è½»é‡çº§é”é€‚åˆ <strong>å¤šçº¿ç¨‹å°‘é‡ç«äº‰</strong> åœºæ™¯ï¼Œæ€§èƒ½è¾ƒå¥½ã€‚</p></blockquote><hr><h2 id="6-è‡ªæ—‹é”ï¼ˆSpin-Lockï¼‰"><a href="#6-è‡ªæ—‹é”ï¼ˆSpin-Lockï¼‰" class="headerlink" title="6. è‡ªæ—‹é”ï¼ˆSpin Lockï¼‰"></a>6. è‡ªæ—‹é”ï¼ˆSpin Lockï¼‰</h2><ul><li>çº¿ç¨‹å°è¯•è·å–è½»é‡çº§é”å¤±è´¥ï¼š<ul><li>JVM <strong>è‡ªæ—‹é‡è¯•</strong>ï¼ˆå¾ªç¯å°è¯•æŠ¢é”ï¼‰</li><li>è‡ªæ—‹æ¬¡æ•°ç”± JVM å†³å®šï¼ˆJDK 1.7 é»˜è®¤å¯ç”¨ï¼‰</li><li>æˆåŠŸï¼šæ‰§è¡ŒåŒæ­¥ä»£ç </li><li>å¤±è´¥ï¼šé”å‡çº§ä¸ºé‡é‡çº§é”</li></ul></li></ul><blockquote><p>è‡ªæ—‹é”é€‚åˆé”ç«äº‰çŸ­æš‚çš„æƒ…å†µï¼Œé¿å…çº¿ç¨‹é˜»å¡å¸¦æ¥çš„å¼€é”€ã€‚</p></blockquote><hr><h2 id="7-é‡é‡çº§é”ï¼ˆHeavyweight-Lockï¼‰"><a href="#7-é‡é‡çº§é”ï¼ˆHeavyweight-Lockï¼‰" class="headerlink" title="7. é‡é‡çº§é”ï¼ˆHeavyweight Lockï¼‰"></a>7. é‡é‡çº§é”ï¼ˆHeavyweight Lockï¼‰</h2><ul><li>è‡ªæ—‹å¤±è´¥åï¼Œé”å‡çº§ä¸º <strong>é‡é‡çº§é”</strong>ï¼š<ul><li>é”æ ‡å¿—ä½æ”¹ä¸º <code>10</code></li><li>çº¿ç¨‹æœªæŠ¢åˆ°é”çš„ä¼šè¢«é˜»å¡ï¼ˆæŒ‚èµ·ï¼‰</li><li>ç³»ç»Ÿçº¿ç¨‹è°ƒåº¦è´Ÿè´£å”¤é†’ç­‰å¾…çº¿ç¨‹</li></ul></li></ul><blockquote><p>é‡é‡çº§é”æ€§èƒ½å¼€é”€è¾ƒå¤§ï¼Œä½¿ç”¨æ“ä½œç³»ç»Ÿäº’æ–¥æœºåˆ¶ã€‚<br> åªæœ‰å½“è½»é‡çº§é”å’Œè‡ªæ—‹é”éƒ½æ— æ³•æ»¡è¶³éœ€æ±‚æ—¶æ‰ä¼šå‡çº§ã€‚</p></blockquote><hr><h2 id="ğŸ”‘-æ€»ç»“é”å‡çº§è¿‡ç¨‹"><a href="#ğŸ”‘-æ€»ç»“é”å‡çº§è¿‡ç¨‹" class="headerlink" title="ğŸ”‘ æ€»ç»“é”å‡çº§è¿‡ç¨‹"></a>ğŸ”‘ æ€»ç»“é”å‡çº§è¿‡ç¨‹</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">æ— é”çŠ¶æ€ï¼ˆ01 + åå‘ä½0ï¼‰</span><br><span class="line">       â”‚</span><br><span class="line">       â–¼</span><br><span class="line">åå‘é”ï¼ˆ01 + åå‘ä½1 + çº¿ç¨‹IDï¼‰</span><br><span class="line">       â”‚</span><br><span class="line">       â–¼   çº¿ç¨‹ç«äº‰</span><br><span class="line">è½»é‡çº§é”ï¼ˆ00 + æŒ‡å‘æ ˆå¸§é”è®°å½•åŒºï¼‰</span><br><span class="line">       â”‚</span><br><span class="line">       â–¼   CAS å¤±è´¥ / é«˜ç«äº‰</span><br><span class="line">è‡ªæ—‹é”ï¼ˆä¸æ–­è‡ªæ—‹å°è¯•æŠ¢é”ï¼‰</span><br><span class="line">       â”‚</span><br><span class="line">       â–¼   è‡ªæ—‹å¤±è´¥</span><br><span class="line">é‡é‡çº§é”ï¼ˆ10 + é˜»å¡ç­‰å¾…ï¼‰</span><br></pre></td></tr></table></figure><blockquote><p>JVM é€šè¿‡ <strong>é”è†¨èƒ€æœºåˆ¶</strong>ï¼ˆLock Inflationï¼‰é€æ­¥å‡çº§é”ï¼Œå°½é‡åœ¨å¤šçº¿ç¨‹äº‰ç”¨æƒ…å†µä¸‹ä¿è¯æ€§èƒ½ã€‚</p></blockquote><h3 id="è‡ªåŠ¨åŒ–çš„ç‰¹ç‚¹"><a href="#è‡ªåŠ¨åŒ–çš„ç‰¹ç‚¹" class="headerlink" title="è‡ªåŠ¨åŒ–çš„ç‰¹ç‚¹"></a>è‡ªåŠ¨åŒ–çš„ç‰¹ç‚¹</h3><p>synchronizedçš„æœ€å¤§ç‰¹ç‚¹æ˜¯<strong>å®Œå…¨è‡ªåŠ¨åŒ–</strong>ã€‚ç¨‹åºå‘˜æ— éœ€å…³å¿ƒé”çš„è·å–å’Œé‡Šæ”¾æ—¶æœºï¼ŒJVMä¼šè‡ªåŠ¨å¤„ç†æ‰€æœ‰ç»†èŠ‚ã€‚å³ä½¿åœ¨å¼‚å¸¸æƒ…å†µä¸‹ï¼ŒJVMä¹Ÿèƒ½ä¿è¯é”çš„æ­£ç¡®é‡Šæ”¾ï¼Œè¿™å¤§å¤§é™ä½äº†æ­»é”å’Œèµ„æºæ³„éœ²çš„é£é™©ã€‚</p><h3 id="2-æ˜¾å¼é”ï¼šjava-util-concurrent-locks-Lock"><a href="#2-æ˜¾å¼é”ï¼šjava-util-concurrent-locks-Lock" class="headerlink" title="2. æ˜¾å¼é”ï¼šjava.util.concurrent.locks.Lock"></a>2. æ˜¾å¼é”ï¼š<code>java.util.concurrent.locks.Lock</code></h3><p>ä»JDK 1.5å¼€å§‹ï¼Œ<code>java.util.concurrent.locks</code>åŒ…æä¾›äº†æ›´çµæ´»ã€æ›´å¼ºå¤§çš„é”æœºåˆ¶ï¼Œå…¶æ ¸å¿ƒæ˜¯<code>Lock</code>æ¥å£ã€‚æœ€å¸¸ç”¨çš„å®ç°ç±»æ˜¯**<code>ReentrantLock</code>**ã€‚</p><p>ä½¿ç”¨<code>Lock</code>éœ€è¦æ‰‹åŠ¨è¿›è¡ŒåŠ é”å’Œè§£é”æ“ä½œï¼Œé€šå¸¸æ˜¯åœ¨<code>try...finally</code>å—ä¸­è¿›è¡Œï¼Œä»¥ç¡®ä¿é”åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½èƒ½è¢«é‡Šæ”¾ï¼Œé˜²æ­¢æ­»é”ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">lock.lock();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// è®¿é—®å…±äº«èµ„æºçš„ä»£ç </span></span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    lock.unlock();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Lockç›¸æ¯”synchronizedçš„ä¼˜åŠ¿ï¼š</strong></p><ul><li><strong>ä¸­æ–­é”ï¼ˆInterruptiblyï¼‰ï¼š</strong> <code>Lock</code>æä¾›äº†<code>lockInterruptibly()</code>æ–¹æ³•ï¼Œå…è®¸åœ¨ç­‰å¾…é”çš„è¿‡ç¨‹ä¸­å“åº”ä¸­æ–­ã€‚è€Œ<code>synchronized</code>çš„çº¿ç¨‹å¦‚æœé™·å…¥ç­‰å¾…é”çš„çŠ¶æ€ï¼Œæ˜¯æ— æ³•è¢«ä¸­æ–­çš„ã€‚</li><li><strong>å°è¯•è·å–é”ï¼ˆtryLockï¼‰ï¼š</strong> <code>Lock</code>æä¾›äº†<code>tryLock()</code>å’Œ<code>tryLock(long timeout, TimeUnit unit)</code>æ–¹æ³•ï¼Œå¯ä»¥å°è¯•è·å–é”ï¼Œå¦‚æœå¤±è´¥åˆ™ç«‹å³è¿”å›æˆ–åœ¨æŒ‡å®šæ—¶é—´å†…æ”¾å¼ƒï¼Œé¿å…æ— é™ç­‰å¾…ã€‚</li><li><strong>å…¬å¹³é”ä¸éå…¬å¹³é”ï¼š</strong> <code>ReentrantLock</code>å¯ä»¥åˆ›å»ºå…¬å¹³é”ï¼ˆFair Lockï¼‰ã€‚å…¬å¹³é”ä¼šæŒ‰ç…§çº¿ç¨‹è¯·æ±‚é”çš„é¡ºåºæ¥åˆ†é…é”ï¼Œè™½ç„¶è¿™å¯èƒ½ä¼šå¸¦æ¥ä¸€äº›æ€§èƒ½å¼€é”€ã€‚è€Œ<code>synchronized</code>åªèƒ½æ˜¯éå…¬å¹³é”ã€‚</li><li><strong>ç»‘å®šå¤šä¸ªæ¡ä»¶ï¼ˆConditionï¼‰ï¼š</strong> <code>Lock</code>é…åˆ<code>Condition</code>æ¥å£ï¼Œå¯ä»¥å®ç°æ›´çµæ´»çš„çº¿ç¨‹ç­‰å¾…å’Œå”¤é†’æœºåˆ¶ï¼Œç±»ä¼¼<code>Object</code>çš„<code>wait()</code>å’Œ<code>notify()</code>ï¼Œä½†åŠŸèƒ½æ›´å¼ºå¤§ï¼Œä¸€ä¸ªé”å¯ä»¥æœ‰å¤šä¸ªç­‰å¾…é˜Ÿåˆ—ã€‚</li><li><strong>è¯»å†™é”ï¼ˆReadWriteLockï¼‰ï¼š</strong> <code>ReadWriteLock</code>æ˜¯<code>Lock</code>çš„å¦ä¸€ä¸ªé‡è¦å®ç°ï¼Œå®ƒç»´æŠ¤äº†ä¸€å¯¹é”ï¼šä¸€ä¸ªç”¨äºè¯»æ“ä½œï¼Œä¸€ä¸ªç”¨äºå†™æ“ä½œã€‚åœ¨è¯»å¤šå†™å°‘çš„åœºæ™¯ä¸‹ï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è·å–è¯»é”ï¼Œå¤§å¤§æé«˜äº†å¹¶å‘æ€§èƒ½ï¼Œåªæœ‰å†™æ“ä½œæ‰éœ€è¦è·å–ç‹¬å çš„å†™é”ã€‚<code>ReentrantReadWriteLock</code>æ˜¯å…¶å…·ä½“å®ç°ã€‚</li></ul><h3 id="Lockæ¥å£çš„è®¾è®¡ç†å¿µ"><a href="#Lockæ¥å£çš„è®¾è®¡ç†å¿µ" class="headerlink" title="Lockæ¥å£çš„è®¾è®¡ç†å¿µ"></a>Lockæ¥å£çš„è®¾è®¡ç†å¿µ</h3><h3 id="æ˜¾å¼é”æœºåˆ¶"><a href="#æ˜¾å¼é”æœºåˆ¶" class="headerlink" title="æ˜¾å¼é”æœºåˆ¶"></a>æ˜¾å¼é”æœºåˆ¶</h3><p>Lockæ¥å£ä»£è¡¨äº†Javaå¹¶å‘åŒ…ä¸­<strong>æ˜¾å¼é”</strong>çš„è®¾è®¡æ€æƒ³ã€‚ä¸synchronizedçš„éšå¼é”ä¸åŒï¼ŒLockè¦æ±‚ç¨‹åºå‘˜æ˜ç¡®æ§åˆ¶é”çš„ç”Ÿå‘½å‘¨æœŸï¼Œè¿™å¸¦æ¥äº†æ›´å¤§çš„çµæ´»æ€§ï¼ŒåŒæ—¶ä¹Ÿå¢åŠ äº†ä½¿ç”¨çš„å¤æ‚æ€§ã€‚</p><h3 id="AQSæ¡†æ¶çš„æ ¸å¿ƒæ€æƒ³"><a href="#AQSæ¡†æ¶çš„æ ¸å¿ƒæ€æƒ³" class="headerlink" title="AQSæ¡†æ¶çš„æ ¸å¿ƒæ€æƒ³"></a>AQSæ¡†æ¶çš„æ ¸å¿ƒæ€æƒ³</h3><p>Lockæ¥å£çš„å®ç°åŸºäºAbstractQueuedSynchronizerï¼ˆAQSï¼‰æ¡†æ¶ï¼Œè¿™æ˜¯Doug Leaè®¾è®¡çš„ä¸€ä¸ªå¹¶å‘æ¡†æ¶çš„æ°ä½œã€‚</p><p><strong>åŒæ­¥çŠ¶æ€çš„æŠ½è±¡ï¼š</strong><br>AQSä½¿ç”¨ä¸€ä¸ªintå€¼æ¥è¡¨ç¤ºåŒæ­¥çŠ¶æ€ï¼Œä¸åŒçš„é”å®ç°å¯ä»¥èµ‹äºˆè¿™ä¸ªçŠ¶æ€ä¸åŒçš„å«ä¹‰ã€‚æ¯”å¦‚ReentrantLockç”¨å®ƒè¡¨ç¤ºé‡å…¥æ¬¡æ•°ï¼ŒSemaphoreç”¨å®ƒè¡¨ç¤ºè®¸å¯è¯æ•°é‡ã€‚</p><p><strong>é˜Ÿåˆ—åŒ–çš„ç­‰å¾…æœºåˆ¶ï¼š</strong><br>å½“çº¿ç¨‹æ— æ³•è·å–é”æ—¶ï¼ŒAQSä¼šå°†å…¶åŒ…è£…æˆèŠ‚ç‚¹åŠ å…¥åˆ°ä¸€ä¸ªFIFOé˜Ÿåˆ—ä¸­ã€‚è¿™ä¸ªé˜Ÿåˆ—ä½¿ç”¨åŒå‘é“¾è¡¨å®ç°ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½åŒ…å«äº†çº¿ç¨‹å¼•ç”¨å’Œç­‰å¾…çŠ¶æ€ä¿¡æ¯ã€‚</p><p><strong>è‡ªæ—‹ä¸é˜»å¡çš„å¹³è¡¡ï¼š</strong><br>AQSå·§å¦™åœ°ç»“åˆäº†è‡ªæ—‹å’Œé˜»å¡ä¸¤ç§ç­‰å¾…ç­–ç•¥ã€‚çº¿ç¨‹åœ¨å…¥é˜Ÿåä¼šå…ˆè¿›è¡Œæœ‰é™æ¬¡æ•°çš„è‡ªæ—‹å°è¯•ï¼Œåªæœ‰åœ¨ç¡®å®šæ— æ³•è·å–é”æ—¶æ‰ä¼šè°ƒç”¨LockSupport.park()è¿›å…¥é˜»å¡çŠ¶æ€ã€‚</p><h3 id="3-volatile-å…³é”®å­—"><a href="#3-volatile-å…³é”®å­—" class="headerlink" title="3. volatile å…³é”®å­—"></a>3. <code>volatile</code> å…³é”®å­—</h3><p><code>volatile</code>å…³é”®å­—å¹¶ä¸æ˜¯ä¸€ä¸ªé”ï¼Œå®ƒæ˜¯ä¸€ç§è½»é‡çº§çš„åŒæ­¥æœºåˆ¶ï¼Œä¸»è¦ç”¨äºä¿è¯å…±äº«å˜é‡çš„<strong>å¯è§æ€§</strong>å’Œ<strong>æœ‰åºæ€§</strong>ã€‚</p><ul><li><strong>å¯è§æ€§ï¼ˆVisibilityï¼‰ï¼š</strong> å½“ä¸€ä¸ªå˜é‡è¢«<code>volatile</code>ä¿®é¥°åï¼Œä¸€ä¸ªçº¿ç¨‹å¯¹å®ƒçš„ä¿®æ”¹ä¼šç«‹å³è¢«å…¶ä»–çº¿ç¨‹å¯è§ã€‚è¿™æ˜¯é€šè¿‡åœ¨å†™æ“ä½œåæ·»åŠ å†…å­˜å±éšœï¼Œå¼ºåˆ¶å°†ä¿®æ”¹åçš„å€¼åˆ·æ–°åˆ°ä¸»å†…å­˜ï¼Œå¹¶åœ¨è¯»æ“ä½œå‰æ·»åŠ å†…å­˜å±éšœï¼Œå¼ºåˆ¶ä»ä¸»å†…å­˜ä¸­è¯»å–æœ€æ–°å€¼æ¥å®ç°çš„ã€‚</li><li><strong>æœ‰åºæ€§ï¼ˆOrderingï¼‰ï¼š</strong> <code>volatile</code>å¯ä»¥ç¦æ­¢æŒ‡ä»¤é‡æ’åºï¼Œç¡®ä¿ä»£ç çš„æ‰§è¡Œé¡ºåºä¸ä¼šè¢«æ‰“ä¹±ã€‚</li><li><strong>æ— æ³•ä¿è¯åŸå­æ€§ï¼ˆAtomicityï¼‰ï¼š</strong> <code>volatile</code>æ— æ³•ä¿è¯å¤åˆæ“ä½œï¼ˆå¦‚<code>i++</code>ï¼‰çš„åŸå­æ€§ï¼Œå› ä¸º<code>i++</code>å®é™…ä¸Šæ˜¯è¯»ã€åŠ ã€å†™ä¸‰ä¸ªæ“ä½œçš„ç»„åˆï¼Œè¿™ä¸‰ä¸ªæ“ä½œå¹¶éä¸€æ¬¡å®Œæˆã€‚å¦‚æœè¦ä¿è¯åŸå­æ€§ï¼Œéœ€è¦ä½¿ç”¨<code>synchronized</code>ã€<code>Lock</code>æˆ–<code>java.util.concurrent.atomic</code>åŒ…ä¸‹çš„åŸå­ç±»ã€‚</li></ul><p><strong>æ€»ç»“ä¸€ä¸‹ï¼š</strong></p><table><thead><tr><th>ç‰¹æ€§</th><th><code>synchronized</code></th><th><code>Lock</code> (å¦‚<code>ReentrantLock</code>)</th><th><code>volatile</code></th></tr></thead><tbody><tr><td><strong>åŠŸèƒ½</strong></td><td>ç‹¬å é”ï¼Œä¿è¯åŸå­æ€§ã€å¯è§æ€§ã€æœ‰åºæ€§</td><td>ç‹¬å é”ï¼ŒåŠŸèƒ½æ›´å¼ºå¤§ï¼Œä¿è¯åŸå­æ€§ã€å¯è§æ€§ã€æœ‰åºæ€§</td><td>è½»é‡çº§åŒæ­¥ï¼Œåªä¿è¯å¯è§æ€§å’Œæœ‰åºæ€§</td></tr><tr><td><strong>ä½¿ç”¨æ–¹å¼</strong></td><td>å…³é”®å­—ï¼Œè‡ªåŠ¨åŠ é”å’Œè§£é”</td><td>æ¥å£ï¼Œéœ€è¦æ‰‹åŠ¨åŠ é”å’Œè§£é”ï¼Œå¿…é¡»åœ¨<code>finally</code>å—ä¸­é‡Šæ”¾</td><td>å…³é”®å­—ï¼Œä¿®é¥°å˜é‡</td></tr><tr><td><strong>çµæ´»æ€§</strong></td><td>è¾ƒå·®ï¼ŒåŠŸèƒ½å›ºå®š</td><td>å¼ºï¼Œæä¾›äº†æ›´å¤šé«˜çº§åŠŸèƒ½ï¼Œå¦‚å¯ä¸­æ–­ã€è¶…æ—¶ã€å…¬å¹³é”ç­‰</td><td>è¾ƒå·®ï¼Œåªé’ˆå¯¹å˜é‡</td></tr><tr><td><strong>æ€§èƒ½</strong></td><td>JVMä¼˜åŒ–åæ€§èƒ½è¾ƒé«˜ï¼Œå¼€é”€ç›¸å¯¹è¾ƒå°</td><td>é«˜æ€§èƒ½ï¼Œåœ¨ç«äº‰æ¿€çƒˆæ—¶é€šå¸¸ä¼˜äº<code>synchronized</code></td><td>éå¸¸é«˜ï¼Œå‡ ä¹æ²¡æœ‰å¼€é”€</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>ç®€å•çš„åŒæ­¥éœ€æ±‚ï¼Œå¤§éƒ¨åˆ†æƒ…å†µéƒ½é€‚ç”¨</td><td>é«˜çº§åŒæ­¥éœ€æ±‚ï¼Œéœ€è¦çµæ´»æ§åˆ¶é”çš„è·å–å’Œé‡Šæ”¾</td><td>å˜é‡çš„å†™æ“ä½œä¸ä¾èµ–äºå½“å‰å€¼ï¼Œéœ€è¦ä¿è¯å˜é‡çš„å¯è§æ€§ã€‚</td></tr></tbody></table><h3 id="4-ä¹è§‚é”-Optimistic-Locking"><a href="#4-ä¹è§‚é”-Optimistic-Locking" class="headerlink" title="4. ä¹è§‚é” (Optimistic Locking)"></a>4. ä¹è§‚é” (Optimistic Locking)</h3><p>ä¸ä¹‹å‰è®¨è®ºçš„<strong>æ‚²è§‚é”</strong>ï¼ˆ<code>synchronized</code>å’Œ<code>Lock</code>ï¼‰ä¸åŒï¼Œä¹è§‚é”å¹¶éä¸€ä¸ªå…·ä½“çš„Javaå…³é”®å­—æˆ–ç±»ï¼Œè€Œæ˜¯ä¸€ç§<strong>å¹¶å‘æ§åˆ¶çš„æ€æƒ³å’Œç­–ç•¥</strong>ã€‚æ‚²è§‚é”è®¤ä¸ºâ€œæ€»ä¼šæœ‰å…¶ä»–çº¿ç¨‹æ¥ä¿®æ”¹æ•°æ®â€ï¼Œæ‰€ä»¥åœ¨è®¿é—®å…±äº«èµ„æºå‰ï¼Œå…ˆå¯¹èµ„æºåŠ é”ï¼Œç¡®ä¿ç‹¬å è®¿é—®ã€‚è€Œä¹è§‚é”åˆ™è®¤ä¸ºâ€œæ•°æ®å†²çªå‘ç”Ÿçš„æ¦‚ç‡å¾ˆå°â€ï¼Œæ‰€ä»¥å®ƒ<strong>ä¸åŠ é”</strong>ï¼Œè€Œæ˜¯å‡è®¾æ‰€æœ‰çº¿ç¨‹éƒ½èƒ½æ­£å¸¸æ‰§è¡Œï¼Œåªæœ‰åœ¨æ•°æ®æ›´æ–°æäº¤æ—¶ï¼Œæ‰å»æ£€æŸ¥åœ¨æ­¤æœŸé—´æ•°æ®æ˜¯å¦è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹è¿‡ã€‚</p><p>å¦‚æœæ£€æŸ¥åˆ°æ•°æ®æ²¡æœ‰è¢«ä¿®æ”¹ï¼Œåˆ™æ›´æ–°æˆåŠŸã€‚å¦‚æœå‘ç°æ•°æ®å·²ç»è¢«ä¿®æ”¹ï¼Œåˆ™æ›´æ–°å¤±è´¥ã€‚å¤„ç†å¤±è´¥çš„æ–¹å¼é€šå¸¸æœ‰ä¸¤ç§ï¼š</p><ol><li><strong>é‡è¯•ï¼š</strong> å¾ªç¯å°è¯•ï¼Œç›´åˆ°æ›´æ–°æˆåŠŸä¸ºæ­¢ã€‚</li><li><strong>æ”¾å¼ƒï¼š</strong> æŠ›å‡ºå¼‚å¸¸æˆ–ç›´æ¥è¿”å›å¤±è´¥ï¼Œç”±è°ƒç”¨æ–¹å¤„ç†ã€‚</li></ol><p><strong>ä¹è§‚é”çš„å®ç°æ–¹å¼ï¼š</strong></p><p>ä¹è§‚é”çš„æ ¸å¿ƒåœ¨äºå¦‚ä½•â€œæ£€æŸ¥æ•°æ®æ˜¯å¦è¢«ä¿®æ”¹â€ã€‚åœ¨Javaä¸­ï¼Œå¸¸è§çš„å®ç°æ–¹å¼æœ‰ä¸¤ç§ï¼š</p><ul><li><p>ç‰ˆæœ¬å·ï¼ˆVersion Numberï¼‰ï¼š</p><p>åœ¨æ•°æ®è¡¨ä¸­å¢åŠ ä¸€ä¸ªversionå­—æ®µã€‚æ¯æ¬¡è¯»å–æ•°æ®æ—¶ï¼Œä¹ŸæŠŠversionå­—æ®µè¯»å‡ºæ¥ã€‚å½“è¦è¿›è¡Œæ•°æ®æ›´æ–°æ—¶ï¼Œå¸¦ä¸Šä¹‹å‰è¯»å–çš„versionå€¼ï¼Œåœ¨æ›´æ–°è¯­å¥ä¸­åŠ å…¥WHERE version &#x3D; &lt;å½“å‰ç‰ˆæœ¬å·&gt;çš„æ¡ä»¶ã€‚å¦‚æœæ›´æ–°æˆåŠŸï¼ŒåŒæ—¶æŠŠversionå€¼åŠ 1ã€‚</p><ul><li><p><strong>SQLç¤ºä¾‹ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">UPDATE products <span class="type">SET</span> <span class="variable">stock</span> <span class="operator">=</span> <span class="number">100</span>, version = version + <span class="number">1</span></span><br><span class="line"><span class="type">WHERE</span> <span class="variable">id</span> <span class="operator">=</span> <span class="number">123</span> <span class="type">AND</span> <span class="variable">version</span> <span class="operator">=</span> &lt;ä¹‹å‰è¯»å–çš„ç‰ˆæœ¬å·&gt;;</span><br></pre></td></tr></table></figure></li><li><p><strong>åŸç†ï¼š</strong> å¦‚æœåœ¨æ›´æ–°æ—¶ï¼Œå…¶ä»–çº¿ç¨‹å·²ç»ä¿®æ”¹äº†è¿™æ¡æ•°æ®ï¼Œé‚£ä¹ˆ<code>version</code>å€¼å·²ç»æ”¹å˜ï¼Œä¸Šè¿°<code>UPDATE</code>è¯­å¥çš„<code>WHERE</code>æ¡ä»¶å°†ä¸æˆç«‹ï¼Œå¯¼è‡´æ›´æ–°å¤±è´¥ï¼Œå½±å“è¡Œæ•°ä¸º0ã€‚æ­¤æ—¶ï¼Œä½ å¯ä»¥é€‰æ‹©é‡è¯•æˆ–æ”¾å¼ƒã€‚</p></li></ul></li><li><p>CAS (Compare-And-Swap) ç®—æ³•ï¼š</p><p>è¿™æ˜¯ä¹è§‚é”åœ¨ç¡¬ä»¶å±‚é¢çš„æ”¯æŒï¼Œä¹Ÿæ˜¯Javaä¸­å®ç°ä¹è§‚é”çš„æ ¸å¿ƒæœºåˆ¶ã€‚CASæ˜¯ä¸€ç§åŸå­æ“ä½œï¼Œå®ƒåŒ…å«ä¸‰ä¸ªæ“ä½œæ•°ï¼š</p><ul><li><strong>V (Value)ï¼š</strong> å†…å­˜åœ°å€ä¸­å­˜æ”¾çš„æ—§å€¼ã€‚</li><li><strong>A (Expected)ï¼š</strong> é¢„æœŸçš„æ—§å€¼ã€‚</li><li><strong>B (New)ï¼š</strong> æƒ³è¦å†™å…¥çš„æ–°å€¼ã€‚</li></ul><p>CASçš„æ“ä½œé€»è¾‘æ˜¯ï¼š</p><p>å¦‚æœå†…å­˜åœ°å€Vä¸­çš„å€¼ç­‰äºé¢„æœŸå€¼Aï¼Œé‚£ä¹ˆå°±å°†Vçš„å€¼æ›´æ–°ä¸ºæ–°å€¼Bã€‚å¦åˆ™ï¼Œä»€ä¹ˆéƒ½ä¸åšã€‚æ•´ä¸ªæ“ä½œæ˜¯åŸå­æ€§çš„ï¼Œç”±CPUæŒ‡ä»¤ç›´æ¥å®Œæˆã€‚</p><p>Javaä¸­<code>java.util.concurrent.atomic</code>åŒ…ä¸‹çš„æ‰€æœ‰åŸå­ç±»ï¼Œå¦‚<code>AtomicInteger</code>ã€<code>AtomicLong</code>ç­‰ï¼Œéƒ½æ˜¯åŸºäºCASå®ç°çš„ã€‚</p><p><strong>AtomicIntegerç¤ºä¾‹ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">AtomicInteger</span> <span class="variable">count</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>();</span><br><span class="line"><span class="comment">// å‡è®¾å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œä»¥ä¸‹æ“ä½œ</span></span><br><span class="line">count.incrementAndGet(); <span class="comment">// å†…éƒ¨å°±æ˜¯CASæ“ä½œ</span></span><br></pre></td></tr></table></figure><p><code>incrementAndGet()</code>æ–¹æ³•çš„å†…éƒ¨å®ç°ç±»ä¼¼äºä¸€ä¸ªè‡ªæ—‹é‡è¯•çš„å¾ªç¯ï¼š</p><ol><li>è·å–å½“å‰å€¼<code>current</code>ã€‚</li><li>è®¡ç®—æ–°å€¼<code>next = current + 1</code>ã€‚</li><li>ä½¿ç”¨CASå°è¯•å°†<code>current</code>æ›´æ–°ä¸º<code>next</code>ã€‚</li><li>å¦‚æœæ›´æ–°å¤±è´¥ï¼ˆè¯´æ˜<code>current</code>å·²ç»è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹ï¼‰ï¼Œåˆ™é‡æ–°å›åˆ°ç¬¬ä¸€æ­¥ï¼Œå†æ¬¡è·å–æœ€æ–°å€¼å¹¶å°è¯•æ›´æ–°ã€‚</li></ol></li></ul><p><strong>æ‚²è§‚é”ä¸ä¹è§‚é”çš„æ¯”è¾ƒï¼š</strong></p><table><thead><tr><th>ç‰¹æ€§</th><th>æ‚²è§‚é” (<code>synchronized</code>, <code>Lock</code>)</th><th>ä¹è§‚é” (CAS, ç‰ˆæœ¬å·)</th></tr></thead><tbody><tr><td><strong>åŠ é”æ–¹å¼</strong></td><td>ç‹¬å èµ„æºæ—¶å…ˆåŠ é”ï¼Œé˜»æ­¢å…¶ä»–çº¿ç¨‹è®¿é—®</td><td>ä¸åŠ é”ï¼Œåªåœ¨æäº¤æ—¶è¿›è¡Œå†²çªæ£€æµ‹</td></tr><tr><td><strong>å†²çªå¤„ç†</strong></td><td>çº¿ç¨‹æ’é˜Ÿç­‰å¾…é”ï¼Œä¸²è¡Œæ‰§è¡Œ</td><td>çº¿ç¨‹å¤±è´¥åé‡è¯•æˆ–æ”¾å¼ƒï¼Œå¹¶å‘æ‰§è¡Œ</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td><strong>å†™æ“ä½œå¤šã€ç«äº‰æ¿€çƒˆ</strong>çš„åœºæ™¯ã€‚æ•°æ®å†²çªæ¦‚ç‡é«˜ã€‚</td><td><strong>è¯»æ“ä½œå¤šã€å†™æ“ä½œå°‘</strong>çš„åœºæ™¯ã€‚æ•°æ®å†²çªæ¦‚ç‡ä½ã€‚</td></tr><tr><td><strong>æ€§èƒ½</strong></td><td>åœ¨é«˜ç«äº‰ç¯å¢ƒä¸‹ï¼Œçº¿ç¨‹åˆ‡æ¢å’Œä¸Šä¸‹æ–‡å¼€é”€å¤§ï¼Œæ€§èƒ½ä¸‹é™ã€‚</td><td>åœ¨ä½ç«äº‰ç¯å¢ƒä¸‹ï¼Œæ— é”å¼€é”€ï¼Œæ€§èƒ½æé«˜ã€‚åœ¨é«˜ç«äº‰ç¯å¢ƒä¸‹ï¼Œå¤§é‡é‡è¯•å¯èƒ½å¯¼è‡´CPUå¼€é”€å¢åŠ ã€‚</td></tr></tbody></table><p><strong>æ€»ç»“ï¼š</strong></p><p>åœ¨Javaä¸­ï¼Œ<strong>æ‚²è§‚é”</strong>å’Œ<strong>ä¹è§‚é”</strong>æ˜¯ä¸¤ç§æˆªç„¶ä¸åŒçš„å¹¶å‘æ§åˆ¶ç­–ç•¥ã€‚æ‚²è§‚é”ï¼ˆ<code>synchronized</code>, <code>Lock</code>ï¼‰é€‚åˆ<strong>å†™å¤šè¯»å°‘</strong>çš„åœºæ™¯ï¼Œèƒ½å¤Ÿä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œä½†ä¼šç‰ºç‰²ä¸€å®šçš„æ€§èƒ½ã€‚è€Œä¹è§‚é”ï¼ˆ<strong>CAS</strong>ã€<strong>ç‰ˆæœ¬å·</strong>ï¼‰åˆ™é€‚åˆ<strong>è¯»å¤šå†™å°‘</strong>çš„åœºæ™¯ï¼Œé€šè¿‡æ— é”çš„å¹¶å‘æ“ä½œæé«˜äº†æ€§èƒ½ï¼Œä½†åœ¨é«˜ç«äº‰ä¸‹å¯èƒ½å¯¼è‡´é¢‘ç¹é‡è¯•ï¼Œåè€Œé™ä½æ•ˆç‡ã€‚ç†è§£è¿™ä¸¤ç§é”çš„æ€æƒ³ï¼Œå¯ä»¥å¸®åŠ©ä½ æ ¹æ®å…·ä½“çš„ä¸šåŠ¡åœºæ™¯é€‰æ‹©æœ€åˆé€‚çš„å¹¶å‘æ§åˆ¶æ–¹æ¡ˆã€‚</p><p>å¥½çš„ï¼Œæˆ‘ä»¬æ¥ç»§ç»­å®Œå–„Javaä¸­å…³äºé”çš„ä»‹ç»ï¼Œå¢åŠ <strong>æ­»é”</strong>åŠå…¶è§£å†³æ–¹æ¡ˆçš„å†…å®¹ã€‚</p><hr><h3 id="5-æ­»é”-Deadlock"><a href="#5-æ­»é”-Deadlock" class="headerlink" title="5. æ­»é” (Deadlock)"></a>5. æ­»é” (Deadlock)</h3><p><strong>æ­»é”</strong>æ˜¯æŒ‡ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„çº¿ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå› äº‰å¤ºèµ„æºè€Œé€ æˆçš„ä¸€ç§äº’ç›¸ç­‰å¾…çš„ç°è±¡ã€‚è‹¥æ— å¤–åŠ›ä½œç”¨ï¼Œå®ƒä»¬éƒ½å°†æ— æ³•ç»§ç»­æ‰§è¡Œã€‚</p><p><strong>æ­»é”çš„äº§ç”Ÿ</strong>æ˜¯ä¸€ä¸ªéå¸¸ç»å…¸çš„å¤šçº¿ç¨‹é—®é¢˜ï¼Œé€šå¸¸å‘ç”Ÿåœ¨çº¿ç¨‹éœ€è¦åŒæ—¶æŒæœ‰å¤šä¸ªé”çš„åœºæ™¯ä¸­ã€‚ä¸€ä¸ªç®€å•çš„æ­»é”åœºæ™¯æ˜¯ï¼šçº¿ç¨‹AæŒæœ‰é”1ï¼Œæƒ³è·å–é”2ï¼›è€Œçº¿ç¨‹BæŒæœ‰é”2ï¼Œæƒ³è·å–é”1ã€‚æ­¤æ—¶ä¸¤ä¸ªçº¿ç¨‹éƒ½æ— æ³•ç»§ç»­æ‰§è¡Œï¼Œä»è€Œè¿›å…¥æ­»é”çŠ¶æ€ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// çº¿ç¨‹A</span></span><br><span class="line"><span class="keyword">synchronized</span> (lock1) &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (lock2) &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// çº¿ç¨‹B</span></span><br><span class="line"><span class="keyword">synchronized</span> (lock2) &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (lock1) &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶"><a href="#æ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶" class="headerlink" title="æ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶"></a>æ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶</h4><p>æ­»é”çš„å‘ç”Ÿéœ€è¦åŒæ—¶æ»¡è¶³ä»¥ä¸‹å››ä¸ªæ¡ä»¶ï¼Œç¼ºä¸€ä¸å¯ï¼š</p><ol><li><strong>äº’æ–¥æ¡ä»¶ï¼ˆMutual Exclusionï¼‰ï¼š</strong> è‡³å°‘æœ‰ä¸€ä¸ªèµ„æºæ˜¯ç‹¬å çš„ï¼Œå³ä¸€æ¬¡åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ã€‚è¿™æ˜¯é”æœ¬èº«çš„åŸºæœ¬ç‰¹æ€§ã€‚</li><li><strong>è¯·æ±‚ä¸ä¿æŒæ¡ä»¶ï¼ˆHold and Waitï¼‰ï¼š</strong> ä¸€ä¸ªçº¿ç¨‹å› è¯·æ±‚èµ„æºè€Œé˜»å¡æ—¶ï¼Œå®ƒå¯¹è‡ªå·±å·²è·å¾—çš„èµ„æºä¿æŒä¸æ”¾ã€‚</li><li><strong>ä¸å‰¥å¤ºæ¡ä»¶ï¼ˆNo Preemptionï¼‰ï¼š</strong> çº¿ç¨‹å·²è·å¾—çš„èµ„æºåœ¨æœªä½¿ç”¨å®Œä¹‹å‰ï¼Œä¸èƒ½è¢«å¼ºè¡Œå‰¥å¤ºï¼Œåªèƒ½ç”±è¯¥çº¿ç¨‹è‡ªå·±é‡Šæ”¾ã€‚</li><li><strong>å¾ªç¯ç­‰å¾…æ¡ä»¶ï¼ˆCircular Waitï¼‰ï¼š</strong> å­˜åœ¨ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…é“¾ï¼Œå…¶ä¸­æ¯ä¸ªçº¿ç¨‹éƒ½æŒæœ‰ä¸‹ä¸€ä¸ªçº¿ç¨‹æ‰€éœ€çš„èµ„æºã€‚ä¾‹å¦‚ï¼šçº¿ç¨‹Aç­‰å¾…çº¿ç¨‹Bï¼Œçº¿ç¨‹Bç­‰å¾…çº¿ç¨‹Cï¼Œçº¿ç¨‹Cåˆç­‰å¾…çº¿ç¨‹Aã€‚</li></ol><h4 id="æ­»é”çš„è§£å†³æ–¹æ¡ˆ"><a href="#æ­»é”çš„è§£å†³æ–¹æ¡ˆ" class="headerlink" title="æ­»é”çš„è§£å†³æ–¹æ¡ˆ"></a>æ­»é”çš„è§£å†³æ–¹æ¡ˆ</h4><p>è§£å†³æ­»é”çš„æ ¹æœ¬æ€æƒ³æ˜¯<strong>ç ´åä¸Šè¿°å››ä¸ªå¿…è¦æ¡ä»¶ä¹‹ä¸€æˆ–å¤šä¸ª</strong>ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬æ— æ³•ç ´åäº’æ–¥æ¡ä»¶ï¼ˆå› ä¸ºèµ„æºå°±æ˜¯ç‹¬å çš„ï¼‰ï¼Œå› æ­¤ä¸»è¦ä»å…¶ä»–ä¸‰ä¸ªæ¡ä»¶å…¥æ‰‹ã€‚</p><ol><li><strong>ç ´åâ€œè¯·æ±‚ä¸ä¿æŒâ€æ¡ä»¶ï¼š</strong><ul><li><strong>ä¸€æ¬¡æ€§è·å–æ‰€æœ‰é”ï¼š</strong> çº¿ç¨‹åœ¨å¼€å§‹æ‰§è¡Œæ—¶ï¼Œå°±ä¸€æ¬¡æ€§è·å–æ‰€æœ‰éœ€è¦çš„é”ã€‚å¦‚æœè·å–ä¸æˆåŠŸï¼Œåˆ™é‡Šæ”¾æ‰€æœ‰å·²è·å¾—çš„é”ï¼Œç„¶åç­‰å¾…ä¸€æ®µæ—¶é—´åå†æ¬¡å°è¯•ã€‚</li><li><strong>ä¼˜ç‚¹ï¼š</strong> ç®€å•æœ‰æ•ˆã€‚</li><li><strong>ç¼ºç‚¹ï¼š</strong> å¯èƒ½ä¼šé™ä½å¹¶å‘æ€§ï¼Œå› ä¸ºçº¿ç¨‹åœ¨å¾ˆæ—©å°±æŒæœ‰äº†é”ï¼Œå³ä½¿è¿™äº›é”åœ¨åé¢æ‰è¢«ä½¿ç”¨ã€‚</li></ul></li><li><strong>ç ´åâ€œä¸å‰¥å¤ºâ€æ¡ä»¶ï¼š</strong><ul><li><strong>ä½¿ç”¨å¯ä¸­æ–­çš„é”ï¼š</strong> ä½¿ç”¨<code>Lock</code>æ¥å£æä¾›çš„<code>tryLock()</code>æ–¹æ³•ã€‚å½“ä¸€ä¸ªçº¿ç¨‹å°è¯•è·å–é”å¤±è´¥æ—¶ï¼Œå®ƒå¯ä»¥é€‰æ‹©æ”¾å¼ƒå¹¶é‡Šæ”¾å·²æŒæœ‰çš„é”ï¼Œè€Œä¸æ˜¯ä¸€ç›´ç­‰å¾…ã€‚<code>Lock.tryLock(long time, TimeUnit unit)</code>æ–¹æ³•å¯ä»¥åœ¨æŒ‡å®šæ—¶é—´å†…å°è¯•è·å–é”ï¼Œè¶…æ—¶åä¼šæ”¾å¼ƒã€‚</li><li><strong>ä¼˜ç‚¹ï¼š</strong> æé«˜äº†çµæ´»æ€§ï¼Œçº¿ç¨‹å¯ä»¥å“åº”ä¸­æ–­æˆ–è¶…æ—¶ï¼Œé¿å…æ— é™ç­‰å¾…ã€‚</li><li><strong>ç¼ºç‚¹ï¼š</strong> å®ç°èµ·æ¥ç›¸å¯¹å¤æ‚ï¼Œéœ€è¦å¼€å‘è€…æ‰‹åŠ¨å¤„ç†è·å–é”å¤±è´¥çš„æƒ…å†µã€‚</li></ul></li><li><strong>ç ´åâ€œå¾ªç¯ç­‰å¾…â€æ¡ä»¶ï¼š</strong><ul><li><strong>æŒ‰é¡ºåºè·å–é”ï¼š</strong> å¯¹æ‰€æœ‰çš„é”è¿›è¡Œæ’åºï¼Œå¹¶å¼ºåˆ¶æ‰€æœ‰çº¿ç¨‹éƒ½æŒ‰ç…§ç›¸åŒçš„é¡ºåºè·å–é”ã€‚</li><li><strong>ç¤ºä¾‹ï¼š</strong> å¦‚æœçº¿ç¨‹Aå’Œçº¿ç¨‹Béƒ½éœ€è¦<code>lock1</code>å’Œ<code>lock2</code>ï¼Œé‚£ä¹ˆå®ƒä»¬éƒ½å¿…é¡»å…ˆè·å–<code>lock1</code>ï¼Œå†è·å–<code>lock2</code>ã€‚è¿™æ ·å°±æœç»äº†çº¿ç¨‹AæŒæœ‰<code>lock1</code>ç­‰å¾…<code>lock2</code>ï¼ŒåŒæ—¶çº¿ç¨‹BæŒæœ‰<code>lock2</code>ç­‰å¾…<code>lock1</code>çš„å¾ªç¯ã€‚</li><li><strong>ä¼˜ç‚¹ï¼š</strong> è¿™æ˜¯æœ€å¸¸ç”¨ã€æœ€æœ‰æ•ˆçš„æ­»é”è§£å†³æ–¹æ¡ˆï¼Œå®ç°èµ·æ¥ä¹Ÿç›¸å¯¹ç®€å•ã€‚</li><li><strong>ç¼ºç‚¹ï¼š</strong> æœ‰æ—¶å¾ˆéš¾å¯¹æ‰€æœ‰é”è¿›è¡Œå…¨å±€æ’åºï¼Œç‰¹åˆ«æ˜¯åœ¨ä»£ç æ¨¡å—åŒ–ç¨‹åº¦è¾ƒé«˜ã€ä¾èµ–å…³ç³»å¤æ‚çš„æƒ…å†µä¸‹ã€‚</li></ul></li></ol><p><strong>æ€»ç»“ï¼š</strong></p><p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œé¢„é˜²æ­»é”çš„æœ€ä½³å®è·µé€šå¸¸æ˜¯<strong>ç ´åå¾ªç¯ç­‰å¾…æ¡ä»¶</strong>ï¼Œå³<strong>ç»Ÿä¸€é”çš„è·å–é¡ºåº</strong>ã€‚è¿™æ˜¯æœ€ç®€å•ä¸”æœ€æœ‰æ•ˆçš„æ–¹æ¡ˆã€‚å¦‚æœä¸šåŠ¡åœºæ™¯éœ€è¦æ›´çµæ´»çš„æ§åˆ¶ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨<code>Lock</code>æ¥å£ï¼Œåˆ©ç”¨<code>tryLock()</code>æ–¹æ³•æ¥ç ´åâ€œä¸å‰¥å¤ºâ€æ¡ä»¶ï¼Œå®ç°æ›´å¤æ‚çš„æ­»é”å¤„ç†é€»è¾‘ã€‚</p><p>å¥½çš„ï¼Œæˆ‘ä»¬æ¥è¯¦ç»†ä»‹ç»<strong>é“¶è¡Œå®¶ç®—æ³• (Bankerâ€™s Algorithm)</strong>ã€‚</p><hr><h3 id="é“¶è¡Œå®¶ç®—æ³•æ¦‚è¿°"><a href="#é“¶è¡Œå®¶ç®—æ³•æ¦‚è¿°" class="headerlink" title="é“¶è¡Œå®¶ç®—æ³•æ¦‚è¿°"></a>é“¶è¡Œå®¶ç®—æ³•æ¦‚è¿°</h3><p>é“¶è¡Œå®¶ç®—æ³•æ˜¯ä¸€ç§è‘—åçš„<strong>æ­»é”é¿å…ç®—æ³•</strong>ï¼Œç”±è·å…°è®¡ç®—æœºç§‘å­¦å®¶Dijkstraåœ¨1965å¹´æå‡ºã€‚å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šåœ¨æ¯æ¬¡åˆ†é…èµ„æºä¹‹å‰ï¼Œå…ˆè¿›è¡Œä¸€æ¬¡<strong>å®‰å…¨æ€§æ£€æŸ¥</strong>ã€‚å¦‚æœåˆ†é…åç³»ç»Ÿä»ç„¶å¤„äº<strong>å®‰å…¨çŠ¶æ€</strong>ï¼Œåˆ™åˆ†é…èµ„æºï¼›å¦åˆ™ï¼Œä¸äºˆåˆ†é…ï¼Œçº¿ç¨‹éœ€è¦ç­‰å¾…ã€‚</p><ul><li>ä¼˜ç‚¹ï¼šæ¯”æ­»é”é¢„é˜²æ›´çµæ´»ï¼Œèƒ½æé«˜èµ„æºåˆ©ç”¨ç‡ã€‚</li><li>ç¼ºç‚¹ï¼šç®—æ³•å¤æ‚ï¼Œéœ€è¦é¢„çŸ¥è¿›ç¨‹çš„æœ€å¤§èµ„æºéœ€æ±‚ï¼Œå¹¶ä¸”ç³»ç»Ÿå¼€é”€å¤§ã€‚</li></ul><p>ä¹‹æ‰€ä»¥å«â€œé“¶è¡Œå®¶ç®—æ³•â€ï¼Œæ˜¯å› ä¸ºå®ƒçš„å·¥ä½œåŸç†ç±»ä¼¼äºé“¶è¡Œç®¡ç†è´·æ¬¾ã€‚é“¶è¡Œå®¶åœ¨å‘æ”¾è´·æ¬¾æ—¶ï¼Œä¼šå…ˆç¡®ä¿è¿™ç¬”è´·æ¬¾å‘æ”¾åï¼Œè‡ªå·±è¿˜æœ‰è¶³å¤Ÿçš„èµ„é‡‘æ¥æ»¡è¶³æ‰€æœ‰å®¢æˆ·å¯èƒ½æå‡ºçš„æœ€å¤§å–æ¬¾éœ€æ±‚ï¼Œä»è€Œé¿å…å› æ— æ³•æ”¯ä»˜è€Œç ´äº§çš„é£é™©ã€‚</p><p>ç®€å•æ¥è¯´ï¼Œé“¶è¡Œå®¶ç®—æ³•é€šè¿‡ä»¥ä¸‹ä¸¤ä¸ªæ­¥éª¤æ¥é¿å…æ­»é”ï¼š</p><ol><li><strong>å®‰å…¨çŠ¶æ€çš„å®šä¹‰ï¼š</strong> ç³»ç»Ÿèƒ½å¤Ÿæ‰¾åˆ°ä¸€ä¸ª<strong>å®‰å…¨åºåˆ—</strong>ï¼Œä½¿å¾—æ‰€æœ‰çº¿ç¨‹éƒ½èƒ½æŒ‰ç…§è¿™ä¸ªåºåˆ—æ‰§è¡Œå®Œæ¯•ã€‚</li><li><strong>èµ„æºåˆ†é…ç­–ç•¥ï¼š</strong> å½“ä¸€ä¸ªçº¿ç¨‹è¯·æ±‚èµ„æºæ—¶ï¼Œç®—æ³•ä¼šå…ˆå‡è®¾åˆ†é…æˆåŠŸï¼Œç„¶åæ£€æŸ¥ç³»ç»Ÿæ˜¯å¦ä»å¤„äºå®‰å…¨çŠ¶æ€ã€‚å¦‚æœå®‰å…¨ï¼Œå°±çœŸçš„åˆ†é…ï¼›å¦‚æœä¸å®‰å…¨ï¼Œå°±æ‹’ç»åˆ†é…ã€‚</li></ol><hr><h3 id="é“¶è¡Œå®¶ç®—æ³•ä¸­çš„å‡ ä¸ªé‡è¦æ•°æ®ç»“æ„"><a href="#é“¶è¡Œå®¶ç®—æ³•ä¸­çš„å‡ ä¸ªé‡è¦æ•°æ®ç»“æ„" class="headerlink" title="é“¶è¡Œå®¶ç®—æ³•ä¸­çš„å‡ ä¸ªé‡è¦æ•°æ®ç»“æ„"></a>é“¶è¡Œå®¶ç®—æ³•ä¸­çš„å‡ ä¸ªé‡è¦æ•°æ®ç»“æ„</h3><p>ä¸ºäº†å®ç°ç®—æ³•ï¼Œéœ€è¦ç»´æŠ¤ä»¥ä¸‹å‡ ä¸ªå…³é”®æ•°æ®ç»“æ„ï¼Œå‡è®¾ç³»ç»Ÿä¸­æœ‰<code>n</code>ä¸ªçº¿ç¨‹å’Œ<code>m</code>ç§èµ„æºï¼š</p><ul><li><strong>Available (å¯ç”¨èµ„æºçŸ©é˜µ)ï¼š</strong> ä¸€ä¸ªé•¿åº¦ä¸º<code>m</code>çš„å‘é‡ã€‚<code>Available[j]</code>è¡¨ç¤ºç¬¬<code>j</code>ç§èµ„æºç›®å‰å¯ç”¨çš„æ•°é‡ã€‚</li><li><strong>Max (æœ€å¤§éœ€æ±‚çŸ©é˜µ)ï¼š</strong> ä¸€ä¸ª<code>n * m</code>çš„çŸ©é˜µã€‚<code>Max[i, j]</code>è¡¨ç¤ºçº¿ç¨‹<code>i</code>æœ€å¤šéœ€è¦ç¬¬<code>j</code>ç§èµ„æºå¤šå°‘ä¸ªã€‚</li><li><strong>Allocation (å·²åˆ†é…èµ„æºçŸ©é˜µ)ï¼š</strong> ä¸€ä¸ª<code>n * m</code>çš„çŸ©é˜µã€‚<code>Allocation[i, j]</code>è¡¨ç¤ºçº¿ç¨‹<code>i</code>ç›®å‰å·²æ‹¥æœ‰ç¬¬<code>j</code>ç§èµ„æºå¤šå°‘ä¸ªã€‚</li><li><strong>Need (éœ€æ±‚çŸ©é˜µ)ï¼š</strong> ä¸€ä¸ª<code>n * m</code>çš„çŸ©é˜µã€‚<code>Need[i, j]</code>è¡¨ç¤ºçº¿ç¨‹<code>i</code>è¿˜éœ€è¦ç¬¬<code>j</code>ç§èµ„æºå¤šå°‘ä¸ªæ‰èƒ½å®Œæˆä»»åŠ¡ã€‚<ul><li><code>Need[i, j] = Max[i, j] - Allocation[i, j]</code></li></ul></li></ul><hr><h3 id="é“¶è¡Œå®¶ç®—æ³•çš„æ ¸å¿ƒï¼šå®‰å…¨çŠ¶æ€çš„åˆ¤æ–­"><a href="#é“¶è¡Œå®¶ç®—æ³•çš„æ ¸å¿ƒï¼šå®‰å…¨çŠ¶æ€çš„åˆ¤æ–­" class="headerlink" title="é“¶è¡Œå®¶ç®—æ³•çš„æ ¸å¿ƒï¼šå®‰å…¨çŠ¶æ€çš„åˆ¤æ–­"></a>é“¶è¡Œå®¶ç®—æ³•çš„æ ¸å¿ƒï¼šå®‰å…¨çŠ¶æ€çš„åˆ¤æ–­</h3><p>åˆ¤æ–­ç³»ç»Ÿæ˜¯å¦å¤„äºå®‰å…¨çŠ¶æ€æ˜¯é“¶è¡Œå®¶ç®—æ³•çš„æ ¸å¿ƒã€‚ä¸€ä¸ªç³»ç»Ÿå¤„äº<strong>å®‰å…¨çŠ¶æ€</strong>ï¼Œå½“ä¸”ä»…å½“å­˜åœ¨ä¸€ä¸ª<strong>å®‰å…¨åºåˆ—</strong><code>&lt;P1, P2, ..., Pn&gt;</code>ã€‚è¿™ä¸ªåºåˆ—æ»¡è¶³ï¼šå¯¹äºåºåˆ—ä¸­æ¯ä¸€ä¸ªçº¿ç¨‹<code>Pi</code>ï¼Œå®ƒæ‰€éœ€è¦çš„èµ„æºéƒ½èƒ½ç”±ç³»ç»Ÿä¸­å½“å‰å¯ç”¨çš„èµ„æºï¼Œä»¥åŠå‰é¢æ‰€æœ‰å·²å®Œæˆçš„çº¿ç¨‹é‡Šæ”¾çš„èµ„æºæ¥æ»¡è¶³ã€‚</p><p><strong>å®‰å…¨æ€§æ£€æŸ¥ç®—æ³•çš„æ­¥éª¤ï¼š</strong></p><ol><li><strong>åˆå§‹åŒ–ï¼š</strong><ul><li>åˆ›å»ºä¸€ä¸ª<code>Work</code>å‘é‡ï¼Œåˆå§‹åŒ–ä¸º<code>Available</code>ï¼ˆå³å½“å‰å¯ç”¨èµ„æºï¼‰ã€‚</li><li>åˆ›å»ºä¸€ä¸ª<code>Finish</code>å‘é‡ï¼Œåˆå§‹åŒ–ä¸º<code>false</code>ï¼Œè¡¨ç¤ºæ‰€æœ‰çº¿ç¨‹éƒ½æœªå®Œæˆã€‚</li></ul></li><li><strong>å¯»æ‰¾å®‰å…¨çº¿ç¨‹ï¼š</strong><ul><li>ä»æ‰€æœ‰çº¿ç¨‹ä¸­æ‰¾åˆ°ä¸€ä¸ªçº¿ç¨‹<code>i</code>ï¼Œæ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶ï¼š<ul><li><code>Finish[i]</code>ä¸º<code>false</code>ã€‚</li><li><code>Need[i]</code>å‘é‡ä¸­çš„æ¯ä¸€ä¸ªå€¼éƒ½å°äºæˆ–ç­‰äº<code>Work</code>å‘é‡ä¸­å¯¹åº”çš„å€¼ã€‚</li><li>æ¢å¥è¯è¯´ï¼Œçº¿ç¨‹<code>i</code>æ‰€éœ€è¦çš„èµ„æºå°äºæˆ–ç­‰äºå½“å‰å¯ç”¨çš„èµ„æºã€‚</li></ul></li></ul></li><li><strong>é‡Šæ”¾èµ„æºï¼š</strong><ul><li>å¦‚æœæ‰¾åˆ°äº†è¿™æ ·çš„çº¿ç¨‹<code>i</code>ï¼Œåˆ™è®¤ä¸ºå®ƒå¯ä»¥é¡ºåˆ©æ‰§è¡Œå®Œæ¯•ã€‚</li><li>æ¨¡æ‹Ÿè¯¥çº¿ç¨‹æ‰§è¡Œå®Œæ¯•å¹¶é‡Šæ”¾èµ„æºï¼Œæ›´æ–°<code>Work</code>å‘é‡ï¼š<code>Work = Work + Allocation[i]</code>ã€‚</li><li>å°†<code>Finish[i]</code>è®¾ç½®ä¸º<code>true</code>ã€‚</li></ul></li><li><strong>å¾ªç¯æ£€æŸ¥ï¼š</strong><ul><li>é‡å¤æ­¥éª¤2å’Œæ­¥éª¤3ï¼Œç›´åˆ°æ‰¾ä¸åˆ°æ»¡è¶³æ¡ä»¶çš„çº¿ç¨‹ã€‚</li></ul></li><li><strong>åˆ¤æ–­ç»“æœï¼š</strong><ul><li>å¦‚æœæœ€ç»ˆæ‰€æœ‰çº¿ç¨‹çš„<code>Finish</code>éƒ½ä¸º<code>true</code>ï¼Œåˆ™è¯´æ˜æ‰¾åˆ°äº†ä¸€ä¸ªå®‰å…¨åºåˆ—ï¼Œç³»ç»Ÿå¤„äº<strong>å®‰å…¨çŠ¶æ€</strong>ã€‚</li><li>å¦‚æœè¿˜æœ‰çº¿ç¨‹çš„<code>Finish</code>ä¸º<code>false</code>ï¼Œåˆ™è¯´æ˜ç³»ç»Ÿå¤„äº<strong>ä¸å®‰å…¨çŠ¶æ€</strong>ï¼Œå¯èƒ½å­˜åœ¨æ­»é”ã€‚</li></ul></li></ol><hr><h3 id="é“¶è¡Œå®¶ç®—æ³•çš„æµç¨‹ï¼šèµ„æºåˆ†é…"><a href="#é“¶è¡Œå®¶ç®—æ³•çš„æµç¨‹ï¼šèµ„æºåˆ†é…" class="headerlink" title="é“¶è¡Œå®¶ç®—æ³•çš„æµç¨‹ï¼šèµ„æºåˆ†é…"></a>é“¶è¡Œå®¶ç®—æ³•çš„æµç¨‹ï¼šèµ„æºåˆ†é…</h3><p>å½“ä¸€ä¸ªçº¿ç¨‹<code>P</code>è¯·æ±‚èµ„æºæ—¶ï¼Œé“¶è¡Œå®¶ç®—æ³•ä¼šæ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š</p><ol><li><strong>è¯·æ±‚æ£€æŸ¥ï¼š</strong> æ£€æŸ¥çº¿ç¨‹<code>P</code>è¯·æ±‚çš„èµ„æºæ•°é‡æ˜¯å¦å°äºæˆ–ç­‰äºå…¶<code>Need</code>å‘é‡ä¸­çš„éœ€æ±‚é‡ã€‚å¦‚æœä¸æ˜¯ï¼Œè¯´æ˜çº¿ç¨‹<code>P</code>çš„è¯·æ±‚ä¸åˆç†ï¼Œæ‹’ç»åˆ†é…ã€‚</li><li><strong>å¯ç”¨æ€§æ£€æŸ¥ï¼š</strong> æ£€æŸ¥çº¿ç¨‹<code>P</code>è¯·æ±‚çš„èµ„æºæ•°é‡æ˜¯å¦å°äºæˆ–ç­‰äºå½“å‰<code>Available</code>ä¸­çš„èµ„æºæ•°é‡ã€‚å¦‚æœä¸æ˜¯ï¼Œè¯´æ˜èµ„æºä¸è¶³ï¼Œçº¿ç¨‹<code>P</code>éœ€è¦ç­‰å¾…ã€‚</li><li><strong>é¢„åˆ†é…å¹¶è¿›è¡Œå®‰å…¨æ€§æ£€æŸ¥ï¼š</strong><ul><li>å‡è®¾èµ„æºå¯ä»¥åˆ†é…ï¼Œ<strong>ä¸´æ—¶</strong>è¿›è¡Œä»¥ä¸‹æ“ä½œï¼š<ul><li><code>Available = Available - Request</code></li><li><code>Allocation[P] = Allocation[P] + Request</code></li><li><code>Need[P] = Need[P] - Request</code></li></ul></li><li>è°ƒç”¨ä¸Šé¢çš„<strong>å®‰å…¨æ€§æ£€æŸ¥ç®—æ³•</strong>ï¼Œåˆ¤æ–­ç³»ç»Ÿæ˜¯å¦å¤„äºå®‰å…¨çŠ¶æ€ã€‚</li></ul></li><li><strong>æ­£å¼åˆ†é…æˆ–æ‹’ç»ï¼š</strong><ul><li>å¦‚æœå®‰å…¨æ€§æ£€æŸ¥çš„ç»“æœæ˜¯<strong>å®‰å…¨</strong>ï¼Œåˆ™æ­£å¼åˆ†é…èµ„æºï¼Œå¹¶ä¿ç•™æ­¥éª¤3ä¸­çš„ä¿®æ”¹ã€‚</li><li>å¦‚æœå®‰å…¨æ€§æ£€æŸ¥çš„ç»“æœæ˜¯<strong>ä¸å®‰å…¨</strong>ï¼Œåˆ™å›æ»šæ­¥éª¤3ä¸­çš„æ‰€æœ‰ä¸´æ—¶ä¿®æ”¹ï¼Œæ‹’ç»åˆ†é…èµ„æºï¼Œçº¿ç¨‹<code>P</code>éœ€è¦ç­‰å¾…ã€‚</li></ul></li></ol><h3 id="é“¶è¡Œå®¶ç®—æ³•çš„ä¼˜ç¼ºç‚¹"><a href="#é“¶è¡Œå®¶ç®—æ³•çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="é“¶è¡Œå®¶ç®—æ³•çš„ä¼˜ç¼ºç‚¹"></a>é“¶è¡Œå®¶ç®—æ³•çš„ä¼˜ç¼ºç‚¹</h3><ul><li><strong>ä¼˜ç‚¹ï¼š</strong><ul><li>å¯ä»¥æœ‰æ•ˆåœ°é¿å…æ­»é”çš„å‘ç”Ÿï¼Œä¿è¯ç³»ç»Ÿçš„å®‰å…¨æ€§ã€‚</li><li>é€šè¿‡æå‰æ£€æŸ¥ï¼Œå¯ä»¥æœ€å¤§åŒ–åœ°åˆ©ç”¨èµ„æºï¼Œæé«˜ç³»ç»Ÿçš„å¹¶å‘æ€§ã€‚</li></ul></li><li><strong>ç¼ºç‚¹ï¼š</strong><ul><li><strong>è®¡ç®—å¼€é”€å¤§ï¼š</strong> æ¯æ¬¡åˆ†é…èµ„æºéƒ½éœ€è¦è¿è¡Œå®‰å…¨æ€§æ£€æŸ¥ç®—æ³•ï¼Œå¢åŠ äº†ç³»ç»Ÿçš„å¼€é”€ã€‚</li><li><strong>è¿‡äºä¿å®ˆï¼š</strong> å®‰å…¨çŠ¶æ€ä¸ç­‰äºæ— æ­»é”ï¼Œä¸å®‰å…¨çŠ¶æ€ä¹Ÿä¸ç­‰äºä¸€å®šå‘ç”Ÿæ­»é”ã€‚ç®—æ³•ä¸ºäº†ç¡®ä¿å®‰å…¨ï¼Œå¯èƒ½ä¼šæ‹’ç»ä¸€äº›æœ¬å¯ä»¥æˆåŠŸåˆ†é…çš„è¯·æ±‚ï¼Œä»è€Œé™ä½äº†ç³»ç»Ÿçš„ååé‡ã€‚</li><li><strong>æ¡ä»¶è‹›åˆ»ï¼š</strong> ç®—æ³•è¦æ±‚çº¿ç¨‹åœ¨å¼€å§‹å‰å°±å£°æ˜å…¶æ‰€éœ€çš„æœ€å¤§èµ„æºé‡ï¼Œè¿™åœ¨å®é™…åº”ç”¨ä¸­å¾ˆéš¾åšåˆ°ã€‚</li><li><strong>èµ„æºæ•°é‡å›ºå®šï¼š</strong> ç®—æ³•å‡è®¾ç³»ç»Ÿä¸­èµ„æºçš„æ•°é‡æ˜¯å›ºå®šçš„ï¼Œä¸èƒ½åŠ¨æ€å¢å‡ã€‚</li></ul></li></ul><p>å› æ­¤ï¼Œé“¶è¡Œå®¶ç®—æ³•è™½ç„¶åœ¨ç†è®ºä¸Šéå¸¸å®Œç¾ï¼Œä½†åœ¨å®é™…æ“ä½œç³»ç»Ÿä¸­å¾ˆå°‘è¢«ç›´æ¥å®Œæ•´åœ°å®ç°ã€‚ç„¶è€Œï¼Œå®ƒçš„æ ¸å¿ƒæ€æƒ³â€”â€”<strong>é€šè¿‡å®‰å…¨æ€§æ£€æŸ¥æ¥é¿å…æ­»é”</strong>â€”â€”ä»ç„¶æ˜¯è®¸å¤šå¹¶å‘æ§åˆ¶ç­–ç•¥çš„é‡è¦ç†è®ºåŸºç¡€ã€‚                                     </p><h3 id="å®é™…åº”ç”¨ä¸­çš„æ­»é”å¤„ç†"><a href="#å®é™…åº”ç”¨ä¸­çš„æ­»é”å¤„ç†" class="headerlink" title="å®é™…åº”ç”¨ä¸­çš„æ­»é”å¤„ç†"></a>å®é™…åº”ç”¨ä¸­çš„æ­»é”å¤„ç†</h3><p>åœ¨å®é™…çš„å¹¶å‘ç¼–ç¨‹å’Œæ•°æ®åº“ç³»ç»Ÿä¸­ï¼Œæœ€å¸¸è§çš„æ­»é”å¤„ç†æ–¹å¼æ˜¯ï¼š</p><ul><li><p>æ­»é”é¢„é˜²(é€šè¿‡ç¼–ç¨‹è§„èŒƒ)ï¼š</p><ul><li>åŠ é”é¡ºåºä¸€è‡´ï¼šè§„å®šæ‰€æœ‰çº¿ç¨‹åœ¨è·å–å¤šä¸ªé”æ—¶ï¼Œå¿…é¡»æŒ‰ç…§ç›¸åŒçš„é¡ºåºã€‚è¿™æ˜¯æœ€æœ‰æ•ˆçš„é¢„é˜²æ­»é”çš„ç¼–ç¨‹å®è·µã€‚</li><li>ä½¿ç”¨è¶…æ—¶é”ï¼šå°è¯•è·å–é”æ—¶è®¾ç½®ä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œå¦‚æœè¶…æ—¶æœªè·å–åˆ°é”ï¼Œåˆ™æ”¾å¼ƒæœ¬æ¬¡æ“ä½œå¹¶é‡Šæ”¾å·²æŒæœ‰çš„é”ï¼Œç„¶åé‡è¯•ã€‚è¿™ç ´åäº†â€è¯·æ±‚ä¸ä¿æŒâ€æ¡ä»¶ã€‚ä¾‹å¦‚Javaçš„ReentrantLocktryLock(timeout)ã€‚</li><li>é¿å…åµŒå¥—é”ï¼šå°½é‡å‡å°‘æŒæœ‰å¤šä¸ªé”çš„æƒ…å†µã€‚</li></ul></li><li><p>æ­»é”æ£€æµ‹ä¸æ¢å¤(æ•°æ®åº“ç³»ç»Ÿ)ï¼š</p><ul><li>å¤§å¤šæ•°å…³ç³»å‹æ•°æ®åº“(å¦‚MySQL InnoDB)éƒ½å®ç°äº†æ­»é”æ£€æµ‹æœºåˆ¶ã€‚å½“æ£€æµ‹åˆ°æ­»é”æ—¶ï¼Œæ•°æ®åº“ä¼šè‡ªåŠ¨é€‰æ‹©ä¸€ä¸ªæˆæœ¬è¾ƒä½çš„äº‹åŠ¡(â€œç‰ºç‰²å“â€)è¿›è¡Œå›æ»šï¼Œä»è€Œè§£é™¤æ­»é”ã€‚å®¢æˆ·ç«¯åº”ç”¨ä¼šæ”¶åˆ°ç›¸åº”çš„é”™è¯¯ç (ä¾‹å¦‚MySQLä¸­çš„Deadlock found when trying to get lock; try restarting transaction)ã€‚åº”ç”¨ç¨‹åºé€šå¸¸éœ€è¦æ•è·è¿™ä¸ªé”™è¯¯å¹¶é‡è¯•äº‹åŠ¡ã€‚ç†è§£æ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶æ˜¯å…³é”®ï¼Œå› ä¸ºè§£å†³æ­»é”çš„æ ¹æœ¬æ–¹æ³•å°±æ˜¯ç ´åå…¶ä¸­ä¸€ä¸ªæˆ–å¤šä¸ªæ¡ä»¶ã€‚</li></ul></li></ul><h2 id="é”æ‰©å±•ï¼š"><a href="#é”æ‰©å±•ï¼š" class="headerlink" title="é”æ‰©å±•ï¼š"></a>é”æ‰©å±•ï¼š</h2><h3 id="18-è°ˆè°ˆ-synchronized-å’Œ-ReentrantLock-çš„åŒºåˆ«ï¼Ÿ"><a href="#18-è°ˆè°ˆ-synchronized-å’Œ-ReentrantLock-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="18. è°ˆè°ˆ synchronized å’Œ ReentrantLock çš„åŒºåˆ«ï¼Ÿ"></a>18. è°ˆè°ˆ synchronized å’Œ ReentrantLock çš„åŒºåˆ«ï¼Ÿ</h3><ol><li><code>synchronized</code> æ˜¯å’Œ <code>for</code>ã€<code>while</code> ä¸€æ ·çš„å…³é”®å­—ï¼Œ<code>ReentrantLock</code> æ˜¯ç±»ï¼Œè¿™æ˜¯äºŒè€…çš„æœ¬è´¨åŒºåˆ«ã€‚æ—¢ç„¶ <code>ReentrantLock</code> æ˜¯ç±»ï¼Œé‚£ä¹ˆå®ƒå°±æä¾›äº†æ¯” <code>synchronized</code> æ›´å¤šæ›´çµæ´»çš„ç‰¹æ€§ï¼šç­‰å¾…å¯ä¸­æ–­ã€å¯å®ç°å…¬å¹³é”ã€å¯å®ç°é€‰æ‹©æ€§é€šçŸ¥ï¼ˆé”å¯ä»¥ç»‘å®šå¤šä¸ªæ¡ä»¶ï¼‰ã€æ€§èƒ½å·²ä¸æ˜¯é€‰æ‹©æ ‡å‡†ã€‚</li><li><code>synchronized</code> ä¾èµ–äº JVM è€Œ <code>ReenTrantLock</code> ä¾èµ–äº APIã€‚<code>synchronized</code> æ˜¯ä¾èµ–äº JVM å®ç°çš„ï¼ŒJDK1.6 ä¸º <code>synchronized</code> å…³é”®å­—è¿›è¡Œäº†å¾ˆå¤šä¼˜åŒ–ï¼Œä½†æ˜¯è¿™äº›ä¼˜åŒ–éƒ½æ˜¯åœ¨è™šæ‹Ÿæœºå±‚é¢å®ç°çš„ï¼Œå¹¶æ²¡æœ‰ç›´æ¥æš´éœ²ç»™æˆ‘ä»¬ã€‚<code>ReenTrantLock</code> æ˜¯ JDK å±‚é¢å®ç°çš„ï¼ˆä¹Ÿå°±æ˜¯ API å±‚é¢ï¼Œéœ€è¦ <code>lock()</code> å’Œ <code>unlock</code> æ–¹æ³•é…åˆ <code>try/finally</code> è¯­å¥å—æ¥å®Œæˆï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥çœ‹å®ƒçš„æºä»£ç ï¼Œæ¥çœ‹å®ƒæ˜¯å¦‚ä½•å®ç°çš„ã€‚</li></ol><hr><h3 id="19-synchronized-å’Œ-volatile-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#19-synchronized-å’Œ-volatile-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="19. synchronized å’Œ volatile çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"></a>19. synchronized å’Œ volatile çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h3><ol><li><code>volatile</code> æœ¬è´¨æ˜¯åœ¨å‘Šè¯‰ JVM å½“å‰å˜é‡åœ¨å¯„å­˜å™¨ï¼ˆå·¥ä½œå†…å­˜ï¼‰ä¸­çš„å€¼æ˜¯ä¸ç¡®å®šçš„ï¼Œéœ€è¦ä»ä¸»å­˜ä¸­è¯»å–ï¼›<code>synchronized</code> åˆ™æ˜¯é”å®šå½“å‰å˜é‡ï¼Œåªæœ‰å½“å‰çº¿ç¨‹å¯ä»¥è®¿é—®è¯¥å˜é‡ï¼Œå…¶ä»–çº¿ç¨‹è¢«é˜»å¡ä½ã€‚</li><li><code>volatile</code> ä»…èƒ½ä½¿ç”¨åœ¨å˜é‡çº§åˆ«ï¼›<code>synchronized</code> åˆ™å¯ä»¥ä½¿ç”¨åœ¨å˜é‡ã€æ–¹æ³•ã€å’Œç±»çº§åˆ«çš„ã€‚</li><li><code>volatile</code> ä»…èƒ½å®ç°å˜é‡çš„ä¿®æ”¹å¯è§æ€§ï¼Œä¸èƒ½ä¿è¯åŸå­æ€§ï¼›è€Œ <code>synchronized</code> åˆ™å¯ä»¥ä¿è¯å˜é‡çš„ä¿®æ”¹å¯è§æ€§å’ŒåŸå­æ€§ã€‚</li><li><code>volatile</code> ä¸ä¼šé€ æˆçº¿ç¨‹çš„é˜»å¡ï¼›<code>synchronized</code> å¯èƒ½ä¼šé€ æˆçº¿ç¨‹çš„é˜»å¡ã€‚</li><li><code>volatile</code> æ ‡è®°çš„å˜é‡ä¸ä¼šè¢«ç¼–è¯‘å™¨ä¼˜åŒ–ï¼›<code>synchronized</code> æ ‡è®°çš„å˜é‡å¯ä»¥è¢«ç¼–è¯‘å™¨ä¼˜åŒ–ã€‚</li></ol><hr><h3 id="20-è°ˆä¸€ä¸‹ä½ å¯¹-volatile-å…³é”®å­—çš„ç†è§£ï¼Ÿ"><a href="#20-è°ˆä¸€ä¸‹ä½ å¯¹-volatile-å…³é”®å­—çš„ç†è§£ï¼Ÿ" class="headerlink" title="20. è°ˆä¸€ä¸‹ä½ å¯¹ volatile å…³é”®å­—çš„ç†è§£ï¼Ÿ"></a>20. è°ˆä¸€ä¸‹ä½ å¯¹ volatile å…³é”®å­—çš„ç†è§£ï¼Ÿ</h3><p><code>volatile</code> å…³é”®å­—æ˜¯ç”¨æ¥ä¿è¯æœ‰åºæ€§å’Œå¯è§æ€§çš„ã€‚è¿™è·Ÿ Java å†…å­˜æ¨¡å‹æœ‰å…³ã€‚æˆ‘ä»¬æ‰€å†™çš„ä»£ç ï¼Œä¸ä¸€å®šæ˜¯æŒ‰ç…§æˆ‘ä»¬è‡ªå·±ä¹¦å†™çš„é¡ºåºæ¥æ‰§è¡Œçš„ï¼Œç¼–è¯‘å™¨ä¼šåšé‡æ’åºï¼ŒCPU ä¹Ÿä¼šåšé‡æ’åºçš„ï¼Œè¿™æ ·åšæ˜¯ä¸ºäº†å‡å°‘æµæ°´çº¿é˜»å¡ï¼Œæé«˜ CPU çš„æ‰§è¡Œæ•ˆç‡ã€‚è¿™å°±éœ€è¦æœ‰ä¸€å®šçš„é¡ºåºå’Œè§„åˆ™æ¥ä¿è¯ï¼Œä¸ç„¶ç¨‹åºå‘˜è‡ªå·±å†™çš„ä»£ç éƒ½ä¸çŸ¥é“å¯¹ä¸å¯¹äº†ï¼Œæ‰€ä»¥æœ‰ <code>happens-before</code> è§„åˆ™ï¼Œå…¶ä¸­æœ‰æ¡å°±æ˜¯ <code>volatile</code> å˜é‡è§„åˆ™ï¼šå¯¹ä¸€ä¸ªå˜é‡çš„å†™æ“ä½œå…ˆè¡Œå‘ç”Ÿäºåé¢é¢å¯¹è¿™ä¸ªå˜é‡çš„è¯»æ“ä½œã€æœ‰åºæ€§å®ç°çš„æ˜¯é€šè¿‡æ’å…¥å†…å­˜å±éšœæ¥ä¿è¯çš„ã€‚</p><p>è¢« <code>volatile</code> ä¿®é¥°çš„å…±äº«å˜é‡ï¼Œå°±å…·æœ‰äº†ä»¥ä¸‹ä¸¤ç‚¹ç‰¹æ€§ï¼š</p><ol><li>ä¿è¯äº†ä¸åŒçº¿ç¨‹å¯¹è¯¥å˜é‡æ“ä½œçš„å†…å­˜å¯è§æ€§;</li><li>ç¦æ­¢æŒ‡ä»¤é‡æ’åºã€‚</li></ol><p>å¤‡æ³¨ï¼šè¿™ä¸ªé¢˜å¦‚æœæ‰©å±•äº†ç­”ï¼Œå¯ä»¥ä» Java çš„å†…å­˜æ¨¡å‹å…¥æ‰‹ï¼Œä¸‹ä¸€ç¯‡ Java è™šæ‹Ÿæœºé«˜é¢‘é¢è¯•é¢˜ä¸­ä¼šè®²åˆ°ï¼Œè¿™é‡Œä¸åšè¿‡å¤šèµ˜è¿°ã€‚</p><hr><h3 id="21-è¯´ä¸‹å¯¹-ReentrantReadWriteLock-çš„ç†è§£ï¼Ÿ"><a href="#21-è¯´ä¸‹å¯¹-ReentrantReadWriteLock-çš„ç†è§£ï¼Ÿ" class="headerlink" title="21. è¯´ä¸‹å¯¹ ReentrantReadWriteLock çš„ç†è§£ï¼Ÿ"></a>21. è¯´ä¸‹å¯¹ ReentrantReadWriteLock çš„ç†è§£ï¼Ÿ</h3><p><code>ReentrantReadWriteLock</code> å…è®¸å¤šä¸ªè¯»çº¿ç¨‹åŒæ—¶è®¿é—®ï¼Œä½†æ˜¯ä¸å…è®¸å†™çº¿ç¨‹å’Œè¯»çº¿ç¨‹ã€å†™çº¿ç¨‹å’Œå†™çº¿ç¨‹åŒæ—¶è®¿é—®ã€‚è¯»å†™é”å†…éƒ¨ç»´æŠ¤äº†ä¸¤ä¸ªé”ï¼šä¸€ä¸ªæ˜¯ç”¨äºè¯»æ“ä½œçš„ <code>ReadLock</code>ï¼Œä¸€ä¸ªæ˜¯ç”¨äºå†™æ“ä½œçš„ <code>WriteLock</code>ã€‚è¯»å†™é” <code>ReentrantReadWriteLock</code> å¯ä»¥ä¿è¯å¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è¯»ï¼Œæ‰€ä»¥åœ¨è¯»æ“ä½œè¿œå¤§äºå†™æ“ä½œçš„æ—¶å€™ï¼Œè¯»å†™é”å°±éå¸¸æœ‰ç”¨äº†ã€‚</p><p><code>ReentrantReadWriteLock</code> åŸºäº <code>AQS</code> å®ç°ï¼Œå®ƒçš„è‡ªå®šä¹‰åŒæ­¥å™¨ï¼ˆç»§æ‰¿ <code>AQS</code>ï¼‰éœ€è¦åœ¨åŒæ­¥çŠ¶æ€ <code>state</code> ä¸Šç»´æŠ¤å¤šä¸ªè¯»çº¿ç¨‹å’Œä¸€ä¸ªå†™çº¿ç¨‹ï¼Œè¯¥çŠ¶æ€çš„è®¾è®¡æˆä¸ºå®ç°è¯»å†™é”çš„å…³é”®ã€‚<code>ReentrantReadWriteLock</code> å¾ˆå¥½çš„åˆ©ç”¨äº†é«˜ä½ä½ã€‚æ¥å®ç°ä¸€ä¸ªæ•´å‹æ§åˆ¶ä¸¤ç§çŠ¶æ€çš„åŠŸèƒ½ï¼Œè¯»å†™é”å°†å˜é‡åˆ‡åˆ†æˆäº†ä¸¤ä¸ªéƒ¨åˆ†ï¼Œé«˜ 16 ä½è¡¨ç¤ºè¯»ï¼Œä½ 16 ä½è¡¨ç¤ºå†™ã€‚</p><p><strong>ReentrantReadWriteLock çš„ç‰¹ç‚¹</strong>ï¼š</p><ol><li>å†™é”å¯ä»¥é™çº§ä¸ºè¯»é”ï¼Œä½†æ˜¯è¯»é”ä¸èƒ½å‡çº§ä¸ºå†™é”ï¼›</li><li>ä¸ç®¡æ˜¯ <code>ReadLock</code> è¿˜æ˜¯ <code>WriteLock</code> éƒ½æ”¯æŒ <code>Interrupt</code>ï¼Œè¯­ä¹‰ä¸ <code>ReentrantLock</code> ä¸€è‡´ï¼›</li><li><code>WriteLock</code> æ”¯æŒ <code>Condition</code> å¹¶ä¸”ä¸ <code>ReentrantLock</code> è¯­ä¹‰ä¸€è‡´ï¼Œè€Œ <code>ReadLock</code> åˆ™ä¸èƒ½ä½¿ç”¨ <code>Condition</code>ï¼Œå¦åˆ™æŠ›å‡º <code>UnsupportedOperationException</code> å¼‚å¸¸ï¼›</li><li>é»˜è®¤æ„é€ æ–¹æ³•ä¸ºéå…¬å¹³æ¨¡å¼ ï¼Œå¼€å‘è€…ä¹Ÿå¯ä»¥é€šè¿‡æŒ‡å®š <code>fair</code> ä¸º <code>true</code> è®¾ç½®ä¸ºå…¬å¹³æ¨¡å¼ ã€‚</li></ol><p><strong>å‡çº§&#x2F;é™çº§</strong></p><ol><li>è¯»é”é‡Œé¢åŠ å†™é”ï¼Œä¼šå¯¼è‡´æ­»é”ï¼›</li><li>å†™é”é‡Œé¢æ˜¯å¯ä»¥åŠ è¯»é”çš„ï¼Œè¿™å°±æ˜¯é”çš„é™çº§ã€‚</li></ol><h2 id="å¤šçº¿ç¨‹ä¸çº¿ç¨‹æ± "><a href="#å¤šçº¿ç¨‹ä¸çº¿ç¨‹æ± " class="headerlink" title="å¤šçº¿ç¨‹ä¸çº¿ç¨‹æ± "></a>å¤šçº¿ç¨‹ä¸çº¿ç¨‹æ± </h2><p>åœ¨ Java ä¸­ï¼Œå¤šçº¿ç¨‹æ˜¯å®ç°å¹¶å‘ç¼–ç¨‹çš„å…³é”®æŠ€æœ¯ï¼Œå®ƒå…è®¸ç¨‹åºåŒæ—¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡ã€‚çº¿ç¨‹æ± åˆ™æ˜¯ç®¡ç†å’Œå¤ç”¨çº¿ç¨‹çš„é‡è¦æœºåˆ¶ï¼Œèƒ½æœ‰æ•ˆæå‡ç³»ç»Ÿæ€§èƒ½å’Œèµ„æºåˆ©ç”¨ç‡ã€‚</p><h3 id="â­ï¸ä»€ä¹ˆæ˜¯çº¿ç¨‹å’Œè¿›ç¨‹"><a href="#â­ï¸ä»€ä¹ˆæ˜¯çº¿ç¨‹å’Œè¿›ç¨‹" class="headerlink" title="â­ï¸ä»€ä¹ˆæ˜¯çº¿ç¨‹å’Œè¿›ç¨‹?"></a><a href="#%E2%AD%90%EF%B8%8F%E4%BB%80%E4%B9%88%E6%98%AF%E7%BA%BF%E7%A8%8B%E5%92%8C%E8%BF%9B%E7%A8%8B">â­ï¸ä»€ä¹ˆæ˜¯çº¿ç¨‹å’Œè¿›ç¨‹?</a></h3><h4 id="ä½•ä¸ºè¿›ç¨‹"><a href="#ä½•ä¸ºè¿›ç¨‹" class="headerlink" title="ä½•ä¸ºè¿›ç¨‹?"></a><a href="#%E4%BD%95%E4%B8%BA%E8%BF%9B%E7%A8%8B">ä½•ä¸ºè¿›ç¨‹?</a></h4><p>è¿›ç¨‹æ˜¯ç¨‹åºçš„ä¸€æ¬¡æ‰§è¡Œè¿‡ç¨‹ï¼Œæ˜¯ç³»ç»Ÿè¿è¡Œç¨‹åºçš„åŸºæœ¬å•ä½ï¼Œå› æ­¤è¿›ç¨‹æ˜¯åŠ¨æ€çš„ã€‚ç³»ç»Ÿè¿è¡Œä¸€ä¸ªç¨‹åºå³æ˜¯ä¸€ä¸ªè¿›ç¨‹ä»åˆ›å»ºï¼Œè¿è¡Œåˆ°æ¶ˆäº¡çš„è¿‡ç¨‹ã€‚</p><p>åœ¨ Java ä¸­ï¼Œå½“æˆ‘ä»¬å¯åŠ¨ main å‡½æ•°æ—¶å…¶å®å°±æ˜¯å¯åŠ¨äº†ä¸€ä¸ª JVM çš„è¿›ç¨‹ï¼Œè€Œ main å‡½æ•°æ‰€åœ¨çš„çº¿ç¨‹å°±æ˜¯è¿™ä¸ªè¿›ç¨‹ä¸­çš„ä¸€ä¸ªçº¿ç¨‹ï¼Œä¹Ÿç§°ä¸»çº¿ç¨‹ã€‚</p><h4 id="ä½•ä¸ºçº¿ç¨‹"><a href="#ä½•ä¸ºçº¿ç¨‹" class="headerlink" title="ä½•ä¸ºçº¿ç¨‹?"></a><a href="#%E4%BD%95%E4%B8%BA%E7%BA%BF%E7%A8%8B">ä½•ä¸ºçº¿ç¨‹?</a></h4><p>çº¿ç¨‹ä¸è¿›ç¨‹ç›¸ä¼¼ï¼Œä½†çº¿ç¨‹æ˜¯ä¸€ä¸ªæ¯”è¿›ç¨‹æ›´å°çš„æ‰§è¡Œå•ä½ã€‚ä¸€ä¸ªè¿›ç¨‹åœ¨å…¶æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å¯ä»¥äº§ç”Ÿå¤šä¸ªçº¿ç¨‹ã€‚ä¸è¿›ç¨‹ä¸åŒçš„æ˜¯åŒç±»çš„å¤šä¸ªçº¿ç¨‹å…±äº«è¿›ç¨‹çš„<strong>å †</strong>å’Œ<strong>æ–¹æ³•åŒº</strong>èµ„æºï¼Œä½†æ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„<strong>ç¨‹åºè®¡æ•°å™¨</strong>ã€<strong>è™šæ‹Ÿæœºæ ˆ</strong>å’Œ<strong>æœ¬åœ°æ–¹æ³•æ ˆ</strong>ï¼Œæ‰€ä»¥ç³»ç»Ÿåœ¨äº§ç”Ÿä¸€ä¸ªçº¿ç¨‹ï¼Œæˆ–æ˜¯åœ¨å„ä¸ªçº¿ç¨‹ä¹‹é—´åšåˆ‡æ¢å·¥ä½œæ—¶ï¼Œè´Ÿæ‹…è¦æ¯”è¿›ç¨‹å°å¾—å¤šï¼Œä¹Ÿæ­£å› ä¸ºå¦‚æ­¤ï¼Œçº¿ç¨‹ä¹Ÿè¢«ç§°ä¸ºè½»é‡çº§è¿›ç¨‹ã€‚</p><hr><p>ä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹ï¼Œå¤šä¸ªçº¿ç¨‹å…±äº«è¿›ç¨‹çš„<strong>å †</strong>å’Œ<strong>æ–¹æ³•åŒº (JDK1.8 ä¹‹åçš„å…ƒç©ºé—´)èµ„æºï¼Œä½†æ˜¯æ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„ç¨‹åºè®¡æ•°å™¨</strong>ã€<strong>è™šæ‹Ÿæœºæ ˆ</strong> å’Œ <strong>æœ¬åœ°æ–¹æ³•æ ˆ</strong>ã€‚</p><p><strong>æ€»ç»“ï¼š</strong> çº¿ç¨‹æ˜¯è¿›ç¨‹åˆ’åˆ†æˆçš„æ›´å°çš„è¿è¡Œå•ä½ã€‚çº¿ç¨‹å’Œè¿›ç¨‹æœ€å¤§çš„ä¸åŒåœ¨äºåŸºæœ¬ä¸Šå„è¿›ç¨‹æ˜¯ç‹¬ç«‹çš„ï¼Œè€Œå„çº¿ç¨‹åˆ™ä¸ä¸€å®šï¼Œå› ä¸ºåŒä¸€è¿›ç¨‹ä¸­çš„çº¿ç¨‹ææœ‰å¯èƒ½ä¼šç›¸äº’å½±å“ã€‚çº¿ç¨‹æ‰§è¡Œå¼€é”€å°ï¼Œä½†ä¸åˆ©äºèµ„æºçš„ç®¡ç†å’Œä¿æŠ¤ï¼›è€Œè¿›ç¨‹æ­£ç›¸åã€‚</p><hr><h4 id="ç¨‹åºè®¡æ•°å™¨ä¸ºä»€ä¹ˆæ˜¯ç§æœ‰çš„"><a href="#ç¨‹åºè®¡æ•°å™¨ä¸ºä»€ä¹ˆæ˜¯ç§æœ‰çš„" class="headerlink" title="ç¨‹åºè®¡æ•°å™¨ä¸ºä»€ä¹ˆæ˜¯ç§æœ‰çš„?"></a><a href="#%E7%A8%8B%E5%BA%8F%E8%AE%A1%E6%95%B0%E5%99%A8%E4%B8%BA%E4%BB%80%E4%B9%88%E6%98%AF%E7%A7%81%E6%9C%89%E7%9A%84">ç¨‹åºè®¡æ•°å™¨ä¸ºä»€ä¹ˆæ˜¯ç§æœ‰çš„?</a></h4><p>ç¨‹åºè®¡æ•°å™¨ä¸»è¦æœ‰ä¸‹é¢ä¸¤ä¸ªä½œç”¨ï¼š</p><ol><li>å­—èŠ‚ç è§£é‡Šå™¨é€šè¿‡æ”¹å˜ç¨‹åºè®¡æ•°å™¨æ¥ä¾æ¬¡è¯»å–æŒ‡ä»¤ï¼Œä»è€Œå®ç°ä»£ç çš„æµç¨‹æ§åˆ¶ï¼Œå¦‚ï¼šé¡ºåºæ‰§è¡Œã€é€‰æ‹©ã€å¾ªç¯ã€å¼‚å¸¸å¤„ç†ã€‚</li><li>åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œç¨‹åºè®¡æ•°å™¨ç”¨äºè®°å½•å½“å‰çº¿ç¨‹æ‰§è¡Œçš„ä½ç½®ï¼Œä»è€Œå½“çº¿ç¨‹è¢«åˆ‡æ¢å›æ¥çš„æ—¶å€™èƒ½å¤ŸçŸ¥é“è¯¥çº¿ç¨‹ä¸Šæ¬¡è¿è¡Œåˆ°å“ªå„¿äº†ã€‚</li></ol><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæ‰§è¡Œçš„æ˜¯ native æ–¹æ³•ï¼Œé‚£ä¹ˆç¨‹åºè®¡æ•°å™¨è®°å½•çš„æ˜¯ undefined åœ°å€ï¼Œåªæœ‰æ‰§è¡Œçš„æ˜¯ Java ä»£ç æ—¶ç¨‹åºè®¡æ•°å™¨è®°å½•çš„æ‰æ˜¯ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ã€‚</p><p>æ‰€ä»¥ï¼Œç¨‹åºè®¡æ•°å™¨ç§æœ‰ä¸»è¦æ˜¯ä¸ºäº†<strong>çº¿ç¨‹åˆ‡æ¢åèƒ½æ¢å¤åˆ°æ­£ç¡®çš„æ‰§è¡Œä½ç½®</strong>ã€‚</p><h4 id="è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆä¸ºä»€ä¹ˆæ˜¯ç§æœ‰çš„"><a href="#è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆä¸ºä»€ä¹ˆæ˜¯ç§æœ‰çš„" class="headerlink" title="è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆä¸ºä»€ä¹ˆæ˜¯ç§æœ‰çš„?"></a><a href="#%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88%E5%92%8C%E6%9C%AC%E5%9C%B0%E6%96%B9%E6%B3%95%E6%A0%88%E4%B8%BA%E4%BB%80%E4%B9%88%E6%98%AF%E7%A7%81%E6%9C%89%E7%9A%84">è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆä¸ºä»€ä¹ˆæ˜¯ç§æœ‰çš„?</a></h4><ul><li><strong>è™šæ‹Ÿæœºæ ˆï¼š</strong> æ¯ä¸ª Java æ–¹æ³•åœ¨æ‰§è¡Œä¹‹å‰ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€å¸¸é‡æ± å¼•ç”¨ç­‰ä¿¡æ¯ã€‚ä»æ–¹æ³•è°ƒç”¨ç›´è‡³æ‰§è¡Œå®Œæˆçš„è¿‡ç¨‹ï¼Œå°±å¯¹åº”ç€ä¸€ä¸ªæ ˆå¸§åœ¨ Java è™šæ‹Ÿæœºæ ˆä¸­å…¥æ ˆå’Œå‡ºæ ˆçš„è¿‡ç¨‹ã€‚</li><li><strong>æœ¬åœ°æ–¹æ³•æ ˆï¼š</strong> å’Œè™šæ‹Ÿæœºæ ˆæ‰€å‘æŒ¥çš„ä½œç”¨éå¸¸ç›¸ä¼¼ï¼ŒåŒºåˆ«æ˜¯ï¼š<strong>è™šæ‹Ÿæœºæ ˆä¸ºè™šæ‹Ÿæœºæ‰§è¡Œ Java æ–¹æ³• ï¼ˆä¹Ÿå°±æ˜¯å­—èŠ‚ç ï¼‰æœåŠ¡ï¼Œè€Œæœ¬åœ°æ–¹æ³•æ ˆåˆ™ä¸ºè™šæ‹Ÿæœºä½¿ç”¨åˆ°çš„ Native æ–¹æ³•æœåŠ¡ã€‚</strong> åœ¨ HotSpot è™šæ‹Ÿæœºä¸­å’Œ Java è™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€ã€‚</li></ul><p>æ‰€ä»¥ï¼Œä¸ºäº†<strong>ä¿è¯çº¿ç¨‹ä¸­çš„å±€éƒ¨å˜é‡ä¸è¢«åˆ«çš„çº¿ç¨‹è®¿é—®åˆ°</strong>ï¼Œè™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ã€‚</p><h4 id="ä¸€å¥è¯ç®€å•äº†è§£å †å’Œæ–¹æ³•åŒº"><a href="#ä¸€å¥è¯ç®€å•äº†è§£å †å’Œæ–¹æ³•åŒº" class="headerlink" title="ä¸€å¥è¯ç®€å•äº†è§£å †å’Œæ–¹æ³•åŒº"></a><a href="#%E4%B8%80%E5%8F%A5%E8%AF%9D%E7%AE%80%E5%8D%95%E4%BA%86%E8%A7%A3%E5%A0%86%E5%92%8C%E6%96%B9%E6%B3%95%E5%8C%BA">ä¸€å¥è¯ç®€å•äº†è§£å †å’Œæ–¹æ³•åŒº</a></h4><p>å †å’Œæ–¹æ³•åŒºæ˜¯æ‰€æœ‰çº¿ç¨‹å…±äº«çš„èµ„æºï¼Œå…¶ä¸­å †æ˜¯è¿›ç¨‹ä¸­æœ€å¤§çš„ä¸€å—å†…å­˜ï¼Œä¸»è¦ç”¨äºå­˜æ”¾æ–°åˆ›å»ºçš„å¯¹è±¡ (å‡ ä¹æ‰€æœ‰å¯¹è±¡éƒ½åœ¨è¿™é‡Œåˆ†é…å†…å­˜)ï¼Œæ–¹æ³•åŒºä¸»è¦ç”¨äºå­˜æ”¾å·²è¢«åŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®ã€‚</p><hr><h3 id="Java-THREAD-ç±»è¯¦è§£"><a href="#Java-THREAD-ç±»è¯¦è§£" class="headerlink" title="Java THREAD ç±»è¯¦è§£"></a>Java THREAD ç±»è¯¦è§£</h3><p>åœ¨ Java ä¸­ï¼Œ<strong>Thread</strong> ç±»æ˜¯å¤šçº¿ç¨‹ç¼–ç¨‹çš„æ ¸å¿ƒã€‚å®ƒä»£è¡¨äº†ä¸€ä¸ªçº¿ç¨‹ï¼Œå¹¶æä¾›äº†ä¸°å¯Œçš„ API æ¥åˆ›å»ºã€æ§åˆ¶å’Œç®¡ç†çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸã€‚ç†è§£ <code>Thread</code> ç±»åŠå…¶æ–¹æ³•å¯¹äºç¼–å†™é«˜æ•ˆã€å¹¶å‘çš„ Java åº”ç”¨ç¨‹åºè‡³å…³é‡è¦ã€‚</p><hr><h3 id="1-THREAD-ç±»çš„åŸºæœ¬æ¦‚å¿µ"><a href="#1-THREAD-ç±»çš„åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="1. THREAD ç±»çš„åŸºæœ¬æ¦‚å¿µ"></a>1. THREAD ç±»çš„åŸºæœ¬æ¦‚å¿µ</h3><p><code>Thread</code> ç±»ä½äº <code>java.lang</code> åŒ…ä¸­ã€‚æ¯ä¸ª <code>Thread</code> ç±»çš„å®ä¾‹éƒ½ä»£è¡¨ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹ï¼Œè¿™ä¸ªçº¿ç¨‹èƒ½å¤Ÿå¹¶è¡Œæ‰§è¡Œä»£ç ã€‚æœ‰ä¸¤ç§ä¸»è¦æ–¹å¼å¯ä»¥åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼š</p><ol><li><strong>ç»§æ‰¿ Thread ç±»</strong>ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç±»å¹¶ç»§æ‰¿ <code>Thread</code>ï¼Œç„¶åé‡å†™å…¶ <strong>run()</strong> æ–¹æ³•æ¥å®šä¹‰çº¿ç¨‹çš„æ‰§è¡Œé€»è¾‘ã€‚</li><li><strong>å®ç° Runnable æ¥å£</strong>ï¼šåˆ›å»ºä¸€ä¸ªå®ç°äº† <code>Runnable</code> æ¥å£çš„ç±»ï¼Œå¹¶å°†å…¶å®ä¾‹ä½œä¸ºå‚æ•°ä¼ é€’ç»™ <code>Thread</code> æ„é€ å™¨ã€‚è¿™ç§æ–¹å¼æ›´çµæ´»ï¼Œå› ä¸ºå®ƒå…è®¸ä½ çš„ç±»ç»§æ‰¿å…¶ä»–ç±»ã€‚</li></ol><hr><h3 id="2-THREAD-ç±»çš„ä¸»è¦æ–¹æ³•è¯¦è§£"><a href="#2-THREAD-ç±»çš„ä¸»è¦æ–¹æ³•è¯¦è§£" class="headerlink" title="2. THREAD ç±»çš„ä¸»è¦æ–¹æ³•è¯¦è§£"></a>2. THREAD ç±»çš„ä¸»è¦æ–¹æ³•è¯¦è§£</h3><p>ä¸‹é¢è¯¦ç»†ä»‹ç» <code>Thread</code> ç±»ä¸­çš„å¸¸ç”¨å’Œé‡è¦æ–¹æ³•ï¼Œå¹¶æŒ‰å…¶åŠŸèƒ½è¿›è¡Œåˆ†ç±»ã€‚</p><h4 id="çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸæ§åˆ¶"><a href="#çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸæ§åˆ¶" class="headerlink" title="çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸæ§åˆ¶"></a><strong>çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸæ§åˆ¶</strong></h4><p>è¿™äº›æ–¹æ³•ç”¨äºå¯åŠ¨ã€ä¸­æ–­å’Œåè°ƒçº¿ç¨‹çš„æ‰§è¡Œã€‚</p><ul><li><strong>start()</strong>: <strong>å¯åŠ¨</strong>çº¿ç¨‹ã€‚æ­¤æ–¹æ³•ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œå¹¶ä½¿å®ƒè¿›å…¥<strong>å¯è¿è¡Œ (Runnable)</strong> çŠ¶æ€ã€‚ä¸€æ—¦æ“ä½œç³»ç»Ÿè°ƒåº¦è¿™ä¸ªçº¿ç¨‹ï¼Œå®ƒçš„ <strong>run()</strong> æ–¹æ³•å°±ä¼šè¢«è°ƒç”¨ã€‚</li><li><strong>run()</strong>: çº¿ç¨‹çš„<strong>æ‰§è¡Œä½“</strong>ã€‚å½“ä½ è°ƒç”¨ <code>start()</code> æ–¹æ³•æ—¶ï¼ŒJVM ä¼šè‡ªåŠ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚å¦‚æœä½ ç›´æ¥è°ƒç”¨ <code>run()</code>ï¼Œå®ƒåªä¼šè¢«å½“ä½œä¸€ä¸ªæ™®é€šæ–¹æ³•åœ¨å½“å‰çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œè€Œä¸ä¼šåˆ›å»ºæ–°çº¿ç¨‹ã€‚</li><li><strong>interrupt()</strong>: å‘çº¿ç¨‹å‘é€ä¸€ä¸ª<strong>ä¸­æ–­ä¿¡å·</strong>ã€‚æ­¤æ–¹æ³•å¹¶ä¸ä¼šç«‹å³åœæ­¢çº¿ç¨‹ã€‚å®ƒåªæ˜¯è®¾ç½®ä¸€ä¸ª<strong>ä¸­æ–­æ ‡å¿—</strong>ã€‚çº¿ç¨‹éœ€è¦è‡ªå·±æ£€æŸ¥è¿™ä¸ªæ ‡å¿—å¹¶å†³å®šå¦‚ä½•å“åº”ã€‚å¯¹äºåœ¨ <code>sleep()</code>, <code>join()</code>, æˆ– <code>wait()</code> ç­‰æ–¹æ³•ä¸­é˜»å¡çš„çº¿ç¨‹ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šæŠ›å‡º <code>InterruptedException</code>ã€‚</li><li><strong>join()</strong>: <strong>ç­‰å¾…</strong>çº¿ç¨‹ç»ˆæ­¢ã€‚è°ƒç”¨æ­¤æ–¹æ³•çš„çº¿ç¨‹ï¼ˆé€šå¸¸æ˜¯ä¸»çº¿ç¨‹ï¼‰ä¼š<strong>é˜»å¡</strong>ï¼Œç›´åˆ°è¢«è°ƒç”¨ <code>join()</code> çš„çº¿ç¨‹æ‰§è¡Œç»“æŸã€‚<ul><li><strong>join()</strong>: æ°¸è¿œç­‰å¾…ï¼Œç›´åˆ°çº¿ç¨‹ç»ˆæ­¢ã€‚</li><li><strong>join(long millis)</strong>: æœ€å¤šç­‰å¾…æŒ‡å®šçš„æ¯«ç§’æ•°ã€‚</li></ul></li></ul><h4 id="çº¿ç¨‹å±æ€§å’ŒçŠ¶æ€æŸ¥è¯¢"><a href="#çº¿ç¨‹å±æ€§å’ŒçŠ¶æ€æŸ¥è¯¢" class="headerlink" title="çº¿ç¨‹å±æ€§å’ŒçŠ¶æ€æŸ¥è¯¢"></a><strong>çº¿ç¨‹å±æ€§å’ŒçŠ¶æ€æŸ¥è¯¢</strong></h4><p>è¿™äº›æ–¹æ³•ç”¨äºè·å–çº¿ç¨‹çš„å½“å‰çŠ¶æ€æˆ–è®¾ç½®å…¶å±æ€§ã€‚</p><ul><li><strong>getName()</strong>: è¿”å›çº¿ç¨‹çš„åç§°ã€‚çº¿ç¨‹å¯ä»¥æœ‰ä¸€ä¸ªè‡ªå®šä¹‰çš„åç§°ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œåˆ™ä¼šæœ‰ä¸€ä¸ªé»˜è®¤çš„åç§°ï¼Œå¦‚ â€œThread-0â€ã€‚</li><li><strong>setName(String name)</strong>: è®¾ç½®çº¿ç¨‹çš„åç§°ã€‚</li><li><strong>getState()</strong>: è¿”å›çº¿ç¨‹çš„å½“å‰<strong>çŠ¶æ€</strong>ã€‚è¿”å›å€¼æ˜¯ä¸€ä¸ªæšä¸¾ç±»å‹ <code>Thread.State</code>ï¼ŒåŒ…æ‹¬ <code>NEW</code>, <code>RUNNABLE</code>, <code>BLOCKED</code>, <code>WAITING</code>, <code>TIMED_WAITING</code>, <code>TERMINATED</code>ã€‚</li><li><strong>isAlive()</strong>: åˆ¤æ–­çº¿ç¨‹æ˜¯å¦<strong>å­˜æ´»</strong>ã€‚å¦‚æœçº¿ç¨‹å·²ç»å¯åŠ¨ä½†å°šæœªç»ˆæ­¢ï¼Œåˆ™è¿”å› <code>true</code>ã€‚</li><li><strong>isDaemon()</strong>: åˆ¤æ–­çº¿ç¨‹æ˜¯å¦ä¸º<strong>å®ˆæŠ¤çº¿ç¨‹</strong>ã€‚å®ˆæŠ¤çº¿ç¨‹åœ¨æ‰€æœ‰éå®ˆæŠ¤çº¿ç¨‹ç»ˆæ­¢æ—¶ä¼šè‡ªåŠ¨ç»ˆæ­¢ã€‚ä¾‹å¦‚ï¼ŒJVM çš„åƒåœ¾å›æ”¶çº¿ç¨‹å°±æ˜¯ä¸€ä¸ªå®ˆæŠ¤çº¿ç¨‹ã€‚</li><li><strong>setDaemon(boolean on)</strong>: å°†çº¿ç¨‹è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹æˆ–éå®ˆæŠ¤çº¿ç¨‹ã€‚è¿™ä¸ªæ–¹æ³•å¿…é¡»åœ¨çº¿ç¨‹å¯åŠ¨å‰è°ƒç”¨ã€‚</li><li><strong>getPriority()</strong>: è¿”å›çº¿ç¨‹çš„<strong>ä¼˜å…ˆçº§</strong>ã€‚ä¼˜å…ˆçº§æ˜¯ä¸€ä¸ªæ•´æ•°ï¼ŒèŒƒå›´ä» <code>MIN_PRIORITY</code> (1) åˆ° <code>MAX_PRIORITY</code> (10)ã€‚</li><li><strong>setPriority(int newPriority)</strong>: è®¾ç½®çº¿ç¨‹çš„ä¼˜å…ˆçº§ã€‚</li></ul><h4 id="é™æ€æ–¹æ³•-å½±å“å½“å‰çº¿ç¨‹"><a href="#é™æ€æ–¹æ³•-å½±å“å½“å‰çº¿ç¨‹" class="headerlink" title="é™æ€æ–¹æ³• (å½±å“å½“å‰çº¿ç¨‹)"></a><strong>é™æ€æ–¹æ³• (å½±å“å½“å‰çº¿ç¨‹)</strong></h4><p>è¿™äº›æ–¹æ³•ç›´æ¥ä½œç”¨äºæ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ã€‚</p><ul><li><strong>Thread.currentThread()</strong>: è¿”å›å¯¹<strong>å½“å‰æ­£åœ¨æ‰§è¡Œ</strong>çš„çº¿ç¨‹å¯¹è±¡çš„å¼•ç”¨ã€‚è¿™æ˜¯è·å–å½“å‰çº¿ç¨‹ä¿¡æ¯æœ€å¸¸ç”¨çš„æ–¹æ³•ã€‚</li><li><strong>Thread.sleep(long millis)</strong>: ä½¿<strong>å½“å‰çº¿ç¨‹</strong>æš‚åœæ‰§è¡ŒæŒ‡å®šçš„æ¯«ç§’æ•°ã€‚å®ƒä¼šé‡Šæ”¾ CPU èµ„æºï¼Œä½†ä¸ä¼šé‡Šæ”¾é”ã€‚</li><li><strong>Thread.yield()</strong>: æç¤ºè°ƒåº¦å™¨ï¼Œ<strong>å½“å‰çº¿ç¨‹</strong>æ„¿æ„æ”¾å¼ƒå½“å‰çš„ CPU ä½¿ç”¨æƒï¼Œè®©å…¶ä»–çº¿ç¨‹æœ‰æœºä¼šè¿è¡Œã€‚è¿™æ˜¯ä¸€ä¸ª<strong>æç¤º</strong>ï¼Œä¸èƒ½ä¿è¯ä¸€å®šç”Ÿæ•ˆã€‚</li><li><strong>Thread.interrupted()</strong>: æµ‹è¯•<strong>å½“å‰çº¿ç¨‹</strong>æ˜¯å¦è¢«ä¸­æ–­ã€‚æ­¤æ–¹æ³•ä¼š<strong>æ¸…é™¤</strong>ä¸­æ–­æ ‡å¿—ã€‚å¦‚æœçº¿ç¨‹åœ¨è°ƒç”¨æ—¶ä¸­æ–­æ ‡å¿—ä¸º <code>true</code>ï¼Œåˆ™è¿”å› <code>true</code>ï¼Œç„¶åå°†ä¸­æ–­æ ‡å¿—é‡ç½®ä¸º <code>false</code>ã€‚</li></ul><hr><h3 id="3-THREAD-ç±»æ–¹æ³•ä½¿ç”¨ç¤ºä¾‹"><a href="#3-THREAD-ç±»æ–¹æ³•ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="3. THREAD ç±»æ–¹æ³•ä½¿ç”¨ç¤ºä¾‹"></a>3. THREAD ç±»æ–¹æ³•ä½¿ç”¨ç¤ºä¾‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadMethodsDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="comment">// 1. åˆ›å»ºå¹¶å¯åŠ¨çº¿ç¨‹</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">worker</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot; å¼€å§‹æ‰§è¡Œã€‚çŠ¶æ€ï¼š&quot;</span> + Thread.currentThread().getState());</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 2. æ¨¡æ‹Ÿè€—æ—¶æ“ä½œï¼Œå¹¶æ¼”ç¤º sleep()</span></span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot; ä¼‘çœ  2 ç§’...&quot;</span>);</span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 3. æ£€æŸ¥ä¸­æ–­æ ‡å¿—</span></span><br><span class="line">                <span class="keyword">if</span> (Thread.currentThread().isInterrupted()) &#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">&quot; è¢«ä¸­æ–­äº†ï¼&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot; æ•è·åˆ° InterruptedExceptionï¼Œçº¿ç¨‹è¢«ä¸­æ–­ã€‚&quot;</span>);</span><br><span class="line">                <span class="comment">// æ•è·å¼‚å¸¸åé‡æ–°è®¾ç½®ä¸­æ–­æ ‡å¿—</span></span><br><span class="line">                Thread.currentThread().interrupt(); </span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; æ‰§è¡Œç»“æŸã€‚&quot;</span>);</span><br><span class="line">        &#125;, <span class="string">&quot;WorkerThread&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è®¾ç½®çº¿ç¨‹ä¼˜å…ˆçº§å’Œå®ˆæŠ¤çŠ¶æ€ï¼ˆå¿…é¡»åœ¨å¯åŠ¨å‰ï¼‰</span></span><br><span class="line">        worker.setPriority(Thread.MAX_PRIORITY);</span><br><span class="line">        worker.setDaemon(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–å¹¶æ‰“å°çº¿ç¨‹ä¿¡æ¯</span></span><br><span class="line">        System.out.println(<span class="string">&quot;çº¿ç¨‹åˆ›å»ºåï¼Œåç§°ï¼š&quot;</span> + worker.getName() + <span class="string">&quot;ï¼Œä¼˜å…ˆçº§ï¼š&quot;</span> + worker.getPriority());</span><br><span class="line">        System.out.println(<span class="string">&quot;çº¿ç¨‹åˆ›å»ºåï¼ŒçŠ¶æ€ï¼š&quot;</span> + worker.getState());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¯åŠ¨çº¿ç¨‹</span></span><br><span class="line">        worker.start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4. ä½¿ç”¨ join() ç­‰å¾… worker çº¿ç¨‹ç»“æŸ</span></span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸»çº¿ç¨‹ç­‰å¾… WorkerThread ç»“æŸ...&quot;</span>);</span><br><span class="line">        <span class="comment">// worker.join(1000); // åªç­‰å¾… 1 ç§’</span></span><br><span class="line">        worker.join(); <span class="comment">// æ— é™ç­‰å¾…</span></span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸»çº¿ç¨‹ç»§ç»­æ‰§è¡Œã€‚WorkerThread çš„æœ€ç»ˆçŠ¶æ€ï¼š&quot;</span> + worker.getState());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 5. å†æ¬¡æ£€æŸ¥æ˜¯å¦å­˜æ´»</span></span><br><span class="line">        System.out.println(<span class="string">&quot;WorkerThread æ˜¯å¦å­˜æ´»ï¼š&quot;</span> + worker.isAlive());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 6. æ¼”ç¤º interrupt()</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">interruptibleThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// çº¿ç¨‹åœ¨è¿™é‡Œé˜»å¡</span></span><br><span class="line">                Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;interruptibleThread è¢«ä¸­æ–­ï¼Œæ•è·åˆ°å¼‚å¸¸ã€‚&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        interruptibleThread.start();</span><br><span class="line">        Thread.sleep(<span class="number">100</span>); <span class="comment">// ç¡®ä¿çº¿ç¨‹è¿›å…¥ä¼‘çœ </span></span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸»çº¿ç¨‹ä¸­æ–­ interruptibleThread...&quot;</span>);</span><br><span class="line">        interruptibleThread.interrupt();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¥½çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªå…³äº Java çº¿ç¨‹æ§åˆ¶çš„éå¸¸é‡è¦çš„çŸ¥è¯†ç‚¹ã€‚æˆ‘å°†è¯¦ç»†è§£é‡Š<strong>å®ˆæŠ¤çº¿ç¨‹ï¼ˆDaemon Threadï¼‰</strong>ï¼Œä»¥åŠ <code>join()</code> å’Œ <code>yield()</code> è¿™ä¸¤ä¸ªçº¿ç¨‹æ§åˆ¶æ–¹æ³•ã€‚</p><hr><h3 id="ä¸€ã€å®ˆæŠ¤çº¿ç¨‹-Daemon-Thread"><a href="#ä¸€ã€å®ˆæŠ¤çº¿ç¨‹-Daemon-Thread" class="headerlink" title="ä¸€ã€å®ˆæŠ¤çº¿ç¨‹ (Daemon Thread)"></a>ä¸€ã€å®ˆæŠ¤çº¿ç¨‹ (Daemon Thread)</h3><h4 id="1-æ¦‚å¿µ"><a href="#1-æ¦‚å¿µ" class="headerlink" title="1. æ¦‚å¿µ"></a>1. æ¦‚å¿µ</h4><ul><li><strong>å®ˆæŠ¤çº¿ç¨‹</strong>ï¼šæ˜¯ä¸€ç§ç‰¹æ®Šçš„çº¿ç¨‹ï¼Œå®ƒä¸ºå…¶ä»–çº¿ç¨‹ï¼ˆéå®ˆæŠ¤çº¿ç¨‹ï¼‰æä¾›æœåŠ¡ã€‚</li><li><strong>ç‰¹ç‚¹</strong>ï¼šå¦‚æœ JVM ä¸­<strong>åªå‰©ä¸‹å®ˆæŠ¤çº¿ç¨‹</strong>ï¼Œé‚£ä¹ˆ JVM ä¼šè‡ªåŠ¨é€€å‡ºã€‚æ¢å¥è¯è¯´ï¼Œå®ˆæŠ¤çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸä¸ä¾èµ–äºè‡ªå·±ï¼Œè€Œæ˜¯ä¾èµ–äºå…¶ä»–éå®ˆæŠ¤çº¿ç¨‹ã€‚</li></ul><h4 id="2-ä¸æ™®é€šçº¿ç¨‹çš„åŒºåˆ«"><a href="#2-ä¸æ™®é€šçº¿ç¨‹çš„åŒºåˆ«" class="headerlink" title="2. ä¸æ™®é€šçº¿ç¨‹çš„åŒºåˆ«"></a>2. ä¸æ™®é€šçº¿ç¨‹çš„åŒºåˆ«</h4><ul><li><strong>æ™®é€šçº¿ç¨‹ï¼ˆUser Threadï¼‰</strong>ï¼šåˆç§°ç”¨æˆ·çº¿ç¨‹ã€‚å¦‚æœ JVM ä¸­è¿˜æœ‰ä¸€ä¸ªç”¨æˆ·çº¿ç¨‹åœ¨è¿è¡Œï¼ŒJVM å°±ä¸ä¼šé€€å‡ºã€‚</li><li><strong>å®ˆæŠ¤çº¿ç¨‹</strong>ï¼šå½“æ‰€æœ‰ç”¨æˆ·çº¿ç¨‹éƒ½æ‰§è¡Œå®Œæ¯•åï¼ŒJVM ä¼šå¿½ç•¥ä»åœ¨è¿è¡Œçš„å®ˆæŠ¤çº¿ç¨‹ï¼Œå¹¶ç›´æ¥ç»ˆæ­¢ã€‚</li></ul><h4 id="3-å¸¸è§ç”¨é€”"><a href="#3-å¸¸è§ç”¨é€”" class="headerlink" title="3. å¸¸è§ç”¨é€”"></a>3. å¸¸è§ç”¨é€”</h4><ul><li>å®ˆæŠ¤çº¿ç¨‹å¸¸ç”¨äºæ‰§è¡Œä¸€äº›åå°ä»»åŠ¡ï¼Œä¾‹å¦‚ï¼š<ul><li><strong>åƒåœ¾å›æ”¶å™¨ (Garbage Collector)</strong>ï¼šJVM çš„åƒåœ¾å›æ”¶çº¿ç¨‹å°±æ˜¯å…¸å‹çš„å®ˆæŠ¤çº¿ç¨‹ã€‚å®ƒè´Ÿè´£å›æ”¶å†…å­˜ï¼Œä½†ä¸ä¼šé˜»æ­¢ JVM çš„é€€å‡ºã€‚</li><li><strong>JIT (Just-In-Time) ç¼–è¯‘å™¨</strong>ï¼šåŒæ ·æ˜¯åå°æœåŠ¡çº¿ç¨‹ã€‚</li><li><strong>æ—¥å¿—è®°å½•</strong>ï¼šä¸€äº›æ—¥å¿—æ¡†æ¶çš„å¼‚æ­¥æ—¥å¿—çº¿ç¨‹å¯ä»¥è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹ã€‚</li></ul></li></ul><h4 id="4-å¦‚ä½•åˆ›å»ºå’Œåˆ¤æ–­"><a href="#4-å¦‚ä½•åˆ›å»ºå’Œåˆ¤æ–­" class="headerlink" title="4. å¦‚ä½•åˆ›å»ºå’Œåˆ¤æ–­"></a>4. å¦‚ä½•åˆ›å»ºå’Œåˆ¤æ–­</h4><ul><li><strong>åˆ›å»º</strong>ï¼šåœ¨çº¿ç¨‹å¯åŠ¨å‰ï¼Œè°ƒç”¨ <code>setDaemon(true)</code> æ–¹æ³•ã€‚<ul><li><strong>æ³¨æ„</strong>ï¼šå¿…é¡»åœ¨ <code>start()</code> æ–¹æ³•è°ƒç”¨ä¹‹å‰è®¾ç½®ï¼Œå¦åˆ™ä¼šæŠ›å‡º <code>IllegalThreadStateException</code>ã€‚</li></ul></li><li><strong>åˆ¤æ–­</strong>ï¼š<code>isDaemon()</code> æ–¹æ³•å¯ä»¥åˆ¤æ–­ä¸€ä¸ªçº¿ç¨‹æ˜¯å¦ä¸ºå®ˆæŠ¤çº¿ç¨‹ã€‚</li></ul><p><strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DaemonThreadExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªç”¨æˆ·çº¿ç¨‹</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">userThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;ç”¨æˆ·çº¿ç¨‹æ­£åœ¨è¿è¡Œ...&quot;</span>);</span><br><span class="line">                    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;ç”¨æˆ·çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ã€‚&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªå®ˆæŠ¤çº¿ç¨‹</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">daemonThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;å®ˆæŠ¤çº¿ç¨‹æ­£åœ¨è¿è¡Œ...&quot;</span>);</span><br><span class="line">                    Thread.sleep(<span class="number">500</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹ï¼Œå¿…é¡»åœ¨ start() ä¹‹å‰</span></span><br><span class="line">        daemonThread.setDaemon(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¯åŠ¨çº¿ç¨‹</span></span><br><span class="line">        userThread.start();</span><br><span class="line">        daemonThread.start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è§‚å¯Ÿç»“æœï¼šå½“ç”¨æˆ·çº¿ç¨‹æ‰§è¡Œå®Œæ¯•åï¼Œå®ˆæŠ¤çº¿ç¨‹ä¹Ÿä¼šç«‹å³ç»ˆæ­¢ã€‚</span></span><br><span class="line">        <span class="comment">// å¦‚æœæŠŠ setDaemon(true) ç§»é™¤ï¼Œå®ˆæŠ¤çº¿ç¨‹ä¼šä¸€ç›´è¿è¡Œï¼Œå¯¼è‡´ç¨‹åºä¸é€€å‡ºã€‚</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="äºŒã€join-æ–¹æ³•"><a href="#äºŒã€join-æ–¹æ³•" class="headerlink" title="äºŒã€join() æ–¹æ³•"></a>äºŒã€<code>join()</code> æ–¹æ³•</h3><h4 id="1-æ¦‚å¿µ-1"><a href="#1-æ¦‚å¿µ-1" class="headerlink" title="1. æ¦‚å¿µ"></a>1. æ¦‚å¿µ</h4><ul><li><code>join()</code> æ–¹æ³•çš„ä½œç”¨æ˜¯<strong>ç­‰å¾…è°ƒç”¨è¯¥æ–¹æ³•çš„çº¿ç¨‹æ‰§è¡Œå®Œæ¯•</strong>ã€‚</li><li><strong>æ¯”å–»</strong>ï¼šä¸»çº¿ç¨‹ A è°ƒç”¨äº†çº¿ç¨‹ B çš„ <code>B.join()</code> æ–¹æ³•ï¼Œé‚£ä¹ˆä¸»çº¿ç¨‹ A ä¼š<strong>è¿›å…¥ç­‰å¾…çŠ¶æ€</strong>ï¼Œç›´åˆ°çº¿ç¨‹ B æ‰§è¡Œç»“æŸï¼Œä¸»çº¿ç¨‹ A æ‰ä¼šç»§ç»­æ‰§è¡Œã€‚</li></ul><h4 id="2-ä¸»è¦ç”¨é€”"><a href="#2-ä¸»è¦ç”¨é€”" class="headerlink" title="2. ä¸»è¦ç”¨é€”"></a>2. ä¸»è¦ç”¨é€”</h4><ul><li>ç¡®ä¿çº¿ç¨‹é—´çš„æ‰§è¡Œé¡ºåºã€‚å½“ä¸€ä¸ªçº¿ç¨‹çš„æ‰§è¡Œä¾èµ–äºå¦ä¸€ä¸ªçº¿ç¨‹çš„æ‰§è¡Œç»“æœæ—¶ï¼Œ<code>join()</code> æ–¹æ³•éå¸¸æœ‰ç”¨ã€‚</li></ul><h4 id="3-ä»£ç ç¤ºä¾‹"><a href="#3-ä»£ç ç¤ºä¾‹" class="headerlink" title="3. ä»£ç ç¤ºä¾‹"></a>3. ä»£ç ç¤ºä¾‹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JoinExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;çº¿ç¨‹1å¼€å§‹æ‰§è¡Œ...&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;çº¿ç¨‹1æ‰§è¡Œå®Œæ¯•ã€‚&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;çº¿ç¨‹2å¼€å§‹æ‰§è¡Œ...&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;çº¿ç¨‹2æ‰§è¡Œå®Œæ¯•ã€‚&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¯åŠ¨çº¿ç¨‹</span></span><br><span class="line">        thread1.start();</span><br><span class="line">        thread2.start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¸»çº¿ç¨‹ç­‰å¾… thread1 å’Œ thread2 æ‰§è¡Œå®Œæ¯•</span></span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸»çº¿ç¨‹ç­‰å¾…çº¿ç¨‹1æ‰§è¡Œå®Œæ¯•...&quot;</span>);</span><br><span class="line">        thread1.join(); <span class="comment">// ä¸»çº¿ç¨‹é˜»å¡åœ¨è¿™é‡Œï¼Œç›´åˆ° thread1 ç»“æŸ</span></span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸»çº¿ç¨‹ç­‰å¾…çº¿ç¨‹2æ‰§è¡Œå®Œæ¯•...&quot;</span>);</span><br><span class="line">        thread2.join(); <span class="comment">// ä¸»çº¿ç¨‹é˜»å¡åœ¨è¿™é‡Œï¼Œç›´åˆ° thread2 ç»“æŸ</span></span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰€æœ‰å­çº¿ç¨‹éƒ½æ‰§è¡Œå®Œæ¯•ï¼Œä¸»çº¿ç¨‹ç»§ç»­æ‰§è¡Œã€‚&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="ä¸‰ã€yield-æ–¹æ³•"><a href="#ä¸‰ã€yield-æ–¹æ³•" class="headerlink" title="ä¸‰ã€yield() æ–¹æ³•"></a>ä¸‰ã€<code>yield()</code> æ–¹æ³•</h3><h4 id="1-æ¦‚å¿µ-2"><a href="#1-æ¦‚å¿µ-2" class="headerlink" title="1. æ¦‚å¿µ"></a>1. æ¦‚å¿µ</h4><ul><li><code>yield()</code> æ–¹æ³•çš„ä½œç”¨æ˜¯<strong>è®©å‡ºå½“å‰ CPU çš„æ‰§è¡Œæƒ</strong>ã€‚</li><li><strong>æ¯”å–»</strong>ï¼šä¸€ä¸ªçº¿ç¨‹è°ƒç”¨äº† <code>yield()</code>ï¼Œå®ƒå‘Šè¯‰è°ƒåº¦å™¨ï¼šâ€œæˆ‘æ„¿æ„æš‚æ—¶æ”¾å¼ƒ CPUï¼Œä½ å¯ä»¥è®©å…¶ä»–åŒç­‰ä¼˜å…ˆçº§çš„çº¿ç¨‹å…ˆæ‰§è¡Œã€‚â€</li></ul><h4 id="2-ä¸»è¦ç”¨é€”-1"><a href="#2-ä¸»è¦ç”¨é€”-1" class="headerlink" title="2. ä¸»è¦ç”¨é€”"></a>2. ä¸»è¦ç”¨é€”</h4><ul><li><strong>æç¤º</strong>ï¼š<code>yield()</code> åªæ˜¯ä¸€ä¸ª<strong>æç¤º</strong>ï¼Œè°ƒåº¦å™¨<strong>ä¸ä¸€å®šä¼šé‡‡çº³</strong>ã€‚å®ƒå¯èƒ½è®©å‡º CPU ç»™å…¶ä»–çº¿ç¨‹ï¼Œä¹Ÿå¯èƒ½ç«‹å³é‡æ–°è·å¾— CPU çš„æ‰§è¡Œæƒã€‚</li><li><strong>ä¸å…¶ä»–æ–¹æ³•çš„åŒºåˆ«</strong>ï¼š<ul><li><code>sleep()</code>ï¼šè®©çº¿ç¨‹è¿›å…¥<strong>ä¼‘çœ çŠ¶æ€</strong>ï¼Œ<strong>å¼ºåˆ¶</strong>è®©å‡º CPUã€‚</li><li><code>wait()</code>ï¼šè®©çº¿ç¨‹è¿›å…¥<strong>ç­‰å¾…çŠ¶æ€</strong>ï¼Œ<strong>å¿…é¡»</strong>é€šè¿‡ <code>notify()</code> æˆ– <code>notifyAll()</code> å”¤é†’ã€‚</li></ul></li><li><strong>yield() ä¸ä¼šé‡Šæ”¾é”</strong>ã€‚</li></ul><h4 id="3-ä»£ç ç¤ºä¾‹-1"><a href="#3-ä»£ç ç¤ºä¾‹-1" class="headerlink" title="3. ä»£ç ç¤ºä¾‹"></a>3. ä»£ç ç¤ºä¾‹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">YieldExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Runnable</span> <span class="variable">task</span> <span class="operator">=</span> () -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot; æ­£åœ¨è¿è¡Œï¼š&quot;</span> + i);</span><br><span class="line">                <span class="keyword">if</span> (i == <span class="number">2</span>) &#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">&quot; æ”¾å¼ƒCPUæ‰§è¡Œæƒã€‚&quot;</span>);</span><br><span class="line">                    Thread.<span class="keyword">yield</span>(); <span class="comment">// è®©å‡º CPU</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(task, <span class="string">&quot;Thread-1&quot;</span>);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(task, <span class="string">&quot;Thread-2&quot;</span>);</span><br><span class="line"></span><br><span class="line">        thread1.start();</span><br><span class="line">        thread2.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è§‚å¯Ÿç»“æœ</strong>ï¼šåœ¨è¾“å‡ºåˆ° â€œæ”¾å¼ƒCPUæ‰§è¡Œæƒâ€ åï¼Œä½ å¯èƒ½ä¼šçœ‹åˆ°å¦ä¸€ä¸ªçº¿ç¨‹çš„è¾“å‡ºå…ˆå‡ºç°ã€‚ä½†è¿™å¹¶ä¸ç»å¯¹ï¼Œå› ä¸º <code>yield()</code> åªæ˜¯ä¸€ä¸ªå»ºè®®ã€‚</p><p>åœ¨Javaå¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ï¼Œ<code>yield()</code>ã€<code>join()</code>ã€<code>setDaemon()</code> è¿™äº›æ–¹æ³•éƒ½æœ‰ä¸¥æ ¼çš„<strong>è®¾ç½®æ—¶æœº</strong>ï¼Œå¦‚æœä½¿ç”¨ä¸å½“ï¼Œå¯èƒ½ä¼šå¯¼è‡´å¼‚å¸¸æˆ–è¡Œä¸ºä¸ç¬¦åˆé¢„æœŸã€‚</p><p>è®©æˆ‘ä»¬æ¥è¯¦ç»†è§£é‡Šä¸€ä¸‹æ¯ä¸ªæ–¹æ³•çš„è®¾ç½®æ—¶æœºã€‚</p><hr><h3 id="1-setDaemon-boolean-on-æ–¹æ³•"><a href="#1-setDaemon-boolean-on-æ–¹æ³•" class="headerlink" title="1. setDaemon(boolean on) æ–¹æ³•"></a>1. <code>setDaemon(boolean on)</code> æ–¹æ³•</h3><ul><li><p><strong>ä½œç”¨</strong>ï¼šå°†ä¸€ä¸ªçº¿ç¨‹è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹æˆ–ç”¨æˆ·çº¿ç¨‹ã€‚</p></li><li><p><strong>è®¾ç½®æ—¶æœº</strong>ï¼š<strong>å¿…é¡»åœ¨çº¿ç¨‹å¯åŠ¨å‰è°ƒç”¨</strong>ï¼Œå³åœ¨ <code>thread.start()</code> æ–¹æ³•ä¹‹å‰ã€‚</p></li><li><p><strong>ä¸ºä»€ä¹ˆï¼Ÿ</strong>ï¼š</p><ul><li>çº¿ç¨‹ä¸€æ—¦å¯åŠ¨ï¼Œå…¶ç±»å‹ï¼ˆç”¨æˆ·çº¿ç¨‹æˆ–å®ˆæŠ¤çº¿ç¨‹ï¼‰å°±å·²ç»ç¡®å®šï¼Œå¹¶ä¸”ä¸èƒ½åœ¨è¿è¡Œæ—¶æ”¹å˜ã€‚</li><li>å¦‚æœåœ¨ <code>start()</code> æ–¹æ³•ä¹‹åè°ƒç”¨ <code>setDaemon(true)</code>ï¼Œä¼šæŠ›å‡º <code>IllegalThreadStateException</code> è¿è¡Œæ—¶å¼‚å¸¸ã€‚</li></ul></li><li><p><strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Thread</span> <span class="variable">daemonThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">    <span class="comment">// ... å®ˆæŠ¤çº¿ç¨‹çš„é€»è¾‘</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// é”™è¯¯ç¤ºä¾‹ï¼šå…ˆå¯åŠ¨å†è®¾ç½®</span></span><br><span class="line"><span class="comment">// daemonThread.start();</span></span><br><span class="line"><span class="comment">// daemonThread.setDaemon(true); // è¿™é‡Œä¼šæŠ›å‡º IllegalThreadStateException</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ­£ç¡®ç¤ºä¾‹ï¼šå…ˆè®¾ç½®å†å¯åŠ¨</span></span><br><span class="line">daemonThread.setDaemon(<span class="literal">true</span>); </span><br><span class="line">daemonThread.start();</span><br></pre></td></tr></table></figure></li></ul><hr><h3 id="2-join-æ–¹æ³•"><a href="#2-join-æ–¹æ³•" class="headerlink" title="2. join() æ–¹æ³•"></a>2. <code>join()</code> æ–¹æ³•</h3><ul><li><p><strong>ä½œç”¨</strong>ï¼šè®©å½“å‰çº¿ç¨‹ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæ¯•ã€‚</p></li><li><p><strong>è®¾ç½®æ—¶æœº</strong>ï¼š<strong>å¿…é¡»åœ¨è¢«ç­‰å¾…çš„çº¿ç¨‹å¯åŠ¨åè°ƒç”¨</strong>ã€‚</p></li><li><p><strong>ä¸ºä»€ä¹ˆï¼Ÿ</strong>ï¼š</p><ul><li><code>join()</code> çš„ç›®çš„æ˜¯è®©ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹ã€‚å¦‚æœè¢«ç­‰å¾…çš„çº¿ç¨‹è¿˜æ²¡æœ‰å¯åŠ¨ï¼Œé‚£ä¹ˆç­‰å¾…å®ƒç»“æŸæ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚</li><li>å°½ç®¡åœ¨å¯åŠ¨å‰è°ƒç”¨ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œä½†å®ƒä¹Ÿä¸ä¼šæœ‰ä»»ä½•æ•ˆæœï¼Œå› ä¸ºç›®æ ‡çº¿ç¨‹æ ¹æœ¬æ²¡æœ‰å¼€å§‹è¿è¡Œã€‚</li></ul></li><li><p><strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">Thread</span> <span class="variable">workerThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">    <span class="comment">// ... å·¥ä½œçº¿ç¨‹çš„é€»è¾‘</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// é”™è¯¯ç¤ºä¾‹ï¼šåœ¨å·¥ä½œçº¿ç¨‹å¯åŠ¨å‰è°ƒç”¨ join()</span></span><br><span class="line"><span class="comment">// workerThread.join(); // æ— æ•ˆï¼Œå› ä¸º workerThread è¿˜æ²¡æœ‰è¿è¡Œ</span></span><br><span class="line"><span class="comment">// workerThread.start(); </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ­£ç¡®ç¤ºä¾‹ï¼šåœ¨å·¥ä½œçº¿ç¨‹å¯åŠ¨åè°ƒç”¨ join()</span></span><br><span class="line">workerThread.start();</span><br><span class="line">workerThread.join(); <span class="comment">// ä¸»çº¿ç¨‹å°†ç­‰å¾… workerThread è¿è¡Œå®Œæ¯•</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="3-yield-æ–¹æ³•"><a href="#3-yield-æ–¹æ³•" class="headerlink" title="3. yield() æ–¹æ³•"></a>3. <code>yield()</code> æ–¹æ³•</h3><ul><li><p><strong>ä½œç”¨</strong>ï¼šå‘çº¿ç¨‹è°ƒåº¦å™¨å‘å‡ºæç¤ºï¼Œå½“å‰çº¿ç¨‹æ„¿æ„æ”¾å¼ƒ CPU æ‰§è¡Œæƒã€‚</p></li><li><p><strong>è®¾ç½®æ—¶æœº</strong>ï¼š<strong>å¯ä»¥åœ¨çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸçš„ä»»ä½•é˜¶æ®µè°ƒç”¨</strong>ï¼Œä½†é€šå¸¸åœ¨çº¿ç¨‹çš„ <code>run()</code> æ–¹æ³•ä¸­è°ƒç”¨ã€‚</p></li><li><p><strong>ä¸ºä»€ä¹ˆï¼Ÿ</strong>ï¼š</p><ul><li><code>yield()</code> æ˜¯ä¸€ä¸ª<strong>åŠ¨æ€çš„è¡Œä¸º</strong>ï¼Œå®ƒå‘ç”Ÿåœ¨çº¿ç¨‹æ­£åœ¨æ‰§è¡Œå…¶ä»»åŠ¡çš„è¿‡ç¨‹ä¸­ã€‚</li><li>å®ƒçš„ç›®çš„æ˜¯åœ¨ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œåœ¨æŸä¸ªç‚¹ä¸Šä¸»åŠ¨è®©å‡º CPUï¼Œè®©å…¶ä»–çº¿ç¨‹æœ‰æœºä¼šè¿è¡Œã€‚</li></ul></li><li><p><strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Thread</span> <span class="variable">myThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘æ­£åœ¨è¿è¡Œ...&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (i == <span class="number">5</span>) &#123;</span><br><span class="line">            <span class="comment">// åœ¨ä»»åŠ¡æ‰§è¡Œåˆ°ä¸€åŠæ—¶ï¼Œè®©å‡º CPU</span></span><br><span class="line">            Thread.<span class="keyword">yield</span>(); </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">myThread.start();</span><br></pre></td></tr></table></figure></li></ul><h3 id="æ€»ç»“-5"><a href="#æ€»ç»“-5" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><table><thead><tr><th>æ–¹æ³•</th><th>ä½œç”¨</th><th>è®¾ç½®æ—¶æœº</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td><strong>setDaemon()</strong></td><td>è®¾å®šçº¿ç¨‹ç±»å‹ï¼ˆå®ˆæŠ¤&#x2F;ç”¨æˆ·ï¼‰</td><td><strong>thread.start() ä¹‹å‰</strong></td><td>å¯åŠ¨åè®¾ç½®ä¼šæŠ›å‡ºå¼‚å¸¸</td></tr><tr><td><strong>join()</strong></td><td>ç­‰å¾…çº¿ç¨‹æ‰§è¡Œç»“æŸ</td><td><strong>thread.start() ä¹‹å</strong></td><td>åœ¨å¯åŠ¨å‰è°ƒç”¨æ˜¯æ— æ•ˆçš„</td></tr><tr><td><strong>yield()</strong></td><td>æç¤ºçº¿ç¨‹è°ƒåº¦å™¨è®©å‡º CPU</td><td><strong>çº¿ç¨‹è¿è¡ŒæœŸé—´çš„ä»»ä½•æ—¶åˆ»</strong></td><td>åªæ˜¯ä¸€ä¸ªå»ºè®®ï¼Œä¸ä¿è¯ç”Ÿæ•ˆ</td></tr></tbody></table><h3 id="1-æ·±åº¦è§£æ"><a href="#1-æ·±åº¦è§£æ" class="headerlink" title="1. æ·±åº¦è§£æ"></a>1. æ·±åº¦è§£æ</h3><h4 id="1-Thread-sleep-long-millis"><a href="#1-Thread-sleep-long-millis" class="headerlink" title="1. Thread.sleep(long millis)"></a>1. <code>Thread.sleep(long millis)</code></h4><p><strong>åŠŸèƒ½:</strong> <code>sleep()</code> æ–¹æ³•æ˜¯ <code>Thread</code> ç±»çš„é™æ€æ–¹æ³•ï¼Œä½œç”¨æ˜¯è®©<strong>å½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹</strong>æš‚åœæŒ‡å®šçš„æ—¶é—´ã€‚</p><p><strong>æ ¸å¿ƒæœºåˆ¶:</strong></p><ul><li><code>sleep()</code> æ–¹æ³•ä¼šä½¿çº¿ç¨‹è¿›å…¥<strong>é˜»å¡çŠ¶æ€ï¼ˆTimed Waitingï¼‰</strong>ã€‚</li><li>å®ƒ<strong>ä¸ä¼šé‡Šæ”¾</strong>ä»»ä½•æŒæœ‰çš„<strong>é”ï¼ˆmonitorï¼‰</strong>ã€‚</li><li>å½“æŒ‡å®šçš„æ—¶é—´è¿‡åï¼Œçº¿ç¨‹ä¼šå›åˆ°<strong>å¯è¿è¡ŒçŠ¶æ€ï¼ˆRunnableï¼‰</strong>ï¼Œç­‰å¾… CPU è°ƒåº¦ã€‚</li><li>å¦‚æœçº¿ç¨‹åœ¨ä¼‘çœ æœŸé—´è¢«å…¶ä»–çº¿ç¨‹è°ƒç”¨ <code>interrupt()</code> æ–¹æ³•ï¼Œ<code>sleep()</code> ä¼šç«‹å³æŠ›å‡º <code>InterruptedException</code>ã€‚</li><li><code>sleep()</code> çš„å®ç°ä¾èµ–äºæ“ä½œç³»ç»Ÿçš„è°ƒåº¦å™¨ï¼Œå®é™…æš‚åœçš„æ—¶é—´å¯èƒ½æ¯”æŒ‡å®šçš„æ—¶é—´é•¿ã€‚</li></ul><p><strong>æºç è§£æ (ä¼ªä»£ç ):</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sleep</span><span class="params">(<span class="type">long</span> millis)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="keyword">if</span> (millis &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;timeout value is negative&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ£€æŸ¥ä¸­æ–­æ ‡å¿—</span></span><br><span class="line">    <span class="keyword">if</span> (Thread.interrupted()) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InterruptedException</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è°ƒç”¨æœ¬åœ°æ–¹æ³•ï¼Œé€šçŸ¥æ“ä½œç³»ç»ŸæŒ‚èµ·å½“å‰çº¿ç¨‹</span></span><br><span class="line">    VM.nativeSleep(millis);</span><br><span class="line">    <span class="comment">// å”¤é†’åå†æ¬¡æ£€æŸ¥ä¸­æ–­æ ‡å¿—</span></span><br><span class="line">    <span class="keyword">if</span> (Thread.interrupted()) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InterruptedException</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>VM.nativeSleep</strong> æ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³•ï¼Œå®ƒå°†çº¿ç¨‹æŒ‚èµ·çš„ä»»åŠ¡äº¤ç»™æ“ä½œç³»ç»Ÿå†…æ ¸æ¥å®Œæˆã€‚</p><h4 id="2-Thread-yield"><a href="#2-Thread-yield" class="headerlink" title="2. Thread.yield()"></a>2. <code>Thread.yield()</code></h4><p><strong>åŠŸèƒ½:</strong> <code>yield()</code> æ–¹æ³•æ˜¯ <code>Thread</code> ç±»çš„é™æ€æ–¹æ³•ï¼Œä½œç”¨æ˜¯è®©<strong>å½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹</strong>æ”¾å¼ƒå…¶ CPU æ—¶é—´ç‰‡ï¼Œå›åˆ°<strong>å¯è¿è¡ŒçŠ¶æ€ï¼ˆRunnableï¼‰</strong>ã€‚</p><p><strong>æ ¸å¿ƒæœºåˆ¶:</strong></p><ul><li><code>yield()</code> çš„ç›®çš„æ˜¯ç»™å…¶ä»–çº¿ç¨‹ä¸€ä¸ªæ‰§è¡Œçš„æœºä¼šï¼Œä½†å®ƒ<strong>ä¸ä¿è¯</strong>å…¶ä»–çº¿ç¨‹ä¼šç«‹å³è¿è¡Œã€‚</li><li>å®ƒ<strong>ä¸ä¼š</strong>ä½¿çº¿ç¨‹è¿›å…¥é˜»å¡æˆ–ç­‰å¾…çŠ¶æ€ï¼Œçº¿ç¨‹åªæ˜¯ä»â€œæ­£åœ¨è¿è¡Œâ€çš„çŠ¶æ€åˆ‡æ¢åˆ°â€œå¯è¿è¡Œâ€é˜Ÿåˆ—çš„æœ«å°¾ã€‚</li><li>è°ƒåº¦å™¨å¯èƒ½ä¼šé€‰æ‹©ç«‹å³é‡æ–°è°ƒåº¦åˆšæ‰è°ƒç”¨ <code>yield()</code> çš„çº¿ç¨‹ã€‚</li><li>å®ƒ<strong>ä¸ä¼š</strong>é‡Šæ”¾ä»»ä½•é”ã€‚</li><li><code>yield()</code> ä¸»è¦ç”¨äº<strong>è°ƒè¯•</strong>æˆ–<strong>ä¼˜åŒ–</strong>ï¼Œé€šå¸¸ä¸åº”ç”¨äºæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ã€‚å› ä¸ºå®ƒä¾èµ–äºè°ƒåº¦å™¨çš„å®ç°ï¼Œå…¶è¡Œä¸ºä¸å¯é¢„æµ‹ã€‚</li></ul><p><strong>æºç è§£æ (ä¼ªä»£ç ):</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">yield</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// è°ƒç”¨æœ¬åœ°æ–¹æ³•ï¼Œå‘æ“ä½œç³»ç»Ÿè°ƒåº¦å™¨å‘å‡ºâ€œè®©æ­¥â€ä¿¡å·</span></span><br><span class="line">    nativeYield();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>nativeYield</strong> åŒæ ·æ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³•ï¼Œå®ƒå‘æ“ä½œç³»ç»Ÿè°ƒåº¦å™¨å‘å‡ºä¸€ä¸ªæç¤ºï¼Œè¡¨ç¤ºå½“å‰çº¿ç¨‹æ„¿æ„è®©å‡º CPUã€‚</p><h4 id="3-obj-wait"><a href="#3-obj-wait" class="headerlink" title="3. obj.wait()"></a>3. <code>obj.wait()</code></h4><p><strong>åŠŸèƒ½:</strong> <code>wait()</code> æ–¹æ³•æ˜¯ <code>Object</code> ç±»çš„æ–¹æ³•ï¼Œä½œç”¨æ˜¯è®©<strong>å½“å‰çº¿ç¨‹</strong>è¿›å…¥<strong>ç­‰å¾…çŠ¶æ€ï¼ˆWaitingï¼‰</strong>ï¼Œå¹¶<strong>é‡Šæ”¾</strong>å®ƒæ‰€æŒæœ‰çš„å¯¹è±¡çš„é”ã€‚</p><p><strong>æ ¸å¿ƒæœºåˆ¶:</strong></p><ul><li><code>wait()</code> å¿…é¡»åœ¨**åŒæ­¥å—ï¼ˆsynchronized blockï¼‰**å†…éƒ¨è°ƒç”¨ï¼Œå¦åˆ™ä¼šæŠ›å‡º <code>IllegalMonitorStateException</code>ã€‚</li><li>å½“çº¿ç¨‹è°ƒç”¨ <code>wait()</code> åï¼Œå®ƒä¼š<strong>é‡Šæ”¾</strong>è¯¥åŒæ­¥å—æ‰€å…³è”çš„å¯¹è±¡çš„é”ï¼Œè¿›å…¥ç­‰å¾…é˜Ÿåˆ—ã€‚</li><li>çº¿ç¨‹éœ€è¦ç­‰å¾…å…¶ä»–çº¿ç¨‹è°ƒç”¨<strong>åŒä¸€å¯¹è±¡çš„</strong> <code>notify()</code> æˆ– <code>notifyAll()</code> æ–¹æ³•æ‰èƒ½è¢«å”¤é†’ã€‚</li><li>è¢«å”¤é†’åï¼Œçº¿ç¨‹éœ€è¦<strong>é‡æ–°ç«äº‰</strong>å¯¹è±¡çš„é”ï¼Œæ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚</li></ul><p><strong>æºç è§£æ (ä¼ªä»£ç ):</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">wait</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    wait(<span class="number">0</span>); <span class="comment">// å†…éƒ¨è°ƒç”¨å¸¦è¶…æ—¶å‚æ•°çš„ wait æ–¹æ³•</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">wait</span><span class="params">(<span class="type">long</span> timeout)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="keyword">if</span> (timeout &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;timeout value is negative&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¿…é¡»æŒæœ‰å¯¹è±¡çš„é”</span></span><br><span class="line">    <span class="keyword">if</span> (!Thread.holdsLock(<span class="built_in">this</span>)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalMonitorStateException</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// é€šçŸ¥è™šæ‹Ÿæœºï¼Œå½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œå¹¶é‡Šæ”¾é”</span></span><br><span class="line">    VM.nativeWait(<span class="built_in">this</span>, timeout);</span><br><span class="line">    <span class="comment">// çº¿ç¨‹è¢«å”¤é†’åï¼Œé‡æ–°ç«äº‰é”</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>wait()</code> æ˜¯çº¿ç¨‹é—´<strong>é€šä¿¡å’Œåä½œ</strong>çš„å…³é”®ï¼Œé€šå¸¸ä¸ <code>notify()</code> æˆ– <code>notifyAll()</code> é…åˆä½¿ç”¨ï¼Œå®ç°ç”Ÿäº§è€…-æ¶ˆè´¹è€…ç­‰è®¾è®¡æ¨¡å¼ã€‚</p><h4 id="4-Thread-join"><a href="#4-Thread-join" class="headerlink" title="4. Thread.join()"></a>4. <code>Thread.join()</code></h4><p><strong>åŠŸèƒ½:</strong> <code>join()</code> æ–¹æ³•æ˜¯ <code>Thread</code> ç±»çš„æ–¹æ³•ï¼Œä½œç”¨æ˜¯è®©<strong>å½“å‰çº¿ç¨‹</strong>ï¼ˆä¾‹å¦‚ä¸»çº¿ç¨‹ï¼‰<strong>ç­‰å¾…</strong>è°ƒç”¨ <code>join()</code> çš„çº¿ç¨‹ï¼ˆä¾‹å¦‚å­çº¿ç¨‹ï¼‰æ‰§è¡Œå®Œæ¯•ã€‚</p><p><strong>æ ¸å¿ƒæœºåˆ¶:</strong></p><ul><li><code>join()</code> çš„æœ¬è´¨æ˜¯è°ƒç”¨ <code>wait()</code> æ–¹æ³•ã€‚å®ƒåœ¨å†…éƒ¨ä½¿ç”¨ä¸€ä¸ª<strong>éšå¼çš„é”</strong>æ¥åŒæ­¥ã€‚</li><li>å½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ <code>t.join()</code> æ—¶ï¼Œå½“å‰çº¿ç¨‹ï¼ˆè°ƒç”¨è€…ï¼‰ä¼š<strong>é˜»å¡</strong>ï¼Œç›´åˆ°çº¿ç¨‹ <code>t</code> ç»ˆæ­¢ã€‚</li><li>å¦‚æœçº¿ç¨‹ <code>t</code> ç»ˆæ­¢ï¼ˆæ— è®ºæ˜¯æ­£å¸¸ç»“æŸè¿˜æ˜¯å¼‚å¸¸ç»ˆæ­¢ï¼‰ï¼ŒJVM ä¼šè°ƒç”¨ <code>t.notifyAll()</code> æ¥å”¤é†’æ‰€æœ‰åœ¨ <code>t.join()</code> ä¸Šç­‰å¾…çš„çº¿ç¨‹ã€‚</li></ul><p><strong>æºç è§£æ (ç®€åŒ–ç‰ˆ):</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">join</span><span class="params">(<span class="type">long</span> millis)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="comment">// å¿…é¡»åœ¨åŒæ­¥æ–¹æ³•ä¸­ï¼Œä½¿ç”¨thisä½œä¸ºé”</span></span><br><span class="line">    <span class="type">long</span> <span class="variable">base</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    <span class="type">long</span> <span class="variable">now</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (millis &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;timeout value is negative&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¦‚æœçº¿ç¨‹å·²ç»ç»“æŸï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">    <span class="keyword">if</span> (isAlive()) &#123;</span><br><span class="line">        <span class="comment">// è¿›å…¥ç­‰å¾…</span></span><br><span class="line">        wait(millis);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>join()</code> çš„å®ç°å·§å¦™åœ°åˆ©ç”¨äº† <code>wait()</code> å’Œ <code>notifyAll()</code> çš„æœºåˆ¶ã€‚å½“ä¸€ä¸ªçº¿ç¨‹çš„ <code>run()</code> æ–¹æ³•æ‰§è¡Œå®Œæ¯•æ—¶ï¼ŒJVM ä¼šè‡ªåŠ¨è°ƒç”¨å…¶ <code>notifyAll()</code> æ–¹æ³•ï¼Œä»è€Œå”¤é†’æ‰€æœ‰ç­‰å¾…å®ƒçš„çº¿ç¨‹ã€‚</p><hr><h3 id="2-åŒºåˆ«ä¸ä½¿ç”¨åœºæ™¯æ€»ç»“"><a href="#2-åŒºåˆ«ä¸ä½¿ç”¨åœºæ™¯æ€»ç»“" class="headerlink" title="2. åŒºåˆ«ä¸ä½¿ç”¨åœºæ™¯æ€»ç»“"></a>2. åŒºåˆ«ä¸ä½¿ç”¨åœºæ™¯æ€»ç»“</h3><table><thead><tr><th>ç‰¹æ€§&#x2F;æ–¹æ³•</th><th><code>Thread.sleep()</code></th><th><code>Thread.yield()</code></th><th><code>obj.wait()</code></th><th><code>Thread.join()</code></th></tr></thead><tbody><tr><td><strong>ç±»&#x2F;æ¥å£</strong></td><td><code>java.lang.Thread</code> (é™æ€)</td><td><code>java.lang.Thread</code> (é™æ€)</td><td><code>java.lang.Object</code></td><td><code>java.lang.Thread</code></td></tr><tr><td><strong>æ˜¯å¦é‡Šæ”¾é”</strong></td><td><strong>ä¸é‡Šæ”¾</strong></td><td><strong>ä¸é‡Šæ”¾</strong></td><td><strong>é‡Šæ”¾</strong></td><td><strong>ä¸é‡Šæ”¾</strong> (ä½†å…¶å†…éƒ¨å®ç°ä¼šé‡Šæ”¾)</td></tr><tr><td><strong>çŠ¶æ€è½¬æ¢</strong></td><td><code>RUNNING</code> -&gt; <code>TIMED_WAITING</code></td><td><code>RUNNING</code> -&gt; <code>RUNNABLE</code></td><td><code>RUNNING</code> -&gt; <code>WAITING</code></td><td><code>RUNNING</code> -&gt; <code>WAITING</code>&#x2F;<code>TIMED_WAITING</code></td></tr><tr><td><strong>å”¤é†’æ–¹å¼</strong></td><td>æ—¶é—´åˆ°äº†è‡ªåŠ¨å”¤é†’ æˆ– <code>interrupt()</code></td><td>ä¾èµ–äºæ“ä½œç³»ç»Ÿè°ƒåº¦å™¨ï¼Œç«‹å³æˆ–ç¨åè¢«é‡æ–°è°ƒåº¦</td><td>å¿…é¡»ç”±å…¶ä»–çº¿ç¨‹è°ƒç”¨ <code>notify()</code>&#x2F;<code>notifyAll()</code></td><td>ç›®æ ‡çº¿ç¨‹æ‰§è¡Œç»“æŸæ—¶è‡ªåŠ¨å”¤é†’ æˆ– <code>interrupt()</code></td></tr><tr><td><strong>ä½¿ç”¨åœºæ™¯</strong></td><td>æ¨¡æ‹Ÿè€—æ—¶æ“ä½œï¼Œæˆ–è®©å‡º CPU èµ„æºï¼ˆä½†ä¸é‡Šæ”¾é”ï¼‰</td><td>æç¤ºè°ƒåº¦å™¨ç»™å…¶ä»–çº¿ç¨‹æœºä¼šï¼Œé€šå¸¸ç”¨äºè°ƒè¯•æˆ–ä½ä¼˜å…ˆçº§çš„ä»»åŠ¡</td><td>çº¿ç¨‹é—´çš„<strong>åä½œå’Œé€šä¿¡</strong>ï¼Œå®ç°ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼</td><td><strong>ç­‰å¾…</strong>ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œç»“æŸï¼Œå®ç°çº¿ç¨‹é—´çš„<strong>é¡ºåºæ‰§è¡Œ</strong></td></tr><tr><td><strong>æ˜¯å¦éœ€è¦åŒæ­¥å—</strong></td><td>å¦</td><td>å¦</td><td><strong>æ˜¯</strong> (å¿…é¡»åœ¨ <code>synchronized</code> å—å†…)</td><td>å¦ (ä½†å…¶å†…éƒ¨å®ç°ä¾èµ–äºåŒæ­¥æœºåˆ¶)</td></tr></tbody></table><h3 id="3-ä½¿ç”¨åœºæ™¯ç¤ºä¾‹"><a href="#3-ä½¿ç”¨åœºæ™¯ç¤ºä¾‹" class="headerlink" title="3. ä½¿ç”¨åœºæ™¯ç¤ºä¾‹"></a>3. ä½¿ç”¨åœºæ™¯ç¤ºä¾‹</h3><ul><li><p><strong>sleep()</strong>: ä½ éœ€è¦ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œæ¯”å¦‚æ¯éš”ä¸€ç§’é’Ÿæ‰“å°ä¸€æ¬¡æ—¥å¿—ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">    Thread.sleep(<span class="number">1000</span>); <span class="comment">// æš‚åœä¸€ç§’</span></span><br><span class="line">    System.out.println(<span class="string">&quot;ç­‰å¾…äº† &quot;</span> + (i + <span class="number">1</span>) + <span class="string">&quot; ç§’&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>yield()</strong>: ä½ æœ‰ä¸€ä¸ª CPU å¯†é›†å‹ä»»åŠ¡ï¼Œå¸Œæœ›åœ¨æ¯æ¬¡å¾ªç¯ä¸­ç»™å…¶ä»–çº¿ç¨‹ä¸€ä¸ªè¿è¡Œçš„æœºä¼šï¼Œä»¥é¿å…é¥¥é¥¿ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">    <span class="comment">// æ‰§è¡Œä¸€äº›è®¡ç®—</span></span><br><span class="line">    <span class="keyword">if</span> (i % <span class="number">100</span> == <span class="number">0</span>) &#123;</span><br><span class="line">        Thread.<span class="keyword">yield</span>(); <span class="comment">// è®©å‡º CPU</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>wait()</strong>: ä½ æœ‰ä¸€ä¸ªå…±äº«é˜Ÿåˆ—ï¼Œå½“é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œæ¶ˆè´¹è€…çº¿ç¨‹éœ€è¦ç­‰å¾…ï¼Œå½“ç”Ÿäº§è€…æ”¾å…¥æ–°å…ƒç´ æ—¶ï¼Œæ¶ˆè´¹è€…è¢«å”¤é†’ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">synchronized</span> (sharedQueue) &#123;</span><br><span class="line">    <span class="keyword">while</span> (sharedQueue.isEmpty()) &#123;</span><br><span class="line">        sharedQueue.wait(); <span class="comment">// é˜Ÿåˆ—ä¸ºç©ºï¼Œç­‰å¾…å¹¶é‡Šæ”¾é”</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ¶ˆè´¹å…ƒç´ ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>join()</strong>: ä½ éœ€è¦ç¡®ä¿å­çº¿ç¨‹çš„æ•°æ®å¤„ç†å®Œæˆåï¼Œä¸»çº¿ç¨‹æ‰èƒ½ç»§ç»­ä½¿ç”¨è¿™ä¸ªæ•°æ®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Thread</span> <span class="variable">dataProcessor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123; <span class="comment">/* å¤„ç†æ•°æ® */</span> &#125;);</span><br><span class="line">dataProcessor.start();</span><br><span class="line">dataProcessor.join(); <span class="comment">// ä¸»çº¿ç¨‹ç­‰å¾…æ•°æ®å¤„ç†å®Œæˆ</span></span><br><span class="line">System.out.println(<span class="string">&quot;æ•°æ®å¤„ç†å®Œæˆï¼Œä¸»çº¿ç¨‹å¯ä»¥ç»§ç»­äº†ã€‚&quot;</span>);</span><br></pre></td></tr></table></figure></li></ul><p>ç†è§£è¿™äº›æ–¹æ³•çš„ç»†å¾®å·®åˆ«æ˜¯ç¼–å†™å¥å£®ã€é«˜æ•ˆå¹¶å‘ä»£ç çš„åŸºç¡€ã€‚ç‰¹åˆ«æ˜¯ <code>wait()</code> å’Œ <code>sleep()</code>ï¼Œå®ƒä»¬æœ€å¤§çš„åŒºåˆ«åœ¨äºæ˜¯å¦é‡Šæ”¾é”ï¼Œè¿™ç›´æ¥å½±å“ç€çº¿ç¨‹é—´çš„åŒæ­¥å’Œåä½œæ–¹å¼ã€‚</p><h3 id="çº¿ç¨‹ï¼ˆThreadï¼‰çš„æ¦‚å¿µä¸ç”Ÿå‘½å‘¨æœŸ"><a href="#çº¿ç¨‹ï¼ˆThreadï¼‰çš„æ¦‚å¿µä¸ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="çº¿ç¨‹ï¼ˆThreadï¼‰çš„æ¦‚å¿µä¸ç”Ÿå‘½å‘¨æœŸ"></a>çº¿ç¨‹ï¼ˆThreadï¼‰çš„æ¦‚å¿µä¸ç”Ÿå‘½å‘¨æœŸ</h3><p>çº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿè°ƒåº¦çš„æœ€å°å•ä½ï¼Œæ˜¯è¿›ç¨‹ä¸­çš„ä¸€ä¸ªæ‰§è¡Œè·¯å¾„ã€‚ä¸€ä¸ªè¿›ç¨‹å¯ä»¥åŒ…å«å¤šä¸ªçº¿ç¨‹ï¼Œè¿™äº›çº¿ç¨‹å…±äº«è¿›ç¨‹çš„å†…å­˜ç©ºé—´ã€‚</p><p>çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸé€šå¸¸åŒ…å«ä»¥ä¸‹å…­ç§çŠ¶æ€ï¼ˆå®šä¹‰åœ¨ java.lang.Thread.State æšä¸¾ä¸­ï¼‰ï¼š</p><ul><li><p>NEWï¼ˆæ–°å»ºï¼‰ï¼šçº¿ç¨‹è¢«åˆ›å»ºä½†å°šæœªå¯åŠ¨ã€‚å½“ä½¿ç”¨ new Thread() åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å®ä¾‹åï¼Œå®ƒå°±å¤„äºæ­¤çŠ¶æ€ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Thread</span> <span class="variable">myThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; System.out.println(<span class="string">&quot;Hello from a new thread!&quot;</span>));</span><br><span class="line"><span class="comment">// æ­¤æ—¶ myThread å¤„äº NEW çŠ¶æ€ï¼Œå°šæœªæ‰§è¡Œ start()</span></span><br></pre></td></tr></table></figure></li><li><p>RUNNABLEï¼ˆå¯è¿è¡Œï¼‰ï¼šçº¿ç¨‹å·²è°ƒç”¨ start() æ–¹æ³•ï¼Œæ­£åœ¨ JVM ä¸­è¿è¡Œï¼ˆå¯èƒ½æ­£åœ¨æ‰§è¡Œï¼Œä¹Ÿå¯èƒ½åœ¨ç­‰å¾… CPU è°ƒåº¦ï¼‰ã€‚ä¸€ä¸ª RUNNABLE çŠ¶æ€çš„çº¿ç¨‹å¯èƒ½æ­£åœ¨è¿è¡Œï¼Œä¹Ÿå¯èƒ½å¹¶æ²¡æœ‰è¿è¡Œï¼Œå®ƒä»…ä»…æ˜¯å…·å¤‡äº†è¿è¡Œçš„èµ„æ ¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">myThread.start();</span><br><span class="line"><span class="comment">// æ­¤æ—¶ myThread è¿›å…¥ RUNNABLE çŠ¶æ€ï¼Œç­‰å¾… CPU è°ƒåº¦æ‰§è¡Œ run() æ–¹æ³•</span></span><br></pre></td></tr></table></figure></li><li><p>BLOCKED (é˜»å¡)ï¼šçº¿ç¨‹æ­£åœ¨ç­‰å¾…è·å–ä¸€ä¸ªç›‘è§†å™¨é”(ä¾‹å¦‚ï¼Œè¿›å…¥ synchronized å—æˆ–æ–¹æ³•)ã€‚å½“ä¸€ä¸ªçº¿ç¨‹è¯•å›¾è®¿é—®è¢«å…¶ä»–çº¿ç¨‹é”å®šçš„èµ„æºæ—¶ï¼Œå®ƒä¼šè¿›å…¥æ­¤çŠ¶æ€ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Object</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"><span class="comment">// çº¿ç¨‹å·²ç»æŒæœ‰ lock å¯¹è±¡çš„é”</span></span><br><span class="line"><span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">    <span class="comment">// ... çº¿ç¨‹ A æ­£åœ¨æ‰§è¡Œ</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// çº¿ç¨‹ B å°è¯•è·å– lock å¯¹è±¡çš„é”ï¼Œä½†è¢«çº¿ç¨‹ A å ç”¨ï¼Œä¼šè¿›å…¥ BLOCKED çŠ¶æ€</span></span><br><span class="line"><span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>WAITING (ç­‰å¾…)ï¼šçº¿ç¨‹æ— é™åˆ¶åœ°ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œç‰¹å®šæ“ä½œã€‚ä¾‹å¦‚ï¼Œè°ƒç”¨ Object.wait(), Thread.join() (æ— å‚æ•°) æˆ– LockSupport.park().è¿™äº›æ–¹æ³•ä¼šä½¿çº¿ç¨‹æ”¾å¼ƒ CPU ä½¿ç”¨æƒï¼Œå¹¶è¿›å…¥æ— é™åˆ¶ç­‰å¾…ï¼Œç›´åˆ°è¢«å…¶ä»–çº¿ç¨‹ notify(), notifyAll() æˆ– unpark() å”¤é†’ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Object</span> <span class="variable">sharedObject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"><span class="comment">// çº¿ç¨‹ A:</span></span><br><span class="line"><span class="keyword">synchronized</span> (sharedObject) &#123;</span><br><span class="line">    sharedObject.wait(); <span class="comment">// çº¿ç¨‹ A è¿›å…¥ WAITING çŠ¶æ€ï¼Œå¹¶é‡Šæ”¾ sharedObject çš„é”</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// çº¿ç¨‹ B:</span></span><br><span class="line"><span class="type">Thread</span> <span class="variable">threadA</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123; <span class="comment">/* ... */</span> &#125;);</span><br><span class="line">threadA.start();</span><br><span class="line">threadA.join(); <span class="comment">// çº¿ç¨‹ B ç­‰å¾… threadA æ‰§è¡Œå®Œæ¯•ï¼Œè¿›å…¥ WAITING çŠ¶æ€</span></span><br></pre></td></tr></table></figure></li><li><p>TIMED_WAITING (æœ‰æ—¶é™ç­‰å¾…)ï¼šçº¿ç¨‹åœ¨æŒ‡å®šçš„æ—¶é—´å†…ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œç‰¹å®šæ“ä½œï¼Œæˆ–è€…ä¼‘çœ ã€‚ä¾‹å¦‚ï¼Œè°ƒç”¨ Thread.sleep(long millis)ã€Object.wait(long timeout)ã€Thread.join(long millis)ã€LockSupport.parkNanos() æˆ– LockSupport.parkUntil()ã€‚ä¸€æ—¦è¶…æ—¶é—´åˆ°è¾¾ï¼Œçº¿ç¨‹ä¼šè‡ªåŠ¨ä»ç­‰å¾…çŠ¶æ€å”¤é†’ï¼Œå¹¶å°è¯•é‡æ–°è¿›å…¥ RUNNABLE çŠ¶æ€ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Thread.sleep(<span class="number">1000</span>);</span><br><span class="line"><span class="comment">// çº¿ç¨‹è¿›å…¥ TIMED_WAITING çŠ¶æ€ 1 ç§’</span></span><br></pre></td></tr></table></figure></li><li><p>TERMINATED (ç»ˆæ­¢): çº¿ç¨‹å·²æ‰§è¡Œå®Œæ¯•å…¶ run() æ–¹æ³•, æˆ–è€…å› æœªæ•è·çš„å¼‚å¸¸é€€å‡ºã€‚çº¿ç¨‹ä¸€æ—¦è¿›å…¥æ­¤çŠ¶æ€, å°±ä¸èƒ½å†è¢«é‡æ–°å¯åŠ¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// çº¿ç¨‹çš„ run() æ–¹æ³•æ‰§è¡Œå®Œæ¯•</span></span><br><span class="line"><span class="comment">// çº¿ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æŠ›å‡ºæœªæ•è·çš„å¼‚å¸¸</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="ä»€ä¹ˆæ˜¯çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢"><a href="#ä»€ä¹ˆæ˜¯çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢" class="headerlink" title="ä»€ä¹ˆæ˜¯çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢?"></a><a href="#%E4%BB%80%E4%B9%88%E6%98%AF%E7%BA%BF%E7%A8%8B%E4%B8%8A%E4%B8%8B%E6%96%87%E5%88%87%E6%8D%A2">ä»€ä¹ˆæ˜¯çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢?</a></h3><p>çº¿ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¼šæœ‰è‡ªå·±çš„è¿è¡Œæ¡ä»¶å’ŒçŠ¶æ€ï¼ˆä¹Ÿç§°ä¸Šä¸‹æ–‡ï¼‰ï¼Œæ¯”å¦‚ä¸Šæ–‡æ‰€è¯´åˆ°è¿‡çš„ç¨‹åºè®¡æ•°å™¨ï¼Œæ ˆä¿¡æ¯ç­‰ã€‚å½“å‡ºç°å¦‚ä¸‹æƒ…å†µçš„æ—¶å€™ï¼Œçº¿ç¨‹ä¼šä»å ç”¨ CPU çŠ¶æ€ä¸­é€€å‡ºã€‚</p><ul><li>ä¸»åŠ¨è®©å‡º CPUï¼Œæ¯”å¦‚è°ƒç”¨äº† <code>sleep()</code>, <code>wait()</code> ç­‰ã€‚</li><li>æ—¶é—´ç‰‡ç”¨å®Œï¼Œå› ä¸ºæ“ä½œç³»ç»Ÿè¦é˜²æ­¢ä¸€ä¸ªçº¿ç¨‹æˆ–è€…è¿›ç¨‹é•¿æ—¶é—´å ç”¨ CPU å¯¼è‡´å…¶ä»–çº¿ç¨‹æˆ–è€…è¿›ç¨‹é¥¿æ­»ã€‚</li><li>è°ƒç”¨äº†é˜»å¡ç±»å‹çš„ç³»ç»Ÿä¸­æ–­ï¼Œæ¯”å¦‚è¯·æ±‚ IOï¼Œçº¿ç¨‹è¢«é˜»å¡ã€‚</li><li>è¢«ç»ˆæ­¢æˆ–ç»“æŸè¿è¡Œ</li></ul><p>è¿™å…¶ä¸­å‰ä¸‰ç§éƒ½ä¼šå‘ç”Ÿçº¿ç¨‹åˆ‡æ¢ï¼Œçº¿ç¨‹åˆ‡æ¢æ„å‘³ç€éœ€è¦ä¿å­˜å½“å‰çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ï¼Œç•™å¾…çº¿ç¨‹ä¸‹æ¬¡å ç”¨ CPU çš„æ—¶å€™æ¢å¤ç°åœºã€‚å¹¶åŠ è½½ä¸‹ä¸€ä¸ªå°†è¦å ç”¨ CPU çš„çº¿ç¨‹ä¸Šä¸‹æ–‡ã€‚è¿™å°±æ˜¯æ‰€è°“çš„ <strong>ä¸Šä¸‹æ–‡åˆ‡æ¢</strong>ã€‚</p><p>ä¸Šä¸‹æ–‡åˆ‡æ¢æ˜¯ç°ä»£æ“ä½œç³»ç»Ÿçš„åŸºæœ¬åŠŸèƒ½ï¼Œå› å…¶æ¯æ¬¡éœ€è¦ä¿å­˜ä¿¡æ¯æ¢å¤ä¿¡æ¯ï¼Œè¿™å°†ä¼šå ç”¨ CPUï¼Œå†…å­˜ç­‰ç³»ç»Ÿèµ„æºè¿›è¡Œå¤„ç†ï¼Œä¹Ÿå°±æ„å‘³ç€æ•ˆç‡ä¼šæœ‰ä¸€å®šæŸè€—ï¼Œå¦‚æœé¢‘ç¹åˆ‡æ¢å°±ä¼šé€ æˆæ•´ä½“æ•ˆç‡ä½ä¸‹ã€‚</p><h3 id="Thread-sleep-æ–¹æ³•å’Œ-Object-wait-æ–¹æ³•å¯¹æ¯”"><a href="#Thread-sleep-æ–¹æ³•å’Œ-Object-wait-æ–¹æ³•å¯¹æ¯”" class="headerlink" title="Thread#sleep() æ–¹æ³•å’Œ Object#wait() æ–¹æ³•å¯¹æ¯”"></a><a href="#thread-sleep-%E6%96%B9%E6%B3%95%E5%92%8C-object-wait-%E6%96%B9%E6%B3%95%E5%AF%B9%E6%AF%94">Thread#sleep() æ–¹æ³•å’Œ Object#wait() æ–¹æ³•å¯¹æ¯”</a></h3><hr><p><strong>å…±åŒç‚¹</strong>ï¼šä¸¤è€…éƒ½å¯ä»¥æš‚åœçº¿ç¨‹çš„æ‰§è¡Œã€‚</p><p><strong>åŒºåˆ«</strong>ï¼š</p><ul><li><strong>sleep() æ–¹æ³•æ²¡æœ‰é‡Šæ”¾é”ï¼Œè€Œ wait() æ–¹æ³•é‡Šæ”¾äº†é”</strong> ã€‚</li><li><code>wait()</code> é€šå¸¸è¢«ç”¨äºçº¿ç¨‹é—´äº¤äº’&#x2F;é€šä¿¡ï¼Œ<code>sleep()</code>é€šå¸¸è¢«ç”¨äºæš‚åœæ‰§è¡Œã€‚</li><li><code>wait()</code> æ–¹æ³•è¢«è°ƒç”¨åï¼Œçº¿ç¨‹ä¸ä¼šè‡ªåŠ¨è‹é†’ï¼Œéœ€è¦åˆ«çš„çº¿ç¨‹è°ƒç”¨åŒä¸€ä¸ªå¯¹è±¡ä¸Šçš„ <code>notify()</code>æˆ–è€… <code>notifyAll()</code> æ–¹æ³•ã€‚<code>sleep()</code>æ–¹æ³•æ‰§è¡Œå®Œæˆåï¼Œçº¿ç¨‹ä¼šè‡ªåŠ¨è‹é†’ï¼Œæˆ–è€…ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>wait(long timeout)</code> è¶…æ—¶åçº¿ç¨‹ä¼šè‡ªåŠ¨è‹é†’ã€‚</li><li><code>sleep()</code> æ˜¯ <code>Thread</code> ç±»çš„é™æ€æœ¬åœ°æ–¹æ³•ï¼Œ<code>wait()</code> åˆ™æ˜¯ <code>Object</code> ç±»çš„æœ¬åœ°æ–¹æ³•ã€‚ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡å‘¢ï¼Ÿä¸‹ä¸€ä¸ªé—®é¢˜å°±ä¼šèŠåˆ°ã€‚</li></ul><hr><h3 id="ä¸ºä»€ä¹ˆ-wait-æ–¹æ³•ä¸å®šä¹‰åœ¨-Thread-ä¸­ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆ-wait-æ–¹æ³•ä¸å®šä¹‰åœ¨-Thread-ä¸­ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆ wait() æ–¹æ³•ä¸å®šä¹‰åœ¨ Thread ä¸­ï¼Ÿ"></a><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88-wait-%E6%96%B9%E6%B3%95%E4%B8%8D%E5%AE%9A%E4%B9%89%E5%9C%A8-thread-%E4%B8%AD">ä¸ºä»€ä¹ˆ wait() æ–¹æ³•ä¸å®šä¹‰åœ¨ Thread ä¸­ï¼Ÿ</a></h3><p><code>wait()</code> æ˜¯è®©è·å¾—å¯¹è±¡é”çš„çº¿ç¨‹å®ç°ç­‰å¾…ï¼Œä¼šè‡ªåŠ¨é‡Šæ”¾å½“å‰çº¿ç¨‹å æœ‰çš„å¯¹è±¡é”ã€‚æ¯ä¸ªå¯¹è±¡ï¼ˆ<code>Object</code>ï¼‰éƒ½æ‹¥æœ‰å¯¹è±¡é”ï¼Œæ—¢ç„¶è¦é‡Šæ”¾å½“å‰çº¿ç¨‹å æœ‰çš„å¯¹è±¡é”å¹¶è®©å…¶è¿›å…¥ WAITING çŠ¶æ€ï¼Œè‡ªç„¶æ˜¯è¦æ“ä½œå¯¹åº”çš„å¯¹è±¡ï¼ˆ<code>Object</code>ï¼‰è€Œéå½“å‰çš„çº¿ç¨‹ï¼ˆ<code>Thread</code>ï¼‰ã€‚</p><p>ç±»ä¼¼çš„é—®é¢˜ï¼š<strong>ä¸ºä»€ä¹ˆ sleep() æ–¹æ³•å®šä¹‰åœ¨ Thread ä¸­ï¼Ÿ</strong></p><p>å› ä¸º <code>sleep()</code> æ˜¯è®©å½“å‰çº¿ç¨‹æš‚åœæ‰§è¡Œï¼Œä¸æ¶‰åŠåˆ°å¯¹è±¡ç±»ï¼Œä¹Ÿä¸éœ€è¦è·å¾—å¯¹è±¡é”ã€‚</p><hr><h3 id="å¯ä»¥ç›´æ¥è°ƒç”¨-Thread-ç±»çš„-run-æ–¹æ³•å—ï¼Ÿ"><a href="#å¯ä»¥ç›´æ¥è°ƒç”¨-Thread-ç±»çš„-run-æ–¹æ³•å—ï¼Ÿ" class="headerlink" title="å¯ä»¥ç›´æ¥è°ƒç”¨ Thread ç±»çš„ run æ–¹æ³•å—ï¼Ÿ"></a><a href="#%E5%8F%AF%E4%BB%A5%E7%9B%B4%E6%8E%A5%E8%B0%83%E7%94%A8-thread-%E7%B1%BB%E7%9A%84-run-%E6%96%B9%E6%B3%95%E5%90%97">å¯ä»¥ç›´æ¥è°ƒç”¨ Thread ç±»çš„ run æ–¹æ³•å—ï¼Ÿ</a></h3><p>è¿™æ˜¯å¦ä¸€ä¸ªéå¸¸ç»å…¸çš„ Java å¤šçº¿ç¨‹é¢è¯•é—®é¢˜ï¼Œè€Œä¸”åœ¨é¢è¯•ä¸­ä¼šç»å¸¸è¢«é—®åˆ°ã€‚å¾ˆç®€å•ï¼Œä½†æ˜¯å¾ˆå¤šäººéƒ½ä¼šç­”ä¸ä¸Šæ¥ï¼</p><p>new ä¸€ä¸ª <code>Thread</code>ï¼Œçº¿ç¨‹è¿›å…¥äº†æ–°å»ºçŠ¶æ€ã€‚è°ƒç”¨ <code>start()</code>æ–¹æ³•ï¼Œä¼šå¯åŠ¨ä¸€ä¸ªçº¿ç¨‹å¹¶ä½¿çº¿ç¨‹è¿›å…¥äº†å°±ç»ªçŠ¶æ€ï¼Œå½“åˆ†é…åˆ°æ—¶é—´ç‰‡åå°±å¯ä»¥å¼€å§‹è¿è¡Œäº†ã€‚ <code>start()</code> ä¼šæ‰§è¡Œçº¿ç¨‹çš„ç›¸åº”å‡†å¤‡å·¥ä½œï¼Œç„¶åè‡ªåŠ¨æ‰§è¡Œ <code>run()</code> æ–¹æ³•çš„å†…å®¹ï¼Œè¿™æ˜¯çœŸæ­£çš„å¤šçº¿ç¨‹å·¥ä½œã€‚ ä½†æ˜¯ï¼Œç›´æ¥æ‰§è¡Œ <code>run()</code> æ–¹æ³•ï¼Œä¼šæŠŠ <code>run()</code> æ–¹æ³•å½“æˆä¸€ä¸ª main çº¿ç¨‹ä¸‹çš„æ™®é€šæ–¹æ³•å»æ‰§è¡Œï¼Œå¹¶ä¸ä¼šåœ¨æŸä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œå®ƒï¼Œæ‰€ä»¥è¿™å¹¶ä¸æ˜¯å¤šçº¿ç¨‹å·¥ä½œã€‚</p><p><strong>æ€»ç»“ï¼šè°ƒç”¨ start() æ–¹æ³•æ–¹å¯å¯åŠ¨çº¿ç¨‹å¹¶ä½¿çº¿ç¨‹è¿›å…¥å°±ç»ªçŠ¶æ€ï¼Œç›´æ¥æ‰§è¡Œ run() æ–¹æ³•çš„è¯ä¸ä¼šä»¥å¤šçº¿ç¨‹çš„æ–¹å¼æ‰§è¡Œã€‚</strong></p><h3 id="åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼"><a href="#åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼" class="headerlink" title="åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼"></a>åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼</h3><h4 id="ç»§æ‰¿-Thread-ç±»"><a href="#ç»§æ‰¿-Thread-ç±»" class="headerlink" title="ç»§æ‰¿ Thread ç±»:"></a>ç»§æ‰¿ Thread ç±»:</h4><ul><li>é€šè¿‡åˆ›å»º Thread ç±»çš„å­ç±», å¹¶é‡å†™å…¶ run() æ–¹æ³•, åœ¨è¯¥æ–¹æ³•ä¸­å®šä¹‰çº¿ç¨‹æ‰§è¡Œçš„ä»»åŠ¡ã€‚</li><li>åˆ›å»º Thread å­ç±»çš„å®ä¾‹, å¹¶è°ƒç”¨å…¶ start() æ–¹æ³•æ¥å¯åŠ¨çº¿ç¨‹ã€‚è°ƒç”¨ start() æ–¹æ³•ä¼šä½¿çº¿ç¨‹è¿›å…¥ RUNNABLE çŠ¶æ€, å¹¶ç”± JVM è°ƒåº¦æ‰§è¡Œ run() æ–¹æ³•; ç›´æ¥è°ƒç”¨ run() æ–¹æ³•åˆ™åªæ˜¯åœ¨å½“å‰çº¿ç¨‹ä¸­æ‰§è¡Œæ™®é€šæ–¹æ³•, ä¸ä¼šå¯åŠ¨æ–°çº¿ç¨‹ã€‚</li><li>ä¼˜ç‚¹: å®ç°ç®€å•ç›´è§‚, ä»£ç ç»“æ„æ¸…æ™°ã€‚</li><li>ç¼ºç‚¹: Java æ˜¯å•ç»§æ‰¿çš„, å¦‚æœä½ çš„ç±»å·²ç»ç»§æ‰¿äº†å…¶ä»–ç±», å°±ä¸èƒ½å†ç»§æ‰¿ Thread ç±»ã€‚è¿™é™åˆ¶äº†ç±»çš„çµæ´»æ€§ã€‚æ­¤å¤–, ä»»åŠ¡ (run() æ–¹æ³•ä¸­çš„é€»è¾‘ ) ä¸çº¿ç¨‹æœ¬èº« (Thread å¯¹è±¡) ç´§å¯†è€¦åˆ, ä¸åˆ©äºä»»åŠ¡çš„å¤ç”¨ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MyThread.java</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String threadName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyThread</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.threadName = name;</span><br><span class="line">        System.out.println(<span class="string">&quot;Creating &quot;</span> + threadName );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot; is running via extending Thread.&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">4</span>; i &gt; <span class="number">0</span>; i--) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Thread: &quot;</span> + threadName + <span class="string">&quot;, &quot;</span> + i);</span><br><span class="line">                <span class="comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span></span><br><span class="line">                Thread.sleep(<span class="number">50</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Thread &quot;</span> + threadName + <span class="string">&quot; interrupted.&quot;</span>);</span><br><span class="line">            Thread.currentThread().interrupt(); <span class="comment">// é‡æ–°è®¾ç½®ä¸­æ–­æ ‡å¿—</span></span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;Thread &quot;</span> + threadName + <span class="string">&quot; exiting.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ThreadCreationDemo.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadCreationDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Main thread started.&quot;</span>);</span><br><span class="line">        <span class="type">MyThread</span> <span class="variable">thread1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread</span>(<span class="string">&quot;MyThread-1&quot;</span>);</span><br><span class="line">        thread1.start(); <span class="comment">// å¯åŠ¨æ–°çº¿ç¨‹</span></span><br><span class="line">        <span class="type">MyThread</span> <span class="variable">thread2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread</span>(<span class="string">&quot;MyThread-2&quot;</span>);</span><br><span class="line">        thread2.start(); <span class="comment">// å¯åŠ¨å¦ä¸€ä¸ªæ–°çº¿ç¨‹</span></span><br><span class="line">        System.out.println(<span class="string">&quot;Main thread finished starting other threads.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å®ç°-Runnable-æ¥å£ï¼š"><a href="#å®ç°-Runnable-æ¥å£ï¼š" class="headerlink" title="å®ç° Runnable æ¥å£ï¼š"></a>å®ç° <strong>Runnable</strong> æ¥å£ï¼š</h4><ul><li>å®šä¹‰ä¸€ä¸ªç±»å®ç° <strong>Runnable</strong> æ¥å£ï¼Œå¹¶å®ç°å…¶æŠ½è±¡æ–¹æ³• public void run()ã€‚run() æ–¹æ³•ä¸­åŒ…å«çº¿ç¨‹æ‰§è¡Œçš„å…·ä½“ä»»åŠ¡ã€‚</li><li>åˆ›å»º <strong>Runnable</strong> å®ç°ç±»çš„å®ä¾‹ï¼Œç„¶åå°†å…¶ä½œä¸ºå‚æ•°ä¼ å…¥ Thread ç±»çš„æ„é€ å™¨ (new Thread(Runnable target))ï¼Œå†è°ƒç”¨ Thread å®ä¾‹çš„ start() æ–¹æ³•ã€‚</li><li>ä¼˜ç‚¹ï¼š<ul><li>æ¨èæ–¹å¼ï¼šé¿å…äº† Java å•ç»§æ‰¿çš„é™åˆ¶ï¼Œä½ çš„ç±»å¯ä»¥åŒæ—¶ç»§æ‰¿å…¶ä»–ç±»æ¥å®ç° <strong>Runnable</strong> æ¥å£ã€‚</li><li>ä»»åŠ¡ä¸çº¿ç¨‹è§£è€¦ï¼šRunnable å¯¹è±¡åªè´Ÿè´£å®šä¹‰ä»»åŠ¡ï¼Œè€Œ Thread å¯¹è±¡è´Ÿè´£æ‰§è¡Œä»»åŠ¡ã€‚è¿™æ„å‘³ç€åŒä¸€ä¸ª <strong>Runnable</strong> å¯¹è±¡å¯ä»¥è¢«å¤šä¸ª Thread å®ä¾‹å…±äº«æ‰§è¡Œï¼Œä»è€Œæ›´å¥½åœ°å®ç°èµ„æºçš„å…±äº«å’Œä»»åŠ¡çš„å¤ç”¨ã€‚</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MyRunnable.java</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyRunnable</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String taskName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyRunnable</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.taskName = name;</span><br><span class="line">        System.out.println(<span class="string">&quot;Creating &quot;</span> + taskName );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot; is running via implementing Runnable.&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">4</span>; i &gt; <span class="number">0</span>; i--) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Task: &quot;</span> + taskName + <span class="string">&quot;, &quot;</span> + i);</span><br><span class="line">                Thread.sleep(<span class="number">50</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Task &quot;</span> + taskName + <span class="string">&quot; interrupted.&quot;</span>);</span><br><span class="line">            Thread.currentThread().interrupt();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;Task &quot;</span> + taskName + <span class="string">&quot; exiting.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ThreadCreationDemo.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadCreationDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Main thread started.&quot;</span>);</span><br><span class="line">        <span class="type">Runnable</span> <span class="variable">runnable1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyRunnable</span>(<span class="string">&quot;Runnable-Task-1&quot;</span>);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(runnable1);</span><br><span class="line">        thread3.start();</span><br><span class="line"></span><br><span class="line">        <span class="type">Runnable</span> <span class="variable">runnable2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyRunnable</span>(<span class="string">&quot;Runnable-Task-2&quot;</span>);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(runnable2, <span class="string">&quot;Custom-Thread-Name&quot;</span>); <span class="comment">// å¯ä»¥ç»™çº¿ç¨‹å‘½å</span></span><br><span class="line">        thread4.start();</span><br><span class="line">        System.out.println(<span class="string">&quot;Main thread finished starting runnable threads.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å®ç°Callableæ¥å£"><a href="#å®ç°Callableæ¥å£" class="headerlink" title="å®ç°Callableæ¥å£"></a>å®ç°Callableæ¥å£</h4><p><code>Callable</code> æ˜¯ Java å¹¶å‘ç¼–ç¨‹ä¸­ä¸€ä¸ªéå¸¸é‡è¦çš„æ¥å£ï¼Œå®ƒä¸ <code>Runnable</code> ç±»ä¼¼ï¼Œéƒ½ç”¨äºå®šä¹‰ä¸€ä¸ªå¯åœ¨çº¿ç¨‹ä¸­æ‰§è¡Œçš„ä»»åŠ¡ã€‚ä½† <code>Callable</code> æä¾›äº†æ›´å¼ºå¤§çš„åŠŸèƒ½ï¼Œä¸»è¦ä½“ç°åœ¨ä¸¤ä¸ªæ–¹é¢ï¼š</p><ol><li><strong>å¯ä»¥è¿”å›ç»“æœï¼š</strong> <code>Callable</code> çš„ <code>call()</code> æ–¹æ³•å¯ä»¥è¿”å›ä¸€ä¸ªæ³›å‹ç±»å‹çš„ç»“æœã€‚</li><li><strong>å¯ä»¥æŠ›å‡ºå¼‚å¸¸ï¼š</strong> <code>Callable</code> çš„ <code>call()</code> æ–¹æ³•å¯ä»¥å£°æ˜æŠ›å‡ºä»»ä½• <code>Exception</code>ã€‚</li></ol><p>è¿™ä¸ <code>Runnable</code> æ¥å£å½¢æˆäº†é²œæ˜å¯¹æ¯”ï¼Œ<code>Runnable</code> çš„ <code>run()</code> æ–¹æ³•æ²¡æœ‰è¿”å›å€¼ï¼Œä¹Ÿä¸èƒ½æŠ›å‡ºå—æ£€å¼‚å¸¸ï¼ˆchecked exceptionï¼‰ã€‚</p><ul><li><h3 id="Callable-çš„åŸºæœ¬ç»“æ„"><a href="#Callable-çš„åŸºæœ¬ç»“æ„" class="headerlink" title="Callable çš„åŸºæœ¬ç»“æ„"></a><code>Callable</code> çš„åŸºæœ¬ç»“æ„</h3></li></ul><p><code>Callable</code> æ¥å£æ˜¯ä¸€ä¸ªæ³›å‹æ¥å£ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Callable</span>&lt;V&gt; &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¡ç®—å¹¶è¿”å›ç»“æœï¼Œæˆ–åœ¨æ— æ³•åšåˆ°æ—¶æŠ›å‡ºå¼‚å¸¸ã€‚</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> è®¡ç®—ç»“æœ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception å¦‚æœæ— æ³•è®¡ç®—ç»“æœ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    V <span class="title function_">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p><code>&lt;V&gt;</code>ï¼šæ³›å‹å‚æ•°ï¼Œä»£è¡¨ <code>call()</code> æ–¹æ³•å°†è¦è¿”å›çš„ç»“æœç±»å‹ã€‚</p></li><li><p><code>V call()</code>ï¼š<code>call()</code> æ–¹æ³•çš„ç­¾åï¼Œå®ƒè¿”å›ä¸€ä¸ª <code>V</code> ç±»å‹çš„ç»“æœï¼Œå¹¶ä¸”å¯ä»¥æŠ›å‡ºå¼‚å¸¸ã€‚</p></li><li><h3 id="å¦‚ä½•ä½¿ç”¨-Callable"><a href="#å¦‚ä½•ä½¿ç”¨-Callable" class="headerlink" title="å¦‚ä½•ä½¿ç”¨ Callable"></a>å¦‚ä½•ä½¿ç”¨ <code>Callable</code></h3></li></ul><p><code>Callable</code> æ¥å£æœ¬èº«å¹¶ä¸èƒ½ç›´æ¥ä½œä¸º <code>Thread</code> çš„æ„é€ å‚æ•°ã€‚å®ƒéœ€è¦é…åˆ <code>ExecutorService</code> çº¿ç¨‹æ± å’Œ <code>Future</code> æ¥å£ä¸€èµ·ä½¿ç”¨ã€‚</p><p><strong>å…¸å‹ä½¿ç”¨æµç¨‹ï¼š</strong></p><ol><li><p><strong>åˆ›å»º Callable ä»»åŠ¡ï¼š</strong> å®ç° <code>Callable</code> æ¥å£ï¼Œå¹¶åœ¨ <code>call()</code> æ–¹æ³•ä¸­ç¼–å†™å…·ä½“çš„ä¸šåŠ¡é€»è¾‘ï¼Œè¿”å›ä¸€ä¸ªç»“æœã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.Callable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyCallableTask</span> <span class="keyword">implements</span> <span class="title class_">Callable</span>&lt;String&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Thread.sleep(<span class="number">2000</span>); <span class="comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œè¿”å›ç»“æœ&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>åˆ›å»º ExecutorService çº¿ç¨‹æ± ï¼š</strong> ä½¿ç”¨ <code>Executors</code> å·¥å‚ç±»åˆ›å»ºçº¿ç¨‹æ± ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"></span><br><span class="line"><span class="type">ExecutorService</span> <span class="variable">executor</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">2</span>);</span><br></pre></td></tr></table></figure></li><li><p><strong>æäº¤ Callable ä»»åŠ¡ï¼š</strong> ä½¿ç”¨ <code>ExecutorService</code> çš„ <code>submit()</code> æ–¹æ³•æäº¤ä»»åŠ¡ã€‚<code>submit()</code> æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª <code>Future</code> å¯¹è±¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.Future;</span><br><span class="line"></span><br><span class="line">Callable&lt;String&gt; task = <span class="keyword">new</span> <span class="title class_">MyCallableTask</span>();</span><br><span class="line">Future&lt;String&gt; future = executor.submit(task);</span><br></pre></td></tr></table></figure></li><li><p><strong>è·å–ä»»åŠ¡ç»“æœï¼š</strong> é€šè¿‡ <code>Future</code> å¯¹è±¡çš„ <code>get()</code> æ–¹æ³•æ¥è·å– <code>Callable</code> ä»»åŠ¡çš„æ‰§è¡Œç»“æœã€‚</p><ul><li><code>future.get()</code> æ˜¯ä¸€ä¸ª<strong>é˜»å¡</strong>æ–¹æ³•ï¼Œå®ƒä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°ä»»åŠ¡æ‰§è¡Œå®Œæ¯•å¹¶è¿”å›ç»“æœã€‚</li><li>å¦‚æœä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œ<code>get()</code> æ–¹æ³•ä¹Ÿä¼šå°†è¿™ä¸ªå¼‚å¸¸åŒ…è£…åœ¨ <code>ExecutionException</code> ä¸­é‡æ–°æŠ›å‡ºã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutionException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> future.get(); <span class="comment">// é˜»å¡ç­‰å¾…ç»“æœ</span></span><br><span class="line">    System.out.println(result);</span><br><span class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">    <span class="comment">// çº¿ç¨‹è¢«ä¸­æ–­</span></span><br><span class="line">    Thread.currentThread().interrupt();</span><br><span class="line">&#125; <span class="keyword">catch</span> (ExecutionException e) &#123;</span><br><span class="line">    <span class="comment">// ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­æŠ›å‡ºçš„å¼‚å¸¸</span></span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    executor.shutdown();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><ul><li><h3 id="Callable-ä¸-Runnable-çš„åŒºåˆ«"><a href="#Callable-ä¸-Runnable-çš„åŒºåˆ«" class="headerlink" title="Callable ä¸ Runnable çš„åŒºåˆ«"></a><code>Callable</code> ä¸ <code>Runnable</code> çš„åŒºåˆ«</h3></li></ul><table><thead><tr><th>ç‰¹æ€§</th><th><code>Callable</code></th><th><code>Runnable</code></th></tr></thead><tbody><tr><td><strong>è¿”å›å€¼</strong></td><td><code>call()</code> æ–¹æ³•æœ‰è¿”å›å€¼ï¼ˆæ³›å‹ <code>V</code>ï¼‰</td><td><code>run()</code> æ–¹æ³•æ²¡æœ‰è¿”å›å€¼ï¼ˆ<code>void</code>ï¼‰</td></tr><tr><td><strong>å¼‚å¸¸å¤„ç†</strong></td><td><code>call()</code> æ–¹æ³•å¯ä»¥æŠ›å‡ºå—æ£€å¼‚å¸¸</td><td><code>run()</code> æ–¹æ³•ä¸èƒ½ç›´æ¥æŠ›å‡ºå—æ£€å¼‚å¸¸</td></tr><tr><td><strong>æ‰§è¡Œæ–¹å¼</strong></td><td>å¿…é¡»é…åˆ <code>ExecutorService.submit()</code> æ‰§è¡Œ</td><td>å¯ä»¥ç›´æ¥ä½œä¸º <code>Thread</code> æ„é€ å‡½æ•°çš„å‚æ•°ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ <code>ExecutorService.execute()</code> æˆ– <code>submit()</code> æ‰§è¡Œ</td></tr><tr><td><strong>åŠŸèƒ½</strong></td><td>é€‚ç”¨äºéœ€è¦è¿”å›è®¡ç®—ç»“æœæˆ–å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„å¼‚æ­¥ä»»åŠ¡</td><td>é€‚ç”¨äºç®€å•çš„å¼‚æ­¥ä»»åŠ¡ï¼Œä¸éœ€è¦è¿”å›ç»“æœ</td></tr></tbody></table><hr><ul><li><h3 id="Future-æ¥å£"><a href="#Future-æ¥å£" class="headerlink" title="Future æ¥å£"></a><code>Future</code> æ¥å£</h3></li></ul><p><code>Future</code> æ¥å£æ˜¯ <code>Callable</code> çš„é‡è¦ä¼´ä¾£ï¼Œå®ƒä»£è¡¨ä¸€ä¸ª<strong>å¼‚æ­¥è®¡ç®—çš„ç»“æœ</strong>ã€‚å®ƒæä¾›äº†æ£€æŸ¥ä»»åŠ¡æ˜¯å¦å®Œæˆã€ç­‰å¾…ä»»åŠ¡å®Œæˆä»¥åŠè·å–ä»»åŠ¡ç»“æœçš„æ–¹æ³•ã€‚</p><p><code>Future</code> æ¥å£çš„ä¸»è¦æ–¹æ³•ï¼š</p><ul><li><p><code>V get()</code>: é˜»å¡å¼åœ°ç­‰å¾…ä»»åŠ¡å®Œæˆï¼Œå¹¶è¿”å›ç»“æœã€‚</p></li><li><p><code>V get(long timeout, TimeUnit unit)</code>: åœ¨æŒ‡å®šæ—¶é—´å†…ç­‰å¾…ä»»åŠ¡å®Œæˆï¼Œè¶…æ—¶åˆ™æŠ›å‡º <code>TimeoutException</code>ã€‚</p></li><li><p><code>boolean isDone()</code>: æ£€æŸ¥ä»»åŠ¡æ˜¯å¦å·²ç»å®Œæˆã€‚</p></li><li><p><code>boolean cancel(boolean mayInterruptIfRunning)</code>: å°è¯•å–æ¶ˆä»»åŠ¡ã€‚</p></li><li><h3 id="æ€»ç»“-6"><a href="#æ€»ç»“-6" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3></li></ul><p><code>Callable</code> æ˜¯ Java å¹¶å‘ç¼–ç¨‹ä¸­ä¸€ä¸ªæ›´é«˜çº§çš„ä»»åŠ¡æŠ½è±¡ï¼Œå®ƒè§£å†³äº† <code>Runnable</code> æ¥å£æ— æ³•è¿”å›ç»“æœå’Œå¤„ç†å—æ£€å¼‚å¸¸çš„ç—›ç‚¹ã€‚é€šè¿‡ä¸ <code>ExecutorService</code> å’Œ <code>Future</code> æ¥å£çš„ç»„åˆä½¿ç”¨ï¼Œ<code>Callable</code> ä½¿å¾—å¼‚æ­¥ç¼–ç¨‹å˜å¾—æ›´åŠ ç®€å•å’Œçµæ´»ï¼Œéå¸¸é€‚åˆé‚£äº›éœ€è¦è€—æ—¶è®¡ç®—å¹¶è¿”å›ç»“æœçš„åœºæ™¯ï¼Œæ¯”å¦‚ç½‘ç»œè¯·æ±‚ã€æ•°æ®å¤„ç†ç­‰ã€‚</p><h4 id="çº¿ç¨‹æ± -Thread-Pool"><a href="#çº¿ç¨‹æ± -Thread-Pool" class="headerlink" title="çº¿ç¨‹æ±  (Thread Pool)"></a>çº¿ç¨‹æ±  (Thread Pool)</h4><p>çº¿ç¨‹æ± æ˜¯ä¸€ç§åŸºäºæ± åŒ–æ€æƒ³çš„çº¿ç¨‹ç®¡ç†æœºåˆ¶ï¼Œç”¨äºç®¡ç†å’Œå¤ç”¨çº¿ç¨‹ï¼Œè€Œä¸æ˜¯åœ¨æ¯æ¬¡éœ€è¦æ‰§è¡Œä»»åŠ¡æ—¶éƒ½åˆ›å»ºæ–°çº¿ç¨‹ã€‚</p><ul><li><p><strong>ä¸ºä»€ä¹ˆä½¿ç”¨çº¿ç¨‹æ± ï¼Ÿ</strong></p><ul><li>é™ä½èµ„æºæ¶ˆè€—:é€šè¿‡é‡å¤åˆ©ç”¨å·²åˆ›å»ºçš„çº¿ç¨‹ï¼Œé™ä½çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯çš„å¼€é”€ã€‚</li><li>æé«˜å“åº”é€Ÿåº¦:å½“ä»»åŠ¡åˆ°è¾¾æ—¶ï¼Œä»»åŠ¡å¯ä»¥ç›´æ¥æ‰§è¡Œï¼Œæ— éœ€ç­‰å¾…çº¿ç¨‹åˆ›å»ºã€‚</li><li>æé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§:çº¿ç¨‹æ˜¯ç¨€ç¼ºèµ„æºï¼Œå¦‚æœæ— é™åˆ¶åœ°åˆ›å»ºï¼Œä¸ä»…ä¼šæ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œè¿˜ä¼šé™ä½ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œä½¿ç”¨çº¿ç¨‹æ± å¯ä»¥ç»Ÿä¸€åˆ†é…ã€è°ƒä¼˜å’Œç›‘æ§ã€‚</li><li>æä¾›æ›´å¤šåŠŸèƒ½:å¦‚å®šæ—¶æ‰§è¡Œã€å‘¨æœŸæ‰§è¡Œã€å•çº¿ç¨‹åŒ–ç­‰ã€‚</li></ul></li><li><p><strong>çº¿ç¨‹æ± çš„æ ¸å¿ƒå‚æ•° (ThreadPoolExecutor æ„é€ æ–¹æ³•)</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">ThreadPoolExecutor</span><span class="params">(<span class="type">int</span> corePoolSize,</span></span><br><span class="line"><span class="params">    <span class="type">int</span> maximumPoolSize,</span></span><br><span class="line"><span class="params">    <span class="type">long</span> keepAliveTime,</span></span><br><span class="line"><span class="params">    TimeUnit unit,</span></span><br><span class="line"><span class="params">    BlockingQueue&lt;Runnable&gt; workQueue,</span></span><br><span class="line"><span class="params">    ThreadFactory threadFactory,</span></span><br><span class="line"><span class="params">    RejectedExecutionHandler handler)</span></span><br></pre></td></tr></table></figure><ul><li><p>corePoolSize: æ ¸å¿ƒçº¿ç¨‹æ•°ã€‚çº¿ç¨‹æ± ä¸­å§‹ç»ˆä¿æŒçš„çº¿ç¨‹æ•°é‡ï¼Œå³ä½¿å®ƒä»¬å¤„äºç©ºé—²çŠ¶æ€ï¼Œé™¤éè®¾ç½®äº† allowCoreThreadTimeOut(true)ã€‚</p></li><li><p>maximumPoolSize: æœ€å¤§çº¿ç¨‹æ•°ã€‚çº¿ç¨‹æ± ä¸­å…è®¸å­˜åœ¨çš„æœ€å¤§çº¿ç¨‹æ•°é‡ã€‚å½“å·¥ä½œé˜Ÿåˆ—å·²æ»¡ä¸”æ ¸å¿ƒçº¿ç¨‹éƒ½åœ¨å¿™ç¢Œæ—¶ï¼Œçº¿ç¨‹æ± ä¼šåˆ›å»ºæ–°çš„éæ ¸å¿ƒçº¿ç¨‹ï¼Œç›´åˆ°è¾¾åˆ°è¿™ä¸ªæ•°é‡ã€‚</p></li><li><p>keepAliveTime: å½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡è¶…è¿‡ corePoolSize æ—¶ï¼Œè¿™äº›ç©ºé—²çš„éæ ¸å¿ƒçº¿ç¨‹åœ¨ç»ˆæ­¢ä¹‹å‰ç­‰å¾…æ–°ä»»åŠ¡çš„æœ€é•¿æ—¶é—´ã€‚</p></li><li><p>unit: keepAliveTime å‚æ•°çš„æ—¶é—´å•ä½ã€‚</p></li><li><p>workQueue: ä»»åŠ¡é˜Ÿåˆ— (é˜»å¡é˜Ÿåˆ—)ã€‚ç”¨äºå­˜æ”¾ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡ã€‚</p><ul><li>ArrayBlockingQueue: åŸºäºæ•°ç»„çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ï¼Œéœ€è¦æŒ‡å®šå®¹é‡ã€‚</li><li>LinkedBlockingQueue: åŸºäºé“¾è¡¨çš„é˜»å¡é˜Ÿåˆ—ï¼Œå®¹é‡å¯ä»¥æŒ‡å®šï¼Œä¹Ÿå¯ä»¥æ˜¯æ— ç•Œçš„ï¼ˆé»˜è®¤ï¼‰ã€‚å¦‚æœä½¿ç”¨æ— ç•Œé˜Ÿåˆ—ï¼ŒmaximumPoolSize å‚æ•°å°†å¤±æ•ˆã€‚</li><li>SynchronousQueue: ä¸€ä¸ªä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ã€‚æ¯ä¸ªæ’å…¥æ“ä½œå¿…é¡»ç­‰å¾…ä¸€ä¸ªå¯¹åº”çš„ç§»é™¤æ“ä½œï¼Œåä¹‹äº¦ç„¶ã€‚</li><li>PriorityBlockingQueue: æ”¯æŒä¼˜å…ˆçº§çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ï¼ŒæŒ‰ç…§è‡ªç„¶é¡ºåºæˆ–è‡ªå®šä¹‰æ¯”è¾ƒå™¨æ’åºã€‚</li></ul></li><li><p>threadFactory: çº¿ç¨‹å·¥å‚ã€‚ç”¨äºåˆ›å»ºæ–°çº¿ç¨‹ï¼Œå¯ä»¥è‡ªå®šä¹‰çº¿ç¨‹çš„å‘½åã€ä¼˜å…ˆçº§ç­‰ã€‚</p></li><li><p>handler: æ‹’ç»ç­–ç•¥ (å½“çº¿ç¨‹æ± å’Œå·¥ä½œé˜Ÿåˆ—éƒ½å·²æ»¡æ—¶ï¼Œæ–°çš„ä»»åŠ¡åˆ°æ¥æ—¶çš„å¤„ç†æ–¹å¼)ã€‚</p><ul><li><p>ThreadPoolExecutor.AbortPolicy (é»˜è®¤): ç›´æ¥æŠ›å‡º RejectedExecutionException å¼‚å¸¸ã€‚</p></li><li><p>ThreadPoolExecutor.CallerRunsPolicy: ç”±è°ƒç”¨çº¿ç¨‹ (æäº¤ä»»åŠ¡çš„çº¿ç¨‹) æ‰§è¡Œä»»åŠ¡ã€‚</p></li><li><p>ThreadPoolExecutor.DiscardOldestPolicy: ä¸¢å¼ƒé˜Ÿåˆ—ä¸­æœ€è€çš„ä»»åŠ¡ï¼Œç„¶åå°è¯•æäº¤å½“å‰ä»»åŠ¡ã€‚</p></li><li><p>ThreadPoolExecutor.DiscardPolicy: ç›´æ¥ä¸¢å¼ƒå½“å‰æ–°æäº¤çš„ä»»åŠ¡ã€‚</p></li><li><p>å› ä¸º<code>CallerRunsPolicy</code>è¿™ä¸ªæ‹’ç»ç­–ç•¥ï¼Œå¯¼è‡´è€—æ—¶çš„ä»»åŠ¡ç”¨äº†ä¸»çº¿ç¨‹æ‰§è¡Œï¼Œå¯¼è‡´çº¿ç¨‹æ± é˜»å¡ï¼Œè¿›è€Œå¯¼è‡´åç»­ä»»åŠ¡æ— æ³•åŠæ—¶æ‰§è¡Œï¼Œä¸¥é‡çš„æƒ…å†µä¸‹å¾ˆå¯èƒ½å¯¼è‡´ OOMã€‚</p><p>æˆ‘ä»¬ä»é—®é¢˜çš„æœ¬è´¨å…¥æ‰‹ï¼Œè°ƒç”¨è€…é‡‡ç”¨<code>CallerRunsPolicy</code>æ˜¯å¸Œæœ›æ‰€æœ‰çš„ä»»åŠ¡éƒ½èƒ½å¤Ÿè¢«æ‰§è¡Œï¼Œæš‚æ—¶æ— æ³•å¤„ç†çš„ä»»åŠ¡åˆè¢«ä¿å­˜åœ¨é˜»å¡é˜Ÿåˆ—<code>BlockingQueue</code>ä¸­ã€‚è¿™æ ·çš„è¯ï¼Œåœ¨å†…å­˜å…è®¸çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å¢åŠ é˜»å¡é˜Ÿåˆ—<code>BlockingQueue</code>çš„å¤§å°å¹¶è°ƒæ•´å †å†…å­˜ä»¥å®¹çº³æ›´å¤šçš„ä»»åŠ¡ï¼Œç¡®ä¿ä»»åŠ¡èƒ½å¤Ÿè¢«å‡†ç¡®æ‰§è¡Œã€‚</p><p>ä¸ºäº†å……åˆ†åˆ©ç”¨ CPUï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è°ƒæ•´çº¿ç¨‹æ± çš„<code>maximumPoolSize</code> ï¼ˆæœ€å¤§çº¿ç¨‹æ•°ï¼‰å‚æ•°ï¼Œè¿™æ ·å¯ä»¥æé«˜ä»»åŠ¡å¤„ç†é€Ÿåº¦ï¼Œé¿å…ç´¯è®¡åœ¨ <code>BlockingQueue</code>çš„ä»»åŠ¡è¿‡å¤šå¯¼è‡´å†…å­˜ç”¨å®Œã€‚</p></li></ul></li></ul></li><li><p><strong>çº¿ç¨‹æ± çš„æ‰§è¡Œæµç¨‹</strong></p><ol><li>å½“ä¸€ä¸ªä»»åŠ¡æäº¤åˆ°çº¿ç¨‹æ± æ—¶ï¼Œå¦‚æœå½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°å°äº corePoolSizeï¼Œå³ä½¿æœ‰ç©ºé—²çº¿ç¨‹ï¼Œä¹Ÿä¼šåˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªæ–°çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚</li><li>å¦‚æœå½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°å¤§äºæˆ–ç­‰äº corePoolSizeï¼Œä½†ä»»åŠ¡é˜Ÿåˆ— workQueue æœªæ»¡ï¼Œä»»åŠ¡ä¼šè¢«æ·»åŠ åˆ° workQueue ä¸­ç­‰å¾…æ‰§è¡Œã€‚</li><li>å¦‚æœ workQueue å·²æ»¡ï¼Œä½†å½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°å°äº maximumPoolSizeï¼Œçº¿ç¨‹æ± ä¼šåˆ›å»ºæ–°çš„éæ ¸å¿ƒçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚</li><li>å¦‚æœå½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°ç­‰äº maximumPoolSize ä¸” workQueue å·²æ»¡ï¼Œçº¿ç¨‹æ± ä¼šæ ¹æ®æ‹’ç»ç­–ç•¥æ¥å¤„ç†æ–°æäº¤çš„ä»»åŠ¡ã€‚</li></ol></li><li><p><strong>Java å†…ç½®çš„å››ç§å¸¸ç”¨çº¿ç¨‹æ±  (é€šè¿‡ Executors å·¥å‚ç±»åˆ›å»º)</strong></p><ul><li>FixedThreadPool (å›ºå®šå¤§å°çº¿ç¨‹æ± )<ul><li>Executors.newFixedThreadPool(int nThreads)</li><li>corePoolSize &#x3D; maximumPoolSize &#x3D; nThreads</li><li>ä½¿ç”¨æ— ç•Œ LinkedBlockingQueueã€‚</li><li>ç‰¹ç‚¹ï¼šå¯æ§åˆ¶å¹¶å‘çš„çº¿ç¨‹æ•°ï¼Œè¶…å‡ºçš„ä»»åŠ¡ä¼šåœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…ã€‚</li><li>é—®é¢˜ï¼šå½“ä»»åŠ¡æäº¤é€Ÿåº¦è¿œå¤§äºå¤„ç†é€Ÿåº¦æ—¶ï¼Œé˜Ÿåˆ—ä¼šä¸æ–­å¢é•¿ï¼Œå¯èƒ½å¯¼è‡´ OOMã€‚</li></ul></li><li>SingleThreadExecutor (å•çº¿ç¨‹çº¿ç¨‹æ± )<ul><li>Executors.newSingleThreadExecutor()</li><li>corePoolSize &#x3D; maximumPoolSize &#x3D; 1</li><li>ä½¿ç”¨æ— ç•Œ LinkedBlockingQueueã€‚</li><li>ç‰¹ç‚¹ï¼šä¿è¯æ‰€æœ‰ä»»åŠ¡éƒ½åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­æŒ‰é¡ºåºæ‰§è¡Œã€‚</li><li>é—®é¢˜ï¼šåŒ FixedThreadPoolï¼Œé˜Ÿåˆ—æ— é™å¢é•¿å¯èƒ½å¯¼è‡´ OOMã€‚</li></ul></li><li>CachedThreadPoolï¼ˆå¯ç¼“å­˜çº¿ç¨‹æ± ï¼‰<ul><li>Executors.newCachedThreadPool()</li><li>corePoolSize &#x3D; 0, maximumPoolSize &#x3D; Integer.MAX_VALUE</li><li>ä½¿ç”¨ SynchronousQueueã€‚</li><li>keepAliveTime &#x3D; 60s</li><li>ç‰¹ç‚¹ï¼šå½“ä»»åŠ¡åˆ°æ¥æ—¶ï¼Œæœ‰ç©ºé—²çº¿ç¨‹åˆ™å¤ç”¨ï¼Œæ— ç©ºé—²çº¿ç¨‹åˆ™åˆ›å»ºæ–°çº¿ç¨‹ã€‚é€‚ç”¨äºå¤§é‡çŸ­æ—¶ä»»åŠ¡ã€‚</li><li>é—®é¢˜ï¼šmaximumPoolSize è¿‡å¤§ï¼Œå½“ä»»åŠ¡å¹¶å‘é‡æé«˜æ—¶ï¼Œå¯èƒ½åˆ›å»ºå¤§é‡çº¿ç¨‹ï¼Œå¯¼è‡´ç³»ç»Ÿèµ„æºè€—å°½ (OOM)ã€‚</li></ul></li><li>ScheduledThreadPoolï¼ˆå®šæ—¶ä»»åŠ¡çº¿ç¨‹æ± ï¼‰<ul><li>Executors.newScheduledThreadPool(int corePoolSize)</li><li>ç‰¹ç‚¹ï¼šæ”¯æŒå®šæ—¶åŠå‘¨æœŸæ€§ä»»åŠ¡æ‰§è¡Œã€‚</li><li>å†…éƒ¨ä½¿ç”¨ DelayedWorkQueueï¼Œä¸€ä¸ªæ— ç•Œé˜Ÿåˆ—ï¼Œå¯ä»¥æŒ‰æ—¶é—´è¿›è¡Œæ’åºã€‚</li></ul></li></ul></li><li><p><strong>é˜¿é‡Œå·´å·´å¼€å‘æ‰‹å†Œå»ºè®®ï¼šä¸æ¨èä½¿ç”¨ Executors åˆ›å»ºçº¿ç¨‹æ± ï¼Œè€Œæ˜¯æ‰‹åŠ¨é€šè¿‡ ThreadPoolExecutor çš„æ„é€ æ–¹æ³•åˆ›å»ºï¼Œä»¥æ˜ç¡®çº¿ç¨‹æ± çš„è¿è¡Œè§„åˆ™ï¼Œé¿å…èµ„æºè€—å°½çš„é£é™©ã€‚</strong></p></li></ul><p>å¥½çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸æ ¸å¿ƒä¸”é‡è¦çš„ Java å¹¶å‘ç¼–ç¨‹è¯é¢˜ã€‚æˆ‘å°†ä»çº¿ç¨‹æ± çš„<strong>åˆ›å»ºã€ç”Ÿå‘½å‘¨æœŸå’Œå¯åŠ¨æµç¨‹</strong>ä¸‰ä¸ªæ–¹é¢è¿›è¡Œè¯¦ç»†ä¸”æ·±å…¥çš„è§£æã€‚</p><hr><h3 id="ä¸€ã€çº¿ç¨‹æ± çš„åˆ›å»º-ThreadPoolExecutor"><a href="#ä¸€ã€çº¿ç¨‹æ± çš„åˆ›å»º-ThreadPoolExecutor" class="headerlink" title="ä¸€ã€çº¿ç¨‹æ± çš„åˆ›å»º (ThreadPoolExecutor)"></a>ä¸€ã€çº¿ç¨‹æ± çš„åˆ›å»º (ThreadPoolExecutor)</h3><p>Java ä¸­ï¼Œçº¿ç¨‹æ± çš„æ ¸å¿ƒæ˜¯ <code>java.util.concurrent.ThreadPoolExecutor</code> ç±»ã€‚åˆ›å»ºçº¿ç¨‹æ± æœ€æ¨èçš„æ–¹å¼æ˜¯ç›´æ¥ä½¿ç”¨å®ƒçš„æ„é€ å‡½æ•°ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ <code>Executors</code> å·¥å‚ç±»ï¼Œå› ä¸ºè¿™èƒ½è®©ä½ æ›´æ¸…æ¥šåœ°äº†è§£çº¿ç¨‹æ± çš„è¿è¡Œå‚æ•°ã€‚</p><p><code>ThreadPoolExecutor</code> çš„æ„é€ å‡½æ•°æœ‰å¤šä¸ªå‚æ•°ï¼Œç†è§£å®ƒä»¬æ˜¯æŒæ¡çº¿ç¨‹æ± çš„å…³é”®ï¼š</p><p>Java</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public ThreadPoolExecutor(</span><br><span class="line">    int corePoolSize,      // æ ¸å¿ƒçº¿ç¨‹æ•°</span><br><span class="line">    int maximumPoolSize,   // æœ€å¤§çº¿ç¨‹æ•°</span><br><span class="line">    long keepAliveTime,    // çº¿ç¨‹ç©ºé—²å­˜æ´»æ—¶é—´</span><br><span class="line">    TimeUnit unit,         // æ—¶é—´å•ä½</span><br><span class="line">    BlockingQueue&lt;Runnable&gt; workQueue, // ä»»åŠ¡é˜Ÿåˆ—</span><br><span class="line">    ThreadFactory threadFactory,   // çº¿ç¨‹å·¥å‚</span><br><span class="line">    RejectedExecutionHandler handler // æ‹’ç»ç­–ç•¥</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h4 id="å„å‚æ•°è¯¦è§£ï¼š"><a href="#å„å‚æ•°è¯¦è§£ï¼š" class="headerlink" title="å„å‚æ•°è¯¦è§£ï¼š"></a>å„å‚æ•°è¯¦è§£ï¼š</h4><ol><li><strong>corePoolSize (æ ¸å¿ƒçº¿ç¨‹æ•°)</strong>ï¼š<ul><li><strong>ä½œç”¨</strong>ï¼šçº¿ç¨‹æ± ä¸­<strong>å¸¸é©»</strong>çš„çº¿ç¨‹æ•°é‡ã€‚å³ä½¿è¿™äº›çº¿ç¨‹å¤„äºç©ºé—²çŠ¶æ€ï¼Œå®ƒä»¬ä¹Ÿä¸ä¼šè¢«é”€æ¯ã€‚</li><li><strong>ç”¨é€”</strong>ï¼šå½“æœ‰æ–°ä»»åŠ¡æäº¤æ—¶ï¼Œå¦‚æœæ ¸å¿ƒçº¿ç¨‹æ•°æœªè¾¾åˆ° <code>corePoolSize</code>ï¼Œçº¿ç¨‹æ± ä¼šåˆ›å»ºæ–°çº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡ï¼Œç›´åˆ°æ ¸å¿ƒçº¿ç¨‹æ•°è¾¾åˆ°ä¸Šé™ã€‚</li></ul></li><li><strong>maximumPoolSize (æœ€å¤§çº¿ç¨‹æ•°)</strong>ï¼š<ul><li><strong>ä½œç”¨</strong>ï¼šçº¿ç¨‹æ± ä¸­å…è®¸å­˜åœ¨çš„<strong>æœ€å¤§</strong>çº¿ç¨‹æ•°é‡ã€‚</li><li><strong>ç”¨é€”</strong>ï¼šå½“ä»»åŠ¡é˜Ÿåˆ—å·²æ»¡ï¼Œä¸”æ ¸å¿ƒçº¿ç¨‹æ•°å·²æ»¡æ—¶ï¼Œçº¿ç¨‹æ± ä¼šåˆ›å»ºæ–°çš„çº¿ç¨‹ï¼ˆéæ ¸å¿ƒçº¿ç¨‹ï¼‰æ¥å¤„ç†ä»»åŠ¡ï¼Œç›´åˆ°æ€»çº¿ç¨‹æ•°è¾¾åˆ° <code>maximumPoolSize</code>ã€‚</li></ul></li><li><strong>keepAliveTime (çº¿ç¨‹ç©ºé—²å­˜æ´»æ—¶é—´)</strong>ï¼š<ul><li><strong>ä½œç”¨</strong>ï¼šéæ ¸å¿ƒçº¿ç¨‹çš„ç©ºé—²å­˜æ´»æ—¶é—´ã€‚</li><li><strong>ç”¨é€”</strong>ï¼šå½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡è¶…è¿‡ <code>corePoolSize</code> æ—¶ï¼Œå¦‚æœä¸€ä¸ªéæ ¸å¿ƒçº¿ç¨‹ç©ºé—²æ—¶é—´è¶…è¿‡ <code>keepAliveTime</code>ï¼Œå®ƒå°±ä¼šè¢«å›æ”¶ã€‚</li></ul></li><li><strong>unit (æ—¶é—´å•ä½)</strong>ï¼š<ul><li><strong>ä½œç”¨</strong>ï¼š<code>keepAliveTime</code> çš„æ—¶é—´å•ä½ï¼Œå¦‚ç§’ã€åˆ†é’Ÿã€æ¯«ç§’ã€‚</li></ul></li><li><strong>workQueue (ä»»åŠ¡é˜Ÿåˆ—)</strong>ï¼š<ul><li><strong>ä½œç”¨</strong>ï¼šç”¨äº<strong>å­˜æ”¾ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡</strong>ã€‚å½“æ ¸å¿ƒçº¿ç¨‹éƒ½åœ¨å¿™ç¢Œæ—¶ï¼Œæ–°æäº¤çš„ä»»åŠ¡ä¼šè¿›å…¥è¿™ä¸ªé˜Ÿåˆ—ã€‚</li><li><strong>å¸¸è§ç±»å‹</strong>ï¼š<ul><li><code>ArrayBlockingQueue</code>ï¼šåŸºäºæ•°ç»„ï¼Œæœ‰ç•Œçš„é˜»å¡é˜Ÿåˆ—ã€‚</li><li><code>LinkedBlockingQueue</code>ï¼šåŸºäºé“¾è¡¨ï¼Œé€šå¸¸æ˜¯æ— ç•Œçš„ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šå®¹é‡ã€‚</li><li><code>SynchronousQueue</code>ï¼šä¸å­˜å‚¨ä»»åŠ¡ï¼Œæ¯ä¸ªä»»åŠ¡æäº¤éƒ½ä¼šç«‹å³è¢«ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚</li></ul></li></ul></li><li><strong>ThreadFactory (çº¿ç¨‹å·¥å‚)</strong>ï¼š<ul><li><strong>ä½œç”¨</strong>ï¼šç”¨äºåˆ›å»ºçº¿ç¨‹ã€‚å¯ä»¥è‡ªå®šä¹‰å·¥å‚æ¥ä¸ºçº¿ç¨‹å‘½åã€è®¾ç½®å®ˆæŠ¤çŠ¶æ€ç­‰ã€‚</li></ul></li><li><strong>RejectedExecutionHandler (æ‹’ç»ç­–ç•¥)</strong>ï¼š<ul><li><strong>ä½œç”¨</strong>ï¼šå½“ä»»åŠ¡é˜Ÿåˆ—å·²æ»¡ï¼Œä¸”çº¿ç¨‹æ•°è¾¾åˆ° <code>maximumPoolSize</code> æ—¶ï¼Œçº¿ç¨‹æ± ä¼šæ ¹æ®æ‹’ç»ç­–ç•¥æ¥å¤„ç†æ–°æäº¤çš„ä»»åŠ¡ã€‚</li><li><strong>å¸¸è§ç­–ç•¥</strong>ï¼š<ul><li><code>AbortPolicy</code> (é»˜è®¤)ï¼šç›´æ¥æŠ›å‡º <code>RejectedExecutionException</code> å¼‚å¸¸ã€‚</li><li><code>CallerRunsPolicy</code>ï¼šç”±æäº¤ä»»åŠ¡çš„çº¿ç¨‹ï¼ˆcallerï¼‰è‡ªå·±æ¥æ‰§è¡Œä»»åŠ¡ã€‚</li><li><code>DiscardOldestPolicy</code>ï¼šä¸¢å¼ƒä»»åŠ¡é˜Ÿåˆ—ä¸­æœ€è€çš„ä»»åŠ¡ï¼Œç„¶åå°è¯•å°†å½“å‰ä»»åŠ¡åŠ å…¥é˜Ÿåˆ—ã€‚</li><li><code>DiscardPolicy</code>ï¼šç›´æ¥ä¸¢å¼ƒå½“å‰ä»»åŠ¡ï¼Œä¸æŠ›å‡ºå¼‚å¸¸ã€‚</li></ul></li></ul></li></ol><h3 id="äºŒã€çº¿ç¨‹æ± çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#äºŒã€çº¿ç¨‹æ± çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="äºŒã€çº¿ç¨‹æ± çš„ç”Ÿå‘½å‘¨æœŸ"></a>äºŒã€çº¿ç¨‹æ± çš„ç”Ÿå‘½å‘¨æœŸ</h3><p>çº¿ç¨‹æ± æœ‰äº”ç§çŠ¶æ€ï¼Œè¿™äº›çŠ¶æ€é€šè¿‡å†…éƒ¨çš„ <code>ctl</code> å˜é‡æ§åˆ¶ï¼Œå®ƒåŒ…å«çº¿ç¨‹æ± çš„è¿è¡ŒçŠ¶æ€å’Œçº¿ç¨‹æ•°ã€‚</p><ol><li><strong>RUNNING (è¿è¡Œä¸­)</strong>ï¼š<ul><li><strong>çŠ¶æ€</strong>ï¼šæ¥å—æ–°ä»»åŠ¡ï¼Œå¹¶å¤„ç†é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ã€‚</li><li><strong>è½¬æ¢</strong>ï¼šåˆ›å»ºçº¿ç¨‹æ± æ—¶å¤„äºæ­¤çŠ¶æ€ã€‚</li></ul></li><li><strong>SHUTDOWN (å…³é—­)</strong>ï¼š<ul><li><strong>çŠ¶æ€</strong>ï¼šä¸æ¥å—æ–°ä»»åŠ¡ï¼Œä½†ä¼šå¤„ç†é˜»å¡é˜Ÿåˆ—ä¸­çš„å·²æœ‰ä»»åŠ¡ã€‚</li><li><strong>è½¬æ¢</strong>ï¼šè°ƒç”¨ <code>shutdown()</code> æ–¹æ³•åè¿›å…¥æ­¤çŠ¶æ€ã€‚</li></ul></li><li><strong>STOP (åœæ­¢)</strong>ï¼š<ul><li><strong>çŠ¶æ€</strong>ï¼šä¸æ¥å—æ–°ä»»åŠ¡ï¼Œä¹Ÿä¸å¤„ç†é˜»å¡é˜Ÿåˆ—ä¸­çš„å·²æœ‰ä»»åŠ¡ï¼Œä¼šä¸­æ–­æ‰€æœ‰æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ã€‚</li><li><strong>è½¬æ¢</strong>ï¼šè°ƒç”¨ <code>shutdownNow()</code> æ–¹æ³•åè¿›å…¥æ­¤çŠ¶æ€ã€‚</li></ul></li><li><strong>TIDYING (æ•´ç†)</strong>ï¼š<ul><li><strong>çŠ¶æ€</strong>ï¼šæ‰€æœ‰ä»»åŠ¡éƒ½å·²ç»ˆæ­¢ï¼Œçº¿ç¨‹æ•°ä¸º 0ã€‚</li><li><strong>è½¬æ¢</strong>ï¼šå½“çº¿ç¨‹æ± å¤„äº <code>SHUTDOWN</code> æˆ– <code>STOP</code> çŠ¶æ€ï¼Œä¸”æ‰€æœ‰ä»»åŠ¡éƒ½å·²å®Œæˆã€çº¿ç¨‹éƒ½å·²é”€æ¯æ—¶ï¼Œè¿›å…¥æ­¤çŠ¶æ€ã€‚</li></ul></li><li><strong>TERMINATED (ç»ˆæ­¢)</strong>ï¼š<ul><li><strong>çŠ¶æ€</strong>ï¼šå½»åº•ç»ˆæ­¢ï¼Œå¯ä»¥å®‰å…¨åœ°è¿›è¡Œå›æ”¶ã€‚</li><li><strong>è½¬æ¢</strong>ï¼š<code>TIDYING</code> çŠ¶æ€ä¸‹ï¼Œ<code>terminated()</code> æ–¹æ³•æ‰§è¡Œå®Œæ¯•åè¿›å…¥æ­¤çŠ¶æ€ã€‚</li></ul></li></ol><h3 id="ä¸‰ã€çº¿ç¨‹æ± çš„å¯åŠ¨æµç¨‹-ä»»åŠ¡æäº¤è¿‡ç¨‹"><a href="#ä¸‰ã€çº¿ç¨‹æ± çš„å¯åŠ¨æµç¨‹-ä»»åŠ¡æäº¤è¿‡ç¨‹" class="headerlink" title="ä¸‰ã€çº¿ç¨‹æ± çš„å¯åŠ¨æµç¨‹ (ä»»åŠ¡æäº¤è¿‡ç¨‹)"></a>ä¸‰ã€çº¿ç¨‹æ± çš„å¯åŠ¨æµç¨‹ (ä»»åŠ¡æäº¤è¿‡ç¨‹)</h3><p>å½“è°ƒç”¨ <code>executor.execute(Runnable task)</code> æ–¹æ³•æäº¤ä¸€ä¸ªæ–°ä»»åŠ¡æ—¶ï¼Œçº¿ç¨‹æ± ä¼šæŒ‰ç…§ä»¥ä¸‹ä¸¥æ ¼çš„æµç¨‹æ¥å†³å®šå¦‚ä½•å¤„ç†ä»»åŠ¡ï¼š</p><ol><li><strong>æ ¸å¿ƒçº¿ç¨‹æ£€æŸ¥</strong>ï¼š<ul><li>å¦‚æœå½“å‰çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡<strong>å°äº</strong> <code>corePoolSize</code>ï¼Œåˆ™åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªæ–°çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚å³ä½¿æœ‰ç©ºé—²çš„çº¿ç¨‹ï¼Œä¹Ÿä¼šåˆ›å»ºæ–°çº¿ç¨‹ç›´åˆ°è¾¾åˆ°æ ¸å¿ƒçº¿ç¨‹æ•°ã€‚</li></ul></li><li><strong>ä»»åŠ¡é˜Ÿåˆ—æ£€æŸ¥</strong>ï¼š<ul><li>å¦‚æœå½“å‰çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡<strong>ç­‰äºæˆ–å¤§äº</strong> <code>corePoolSize</code>ï¼Œåˆ™å°†ä»»åŠ¡æ”¾å…¥ä»»åŠ¡é˜Ÿåˆ— <code>workQueue</code> ä¸­ç­‰å¾…ã€‚</li></ul></li><li><strong>æœ€å¤§çº¿ç¨‹æ•°æ£€æŸ¥</strong>ï¼š<ul><li>å¦‚æœä»»åŠ¡é˜Ÿåˆ—å·²æ»¡ï¼Œçº¿ç¨‹æ± ä¼šå†æ¬¡æ£€æŸ¥å½“å‰çº¿ç¨‹æ•°ã€‚</li><li>å¦‚æœå½“å‰çº¿ç¨‹æ•°é‡<strong>å°äº</strong> <code>maximumPoolSize</code>ï¼Œåˆ™åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªæ–°çº¿ç¨‹ï¼ˆéæ ¸å¿ƒçº¿ç¨‹ï¼‰æ¥æ‰§è¡Œä»»åŠ¡ã€‚</li></ul></li><li><strong>æ‹’ç»ç­–ç•¥</strong>ï¼š<ul><li>å¦‚æœä»»åŠ¡é˜Ÿåˆ—å·²æ»¡ï¼Œä¸”å½“å‰çº¿ç¨‹æ•°å·²è¾¾åˆ° <code>maximumPoolSize</code>ï¼Œåˆ™æ ¹æ®çº¿ç¨‹æ± çš„<strong>æ‹’ç»ç­–ç•¥</strong>æ¥å¤„ç†è¿™ä¸ªæ–°ä»»åŠ¡ã€‚</li></ul></li></ol><p><strong>æ€»ç»“</strong>ï¼šçº¿ç¨‹æ± çš„è¿è¡Œæ˜¯ä¸€ä¸ªå¤æ‚çš„ã€å¤šé˜¶æ®µçš„è¿‡ç¨‹ã€‚å®ƒä¼˜å…ˆä½¿ç”¨æ ¸å¿ƒçº¿ç¨‹ï¼Œç„¶åå°†ä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—ï¼Œæœ€åæ‰è€ƒè™‘åˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹ã€‚è¿™ä¸ªæµç¨‹è®¾è®¡æ—¨åœ¨æœ€å¤§é™åº¦åœ°åˆ©ç”¨ç°æœ‰çº¿ç¨‹ï¼Œå‡å°‘çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯çš„å¼€é”€ï¼Œä»è€Œæé«˜æ€§èƒ½å’Œèµ„æºåˆ©ç”¨ç‡ã€‚</p><h2 id="ThreadLocalï¼š"><a href="#ThreadLocalï¼š" class="headerlink" title="ThreadLocalï¼š"></a>ThreadLocalï¼š</h2><p>å¥½çš„ï¼Œæˆ‘ä»¬æ¥è¯¦ç»†èŠèŠ <code>ThreadLocal</code>ã€‚</p><h3 id="ThreadLocal-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#ThreadLocal-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ThreadLocal æ˜¯ä»€ä¹ˆï¼Ÿ"></a><code>ThreadLocal</code> æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p><code>ThreadLocal</code>ï¼ˆçº¿ç¨‹æœ¬åœ°å˜é‡ï¼‰å¹¶ä¸æ˜¯ç”¨æ¥è§£å†³çº¿ç¨‹é—´å…±äº«æ•°æ®é—®é¢˜çš„ï¼Œå®ƒçš„æ ¸å¿ƒä½œç”¨æ˜¯<strong>ä¸ºæ¯ä¸ªä½¿ç”¨è¯¥å˜é‡çš„çº¿ç¨‹éƒ½æä¾›ä¸€ä¸ªç‹¬ç«‹çš„ã€éš”ç¦»çš„å‰¯æœ¬</strong>ã€‚</p><p>ä½ å¯ä»¥æŠŠ <code>ThreadLocal</code> æƒ³è±¡æˆä¸€ä¸ªâ€œçº¿ç¨‹ä¸“å±çš„å‚¨ç‰©æŸœâ€ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½å¯ä»¥å¾€è¿™ä¸ªå‚¨ç‰©æŸœé‡Œå­˜ä¸œè¥¿ï¼ˆé€šè¿‡ <code>set()</code> æ–¹æ³•ï¼‰ï¼Œå–ä¸œè¥¿ï¼ˆé€šè¿‡ <code>get()</code> æ–¹æ³•ï¼‰ï¼Œä½†å®ƒåªèƒ½çœ‹åˆ°è‡ªå·±å‚¨ç‰©æŸœé‡Œçš„ä¸œè¥¿ï¼Œæ— æ³•è®¿é—®å…¶ä»–çº¿ç¨‹çš„ã€‚</p><p><code>ThreadLocal</code> å†…éƒ¨å…¶å®æ˜¯é€šè¿‡ä¸€ä¸ª <code>ThreadLocalMap</code> æ¥å®ç°çš„ã€‚è¿™ä¸ª Map çš„é”®æ˜¯ <code>ThreadLocal</code> å¯¹è±¡æœ¬èº«ï¼Œå€¼å°±æ˜¯ä½ å­˜å…¥çš„é‚£ä¸ªå˜é‡ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªå±äºè‡ªå·±çš„ <code>ThreadLocalMap</code>ã€‚</p><hr><h3 id="ä¸ºä»€ä¹ˆéœ€è¦-ThreadLocalï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆéœ€è¦-ThreadLocalï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦ ThreadLocalï¼Ÿ"></a>ä¸ºä»€ä¹ˆéœ€è¦ <code>ThreadLocal</code>ï¼Ÿ</h3><p>æˆ‘ä»¬é€šå¸¸åœ¨å¼€å‘ä¸­ä¼šé‡åˆ°ä¸¤ç§æ•°æ®å…±äº«é—®é¢˜ï¼š</p><ol><li><strong>å¤šä¸ªçº¿ç¨‹å…±äº«ä¸€ä¸ªå˜é‡</strong>ï¼šè¿™ç§æƒ…å†µä¸‹ï¼Œéœ€è¦é€šè¿‡ <code>synchronized</code>ã€<code>volatile</code> æˆ– <code>Lock</code> æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</li><li><strong>æ¯ä¸ªçº¿ç¨‹éœ€è¦ä¸€ä¸ªç‹¬ç«‹çš„å˜é‡</strong>ï¼šè¿™æ˜¯ <code>ThreadLocal</code> çš„ä¸»è¦åº”ç”¨åœºæ™¯ã€‚</li></ol><p>å¦‚æœä¸ç”¨ <code>ThreadLocal</code>ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦è‡ªå·±æ‰‹åŠ¨ç»´æŠ¤ä¸€ä¸ª <code>Map&lt;Thread, Object&gt;</code>ï¼Œæ¯æ¬¡å­˜å–æ•°æ®æ—¶éƒ½ä»¥å½“å‰çº¿ç¨‹ä½œä¸ºé”®ã€‚è¿™æ ·ä¸ä»…éº»çƒ¦ï¼Œè¿˜å®¹æ˜“å‡ºé”™ã€‚<code>ThreadLocal</code> å¸®æˆ‘ä»¬å°è£…äº†è¿™äº›ç»†èŠ‚ï¼Œè®©ä½¿ç”¨å˜å¾—éå¸¸ç®€å•ã€‚</p><hr><h3 id="ThreadLocal-çš„å¸¸è§åº”ç”¨åœºæ™¯"><a href="#ThreadLocal-çš„å¸¸è§åº”ç”¨åœºæ™¯" class="headerlink" title="ThreadLocal çš„å¸¸è§åº”ç”¨åœºæ™¯"></a><code>ThreadLocal</code> çš„å¸¸è§åº”ç”¨åœºæ™¯</h3><p><code>ThreadLocal</code> æœ€å¸¸è§çš„åº”ç”¨åœºæ™¯æ˜¯åœ¨ Web å¼€å‘ä¸­ï¼Œç”¨äº<strong>å­˜å‚¨ä¸å½“å‰è¯·æ±‚ç›¸å…³çš„ä¸Šä¸‹æ–‡ä¿¡æ¯</strong>ã€‚</p><p>ä¾‹å¦‚ï¼Œä¸€ä¸ª HTTP è¯·æ±‚ä»è¿›å…¥æœåŠ¡å™¨åˆ°è¿”å›å“åº”ï¼Œå¯èƒ½ç”±å¤šä¸ªæ–¹æ³•æˆ–ç»„ä»¶æ¥å¤„ç†ï¼Œä½†å®ƒä»¬éƒ½å±äºåŒä¸€ä¸ªçº¿ç¨‹ã€‚å¦‚æœéœ€è¦ä¼ é€’ä¸€äº›è¯·æ±‚ç›¸å…³çš„çŠ¶æ€ï¼ˆæ¯”å¦‚ç”¨æˆ·èº«ä»½ã€äº‹åŠ¡ IDã€æ•°æ®åº“è¿æ¥ï¼‰ï¼Œæˆ‘ä»¬æœ‰å¾ˆå¤šç§åšæ³•ï¼š</p><ul><li><strong>å‚æ•°ä¼ é€’</strong>ï¼šå°†è¿™äº›ä¿¡æ¯ä½œä¸ºå‚æ•°å±‚å±‚ä¼ é€’ã€‚è¿™ä¼šå¯¼è‡´æ–¹æ³•ç­¾åå˜å¾—è‡ƒè‚¿ï¼Œå¹¶ä¸”å¢åŠ äº†ä»£ç çš„è€¦åˆæ€§ã€‚</li><li><strong>é™æ€å˜é‡</strong>ï¼šå¦‚æœç”¨é™æ€å˜é‡ï¼Œå¤šä¸ªè¯·æ±‚åŒæ—¶åˆ°è¾¾æ—¶ä¼šäº’ç›¸è¦†ç›–ï¼Œå¯¼è‡´çº¿ç¨‹ä¸å®‰å…¨ã€‚</li><li><strong>ThreadLocal</strong>ï¼šè¿™æ˜¯æœ€ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆã€‚ä½ å¯ä»¥æŠŠè¿™äº›ä¿¡æ¯å­˜å…¥ <code>ThreadLocal</code>ï¼Œç„¶ååœ¨ä»»ä½•éœ€è¦çš„åœ°æ–¹ç›´æ¥é€šè¿‡ <code>get()</code> æ–¹æ³•è·å–ï¼Œæ— éœ€åœ¨æ–¹æ³•é—´æ˜¾å¼ä¼ é€’ã€‚</li></ul><p><strong>å…¸å‹çš„ä¾‹å­ï¼š</strong></p><ul><li><strong>Spring çš„äº‹åŠ¡ç®¡ç†</strong>ï¼šSpring æ¡†æ¶åœ¨å¤„ç†äº‹åŠ¡æ—¶ï¼Œä¼šä½¿ç”¨ <code>ThreadLocal</code> æ¥ä¿å­˜æ¯ä¸ªçº¿ç¨‹çš„æ•°æ®åº“è¿æ¥ï¼Œç¡®ä¿åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­çš„æ‰€æœ‰æ“ä½œéƒ½ä½¿ç”¨åŒä¸€ä¸ªè¿æ¥ã€‚</li><li><strong>ä¸Šä¸‹æ–‡ä¿¡æ¯</strong>ï¼šä¾‹å¦‚ï¼Œåœ¨è¯·æ±‚å¤„ç†é“¾ä¸­ï¼Œå°†ç”¨æˆ·ç™»å½•ä¿¡æ¯ã€è¯­è¨€åå¥½ç­‰æ•°æ®å­˜å…¥ <code>ThreadLocal</code>ï¼Œä¸‹æ¸¸çš„ä¸šåŠ¡é€»è¾‘å¯ä»¥éšæ—¶è·å–ã€‚</li></ul><hr><h3 id="ThreadLocal-å¯èƒ½å¸¦æ¥çš„é—®é¢˜"><a href="#ThreadLocal-å¯èƒ½å¸¦æ¥çš„é—®é¢˜" class="headerlink" title="ThreadLocal å¯èƒ½å¸¦æ¥çš„é—®é¢˜"></a><code>ThreadLocal</code> å¯èƒ½å¸¦æ¥çš„é—®é¢˜</h3><h4 id="å†…å­˜æ³„æ¼"><a href="#å†…å­˜æ³„æ¼" class="headerlink" title="å†…å­˜æ³„æ¼"></a><strong>å†…å­˜æ³„æ¼</strong></h4><p><code>ThreadLocal</code> å¯èƒ½ä¼šå¯¼è‡´<strong>å†…å­˜æ³„æ¼</strong>ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„é—®é¢˜ã€‚</p><p><code>ThreadLocalMap</code> ä½¿ç”¨çš„æ˜¯<strong>å¼±å¼•ç”¨ï¼ˆWeak Referenceï¼‰</strong> ä½œä¸ºé”®ã€‚è¿™æ„å‘³ç€ï¼Œå½“ <code>ThreadLocal</code> å¯¹è±¡æ²¡æœ‰å…¶ä»–å¼ºå¼•ç”¨æ—¶ï¼Œå³ä½¿å®ƒè¿˜åœ¨ <code>ThreadLocalMap</code> ä¸­ï¼Œåƒåœ¾å›æ”¶å™¨ä¹Ÿä¼šå›æ”¶å®ƒã€‚</p><p>ä½†æ˜¯ï¼Œ<code>ThreadLocalMap</code> çš„å€¼ï¼ˆä¹Ÿå°±æ˜¯ä½ å­˜å…¥çš„å¯¹è±¡ï¼‰æ˜¯<strong>å¼ºå¼•ç”¨</strong>ã€‚å¦‚æœçº¿ç¨‹ä¸€ç›´å­˜æ´»ï¼Œä½†ä½ ä¸å†ä½¿ç”¨ <code>ThreadLocal</code> å¯¹è±¡ï¼Œ<code>ThreadLocalMap</code> ä¸­çš„é”®å°±ä¼šå˜æˆ <code>null</code>ï¼Œä½†å€¼è¿˜åœ¨ã€‚è¿™æ ·ï¼Œå€¼å¯¹è±¡å°±æ— æ³•è¢«å›æ”¶ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼ã€‚</p><p>å¦‚ä½•é¿å…ï¼Ÿ</p><p>è§£å†³è¿™ä¸ªé—®é¢˜çš„å…³é”®åœ¨äºï¼šåœ¨ ThreadLocal ä½¿ç”¨å®Œæ¯•åï¼ŒåŠ¡å¿…è°ƒç”¨ remove() æ–¹æ³•ã€‚</p><p>åœ¨ Web åº”ç”¨ä¸­ï¼Œè¯·æ±‚å¤„ç†ç»“æŸåï¼Œçº¿ç¨‹ä¼šè¢«æ”¾å›çº¿ç¨‹æ± ã€‚å¦‚æœ <code>ThreadLocal</code> æ²¡æœ‰è¢«æ¸…é™¤ï¼Œé‚£ä¹ˆä¸‹ä¸€æ¬¡å…¶ä»–è¯·æ±‚å†æ‹¿åˆ°è¿™ä¸ªçº¿ç¨‹æ—¶ï¼Œå®ƒä¼šè¯»å–åˆ°ä¸Šä¸€ä¸ªè¯·æ±‚æ®‹ç•™çš„æ•°æ®ï¼Œå¯¼è‡´ä¸šåŠ¡é€»è¾‘å‡ºé”™ã€‚å› æ­¤ï¼Œ<strong>æ­£ç¡®ä½¿ç”¨æ¨¡å¼</strong>é€šå¸¸æ˜¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ThreadLocal&lt;String&gt; threadLocal = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    threadLocal.set(<span class="string">&quot;My Data&quot;</span>);</span><br><span class="line">    <span class="comment">// do some work</span></span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="comment">// ç¡®ä¿åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½æ‰§è¡Œæ¸…ç†æ“ä½œ</span></span><br><span class="line">    threadLocal.remove(); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>ThreadLocalMap</code> ä½¿ç”¨å¼±å¼•ç”¨ä½œä¸ºé”®ï¼Œä½†ä½¿ç”¨å¼ºå¼•ç”¨ä½œä¸ºå€¼ï¼Œè¿™æ ·åšä¸»è¦æ˜¯ä¸ºäº†ä¼˜åŒ–å†…å­˜ç®¡ç†å¹¶å¤„ç†ç”± <code>ThreadLocal</code> å¼•èµ·çš„æ½œåœ¨å†…å­˜æ³„æ¼é—®é¢˜ã€‚è¿™ç§è®¾è®¡è™½ç„¶èƒ½è§£å†³ä¸€äº›é—®é¢˜ï¼Œä½†ä¹Ÿå¼•å…¥äº†æ–°çš„æŒ‘æˆ˜ã€‚</p><h3 id="ä¸ºä»€ä¹ˆé”®æ˜¯å¼±å¼•ç”¨ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆé”®æ˜¯å¼±å¼•ç”¨ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆé”®æ˜¯å¼±å¼•ç”¨ï¼Ÿ"></a>ä¸ºä»€ä¹ˆé”®æ˜¯å¼±å¼•ç”¨ï¼Ÿ</h3><p><code>ThreadLocalMap</code> çš„é”®æ˜¯ <code>ThreadLocal</code> å¯¹è±¡çš„å¼±å¼•ç”¨ã€‚å½“ä¸€ä¸ª <code>ThreadLocal</code> å¯¹è±¡æ²¡æœ‰å…¶ä»–åœ°æ–¹ï¼ˆæ¯”å¦‚ä¸€ä¸ªå˜é‡ï¼‰å¼•ç”¨å®ƒæ—¶ï¼Œå®ƒå°±ä¼šè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ã€‚</p><ul><li><strong>é¿å…é”®çš„å†…å­˜æ³„æ¼ï¼š</strong> å¦‚æœé”®æ˜¯å¼ºå¼•ç”¨ï¼Œå³ä½¿ <code>ThreadLocal</code> å¯¹è±¡åœ¨ç¨‹åºä¸­ä¸å†è¢«ä½¿ç”¨ï¼Œåªè¦çº¿ç¨‹è¿˜æ´»ç€ï¼Œè¿™ä¸ª <code>ThreadLocalMap</code> å®ä¾‹å°±ä¼šä¸€ç›´æŒæœ‰å¯¹å®ƒçš„å¼ºå¼•ç”¨ï¼Œå¯¼è‡´ <code>ThreadLocal</code> å¯¹è±¡æœ¬èº«æ— æ³•è¢«å›æ”¶ï¼Œä»è€Œå¼•èµ·å†…å­˜æ³„æ¼ã€‚é€šè¿‡ä½¿ç”¨å¼±å¼•ç”¨ï¼Œå½“ <code>ThreadLocal</code> å˜é‡è¶…å‡ºä½œç”¨åŸŸåï¼Œå³ä½¿çº¿ç¨‹ä¾ç„¶å­˜æ´»ï¼Œ<code>ThreadLocalMap</code> ä¸­çš„é”®ä¹Ÿä¼šè¢«è‡ªåŠ¨å›æ”¶ã€‚</li></ul><h3 id="ä¸ºä»€ä¹ˆå€¼æ˜¯å¼ºå¼•ç”¨ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆå€¼æ˜¯å¼ºå¼•ç”¨ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆå€¼æ˜¯å¼ºå¼•ç”¨ï¼Ÿ"></a>ä¸ºä»€ä¹ˆå€¼æ˜¯å¼ºå¼•ç”¨ï¼Ÿ</h3><p>ä¸é”®ä¸åŒï¼Œ<code>ThreadLocalMap</code> çš„å€¼ï¼ˆä¹Ÿå°±æ˜¯ä½ é€šè¿‡ <code>set</code> æ–¹æ³•å­˜å…¥çš„å¯¹è±¡ï¼‰æ˜¯å¼ºå¼•ç”¨ã€‚</p><ul><li><strong>ç¡®ä¿å€¼çš„å¯ç”¨æ€§ï¼š</strong> å¦‚æœå€¼ä¹Ÿæ˜¯å¼±å¼•ç”¨ï¼Œé‚£ä¹ˆå½“ <code>ThreadLocal</code> å˜é‡è¶…å‡ºä½œç”¨åŸŸåï¼Œå€¼ä¹Ÿå¯èƒ½éšæ—¶è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ã€‚è¿™æ ·ä¸€æ¥ï¼Œå½“ä½ å†æ¬¡é€šè¿‡ <code>get</code> æ–¹æ³•è®¿é—®æ—¶ï¼Œå°±ä¼šå¾—åˆ° <code>null</code>ï¼Œè¿™ä¸ <code>ThreadLocal</code> çš„ä½¿ç”¨åˆè¡·ç›¸æ‚–ã€‚<code>ThreadLocal</code> çš„ç›®çš„æ˜¯ä¸ºæ¯ä¸ªçº¿ç¨‹æä¾›ç‹¬ç«‹çš„ã€å¯ä»¥æŒç»­è®¿é—®çš„å˜é‡å‰¯æœ¬ã€‚</li></ul><h3 id="è¿™ç§è®¾è®¡å¸¦æ¥çš„å†…å­˜æ³„æ¼é—®é¢˜"><a href="#è¿™ç§è®¾è®¡å¸¦æ¥çš„å†…å­˜æ³„æ¼é—®é¢˜" class="headerlink" title="è¿™ç§è®¾è®¡å¸¦æ¥çš„å†…å­˜æ³„æ¼é—®é¢˜"></a>è¿™ç§è®¾è®¡å¸¦æ¥çš„å†…å­˜æ³„æ¼é—®é¢˜</h3><p>è™½ç„¶é”®çš„å¼±å¼•ç”¨è®¾è®¡è§£å†³äº† <code>ThreadLocal</code> å¯¹è±¡çš„å†…å­˜æ³„æ¼ï¼Œä½†å¦‚æœå¼€å‘è€…æ²¡æœ‰æ­£ç¡®åœ°å¤„ç†ï¼Œä»ç„¶ä¼šå¯¼è‡´å€¼çš„å†…å­˜æ³„æ¼ã€‚</p><p>è€ƒè™‘ä»¥ä¸‹åœºæ™¯ï¼š</p><ol><li>ä½ åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­åˆ›å»ºäº†ä¸€ä¸ª <code>ThreadLocal</code> å¯¹è±¡ï¼Œå¹¶è®¾ç½®äº†ä¸€ä¸ªå€¼ã€‚</li><li><code>ThreadLocalMap</code> ä¸­ä¼šæœ‰ä¸€ä¸ªé”®å€¼å¯¹ï¼Œé”®æ˜¯ <code>ThreadLocal</code> å¯¹è±¡çš„å¼±å¼•ç”¨ï¼Œå€¼æ˜¯ä½ è®¾ç½®çš„å¯¹è±¡ã€‚</li><li><code>ThreadLocal</code> å¯¹è±¡åœ¨å¤–éƒ¨ä¸å†è¢«å¼ºå¼•ç”¨ï¼Œè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ã€‚</li><li>æ­¤æ—¶ <code>ThreadLocalMap</code> ä¸­çš„é”®å˜ä¸º <code>null</code>ï¼Œä½†å€¼ä¾ç„¶å­˜åœ¨ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªå¼ºå¼•ç”¨ã€‚</li></ol><p>å¦‚æœçº¿ç¨‹ä¸€ç›´å­˜æ´»ï¼ˆæ¯”å¦‚åœ¨çº¿ç¨‹æ± ä¸­ï¼‰ï¼Œè€Œä½ æ²¡æœ‰æ‰‹åŠ¨è°ƒç”¨ <code>ThreadLocal.remove()</code>ï¼Œé‚£ä¹ˆè¿™ä¸ªå€¼ä¸º <code>null</code> çš„é”®å€¼å¯¹å°±ä¼šä¸€ç›´å ç”¨å†…å­˜ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼ã€‚</p><h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒJava ç¤¾åŒºæ¨èçš„<strong>æœ€ä½³å®è·µ</strong>æ˜¯ï¼š<strong>æ— è®ºä½•æ—¶ä½¿ç”¨å®Œ ThreadLocal å˜é‡ï¼Œéƒ½åº”è¯¥æ˜¾å¼åœ°è°ƒç”¨ ThreadLocal.remove() æ–¹æ³•ã€‚</strong></p><p><code>ThreadLocal.remove()</code> ä¼šä» <code>ThreadLocalMap</code> ä¸­ç§»é™¤å¯¹åº”çš„é”®å€¼å¯¹ï¼Œä»è€Œé‡Šæ”¾å†…å­˜ï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚è¿™ä¸ªæ“ä½œé€šå¸¸åº”è¯¥æ”¾åœ¨ <code>finally</code> å—ä¸­ï¼Œä»¥ç¡®ä¿å³ä½¿å‘ç”Ÿå¼‚å¸¸ï¼Œä¹Ÿèƒ½æ‰§è¡Œæ¸…ç†å·¥ä½œã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ThreadLocal&lt;MyObject&gt; threadLocal = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    threadLocal.set(<span class="keyword">new</span> <span class="title class_">MyObject</span>());</span><br><span class="line">    <span class="comment">// ä¸šåŠ¡é€»è¾‘...</span></span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    threadLocal.remove();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p>æ€»è€Œè¨€ä¹‹ï¼Œ<code>ThreadLocalMap</code> çš„è®¾è®¡æ˜¯ä¸€ç§<strong>å¹³è¡¡</strong>ã€‚å®ƒåˆ©ç”¨å¼±å¼•ç”¨æ¥è‡ªåŠ¨å¤„ç† <code>ThreadLocal</code> å¯¹è±¡çš„å›æ”¶ï¼Œä»è€Œå‡è½»äº†å¼€å‘è€…çš„è´Ÿæ‹…ã€‚ä½†ä¸æ­¤åŒæ—¶ï¼Œå®ƒæŠŠå€¼çš„æ¸…ç†è´£ä»»ç•™ç»™äº†å¼€å‘è€…ï¼Œè¦æ±‚æˆ‘ä»¬é€šè¿‡ <code>remove()</code> æ–¹æ³•æ¥æ˜¾å¼åœ°é‡Šæ”¾å†…å­˜ï¼Œä»è€Œé¿å…å› é•¿æœŸå­˜æ´»çš„çº¿ç¨‹è€Œå¯¼è‡´çš„å€¼çš„å†…å­˜æ³„æ¼ã€‚</p><h4 id="ç»§æ‰¿é—®é¢˜"><a href="#ç»§æ‰¿é—®é¢˜" class="headerlink" title="ç»§æ‰¿é—®é¢˜"></a><strong>ç»§æ‰¿é—®é¢˜</strong></h4><p><code>ThreadLocal</code> çš„å€¼ä¸ä¼šè‡ªåŠ¨ä¼ é€’ç»™å­çº¿ç¨‹ã€‚å¦‚æœä½ éœ€è¦çˆ¶çº¿ç¨‹åˆ›å»ºå­çº¿ç¨‹æ—¶ï¼Œè®©å­çº¿ç¨‹ä¹Ÿèƒ½è®¿é—®çˆ¶çº¿ç¨‹çš„ <code>ThreadLocal</code> å€¼ï¼Œä½ éœ€è¦ä½¿ç”¨ <code>InheritableThreadLocal</code>ã€‚ä¸è¿‡ï¼Œ<code>InheritableThreadLocal</code> åŒæ ·éœ€è¦æ³¨æ„å†…å­˜æ³„æ¼é—®é¢˜ï¼Œå¹¶ä¸”åœ¨çº¿ç¨‹æ± ç¯å¢ƒä¸‹ä½¿ç”¨æ—¶å¯èƒ½ä¼šæœ‰æ„å¤–è¡Œä¸ºï¼Œéœ€è¦æ ¼å¤–å°å¿ƒã€‚</p><h2 id="Collection-é›†åˆæ¡†æ¶"><a href="#Collection-é›†åˆæ¡†æ¶" class="headerlink" title="Collection (é›†åˆæ¡†æ¶):"></a>Collection (é›†åˆæ¡†æ¶):</h2><ul><li>æ ¸å¿ƒæ¥å£: Collection (çˆ¶æ¥å£), List, Set, Mapã€‚</li><li>Iterable æ¥å£: Collection æ¥å£ç»§æ‰¿äº† Iterable æ¥å£,ä½¿å¾—æ‰€æœ‰é›†åˆéƒ½å¯ä»¥é€šè¿‡å¢å¼ºfor å¾ªç¯(foreach)è¿›è¡Œéå†ã€‚</li></ul><h4 id="A-List-æ¥å£åŠå…¶å®ç°ç±»"><a href="#A-List-æ¥å£åŠå…¶å®ç°ç±»" class="headerlink" title="A. List æ¥å£åŠå…¶å®ç°ç±»"></a>A. List æ¥å£åŠå…¶å®ç°ç±»</h4><p>List æ˜¯ä¸€ç§æœ‰åºé›†åˆ,å¯ä»¥åŒ…å«é‡å¤å…ƒç´ ã€‚</p><h5 id="1-ArrayList"><a href="#1-ArrayList" class="headerlink" title="1. ArrayList"></a>1. ArrayList</h5><ul><li><p>åº•å±‚å®ç°:åŸºäºåŠ¨æ€æ•°ç»„(Object[] elementData)å®ç°ã€‚</p></li><li><p>ç‰¹ç‚¹:</p><ul><li>æœ‰åº:å…ƒç´ æœ‰æ’å…¥é¡ºåº,å¯ä»¥é€šè¿‡ç´¢å¼•è®¿é—®(get(index))ã€‚</li><li>å¯é‡å¤:å…è®¸å­˜å‚¨é‡å¤å…ƒç´ ã€‚</li><li>éšæœºè®¿é—®æ•ˆç‡é«˜:é€šè¿‡ç´¢å¼•è®¿é—®å…ƒç´ (get(index))é€Ÿåº¦éå¸¸å¿«,æ—¶é—´å¤æ‚åº¦ä¸ºO(1)ã€‚è¿™æ˜¯å› ä¸ºæ•°ç»„åœ¨å†…å­˜ä¸­æ˜¯è¿ç»­å­˜å‚¨çš„,å¯ä»¥é€šè¿‡åŸºåœ°å€å’Œåç§»é‡ç›´æ¥è®¡ç®—å‡ºå…ƒç´ çš„å†…å­˜åœ°å€ã€‚</li><li>æ’å…¥å’Œåˆ é™¤æ•ˆç‡ä½:<ul><li>åœ¨æ•°ç»„æœ«å°¾æ·»åŠ æˆ–åˆ é™¤å…ƒç´ æ•ˆç‡è¾ƒé«˜(å¹³å‡O(1))ã€‚</li><li>åœ¨æ•°ç»„ä¸­é—´æ’å…¥æˆ–åˆ é™¤å…ƒç´ æ—¶,éœ€è¦ä½¿ç”¨System.arraycopy()ç§»åŠ¨è¢«å½±å“ä½ç½®ä¹‹åçš„æ‰€æœ‰å…ƒç´ ,æ—¶é—´å¤æ‚åº¦ä¸º O(n)ã€‚</li></ul></li><li>çº¿ç¨‹ä¸å®‰å…¨:åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹,å¦‚æœä¸€ä¸ªçº¿ç¨‹æ­£åœ¨ä¿®æ”¹ ArrayList,è€Œå¦ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨è¯»å–æˆ–ä¿®æ”¹å®ƒ,å¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´æˆ– ConcurrentModificationException(åœ¨ä½¿ç”¨è¿­ä»£å™¨æ—¶)ã€‚</li></ul></li><li><p>æ‰©å®¹æœºåˆ¶:</p><ul><li>åˆå§‹å®¹é‡:é»˜è®¤æƒ…å†µä¸‹,å½“ä½ åˆ›å»ºä¸€ä¸ªæ— å‚çš„ArrayListæ—¶,å®ƒçš„åº•å±‚æ•°ç»„æ˜¯ç©ºçš„(DEFAULTCAPACITY_EMPTY_ELEMENTDATA, å³ new Object[0])ã€‚é¦–æ¬¡æ·»åŠ å…ƒç´ æ—¶,å†…éƒ¨æ•°ç»„ä¼šè¢«åˆå§‹åŒ–ä¸ºé»˜è®¤å®¹é‡ DEFAULT_CAPACITY (JDK8ä¸º10)ã€‚å¦‚æœä½ åœ¨åˆ›å»ºæ—¶æŒ‡å®šäº†å®¹é‡(new ArrayList&lt;&gt;(capacity)),åˆ™åˆå§‹å®¹é‡å°±æ˜¯ä½ æŒ‡å®šçš„ã€‚</li><li>æ‰©å®¹æ—¶æœº:å½“ArrayList çš„å½“å‰å…ƒç´ ä¸ªæ•°(size)ç­‰äºåº•å±‚æ•°ç»„çš„å®¹é‡(elementData.length)æ—¶,å°±ä¼šè§¦å‘æ‰©å®¹ã€‚</li><li>æ‰©å®¹æ–¹å¼:æ‰©å®¹é€»è¾‘ä½äºgrow()æ–¹æ³•ä¸­ã€‚<ul><li>è®¡ç®—æ–°çš„å®¹é‡:newCapacity &#x3D; oldCapacity + (oldCapacity &gt;&gt; 1),å³æ–°å®¹é‡æ˜¯æ—§å®¹é‡çš„1.5å€ã€‚</li><li>å¦‚æœè®¡ç®—å‡ºçš„æ–°å®¹é‡ä»ç„¶å°äºéœ€è¦çš„æœ€å°å®¹é‡(minCapacity,å³å½“å‰å…ƒç´ ä¸ªæ•° size + 1),åˆ™ç›´æ¥å°† minCapacity ä½œä¸ºæ–°å®¹é‡ã€‚</li><li>å¦‚æœæ–°å®¹é‡è¶…å‡ºäº†MAX_ARRAY_SIZE(é€šå¸¸æ˜¯ Integer.MAX_VALUE-8),åˆ™ä¼šå°è¯•ä½¿ç”¨ Integer.MAX_VALUE,å¦‚æœä»ä¸è¶³åˆ™æŠ›å‡º OutOfMemoryErrorã€‚</li><li>åˆ›å»ºä¸€ä¸ªæ–°æ•°ç»„,å¹¶å°†æ—§æ•°ç»„ä¸­çš„å…ƒç´ å¤åˆ¶åˆ°æ–°æ•°ç»„ä¸­(Arrays.copyOf()å†…éƒ¨è°ƒç”¨ System.arraycopy())ã€‚</li></ul></li></ul></li><li><p>ä¸ºä»€ä¹ˆè¿™ä¹ˆæ‰©å®¹(1.5å€):</p><ul><li>å¹³è¡¡ç©ºé—´ä¸æ—¶é—´:<ul><li>ç›¸æ¯”äºæ¯æ¬¡åªå¢åŠ 1ä¸ªå…ƒç´ ,1.5å€çš„æ‰©å®¹ç­–ç•¥å‡å°‘äº†æ‰©å®¹çš„æ¬¡æ•°,ä»è€Œå‡å°‘äº†é¢‘ç¹è¿›è¡Œæ•°ç»„å¤åˆ¶å¸¦æ¥çš„æ€§èƒ½å¼€é”€(æ•°ç»„å¤åˆ¶æ˜¯O(n)æ“ä½œ)ã€‚</li><li>ç›¸æ¯”äº2å€æ‰©å®¹,1.5å€çš„ç­–ç•¥åœ¨ç©ºé—´åˆ©ç”¨ç‡ä¸Šæ›´ä¼˜,é¿å…äº†è¿‡åº¦åˆ†é…å’Œæµªè´¹è¿‡å¤šå†…å­˜ã€‚</li></ul></li><li>è¿™æ˜¯ä¸€ä¸ªåœ¨æ—¶é—´å’Œç©ºé—´ä¹‹é—´æƒè¡¡çš„é€‰æ‹©,æ—¨åœ¨æä¾›ä¸€ä¸ªç›¸å¯¹é«˜æ•ˆä¸”å†…å­˜å‹å¥½çš„åŠ¨æ€æ•°ç»„å®ç°ã€‚</li></ul></li><li><p>å¯èƒ½å‡ºç°çš„é—®é¢˜:</p><ul><li>ConcurrentModificationException: åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­,å¦‚æœä¸€ä¸ªçº¿ç¨‹æ­£åœ¨éå† ArrayList(é€šè¿‡è¿­ä»£å™¨æˆ–å¢å¼º forå¾ªç¯),è€Œå¦ä¸€ä¸ªçº¿ç¨‹åŒæ—¶å¯¹å…¶è¿›è¡Œç»“æ„æ€§ä¿®æ”¹(æ·»åŠ ã€åˆ é™¤å…ƒç´ ç­‰),å°±ä¼šæŠ›å‡ºæ­¤å¼‚å¸¸ã€‚è¿™æ˜¯å› ä¸ºArrayList çš„è¿­ä»£å™¨æ˜¯å¿«é€Ÿå¤±è´¥(fail-fast)çš„,å®ƒä¼šæ£€æŸ¥ modCount(ä¿®æ”¹æ¬¡æ•°)æ˜¯å¦ä¸è¿­ä»£å™¨åˆ›å»ºæ—¶ä¸€è‡´ã€‚ä¸ä¸€è‡´åˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</li><li>å†…å­˜å¼€é”€:å¦‚æœé¢„ä¼°å®¹é‡ä¸å‡†ç¡®,é¢‘ç¹æ‰©å®¹ä¼šå¯¼è‡´å¤šæ¬¡æ•°ç»„å¤åˆ¶,å¢åŠ  CPUå’Œå†…å­˜å¼€é”€ã€‚</li><li>å†…å­˜æµªè´¹:å¦‚æœåˆå§‹å®¹é‡è®¾ç½®è¿‡å¤§,è€Œå®é™…ä½¿ç”¨çš„å…ƒç´ å¾ˆå°‘,ä¼šå¯¼è‡´å†…å­˜æµªè´¹ã€‚</li></ul></li><li><p>å¸¸ç”¨æ–¹æ³•:</p><ul><li>add(E e): åœ¨åˆ—è¡¨æœ«å°¾æ·»åŠ å…ƒç´ ã€‚</li><li>add(int index, E e): åœ¨æŒ‡å®šä½ç½®æ’å…¥å…ƒç´ ã€‚</li><li>remove(int index) &#x2F; remove(Object o): åˆ é™¤æŒ‡å®šä½ç½®æˆ–æŒ‡å®šå…ƒç´ çš„ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹ã€‚</li><li>get(int index):è·å–æŒ‡å®šä½ç½®çš„å…ƒç´ ã€‚</li><li>set(int index, E e): æ›¿æ¢æŒ‡å®šä½ç½®çš„å…ƒç´ ã€‚</li><li>size(): è¿”å›åˆ—è¡¨ä¸­å…ƒç´ çš„ä¸ªæ•°ã€‚</li><li>indexOf(Object o) &#x2F; lastIndexOf(Object o):è¿”å›å…ƒç´ ç¬¬ä¸€æ¬¡&#x2F;æœ€åä¸€æ¬¡å‡ºç°çš„ç´¢å¼•ã€‚</li><li>contains(Object o): åˆ¤æ–­æ˜¯å¦åŒ…å«æŸä¸ªå…ƒç´ ã€‚</li><li>clear(): æ¸…ç©ºåˆ—è¡¨ã€‚</li></ul></li><li><p>éå†æ–¹å¼:</p><ol><li><p>ä¼ ç»Ÿ for å¾ªç¯:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; list.size(); i++) &#123;</span><br><span class="line">    System.out.println(list.get(i));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å¢å¼º for å¾ªç¯(foreach):</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (E element: list) &#123; <span class="comment">//å†…éƒ¨ä½¿ç”¨è¿­ä»£å™¨</span></span><br><span class="line">    System.out.println(element);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>è¿­ä»£å™¨(Iterator):</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Iterator&lt;E&gt; it = list.iterator();</span><br><span class="line"><span class="keyword">while</span> (it.hasNext()) &#123;</span><br><span class="line">    System.out.println(it.next());</span><br><span class="line">    <span class="comment">// å¦‚æœéœ€è¦åˆ é™¤å…ƒç´ ,å¿…é¡»ä½¿ç”¨ it.remove(),å¦åˆ™ä¼šæŠ›å‡º</span></span><br><span class="line">    <span class="comment">// ConcurrentModificationException</span></span><br><span class="line">    <span class="comment">// it.remove();</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>Java 8 Stream API:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">list.forEach(System.out::println);</span><br><span class="line"><span class="comment">// æˆ–</span></span><br><span class="line">list.stream().forEach(System.out::println);</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol></li></ul><p><code>RandomAccess</code> æ˜¯ Java é›†åˆæ¡†æ¶ä¸­çš„ä¸€ä¸ª<strong>æ ‡è®°æ¥å£</strong>ï¼Œå®ƒæœ¬èº«ä¸åŒ…å«ä»»ä½•æ–¹æ³•ã€‚å®ƒçš„ä¸»è¦ä½œç”¨æ˜¯å‘Šè¯‰ Java è™šæ‹Ÿæœºï¼ˆJVMï¼‰å’Œå¼€å‘è€…ï¼Œå®ç°äº†è¿™ä¸ªæ¥å£çš„ <code>List</code> é›†åˆ<strong>æ”¯æŒå¿«é€Ÿéšæœºè®¿é—®</strong>ï¼Œå³é€šè¿‡ç´¢å¼•è®¿é—®å…ƒç´ æ—¶ï¼Œæ€§èƒ½æ˜¯æ’å®šçš„ï¼Œé€šå¸¸ä¸º O(1)ã€‚</p><hr><h3 id="ArrayList-å®ç°-RandomAccess-çš„ä½œç”¨"><a href="#ArrayList-å®ç°-RandomAccess-çš„ä½œç”¨" class="headerlink" title="ArrayList å®ç° RandomAccess çš„ä½œç”¨"></a><code>ArrayList</code> å®ç° <code>RandomAccess</code> çš„ä½œç”¨</h3><p><code>ArrayList</code> çš„åº•å±‚æ˜¯<strong>æ•°ç»„</strong>ã€‚é€šè¿‡ç´¢å¼•è®¿é—®æ•°ç»„å…ƒç´ ï¼ˆå¦‚ <code>list.get(i)</code>ï¼‰æ˜¯ä¸€ä¸ªéå¸¸é«˜æ•ˆçš„æ“ä½œï¼Œå› ä¸ºå®ƒç›´æ¥é€šè¿‡å†…å­˜åœ°å€åç§»é‡æ¥æŸ¥æ‰¾ï¼Œè€—æ—¶æ˜¯å›ºå®šçš„ã€‚</p><p><code>RandomAccess</code> æ¥å£çš„ä½œç”¨å°±æ˜¯ä¸ºè¿™ç§ç‰¹æ€§æä¾›ä¸€ä¸ª<strong>æ ‡è®°</strong>ã€‚åœ¨æŸäº›ç®—æ³•æˆ–æ–¹æ³•ä¸­ï¼ˆæ¯”å¦‚ <code>Collections.binarySearch()</code>ï¼‰ï¼Œç¨‹åºä¼šå…ˆæ£€æŸ¥ä¸€ä¸ª <code>List</code> æ˜¯å¦å®ç°äº† <code>RandomAccess</code>ã€‚</p><ul><li>å¦‚æœå®ç°äº†ï¼Œå°±è¯´æ˜å®ƒæ˜¯ <code>ArrayList</code> è¿™ç±»åŸºäºæ•°ç»„çš„åˆ—è¡¨ï¼Œæ­¤æ—¶ä¼šé€‰æ‹©<strong>åŸºäºç´¢å¼•çš„ for å¾ªç¯</strong>è¿›è¡Œéå†ï¼Œå› ä¸ºè¿™ç§æ–¹å¼æœ€å¿«ã€‚</li><li>å¦‚æœæ²¡å®ç°ï¼Œå°±è¯´æ˜å®ƒæ˜¯ <code>LinkedList</code> è¿™ç±»åŸºäºé“¾è¡¨çš„åˆ—è¡¨ï¼Œæ­¤æ—¶ä¼šé€‰æ‹©<strong>è¿­ä»£å™¨</strong>è¿›è¡Œéå†ï¼Œä»¥é¿å…ä½æ•ˆçš„éšæœºè®¿é—®ã€‚</li></ul><p>å› æ­¤ï¼Œ<code>RandomAccess</code> å°±åƒä¸€ä¸ªæ€§èƒ½æç¤ºæ ‡ç­¾ï¼Œå¸®åŠ© JVM å’Œç®—æ³•é€‰æ‹©æœ€åˆé€‚çš„éå†æˆ–æŸ¥æ‰¾ç­–ç•¥ï¼Œä»è€Œä¼˜åŒ–æ€§èƒ½ã€‚</p><hr><h3 id="ä¸ºä»€ä¹ˆ-LinkedList-æ²¡æœ‰å®ç°-RandomAccessï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆ-LinkedList-æ²¡æœ‰å®ç°-RandomAccessï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆ LinkedList æ²¡æœ‰å®ç° RandomAccessï¼Ÿ"></a>ä¸ºä»€ä¹ˆ <code>LinkedList</code> æ²¡æœ‰å®ç° <code>RandomAccess</code>ï¼Ÿ</h3><p><code>LinkedList</code> çš„åº•å±‚æ˜¯<strong>åŒå‘é“¾è¡¨</strong>ã€‚è¦é€šè¿‡ç´¢å¼•è®¿é—®é“¾è¡¨ä¸­çš„ä¸€ä¸ªå…ƒç´ ï¼ˆå¦‚ <code>list.get(i)</code>ï¼‰ï¼Œéœ€è¦ä»å¤´èŠ‚ç‚¹æˆ–å°¾èŠ‚ç‚¹å¼€å§‹ï¼Œé€ä¸ªéå†åˆ°ç›®æ ‡ä½ç½®ã€‚è¿™ä¸ªæ“ä½œçš„è€—æ—¶ä¸ç´¢å¼•å€¼ <code>i</code> æˆæ­£æ¯”ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(n)ã€‚</p><p>å› ä¸º <code>LinkedList</code> ä¸æ”¯æŒå¿«é€Ÿéšæœºè®¿é—®ï¼Œæ‰€ä»¥å®ƒæ²¡æœ‰å®ç° <code>RandomAccess</code> æ¥å£ã€‚å¦‚æœç”¨ for å¾ªç¯æ¥éå† <code>LinkedList</code>ï¼Œæ¯æ¬¡ <code>get(i)</code> è°ƒç”¨éƒ½ä¼šå¯¼è‡´ä¸€æ¬¡ä»å¤´åˆ°å°¾çš„éå†ï¼Œæ•ˆç‡æä½ã€‚ç›¸åï¼Œä½¿ç”¨è¿­ä»£å™¨åˆ™èƒ½ç¡®ä¿æ¯æ¬¡åªç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œæ•ˆç‡æ›´é«˜ã€‚</p><table><thead><tr><th>ç±»å‹</th><th>åº•å±‚æ•°æ®ç»“æ„</th><th>éšæœºè®¿é—®æ€§èƒ½ (<code>get(i)</code>)</th><th>éå†æ–¹å¼</th><th>æ˜¯å¦å®ç° <code>RandomAccess</code></th></tr></thead><tbody><tr><td><strong>ArrayList</strong></td><td>æ•°ç»„</td><td>O(1)</td><td><strong>for å¾ªç¯</strong></td><td>æ˜¯</td></tr><tr><td><strong>LinkedList</strong></td><td>åŒå‘é“¾è¡¨</td><td>O(n)</td><td><strong>è¿­ä»£å™¨</strong></td><td>å¦</td></tr></tbody></table><p>æ€»è€Œè¨€ä¹‹ï¼Œ<code>RandomAccess</code> æ¥å£æ˜¯ä¸€ä¸ªé‡è¦çš„è®¾è®¡æ¨¡å¼ï¼Œå®ƒåˆ©ç”¨å¤šæ€æ€§æ¥æŒ‡å¯¼ç¨‹åºä¸ºä¸åŒçš„ <code>List</code> å®ç°é€‰æ‹©æœ€ä¼˜çš„ç®—æ³•ï¼Œä»è€Œåœ¨ä¸ä¿®æ”¹ä»£ç é€»è¾‘çš„å‰æä¸‹æå‡äº†æ€§èƒ½ã€‚</p><h5 id="2-LinkedList"><a href="#2-LinkedList" class="headerlink" title="2. LinkedList"></a>2. LinkedList</h5><ul><li><p>åº•å±‚å®ç°:åŸºäºåŒå‘é“¾è¡¨(Doubly Linked List)å®ç°ã€‚æ¯ä¸ªèŠ‚ç‚¹éƒ½åŒ…å«æ•°æ®,ä»¥åŠæŒ‡å‘å‰ä¸€ä¸ªèŠ‚ç‚¹å’Œåä¸€ä¸ªèŠ‚ç‚¹çš„å¼•ç”¨ã€‚</p></li><li><p>ç‰¹ç‚¹:</p><ul><li>æœ‰åº:å…ƒç´ æœ‰æ’å…¥é¡ºåºã€‚</li><li>å¯é‡å¤:å…è®¸å­˜å‚¨é‡å¤å…ƒç´ ã€‚</li><li>æ’å…¥å’Œåˆ é™¤æ•ˆç‡é«˜:åœ¨é“¾è¡¨çš„ä»»ä½•ä½ç½®æ’å…¥æˆ–åˆ é™¤å…ƒç´ ,åªéœ€ä¿®æ”¹å‰åèŠ‚ç‚¹çš„å¼•ç”¨,æ—¶é—´å¤æ‚åº¦ä¸ºO(1)ã€‚</li><li>éšæœºè®¿é—®æ•ˆç‡ä½:get(index)æ“ä½œéœ€è¦ä»å¤´èŠ‚ç‚¹æˆ–å°¾èŠ‚ç‚¹å¼€å§‹éå†é“¾è¡¨ç›´åˆ°ç›®æ ‡ç´¢å¼•,æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ã€‚</li><li>å†…å­˜å¼€é”€å¤§:æ¯ä¸ªèŠ‚ç‚¹é™¤äº†å­˜å‚¨æ•°æ®æœ¬èº«,è¿˜éœ€è¦é¢å¤–çš„å†…å­˜ç©ºé—´å­˜å‚¨ä¸¤ä¸ªæŒ‡é’ˆ(prev å’Œ next),å› æ­¤ç›¸æ¯” ArrayList,åœ¨å­˜å‚¨ç›¸åŒæ•°é‡å…ƒç´ æ—¶, LinkedList å ç”¨æ›´å¤šå†…å­˜ã€‚</li><li>çº¿ç¨‹ä¸å®‰å…¨:ä¸ArrayList ç±»ä¼¼,åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¸å®‰å…¨,å¯èƒ½æŠ›å‡º ConcurrentModificationExceptionã€‚</li></ul></li><li><p>æ‰©å®¹æœºåˆ¶:</p><ul><li>LinkedList åŸºäºé“¾è¡¨å®ç°,æ²¡æœ‰å›ºå®šå®¹é‡çš„æ¦‚å¿µ,ä¹Ÿæ— éœ€è¿›è¡Œæ‰©å®¹ã€‚æ¯æ¬¡æ·»åŠ å…ƒç´ å°±æ˜¯åˆ›å»ºä¸€ä¸ªæ–°èŠ‚ç‚¹å¹¶è¿æ¥åˆ°é“¾è¡¨ä¸­ã€‚å› æ­¤ä¸å­˜åœ¨ ArrayList é‚£æ ·çš„æ•°ç»„å¤åˆ¶å¼€é”€ã€‚</li></ul></li><li><p>å¯èƒ½å‡ºç°çš„é—®é¢˜:</p><ul><li>ConcurrentModification Exception:åŒæ ·åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä½¿ç”¨è¿­ä»£å™¨è¿›è¡Œä¿®æ”¹æ—¶å¯èƒ½å‘ç”Ÿã€‚</li><li>å†…å­˜ç¢ç‰‡&#x2F;å¼€é”€:é¢‘ç¹çš„èŠ‚ç‚¹åˆ›å»ºå’Œé”€æ¯,ä»¥åŠæ¯ä¸ªèŠ‚ç‚¹é¢å¤–çš„æŒ‡é’ˆå¼€é”€,å¯èƒ½å¯¼è‡´ä¸€å®šçš„å†…å­˜ç¢ç‰‡å’Œæ›´é«˜çš„å†…å­˜å ç”¨ã€‚</li></ul></li><li><p>å¸¸ç”¨æ–¹æ³•:</p><ul><li>add(E e) &#x2F; addFirst(E e) &#x2F; addLast(E e): æ·»åŠ å…ƒç´ ã€‚</li><li>remove() &#x2F; removeFirst() &#x2F; removeLast():åˆ é™¤å…ƒç´ ã€‚</li><li>get(int index) &#x2F; getFirst() &#x2F; getLast(): è·å–å…ƒç´ (get(int index)æ•ˆç‡ä½)ã€‚</li><li>peek() &#x2F; peekFirst() &#x2F; peekLast(): è·å–ä½†ä¸ç§»é™¤å¤´éƒ¨&#x2F;å°¾éƒ¨å…ƒç´ ã€‚</li><li>offer(E e) &#x2F; offerFirst(E e) &#x2F; offerLast (E e): æ·»åŠ å…ƒç´ åˆ°é˜Ÿåˆ—&#x2F;åŒç«¯é˜Ÿåˆ—(é€šå¸¸ä¸æŠ›å¼‚å¸¸)ã€‚</li><li>poll() &#x2F; pollFirst() &#x2F; pollLast(): è·å–å¹¶ç§»é™¤å¤´éƒ¨&#x2F;å°¾éƒ¨å…ƒç´ (ä¸ºç©ºè¿”å›null)ã€‚</li><li>push(E e) &#x2F; pop():å®ç°æ ˆçš„å…¥æ ˆå’Œå‡ºæ ˆæ“ä½œã€‚</li><li>size(), isEmpty(), contains(Object o), clear().</li></ul></li><li><p>éå†æ–¹å¼:</p><ol><li><p>ä¼ ç»Ÿ for å¾ªç¯: <code>for (int i = 0; i &lt; list.size(); i++) &#123; System.out.println(list.get(i)); &#125;</code>(ä¸æ¨è,æ•ˆç‡ä½)</p></li><li><p>å¢å¼º for å¾ªç¯(foreach): <code>for (E element: list) &#123; System.out.println(element); &#125;</code>(æ¨è)</p></li><li><p>è¿­ä»£å™¨(Iterator):</p><p>Java</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Iterator&lt;E&gt; it = list.iterator();</span><br><span class="line">while (it.hasNext()) &#123;</span><br><span class="line">    System.out.println(it.next());</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>Java 8 Stream API: <code>list.forEach(System.out::println);</code></p></li></ol></li></ul><h5 id="3-Vector"><a href="#3-Vector" class="headerlink" title="3. Vector"></a>3. Vector</h5><ul><li>åº•å±‚å®ç°:åŸºäºåŠ¨æ€æ•°ç»„å®ç°,ä¸ArrayList ç±»ä¼¼ã€‚</li><li>ç‰¹ç‚¹:<ul><li>çº¿ç¨‹å®‰å…¨:æ‰€æœ‰å…¬å…±æ–¹æ³•éƒ½ä½¿ç”¨äº†synchronized å…³é”®å­—è¿›è¡ŒåŒæ­¥,å› æ­¤æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</li><li>æ•ˆç‡ä½:å› ä¸ºæ‰€æœ‰æ“ä½œéƒ½è¢«åŒæ­¥,åœ¨å•çº¿ç¨‹æˆ–å¹¶å‘è¯»å¤šå†™å°‘çš„åœºæ™¯ä¸‹,æ€§èƒ½æ¯” ArrayList å·®ã€‚</li><li>æ‰©å®¹æœºåˆ¶: Vector çš„æ‰©å®¹ç­–ç•¥ä¸ ArrayList ç±»ä¼¼,ä½†é»˜è®¤æ˜¯ç¿»å€æ‰©å®¹(å³æ–°å®¹é‡æ˜¯æ—§å®¹é‡çš„2å€)ã€‚å¯ä»¥é€šè¿‡æ„é€ å‡½æ•°æŒ‡å®šæ‰©å®¹å¢é‡ã€‚</li></ul></li><li>å¯èƒ½å‡ºç°çš„é—®é¢˜:<ul><li>æ€§èƒ½ç“¶é¢ˆ:å…¨å±€é”å¯¼è‡´å¹¶å‘æ€§èƒ½å·®ã€‚</li></ul></li><li>ä½¿ç”¨åœºæ™¯:å·²ç»è¢« java.util.concurrent åŒ…ä¸­çš„å¹¶å‘é›†åˆ(å¦‚ CopyOnWriteArrayList)å–ä»£,åŸºæœ¬ä¸å†æ¨èä½¿ç”¨ã€‚</li></ul><h5 id="4-Stack"><a href="#4-Stack" class="headerlink" title="4. Stack"></a>4. Stack</h5><ul><li>åº•å±‚å®ç°:ç»§æ‰¿è‡ªVector,å› æ­¤ä¹Ÿæ˜¯åŸºäºæ•°ç»„å®ç°,å¹¶å…·æœ‰Vector çš„çº¿ç¨‹å®‰å…¨æ€§ã€‚</li><li>ç‰¹ç‚¹:å®ç°äº†åè¿›å…ˆå‡º(LIFO)çš„æ ˆç»“æ„ã€‚</li><li>å¸¸ç”¨æ–¹æ³•:<ul><li>push(E item):å…ƒç´ å…¥æ ˆã€‚</li><li>pop():å…ƒç´ å‡ºæ ˆã€‚</li><li>peek(): æŸ¥çœ‹æ ˆé¡¶å…ƒç´ ä½†ä¸ç§»é™¤ã€‚</li><li>empty(): åˆ¤æ–­æ ˆæ˜¯å¦ä¸ºç©ºã€‚</li><li>search(Object o): æŸ¥æ‰¾å…ƒç´ å¹¶è¿”å›ç¦»æ ˆé¡¶çš„è·ç¦»ã€‚</li></ul></li><li>ä½¿ç”¨åœºæ™¯:ä¸æ¨èä½¿ç”¨,å› ä¸ºStack ç»§æ‰¿äº†Vector,è€Œ Vector æœ¬èº«æœ‰å¾ˆå¤šä¸é€‚åˆæ ˆæ“ä½œçš„æ–¹æ³•ã€‚é€šå¸¸ä½¿ç”¨ Deque æ¥å£çš„å®ç°ç±»(å¦‚ArrayDeque æˆ– LinkedList)æ¥ä»£æ›¿æ ˆ,å®ƒä»¬æ›´çµæ´»é«˜æ•ˆã€‚</li></ul><h4 id="å°ç»“-List"><a href="#å°ç»“-List" class="headerlink" title="å°ç»“ List:"></a>å°ç»“ List:</h4><ul><li>ArrayList: éšæœºè®¿é—®å¤š,æ’å…¥åˆ é™¤å°‘(å°¤å…¶æœ«å°¾æ“ä½œ)çš„åœºæ™¯ã€‚</li><li>LinkedList: æ’å…¥åˆ é™¤å¤š,éšæœºè®¿é—®å°‘çš„åœºæ™¯;æˆ–éœ€è¦ä½œä¸ºé˜Ÿåˆ—&#x2F;æ ˆä½¿ç”¨çš„åœºæ™¯ã€‚</li><li>Vector &#x2F; Stack:ä¸æ¨èåœ¨ç°ä»£Javaå¼€å‘ä¸­ä½¿ç”¨,é™¤éæœ‰ç‰¹æ®Šå†å²å…¼å®¹éœ€æ±‚ã€‚</li></ul><h4 id="B-Set-æ¥å£åŠå…¶å®ç°ç±»"><a href="#B-Set-æ¥å£åŠå…¶å®ç°ç±»" class="headerlink" title="B. Set æ¥å£åŠå…¶å®ç°ç±»"></a>B. Set æ¥å£åŠå…¶å®ç°ç±»</h4><p>Set æ˜¯ä¸€ç§æ— åºé›†åˆ,ä¸å…è®¸é‡å¤å…ƒç´ ã€‚</p><h5 id="1-HashSet"><a href="#1-HashSet" class="headerlink" title="1. HashSet"></a>1. HashSet</h5><ul><li><p>åº•å±‚å®ç°:åŸºäºHashMap å®ç°ã€‚HashSet å†…éƒ¨ä½¿ç”¨ä¸€ä¸ª HashMap å®ä¾‹æ¥å­˜å‚¨å…ƒç´ ,HashSet çš„å…ƒç´ ä½œä¸ºHashMapçš„é”®(Key),è€ŒHashMap çš„å€¼(Value)åˆ™æ˜¯ä¸€ä¸ªå›ºå®šçš„ã€æ— å…³ç´§è¦çš„ PRESENT é™æ€ Object å¯¹è±¡ã€‚</p></li><li><p>ç‰¹ç‚¹:</p><ul><li>æ— åº:ä¸ä¿è¯å…ƒç´ çš„å­˜å‚¨é¡ºåºå’Œè¿­ä»£é¡ºåºã€‚</li><li>ä¸å¯é‡å¤:å…ƒç´ å”¯ä¸€ã€‚é€šè¿‡å…ƒç´ çš„hashCode() å’Œ equals() æ–¹æ³•æ¥åˆ¤æ–­å…ƒç´ çš„å”¯ä¸€æ€§ã€‚å½“æ·»åŠ å…ƒç´ æ—¶,é¦–å…ˆè®¡ç®—å…ƒç´ çš„hashCode(),ç„¶åæ ¹æ®å“ˆå¸Œå€¼æ‰¾åˆ°å¯¹åº”çš„â€œæ¡¶â€,å†åœ¨è¯¥æ¡¶ä¸­éå†,å¦‚æœå­˜åœ¨ equals()ä¸ºtrue çš„å…ƒç´ ,åˆ™ä¸æ·»åŠ ã€‚</li><li>å…è®¸ nullå…ƒç´ :å…è®¸ä¸”åªèƒ½å­˜å‚¨ä¸€ä¸ª null å…ƒç´ ã€‚</li><li>æŸ¥è¯¢ã€æ·»åŠ ã€åˆ é™¤çš„å¹³å‡æ—¶é—´å¤æ‚åº¦ä¸º(1) (åœ¨ä¸å‘ç”Ÿå“ˆå¸Œå†²çªæˆ–å†²çªè¾ƒå°‘çš„æƒ…å†µä¸‹)ã€‚æœ€åæƒ…å†µä¸‹(æ‰€æœ‰å…ƒç´ å“ˆå¸Œå†²çªåˆ°åŒä¸€ä¸ªæ¡¶),ä¼šé€€åŒ–ä¸º O(n)ã€‚</li><li>çº¿ç¨‹ä¸å®‰å…¨:ä¸HashMap ç±»ä¼¼,éåŒæ­¥ã€‚</li></ul></li><li><p>æ‰©å®¹æœºåˆ¶:</p><ul><li>ç”±äºåº•å±‚æ˜¯HashMap,å…¶æ‰©å®¹æœºåˆ¶ä¸ HashMap å®Œå…¨ç›¸åŒã€‚</li><li>åˆå§‹å®¹é‡:é»˜è®¤åˆå§‹å®¹é‡ä¸º16ã€‚</li><li>è´Ÿè½½å› å­:é»˜è®¤è´Ÿè½½å› å­ä¸º0.75ã€‚</li><li>æ‰©å®¹æ—¶æœº:å½“HashSet ä¸­å­˜å‚¨çš„å…ƒç´ æ•°é‡è¾¾åˆ°å®¹é‡*è´Ÿè½½å› å­æ—¶,å°±ä¼šè¿›è¡Œæ‰©å®¹,æ–°å®¹é‡æ˜¯æ—§å®¹é‡çš„2å€ã€‚</li><li>æ‰©å®¹è¿‡ç¨‹:åˆ›å»ºä¸€ä¸ªæ–°çš„ä¸¤å€å¤§å°çš„åº•å±‚æ•°ç»„,ç„¶åéå†æ—§æ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ ,é‡æ–°è®¡ç®—å®ƒä»¬çš„å“ˆå¸Œå€¼,å¹¶å°†å®ƒä»¬æ”¾å…¥æ–°æ•°ç»„çš„æ­£ç¡®ä½ç½®ã€‚</li></ul></li><li><p>å¯èƒ½å‡ºç°çš„é—®é¢˜:</p><ul><li>æ€§èƒ½ä¸‹é™: å¦‚æœè‡ªå®šä¹‰ç±»ä½œä¸ºå…ƒç´ å­˜å‚¨åœ¨ HashSet ä¸­ï¼Œä½†æ²¡æœ‰æ­£ç¡®é‡å†™ hashCode() å’Œ equals() æ–¹æ³•ï¼Œå¯èƒ½ä¼šå¯¼è‡´å…ƒç´ é‡å¤ï¼Œæˆ–è€…å“ˆå¸Œå†²çªä¸¥é‡ï¼Œä»è€Œå¯¼è‡´æ€§èƒ½æ€¥å‰§ä¸‹é™ã€‚</li><li>ConcurrentModicationException: åŒæ­¥æ€§é—®é¢˜ï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä½¿ç”¨è¿­ä»£å™¨ä¿®æ”¹é›†åˆæ—¶ä¼šæŠ›å‡ºã€‚</li></ul></li><li><p>å¸¸ç”¨æ–¹æ³•:</p><ul><li>add(E e): æ·»åŠ å…ƒç´ ã€‚</li><li>remove(Object o): åˆ é™¤å…ƒç´ ã€‚</li><li>contains(Object o): åˆ¤æ–­æ˜¯å¦åŒ…å«å…ƒç´ ã€‚</li><li>size(): è¿”å›é›†åˆä¸­å…ƒç´ çš„ä¸ªæ•°ã€‚</li><li>isEmpty(), clear().</li></ul></li><li><p>éå†æ–¹å¼:</p><ol><li><p>å¢å¼º for å¾ªç¯ (foreach): <code>for (E element : set) &#123; System.out.println(element); &#125;</code></p></li><li><p>è¿­ä»£å™¨ (Iterator):</p><p>Java</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Iterator&lt;E&gt; it = set.iterator();</span><br><span class="line">while (it.hasNext()) &#123;</span><br><span class="line">    System.out.println(it.next());</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>Java 8 Stream API: <code>set.forEach(System.out::println);</code></p></li></ol></li></ul><h5 id="2-LinkedHashSet"><a href="#2-LinkedHashSet" class="headerlink" title="2. LinkedHashSet"></a>2. LinkedHashSet</h5><ul><li>åº•å±‚å®ç°: ç»§æ‰¿è‡ª HashSetï¼Œå†…éƒ¨ä½¿ç”¨ LinkedHashMap å®ç°ã€‚</li><li>ç‰¹ç‚¹:<ul><li>é™¤äº†å…·å¤‡ HashSet çš„æ‰€æœ‰ç‰¹æ€§å¤–ï¼Œæœ€å¤§çš„ç‰¹ç‚¹æ˜¯ä¿æŒå…ƒç´ çš„æ’å…¥é¡ºåºï¼ˆæˆ–è€…è®¿é—®é¡ºåºï¼Œå¦‚æœé…ç½®ä¸º LRU ç¼“å­˜ï¼‰ã€‚è¿™æ„å‘³ç€éå† LinkedHashSetæ—¶ï¼Œå…ƒç´ çš„é¡ºåºä¸å®ƒä»¬è¢«æ·»åŠ åˆ°é›†åˆä¸­çš„é¡ºåºä¸€è‡´ã€‚</li><li>ç»´æŠ¤äº†ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œç”¨äºç»´æŠ¤å…ƒç´ çš„æ’å…¥é¡ºåºã€‚</li></ul></li><li>æ‰©å®¹æœºåˆ¶: ä¸ HashSet å’Œ HashMap ç›¸åŒã€‚</li><li>ä½¿ç”¨åœºæ™¯: éœ€è¦å»é‡ï¼ŒåŒæ—¶åˆéœ€è¦ä¿æŒå…ƒç´ æ’å…¥é¡ºåºçš„åœºæ™¯ã€‚</li></ul><h5 id="3-TreeSet"><a href="#3-TreeSet" class="headerlink" title="3. TreeSet"></a>3. TreeSet</h5><ul><li>åº•å±‚å®ç°: åŸºäº TreeMap å®ç°ã€‚TreeSet å†…éƒ¨ä½¿ç”¨ä¸€ä¸ª TreeMap å®ä¾‹æ¥å­˜å‚¨å…ƒç´ ï¼ŒTreeSet çš„å…ƒç´ ä½œä¸º TreeMap çš„é”®ï¼Œè€Œå€¼åˆ™æ˜¯ä¸€ä¸ªå›ºå®šçš„ Objectã€‚</li><li>ç‰¹ç‚¹:<ul><li>æœ‰åº: å…ƒç´ ä¼šæ ¹æ®å…¶è‡ªç„¶æ’åºï¼ˆå…ƒç´ å¿…é¡»å®ç° Comparable æ¥å£ï¼‰æˆ–è€…åœ¨åˆ›å»º TreeSet æ—¶æä¾›çš„ Comparator è¿›è¡Œæ’åºã€‚</li><li>ä¸å¯é‡å¤: å…ƒç´ å”¯ä¸€ï¼Œå”¯ä¸€æ€§é€šè¿‡æ¯”è¾ƒç»“æœåˆ¤æ–­ï¼ˆcompareTo() æˆ– compare() æ–¹æ³•è¿”å› 0ï¼‰ã€‚</li><li>ä¸å…è®¸ null å…ƒç´ : ä¸å…è®¸å­˜å‚¨ null å…ƒç´ ï¼ˆå› ä¸º null æ— æ³•è¿›è¡Œæ¯”è¾ƒï¼‰ã€‚</li><li>æŸ¥è¯¢ã€æ·»åŠ ã€åˆ é™¤çš„æ—¶é—´å¤æ‚åº¦ä¸º O(log n)ï¼Œå› ä¸ºåº•å±‚æ˜¯çº¢é»‘æ ‘ã€‚</li><li>çº¿ç¨‹ä¸å®‰å…¨: éåŒæ­¥ã€‚</li></ul></li><li>æ‰©å®¹æœºåˆ¶:<ul><li>ç”±äºåº•å±‚æ˜¯çº¢é»‘æ ‘ï¼Œæ²¡æœ‰ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„æ‰©å®¹æœºåˆ¶ã€‚æ¯æ¬¡æ·»åŠ å…ƒç´ å°±æ˜¯å¢åŠ ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¹¶æ ¹æ®çº¢é»‘æ ‘çš„å¹³è¡¡è§„åˆ™è¿›è¡Œè°ƒæ•´ï¼ˆæ—‹è½¬å’Œå˜è‰²ï¼‰æ¥ä¿æŒæ ‘çš„å¹³è¡¡ã€‚</li></ul></li><li>å¯èƒ½å‡ºç°çš„é—®é¢˜:<ul><li>æ€§èƒ½: ç›¸æ¯” HashSetï¼Œæ€§èƒ½ç•¥ä½ï¼Œå› ä¸ºæ¶‰åŠæ¯”è¾ƒå’Œæ ‘çš„å¹³è¡¡æ“ä½œã€‚</li><li>å…ƒç´ å¿…é¡»å¯æ¯”è¾ƒ: å¦‚æœå­˜å‚¨çš„å…ƒç´ æ²¡æœ‰å®ç° Comparable æ¥å£ï¼Œæˆ–è€…åˆ›å»º TreeSet æ—¶æ²¡æœ‰æä¾› Comparatorï¼Œåˆ™ä¼šæŠ›å‡º ClassCastExceptionã€‚</li><li>ConcurrentModicationException: åŒæ­¥æ€§é—®é¢˜ã€‚</li></ul></li><li>å¸¸ç”¨æ–¹æ³•:<ul><li>ä¸ HashSet ç±»ä¼¼ï¼Œä½†é¢å¤–æä¾›äº†ä¸æ’åºç›¸å…³çš„æ–¹æ³•ï¼Œå¦‚ rst(), last(), headSet(), tailSet(), subSet() ç­‰ã€‚</li></ul></li></ul><h4 id="å°ç»“-Set"><a href="#å°ç»“-Set" class="headerlink" title="å°ç»“ Set:"></a>å°ç»“ Set:</h4><ul><li>HashSet: æœ€å¸¸ç”¨ï¼Œéœ€è¦å¿«é€ŸæŸ¥æ‰¾ã€å»é‡ï¼Œä¸å…³å¿ƒå…ƒç´ é¡ºåºçš„åœºæ™¯ã€‚</li><li>LinkedHashSet: éœ€è¦å»é‡ï¼ŒåŒæ—¶åˆéœ€è¦ä¿æŒå…ƒç´ æ’å…¥é¡ºåºçš„åœºæ™¯ã€‚</li><li>TreeSet: éœ€è¦å»é‡ï¼Œå¹¶ä¸”å¸Œæœ›å…ƒç´ è‡ªåŠ¨æŒ‰ç…§è‡ªç„¶é¡ºåºæˆ–è‡ªå®šä¹‰é¡ºåºæ’åºçš„åœºæ™¯ã€‚</li></ul><h4 id="C-Map-æ¥å£åŠå…¶å®ç°ç±»"><a href="#C-Map-æ¥å£åŠå…¶å®ç°ç±»" class="headerlink" title="C. Map æ¥å£åŠå…¶å®ç°ç±»"></a>C. Map æ¥å£åŠå…¶å®ç°ç±»</h4><p>Map å­˜å‚¨é”®å€¼å¯¹ï¼Œé”®æ˜¯å”¯ä¸€çš„ï¼Œå€¼å¯ä»¥é‡å¤ã€‚</p><h5 id="1-HashMap"><a href="#1-HashMap" class="headerlink" title="1. HashMap"></a>1. HashMap</h5><ul><li><p>åº•å±‚å®ç°: åŸºäºå“ˆå¸Œè¡¨å®ç°ï¼ŒJDK 8 åŠä»¥åæ˜¯æ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘ã€‚</p><ul><li>æ•°ç»„: Node</li><li>é“¾è¡¨: ç”¨äºè§£å†³å“ˆå¸Œå†²çªï¼Œå°†å“ˆå¸Œåˆ°åŒä¸€ä¸ªç´¢å¼•ä½ç½®çš„é”®å€¼å¯¹ä»¥é“¾è¡¨å½¢å¼è¿æ¥ã€‚</li><li>çº¢é»‘æ ‘: å½“é“¾è¡¨é•¿åº¦è¾¾åˆ°ä¸€å®šé˜ˆå€¼ï¼ˆJDK 8 é»˜è®¤ä¸º 8ï¼‰æ—¶ï¼Œä¸ºäº†æé«˜æŸ¥æ‰¾æ•ˆç‡ï¼Œè¯¥é“¾è¡¨ä¼šè½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚å½“çº¢é»‘æ ‘èŠ‚ç‚¹æ•°å°‘äºä¸€å®šé˜ˆå€¼ï¼ˆJDK 8 é»˜è®¤ä¸º 6ï¼‰æ—¶ï¼Œä¼šé€€åŒ–ä¸ºé“¾è¡¨ã€‚</li></ul></li><li><p>ç‰¹ç‚¹:</p><ul><li>æ— åº: ä¸ä¿è¯é”®å€¼å¯¹çš„å­˜å‚¨å’Œè¿­ä»£é¡ºåºã€‚</li><li>é”®å”¯ä¸€ï¼Œå€¼å¯é‡å¤: é”®é€šè¿‡ hashCode() å’Œ equals() æ–¹æ³•ç¡®å®šå”¯ä¸€æ€§ã€‚</li><li>å…è®¸ null é”®å’Œ null å€¼: åªèƒ½æœ‰ä¸€ä¸ª null é”®ï¼ˆå­˜å‚¨åœ¨ç´¢å¼• 0 çš„ä½ç½®ï¼‰ï¼Œå¯ä»¥æœ‰å¤šä¸ª null å€¼ã€‚</li><li>æŸ¥è¯¢ã€æ·»åŠ ã€åˆ é™¤çš„å¹³å‡æ—¶é—´å¤æ‚åº¦ä¸º O(1)ï¼Œæœ€åæƒ…å†µä¸‹ä¸º O(n)ï¼ˆé“¾è¡¨ï¼‰æˆ– O(logn)ï¼ˆçº¢é»‘æ ‘ï¼ŒJDK 8 åŠä»¥åï¼‰ã€‚</li></ul></li><li><p>æ‰©å®¹æœºåˆ¶:</p><ul><li><p>åˆå§‹å®¹é‡ (initialCapacity): é»˜è®¤å€¼ä¸º 16ã€‚æœ€å¥½åœ¨åˆ›å»º HashMap æ—¶é¢„ä¼°å¹¶æŒ‡å®šä¸€ä¸ªåˆé€‚çš„åˆå§‹å®¹é‡ï¼Œä»¥å‡å°‘æ‰©å®¹æ¬¡æ•°ã€‚</p></li><li><p>è´Ÿè½½å› å­ (loadFactor): é»˜è®¤å€¼ä¸º 0.75ã€‚è¡¨ç¤ºå“ˆå¸Œè¡¨åœ¨è¿›è¡Œæ‰©å®¹å‰çš„å¡«å……æ¯”ä¾‹ã€‚</p></li><li><p>æ‰©å®¹æ—¶æœº: å½“ HashMap ä¸­å­˜å‚¨çš„å…ƒç´ æ•°é‡ (size) è¾¾åˆ° å®¹é‡ * è´Ÿè½½å› å­ (å³ threshold) æ—¶ï¼Œå°±ä¼šè§¦å‘æ‰©å®¹ã€‚</p></li><li><p>æ‰©å®¹æ–¹å¼: resize() æ–¹æ³•ã€‚</p><ol><li>åˆ›å»ºä¸€ä¸ªæ–°çš„ä¸¤å€å¤§å°çš„åº•å±‚æ•°ç»„ã€‚</li><li>éå†æ—§æ•°ç»„ä¸­çš„æ‰€æœ‰é”®å€¼å¯¹ã€‚</li><li>é‡æ–°è®¡ç®—æ¯ä¸ªé”®çš„å“ˆå¸Œå€¼ï¼Œå¹¶æ ¹æ®æ–°çš„å®¹é‡å¤§å°ï¼Œå°†å…¶æ”¾å…¥æ–°æ•°ç»„çš„æ­£ç¡®ä½ç½®ã€‚è¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸ºå†å“ˆå¸Œ (rehash)ã€‚</li></ol><ul><li>JDK 8 ä¼˜åŒ–: åœ¨é“¾è¡¨è½¬æ¢æ—¶ï¼Œé¿å…äº†æ¯ä¸ªèŠ‚ç‚¹å•ç‹¬é‡æ–°è®¡ç®—å“ˆå¸Œå€¼ï¼Œè€Œæ˜¯æ ¹æ®åŸç´¢å¼•å’Œæ–°å®¹é‡çš„å…³ç³»ï¼Œç›´æ¥åˆ¤æ–­èŠ‚ç‚¹åœ¨æ–°æ•°ç»„ä¸­çš„ä½ç½®ï¼Œæé«˜äº†æ•ˆç‡ã€‚</li></ul></li></ul></li><li><p>ä¸ºä»€ä¹ˆè¿™ä¹ˆæ‰©å®¹ (2 å€):</p><ul><li>ä½è¿ç®—ä¼˜åŒ–: å®¹é‡å§‹ç»ˆä¿æŒ 2 çš„å¹‚æ¬¡æ–¹ï¼Œå¯ä»¥åˆ©ç”¨ä½è¿ç®— (h &amp; (length - 1)) æ¥æ›¿ä»£å–æ¨¡è¿ç®— h % lengthï¼Œæé«˜å“ˆå¸Œå€¼åˆ°ç´¢å¼•çš„æ˜ å°„æ•ˆç‡ã€‚</li><li>å‡å°‘å“ˆå¸Œå†²çª: æ‰©å®¹ä¸º 2 å€å¯ä»¥æœ‰æ•ˆåˆ†æ•£å“ˆå¸Œå†²çªï¼Œä½¿å¾—æ›´å¤šçš„é”®èƒ½å¤Ÿæ˜ å°„åˆ°ä¸åŒçš„æ¡¶ï¼Œä»è€Œé™ä½é“¾è¡¨&#x2F;çº¢é»‘æ ‘çš„é•¿åº¦ï¼Œä¿æŒ O(1) çš„å¹³å‡æ€§èƒ½ã€‚</li></ul></li><li><p>ä¸ºä»€ä¹ˆè´Ÿè½½å› å­æ˜¯ 0.75:</p><ul><li>è¿™æ˜¯ä¸€ä¸ªåœ¨â€œç©ºé—´åˆ©ç”¨ç‡â€å’Œâ€œæŸ¥è¯¢æ•ˆç‡â€ä¹‹é—´çš„æƒè¡¡ã€‚</li><li>å¦‚æœè´Ÿè½½å› å­è¿‡å°ï¼Œä¼šé¢‘ç¹æ‰©å®¹ï¼Œæµªè´¹ç©ºé—´ã€‚</li><li>å¦‚æœè´Ÿè½½å› å­è¿‡å¤§ï¼Œå“ˆå¸Œå†²çªä¼šå¢åŠ ï¼Œé“¾è¡¨&#x2F;çº¢é»‘æ ‘å˜é•¿ï¼Œå¯¼è‡´æŸ¥è¯¢æ•ˆç‡ä¸‹é™ã€‚</li><li>0.75 è¿™ä¸ªå€¼æ˜¯ç»è¿‡å®è·µéªŒè¯ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹èƒ½å¤Ÿæä¾›è¾ƒå¥½æ€§èƒ½çš„å¹³è¡¡ç‚¹ã€‚</li></ul></li><li><p>å¯èƒ½å‡ºç°çš„é—®é¢˜:</p><ul><li>æ€§èƒ½ä¸‹é™: å¦‚æœè‡ªå®šä¹‰ç±»ä½œä¸ºé”®å­˜å‚¨åœ¨ HashMap ä¸­ï¼Œä½†æ²¡æœ‰æ­£ç¡®é‡å†™ hashCode() å’Œ equals() æ–¹æ³•ï¼Œä¼šå¯¼è‡´å…ƒç´ é‡å¤ï¼Œæˆ–è€…å“ˆå¸Œå†²çªä¸¥é‡ï¼Œä»è€Œå¯¼è‡´æ€§èƒ½æ€¥å‰§ä¸‹é™ã€‚</li><li>å¤šçº¿ç¨‹é—®é¢˜: åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå¯¹ HashMap è¿›è¡Œä¿®æ”¹æ“ä½œå¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±ã€æ­»å¾ªç¯ï¼ˆJDK 7 åŠä»¥å‰ï¼‰ï¼Œæˆ– ConcurrentModicationExceptionã€‚è¿™æ˜¯å…¶æœ€å¤§çš„é—®é¢˜ã€‚</li><li>å†…å­˜å¼€é”€: é¢‘ç¹æ‰©å®¹ä¼šå¸¦æ¥æ•°ç»„å¤åˆ¶çš„å¼€é”€ã€‚</li></ul></li><li><p>å¸¸ç”¨æ–¹æ³•:</p><ul><li>put(K key, V value): å…³è”é”®å€¼å¯¹ã€‚</li><li>get(Object key):</li></ul></li><li><p>éå†æ–¹å¼:</p><ol><li><p>éå†é”®é›† (keySet()):</p><p>Java</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">for (K key : map.keySet()) &#123;</span><br><span class="line">    V value = map.get(key);</span><br><span class="line">    System.out.println(&quot;Key: &quot; + key + &quot;, Value: &quot; + value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>éå†é”®å€¼å¯¹é›† (entrySet()) - æ¨èï¼Œæ•ˆç‡æœ€é«˜:</p><p>Java</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">for (Map.Entry&lt;K, V&gt; entry : map.entrySet()) &#123;</span><br><span class="line">    System.out.println(&quot;Key: &quot; + entry.getKey() + &quot;, Value: &quot; + entry.getValue());</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>éå†å€¼é›† (values()):</p><p>Java</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">for (V value : map.values()) &#123;</span><br><span class="line">    System.out.println(&quot;Value: &quot; + value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>è¿­ä»£å™¨ (Iterator):</p><p>Java</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Iterator&lt;Map.Entry&lt;K, V&gt;&gt; it = map.entrySet().iterator();</span><br><span class="line">while (it.hasNext()) &#123;</span><br><span class="line">    Map.Entry&lt;K, V&gt; entry = it.next();</span><br><span class="line">    System.out.println(&quot;Key: &quot; + entry.getKey() + &quot;, Value: &quot; + entry.getValue());</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>Java 8 Stream API:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">map.forEach((key, value) -&gt; System.out.println(<span class="string">&quot;Key: &quot;</span> + key + <span class="string">&quot;, Value: &quot;</span> + value));</span><br></pre></td></tr></table></figure></li></ol></li></ul><h5 id="2-LinkedHashMap"><a href="#2-LinkedHashMap" class="headerlink" title="2. LinkedHashMap"></a>2. LinkedHashMap</h5><ul><li>åº•å±‚å®ç°: ç»§æ‰¿è‡ª HashMapï¼Œé¢å¤–ç»´æŠ¤äº†ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œç”¨äºç»´æŠ¤æ’å…¥é¡ºåºæˆ–è®¿é—®é¡ºåºã€‚</li><li>ç‰¹ç‚¹:<ul><li>é™¤äº†å…·å¤‡ HashMap çš„æ‰€æœ‰ç‰¹æ€§å¤–ï¼Œæœ€å¤§çš„ç‰¹ç‚¹æ˜¯ä¿æŒé”®å€¼å¯¹çš„æ’å…¥é¡ºåºï¼ˆæˆ–è®¿é—®é¡ºåºï¼‰ã€‚è¿™æ„å‘³ç€éå† LinkedHashMap æ—¶ï¼Œå…ƒç´ çš„é¡ºåºä¸å®ƒä»¬è¢«æ·»åŠ åˆ° Map ä¸­çš„é¡ºåºä¸€è‡´ã€‚</li><li>å¯ä»¥ç”¨äºå®ç° LRU (Least Recently Used) ç¼“å­˜ç­–ç•¥ï¼Œé€šè¿‡è¦†ç›– removeEldestEntry æ–¹æ³•å¹¶è®¾ç½®è®¿é—®é¡ºåºä¸º trueã€‚</li></ul></li><li>æ‰©å®¹æœºåˆ¶: ä¸ HashMap ç›¸åŒã€‚</li><li>ä½¿ç”¨åœºæ™¯: éœ€è¦å¿«é€ŸæŸ¥æ‰¾ï¼ŒåŒæ—¶åˆéœ€è¦ä¿æŒæ’å…¥é¡ºåºçš„åœºæ™¯ã€‚</li></ul><h5 id="3-TreeMap"><a href="#3-TreeMap" class="headerlink" title="3. TreeMap"></a>3. TreeMap</h5><ul><li>åº•å±‚å®ç°: åŸºäºçº¢é»‘æ ‘ï¼ˆRed-Black Treeï¼‰å®ç°ã€‚</li><li>ç‰¹ç‚¹:<ul><li>æœ‰åº: é”®ä¼šæ ¹æ®å…¶è‡ªç„¶æ’åºï¼ˆé”®çš„ç±»å‹å¿…é¡»å®ç° Comparable æ¥å£ï¼‰æˆ–è€…åœ¨åˆ›å»º TreeMap æ—¶æä¾›çš„ Comparator è¿›è¡Œæ’åºã€‚</li><li>é”®å”¯ä¸€ï¼Œå€¼å¯é‡å¤: å”¯ä¸€æ€§åˆ¤æ–­ä¾èµ–äºé”®çš„æ¯”è¾ƒç»“æœï¼ˆcompareTo() æˆ– compare() æ–¹æ³•è¿”å› 0ï¼‰ã€‚</li><li>ä¸å…è®¸ null é”®: ä¸å…è®¸å­˜å‚¨ null é”®ï¼ˆå› ä¸º null æ— æ³•è¿›è¡Œæ¯”è¾ƒï¼‰ï¼Œä½†å…è®¸ null å€¼ã€‚</li><li>æŸ¥è¯¢ã€æ·»åŠ ã€åˆ é™¤çš„æ—¶é—´å¤æ‚åº¦ä¸º O(log n)ï¼Œå› ä¸ºåº•å±‚æ˜¯çº¢é»‘æ ‘ã€‚</li><li>çº¿ç¨‹ä¸å®‰å…¨: éåŒæ­¥ã€‚</li></ul></li><li>æ‰©å®¹æœºåˆ¶:<ul><li>ç”±äºåº•å±‚æ˜¯çº¢é»‘æ ‘ï¼Œæ²¡æœ‰ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„æ‰©å®¹æœºåˆ¶ã€‚æ¯æ¬¡æ·»åŠ é”®å€¼å¯¹å°±æ˜¯å¢åŠ ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¹¶æ ¹æ®çº¢é»‘æ ‘çš„å¹³è¡¡è§„åˆ™è¿›è¡Œè°ƒæ•´ï¼ˆæ—‹è½¬å’Œå˜è‰²ï¼‰æ¥ä¿æŒæ ‘çš„å¹³è¡¡ã€‚</li></ul></li><li>å¯èƒ½å‡ºç°çš„é—®é¢˜:<ul><li>æ€§èƒ½: ç›¸æ¯” HashMapï¼Œæ€§èƒ½ç•¥ä½ï¼Œå› ä¸ºæ¶‰åŠæ¯”è¾ƒå’Œæ ‘çš„å¹³è¡¡æ“ä½œã€‚</li><li>é”®å¿…é¡»å¯æ¯”è¾ƒ: å¦‚æœé”®æ²¡æœ‰å®ç° Comparable æ¥å£ï¼Œæˆ–è€…åˆ›å»º TreeMap æ—¶æ²¡æœ‰æä¾› Comparatorï¼Œåˆ™ä¼šæŠ›å‡º ClassCastExceptionã€‚</li><li>ConcurrentModicationException: åŒæ­¥æ€§é—®é¢˜ã€‚</li></ul></li><li>å¸¸ç”¨æ–¹æ³•:<ul><li>ä¸ HashMap ç±»ä¼¼ï¼Œä½†é¢å¤–æä¾›äº†ä¸æ’åºç›¸å…³çš„æ–¹æ³•ï¼Œå¦‚ rstKey(), lastKey(), ceilingEntry(), oorEntry() ç­‰ã€‚</li></ul></li></ul><h5 id="4-Hashtable"><a href="#4-Hashtable" class="headerlink" title="4. Hashtable"></a>4. Hashtable</h5><ul><li>åº•å±‚å®ç°: åŸºäºå“ˆå¸Œè¡¨å®ç°ï¼Œä¸ HashMap ç±»ä¼¼ï¼Œä½†æ‰€æœ‰æ–¹æ³•éƒ½ä½¿ç”¨äº† synchronized å…³é”®å­—ã€‚</li><li>ç‰¹ç‚¹:<ul><li>çº¿ç¨‹å®‰å…¨: æ‰€æœ‰å…¬å…±æ–¹æ³•éƒ½è¿›è¡Œäº†åŒæ­¥å¤„ç†ã€‚</li><li>æ•ˆç‡ä½: å…¨å±€é”å¯¼è‡´å¹¶å‘æ€§èƒ½å·®ã€‚</li><li>ä¸å…è®¸ null é”®å’Œ null å€¼ã€‚</li><li>åˆå§‹å®¹é‡å’Œæ‰©å®¹æœºåˆ¶: é»˜è®¤åˆå§‹å®¹é‡ 11ï¼Œè´Ÿè½½å› å­ 0.75ã€‚æ‰©å®¹æ—¶æ–°å®¹é‡æ˜¯æ—§å®¹é‡çš„ 2 å€ + 1ã€‚</li></ul></li><li>ä½¿ç”¨åœºæ™¯: å·²è¢« ConcurrentHashMap å–ä»£ï¼ŒåŸºæœ¬ä¸å†æ¨èä½¿ç”¨ã€‚</li></ul><h5 id="5-ConcurrentHashMap-JUC-åŒ…ä¸­çš„å¹¶å‘é›†åˆ"><a href="#5-ConcurrentHashMap-JUC-åŒ…ä¸­çš„å¹¶å‘é›†åˆ" class="headerlink" title="5. ConcurrentHashMap (JUC åŒ…ä¸­çš„å¹¶å‘é›†åˆ)"></a>5. ConcurrentHashMap (JUC åŒ…ä¸­çš„å¹¶å‘é›†åˆ)</h5><ul><li><p>åº•å±‚å®ç°:</p><ul><li>JDK 7 åŠä»¥å‰: é‡‡ç”¨åˆ†æ®µé” (Segment) çš„æ–¹å¼ï¼Œå°† HashMap å†…éƒ¨æ•°æ®åˆ†æˆå¤šä¸ªæ®µï¼ˆSegmentï¼‰ï¼Œæ¯ä¸ªæ®µæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ ReentrantLockã€‚é”ä½æŸä¸ªæ®µæ—¶ï¼Œä¸å½±å“å…¶ä»–æ®µçš„æ“ä½œã€‚</li><li>JDK 8 åŠä»¥å: æ”¾å¼ƒäº†åˆ†æ®µé”ï¼Œæ”¹ä¸ºä½¿ç”¨ CAS (Compare-And-Swap) æ“ä½œå’Œ synchronized å…³é”®å­—ï¼ˆåªåœ¨é“¾è¡¨&#x2F;çº¢é»‘æ ‘å¤´èŠ‚ç‚¹å‘ç”Ÿç«äº‰æ—¶æ‰ä½¿ç”¨ï¼Œé”ä½çš„èŒƒå›´æ›´å°ï¼‰æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</li></ul></li><li><p>ç‰¹ç‚¹:</p><ul><li>çº¿ç¨‹å®‰å…¨: é«˜å¹¶å‘ç¯å¢ƒä¸‹æ€§èƒ½ä¼˜å¼‚ã€‚</li><li>ä¸å…è®¸ null é”®å’Œ null å€¼ã€‚</li><li>è¯»æ“ä½œåŸºæœ¬æ— é”ã€‚</li></ul></li><li><p>æ‰©å®¹æœºåˆ¶: ä¸ HashMap ç±»ä¼¼ï¼ŒJDK 8 ä¸­ï¼Œæ¯ä¸ª Node æ•°ç»„çš„æ‰©å®¹æ˜¯ç‹¬ç«‹çš„ï¼Œé€šè¿‡ transfer æ–¹æ³•å®ç°ã€‚</p></li><li><p>ä½¿ç”¨åœºæ™¯: é«˜å¹¶å‘åœºæ™¯ä¸‹æ›¿ä»£ HashMap å’Œ Hashtable çš„é¦–é€‰ã€‚</p></li><li><p><code>java.util.concurrent</code> (JUC) åŒ…æ˜¯ Java å¹¶å‘ç¼–ç¨‹çš„é«˜çº§å·¥å…·åŒ…ï¼Œå®ƒæä¾›äº†æ¯”ä¼ ç»Ÿ <code>synchronized</code> å…³é”®å­—å’Œ <code>wait/notify</code> æœºåˆ¶æ›´å¼ºå¤§ã€æ›´çµæ´»çš„å¹¶å‘æ§åˆ¶æ‰‹æ®µã€‚</p></li></ul><p>å¥½çš„ âœ… æˆ‘æ¥å¸®ä½ æŠŠå‰é¢ä¸¤ä¸ªå›ç­” <strong>æ•´åˆæˆä¸€ä¸ªå®Œæ•´ã€ç³»ç»Ÿã€é€å±‚é€’è¿›çš„ ConcurrentHashMap è§£ææ–‡æ¡£</strong>ï¼Œå†…å®¹è¦†ç›– <strong>å®ç°åŸç† + æ‰©å®¹æœºåˆ¶ + é«˜é¢‘é¢è¯•é¢˜ + ç­”é¢˜æ¨¡æ¿</strong>ï¼Œä½ å¯ä»¥ç›´æ¥æ‹¿å»å½“å¤ä¹ èµ„æ–™æˆ–é¢è¯•ç­”é¢˜è„šæœ¬ã€‚</p><hr><h1 id="ğŸ§©-ConcurrentHashMap-è¶…è¯¦ç»†è§£æï¼ˆJDK8ä¸ºä¸»ï¼Œå«å¯¹æ¯”ï¼‰"><a href="#ğŸ§©-ConcurrentHashMap-è¶…è¯¦ç»†è§£æï¼ˆJDK8ä¸ºä¸»ï¼Œå«å¯¹æ¯”ï¼‰" class="headerlink" title="ğŸ§© ConcurrentHashMap è¶…è¯¦ç»†è§£æï¼ˆJDK8ä¸ºä¸»ï¼Œå«å¯¹æ¯”ï¼‰"></a>ğŸ§© ConcurrentHashMap è¶…è¯¦ç»†è§£æï¼ˆJDK8ä¸ºä¸»ï¼Œå«å¯¹æ¯”ï¼‰</h1><hr><h2 id="ä¸€ã€èƒŒæ™¯ä¸è®¾è®¡åŠ¨æœº"><a href="#ä¸€ã€èƒŒæ™¯ä¸è®¾è®¡åŠ¨æœº" class="headerlink" title="ä¸€ã€èƒŒæ™¯ä¸è®¾è®¡åŠ¨æœº"></a>ä¸€ã€èƒŒæ™¯ä¸è®¾è®¡åŠ¨æœº</h2><p>åœ¨å¹¶å‘åœºæ™¯ä¸‹ï¼š</p><ul><li><code>HashMap</code> çº¿ç¨‹ä¸å®‰å…¨ï¼Œå¯èƒ½å‡ºç°æ­»å¾ªç¯ã€æ•°æ®ä¸¢å¤±ã€‚</li><li><code>Hashtable</code> ä¸ <code>Collections.synchronizedMap</code> ä½¿ç”¨ <strong>å…¨è¡¨é”</strong>ï¼Œååé‡æå·®ã€‚</li></ul><p><strong>ConcurrentHashMapï¼ˆCHMï¼‰</strong>ï¼š</p><ul><li><strong>çº¿ç¨‹å®‰å…¨</strong>ï¼šä¿è¯å¤šçº¿ç¨‹åŒæ—¶è®¿é—®æ—¶æ•°æ®ä¸€è‡´æ€§ã€‚</li><li><strong>é«˜æ€§èƒ½</strong>ï¼šé€šè¿‡ <strong>åˆ†æ¡¶é” + CAS + volatile</strong> æå‡å¹¶å‘åº¦ã€‚</li><li><strong>å¼±ä¸€è‡´æ€§è¿­ä»£å™¨</strong>ï¼šéå†è¿‡ç¨‹ä¸­å…è®¸ä¿®æ”¹ï¼Œä¸ä¼šæŠ› <code>ConcurrentModificationException</code>ã€‚</li></ul><hr><h2 id="äºŒã€å®ç°æ¼”å˜ï¼ˆJDK7-vs-JDK8ï¼‰"><a href="#äºŒã€å®ç°æ¼”å˜ï¼ˆJDK7-vs-JDK8ï¼‰" class="headerlink" title="äºŒã€å®ç°æ¼”å˜ï¼ˆJDK7 vs JDK8ï¼‰"></a>äºŒã€å®ç°æ¼”å˜ï¼ˆJDK7 vs JDK8ï¼‰</h2><h3 id="JDK7"><a href="#JDK7" class="headerlink" title="JDK7"></a>JDK7</h3><ul><li>æ•°æ®ç»“æ„ï¼š<code>Segment[]</code> + <code>HashEntry[]</code>ã€‚</li><li>Segmentï¼šç±»ä¼¼å°å‹ HashMapï¼Œæ¯ä¸ª Segment æœ‰ç‹¬ç«‹çš„ ReentrantLockã€‚</li><li>å¹¶å‘åº¦ï¼šç”± Segment æ•°é‡å†³å®šï¼ˆé»˜è®¤ 16ï¼‰ã€‚</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>é”ç²’åº¦ä»ç„¶è¾ƒå¤§ï¼›</li><li>æ‰©å®¹éœ€è¦é”å®šæ•´ä¸ª Segmentã€‚</li></ul><hr><h3 id="JDK8"><a href="#JDK8" class="headerlink" title="JDK8"></a>JDK8</h3><ul><li>æ•°æ®ç»“æ„ï¼š<code>Node[]</code> + é“¾è¡¨&#x2F;çº¢é»‘æ ‘ã€‚</li><li>é”æœºåˆ¶ï¼š<strong>CAS + synchronizedï¼ˆæ¡¶é”ï¼‰</strong>ï¼Œæ¯” Segment æ›´ç»†ã€‚</li><li>æ”¹è¿›ç‚¹ï¼š<ol><li>æ—  Segmentï¼Œæ›´ç»†ç²’åº¦æ§åˆ¶ã€‚</li><li>é“¾è¡¨å†²çªè¿‡é•¿æ—¶è½¬åŒ–ä¸º <strong>çº¢é»‘æ ‘</strong>ï¼ˆæ ‘åŒ–ï¼‰ã€‚</li><li>æ‰©å®¹ä¸º <strong>æ¸è¿›å¼ + å¤šçº¿ç¨‹ååŠ©</strong>ã€‚</li><li>ä½¿ç”¨ <strong>ForwardingNode</strong> è·¯ç”±è¿ç§»ã€‚</li></ol></li></ul><hr><h2 id="ä¸‰ã€æ ¸å¿ƒæ•°æ®ç»“æ„"><a href="#ä¸‰ã€æ ¸å¿ƒæ•°æ®ç»“æ„" class="headerlink" title="ä¸‰ã€æ ¸å¿ƒæ•°æ®ç»“æ„"></a>ä¸‰ã€æ ¸å¿ƒæ•°æ®ç»“æ„</h2><h3 id="Node-èŠ‚ç‚¹"><a href="#Node-èŠ‚ç‚¹" class="headerlink" title="Node èŠ‚ç‚¹"></a>Node èŠ‚ç‚¹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">static class Node&lt;K,V&gt; implements Map.Entry&lt;K,V&gt; &#123;</span><br><span class="line">    final int hash;</span><br><span class="line">    final K key;</span><br><span class="line">    volatile V val;</span><br><span class="line">    volatile Node&lt;K,V&gt; next;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>val</code> å’Œ <code>next</code> æ˜¯ <code>volatile</code>ï¼Œä¿è¯å¯è§æ€§ã€‚</li></ul><h3 id="TreeNodeï¼ˆçº¢é»‘æ ‘èŠ‚ç‚¹ï¼‰"><a href="#TreeNodeï¼ˆçº¢é»‘æ ‘èŠ‚ç‚¹ï¼‰" class="headerlink" title="TreeNodeï¼ˆçº¢é»‘æ ‘èŠ‚ç‚¹ï¼‰"></a>TreeNodeï¼ˆçº¢é»‘æ ‘èŠ‚ç‚¹ï¼‰</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">static final class TreeNode&lt;K,V&gt; extends Node&lt;K,V&gt; &#123;</span><br><span class="line">    TreeNode&lt;K,V&gt; parent, left, right, prev;</span><br><span class="line">    boolean red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å½“é“¾è¡¨é•¿åº¦ &gt; 8 ä¸”å®¹é‡ â‰¥ 64 æ—¶è½¬åŒ–ä¸ºçº¢é»‘æ ‘ã€‚</li></ul><h3 id="ForwardingNode"><a href="#ForwardingNode" class="headerlink" title="ForwardingNode"></a>ForwardingNode</h3><ul><li>æ‰©å®¹æ—¶çš„å ä½ç¬¦ï¼Œç”¨äºæ ‡è®°æ¡¶å·²è¿ç§»ï¼Œå¼•å¯¼çº¿ç¨‹è®¿é—®æ–°è¡¨ã€‚</li></ul><hr><h2 id="å››ã€æ ¸å¿ƒæ“ä½œæµç¨‹"><a href="#å››ã€æ ¸å¿ƒæ“ä½œæµç¨‹" class="headerlink" title="å››ã€æ ¸å¿ƒæ“ä½œæµç¨‹"></a>å››ã€æ ¸å¿ƒæ“ä½œæµç¨‹</h2><h3 id="1-get-â€”â€”-æ— é”è¯»"><a href="#1-get-â€”â€”-æ— é”è¯»" class="headerlink" title="1. get() â€”â€” æ— é”è¯»"></a>1. get() â€”â€” æ— é”è¯»</h3><ul><li>ç›´æ¥è®¡ç®— hash å®šä½æ¡¶ã€‚</li><li>å¦‚æœæ˜¯é“¾è¡¨ â†’ éå†ï¼›</li><li>å¦‚æœæ˜¯çº¢é»‘æ ‘ â†’ æŒ‰æ ‘æŸ¥æ‰¾ï¼›</li><li>å¦‚æœæ˜¯ ForwardingNode â†’ å»æ–°è¡¨æŸ¥ã€‚</li></ul><p><strong>ç‰¹ç‚¹</strong>ï¼šæ— é”ï¼Œåªä¾èµ– volatile ä¿è¯å¯è§æ€§ã€‚</p><hr><h3 id="2-put-â€”â€”-å†™æ—¶åŠ é”"><a href="#2-put-â€”â€”-å†™æ—¶åŠ é”" class="headerlink" title="2. put() â€”â€” å†™æ—¶åŠ é”"></a>2. put() â€”â€” å†™æ—¶åŠ é”</h3><ol><li>è®¡ç®—ç´¢å¼•ä½ç½®ï¼›</li><li>æ¡¶ä¸ºç©º â†’ CAS æ’å…¥ï¼›</li><li>æ¡¶éç©ºï¼š<ul><li>ForwardingNode â†’ ååŠ©æ‰©å®¹ï¼›</li><li>é“¾è¡¨&#x2F;æ ‘ â†’ synchronized é”ä½æ¡¶å¤´ï¼Œå†æ’å…¥ï¼›</li></ul></li><li>æ’å…¥åï¼š<ul><li>å¦‚æœé“¾è¡¨é•¿åº¦ &gt; 8 ä¸”å®¹é‡ â‰¥ 64 â†’ æ ‘åŒ–ï¼›</li><li>å¦‚æœæ€»æ•°è¶…è¿‡é˜ˆå€¼ â†’ è§¦å‘æ‰©å®¹ã€‚</li></ul></li></ol><hr><h3 id="3-æ‰©å®¹æœºåˆ¶ï¼ˆTransferï¼‰"><a href="#3-æ‰©å®¹æœºåˆ¶ï¼ˆTransferï¼‰" class="headerlink" title="3. æ‰©å®¹æœºåˆ¶ï¼ˆTransferï¼‰"></a>3. æ‰©å®¹æœºåˆ¶ï¼ˆTransferï¼‰</h3><h4 id="è§¦å‘æ¡ä»¶"><a href="#è§¦å‘æ¡ä»¶" class="headerlink" title="è§¦å‘æ¡ä»¶"></a>è§¦å‘æ¡ä»¶</h4><ul><li>size è¶…è¿‡ <code>threshold = capacity * loadFactor</code>ï¼ˆé»˜è®¤ 0.75ï¼‰ã€‚</li></ul><h4 id="æµç¨‹"><a href="#æµç¨‹" class="headerlink" title="æµç¨‹"></a>æµç¨‹</h4><ol><li><strong>æ–°å»ºæ•°ç»„</strong>ï¼šå®¹é‡ç¿»å€ã€‚</li><li><strong>è¿ç§»æ¡¶</strong>ï¼š<ul><li>éå†æ—§æ¡¶ï¼Œå°†èŠ‚ç‚¹åˆ†ä¸º <strong>ä½ä½é“¾ï¼ˆloHeadï¼‰</strong> å’Œ <strong>é«˜ä½é“¾ï¼ˆhiHeadï¼‰</strong>ã€‚</li><li><code>hash &amp; oldCap == 0</code> â†’ ç•™åœ¨åŸä½ç½®ï¼›</li><li>å¦åˆ™ â†’ æ”¾åˆ° <code>i+oldCap</code>ã€‚</li></ul></li><li><strong>æ ‡è®°è¿ç§»å®Œæˆ</strong>ï¼š<ul><li>æ—§æ¡¶ç½®ä¸º ForwardingNodeã€‚</li><li>ä¹‹åè¯»&#x2F;å†™é‡åˆ°å®ƒæ—¶ï¼Œä¼šè·¯ç”±åˆ°æ–°è¡¨ã€‚</li></ul></li><li><strong>å¤šçº¿ç¨‹ååŠ©</strong>ï¼š<ul><li>å…¶ä»–çº¿ç¨‹å†™å…¥æ—¶è‹¥å‘ç°æ­£åœ¨æ‰©å®¹ â†’ è°ƒç”¨ <code>helpTransfer()</code> â†’ ä¸€èµ·åˆ†æ¡¶è¿ç§»ã€‚</li></ul></li><li><strong>æ¸è¿›å¼æ‰©å®¹</strong>ï¼š<ul><li>ä¸€æ¬¡åªè¿ç§»ä¸€ä¸ªæ¡¶ï¼Œé¿å…é˜»å¡ã€‚</li></ul></li></ol><hr><h2 id="äº”ã€å¹¶å‘æ§åˆ¶æœºåˆ¶"><a href="#äº”ã€å¹¶å‘æ§åˆ¶æœºåˆ¶" class="headerlink" title="äº”ã€å¹¶å‘æ§åˆ¶æœºåˆ¶"></a>äº”ã€å¹¶å‘æ§åˆ¶æœºåˆ¶</h2><ol><li><strong>CAS</strong>ï¼šåˆå§‹åŒ– tableã€æ’å…¥ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ—¶ã€‚</li><li><strong>volatile</strong>ï¼šä¿è¯ val å’Œ next çš„å¯è§æ€§ã€‚</li><li><strong>synchronized</strong>ï¼šå†™æ“ä½œæ—¶é”å®šå•ä¸ªæ¡¶ã€‚</li><li><strong>ForwardingNode</strong>ï¼šä¿è¯æ‰©å®¹è¿‡ç¨‹æ•°æ®ä¸€è‡´æ€§ã€‚</li></ol><hr><h2 id="å…­ã€æ€§èƒ½ç‰¹æ€§"><a href="#å…­ã€æ€§èƒ½ç‰¹æ€§" class="headerlink" title="å…­ã€æ€§èƒ½ç‰¹æ€§"></a>å…­ã€æ€§èƒ½ç‰¹æ€§</h2><ul><li>è¯»æ“ä½œå‡ ä¹æ— é” â†’ é«˜æ€§èƒ½ã€‚</li><li>å†™æ“ä½œå±€éƒ¨é”å®š â†’ ç²’åº¦å°ï¼Œå†²çªæ¦‚ç‡ä½ã€‚</li><li>æ‰©å®¹æ”¯æŒå¹¶è¡Œè¿ç§» â†’ é¿å…é•¿æ—¶é—´å¡é¡¿ã€‚</li><li>æ ‘åŒ–é¿å…é“¾è¡¨é€€åŒ– O(n)ã€‚</li></ul><hr><h2 id="ä¸ƒã€å¸¸è§é«˜é¢‘é¢è¯•é¢˜"><a href="#ä¸ƒã€å¸¸è§é«˜é¢‘é¢è¯•é¢˜" class="headerlink" title="ä¸ƒã€å¸¸è§é«˜é¢‘é¢è¯•é¢˜"></a>ä¸ƒã€å¸¸è§é«˜é¢‘é¢è¯•é¢˜</h2><h3 id="åŸºç¡€é¢˜"><a href="#åŸºç¡€é¢˜" class="headerlink" title="åŸºç¡€é¢˜"></a>åŸºç¡€é¢˜</h3><ol><li><strong>ConcurrentHashMap å’Œ HashMap çš„åŒºåˆ«ï¼Ÿ</strong><ul><li>HashMapï¼šçº¿ç¨‹ä¸å®‰å…¨ï¼›</li><li>ConcurrentHashMapï¼šçº¿ç¨‹å®‰å…¨ï¼ŒCAS+æ¡¶é”ï¼›</li><li>æ•°æ®ç»“æ„éƒ½æ”¯æŒé“¾è¡¨+çº¢é»‘æ ‘ã€‚</li></ul></li><li><strong>JDK7 å’Œ JDK8 çš„åŒºåˆ«ï¼Ÿ</strong><ul><li>JDK7ï¼šSegment åˆ†æ®µé”ï¼›</li><li>JDK8ï¼šCAS + synchronizedï¼Œé”ç²’åº¦æ›´ç»†ã€‚</li></ul></li><li><strong>ä¸ºä»€ä¹ˆ synchronized è€Œä¸æ˜¯ ReentrantLockï¼Ÿ</strong><ul><li>JDK8 ä¹‹åå¯¹ synchronized ä¼˜åŒ–ï¼ˆåå‘é”ã€è½»é‡çº§é”ï¼‰ï¼›</li><li>å®ç°ç®€æ´ï¼Œä¸éœ€æ‰‹åŠ¨é‡Šæ”¾é”ã€‚</li></ul></li></ol><hr><h3 id="è¿›é˜¶é¢˜"><a href="#è¿›é˜¶é¢˜" class="headerlink" title="è¿›é˜¶é¢˜"></a>è¿›é˜¶é¢˜</h3><ol><li><strong>ä¸ºä»€ä¹ˆ get æ— éœ€åŠ é”ï¼Ÿ</strong><ul><li>Node çš„ valã€next æ˜¯ volatileï¼Œå¯è§æ€§è¶³å¤Ÿï¼›</li><li>get åªè¯»ï¼Œä¸ä¼šä¿®æ”¹ç»“æ„ã€‚</li></ul></li><li><strong>ä¸ºä»€ä¹ˆéœ€è¦çº¢é»‘æ ‘ï¼Ÿ</strong><ul><li>é¿å…å“ˆå¸Œå†²çªä¸¥é‡æ—¶é“¾è¡¨é€€åŒ–ä¸º O(n)ã€‚</li><li>æ ‘åŒ–åæŸ¥è¯¢ O(log n)ã€‚</li></ul></li><li><strong>çº¢é»‘æ ‘ä»€ä¹ˆæ—¶å€™è½¬åŒ–&#x2F;é€€åŒ–ï¼Ÿ</strong><ul><li>é“¾è¡¨é•¿åº¦ &gt; 8 ä¸”å®¹é‡ â‰¥ 64 â†’ æ ‘åŒ–ï¼›</li><li>æ ‘èŠ‚ç‚¹æ•° &lt; 6 â†’ é€€åŒ–ä¸ºé“¾è¡¨ã€‚</li></ul></li></ol><hr><h3 id="æ‰©å®¹ç›¸å…³é¢˜"><a href="#æ‰©å®¹ç›¸å…³é¢˜" class="headerlink" title="æ‰©å®¹ç›¸å…³é¢˜"></a>æ‰©å®¹ç›¸å…³é¢˜</h3><ol><li><strong>ConcurrentHashMap æ‰©å®¹è¿‡ç¨‹ï¼Ÿä¸ºä»€ä¹ˆè¯´æ˜¯æ¸è¿›å¼ï¼Ÿ</strong><ul><li>æ¡¶çº§è¿ç§»ï¼Œæ¯æ¬¡åªè¿ç§»ä¸€ä¸ªæ¡¶ï¼›</li><li>æ—§æ¡¶ç½®ä¸º ForwardingNodeï¼›</li><li>å¤šçº¿ç¨‹å¯ååŠ©è¿ç§»ï¼›</li><li>ä¸ä¼šä¸€æ¬¡æ€§è¿ç§»æ•´ä¸ªè¡¨ â†’ é¿å…å¡é¡¿ã€‚</li></ul></li><li><strong>æ‰©å®¹æ—¶ï¼Œget å¦‚ä½•ä¿è¯æ­£ç¡®æ€§ï¼Ÿ</strong><ul><li>é‡åˆ° ForwardingNode â†’ è·³è½¬æ–°è¡¨ç»§ç»­æŸ¥ï¼›</li><li>ä¿è¯è¯»åˆ°çš„æ˜¯æœ€æ–°æ•°æ®ã€‚</li></ul></li><li><strong>ä¸ºä»€ä¹ˆä¸å…è®¸ key æˆ– value ä¸º nullï¼Ÿ</strong><ul><li>æ— æ³•åŒºåˆ†ã€Œnull è¡¨ç¤ºæ²¡æœ‰å€¼ã€è¿˜æ˜¯ã€Œå€¼æœ¬èº«å°±æ˜¯ nullã€ï¼Œå®¹æ˜“æ­§ä¹‰ã€‚</li></ul></li><li><strong>ä¸ºä»€ä¹ˆè¿­ä»£å™¨æ˜¯å¼±ä¸€è‡´æ€§çš„ï¼Ÿ</strong></li></ol><ul><li>éå†æ—¶å…è®¸å¹¶å‘ä¿®æ”¹ï¼›</li><li>ä¸æŠ›å¼‚å¸¸ï¼Œä½†å¯èƒ½æ¼æ•°æ®æˆ–è¯»åˆ°æ—§å€¼ã€‚</li></ul><ol><li><strong>size() å¦‚ä½•å®ç°ï¼Ÿä¸ºä»€ä¹ˆä¸ç²¾ç¡®ï¼Ÿ</strong></li></ol><ul><li>åˆ†æ®µè®¡æ•°ï¼Œå¤šæ¬¡å°è¯•ç´¯åŠ ï¼›</li><li>å¹¶å‘ä¸‹ä¸ä¿è¯å¼ºä¸€è‡´æ€§ï¼Œåªä¿è¯å¤§è‡´å‡†ç¡®ã€‚</li></ul><hr><h3 id="é«˜é˜¶é¢˜"><a href="#é«˜é˜¶é¢˜" class="headerlink" title="é«˜é˜¶é¢˜"></a>é«˜é˜¶é¢˜</h3><ol><li><strong>ä¸ºä»€ä¹ˆæ‰©å®¹æ—¶ä½¿ç”¨ ForwardingNodeï¼Ÿ</strong></li></ol><ul><li>é˜²æ­¢é‡å¤è¿ç§»ï¼›</li><li>è¯»å†™é‡åˆ°å®ƒèƒ½è·¯ç”±åˆ°æ–°è¡¨ã€‚</li></ul><ol><li><strong>ConcurrentHashMap ä¼šæ­»é”å—ï¼Ÿ</strong></li></ol><ul><li>ä¸ä¼šã€‚æ¯æ¬¡åªé”å•ä¸ªæ¡¶ï¼Œä¸å­˜åœ¨è·¨æ¡¶æ­»é”ã€‚</li></ul><ol><li><strong>ConcurrentHashMap ä¸ CopyOnWriteMap åŒºåˆ«ï¼Ÿ</strong></li></ol><ul><li>CHMï¼šé€‚åˆè¯»å¤šå†™å¤šï¼Œåˆ†æ¡¶é”+CASï¼›</li><li>COWï¼šé€‚åˆè¯»å¤šå†™å°‘ï¼Œå†™æ—¶å¤åˆ¶ï¼Œè¯»å®Œå…¨æ— é”ã€‚</li></ul><hr><h2 id="å…«ã€ç­”é¢˜æ¨¡æ¿ï¼ˆé¢è¯•æ¡†æ¶ï¼‰"><a href="#å…«ã€ç­”é¢˜æ¨¡æ¿ï¼ˆé¢è¯•æ¡†æ¶ï¼‰" class="headerlink" title="å…«ã€ç­”é¢˜æ¨¡æ¿ï¼ˆé¢è¯•æ¡†æ¶ï¼‰"></a>å…«ã€ç­”é¢˜æ¨¡æ¿ï¼ˆé¢è¯•æ¡†æ¶ï¼‰</h2><p>å½“è¢«é—®åˆ°ã€ŒConcurrentHashMapã€æ—¶ï¼Œå¯ä»¥è¿™æ ·ç­”ï¼š</p><ol><li><strong>æ•´ä½“å®ç°</strong>ï¼š<ul><li>JDK7ï¼šSegment åˆ†æ®µé”ï¼›</li><li>JDK8ï¼šNode æ•°ç»„ + CAS + synchronizedï¼ˆæ¡¶é”ï¼‰ã€‚</li></ul></li><li><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼š<ul><li>è¯»æ“ä½œæ— é”ï¼›</li><li>å†™æ“ä½œé”å•ä¸ªæ¡¶ï¼›</li><li>æ‰©å®¹æ¸è¿›å¼+å¤šçº¿ç¨‹ååŠ©ï¼›</li><li>å†²çªè¿‡é•¿æ—¶æ ‘åŒ–ã€‚</li></ul></li><li><strong>æ‰©å®¹æœºåˆ¶</strong>ï¼š<ul><li>æ‡’æ‰©å®¹ï¼Œé˜ˆå€¼è§¦å‘ï¼›</li><li>ForwardingNode æ ‡è®°å·²è¿ç§»æ¡¶ï¼›</li><li>å¤šçº¿ç¨‹ helpTransferï¼›</li><li>æ¸è¿›å¼è¿ç§»ï¼Œé¿å…é˜»å¡ã€‚</li></ul></li><li><strong>å¸¸è§é—®é¢˜</strong>ï¼š<ul><li>ä¸å…è®¸ null key&#x2F;valueï¼›</li><li>å¼±ä¸€è‡´æ€§è¿­ä»£å™¨ï¼›</li><li>size() ä¸ç²¾ç¡®ã€‚</li></ul></li></ol><hr><p>ğŸ“Œ <strong>ä¸€å¥è¯æ€»ç»“å£è¯€</strong>ï¼š<br> ğŸ‘‰ <strong>JDK7 Segment åˆ†æ®µé”ï¼ŒJDK8 CAS+æ¡¶é”ï¼›è¯»æ— é”ï¼Œå†™é”æ¡¶ï¼Œæ‰©å®¹å¤šçº¿ç¨‹ååŠ©ï¼›é“¾è¡¨è½¬æ ‘ï¼Œå¼±ä¸€è‡´è¿­ä»£ã€‚</strong></p><hr><h1 id="ğŸ§©-ä¸€ã€å¹¶å‘å·¥å…·ç±»ï¼ˆåä½œç±»ï¼‰"><a href="#ğŸ§©-ä¸€ã€å¹¶å‘å·¥å…·ç±»ï¼ˆåä½œç±»ï¼‰" class="headerlink" title="ğŸ§© ä¸€ã€å¹¶å‘å·¥å…·ç±»ï¼ˆåä½œç±»ï¼‰"></a>ğŸ§© ä¸€ã€å¹¶å‘å·¥å…·ç±»ï¼ˆåä½œç±»ï¼‰</h1><p>è¿™äº›å·¥å…·ç±»éƒ½åœ¨ <code>java.util.concurrent</code> åŒ…é‡Œï¼Œç”¨æ¥è§£å†³çº¿ç¨‹é—´çš„ <strong>åè°ƒ&#x2F;åŒæ­¥&#x2F;é€šä¿¡é—®é¢˜</strong>ã€‚</p><hr><h2 id="1-CountDownLatchï¼ˆå€’è®¡æ—¶å™¨ï¼‰"><a href="#1-CountDownLatchï¼ˆå€’è®¡æ—¶å™¨ï¼‰" class="headerlink" title="1. CountDownLatchï¼ˆå€’è®¡æ—¶å™¨ï¼‰"></a>1. CountDownLatchï¼ˆå€’è®¡æ—¶å™¨ï¼‰</h2><h3 id="ğŸ“-å®šä¹‰"><a href="#ğŸ“-å®šä¹‰" class="headerlink" title="ğŸ“ å®šä¹‰"></a>ğŸ“ å®šä¹‰</h3><ul><li>ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ç­‰å¾… <strong>å…¶ä»–çº¿ç¨‹å®Œæˆæ“ä½œ</strong> åå†ç»§ç»­ã€‚</li><li>å†…éƒ¨ç»´æŠ¤ä¸€ä¸ª <code>state</code>ï¼ˆè®¡æ•°ï¼‰ï¼Œåˆå§‹å€¼è®¾å®šå¥½ï¼Œæ¯è°ƒç”¨ä¸€æ¬¡ <code>countDown()</code>ï¼Œ<code>state--</code>ã€‚</li><li>å½“ <code>state=0</code> æ—¶ï¼Œ<code>await()</code> çš„çº¿ç¨‹å…¨éƒ¨å”¤é†’ã€‚</li></ul><h3 id="âš™ï¸-åº•å±‚å®ç°"><a href="#âš™ï¸-åº•å±‚å®ç°" class="headerlink" title="âš™ï¸ åº•å±‚å®ç°"></a>âš™ï¸ åº•å±‚å®ç°</h3><ul><li>åŸºäº <strong>AQSï¼ˆAbstractQueuedSynchronizerï¼‰</strong> çš„å…±äº«é”å®ç°ã€‚</li><li><code>await()</code> ä¼šé˜»å¡çº¿ç¨‹ï¼Œç›´åˆ° <code>state==0</code>ï¼›</li><li><code>countDown()</code> æ˜¯éé˜»å¡çš„ï¼Œåªæ˜¯åŸå­æ€§åœ°å‡ 1ã€‚</li></ul><h3 id="ğŸ“Œ-ä½¿ç”¨åœºæ™¯"><a href="#ğŸ“Œ-ä½¿ç”¨åœºæ™¯" class="headerlink" title="ğŸ“Œ ä½¿ç”¨åœºæ™¯"></a>ğŸ“Œ ä½¿ç”¨åœºæ™¯</h3><ul><li>ä¸»çº¿ç¨‹ç­‰å¾…å¤šä¸ªå­çº¿ç¨‹å®Œæˆï¼ˆ<strong>ä¸€ç­‰å¤š</strong>ï¼‰ã€‚</li><li>ä¾‹å¦‚ï¼šå¹¶è¡ŒåŠ è½½å¤šä¸ªé…ç½®æ–‡ä»¶ï¼Œç­‰éƒ½åŠ è½½å®Œå†åˆå¹¶å¤„ç†ã€‚</li></ul><h3 id="ğŸ¯-é¢è¯•è€ƒç‚¹"><a href="#ğŸ¯-é¢è¯•è€ƒç‚¹" class="headerlink" title="ğŸ¯ é¢è¯•è€ƒç‚¹"></a>ğŸ¯ é¢è¯•è€ƒç‚¹</h3><ul><li><strong>èƒ½å¦é‡ç”¨ï¼Ÿ</strong> â†’ <strong>ä¸èƒ½</strong>ï¼Œè®¡æ•°å½’é›¶åä¸èƒ½é‡ç½®ã€‚</li><li>å’Œ <code>CyclicBarrier</code> çš„åŒºåˆ«ï¼Ÿâ†’ <code>CountDownLatch</code> æ˜¯ã€Œä¸€ç­‰å¤šã€ï¼Œ<code>CyclicBarrier</code> æ˜¯ã€Œå¤šç­‰å¤šã€ã€‚</li></ul><hr><h2 id="2-CyclicBarrierï¼ˆå¾ªç¯å±éšœï¼‰"><a href="#2-CyclicBarrierï¼ˆå¾ªç¯å±éšœï¼‰" class="headerlink" title="2. CyclicBarrierï¼ˆå¾ªç¯å±éšœï¼‰"></a>2. CyclicBarrierï¼ˆå¾ªç¯å±éšœï¼‰</h2><h3 id="ğŸ“-å®šä¹‰-1"><a href="#ğŸ“-å®šä¹‰-1" class="headerlink" title="ğŸ“ å®šä¹‰"></a>ğŸ“ å®šä¹‰</h3><ul><li>ä¸€ç»„çº¿ç¨‹äº’ç›¸ç­‰å¾…ï¼Œç›´åˆ°æ‰€æœ‰çº¿ç¨‹éƒ½åˆ°è¾¾å±éšœç‚¹ï¼Œå†ç»Ÿä¸€å‡ºå‘ã€‚</li><li>æ”¯æŒ <strong>å¾ªç¯ä½¿ç”¨</strong>ï¼ˆè®¡æ•°å½’é›¶åå¯é‡ç½®ï¼‰ã€‚</li></ul><h3 id="âš™ï¸-åº•å±‚å®ç°-1"><a href="#âš™ï¸-åº•å±‚å®ç°-1" class="headerlink" title="âš™ï¸ åº•å±‚å®ç°"></a>âš™ï¸ åº•å±‚å®ç°</h3><ul><li>åŸºäº <strong>ReentrantLock + Condition</strong>ã€‚</li><li>æ¯ä¸ªçº¿ç¨‹è°ƒç”¨ <code>await()</code> â†’ è®¡æ•° -1 â†’ å½“è®¡æ•° &#x3D; 0 â†’ å”¤é†’æ‰€æœ‰çº¿ç¨‹ã€‚</li><li>è¿˜å¯ä»¥æŒ‡å®šä¸€ä¸ª <strong>barrierAction</strong>ï¼ˆæ‰€æœ‰çº¿ç¨‹åˆ°è¾¾åæ‰§è¡Œçš„å›è°ƒï¼‰ã€‚</li></ul><h3 id="ğŸ“Œ-ä½¿ç”¨åœºæ™¯-1"><a href="#ğŸ“Œ-ä½¿ç”¨åœºæ™¯-1" class="headerlink" title="ğŸ“Œ ä½¿ç”¨åœºæ™¯"></a>ğŸ“Œ ä½¿ç”¨åœºæ™¯</h3><ul><li>å¤šçº¿ç¨‹åˆ†é˜¶æ®µè®¡ç®—ï¼Œå†ç»Ÿä¸€åˆå¹¶ç»“æœã€‚</li><li>ä¾‹å¦‚ï¼šå¹¶è¡Œè®¡ç®—çŸ©é˜µçš„æ¯ä¸€è¡Œï¼Œæ‰€æœ‰çº¿ç¨‹åˆ°é½åæ±‡æ€»ã€‚</li></ul><h3 id="ğŸ¯-é¢è¯•è€ƒç‚¹-1"><a href="#ğŸ¯-é¢è¯•è€ƒç‚¹-1" class="headerlink" title="ğŸ¯ é¢è¯•è€ƒç‚¹"></a>ğŸ¯ é¢è¯•è€ƒç‚¹</h3><ul><li>ä¸ <code>CountDownLatch</code> çš„åŒºåˆ«ï¼Ÿâ†’ å¯å¾ªç¯ï¼Œä¸”æ˜¯ã€Œå¤šç­‰å¤šã€ã€‚</li><li><code>BrokenBarrierException</code> ä»€ä¹ˆæ—¶å€™æŠ›ï¼Ÿâ†’ çº¿ç¨‹ä¸­æ–­æˆ–è¶…æ—¶å¯¼è‡´ barrier ç ´åã€‚</li></ul><hr><h2 id="3-Semaphoreï¼ˆä¿¡å·é‡ï¼‰"><a href="#3-Semaphoreï¼ˆä¿¡å·é‡ï¼‰" class="headerlink" title="3. Semaphoreï¼ˆä¿¡å·é‡ï¼‰"></a>3. Semaphoreï¼ˆä¿¡å·é‡ï¼‰</h2><h3 id="ğŸ“-å®šä¹‰-2"><a href="#ğŸ“-å®šä¹‰-2" class="headerlink" title="ğŸ“ å®šä¹‰"></a>ğŸ“ å®šä¹‰</h3><ul><li>æ§åˆ¶åŒæ—¶è®¿é—®æŸèµ„æºçš„çº¿ç¨‹æ•°ï¼Œåƒ <strong>é™æµå™¨&#x2F;è®¸å¯è¯</strong>ã€‚</li></ul><h3 id="âš™ï¸-åº•å±‚å®ç°-2"><a href="#âš™ï¸-åº•å±‚å®ç°-2" class="headerlink" title="âš™ï¸ åº•å±‚å®ç°"></a>âš™ï¸ åº•å±‚å®ç°</h3><ul><li>åŸºäº <strong>AQS</strong> çš„å…±äº«é”å®ç°ã€‚</li><li>å†…éƒ¨ç»´æŠ¤ä¸€ä¸ª <code>permits</code>ï¼ˆè®¸å¯è¯æ•°ï¼‰ã€‚</li><li><code>acquire()</code> è·å–è®¸å¯è¯ï¼ˆpermitsâ€“ï¼Œä¸è¶³åˆ™é˜»å¡ï¼‰ï¼›</li><li><code>release()</code> å½’è¿˜è®¸å¯è¯ï¼ˆpermits++ï¼‰ã€‚</li></ul><h3 id="ğŸ“Œ-ä½¿ç”¨åœºæ™¯-2"><a href="#ğŸ“Œ-ä½¿ç”¨åœºæ™¯-2" class="headerlink" title="ğŸ“Œ ä½¿ç”¨åœºæ™¯"></a>ğŸ“Œ ä½¿ç”¨åœºæ™¯</h3><ul><li>æ§åˆ¶å¹¶å‘æ•°ï¼šæ•°æ®åº“è¿æ¥æ± ã€æ¥å£é™æµã€‚</li><li>ä¾‹å­ï¼šåœè½¦åœºæœ‰ 3 ä¸ªè½¦ä½ â†’ æœ€å¤šåªèƒ½åœ 3 è¾†è½¦ã€‚</li></ul><h3 id="ğŸ¯-é¢è¯•è€ƒç‚¹-2"><a href="#ğŸ¯-é¢è¯•è€ƒç‚¹-2" class="headerlink" title="ğŸ¯ é¢è¯•è€ƒç‚¹"></a>ğŸ¯ é¢è¯•è€ƒç‚¹</h3><ul><li>å…¬å¹³æ¨¡å¼ vs éå…¬å¹³æ¨¡å¼ï¼Ÿ<ul><li>å…¬å¹³ï¼šFIFO è·å–è®¸å¯è¯ã€‚</li><li>éå…¬å¹³ï¼šå¯èƒ½æ’é˜Ÿï¼Œååé‡æ›´é«˜ã€‚</li></ul></li><li>å’Œ <code>Lock</code> çš„åŒºåˆ«ï¼Ÿâ†’ <code>Semaphore</code> æ§åˆ¶çš„æ˜¯ <strong>å¹¶å‘æ•°é‡</strong>ï¼Œè€Œ <code>Lock</code> æ˜¯ <strong>äº’æ–¥ï¼ˆåªèƒ½ 1 ä¸ªçº¿ç¨‹ï¼‰</strong>ã€‚</li></ul><hr><h2 id="4-Exchangerï¼ˆäº¤æ¢å™¨ï¼‰"><a href="#4-Exchangerï¼ˆäº¤æ¢å™¨ï¼‰" class="headerlink" title="4. Exchangerï¼ˆäº¤æ¢å™¨ï¼‰"></a>4. Exchangerï¼ˆäº¤æ¢å™¨ï¼‰</h2><h3 id="ğŸ“-å®šä¹‰-3"><a href="#ğŸ“-å®šä¹‰-3" class="headerlink" title="ğŸ“ å®šä¹‰"></a>ğŸ“ å®šä¹‰</h3><ul><li>è®© <strong>ä¸¤ä¸ªçº¿ç¨‹</strong> åœ¨åŒæ­¥ç‚¹äº¤æ¢æ•°æ®ã€‚</li></ul><h3 id="âš™ï¸-åº•å±‚å®ç°-3"><a href="#âš™ï¸-åº•å±‚å®ç°-3" class="headerlink" title="âš™ï¸ åº•å±‚å®ç°"></a>âš™ï¸ åº•å±‚å®ç°</h3><ul><li>åŸºäº <strong>è‡ªæ—‹ + CAS</strong>ã€‚</li><li>ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ <code>exchange()</code> ä¼šç­‰å¾…ï¼Œç›´åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ä¹Ÿè°ƒç”¨ <code>exchange()</code>ï¼Œç„¶åä¸¤è€…äº¤æ¢æ•°æ®ã€‚</li></ul><h3 id="ğŸ“Œ-ä½¿ç”¨åœºæ™¯-3"><a href="#ğŸ“Œ-ä½¿ç”¨åœºæ™¯-3" class="headerlink" title="ğŸ“Œ ä½¿ç”¨åœºæ™¯"></a>ğŸ“Œ ä½¿ç”¨åœºæ™¯</h3><ul><li>åŒçº¿ç¨‹åä½œï¼šç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´æˆå¯¹äº¤æ¢æ•°æ®å—ã€‚</li><li>æ¯”å¦‚ï¼šä¸€ä¸ªçº¿ç¨‹ç”Ÿæˆæ•°æ®ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å†™å…¥ç£ç›˜ã€‚</li></ul><h3 id="ğŸ¯-é¢è¯•è€ƒç‚¹-3"><a href="#ğŸ¯-é¢è¯•è€ƒç‚¹-3" class="headerlink" title="ğŸ¯ é¢è¯•è€ƒç‚¹"></a>ğŸ¯ é¢è¯•è€ƒç‚¹</h3><ul><li>å¦‚æœåªæœ‰ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ <code>exchange()</code> ä¼šæ€æ ·ï¼Ÿâ†’ ä¼šé˜»å¡ï¼Œç›´åˆ°å¦ä¸€æ–¹åˆ°æ¥ã€‚</li><li>ä¸é˜Ÿåˆ—ï¼ˆBlockingQueueï¼‰çš„åŒºåˆ«ï¼Ÿâ†’ <code>Exchanger</code> æ˜¯ <strong>ä¸€å¯¹ä¸€äº¤æ¢</strong>ï¼Œè€Œé˜Ÿåˆ—å¯ä»¥ä¸€å¯¹å¤šã€‚</li></ul><hr><h1 id="ğŸ§©-äºŒã€åŸå­ç±»ï¼ˆAtomic-ç³»åˆ—ï¼‰"><a href="#ğŸ§©-äºŒã€åŸå­ç±»ï¼ˆAtomic-ç³»åˆ—ï¼‰" class="headerlink" title="ğŸ§© äºŒã€åŸå­ç±»ï¼ˆAtomic ç³»åˆ—ï¼‰"></a>ğŸ§© äºŒã€åŸå­ç±»ï¼ˆAtomic ç³»åˆ—ï¼‰</h1><p>è¿™äº›ç±»åœ¨ <code>java.util.concurrent.atomic</code> åŒ…ä¸‹ï¼Œæä¾›äº† <strong>æ— é”åŒ–çš„çº¿ç¨‹å®‰å…¨æ“ä½œ</strong>ã€‚</p><hr><h2 id="1-åŸºç¡€åŸå­ç±»"><a href="#1-åŸºç¡€åŸå­ç±»" class="headerlink" title="1. åŸºç¡€åŸå­ç±»"></a>1. åŸºç¡€åŸå­ç±»</h2><h3 id="AtomicInteger-AtomicLong-AtomicBoolean"><a href="#AtomicInteger-AtomicLong-AtomicBoolean" class="headerlink" title="AtomicInteger &#x2F; AtomicLong &#x2F; AtomicBoolean"></a>AtomicInteger &#x2F; AtomicLong &#x2F; AtomicBoolean</h3><ul><li>ä½œç”¨ï¼šå¯¹å•ä¸ª <code>int</code>&#x2F;<code>long</code>&#x2F;<code>boolean</code> å˜é‡çš„åŸå­æ“ä½œã€‚</li><li>å…¸å‹æ–¹æ³•ï¼š<ul><li><code>getAndIncrement()</code> â†’ è‡ªå¢ï¼ˆåŸå­æ€§ i++ï¼‰ã€‚</li><li><code>compareAndSet(expect, update)</code> â†’ CAS æ›´æ–°ã€‚</li></ul></li></ul><h3 id="âš™ï¸-åº•å±‚å®ç°-4"><a href="#âš™ï¸-åº•å±‚å®ç°-4" class="headerlink" title="âš™ï¸ åº•å±‚å®ç°"></a>âš™ï¸ åº•å±‚å®ç°</h3><ul><li>åŸºäº <strong>CASï¼ˆCompare-And-Swapï¼‰ + volatile</strong>ã€‚</li><li>å†…éƒ¨è°ƒç”¨ <strong>Unsafe ç±»</strong> çš„ <code>compareAndSwapInt</code> ç­‰æ–¹æ³•ã€‚</li></ul><h3 id="ğŸ“Œ-ä½¿ç”¨åœºæ™¯-4"><a href="#ğŸ“Œ-ä½¿ç”¨åœºæ™¯-4" class="headerlink" title="ğŸ“Œ ä½¿ç”¨åœºæ™¯"></a>ğŸ“Œ ä½¿ç”¨åœºæ™¯</h3><ul><li>é«˜å¹¶å‘è®¡æ•°å™¨ï¼šç½‘ç«™è®¿é—®é‡ç»Ÿè®¡ã€ID ç”Ÿæˆå™¨ã€‚</li></ul><h3 id="ğŸ¯-é¢è¯•è€ƒç‚¹-4"><a href="#ğŸ¯-é¢è¯•è€ƒç‚¹-4" class="headerlink" title="ğŸ¯ é¢è¯•è€ƒç‚¹"></a>ğŸ¯ é¢è¯•è€ƒç‚¹</h3><ul><li>CAS çš„ç¼ºç‚¹ï¼Ÿ<ol><li>ABA é—®é¢˜ï¼ˆå¯ç”¨ <code>AtomicStampedReference</code> è§£å†³ï¼‰ã€‚</li><li>è‡ªæ—‹å¼€é”€å¤§ã€‚</li><li>åªèƒ½ä¿è¯å•å˜é‡åŸå­æ€§ï¼Œä¸èƒ½ä¿è¯å¤åˆæ“ä½œã€‚</li></ol></li></ul><hr><h2 id="2-æ•°ç»„åŸå­ç±»"><a href="#2-æ•°ç»„åŸå­ç±»" class="headerlink" title="2. æ•°ç»„åŸå­ç±»"></a>2. æ•°ç»„åŸå­ç±»</h2><h3 id="AtomicIntegerArray-AtomicLongArray-AtomicReferenceArray"><a href="#AtomicIntegerArray-AtomicLongArray-AtomicReferenceArray" class="headerlink" title="AtomicIntegerArray &#x2F; AtomicLongArray &#x2F; AtomicReferenceArray"></a>AtomicIntegerArray &#x2F; AtomicLongArray &#x2F; AtomicReferenceArray</h3><ul><li>ä¿è¯æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ çš„åŸå­æ“ä½œã€‚</li><li>ä¾‹å¦‚ï¼šç»Ÿè®¡åˆ†ç‰‡æ•°æ®æ—¶ï¼Œé¿å…é”æ•´ä¸ªæ•°ç»„ã€‚</li></ul><hr><h2 id="3-å¼•ç”¨åŸå­ç±»"><a href="#3-å¼•ç”¨åŸå­ç±»" class="headerlink" title="3. å¼•ç”¨åŸå­ç±»"></a>3. å¼•ç”¨åŸå­ç±»</h2><h3 id="AtomicReference"><a href="#AtomicReference" class="headerlink" title="AtomicReference"></a>AtomicReference</h3><ul><li>ä¿è¯å¯¹è±¡å¼•ç”¨çš„åŸå­æ›´æ–°ã€‚</li></ul><h3 id="AtomicStampedReference"><a href="#AtomicStampedReference" class="headerlink" title="AtomicStampedReference"></a>AtomicStampedReference</h3><ul><li>è§£å†³ <strong>ABA é—®é¢˜</strong>ï¼Œç»™å¼•ç”¨åŠ ä¸€ä¸ªç‰ˆæœ¬å·ï¼ˆstampï¼‰ã€‚</li></ul><h3 id="AtomicMarkableReference"><a href="#AtomicMarkableReference" class="headerlink" title="AtomicMarkableReference"></a>AtomicMarkableReference</h3><ul><li>ç»™å¼•ç”¨åŠ ä¸€ä¸ª <strong>boolean æ ‡è®°</strong>ã€‚</li></ul><hr><h2 id="4-ç´¯åŠ å™¨ç±»"><a href="#4-ç´¯åŠ å™¨ç±»" class="headerlink" title="4. ç´¯åŠ å™¨ç±»"></a>4. ç´¯åŠ å™¨ç±»</h2><h3 id="LongAdder-DoubleAdder"><a href="#LongAdder-DoubleAdder" class="headerlink" title="LongAdder &#x2F; DoubleAdder"></a>LongAdder &#x2F; DoubleAdder</h3><ul><li>å¯¹ <code>AtomicLong</code> çš„ä¼˜åŒ–ï¼šé«˜å¹¶å‘ä¸‹çƒ­ç‚¹åˆ†ç¦»ã€‚</li><li>å†…éƒ¨ç»´æŠ¤ä¸€ä¸ª <strong>base å€¼ + åˆ†ç‰‡ cell æ•°ç»„</strong>ã€‚</li><li>å¤šçº¿ç¨‹å†™æ—¶åˆ†æ•£åˆ°ä¸åŒçš„ cellï¼Œæœ€åæ±‚å’Œã€‚</li></ul><h3 id="ğŸ“Œ-ä½¿ç”¨åœºæ™¯-5"><a href="#ğŸ“Œ-ä½¿ç”¨åœºæ™¯-5" class="headerlink" title="ğŸ“Œ ä½¿ç”¨åœºæ™¯"></a>ğŸ“Œ ä½¿ç”¨åœºæ™¯</h3><ul><li>é«˜å¹¶å‘è®¡æ•°ï¼Œå¦‚ QPS ç»Ÿè®¡ã€çƒ­ç‚¹è®¡æ•°ã€‚</li></ul><h3 id="ğŸ¯-é¢è¯•è€ƒç‚¹-5"><a href="#ğŸ¯-é¢è¯•è€ƒç‚¹-5" class="headerlink" title="ğŸ¯ é¢è¯•è€ƒç‚¹"></a>ğŸ¯ é¢è¯•è€ƒç‚¹</h3><ul><li>ä¸ºä»€ä¹ˆ <code>LongAdder</code> æ¯” <code>AtomicLong</code> æ€§èƒ½å¥½ï¼Ÿ<ul><li>AtomicLong æ‰€æœ‰çº¿ç¨‹ CAS åŒä¸€ä¸ªå€¼ï¼Œå½¢æˆçƒ­ç‚¹ï¼›</li><li>LongAdder åˆ†æ•£å†²çªåˆ°å¤šä¸ª cellï¼Œé™ä½ç«äº‰ã€‚</li></ul></li></ul><hr><h1 id="ğŸ§ -ä¸‰ã€å·¥å…·ç±»-åŸå­ç±»å¯¹æ¯”æ€»ç»“"><a href="#ğŸ§ -ä¸‰ã€å·¥å…·ç±»-åŸå­ç±»å¯¹æ¯”æ€»ç»“" class="headerlink" title="ğŸ§  ä¸‰ã€å·¥å…·ç±» &amp; åŸå­ç±»å¯¹æ¯”æ€»ç»“"></a>ğŸ§  ä¸‰ã€å·¥å…·ç±» &amp; åŸå­ç±»å¯¹æ¯”æ€»ç»“</h1><table><thead><tr><th>å·¥å…·ç±» &#x2F; åŸå­ç±»</th><th>åŠŸèƒ½</th><th>å®ç°åŸç†</th><th>å…¸å‹åœºæ™¯</th></tr></thead><tbody><tr><td>CountDownLatch</td><td>ä¸€ç­‰å¤š</td><td>AQS å…±äº«é”</td><td>ä¸»çº¿ç¨‹ç­‰å­çº¿ç¨‹å®Œæˆ</td></tr><tr><td>CyclicBarrier</td><td>å¤šç­‰å¤šï¼Œå¯å¾ªç¯</td><td>ReentrantLock + Condition</td><td>åˆ†é˜¶æ®µåŒæ­¥ï¼Œå¤šçº¿ç¨‹æ±‡æ€»è®¡ç®—</td></tr><tr><td>Semaphore</td><td>æ§åˆ¶å¹¶å‘æ•°ï¼ˆè®¸å¯è¯ï¼‰</td><td>AQS å…±äº«é”</td><td>é™æµã€è¿æ¥æ± ã€èµ„æºæ± </td></tr><tr><td>Exchanger</td><td>ä¸¤çº¿ç¨‹æ•°æ®äº¤æ¢</td><td>CAS + è‡ªæ—‹</td><td>åŒçº¿ç¨‹åä½œï¼Œæ•°æ®å—äº¤æ¢</td></tr><tr><td>AtomicInteger&#x2F;Long</td><td>å•å˜é‡åŸå­æ“ä½œ</td><td>CAS + volatile</td><td>é«˜å¹¶å‘è®¡æ•°å™¨ï¼ŒID ç”Ÿæˆ</td></tr><tr><td>AtomicReference</td><td>åŸå­æ›´æ–°å¼•ç”¨</td><td>CAS</td><td>æ— é”æ›´æ–°å¯¹è±¡å¼•ç”¨</td></tr><tr><td>AtomicStampedReference</td><td>å¸¦ç‰ˆæœ¬å·å¼•ç”¨ï¼Œé˜²æ­¢ ABA</td><td>CAS</td><td>è§£å†³ ABA é—®é¢˜</td></tr><tr><td>LongAdder&#x2F;DoubleAdder</td><td>é«˜å¹¶å‘ç´¯åŠ ä¼˜åŒ–</td><td>åˆ†ç‰‡ + CAS</td><td>é«˜å¹¶å‘è®¡æ•°ï¼Œæ€§èƒ½ä¼˜äº AtomicLong</td></tr></tbody></table><hr><h1 id="ğŸ¯-å››ã€é¢è¯•ç­”é¢˜æ¨¡æ¿ï¼ˆå¯å¥—ç”¨ï¼‰"><a href="#ğŸ¯-å››ã€é¢è¯•ç­”é¢˜æ¨¡æ¿ï¼ˆå¯å¥—ç”¨ï¼‰" class="headerlink" title="ğŸ¯ å››ã€é¢è¯•ç­”é¢˜æ¨¡æ¿ï¼ˆå¯å¥—ç”¨ï¼‰"></a>ğŸ¯ å››ã€é¢è¯•ç­”é¢˜æ¨¡æ¿ï¼ˆå¯å¥—ç”¨ï¼‰</h1><p>å¦‚æœé¢è¯•å®˜é—® <strong>â€œä½ äº†è§£ JUC çš„å¹¶å‘å·¥å…·ç±»å—ï¼Ÿâ€</strong> å¯ä»¥è¿™æ ·ç­”ï¼š</p><ol><li><strong>æ€»ä½“åˆ†ç±»</strong><ul><li>JUC é‡Œæä¾›äº† <strong>åä½œç±»å·¥å…·ï¼ˆCountDownLatchã€CyclicBarrierã€Semaphoreã€Exchangerï¼‰</strong> å’Œ <strong>åŸå­ç±»ï¼ˆAtomicIntegerã€LongAdder ç­‰ï¼‰</strong>ã€‚</li></ul></li><li><strong>é€ä¸ªè§£é‡Š</strong><ul><li><code>CountDownLatch</code>ï¼šä¸€ç­‰å¤šï¼Œä¸»çº¿ç¨‹ç­‰å­çº¿ç¨‹ã€‚</li><li><code>CyclicBarrier</code>ï¼šå¤šç­‰å¤šï¼Œå¯å¾ªç¯ã€‚</li><li><code>Semaphore</code>ï¼šæ§åˆ¶å¹¶å‘æ•°ï¼Œé™æµã€‚</li><li><code>Exchanger</code>ï¼šä¸¤çº¿ç¨‹äº¤æ¢æ•°æ®ã€‚</li><li><code>AtomicInteger/Long</code>ï¼šå•å˜é‡åŸå­æ“ä½œï¼ŒåŸºäº CASã€‚</li><li><code>LongAdder</code>ï¼šé«˜å¹¶å‘ä¸‹æ¯” AtomicLong æ›´é«˜æ•ˆã€‚</li></ul></li><li><strong>åŸç†è¡¥å……</strong><ul><li>å·¥å…·ç±»å¤§å¤šåŸºäº <strong>AQS</strong> å®ç°ï¼›</li><li>åŸå­ç±»åŸºäº <strong>CAS + volatile</strong>ï¼›</li><li>LongAdder ç”¨ <strong>åˆ†æ®µç´¯åŠ </strong> ä¼˜åŒ–çƒ­ç‚¹ã€‚</li></ul></li><li><strong>æ€»ç»“</strong><br> ğŸ‘‰ <strong>å·¥å…·ç±»è§£å†³çº¿ç¨‹åä½œï¼ŒåŸå­ç±»è§£å†³æ— é”æ›´æ–°ï¼Œéƒ½æ˜¯ JUC çš„æ ¸å¿ƒã€‚</strong></li></ol><hr><h4 id="å°ç»“-Map"><a href="#å°ç»“-Map" class="headerlink" title="å°ç»“ Map:"></a>å°ç»“ Map:</h4><ul><li>HashMap: æœ€å¸¸ç”¨ï¼Œéœ€è¦å¿«é€ŸæŸ¥æ‰¾ï¼Œä¸å…³å¿ƒé”®å€¼å¯¹é¡ºåºï¼Œä¸”åœ¨å•çº¿ç¨‹æˆ–ç”±å¤–éƒ¨åŒæ­¥æœºåˆ¶ä¿è¯çº¿ç¨‹å®‰å…¨çš„åœºæ™¯ã€‚</li><li>LinkedHashMap: éœ€è¦å¿«é€ŸæŸ¥æ‰¾ï¼ŒåŒæ—¶éœ€è¦ä¿æŒæ’å…¥é¡ºåºæˆ–è®¿é—®é¡ºåºçš„åœºæ™¯ï¼ˆå¦‚å®ç° LRU ç¼“å­˜ï¼‰ã€‚</li><li>TreeMap: éœ€è¦æ ¹æ®é”®çš„è‡ªç„¶é¡ºåºæˆ–è‡ªå®šä¹‰é¡ºåºæ’åºçš„åœºæ™¯ã€‚</li><li>ConcurrentHashMap: é«˜å¹¶å‘åœºæ™¯ä¸‹å¯¹ Map è¿›è¡Œè¯»å†™æ“ä½œçš„é¦–é€‰ã€‚</li><li>Hashtable: å·²è¢«æ·˜æ±°ï¼Œä¸æ¨èä½¿ç”¨ã€‚</li></ul><h4 id="é›†åˆéƒ¨åˆ†æ€»ç»“ï¼š"><a href="#é›†åˆéƒ¨åˆ†æ€»ç»“ï¼š" class="headerlink" title="é›†åˆéƒ¨åˆ†æ€»ç»“ï¼š"></a>é›†åˆéƒ¨åˆ†æ€»ç»“ï¼š</h4><p>éå† Java é›†åˆæœ‰å¤šç§æ–¹å¼ï¼Œæ¯ç§æ–¹å¼éƒ½æœ‰å…¶ä¼˜ç¼ºç‚¹ã€‚é€‰æ‹©å“ªç§æ–¹å¼å–å†³äºä½ æ­£åœ¨ä½¿ç”¨çš„é›†åˆç±»å‹å’Œå…·ä½“éœ€æ±‚ã€‚ä»¥ä¸‹æ˜¯å¯¹å‡ ç§å¸¸è§éå†æ–¹å¼çš„ä¼˜åŠ£åˆ†æå’Œæ¨èã€‚</p><hr><h3 id="1-è¿­ä»£å™¨-Iterator"><a href="#1-è¿­ä»£å™¨-Iterator" class="headerlink" title="1. è¿­ä»£å™¨ (Iterator)"></a>1. è¿­ä»£å™¨ (Iterator)</h3><p>è¿™æ˜¯æœ€é€šç”¨çš„éå†æ–¹å¼ï¼Œé€‚ç”¨äºæ‰€æœ‰å®ç°äº† <code>Iterable</code> æ¥å£çš„é›†åˆã€‚</p><ul><li><strong>ä¼˜ç‚¹</strong>ï¼š<ul><li><strong>é€šç”¨æ€§å¼º</strong>ï¼šå®ƒé€‚ç”¨äºæ‰€æœ‰é›†åˆï¼ŒåŒ…æ‹¬ <code>List</code>ã€<code>Set</code> å’Œ <code>Queue</code>ã€‚</li><li><strong>å®‰å…¨</strong>ï¼šåœ¨ä½¿ç”¨ <code>Iterator</code> éå†æ—¶ï¼Œå¯ä»¥å®‰å…¨åœ°è°ƒç”¨ <code>iterator.remove()</code> æ–¹æ³•ç§»é™¤å…ƒç´ ï¼Œä¸ä¼šå¼•å‘ <code>ConcurrentModificationException</code>ã€‚</li><li><strong>æ€§èƒ½ä¼˜è¶Š</strong>ï¼šå¯¹äº <code>LinkedList</code> è¿™ç±»é“¾å¼å­˜å‚¨çš„é›†åˆï¼Œè¿­ä»£å™¨çš„éå†æ•ˆç‡æœ€é«˜ã€‚</li></ul></li><li><strong>ç¼ºç‚¹</strong>ï¼š<ul><li>è¯­æ³•ç›¸å¯¹ç¹çï¼Œéœ€è¦æ‰‹åŠ¨è°ƒç”¨ <code>hasNext()</code> å’Œ <code>next()</code>ã€‚</li></ul></li><li><strong>æ¨è</strong>ï¼š<ul><li>å½“éœ€è¦<strong>åœ¨éå†è¿‡ç¨‹ä¸­åˆ é™¤å…ƒç´ </strong>æ—¶ï¼Œå¿…é¡»ä½¿ç”¨è¿­ä»£å™¨ã€‚</li><li>ä½œä¸º<strong>é€šç”¨</strong>ä¸”å®‰å…¨çš„éå†é¦–é€‰ã€‚</li></ul></li></ul><h3 id="2-å¢å¼º-for-å¾ªç¯-For-Each-Loop"><a href="#2-å¢å¼º-for-å¾ªç¯-For-Each-Loop" class="headerlink" title="2. å¢å¼º for å¾ªç¯ (For-Each Loop)"></a>2. å¢å¼º for å¾ªç¯ (For-Each Loop)</h3><p>å¢å¼º for å¾ªç¯æ˜¯åŸºäºè¿­ä»£å™¨çš„ä¸€ç§è¯­æ³•ç³–ï¼Œå®ƒä½¿éå†ä»£ç æ›´ç®€æ´æ˜“è¯»ã€‚</p><ul><li><strong>ä¼˜ç‚¹</strong>ï¼š<ul><li><strong>ä»£ç ç®€æ´</strong>ï¼šè¯­æ³•ç®€å•ç›´è§‚ï¼Œå¯è¯»æ€§å¼ºã€‚</li><li><strong>ä¸æ˜“å‡ºé”™</strong>ï¼šæ— éœ€æ‰‹åŠ¨ç®¡ç†ç´¢å¼•æˆ–è¿­ä»£å™¨ã€‚</li></ul></li><li><strong>ç¼ºç‚¹</strong>ï¼š<ul><li><strong>ä¸æ”¯æŒåˆ é™¤</strong>ï¼šåœ¨éå†è¿‡ç¨‹ä¸­ç›´æ¥è°ƒç”¨é›†åˆçš„ <code>remove()</code> æ–¹æ³•ä¼šæŠ›å‡º <code>ConcurrentModificationException</code>ã€‚</li><li><strong>æ€§èƒ½</strong>ï¼šå¯¹äº <code>LinkedList</code> æ¥è¯´ï¼Œå®ƒçš„åº•å±‚ä»ç„¶æ˜¯è¿­ä»£å™¨ï¼Œæ€§èƒ½å¾ˆå¥½ã€‚ä½†å¯¹äº <code>ArrayList</code>ï¼Œå®ƒçš„æ€§èƒ½ä¸å¦‚ä¼ ç»Ÿçš„ <code>for</code> å¾ªç¯ï¼Œå› ä¸ºæ¯æ¬¡è¿­ä»£éƒ½éœ€è¦è°ƒç”¨ <code>next()</code> æ–¹æ³•ã€‚</li></ul></li><li><strong>æ¨è</strong>ï¼š<ul><li>å½“ä½ åªéœ€è¦<strong>è¯»å–é›†åˆä¸­çš„å…ƒç´ </strong>ï¼Œä¸”ä»£ç ç®€æ´æ€§æ¯”æ€§èƒ½æ›´é‡è¦æ—¶ã€‚</li></ul></li></ul><hr><h3 id="3-ä¼ ç»Ÿ-for-å¾ªç¯-Indexed-For-Loop"><a href="#3-ä¼ ç»Ÿ-for-å¾ªç¯-Indexed-For-Loop" class="headerlink" title="3. ä¼ ç»Ÿ for å¾ªç¯ (Indexed For Loop)"></a>3. ä¼ ç»Ÿ for å¾ªç¯ (Indexed For Loop)</h3><p>è¿™ç§æ–¹å¼åªé€‚ç”¨äºæ”¯æŒé€šè¿‡ç´¢å¼•è®¿é—®çš„é›†åˆï¼Œå¦‚ <code>ArrayList</code> å’Œ <code>Vector</code>ã€‚</p><ul><li><strong>ä¼˜ç‚¹</strong>ï¼š<ul><li><strong>æ€§èƒ½æœ€é«˜</strong>ï¼šå¯¹äº <code>ArrayList</code>ï¼Œå®ƒé€šè¿‡ç´¢å¼•ç›´æ¥è®¿é—®å…ƒç´ ï¼Œæ•ˆç‡æé«˜ï¼Œæ€§èƒ½ä¼˜äºè¿­ä»£å™¨ã€‚</li><li><strong>çµæ´»</strong>ï¼šå¯ä»¥æŒ‰éœ€å‘å‰æˆ–å‘åéå†ï¼Œä¹Ÿå¯ä»¥è·³è¿‡å…ƒç´ ã€‚</li></ul></li><li><strong>ç¼ºç‚¹</strong>ï¼š<ul><li><strong>ä¸é€šç”¨</strong>ï¼šä¸é€‚ç”¨äº <code>Set</code> æˆ– <code>Map</code> ç­‰ä¸æŒ‰ç´¢å¼•å­˜å‚¨çš„é›†åˆã€‚</li><li><strong>æ•ˆç‡ä½ä¸‹</strong>ï¼šå¯¹äº <code>LinkedList</code>ï¼Œæ¯æ¬¡ <code>get(i)</code> è°ƒç”¨éƒ½ä¼šä»å¤´å¼€å§‹éå†ï¼Œå¯¼è‡´æ€§èƒ½æå·®ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(nÂ²)ã€‚</li></ul></li><li><strong>æ¨è</strong>ï¼š<ul><li>å½“éå† <strong>ArrayList</strong> å¹¶éœ€è¦<strong>é«˜æ€§èƒ½</strong>æ—¶ã€‚</li></ul></li></ul><hr><h3 id="4-Lambda-è¡¨è¾¾å¼ä¸-Stream-API"><a href="#4-Lambda-è¡¨è¾¾å¼ä¸-Stream-API" class="headerlink" title="4. Lambda è¡¨è¾¾å¼ä¸ Stream API"></a>4. Lambda è¡¨è¾¾å¼ä¸ Stream API</h3><p>Java 8 å¼•å…¥çš„ Stream API æä¾›äº†éå¸¸å¼ºå¤§çš„å‡½æ•°å¼ç¼–ç¨‹èƒ½åŠ›ï¼Œå¯ä»¥ç”¨äºéå†å’Œå¤„ç†é›†åˆã€‚</p><ul><li><strong>ä¼˜ç‚¹</strong>ï¼š<ul><li><strong>ç®€æ´ä¼˜é›…</strong>ï¼šä»£ç éå¸¸ç®€æ´ï¼Œè¡¨è¾¾åŠ›å¼ºã€‚</li><li><strong>åŠŸèƒ½å¼ºå¤§</strong>ï¼šæ”¯æŒè¿‡æ»¤ã€æ˜ å°„ã€æ’åºç­‰å„ç§æ“ä½œï¼Œèƒ½ä»¥å£°æ˜å¼çš„æ–¹å¼å¤„ç†æ•°æ®ã€‚</li><li><strong>æ”¯æŒå¹¶è¡Œ</strong>ï¼šå¯ä»¥é€šè¿‡ <code>parallelStream()</code> å¼€å¯å¹¶è¡Œå¤„ç†ï¼Œåˆ©ç”¨å¤šæ ¸ä¼˜åŠ¿ã€‚</li></ul></li><li><strong>ç¼ºç‚¹</strong>ï¼š<ul><li>æ€§èƒ½å¼€é”€ï¼šé€šå¸¸æ¯”ä¼ ç»Ÿçš„ <code>for</code> å¾ªç¯ç•¥é«˜ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å°è§„æ¨¡æ•°æ®æ—¶ã€‚</li></ul></li><li><strong>æ¨è</strong>ï¼š<ul><li>å½“ä½ éœ€è¦å¯¹é›†åˆè¿›è¡Œ<strong>å¤æ‚çš„æ“ä½œ</strong>ï¼ˆå¦‚è¿‡æ»¤ã€è½¬æ¢ã€èšåˆï¼‰æ—¶ã€‚</li><li>éœ€è¦åˆ©ç”¨<strong>å¹¶è¡Œå¤„ç†</strong>æ¥æé«˜æ€§èƒ½æ—¶ã€‚</li></ul></li></ul><hr><h3 id="æ€»ç»“ä¸æœ€ä½³å®è·µ"><a href="#æ€»ç»“ä¸æœ€ä½³å®è·µ" class="headerlink" title="æ€»ç»“ä¸æœ€ä½³å®è·µ"></a>æ€»ç»“ä¸æœ€ä½³å®è·µ</h3><table><thead><tr><th>æ–¹å¼</th><th>é€‚ç”¨é›†åˆ</th><th>ä¼˜åŠ£</th><th>æ¨èåœºæ™¯</th></tr></thead><tbody><tr><td><strong>è¿­ä»£å™¨</strong></td><td>æ‰€æœ‰é›†åˆ</td><td>é€šç”¨ã€å®‰å…¨ï¼ˆå¯åˆ é™¤ï¼‰ï¼Œå¯¹ <code>LinkedList</code> æ€§èƒ½å¥½ã€‚</td><td>éœ€è¦åœ¨éå†ä¸­åˆ é™¤å…ƒç´ ï¼Œæˆ–ä½œä¸ºé€šç”¨é€‰æ‹©ã€‚</td></tr><tr><td><strong>å¢å¼º for</strong></td><td>æ‰€æœ‰é›†åˆ</td><td>è¯­æ³•ç®€æ´ï¼Œå¯è¯»æ€§é«˜ã€‚ä¸èƒ½åœ¨éå†ä¸­åˆ é™¤ã€‚</td><td>ä»…éœ€è¯»å–å…ƒç´ ï¼Œä¸”è¿½æ±‚ä»£ç ç®€æ´ã€‚</td></tr><tr><td><strong>ä¼ ç»Ÿ for</strong></td><td><code>ArrayList</code> ç­‰</td><td><code>ArrayList</code> æ€§èƒ½æœ€é«˜ï¼Œçµæ´»ã€‚å¯¹ <code>LinkedList</code> æ€§èƒ½æå·®ã€‚</td><td><code>ArrayList</code> çš„é«˜æ€§èƒ½éå†ï¼Œæˆ–éœ€è¦æ§åˆ¶ç´¢å¼•ã€‚</td></tr><tr><td><strong>Stream API</strong></td><td>æ‰€æœ‰é›†åˆ</td><td>åŠŸèƒ½å¼ºå¤§ï¼Œä»£ç ä¼˜é›…ï¼Œæ”¯æŒå¹¶è¡Œã€‚</td><td>å¤æ‚æ•°æ®å¤„ç†ã€å¹¶è¡Œè®¡ç®—ã€‚</td></tr></tbody></table><p><strong>ç®€å•æ¦‚æ‹¬</strong>ï¼š</p><ul><li><strong>è¯»å–</strong> <code>ArrayList</code>ï¼šé¦–é€‰<strong>ä¼ ç»Ÿ for å¾ªç¯</strong>ã€‚</li><li><strong>è¯»å–</strong> <code>LinkedList</code>ã€<code>Set</code>ï¼šé¦–é€‰<strong>å¢å¼º for å¾ªç¯</strong>ã€‚</li><li><strong>åˆ é™¤</strong>å…ƒç´ ï¼šå¿…é¡»ä½¿ç”¨<strong>è¿­ä»£å™¨</strong>ã€‚</li><li><strong>å¤æ‚æ“ä½œ</strong>ï¼šä½¿ç”¨ <strong>Stream API</strong>ã€‚</li></ul><p>é€šå¸¸æ¥è¯´ï¼Œåœ¨ Java ä¸­åå‘éå†å¹¶åˆ é™¤å…ƒç´ æ—¶ï¼Œä½¿ç”¨ä¼ ç»Ÿçš„ <strong>for å¾ªç¯</strong>å¹¶ä»åˆ—è¡¨çš„æœ«å°¾å¼€å§‹å‘å‰éå†æ˜¯æœ€å®‰å…¨å’Œé«˜æ•ˆçš„æ–¹æ³•ã€‚</p><h3 id="ä¸ºä»€ä¹ˆæ¨èåå‘éå†ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆæ¨èåå‘éå†ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆæ¨èåå‘éå†ï¼Ÿ"></a>ä¸ºä»€ä¹ˆæ¨èåå‘éå†ï¼Ÿ</h3><p>å½“ä½ ä½¿ç”¨æ­£å‘éå†ï¼ˆä»ç´¢å¼• 0 å¼€å§‹ï¼‰å¹¶åˆ é™¤å…ƒç´ æ—¶ï¼Œä¼šé‡åˆ°ä¸€ä¸ªå¸¸è§é—®é¢˜ï¼š</p><ul><li>å½“ä½ åˆ é™¤ä¸€ä¸ªå…ƒç´ åï¼Œå®ƒåé¢çš„æ‰€æœ‰å…ƒç´ çš„ç´¢å¼•éƒ½ä¼šå‘å‰ç§»åŠ¨ä¸€ä½ã€‚</li><li>è¿™ä¼šå¯¼è‡´åœ¨ä¸‹ä¸€æ¬¡å¾ªç¯è¿­ä»£æ—¶ï¼Œä½ å¯èƒ½ä¼šè·³è¿‡ç´§è·Ÿåœ¨è¢«åˆ é™¤å…ƒç´ åé¢çš„é‚£ä¸ªå…ƒç´ ï¼Œå› ä¸ºå®ƒç°åœ¨å æ®äº†è¢«åˆ é™¤å…ƒç´ åŸæ¥çš„ä½ç½®ï¼Œè€Œä½ çš„å¾ªç¯ç´¢å¼•å·²ç»å¢åˆ°äº†ä¸‹ä¸€ä¸ªä½ç½®ã€‚</li></ul><p><strong>åå‘éå†</strong>å®Œç¾åœ°è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚å½“ä½ ä»åˆ—è¡¨æœ«å°¾å¼€å§‹å‘å‰éå†æ—¶ï¼Œåˆ é™¤ä¸€ä¸ªå…ƒç´ <strong>ä¸ä¼šå½±å“</strong>ä½ å°šæœªéå†åˆ°çš„ä»»ä½•å…ƒç´ çš„ç´¢å¼•ï¼Œå› ä¸ºä½ æ­£åœ¨å¤„ç†çš„å…ƒç´ åŠå…¶ç´¢å¼•éƒ½ä½äºåˆ—è¡¨çš„â€œååŠéƒ¨åˆ†â€ã€‚</p><hr><h3 id="å®ç°æ–¹å¼"><a href="#å®ç°æ–¹å¼" class="headerlink" title="å®ç°æ–¹å¼"></a>å®ç°æ–¹å¼</h3><h4 id="1-ä¼ ç»Ÿçš„-for-å¾ªç¯ï¼ˆæ¨èï¼‰"><a href="#1-ä¼ ç»Ÿçš„-for-å¾ªç¯ï¼ˆæ¨èï¼‰" class="headerlink" title="1. ä¼ ç»Ÿçš„ for å¾ªç¯ï¼ˆæ¨èï¼‰"></a>1. ä¼ ç»Ÿçš„ <code>for</code> å¾ªç¯ï¼ˆæ¨èï¼‰</h4><p>è¿™æ˜¯åå‘éå†å¹¶åˆ é™¤æœ€ç›´æ¥ã€æœ€å®‰å…¨ã€æœ€é«˜æ•ˆçš„æ–¹å¼ï¼Œå°¤å…¶é€‚ç”¨äº <code>ArrayList</code>ã€‚</p><p>Java</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">public class ReverseRemoveExample &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        List&lt;String&gt; list = new ArrayList&lt;&gt;();</span><br><span class="line">        list.add(&quot;a&quot;);</span><br><span class="line">        list.add(&quot;b&quot;);</span><br><span class="line">        list.add(&quot;c&quot;);</span><br><span class="line">        list.add(&quot;d&quot;);</span><br><span class="line"></span><br><span class="line">        // ä»åå¾€å‰éå†ï¼Œå¹¶åˆ é™¤å…ƒç´ </span><br><span class="line">        for (int i = list.size() - 1; i &gt;= 0; i--) &#123;</span><br><span class="line">            // å‡è®¾æˆ‘ä»¬è¦åˆ é™¤æ‰€æœ‰å…ƒç´ </span><br><span class="line">            list.remove(i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(&quot;åˆ é™¤åçš„åˆ—è¡¨: &quot; + list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-è¿­ä»£å™¨ï¼ˆIteratorï¼‰"><a href="#2-è¿­ä»£å™¨ï¼ˆIteratorï¼‰" class="headerlink" title="2. è¿­ä»£å™¨ï¼ˆIteratorï¼‰"></a>2. è¿­ä»£å™¨ï¼ˆIteratorï¼‰</h4><p>è™½ç„¶è¿­ä»£å™¨é€šå¸¸ç”¨äºæ­£å‘éå†ï¼Œä½†ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å®ƒæ¥ä»åå‘å‰éå†å¹¶åˆ é™¤ã€‚ä¸è¿‡ï¼Œè¿™ç§æ–¹å¼çš„å®ç°ç›¸å¯¹å¤æ‚ï¼Œå¹¶ä¸”å¯¹äº <code>LinkedList</code> ä¹‹å¤–çš„é›†åˆæ€§èƒ½å¹¶ä¸å¥½ã€‚å¯¹äº <code>ArrayList</code>ï¼Œå®ƒä»ç„¶éœ€è¦ä»æœ«å°¾å¼€å§‹éå†ï¼Œæ€§èƒ½ä¸å¦‚ä¼ ç»Ÿ <code>for</code> å¾ªç¯ã€‚</p><p><strong>æ³¨æ„</strong>ï¼š<code>ListIterator</code> æä¾›äº†åŒå‘éå†åŠŸèƒ½ï¼Œä½†å…¶ <code>previous()</code> æ–¹æ³•åœ¨ <code>Iterator</code> æ¥å£ä¸­å¹¶ä¸å­˜åœ¨ã€‚å› æ­¤ï¼Œåœ¨é€šç”¨æ€§ä¸Šï¼Œä¼ ç»Ÿ <code>for</code> å¾ªç¯ä¾ç„¶æ˜¯é¦–é€‰ã€‚</p><p>Java</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">// è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨ ListIterator çš„ä¾‹å­ï¼Œåªé€‚ç”¨äº List</span><br><span class="line">import java.util.LinkedList;</span><br><span class="line">import java.util.ListIterator;</span><br><span class="line"></span><br><span class="line">public class ListIteratorExample &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        List&lt;String&gt; list = new LinkedList&lt;&gt;();</span><br><span class="line">        list.add(&quot;a&quot;);</span><br><span class="line">        list.add(&quot;b&quot;);</span><br><span class="line">        list.add(&quot;c&quot;);</span><br><span class="line">        list.add(&quot;d&quot;);</span><br><span class="line"></span><br><span class="line">        // ä»åˆ—è¡¨æœ«å°¾è·å– ListIterator</span><br><span class="line">        ListIterator&lt;String&gt; it = list.listIterator(list.size());</span><br><span class="line">        </span><br><span class="line">        while (it.hasPrevious()) &#123;</span><br><span class="line">            String element = it.previous();</span><br><span class="line">            // å‡è®¾æˆ‘ä»¬åˆ é™¤å…ƒç´  &quot;b&quot; å’Œ &quot;c&quot;</span><br><span class="line">            if (element.equals(&quot;b&quot;) || element.equals(&quot;c&quot;)) &#123;</span><br><span class="line">                it.remove();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        System.out.println(&quot;åˆ é™¤åçš„åˆ—è¡¨: &quot; + list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“-7"><a href="#æ€»ç»“-7" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ul><li><strong>æ¨è</strong>ï¼šå¯¹äº <code>ArrayList</code> æˆ–ä»»ä½•åŸºäºæ•°ç»„çš„åˆ—è¡¨ï¼Œä½¿ç”¨<strong>ä¼ ç»Ÿçš„ for å¾ªç¯åå‘éå†</strong>æ˜¯æœ€ç®€å•ã€æœ€å®‰å…¨ã€æœ€é«˜æ•ˆçš„åˆ é™¤æ–¹å¼ã€‚</li><li><strong>é¿å…</strong>ï¼šé¿å…åœ¨æ­£å‘éå†æ—¶ç›´æ¥ä½¿ç”¨ <code>remove()</code> æ–¹æ³•ï¼Œå› ä¸ºå®ƒå¯èƒ½å¯¼è‡´è·³è¿‡å…ƒç´ æˆ–å¼•å‘ <code>ConcurrentModificationException</code>ã€‚</li><li><strong>é€šç”¨æ€§</strong>ï¼šå¦‚æœä½ éœ€è¦ç¼–å†™ä¸€ä¸ªé€šç”¨çš„åˆ é™¤æ–¹æ³•ï¼Œè€ƒè™‘åˆ°æ‰€æœ‰ <code>List</code> å®ç°ï¼Œé‚£ä¹ˆ <code>ListIterator</code> æ˜¯ä¸€ä¸ªé€‰æ‹©ï¼Œä½†å®ƒçš„åŒå‘éå†ç‰¹æ€§ä»…é™äº <code>List</code> æ¥å£ã€‚</li></ul><h2 id="å¤šçº¿ç¨‹ä¸‹çš„hashmapæ­»å¾ªç¯é—®é¢˜ï¼š"><a href="#å¤šçº¿ç¨‹ä¸‹çš„hashmapæ­»å¾ªç¯é—®é¢˜ï¼š" class="headerlink" title="å¤šçº¿ç¨‹ä¸‹çš„hashmapæ­»å¾ªç¯é—®é¢˜ï¼š"></a>å¤šçº¿ç¨‹ä¸‹çš„hashmapæ­»å¾ªç¯é—®é¢˜ï¼š</h2><p>å½“å¤šä¸ªçº¿ç¨‹åŒæ—¶å¯¹ä¸€ä¸ª <strong>HashMap</strong> è¿›è¡Œæ“ä½œæ—¶ï¼Œå°¤å…¶æ˜¯åœ¨æ¶‰åŠæ‰©å®¹ï¼ˆresizingï¼‰çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ­»å¾ªç¯ã€‚è¿™ä¸ªé—®é¢˜ä¸»è¦å‡ºç°åœ¨ Java 7 åŠä»¥å‰çš„ç‰ˆæœ¬ï¼Œç”±äºå…¶åº•å±‚æ•°æ®ç»“æ„å’Œæ‰©å®¹æœºåˆ¶çš„è®¾è®¡ç¼ºé™·ã€‚</p><hr><h3 id="HashMap-çš„æ­»å¾ªç¯é—®é¢˜"><a href="#HashMap-çš„æ­»å¾ªç¯é—®é¢˜" class="headerlink" title="HashMap çš„æ­»å¾ªç¯é—®é¢˜"></a>HashMap çš„æ­»å¾ªç¯é—®é¢˜</h3><p>åœ¨ Java 7 ä¸­ï¼Œ<code>HashMap</code> é‡‡ç”¨<strong>æ•°ç»„ + é“¾è¡¨</strong>çš„æ–¹å¼å­˜å‚¨æ•°æ®ã€‚å½“é“¾è¡¨ä¸Šçš„å…ƒç´ æ•°é‡è¿‡å¤šæ—¶ï¼Œä¸ºäº†æé«˜æ€§èƒ½ï¼Œ<code>HashMap</code> ä¼šè¿›è¡Œæ‰©å®¹ã€‚æ‰©å®¹çš„æ­¥éª¤å¤§è‡´å¦‚ä¸‹ï¼š</p><ol><li>åˆ›å»ºä¸€ä¸ªæ–°çš„ã€æ›´å¤§çš„æ•°ç»„ã€‚</li><li>éå†æ—§æ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚</li><li>å°†æ¯ä¸ªå…ƒç´ é‡æ–°è®¡ç®—å“ˆå¸Œå€¼ï¼Œå¹¶æ”¾å…¥æ–°æ•°ç»„çš„æ­£ç¡®ä½ç½®ã€‚</li></ol><p>é—®é¢˜å°±å‡ºåœ¨ç¬¬ä¸‰æ­¥ï¼š<strong>å°†é“¾è¡¨ä¸Šçš„å…ƒç´ ä»æ—§æ•°ç»„è½¬ç§»åˆ°æ–°æ•°ç»„æ—¶ï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶è¿›è¡Œæ­¤æ“ä½œï¼Œå°±å¯èƒ½å¯¼è‡´é“¾è¡¨ä¸­çš„èŠ‚ç‚¹é¡ºåºé¢ å€’ï¼Œå½¢æˆé—­ç¯ã€‚</strong></p><h4 id="æ‰©å®¹æ—¶çš„æ­»å¾ªç¯è¿‡ç¨‹"><a href="#æ‰©å®¹æ—¶çš„æ­»å¾ªç¯è¿‡ç¨‹" class="headerlink" title="æ‰©å®¹æ—¶çš„æ­»å¾ªç¯è¿‡ç¨‹"></a>æ‰©å®¹æ—¶çš„æ­»å¾ªç¯è¿‡ç¨‹</h4><p>å‡è®¾æœ‰ä¸¤ä¸ªçº¿ç¨‹ <strong>Thread1</strong> å’Œ <strong>Thread2</strong> åŒæ—¶å¯¹ä¸€ä¸ª <code>HashMap</code> è¿›è¡Œæ‰©å®¹ã€‚</p><ol><li><strong>åˆå§‹çŠ¶æ€</strong>ï¼š<code>HashMap</code> æ‰©å®¹å‰ï¼Œä¸€ä¸ªæ¡¶ä½ä¸Šæœ‰ä¸€ä¸ªé“¾è¡¨ï¼Œæ¯”å¦‚ <code>NodeA</code> -&gt; <code>NodeB</code>ã€‚</li><li><strong>Thread1 æ‰§è¡Œåˆ°ä¸€åŠ</strong>ï¼š<code>Thread1</code> éå†åˆ° <code>NodeA</code>ï¼Œå‡†å¤‡å°†å…¶ç§»åŠ¨åˆ°æ–°æ•°ç»„ã€‚æ­¤æ—¶ <code>Thread1</code> è¢«æŒ‚èµ·ã€‚<code>NodeA</code> çš„ <code>next</code> å¼•ç”¨ä»ç„¶æŒ‡å‘ <code>NodeB</code>ã€‚</li><li><strong>Thread2 å¼€å§‹æ‰§è¡Œ</strong>ï¼š<code>Thread2</code> å®Œæ•´åœ°å®Œæˆäº†æ‰©å®¹è¿‡ç¨‹ã€‚å®ƒå°†é“¾è¡¨ <code>NodeA</code> -&gt; <code>NodeB</code> è½¬ç§»åˆ°äº†æ–°æ•°ç»„ã€‚ä½†ç”±äºæ˜¯å•çº¿ç¨‹æ“ä½œï¼Œè½¬ç§»åé“¾è¡¨é¡ºåºä¿æŒä¸å˜ï¼Œä»æ˜¯ <code>NodeA</code> -&gt; <code>NodeB</code>ã€‚</li><li><strong>Thread1 æ¢å¤æ‰§è¡Œ</strong>ï¼š<code>Thread1</code> æ¢å¤æ‰§è¡Œï¼Œä½†å®ƒä¸çŸ¥é“ <code>Thread2</code> å·²ç»å®Œæˆäº†æ‰©å®¹ã€‚å®ƒä»ç„¶ä½¿ç”¨æ—§çš„ <code>next</code> å¼•ç”¨ä¿¡æ¯ã€‚<ul><li><code>Thread1</code> å–å‡º <code>NodeA</code>ï¼Œå°†å…¶æ”¾å…¥æ–°æ•°ç»„ã€‚</li><li><code>Thread1</code> æ¥ç€å¤„ç† <code>NodeB</code>ï¼ˆå› ä¸ºåœ¨ <code>Thread1</code> çš„è§†è§’ï¼Œ<code>NodeA</code> çš„ <code>next</code> è¿˜æ˜¯ <code>NodeB</code>ï¼‰ã€‚å®ƒå°† <code>NodeB</code> æ”¾å…¥æ–°æ•°ç»„ã€‚æ­¤æ—¶ï¼Œ<strong>ç”±äºå“ˆå¸Œå†²çªï¼ŒNodeB è¢«æ”¾åœ¨äº† NodeA çš„å‰é¢ï¼Œå¯¼è‡´é“¾è¡¨å˜æˆäº† NodeB -&gt; NodeAã€‚</strong></li><li><code>NodeA</code> çš„ <code>next</code> å¼•ç”¨ï¼ˆåœ¨ <code>Thread1</code> çš„è§†è§’ï¼‰ä»ç„¶æŒ‡å‘ <code>NodeB</code>ã€‚ç°åœ¨ï¼Œ<code>NodeB</code> çš„ <code>next</code> æŒ‡å‘ <code>NodeA</code>ï¼Œè€Œ <code>NodeA</code> çš„ <code>next</code> æŒ‡å‘ <code>NodeB</code>ï¼Œ<strong>å½¢æˆäº†ä¸€ä¸ªé—­ç¯</strong>ã€‚</li></ul></li></ol><p>å½“åç»­çº¿ç¨‹åœ¨è¿™ä¸ªé—­ç¯é“¾è¡¨ä¸Šè¿›è¡ŒæŸ¥æ‰¾æ—¶ï¼Œå°±ä¼šé™·å…¥æ— é™å¾ªç¯ï¼Œå¯¼è‡´ CPU 100% å ç”¨ã€‚</p><hr><h3 id="å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ"><a href="#å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ" class="headerlink" title="å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ"></a>å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ</h3><p>Java æä¾›äº†å¤šç§çº¿ç¨‹å®‰å…¨çš„æ›¿ä»£æ–¹æ¡ˆæ¥è§£å†³ <code>HashMap</code> çš„å¤šçº¿ç¨‹é—®é¢˜ï¼š</p><ol><li><strong>Collections.synchronizedMap()</strong>ï¼š<ul><li>è¿™ä¸ªæ–¹æ³•å¯ä»¥åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ <code>Map</code> åŒ…è£…å™¨ã€‚</li><li>å®ƒé€šè¿‡åœ¨æ¯ä¸ªæ–¹æ³•è°ƒç”¨ä¸ŠåŠ é”æ¥å®ç°çº¿ç¨‹å®‰å…¨ã€‚</li><li><strong>ä¼˜ç‚¹</strong>ï¼šç®€å•æ˜“ç”¨ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šæ¯æ¬¡è®¿é—®éƒ½éœ€è¦åŠ é”ï¼Œå¹¶å‘æ€§èƒ½è¾ƒå·®ã€‚</li></ul></li><li><strong>Hashtable</strong>ï¼š<ul><li>ä¸€ä¸ªæ—©æœŸçš„çº¿ç¨‹å®‰å…¨ <code>Map</code> å®ç°ï¼Œæ‰€æœ‰å…¬å…±æ–¹æ³•éƒ½ç”¨ <code>synchronized</code> ä¿®é¥°ã€‚</li><li><strong>ä¼˜ç‚¹</strong>ï¼šçº¿ç¨‹å®‰å…¨ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šæ€§èƒ½å·®ï¼Œå‡ ä¹æ‰€æœ‰æ“ä½œéƒ½é”ä½æ•´ä¸ªè¡¨ï¼Œå·²è¢« <code>ConcurrentHashMap</code> å–ä»£ã€‚</li></ul></li><li><strong>ConcurrentHashMap</strong>ï¼š<ul><li>è¿™æ˜¯ <strong>Java æ¨èçš„çº¿ç¨‹å®‰å…¨ Map å®ç°</strong>ã€‚</li><li>åœ¨ Java 7 ä¸­ï¼Œå®ƒä½¿ç”¨äº†<strong>åˆ†æ®µé”ï¼ˆSegment Lockï¼‰</strong>ï¼Œå°†æ•°æ®åˆ†æˆå¤šä¸ªæ®µï¼Œæ¯ä¸ªæ®µç‹¬ç«‹åŠ é”ã€‚</li><li>åœ¨ Java 8 ä¸­ï¼Œå®ƒè¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œé‡‡ç”¨**CASï¼ˆCompare-And-Swapï¼‰**å’Œ <strong>synchronized</strong> å…³é”®å­—ï¼Œé”çš„ç²’åº¦æ›´ç»†ï¼Œåªé”ä½å½“å‰æ“ä½œçš„æ¡¶ï¼Œä»è€Œå¤§å¤§æé«˜äº†å¹¶å‘æ€§èƒ½ã€‚</li></ul></li></ol><p>å› æ­¤ï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œ<strong>æ°¸è¿œä¸è¦ä½¿ç”¨ HashMap</strong>ã€‚ä½ åº”è¯¥æ ¹æ®éœ€æ±‚ï¼Œé€‰æ‹© <code>ConcurrentHashMap</code> æˆ– <code>Collections.synchronizedMap()</code> æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</p><h2 id="é›†åˆæ‰©å±•ï¼š"><a href="#é›†åˆæ‰©å±•ï¼š" class="headerlink" title="é›†åˆæ‰©å±•ï¼š"></a>é›†åˆæ‰©å±•ï¼š</h2><h3 id="12-HashMap-çš„-get-æ–¹æ³•èƒ½å¦åˆ¤æ–­æŸä¸ªå…ƒç´ æ˜¯å¦åœ¨-map-ä¸­ï¼Ÿ"><a href="#12-HashMap-çš„-get-æ–¹æ³•èƒ½å¦åˆ¤æ–­æŸä¸ªå…ƒç´ æ˜¯å¦åœ¨-map-ä¸­ï¼Ÿ" class="headerlink" title="12. HashMap çš„ get æ–¹æ³•èƒ½å¦åˆ¤æ–­æŸä¸ªå…ƒç´ æ˜¯å¦åœ¨ map ä¸­ï¼Ÿ"></a>12. HashMap çš„ get æ–¹æ³•èƒ½å¦åˆ¤æ–­æŸä¸ªå…ƒç´ æ˜¯å¦åœ¨ map ä¸­ï¼Ÿ</h3><p><code>HashMap</code> çš„ <code>get</code> å‡½æ•°çš„è¿”å›å€¼ä¸èƒ½åˆ¤æ–­ä¸€ä¸ª <code>key</code> æ˜¯å¦åŒ…å«åœ¨ <code>map</code> ä¸­ï¼Œå› ä¸º <code>get</code> è¿”å› <code>null</code> æœ‰å¯èƒ½æ˜¯ä¸åŒ…å«è¯¥ <code>key</code>ï¼Œä¹Ÿæœ‰å¯èƒ½è¯¥ <code>key</code> å¯¹åº”çš„ <code>value</code> ä¸º <code>null</code>ã€‚å› ä¸º <code>HashMap</code> ä¸­å…è®¸ <code>key</code> ä¸º <code>null</code>ï¼Œä¹Ÿå…è®¸ <code>value</code> ä¸º <code>null</code>ã€‚</p><hr><h3 id="13-HashMap-ä¸-HashTable-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#13-HashMap-ä¸-HashTable-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="13. HashMap ä¸ HashTable çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"></a>13. HashMap ä¸ HashTable çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h3><ol><li><code>HashTable</code> åŸºäº <code>Dictionary</code> ç±»ï¼Œè€Œ <code>HashMap</code> æ˜¯åŸºäº <code>AbstractMap</code>ã€‚<code>Dictionary</code> æ˜¯ä»»ä½•å¯å°†é”®æ˜ å°„åˆ°ç›¸åº”å€¼çš„ç±»çš„æŠ½è±¡çˆ¶ç±»ï¼Œè€Œ <code>AbstractMap</code> æ˜¯åŸºäº <code>Map</code> æ¥å£çš„å®ç°ï¼Œå®ƒä»¥æœ€å¤§é™åº¦åœ°å‡å°‘å®ç°æ­¤æ¥å£æ‰€éœ€çš„å·¥ä½œã€‚</li><li><code>HashMap</code> çš„ <code>key</code> å’Œ <code>value</code> éƒ½å…è®¸ä¸º <code>null</code>ï¼Œè€Œ <code>Hashtable</code> çš„ <code>key</code> å’Œ <code>value</code> éƒ½ä¸å…è®¸ä¸º <code>null</code>ã€‚<code>HashMap</code> é‡åˆ° <code>key</code> ä¸º <code>null</code> çš„æ—¶å€™ï¼Œè°ƒç”¨ <code>putForNullKey</code> æ–¹æ³•è¿›è¡Œå¤„ç†ï¼Œè€Œå¯¹ <code>value</code> æ²¡æœ‰å¤„ç†ï¼›<code>Hashtable</code> é‡åˆ° <code>null</code>ï¼Œç›´æ¥è¿”å› <code>NullPointerException</code>ã€‚</li><li><code>Hashtable</code> æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè€Œ <code>HashMap</code> ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ <code>Collections.synchronizedMap(hashMap)</code>ï¼Œä½¿å…¶å®ç°åŒæ­¥ã€‚</li></ol><p>HashTable çš„è¡¥å……ï¼š</p><p>HashTable å’Œ HashMap çš„å®ç°åŸç†å‡ ä¹ä¸€æ ·ï¼Œå·®åˆ«æ— éæ˜¯ï¼š</p><ol><li><code>HashTable</code> ä¸å…è®¸ <code>key</code> å’Œ <code>value</code> ä¸º <code>null</code>ï¼›</li><li><code>HashTable</code> æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä½†æ˜¯ <code>HashTable</code> çº¿ç¨‹å®‰å…¨çš„ç­–ç•¥å®ç°ä»£ä»·å´å¤ªå¤§äº†ï¼Œç®€å•ç²—æš´ï¼Œ<code>get/put</code> æ‰€æœ‰ç›¸å…³æ“ä½œéƒ½æ˜¯ <code>synchronized</code> çš„ï¼Œè¿™ç›¸å½“äºç»™æ•´ä¸ªå“ˆå¸Œè¡¨åŠ äº†ä¸€æŠŠå¤§é”ï¼Œå¤šçº¿ç¨‹è®¿é—®æ—¶å€™ï¼Œåªè¦æœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®æˆ–æ“ä½œè¯¥å¯¹è±¡ï¼Œé‚£å…¶ä»–çº¿ç¨‹åªèƒ½é˜»å¡ï¼Œç›¸å½“äºå°†æ‰€æœ‰çš„æ“ä½œä¸²è¡ŒåŒ–ï¼Œåœ¨ç«äº‰æ¿€çƒˆçš„å¹¶å‘åœºæ™¯ä¸­æ€§èƒ½å°±ä¼šéå¸¸å·®ã€‚</li></ol><hr><h3 id="14-HashMap-ä¸-ConcurrentHashMap-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ"><a href="#14-HashMap-ä¸-ConcurrentHashMap-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ" class="headerlink" title="14. HashMap ä¸ ConcurrentHashMap çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ?"></a>14. HashMap ä¸ ConcurrentHashMap çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ?</h3><p><code>HashMap</code> ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè€Œ <code>ConcurrentHashMap</code> æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p><p><code>ConcurrentHashMap</code> é‡‡ç”¨é”åˆ†æ®µæŠ€æœ¯ï¼Œå°†æ•´ä¸ªHashæ¡¶è¿›è¡Œäº†åˆ†æ®µsegmentï¼Œä¹Ÿå°±æ˜¯å°†è¿™ä¸ªå¤§çš„æ•°ç»„åˆ†æˆäº†å‡ ä¸ªå°çš„ç‰‡æ®µ <code>segment</code>ï¼Œè€Œä¸”æ¯ä¸ªå°çš„ç‰‡æ®µ <code>segment</code> ä¸Šé¢éƒ½æœ‰é”å­˜åœ¨ï¼Œé‚£ä¹ˆåœ¨æ’å…¥å…ƒç´ çš„æ—¶å€™å°±éœ€è¦å…ˆæ‰¾åˆ°åº”è¯¥æ’å…¥åˆ°å“ªä¸€ä¸ªç‰‡æ®µ <code>segment</code>ï¼Œç„¶åå†åœ¨è¿™ä¸ªç‰‡æ®µä¸Šé¢è¿›è¡Œæ’å…¥ï¼Œè€Œä¸”è¿™é‡Œè¿˜éœ€è¦è·å– <code>segment</code> é”ï¼Œè¿™æ ·åšæ˜æ˜¾å‡å°äº†é”çš„ç²’åº¦ã€‚</p><hr><h3 id="15-HashTable-å’Œ-ConcurrentHashMap-çš„åŒºåˆ«ï¼Ÿ"><a href="#15-HashTable-å’Œ-ConcurrentHashMap-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="15. HashTable å’Œ ConcurrentHashMap çš„åŒºåˆ«ï¼Ÿ"></a>15. HashTable å’Œ ConcurrentHashMap çš„åŒºåˆ«ï¼Ÿ</h3><p><code>HashTable</code> å’Œ <code>ConcurrentHashMap</code> ç›¸æ¯”ï¼Œæ•ˆç‡ä½ã€‚ <code>Hashtable</code> ä¹‹æ‰€ä»¥æ•ˆç‡ä½ä¸»è¦æ˜¯ä½¿ç”¨äº† <code>synchronized</code> å…³é”®å­—å¯¹ <code>put</code> ç­‰æ“ä½œè¿›è¡ŒåŠ é”ï¼Œè€Œ <code>synchronized</code> å…³é”®å­—åŠ é”æ˜¯å¯¹æ•´å¼  Hash è¡¨çš„ï¼Œå³æ¯æ¬¡é”ä½æ•´å¼ è¡¨è®©çº¿ç¨‹ç‹¬å ï¼Œè‡´ä½¿æ•ˆç‡ä½ä¸‹ï¼Œè€Œ <code>ConcurrentHashMap</code> åœ¨å¯¹è±¡ä¸­ä¿å­˜äº†ä¸€ä¸ª <code>Segment</code> æ•°ç»„ï¼Œå³å°†æ•´ä¸ª Hash è¡¨åˆ’åˆ†ä¸ºå¤šä¸ªåˆ†æ®µï¼›è€Œæ¯ä¸ª<code>Segment</code>å…ƒç´ ï¼Œå³æ¯ä¸ªåˆ†æ®µåˆ™ç±»ä¼¼äºä¸€ä¸ª<code>Hashtable</code>ï¼›è¿™æ ·ï¼Œåœ¨æ‰§è¡Œ <code>put</code> æ“ä½œæ—¶é¦–å…ˆæ ¹æ® hash ç®—æ³•å®šä½åˆ°å…ƒç´ å±äºå“ªä¸ª <code>Segment</code>ï¼Œç„¶åå¯¹è¯¥ <code>Segment</code> åŠ é”å³å¯ï¼Œå› æ­¤ï¼Œ<code>ConcurrentHashMap</code> åœ¨å¤šçº¿ç¨‹å¹¶å‘ç¼–ç¨‹ä¸­å¯æ˜¯å®ç°å¤šçº¿ç¨‹ <code>put</code>æ“ä½œã€‚</p><hr><h3 id="16-ConcurrentHashMap-çš„å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#16-ConcurrentHashMap-çš„å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="16. ConcurrentHashMap çš„å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"></a>16. ConcurrentHashMap çš„å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p><strong>æ•°æ®ç»“æ„</strong></p><ul><li><strong>JDK 7</strong>ï¼šä¸­ <code>ConcurrentHashMap</code> é‡‡ç”¨äº†<strong>æ•°ç»„ + Segment + åˆ†æ®µé”</strong>çš„æ–¹å¼å®ç°ã€‚</li><li><strong>JDK 8</strong>ï¼šä¸­ <code>ConcurrentHashMap</code> å‚è€ƒäº† JDK 8 <code>HashMap</code> çš„å®ç°ï¼Œé‡‡ç”¨äº†<strong>æ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘</strong>çš„å®ç°æ–¹å¼æ¥è®¾è®¡ï¼Œå†…éƒ¨å¤§é‡é‡‡ç”¨ <code>CAS</code> æ“ä½œã€‚</li></ul><p>ConcurrentHashMap é‡‡ç”¨äº†éå¸¸ç²¾å¦™çš„â€åˆ†æ®µé”â€ç­–ç•¥ï¼ŒConcurrentHashMap çš„ä¸»å¹²æ˜¯ä¸ª Segment æ•°ç»„ã€‚</p><p>final Segment[] segments;</p><p>Segment ç»§æ‰¿äº† ReentrantLockï¼Œæ‰€ä»¥å®ƒå°±æ˜¯ä¸€ç§å¯é‡å…¥é”ï¼ˆReentrantLockï¼‰ã€‚åœ¨ ConcurrentHashMapï¼Œä¸€ä¸ª Segment å°±æ˜¯ä¸€ä¸ªå­å“ˆå¸Œè¡¨ï¼ŒSegment é‡Œç»´æŠ¤äº†ä¸€ä¸ª HashEntry æ•°ç»„ï¼Œå¹¶å‘ç¯å¢ƒä¸‹ï¼Œå¯¹äºä¸åŒ Segment çš„æ•°æ®è¿›è¡Œæ“ä½œæ˜¯ä¸ç”¨è€ƒè™‘é”ç«äº‰çš„ã€‚å°±æŒ‰é»˜è®¤çš„ ConcurrentLevel ä¸º 16 æ¥è®²ï¼Œç†è®ºä¸Šå°±å…è®¸ 16 ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œã€‚æ‰€ä»¥ï¼Œå¯¹äºåŒä¸€ä¸ª Segment çš„æ“ä½œæ‰éœ€è€ƒè™‘çº¿ç¨‹åŒæ­¥ï¼Œä¸åŒçš„ Segment åˆ™æ— éœ€è€ƒè™‘ã€‚Segment ç±»ä¼¼äº HashMapï¼Œä¸€ä¸ª Segment ç»´æŠ¤ç€ä¸€ä¸ªHashEntry æ•°ç»„ï¼š</p><p>transient volatile HashEntry[] table;</p><p>HashEntry æ˜¯ç›®å‰æˆ‘ä»¬æåˆ°çš„æœ€å°çš„é€»è¾‘å¤„ç†å•å…ƒäº†ã€‚ä¸€ä¸ª ConcurrentHashMap ç»´æŠ¤ä¸€ä¸ª Segment æ•°ç»„ï¼Œä¸€ä¸ª Segment ç»´æŠ¤ä¸€ä¸ª HashEntry æ•°ç»„ã€‚å› æ­¤ï¼ŒConcurrentHashMap å®šä½ä¸€ä¸ªå…ƒç´ çš„è¿‡ç¨‹éœ€è¦è¿›è¡Œä¸¤æ¬¡ Hash æ“ä½œã€‚ç¬¬ä¸€æ¬¡ Hash å®šä½åˆ° Segmentï¼Œç¬¬äºŒæ¬¡ Hash å®šä½åˆ°å…ƒç´ æ‰€åœ¨çš„é“¾è¡¨çš„å¤´éƒ¨ã€‚</p><hr><h3 id="17-HashSet-çš„å®ç°åŸç†ï¼Ÿ"><a href="#17-HashSet-çš„å®ç°åŸç†ï¼Ÿ" class="headerlink" title="17. HashSet çš„å®ç°åŸç†ï¼Ÿ"></a>17. HashSet çš„å®ç°åŸç†ï¼Ÿ</h3><p><code>HashSet</code> çš„å®ç°æ˜¯ä¾èµ–äº <code>HashMap</code> çš„ï¼Œ<code>HashSet</code> çš„å€¼éƒ½æ˜¯å­˜å‚¨åœ¨ <code>HashMap</code> ä¸­çš„ã€‚åœ¨ <code>HashSet</code> çš„æ„é€ æ³•ä¸­ä¼šåˆå§‹åŒ–ä¸€ä¸ª <code>HashMap</code> å¯¹è±¡ï¼Œ<code>HashSet</code> ä¸å…è®¸å€¼é‡å¤ã€‚å› æ­¤ï¼Œ<code>HashSet</code> çš„å€¼æ˜¯ä½œä¸º <code>HashMap</code> çš„ <code>key</code> å­˜å‚¨åœ¨ <code>HashMap</code> ä¸­çš„ï¼Œå½“å­˜å‚¨çš„å€¼å·²ç»å­˜åœ¨æ—¶è¿”å› <code>false</code>ã€‚</p><hr><h3 id="18-HashSet-æ€ä¹ˆä¿è¯å…ƒç´ ä¸é‡å¤çš„ï¼Ÿ"><a href="#18-HashSet-æ€ä¹ˆä¿è¯å…ƒç´ ä¸é‡å¤çš„ï¼Ÿ" class="headerlink" title="18. HashSet æ€ä¹ˆä¿è¯å…ƒç´ ä¸é‡å¤çš„ï¼Ÿ"></a>18. HashSet æ€ä¹ˆä¿è¯å…ƒç´ ä¸é‡å¤çš„ï¼Ÿ</h3><p><code>public boolean add(E e) &#123; return map.put(e, PRESENT)==null; &#125;</code></p><p>å…ƒç´ å€¼ä½œä¸ºçš„æ˜¯ <code>map</code> çš„ <code>key</code>ï¼Œ<code>map</code> çš„ <code>value</code> åˆ™æ˜¯ <code>PRESENT</code> å˜é‡ï¼Œè¿™ä¸ªå˜é‡åªä½œä¸ºæ”¾å…¥ <code>map</code> æ—¶çš„<code>ä¸€ä¸ªå ä½ç¬¦è€Œå­˜åœ¨ï¼Œæ‰€ä»¥æ²¡ä»€ä¹ˆå®é™…ç”¨å¤„ã€‚å…¶å®ï¼Œè¿™æ—¶å€™ç­”æ¡ˆå·²ç»å‡ºæ¥äº†ï¼š</code>HashMap<code>çš„</code>key<code>æ˜¯ä¸èƒ½é‡å¤çš„ï¼Œè€Œè¿™é‡Œ</code>HashSet<code>çš„å…ƒç´ åˆæ˜¯ä½œä¸ºäº†</code>map<code>çš„</code>key&#96;ï¼Œå½“ç„¶ä¹Ÿä¸èƒ½é‡å¤äº†ã€‚</p><hr><h3 id="19-LinkedHashMap-çš„å®ç°åŸç†"><a href="#19-LinkedHashMap-çš„å®ç°åŸç†" class="headerlink" title="19. LinkedHashMap çš„å®ç°åŸç†?"></a>19. LinkedHashMap çš„å®ç°åŸç†?</h3><p><code>LinkedHashMap</code> ä¹Ÿæ˜¯åŸºäº <code>HashMap</code> å®ç°çš„ï¼Œä¸åŒçš„æ˜¯å®ƒå®šä¹‰äº†ä¸€ä¸ª <code>Entry</code> <code>header</code>ï¼Œè¿™ä¸ª <code>header</code> ä¸æ˜¯æ”¾åœ¨ <code>Table</code> é‡Œï¼Œå®ƒæ˜¯é¢å¤–ç‹¬ç«‹å‡ºæ¥çš„ã€‚<code>LinkedHashMap</code> é€šè¿‡ç»§æ‰¿ <code>hashMap</code> ä¸­çš„ <code>Entry</code>ï¼Œå¹¶æ·»åŠ ä¸¤ä¸ªå±æ€§ <code>Entry before, after</code> å’Œ <code>header</code> ç»“åˆèµ·æ¥ç»„æˆä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œæ¥å®ç°æŒ‰æ’å…¥é¡ºåºæˆ–è®¿é—®é¡ºåºæ’åºã€‚</p><p><code>LinkedHashMap</code> å®šä¹‰äº†æ’åºæ¨¡å¼ <code>accessOrder</code>ï¼Œè¯¥å±æ€§ä¸º <code>boolean</code> å‹å˜é‡ï¼Œå¯¹äºè®¿é—®é¡ºåºï¼Œä¸º <code>true</code>ï¼›å¯¹äºæ’å…¥é¡ºåºï¼Œåˆ™ä¸º <code>false</code>ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸å¿…æŒ‡å®šæ’åºæ¨¡å¼ï¼Œå…¶è¿­ä»£é¡ºåºå³ä¸ºé»˜è®¤ä¸ºæ’å…¥é¡ºåºã€‚</p><hr><h3 id="20-Iterator-æ€ä¹ˆä½¿ç”¨ï¼Ÿæœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ"><a href="#20-Iterator-æ€ä¹ˆä½¿ç”¨ï¼Ÿæœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ" class="headerlink" title="20. Iterator æ€ä¹ˆä½¿ç”¨ï¼Ÿæœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ"></a>20. Iterator æ€ä¹ˆä½¿ç”¨ï¼Ÿæœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ</h3><p>è¿­ä»£å™¨æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒå¯ä»¥éå†å¹¶é€‰æ‹©åºåˆ—ä¸­çš„å¯¹è±¡ï¼Œè€Œå¼€å‘äººå‘˜ä¸éœ€è¦äº†è§£è¯¥åºåˆ—çš„åº•å±‚ç»“æ„ã€‚è¿­ä»£å™¨é€šå¸¸è¢«ç§°ä¸ºâ€œè½»é‡çº§â€å¯¹è±¡ï¼Œå› ä¸ºåˆ›å»ºå®ƒçš„ä»£ä»·å°ã€‚Java ä¸­çš„ <code>Iterator</code> åŠŸèƒ½æ¯”è¾ƒç®€å•ï¼Œå¹¶ä¸”åªèƒ½å•å‘ç§»åŠ¨ï¼š</p><ol><li>ä½¿ç”¨æ–¹æ³• <code>iterator()</code> è¦æ±‚å®¹å™¨è¿”å›ä¸€ä¸ª <code>Iterator</code>ã€‚ç¬¬ä¸€æ¬¡è°ƒç”¨ <code>Iterator</code> çš„ <code>next()</code> æ–¹æ³•æ—¶ï¼Œå®ƒè¿”å›åºåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚æ³¨æ„ï¼š<code>iterator()</code> æ–¹æ³•æ˜¯ <code>java.lang.Iterable</code> æ¥å£ï¼Œè¢« <code>Collection</code> ç»§æ‰¿ã€‚</li><li>ä½¿ç”¨ <code>next()</code> è·å¾—åºåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚</li><li>ä½¿ç”¨ <code>hasNext()</code> æ£€æŸ¥åºåˆ—ä¸­æ˜¯å¦è¿˜æœ‰å…ƒç´ ã€‚</li><li>ä½¿ç”¨ <code>remove()</code> å°†è¿­ä»£å™¨æ–°è¿”å›çš„å…ƒç´ åˆ é™¤ã€‚</li></ol><hr><h3 id="21-Iterator-å’Œ-ListIterator-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#21-Iterator-å’Œ-ListIterator-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="21. Iterator å’Œ ListIterator æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>21. Iterator å’Œ ListIterator æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><p><code>Iterator</code> å¯ç”¨æ¥éå† <code>Set</code> å’Œ <code>List</code> é›†åˆï¼Œä½†æ˜¯ <code>ListIterator</code> åªèƒ½ç”¨æ¥éå† <code>List</code>ã€‚<code>Iterator</code> å¯¹é›†åˆåªèƒ½æ˜¯å‰å‘éå†ï¼Œ<code>ListIterator</code> æ—¢å¯ä»¥å‰å‘ä¹Ÿå¯ä»¥åå‘ã€‚<code>ListIterator</code> å®ç°äº† <code>Iterator</code> æ¥å£ï¼Œå¹¶åŒ…å«å…¶ä»–çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ï¼šå¢åŠ å…ƒç´ ï¼Œæ›¿æ¢å…ƒç´ ï¼Œè·å–å‰ä¸€ä¸ªå’Œåä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•ç­‰ç­‰ã€‚</p><hr><h3 id="22-Iterator-å’Œ-Enumeration-æ¥å£çš„åŒºåˆ«ï¼Ÿ"><a href="#22-Iterator-å’Œ-Enumeration-æ¥å£çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="22. Iterator å’Œ Enumeration æ¥å£çš„åŒºåˆ«ï¼Ÿ"></a>22. Iterator å’Œ Enumeration æ¥å£çš„åŒºåˆ«ï¼Ÿ</h3><p>ä¸ <code>Enumeration</code> ç›¸æ¯”ï¼Œ<code>Iterator</code> æ›´åŠ å®‰å…¨ï¼Œå› ä¸ºå½“ä¸€ä¸ªé›†åˆæ­£åœ¨è¢«éå†çš„æ—¶å€™ï¼Œå®ƒä¼šé˜»æ­¢å…¶å®ƒçº¿ç¨‹å»ä¿®æ”¹é›†åˆã€‚å¦åˆ™ä¼šæŠ›å‡º <code>ConcurrentModificationException</code> å¼‚å¸¸ã€‚è¿™å…¶å®å°±æ˜¯ <code>fail-fast</code> æœºåˆ¶ã€‚å…·ä½“åŒºåˆ«æœ‰ä¸‰ç‚¹ï¼š</p><ol><li><code>Iterator</code> çš„æ–¹æ³•åæ¯” <code>Enumeration</code> æ›´ç§‘å­¦ï¼›</li><li><code>Iterator</code> æœ‰ <code>fail-fast</code> æœºåˆ¶ï¼Œæ¯” <code>Enumeration</code> æ›´å®‰å…¨ï¼›</li><li><code>Iterator</code> èƒ½å¤Ÿåˆ é™¤å…ƒç´ ï¼Œ<code>Enumeration</code> å¹¶ä¸èƒ½åˆ é™¤å…ƒç´ ã€‚</li></ol><hr><h3 id="23-fail-fast-ä¸-fail-safe-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#23-fail-fast-ä¸-fail-safe-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="23. fail-fast ä¸ fail-safe æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>23. fail-fast ä¸ fail-safe æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><p><code>Iterator</code> çš„ <code>fail-fast</code> å±æ€§ä¸å½“å‰çš„é›†åˆå…±åŒèµ·ä½œç”¨ï¼Œå› æ­¤å®ƒä¸ä¼šå—åˆ°é›†åˆä¸­ä»»ä½•æ”¹åŠ¨çš„å½±å“ã€‚<code>java.util</code> åŒ…ä¸­çš„æ‰€æœ‰é›†åˆç±»éƒ½è¢«è®¾è®¡ä¸º <code>fail-fast</code> çš„ï¼Œè€Œ <code>java.util.concurrent</code> ä¸­çš„é›†åˆç±»éƒ½ä¸º <code>fail-safe</code> çš„ã€‚å½“æ£€æµ‹åˆ°æ­£åœ¨éå†çš„é›†åˆçš„ç»“æ„è¢«æ”¹å˜æ—¶ï¼Œ<code>fail-fast</code> è¿­ä»£å™¨æŠ›å‡º <code>ConcurrentModificationException</code>ï¼Œè€Œ <code>fail-safe</code> è¿­ä»£å™¨ä»ä¸æŠ›å‡º <code>ConcurrentModificationException</code>ã€‚</p><hr><h3 id="24-Collection-å’Œ-Collections-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#24-Collection-å’Œ-Collections-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="24. Collection å’Œ Collections æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>24. Collection å’Œ Collections æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><ul><li><code>Collection</code>ï¼šæ˜¯æœ€åŸºæœ¬çš„é›†åˆæ¥å£ï¼Œä¸€ä¸ª <code>Collection</code> ä»£è¡¨ä¸€ç»„ <code>Object</code>ï¼Œå³ <code>Collection</code> çš„å…ƒç´ ã€‚å®ƒçš„ç›´æ¥ç»§æ‰¿æ¥å£æœ‰ <code>List</code>ï¼Œ<code>Set</code> å’Œ <code>Queue</code>ã€‚</li><li><code>Collections</code>ï¼šä¸å±äº Java çš„é›†åˆæ¡†æ¶çš„ï¼Œå®ƒæ˜¯é›†åˆç±»çš„ä¸€ä¸ªå·¥å…·ç±»&#x2F;å¸®åŠ©ç±»ã€‚æ­¤ç±»ä¸èƒ½è¢«å®ä¾‹åŒ–ï¼Œ æœåŠ¡äº Java çš„ <code>Collection</code> æ¡†æ¶ã€‚å®ƒåŒ…å«æœ‰å…³é›†åˆæ“ä½œçš„é™æ€å¤šæ€æ–¹æ³•ï¼Œå®ç°å¯¹å„ç§é›†åˆçš„æœç´¢ã€æ’åºã€çº¿ç¨‹å®‰å…¨ç­‰æ“ä½œã€‚</li></ul><h2 id="Java-IO-æµ"><a href="#Java-IO-æµ" class="headerlink" title="Java IO æµ"></a>Java IO æµ</h2><p>Java IO (Input&#x2F;Output) æµæ˜¯ç”¨äºå¤„ç†è®¡ç®—æœºä¸å¤–éƒ¨è®¾å¤‡ä¹‹é—´æ•°æ®ä¼ è¾“çš„æŠ½è±¡æ¦‚å¿µã€‚å®ƒå°†æ•°æ®æŠ½è±¡ä¸ºæµ (Stream)ï¼Œé€šè¿‡æµå¯ä»¥å®ç°æ•°æ®çš„è¾“å…¥å’Œè¾“å‡ºã€‚</p><h3 id="IO-æµçš„åˆ†ç±»"><a href="#IO-æµçš„åˆ†ç±»" class="headerlink" title="IO æµçš„åˆ†ç±»"></a>IO æµçš„åˆ†ç±»</h3><p>Java IO æµæ ¹æ®ä¸åŒçš„æ ‡å‡†æœ‰å¤šç§åˆ†ç±»æ–¹å¼ï¼š</p><ul><li>æŒ‰æ•°æ®ç±»å‹åˆ†ï¼š<ul><li>å­—èŠ‚æµï¼šå¤„ç†å­—èŠ‚æ•°æ®ï¼Œæ‰€æœ‰æ–‡ä»¶ç±»å‹ï¼ˆæ–‡æœ¬ã€å›¾ç‰‡ã€éŸ³è§†é¢‘ç­‰ï¼‰éƒ½å¯ä»¥ç”¨å­—èŠ‚æµå¤„ç†ã€‚<ul><li>æŠ½è±¡åŸºç±»ï¼šInputStreamï¼ˆè¾“å…¥æµï¼‰ã€OutputStreamï¼ˆè¾“å‡ºæµï¼‰ã€‚</li><li>å¸¸ç”¨å®ç°ï¼šFileInputStream&#x2F;FileOutputStreamï¼ˆæ–‡ä»¶æ“ä½œï¼‰ï¼ŒBufferedInputStream&#x2F;BufferedOutputStreamï¼ˆå¸¦ç¼“å†²ï¼‰ï¼ŒObjectInputStream&#x2F;ObjectOutputStreamï¼ˆå¯¹è±¡åºåˆ—åŒ–ï¼‰ï¼ŒByteArrayInputStream&#x2F;ByteArrayOutputStreamï¼ˆå†…å­˜æ“ä½œï¼‰ï¼ŒDataInputStream&#x2F;DataOutputStreamï¼ˆåŸºæœ¬æ•°æ®ç±»å‹æ“ä½œï¼‰ã€‚</li></ul></li><li>å­—ç¬¦æµï¼šå¤„ç†å­—ç¬¦æ•°æ®ï¼Œä¸“é—¨ç”¨äºå¤„ç†æ–‡æœ¬æ–‡ä»¶ã€‚<ul><li>æŠ½è±¡åŸºç±»ï¼šReaderï¼ˆè¾“å…¥æµï¼‰ã€Writerï¼ˆè¾“å‡ºæµï¼‰ã€‚</li><li>å¸¸ç”¨å®ç°ï¼šFileReader&#x2F;FileWriterï¼ˆæ–‡ä»¶æ“ä½œï¼‰ï¼ŒBufferedReader&#x2F;BufferedWriterï¼ˆå¸¦ç¼“å†²ï¼‰ï¼ŒInputStreamReader&#x2F;OutputStreamWriterï¼ˆå­—èŠ‚æµä¸å­—ç¬¦æµçš„è½¬æ¢ï¼‰ã€‚</li></ul></li></ul></li><li>æŒ‰æµå‘åˆ†ï¼š<ul><li>è¾“å…¥æµï¼šä»æ•°æ®æºè¯»å–æ•°æ®åˆ°ç¨‹åºä¸­ã€‚</li><li>è¾“å‡ºæµï¼šä»ç¨‹åºä¸­å†™å…¥æ•°æ®åˆ°ç›®çš„åœ°ã€‚</li></ul></li><li>æŒ‰åŠŸèƒ½åˆ†ï¼š<ul><li>èŠ‚ç‚¹æµï¼ˆæˆ–æºå¤´æµï¼‰ï¼šç›´æ¥ä¸æ•°æ®æºï¼ˆå¦‚æ–‡ä»¶ã€å†…å­˜ã€ç½‘ç»œè¿æ¥ï¼‰è¿æ¥çš„æµã€‚ä¾‹å¦‚FileInputStreamã€FileReaderã€‚</li><li>å¤„ç†æµï¼ˆæˆ–åŒ…è£…æµï¼‰ï¼šå¯¹å·²å­˜åœ¨çš„èŠ‚ç‚¹æµè¿›è¡ŒåŒ…è£…ï¼Œå¢åŠ æ–°çš„åŠŸèƒ½æˆ–æå‡æ€§èƒ½ã€‚ä¾‹å¦‚BufferedInputStreamã€BufferedReaderã€‚</li></ul></li></ul><p><img src="C:\Users\19501\AppData\Local\Temp\1755834271160.png" alt="1755834271160"></p><p><img src="C:\Users\19501\AppData\Local\Temp\1755834290356.png" alt="1755834290356"></p><h3 id="å¸¸ç”¨-IO-æ“ä½œ"><a href="#å¸¸ç”¨-IO-æ“ä½œ" class="headerlink" title="å¸¸ç”¨ IO æ“ä½œ"></a>å¸¸ç”¨ IO æ“ä½œ</h3><ul><li><p>æ–‡ä»¶è¯»å†™ï¼ˆå­—èŠ‚æµï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å†™å…¥æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">try</span> (<span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;output.txt&quot;</span>)) &#123;</span><br><span class="line">    fos.write(<span class="string">&quot;Hello, World!&quot;</span>.getBytes());</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯»å–æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">try</span> (<span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;output.txt&quot;</span>)) &#123;</span><br><span class="line">    <span class="type">int</span> data;</span><br><span class="line">    <span class="keyword">while</span> ((data = fis.read()) != -<span class="number">1</span>) &#123;</span><br><span class="line">        System.out.print((<span class="type">char</span>) data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>æ–‡ä»¶è¯»å†™ï¼ˆå­—ç¬¦æµï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å†™å…¥æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">try</span> (<span class="type">FileWriter</span> <span class="variable">fw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileWriter</span>(<span class="string">&quot;output_char.txt&quot;</span>)) &#123;</span><br><span class="line">    fw.write(<span class="string">&quot;ä½ å¥½ï¼Œä¸–ç•Œï¼&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯»å–æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">try</span> (<span class="type">FileReader</span> <span class="variable">fr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileReader</span>(<span class="string">&quot;output_char.txt&quot;</span>)) &#123;</span><br><span class="line">    <span class="type">int</span> data;</span><br><span class="line">    <span class="keyword">while</span> ((data = fr.read()) != -<span class="number">1</span>) &#123;</span><br><span class="line">        System.out.print((<span class="type">char</span>) data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ç¼“å†²æµ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨ç¼“å†²å­—èŠ‚æµå¤åˆ¶æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">try</span> (<span class="type">BufferedInputStream</span> <span class="variable">bis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;source.txt&quot;</span>));</span><br><span class="line">     <span class="type">BufferedOutputStream</span> <span class="variable">bos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;destination.txt&quot;</span>))) &#123;</span><br><span class="line">    <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">    <span class="type">int</span> bytesRead;</span><br><span class="line">    <span class="keyword">while</span> ((bytesRead = bis.read(buffer)) != -<span class="number">1</span>) &#123;</span><br><span class="line">        bos.write(buffer, <span class="number">0</span>, bytesRead);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å¯¹è±¡åºåˆ—åŒ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªå¯åºåˆ—åŒ–çš„ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>; <span class="comment">// åºåˆ—åŒ–ç‰ˆæœ¬UID</span></span><br><span class="line">    String name;</span><br><span class="line">    <span class="type">int</span> age;</span><br><span class="line">    <span class="keyword">transient</span> String password; <span class="comment">// transient å…³é”®å­—ä¿®é¥°çš„å­—æ®µä¸å‚ä¸åºåˆ—åŒ–</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(String name, <span class="type">int</span> age, String password)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">        <span class="built_in">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User(name=&quot;</span> + name + <span class="string">&quot;, age=&quot;</span> + age + <span class="string">&quot;, password=&quot;</span> + password + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åºåˆ—åŒ–</span></span><br><span class="line"><span class="keyword">try</span> (<span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;user.ser&quot;</span>))) &#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;Alice&quot;</span>, <span class="number">30</span>, <span class="string">&quot;123456&quot;</span>);</span><br><span class="line">    oos.writeObject(user);</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ååºåˆ—åŒ–</span></span><br><span class="line"><span class="keyword">try</span> (<span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;user.ser&quot;</span>))) &#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">deserializedUser</span> <span class="operator">=</span> (User) ois.readObject();</span><br><span class="line">    System.out.println(deserializedUser); <span class="comment">// password å­—æ®µå°†ä¸º null</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException | ClassNotFoundException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="NIO-New-Input-Output"><a href="#NIO-New-Input-Output" class="headerlink" title="NIO (New Input&#x2F;Output)"></a>NIO (New Input&#x2F;Output)</h3><p>Java NIO (New I&#x2F;O) æ˜¯åœ¨ JDK 1.4 ä¸­å¼•å…¥çš„ä¸€å¥—æ–°çš„ I&#x2F;O APIï¼Œå®ƒæä¾›äº†éé˜»å¡ I&#x2F;O çš„èƒ½åŠ›ï¼Œå¹¶å¼•å…¥äº†â€œé€šé“ (Channel)â€å’Œâ€œç¼“å†²åŒº (Buffer)â€çš„æ¦‚å¿µï¼Œä¸ä¼ ç»Ÿçš„åŸºäºæµ (Stream) çš„ I&#x2F;O ç›¸æ¯”ï¼ŒNIO æ›´åŠ é«˜æ•ˆã€‚</p><p><strong>æ ¸å¿ƒç»„ä»¶ï¼š</strong></p><ul><li>Channel (é€šé“): ç±»ä¼¼äºä¼ ç»Ÿ IO ä¸­çš„æµï¼Œä½†å¯ä»¥åŒå‘è¯»å†™ã€‚æ•°æ®æ€»æ˜¯é€šè¿‡é€šé“è¯»å…¥ç¼“å†²åŒºæˆ–ä»ç¼“å†²åŒºå†™å…¥é€šé“ã€‚<ul><li>å¸¸ç”¨å®ç°: FileChannel (æ–‡ä»¶), SocketChannel (TCP å®¢æˆ·ç«¯), ServerSocketChannel (TCP æœåŠ¡å™¨), DatagramChannel (UDP)ã€‚</li></ul></li><li>Buffer (ç¼“å†²åŒº): ç”¨äºå­˜å‚¨æ•°æ® (å­—èŠ‚æ•°ç»„)ï¼Œä¸é€šé“è¿›è¡Œäº¤äº’ã€‚æ‰€æœ‰æ•°æ®è¯»å†™éƒ½æ˜¯é€šè¿‡ç¼“å†²åŒºå®Œæˆçš„ã€‚ç¼“å†²åŒºæœ‰å¤šç§ç±»å‹ï¼Œå¦‚ ByteBufferã€CharBufferã€IntBuffer ç­‰ã€‚<ul><li>æ ¸å¿ƒå±æ€§ï¼š<ul><li>capacity: ç¼“å†²åŒºå¯å®¹çº³çš„æœ€å¤§æ•°æ®é‡ã€‚ä¸€æ—¦åˆ›å»ºï¼Œå®¹é‡ä¸å¯å˜ã€‚</li><li>limit: ç¼“å†²åŒºä¸­å¯è¯»æˆ–å¯å†™çš„ä¸Šé™ã€‚</li><li>position: ä¸‹ä¸€ä¸ªè¯»æˆ–å†™çš„ä½ç½®ã€‚</li><li>mark: æ ‡è®°å½“å‰ positionï¼Œå¯ä»¥é€šè¿‡ reset() æ¢å¤åˆ° mark çš„ä½ç½®ã€‚</li></ul></li><li>ä¸»è¦æ–¹æ³•ï¼š<ul><li>put(): å‘ç¼“å†²åŒºå†™å…¥æ•°æ®ã€‚</li><li>get(): ä»ç¼“å†²åŒºè¯»å–æ•°æ®ã€‚</li><li>flip(): å°†ç¼“å†²åŒºä»å†™æ¨¡å¼åˆ‡æ¢åˆ°è¯»æ¨¡å¼ã€‚limit ä¼šè®¾ç½®ä¸ºå½“å‰çš„ position, position ä¼šé‡ç½®ä¸º 0ã€‚</li><li>clear(): æ¸…ç©ºç¼“å†²åŒºï¼Œä¸ºæ–°çš„å†™å…¥åšå‡†å¤‡ã€‚position è®¾ä¸º 0, limit è®¾ä¸º capacityã€‚</li><li>compact(): å‹ç¼©ç¼“å†²åŒºï¼Œå°†æœªè¯»çš„æ•°æ®ç§»åˆ°ç¼“å†²åŒºå¼€å¤´ï¼Œposition è®¾ä¸ºæœªè¯»æ•°æ®æ•°é‡ï¼Œlimit è®¾ä¸º capacityã€‚</li><li>rewind(): å°† position è®¾ä¸º 0ï¼Œå¯ä»¥é‡å¤è¯»å–ç¼“å†²åŒºä¸­çš„æ•°æ®ã€‚</li></ul></li></ul></li><li>Selector (é€‰æ‹©å™¨): ç”¨äºç›‘å¬å¤šä¸ªé€šé“ä¸Šçš„äº‹ä»¶ (å¦‚è¿æ¥å°±ç»ªã€è¯»å°±ç»ªã€å†™å°±ç»ªç­‰)ã€‚ä¸€ä¸ªå•çº¿ç¨‹å¯ä»¥ç®¡ç†å¤šä¸ªé€šé“ï¼Œä»è€Œå®ç°éé˜»å¡ I&#x2F;Oã€‚</li></ul><p><strong>NIO ä¸ä¼ ç»Ÿ IO çš„åŒºåˆ«ï¼š</strong></p><ul><li>I&#x2F;O æ¨¡å¼:ä¼ ç»Ÿ IO æ˜¯é˜»å¡å¼ I&#x2F;O, NIO æ˜¯éé˜»å¡å¼ I&#x2F;Oã€‚</li><li>æµä¸ç¼“å†²åŒº:ä¼ ç»Ÿ IO åŸºäºæµ(å•å‘), NIO åŸºäºé€šé“å’Œç¼“å†²åŒº(åŒå‘)ã€‚</li><li>åŒæ­¥ä¸å¼‚æ­¥:ä¼ ç»Ÿ IO æ˜¯åŒæ­¥é˜»å¡çš„, NIO æ˜¯åŒæ­¥éé˜»å¡çš„(åœ¨å¤šè·¯å¤ç”¨æ¨¡å‹ä¸‹)ã€‚</li></ul><p><strong>NIO æ–‡ä»¶å¤åˆ¶ç¤ºä¾‹</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (<span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;source.txt&quot;</span>);</span><br><span class="line">     <span class="type">FileChannel</span> <span class="variable">inChannel</span> <span class="operator">=</span> fis.getChannel();</span><br><span class="line">     <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;destination_nio.txt&quot;</span>);</span><br><span class="line">     <span class="type">FileChannel</span> <span class="variable">outChannel</span> <span class="operator">=</span> fos.getChannel()) &#123;</span><br><span class="line">    <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line">    <span class="keyword">while</span> (inChannel.read(buffer) != -<span class="number">1</span>) &#123;</span><br><span class="line">        buffer.flip(); <span class="comment">// åˆ‡æ¢åˆ°è¯»æ¨¡å¼</span></span><br><span class="line">        outChannel.write(buffer); <span class="comment">// ä»ç¼“å†²åŒºå†™å…¥é€šé“</span></span><br><span class="line">        buffer.clear(); <span class="comment">// æ¸…ç©ºç¼“å†²åŒº, ä¸ºä¸‹æ¬¡å†™å…¥åšå‡†å¤‡</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="AIO-Asynchronous-Input-Output"><a href="#AIO-Asynchronous-Input-Output" class="headerlink" title="AIO (Asynchronous Input&#x2F;Output)"></a>AIO (Asynchronous Input&#x2F;Output)</h3><p>Java AIO (Asynchronous I&#x2F;O) æ˜¯åœ¨ JDK 7 ä¸­å¼•å…¥çš„ï¼Œä¹Ÿç§°ä¸º NIO 2.0ã€‚å®ƒæä¾›äº†çœŸæ­£çš„å¼‚æ­¥éé˜»å¡ I&#x2F;Oï¼Œé€šè¿‡å›è°ƒæœºåˆ¶æ¥å¤„ç† I&#x2F;O æ“ä½œçš„ç»“æœã€‚ä¸ NIO çš„åŒæ­¥éé˜»å¡ä¸åŒï¼ŒAIO åœ¨ I&#x2F;O æ“ä½œå®Œæˆåä¼šä¸»åŠ¨é€šçŸ¥åº”ç”¨ç¨‹åºã€‚</p><ul><li><p><strong>æ ¸å¿ƒæ¦‚å¿µ:</strong></p><ul><li>AsynchronousFileChannel:å¼‚æ­¥æ–‡ä»¶é€šé“ã€‚</li><li>AsynchronousSocketChannel:å¼‚æ­¥ Socket é€šé“ã€‚</li><li>AsynchronousServerSocketChannel:å¼‚æ­¥ Server Socket é€šé“ã€‚</li><li>CompletionHandler:å›è°ƒå¤„ç†å™¨æ¥å£ï¼Œå®šä¹‰äº† completed() (æ“ä½œæˆåŠŸ) å’Œ failed() (æ“ä½œå¤±è´¥) æ–¹æ³•ã€‚</li><li>Future:ä¹Ÿå¯ä»¥é€šè¿‡è¿”å› Future å¯¹è±¡æ¥è·å–å¼‚æ­¥æ“ä½œçš„ç»“æœã€‚</li></ul></li><li><p>**å·¥ä½œåŸç†:**å½“å‘èµ·ä¸€ä¸ª I&#x2F;O æ“ä½œæ—¶ï¼Œä¸å†éœ€è¦ç­‰å¾…æ“ä½œå®Œæˆï¼Œè€Œæ˜¯ç«‹å³è¿”å›ã€‚I&#x2F;O æ“ä½œç”±æ“ä½œç³»ç»Ÿåœ¨åå°å®Œæˆï¼Œå®Œæˆåé€šè¿‡å›è°ƒå‡½æ•°é€šçŸ¥åº”ç”¨ç¨‹åºã€‚</p></li><li><p><strong>AIO ä¼˜åŠ¿:</strong></p><ul><li>çœŸæ­£çš„å¼‚æ­¥éé˜»å¡:åº”ç”¨ç¨‹åºä¸éœ€è¦ç­‰å¾… I&#x2F;O æ“ä½œï¼Œå¯ä»¥å°† CPU èµ„æºç”¨äºå…¶ä»–ä»»åŠ¡ã€‚</li><li>æé«˜å¹¶å‘æ€§:ç‰¹åˆ«é€‚åˆé«˜å¹¶å‘ã€é•¿è¿æ¥çš„ç½‘ç»œåº”ç”¨ã€‚</li></ul></li><li><p><strong>AIO åŠ£åŠ¿:</strong></p><ul><li>å¤æ‚æ€§:ç¼–ç¨‹æ¨¡å‹ç›¸å¯¹äº NIO æ›´å¤æ‚ï¼Œéœ€è¦å¤„ç†å›è°ƒé€»è¾‘ã€‚</li><li>é€‚ç”¨åœºæ™¯:å¯¹äºè¿æ¥æ•°è¾ƒå¤šä¸”è¿æ¥æ—¶é—´é•¿çš„åº”ç”¨ï¼Œå¦‚èŠå¤©æœåŠ¡å™¨ï¼ŒAIO è¡¨ç°ä¼˜å¼‚ã€‚å¯¹äºçŸ­è¿æ¥ã€é«˜å¹¶å‘çš„åœºæ™¯ï¼ŒNIOï¼ˆåŸºäº Selectorï¼‰å¯èƒ½è¡¨ç°æ›´å¥½ã€‚</li></ul></li><li><p><strong>AIO è¯»æ–‡ä»¶ç¤ºä¾‹</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Path</span> <span class="variable">file</span> <span class="operator">=</span> Paths.get(<span class="string">&quot;async_read.txt&quot;</span>);</span><br><span class="line"><span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> (<span class="type">AsynchronousFileChannel</span> <span class="variable">fileChannel</span> <span class="operator">=</span> AsynchronousFileChannel.open(file, StandardOpenOption.READ)) &#123;</span><br><span class="line">    fileChannel.read(buffer, <span class="number">0</span>, buffer, <span class="keyword">new</span> <span class="title class_">CompletionHandler</span>&lt;Integer, ByteBuffer&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">completed</span><span class="params">(Integer result, ByteBuffer attachment)</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Read &quot;</span> + result + <span class="string">&quot; bytes.&quot;</span>);</span><br><span class="line">            attachment.flip();</span><br><span class="line">            <span class="type">byte</span>[] data = <span class="keyword">new</span> <span class="title class_">byte</span>[attachment.remaining()];</span><br><span class="line">            attachment.get(data);</span><br><span class="line">            System.out.println(<span class="string">&quot;Content: &quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(data));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">failed</span><span class="params">(Throwable exc, ByteBuffer attachment)</span> &#123;</span><br><span class="line">            System.err.println(<span class="string">&quot;Read failed: &quot;</span> + exc.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// ä¸ºäº†è®©ä¸»çº¿ç¨‹ä¸ç«‹å³é€€å‡ºï¼Œç­‰å¾…å¼‚æ­¥æ“ä½œå®Œæˆ</span></span><br><span class="line">    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException | InterruptedException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="1-Java-IO-æµçš„åˆ†ç±»ï¼Ÿè¯·è¯´å‡ºå‡ ä¸ªä½ ç†Ÿæ‚‰çš„å®ç°ç±»ã€‚"><a href="#1-Java-IO-æµçš„åˆ†ç±»ï¼Ÿè¯·è¯´å‡ºå‡ ä¸ªä½ ç†Ÿæ‚‰çš„å®ç°ç±»ã€‚" class="headerlink" title="1. Java IO æµçš„åˆ†ç±»ï¼Ÿè¯·è¯´å‡ºå‡ ä¸ªä½ ç†Ÿæ‚‰çš„å®ç°ç±»ã€‚"></a>1. Java IO æµçš„åˆ†ç±»ï¼Ÿè¯·è¯´å‡ºå‡ ä¸ªä½ ç†Ÿæ‚‰çš„å®ç°ç±»ã€‚</h3><p>Java IO æµæ ¹æ®ä¸åŒçš„æ ‡å‡†å¯ä»¥è¿›è¡Œåˆ†ç±»ï¼š</p><ul><li><strong>æŒ‰æ•°æ®æµå‘</strong>ï¼š<ul><li><strong>è¾“å…¥æµï¼ˆInputStream &#x2F; Readerï¼‰</strong>ï¼šä»å¤–éƒ¨æºï¼ˆå¦‚æ–‡ä»¶ã€ç½‘ç»œï¼‰è¯»å–æ•°æ®åˆ°ç¨‹åºä¸­ã€‚</li><li><strong>è¾“å‡ºæµï¼ˆOutputStream &#x2F; Writerï¼‰</strong>ï¼šå°†æ•°æ®ä»ç¨‹åºå†™å…¥åˆ°å¤–éƒ¨ç›®æ ‡ã€‚</li></ul></li><li><strong>æŒ‰æ•°æ®ç±»å‹</strong>ï¼š<ul><li><strong>å­—èŠ‚æµï¼ˆInputStream &#x2F; OutputStreamï¼‰</strong>ï¼šä»¥ 8 ä½å­—èŠ‚ä¸ºå•ä½å¤„ç†æ•°æ®ï¼Œé€‚ç”¨äºæ‰€æœ‰ç±»å‹çš„æ–‡ä»¶ï¼ŒåŒ…æ‹¬å›¾ç‰‡ã€è§†é¢‘ã€éŸ³é¢‘ç­‰äºŒè¿›åˆ¶æ–‡ä»¶ã€‚<ul><li><strong>å®ç°ç±»</strong>ï¼š<code>FileInputStream</code>, <code>FileOutputStream</code>, <code>BufferedInputStream</code>, <code>BufferedOutputStream</code>ã€‚</li></ul></li><li><strong>å­—ç¬¦æµï¼ˆReader &#x2F; Writerï¼‰</strong>ï¼šä»¥ 16 ä½å­—ç¬¦ä¸ºå•ä½å¤„ç†æ•°æ®ï¼Œé€‚ç”¨äºæ–‡æœ¬æ–‡ä»¶ï¼Œèƒ½å¤„ç†å„ç§å­—ç¬¦ç¼–ç ã€‚<ul><li><strong>å®ç°ç±»</strong>ï¼š<code>FileReader</code>, <code>FileWriter</code>, <code>BufferedReader</code>, <code>BufferedWriter</code>ã€‚</li></ul></li></ul></li></ul><h3 id="2-å­—èŠ‚æµå’Œå­—ç¬¦æµæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#2-å­—èŠ‚æµå’Œå­—ç¬¦æµæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="2. å­—èŠ‚æµå’Œå­—ç¬¦æµæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>2. å­—èŠ‚æµå’Œå­—ç¬¦æµæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><p>å­—èŠ‚æµå’Œå­—ç¬¦æµçš„ä¸»è¦åŒºåˆ«åœ¨äºå¤„ç†æ•°æ®çš„å•ä½å’Œé€‚ç”¨åœºæ™¯ï¼š</p><ul><li><strong>æ•°æ®å•ä½</strong>ï¼šå­—èŠ‚æµä»¥ 8 ä½å­—èŠ‚ä¸ºå•ä½è¿›è¡Œè¯»å†™ï¼Œè€Œå­—ç¬¦æµä»¥ 16 ä½å­—ç¬¦ä¸ºå•ä½ã€‚</li><li><strong>ç¼–ç è½¬æ¢</strong>ï¼šå­—ç¬¦æµæ˜¯å­—èŠ‚æµçš„å°è£…ï¼Œå®ƒåœ¨å†…éƒ¨å¤„ç†äº†å­—èŠ‚å’Œå­—ç¬¦ä¹‹é—´çš„ç¼–ç è½¬æ¢ã€‚å½“å¤„ç†æ–‡æœ¬æ–‡ä»¶æ—¶ï¼Œå­—ç¬¦æµå¯ä»¥æ ¹æ®æŒ‡å®šçš„å­—ç¬¦é›†ï¼ˆå¦‚ UTF-8ï¼‰è‡ªåŠ¨è¿›è¡Œç¼–ç å’Œè§£ç ï¼Œé¿å…äº†ä¹±ç é—®é¢˜ã€‚å­—èŠ‚æµä¸è¿›è¡Œç¼–ç è½¬æ¢ï¼Œç›´æ¥å¤„ç†åŸå§‹å­—èŠ‚ã€‚</li><li><strong>æœ€å°å­˜å‚¨å•å…ƒ</strong>ï¼šå°½ç®¡å­—ç¬¦æµä»¥å­—ç¬¦ä¸ºå•ä½ï¼Œä½†æ–‡ä»¶æˆ–ç½‘ç»œä¼ è¾“çš„æœ€å°å­˜å‚¨å•å…ƒä¾ç„¶æ˜¯å­—èŠ‚ã€‚å­—ç¬¦æµåœ¨åº•å±‚ä»ä¾èµ–äºå­—èŠ‚æµæ¥å®Œæˆæ•°æ®çš„ä¼ è¾“ã€‚</li><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š<ul><li><strong>å­—èŠ‚æµ</strong>ï¼šé€‚ç”¨äºæ‰€æœ‰æ–‡ä»¶ç±»å‹ï¼Œå°¤å…¶æ˜¯å¤„ç†<strong>éæ–‡æœ¬æ–‡ä»¶</strong>ï¼ˆå¦‚å›¾ç‰‡ã€è§†é¢‘ã€éŸ³é¢‘ç­‰ï¼‰ï¼Œå› ä¸ºè¿™äº›æ–‡ä»¶ä¸éœ€è¦è¿›è¡Œå­—ç¬¦ç¼–ç è½¬æ¢ã€‚</li><li><strong>å­—ç¬¦æµ</strong>ï¼šä¸“é—¨ç”¨äºå¤„ç†<strong>æ–‡æœ¬æ–‡ä»¶</strong>ï¼Œå¯ä»¥é¿å…æ‰‹åŠ¨å¤„ç†å­—ç¬¦ç¼–ç çš„å¤æ‚æ€§ã€‚</li></ul></li></ul><h3 id="3-BIOã€NIO-å’Œ-AIO-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#3-BIOã€NIO-å’Œ-AIO-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="3. BIOã€NIO å’Œ AIO æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>3. BIOã€NIO å’Œ AIO æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><p>è¿™æ˜¯ Java IO å‘å±•å†ç¨‹ä¸­çš„ä¸‰ç§ä¸åŒæ¨¡å‹ï¼Œä¸»è¦åŒºåˆ«åœ¨äºå¤„ç† IO æ“ä½œçš„æ–¹å¼ï¼ˆé˜»å¡&#x2F;éé˜»å¡ã€åŒæ­¥&#x2F;å¼‚æ­¥ï¼‰å’Œå¹¶å‘èƒ½åŠ›ã€‚</p><ul><li><strong>BIO (Blocking I&#x2F;O)</strong><ul><li><strong>ç‰¹ç‚¹</strong>ï¼š<strong>åŒæ­¥é˜»å¡</strong>ã€‚å½“ä¸€ä¸ªçº¿ç¨‹å‘èµ· IO æ“ä½œï¼ˆå¦‚ <code>read</code> æˆ– <code>accept</code>ï¼‰ï¼Œå®ƒä¼šä¸€ç›´é˜»å¡ï¼Œç›´åˆ°æ•°æ®è¯»å†™å®Œæˆæˆ–è¿æ¥å»ºç«‹ã€‚</li><li><strong>æ¨¡å‹</strong>ï¼šé‡‡ç”¨â€œä¸€å¯¹ä¸€â€çš„è¿æ¥æ¨¡å‹ï¼Œå³ä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥å¯¹åº”ä¸€ä¸ªå¤„ç†çº¿ç¨‹ã€‚</li><li><strong>ä¼˜ç‚¹</strong>ï¼šç¼–ç¨‹æ¨¡å‹ç®€å•ç›´è§‚ï¼Œé€‚ç”¨äºè¿æ¥æ•°è¾ƒå°‘ã€å¹¶å‘é‡ä¸é«˜çš„åœºæ™¯ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šåœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œæ¯ä¸ªè¿æ¥éƒ½éœ€è¦ä¸€ä¸ªçº¿ç¨‹ï¼Œä¼šæ¶ˆè€—å¤§é‡ç³»ç»Ÿèµ„æºï¼Œå¯¼è‡´æ€§èƒ½ç“¶é¢ˆã€‚</li></ul></li><li><strong>NIO (Non-blocking I&#x2F;O)</strong><ul><li><strong>ç‰¹ç‚¹</strong>ï¼š<strong>åŒæ­¥éé˜»å¡</strong>ã€‚ä¸€ä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªè¿æ¥ã€‚å½“çº¿ç¨‹å‘èµ· IO æ“ä½œæ—¶ï¼Œå¦‚æœæ•°æ®æ²¡æœ‰å‡†å¤‡å¥½ï¼Œå®ƒä¸ä¼šé˜»å¡ï¼Œè€Œæ˜¯ç«‹å³è¿”å›ï¼Œå»åšå…¶ä»–äº‹æƒ…ï¼Œç¨åå†æ¬¡æ£€æŸ¥ã€‚</li><li><strong>æ¨¡å‹</strong>ï¼šé‡‡ç”¨<strong>å¤šè·¯å¤ç”¨</strong>æ¨¡å‹ã€‚é€šè¿‡ä¸€ä¸ª <code>Selector</code>ï¼ˆé€‰æ‹©å™¨ï¼‰ï¼Œä¸€ä¸ªæˆ–å°‘æ•°å‡ ä¸ªçº¿ç¨‹å¯ä»¥ç›‘å¬å¤šä¸ª <code>Channel</code>ï¼ˆé€šé“ï¼‰ä¸Šçš„ IO äº‹ä»¶ï¼ˆå¦‚è¿æ¥å°±ç»ªã€æ•°æ®å¯è¯»ï¼‰ï¼Œä»è€Œé«˜æ•ˆåœ°å¤„ç†å¤§é‡å¹¶å‘è¿æ¥ã€‚</li><li><strong>ä¼˜ç‚¹</strong>ï¼šè§£å†³äº† BIO çš„é«˜å¹¶å‘é—®é¢˜ï¼Œå¤§å¤§æé«˜äº†ç³»ç»Ÿçš„ååé‡ï¼Œé€‚ç”¨äºé«˜å¹¶å‘çš„ç½‘ç»œåº”ç”¨ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šç¼–ç¨‹æ¨¡å‹ç›¸å¯¹å¤æ‚ã€‚å°½ç®¡ IO æ“ä½œæ˜¯éé˜»å¡çš„ï¼Œä½†æ•°æ®è¯»å†™æœ¬èº«ä»ç„¶æ˜¯åŒæ­¥çš„ï¼Œå³çº¿ç¨‹åœ¨è¿›è¡Œè¯»å†™æ—¶ä»éœ€ç­‰å¾…ã€‚</li></ul></li><li><strong>AIO (Asynchronous I&#x2F;O)</strong><ul><li><strong>ç‰¹ç‚¹</strong>ï¼š<strong>å¼‚æ­¥éé˜»å¡</strong>ã€‚åº”ç”¨ç¨‹åºå‘èµ· IO æ“ä½œåï¼Œä¼šç«‹å³è¿”å›ï¼Œè€Œä¸ä¼šç­‰å¾…æ•°æ®è¯»å†™ã€‚æ“ä½œç³»ç»Ÿä¼šåœ¨åå°å®Œæˆ IO æ“ä½œï¼Œå¹¶åœ¨å®Œæˆåé€šè¿‡<strong>å›è°ƒ</strong>æˆ–äº‹ä»¶é€šçŸ¥åº”ç”¨ç¨‹åºã€‚</li><li><strong>æ¨¡å‹</strong>ï¼šåŸºäº<strong>äº‹ä»¶å’Œå›è°ƒ</strong>æœºåˆ¶ã€‚</li><li><strong>ä¼˜ç‚¹</strong>ï¼šè¿›ä¸€æ­¥æé«˜äº†å¹¶å‘æ€§èƒ½ï¼Œå½»åº•é‡Šæ”¾äº†çº¿ç¨‹èµ„æºï¼Œé€‚ç”¨äºè¿æ¥æ•°å·¨å¤§ä¸”è¿æ¥æ—¶é—´é•¿çš„åº”ç”¨ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šç›®å‰åœ¨å®é™…åº”ç”¨ä¸­ï¼Œç‰¹åˆ«æ˜¯åœ¨ç½‘ç»œç¼–ç¨‹æ–¹é¢ï¼Œä½¿ç”¨ä¸å¦‚ NIO å¹¿æ³›ï¼Œå› ä¸ºå…¶å¤æ‚æ€§å’Œå¯¹æ“ä½œç³»ç»Ÿçš„ä¾èµ–æ€§è¾ƒé«˜ã€‚</li></ul></li></ul><h2 id="Java-åå°„-Reflection"><a href="#Java-åå°„-Reflection" class="headerlink" title="Java åå°„ (Reflection)"></a>Java åå°„ (Reflection)</h2><p>Java åå°„æœºåˆ¶æ˜¯æŒ‡åœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œèƒ½å¤ŸåŠ¨æ€åœ°è·å–ç±»çš„ä¿¡æ¯ï¼ˆåŒ…æ‹¬ç±»çš„å±æ€§ã€æ–¹æ³•ã€æ„é€ å™¨ç­‰ï¼‰ï¼Œå¹¶èƒ½å¤ŸåŠ¨æ€åœ°æ“ä½œç±»æˆ–å¯¹è±¡ï¼ˆå¦‚åˆ›å»ºå¯¹è±¡ã€è°ƒç”¨æ–¹æ³•ã€ä¿®æ”¹å±æ€§ï¼‰ã€‚</p><ul><li><p><strong>æ ¸å¿ƒç±»ä¸æ¥å£ï¼š</strong></p><ul><li>Class ç±»ï¼šä»£è¡¨ç±»çš„å­—èŠ‚ç æ–‡ä»¶ï¼Œæ˜¯åå°„çš„å…¥å£ã€‚</li><li>Constructor ç±»ï¼šä»£è¡¨ç±»çš„æ„é€ å™¨ã€‚</li><li>Method ç±»ï¼šä»£è¡¨ç±»çš„æ–¹æ³•ã€‚</li><li>Field ç±»ï¼šä»£è¡¨ç±»çš„æˆå‘˜å˜é‡ï¼ˆå±æ€§ï¼‰ã€‚</li><li>AccessibleObjectï¼šField, Method, Constructor çš„å…±åŒçˆ¶ç±»ï¼Œæä¾›äº† setAccessible(true) æ–¹æ³•ï¼Œç”¨äºæŠ‘åˆ¶ Java è¯­è¨€è®¿é—®æ£€æŸ¥ï¼Œä»è€Œè®¿é—®ç§æœ‰æˆå‘˜ã€‚</li></ul></li><li><p><strong>è·å– Class å¯¹è±¡çš„ä¸‰ç§æ–¹å¼ï¼š</strong></p><ol><li><p>Class.forName(â€œå…¨é™å®šç±»åâ€)ï¼šæœ€å¸¸ç”¨ï¼ŒåŠ¨æ€åŠ è½½ç±»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Class&lt;?&gt; clazz = Class.forName(<span class="string">&quot;java.lang.String&quot;</span>);</span><br></pre></td></tr></table></figure></li><li><p>ç±»å.classï¼šå·²çŸ¥å…·ä½“ç±»åæ—¶ä½¿ç”¨ï¼Œç¼–è¯‘æ—¶åŠ è½½ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Class&lt;?&gt; clazz = String.class;</span><br></pre></td></tr></table></figure></li><li><p>å¯¹è±¡.getClass()ï¼šé€šè¿‡å¯¹è±¡å®ä¾‹è·å–ï¼Œè¿è¡Œæ—¶è·å–ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">Class&lt;?&gt; clazz = s.getClass();</span><br></pre></td></tr></table></figure></li></ol></li><li><p><strong>åå°„çš„åº”ç”¨ï¼š</strong></p><ul><li><p>åŠ¨æ€åˆ›å»ºå¯¹è±¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Class&lt;?&gt; personClass = Class.forName(<span class="string">&quot;com.example.Person&quot;</span>);</span><br><span class="line"><span class="type">Object</span> <span class="variable">person</span> <span class="operator">=</span> personClass.newInstance(); <span class="comment">// è°ƒç”¨æ— å‚æ„é€ å™¨</span></span><br><span class="line"><span class="comment">// æˆ–è€…è°ƒç”¨æŒ‡å®šæ„é€ å™¨</span></span><br><span class="line">Constructor&lt;?&gt; constructor = personClass.getConstructor(String.class, <span class="type">int</span>.class);</span><br><span class="line"><span class="type">Object</span> <span class="variable">person2</span> <span class="operator">=</span> constructor.newInstance(<span class="string">&quot;Alice&quot;</span>, <span class="number">25</span>);</span><br></pre></td></tr></table></figure></li><li><p>åŠ¨æ€è°ƒç”¨æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Class&lt;?&gt; personClass = Class.forName(<span class="string">&quot;com.example.Person&quot;</span>);</span><br><span class="line"><span class="type">Object</span> <span class="variable">person</span> <span class="operator">=</span> personClass.newInstance();</span><br><span class="line"><span class="type">Method</span> <span class="variable">setNameMethod</span> <span class="operator">=</span> personClass.getMethod(<span class="string">&quot;setName&quot;</span>, String.class);</span><br><span class="line">setNameMethod.invoke(person, <span class="string">&quot;Bob&quot;</span>); <span class="comment">// è°ƒç”¨ setName æ–¹æ³•</span></span><br><span class="line"><span class="type">Method</span> <span class="variable">getNameMethod</span> <span class="operator">=</span> personClass.getMethod(<span class="string">&quot;getName&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> (String) getNameMethod.invoke(person); <span class="comment">// è°ƒç”¨ getName æ–¹æ³•</span></span><br></pre></td></tr></table></figure></li><li><p>åŠ¨æ€æ“ä½œå±æ€§ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Class&lt;?&gt; personClass = Class.forName(<span class="string">&quot;com.example.Person&quot;</span>);</span><br><span class="line"><span class="type">Object</span> <span class="variable">person</span> <span class="operator">=</span> personClass.newInstance();</span><br><span class="line"><span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> personClass.getDeclaredField(<span class="string">&quot;name&quot;</span>); <span class="comment">// è·å–ç§æœ‰å±æ€§</span></span><br><span class="line">nameField.setAccessible(<span class="literal">true</span>); <span class="comment">// å…è®¸è®¿é—®ç§æœ‰å±æ€§</span></span><br><span class="line">nameField.set(person, <span class="string">&quot;Charlie&quot;</span>); <span class="comment">// è®¾ç½®å±æ€§å€¼</span></span><br><span class="line"><span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> (String) nameField.get(person); <span class="comment">// è·å–å±æ€§å€¼</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>åå°„çš„ä¼˜ç¼ºç‚¹ï¼š</strong></p><ul><li>ä¼˜ç‚¹ï¼š<ul><li>çµæ´»æ€§å’ŒåŠ¨æ€æ€§:åœ¨è¿è¡Œæ—¶åŠ¨æ€è·å–ç±»ä¿¡æ¯å’Œæ“ä½œå¯¹è±¡,å¤§å¤§å¢å¼ºäº†ç¨‹åºçš„çµæ´»æ€§,æ˜¯è®¸å¤šæ¡†æ¶(å¦‚Springã€ORMæ¡†æ¶)å’Œå·¥å…·(å¦‚JSONè§£æåº“)çš„åŸºç¡€ã€‚</li><li>è§£è€¦:å…è®¸ä»£ç åœ¨ç¼–è¯‘æ—¶ä¸çŸ¥é“å…·ä½“çš„ç±»,åªåœ¨è¿è¡Œæ—¶åŠ è½½å’Œä½¿ç”¨,å®ç°é«˜åº¦è§£è€¦ã€‚</li></ul></li><li>ç¼ºç‚¹:<ul><li>æ€§èƒ½å¼€é”€:åå°„æ“ä½œæ¯”ç›´æ¥è°ƒç”¨æœ‰æ›´é«˜çš„æ€§èƒ½å¼€é”€,å› ä¸ºæ¶‰åŠåˆ°åŠ¨æ€è§£æå’ŒæŸ¥æ‰¾ã€‚</li><li>å®‰å…¨æ€§é—®é¢˜:setAccessible(true)å¯ä»¥ç»•è¿‡Javaçš„è®¿é—®æ§åˆ¶,å¯èƒ½ç ´åå°è£…æ€§ã€‚</li><li>å¯ç»´æŠ¤æ€§å·®:åå°„ä»£ç é€šå¸¸æ¯”ç›´æ¥è°ƒç”¨æ›´å¤æ‚,æ›´éš¾è°ƒè¯•å’Œç»´æŠ¤ã€‚</li><li>ç¼–è¯‘æ—¶æ£€æŸ¥ç¼ºå¤±:åå°„æ“ä½œåœ¨ç¼–è¯‘æ—¶æ— æ³•æ£€æŸ¥ç±»å‹é”™è¯¯,åªèƒ½åœ¨è¿è¡Œæ—¶å‘ç°ã€‚</li></ul></li></ul></li></ul><h2 id="JVMå†…å­˜ç»“æ„ä¸åƒåœ¾æ”¶é›†å™¨"><a href="#JVMå†…å­˜ç»“æ„ä¸åƒåœ¾æ”¶é›†å™¨" class="headerlink" title="JVMå†…å­˜ç»“æ„ä¸åƒåœ¾æ”¶é›†å™¨"></a>JVMå†…å­˜ç»“æ„ä¸åƒåœ¾æ”¶é›†å™¨</h2><h3 id="JVMå†…å­˜ç»“æ„"><a href="#JVMå†…å­˜ç»“æ„" class="headerlink" title="JVMå†…å­˜ç»“æ„"></a>JVMå†…å­˜ç»“æ„</h3><h3 id="JVM-ç®€å•ä»‹ç»"><a href="#JVM-ç®€å•ä»‹ç»" class="headerlink" title="JVM ç®€å•ä»‹ç»"></a>JVM ç®€å•ä»‹ç»</h3><p>Java è™šæ‹Ÿæœºï¼ˆJVMï¼‰æ˜¯ Java è¯­è¨€è·¨å¹³å°èƒ½åŠ›çš„æ ¸å¿ƒã€‚å®ƒæ˜¯ä¸€ä¸ªæŠ½è±¡çš„è®¡ç®—æœºï¼Œè´Ÿè´£å°† Java å­—èŠ‚ç  (<code>.class</code> æ–‡ä»¶) è½¬æ¢æˆç‰¹å®šå¹³å°çš„æœºå™¨æŒ‡ä»¤ã€‚ä¸‹é¢é€šè¿‡è¡¨æ ¼çš„å½¢å¼ï¼Œç®€å•ä»‹ç» JVM çš„ä¸»è¦ç»„æˆéƒ¨åˆ†ã€åŠŸèƒ½å’Œå·¥ä½œæµç¨‹ã€‚</p><hr><table><thead><tr><th>æ¨¡å—åç§°</th><th>æ ¸å¿ƒåŠŸèƒ½</th><th>ä¸»è¦ç»„æˆéƒ¨åˆ†</th><th>ç®€è¦è¯´æ˜</th></tr></thead><tbody><tr><td><strong>ç±»åŠ è½½å­ç³»ç»Ÿ</strong></td><td>åŠ è½½ã€é“¾æ¥ã€åˆå§‹åŒ– <code>.class</code> æ–‡ä»¶</td><td>ç±»åŠ è½½å™¨ (ClassLoader)</td><td>è´Ÿè´£ä»æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œç­‰æ¥æºåŠ è½½ <code>.class</code> æ–‡ä»¶åˆ°å†…å­˜ï¼Œå¹¶è¿›è¡ŒéªŒè¯ã€å‡†å¤‡å’Œè§£æã€‚</td></tr><tr><td><strong>è¿è¡Œæ—¶æ•°æ®åŒº</strong></td><td>å­˜æ”¾ç¨‹åºè¿è¡Œæ—¶çš„å„ç§æ•°æ®</td><td><strong>æ–¹æ³•åŒº</strong><br><strong>å †</strong><br><strong>è™šæ‹Ÿæœºæ ˆ</strong><br><strong>æœ¬åœ°æ–¹æ³•æ ˆ</strong><br><strong>ç¨‹åºè®¡æ•°å™¨</strong></td><td>çº¿ç¨‹å…±äº«ï¼š<br>- <strong>æ–¹æ³•åŒº</strong>: å­˜å‚¨å·²åŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ç­‰ã€‚<br>- <strong>å †</strong>: å­˜å‚¨æ‰€æœ‰å¯¹è±¡å®ä¾‹å’Œæ•°ç»„ã€‚<br><br>çº¿ç¨‹ç§æœ‰ï¼š<br>- <strong>è™šæ‹Ÿæœºæ ˆ</strong>: å­˜å‚¨æ–¹æ³•è°ƒç”¨çš„å±€éƒ¨å˜é‡ã€æ“ä½œæ•°æ ˆç­‰ã€‚<br>- <strong>æœ¬åœ°æ–¹æ³•æ ˆ</strong>: å­˜å‚¨ Native æ–¹æ³•çš„è°ƒç”¨ä¿¡æ¯ã€‚<br>- <strong>ç¨‹åºè®¡æ•°å™¨</strong>: è®°å½•å½“å‰çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤åœ°å€ã€‚</td></tr><tr><td><strong>æ‰§è¡Œå¼•æ“</strong></td><td>æ‰§è¡Œå­—èŠ‚ç æŒ‡ä»¤</td><td><strong>è§£é‡Šå™¨</strong><br><strong>å³æ—¶ç¼–è¯‘å™¨ (JIT)</strong><br><strong>åƒåœ¾æ”¶é›†å™¨ (GC)</strong></td><td>è´Ÿè´£å°†å­—èŠ‚ç ç¿»è¯‘æˆæœºå™¨æŒ‡ä»¤å¹¶æ‰§è¡Œã€‚<br>- <strong>è§£é‡Šå™¨</strong>: é€è¡Œè§£é‡Šæ‰§è¡Œå­—èŠ‚ç ã€‚<br>- <strong>JIT</strong>: å°†çƒ­ç‚¹ä»£ç ç¼–è¯‘æˆé«˜æ•ˆçš„æœ¬åœ°æœºå™¨ç ã€‚<br>- <strong>GC</strong>: è‡ªåŠ¨å›æ”¶å †ä¸­ä¸å†ä½¿ç”¨çš„å¯¹è±¡å†…å­˜ã€‚</td></tr><tr><td><strong>æœ¬åœ°æ–¹æ³•æ¥å£</strong></td><td>è°ƒç”¨ Native æ–¹æ³•</td><td>JNI (Java Native Interface)</td><td>å…è®¸ Java ä»£ç ä¸å…¶ä»–è¯­è¨€ï¼ˆå¦‚ C&#x2F;C++ï¼‰ç¼–å†™çš„ä»£ç è¿›è¡Œäº¤äº’ã€‚</td></tr><tr><td><strong>æœ¬åœ°æ–¹æ³•åº“</strong></td><td>æ”¯æŒ Native æ–¹æ³•</td><td>ä¸€ç³»åˆ—æœ¬åœ°æ–¹æ³•åº“</td><td>æä¾›äº†æ‰§è¡Œå¼•æ“è°ƒç”¨æœ¬åœ°æ–¹æ³•æ‰€éœ€çš„åº“æ–‡ä»¶ã€‚</td></tr></tbody></table><p>JVM(Java Virtual Machine)åœ¨æ‰§è¡ŒJavaç¨‹åºæ—¶,ä¼šå°†å†…å­˜åˆ’åˆ†ä¸ºå‡ ä¸ªä¸åŒçš„åŒºåŸŸ,è¿™äº›åŒºåŸŸæœ‰å„è‡ªçš„ç”¨é€”å’Œç”Ÿå‘½å‘¨æœŸã€‚</p><ul><li><p><strong>ç¨‹åºè®¡æ•°å™¨ (Program Counter Register)</strong></p><ul><li>åŠŸèƒ½:ä¸€å—è¾ƒå°çš„å†…å­˜ç©ºé—´,ç”¨äºå­˜å‚¨å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ã€‚</li><li>ç‰¹ç‚¹:<ul><li>æ¯ä¸ªçº¿ç¨‹ç§æœ‰,ç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹ä¸€è‡´ã€‚</li><li>JVMè§„èŒƒä¸­å”¯ä¸€æ²¡æœ‰è§„å®šä»»ä½•OutOfMemoryErroræƒ…å†µçš„åŒºåŸŸã€‚</li><li>åœ¨å¤šçº¿ç¨‹åˆ‡æ¢æ—¶,ç¨‹åºè®¡æ•°å™¨è®°å½•äº†å½“å‰çº¿ç¨‹çš„æ‰§è¡Œä½ç½®,ä½¿å¾—çº¿ç¨‹åˆ‡æ¢å›æ¥åèƒ½å¤ŸçŸ¥é“ä»å“ªé‡Œç»§ç»­æ‰§è¡Œã€‚</li></ul></li></ul></li><li><p><strong>Javaè™šæ‹Ÿæœºæ ˆ (Java Virtual Machine Stacks)</strong></p><ul><li>åŠŸèƒ½:æ¯ä¸ªçº¿ç¨‹ç§æœ‰çš„å†…å­˜åŒºåŸŸ,ç”¨äºå­˜å‚¨æ ˆå¸§(Stack Frame)ã€‚æ¯ä¸ªæ–¹æ³•è¢«æ‰§è¡Œæ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§,ç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ç­‰ä¿¡æ¯ã€‚</li><li>ç‰¹ç‚¹:<ul><li>ç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹ä¸€è‡´ã€‚</li><li>å±€éƒ¨å˜é‡è¡¨:å­˜å‚¨æ–¹æ³•å‚æ•°å’Œæ–¹æ³•å†…éƒ¨å®šä¹‰çš„å±€éƒ¨å˜é‡ã€‚</li><li>æ“ä½œæ•°æ ˆ:ç”¨äºå­˜æ”¾æ–¹æ³•æ‰§è¡Œæ—¶çš„æ“ä½œæ•°å’Œä¸­é—´ç»“æœã€‚</li><li>åŠ¨æ€é“¾æ¥:æŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± ä¸­è¯¥æ ˆå¸§æ‰€å±æ–¹æ³•çš„å¼•ç”¨ã€‚</li><li>æ–¹æ³•å‡ºå£:è®°å½•æ–¹æ³•æ‰§è¡Œå®Œåå›åˆ°å“ªé‡Œã€‚</li><li>å¯èƒ½æŠ›å‡ºStackOverflowError(æ ˆæ·±åº¦è¶…è¿‡è™šæ‹Ÿæœºå…è®¸çš„æ·±åº¦)æˆ–OutOfMemoryError(æ ˆæ‰©å±•æ—¶æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜)ã€‚</li></ul></li></ul></li><li><p><strong>æœ¬åœ°æ–¹æ³•æ ˆ (Native Method Stacks)</strong></p><ul><li>åŠŸèƒ½:ä¸è™šæ‹Ÿæœºæ ˆç±»ä¼¼,ä½†æ˜¯ä¸ºJVMæ‰§è¡ŒNativeæ–¹æ³•(å³ç”¨C&#x2F;C++ç­‰è¯­è¨€å®ç°çš„æ–¹æ³•)æœåŠ¡ã€‚</li><li>ç‰¹ç‚¹ï¼š<ul><li>æ¯ä¸ªçº¿ç¨‹ç§æœ‰ã€‚</li><li>å¯èƒ½æŠ›å‡º StackOverflowError æˆ– OutOfMemoryErrorã€‚</li></ul></li></ul></li><li><p><strong>Java å † (Java Heap)</strong></p><ul><li><p>åŠŸèƒ½:JVM ç®¡ç†çš„æœ€å¤§ä¸€å—å†…å­˜åŒºåŸŸï¼Œè¢«æ‰€æœ‰çº¿ç¨‹å…±äº«ï¼Œç”¨äºå­˜æ”¾å¯¹è±¡å®ä¾‹å’Œæ•°ç»„ã€‚</p></li><li><p>ç‰¹ç‚¹ï¼š</p><ul><li><p>æ˜¯åƒåœ¾æ”¶é›†å™¨ç®¡ç†çš„ä¸»è¦åŒºåŸŸ (GC å †)ã€‚</p></li><li><p>æ˜¯ Java åº”ç”¨ç¨‹åºå¯¹è±¡å­˜æ”¾çš„â€œè€å®¶â€ã€‚</p></li><li><p>æ ¹æ®åƒåœ¾å›æ”¶çš„ç‰¹æ€§ï¼Œå¯ä»¥åˆ†ä¸ºæ–°ç”Ÿä»£ (Young Generation) å’Œè€å¹´ä»£ (Old Generation)ã€‚</p></li><li><p>æ–°ç”Ÿä»£:é€šå¸¸åˆ†ä¸º Eden ç©ºé—´å’Œä¸¤ä¸ª Survivor ç©ºé—´ (From å’Œ To)ã€‚æ–°åˆ›å»ºçš„å¯¹è±¡ä¼˜å…ˆåœ¨ Eden åŒºåˆ†é…ï¼Œç»è¿‡ Minor GC åå­˜æ´»çš„å¯¹è±¡è¿›å…¥ Survivor åŒºï¼Œå¤šæ¬¡ GC åä»å­˜æ´»çš„å¯¹è±¡è¿›å…¥è€å¹´ä»£ã€‚</p></li><li><p>è€å¹´ä»£:å­˜æ”¾ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„å¯¹è±¡ã€‚</p></li><li><p>åœ¨ JVM å†…å­˜æ¨¡å‹ä¸­ï¼Œæ–°ç”Ÿä»£è¢«åˆ’åˆ†ä¸ºä¸‰ä¸ªåŒºåŸŸï¼Œé»˜è®¤çš„æ¯”ä¾‹é€šå¸¸æ˜¯ <strong>8:1:1</strong>ã€‚</p><ul><li><strong>Eden åŒº</strong>ï¼šå æ¯” <strong>80%</strong>ã€‚è¿™æ˜¯æ–°åˆ›å»ºå¯¹è±¡çš„ä¸»è¦åˆ†é…åŒºåŸŸã€‚</li><li><strong>Survivor S0 åŒº</strong>ï¼šå æ¯” <strong>10%</strong>ã€‚</li><li><strong>Survivor S1 åŒº</strong>ï¼šå æ¯” <strong>10%</strong>ã€‚</li></ul><hr><h3 id="ä¸ºä»€ä¹ˆè¦è¿™æ ·åˆ’åˆ†ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦è¿™æ ·åˆ’åˆ†ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦è¿™æ ·åˆ’åˆ†ï¼Ÿ"></a><strong>ä¸ºä»€ä¹ˆè¦è¿™æ ·åˆ’åˆ†ï¼Ÿ</strong></h3><p>è¿™ç§åˆ’åˆ†æ˜¯ä¸ºäº†é…åˆ Minor GC çš„åƒåœ¾å›æ”¶æµç¨‹ï¼Œä»è€Œæé«˜åƒåœ¾å›æ”¶çš„æ•ˆç‡ã€‚</p><h4 id="æ–°ç”Ÿä»£çš„åƒåœ¾å›æ”¶æµç¨‹"><a href="#æ–°ç”Ÿä»£çš„åƒåœ¾å›æ”¶æµç¨‹" class="headerlink" title="æ–°ç”Ÿä»£çš„åƒåœ¾å›æ”¶æµç¨‹"></a><strong>æ–°ç”Ÿä»£çš„åƒåœ¾å›æ”¶æµç¨‹</strong></h4><ol><li><strong>å¯¹è±¡åˆ›å»º</strong>ï¼šæ–°åˆ›å»ºçš„å¯¹è±¡é¦–å…ˆåœ¨ <strong>Eden åŒº</strong> åˆ†é…ã€‚</li><li><strong>Minor GC</strong>ï¼šå½“ <strong>Eden åŒº</strong> æ»¡äº†ä¹‹åï¼Œä¼šè§¦å‘ä¸€æ¬¡ Minor GCï¼ˆä¹Ÿå« Young GCï¼‰ã€‚</li><li><strong>å­˜æ´»å¯¹è±¡è½¬ç§»</strong>ï¼š<ul><li>åœ¨ Eden åŒºå’Œå…¶ä¸­ä¸€ä¸ª Survivor åŒºï¼ˆæ¯”å¦‚ S0ï¼‰ä¸­ï¼Œæ‰€æœ‰å­˜æ´»çš„å¯¹è±¡ä¼šè¢«å¤åˆ¶åˆ°å¦ä¸€ä¸ªç©ºçš„ Survivor åŒºï¼ˆæ¯”å¦‚ S1ï¼‰ã€‚</li><li>åŒæ—¶ï¼Œå¯¹è±¡çš„å¹´é¾„ï¼ˆageï¼‰ä¼šåŠ ä¸€ã€‚</li></ul></li><li><strong>æ¸…ç©º Eden å’Œ S0</strong>ï¼šåƒåœ¾å›æ”¶åï¼ŒEden åŒºå’Œ S0 åŒºéƒ½ä¼šè¢«æ¸…ç©ºã€‚</li><li><strong>è§’è‰²äº’æ¢</strong>ï¼šä¸‹ä¸€æ¬¡ Minor GC æ—¶ï¼ŒEden åŒºå’Œ S1 åŒºä¸­å­˜æ´»çš„å¯¹è±¡ä¼šè¢«å¤åˆ¶åˆ° S0 åŒºã€‚S0 å’Œ S1 ä¸¤ä¸ª Survivor åŒºä¼šä¸æ–­åœ°è¿›è¡Œè§’è‰²äº’æ¢ã€‚</li><li><strong>æ™‹å‡è€å¹´ä»£</strong>ï¼š<ul><li>å½“å¯¹è±¡çš„å¹´é¾„è¾¾åˆ°ä¸€ä¸ªè®¾å®šçš„é˜ˆå€¼ï¼ˆé»˜è®¤ä¸º 15ï¼‰ï¼Œæˆ–è€… Survivor åŒºä¸­åŒä¸€å¹´é¾„æ®µçš„å¯¹è±¡å¤§å°è¶…è¿‡äº†ä¸€å®šæ¯”ä¾‹ï¼Œè¿™äº›å¯¹è±¡å°±ä¼šè¢«ç§»åŠ¨åˆ°<strong>è€å¹´ä»£</strong>ã€‚</li><li>è¿™ç§è®¾è®¡ä¹Ÿè¢«ç§°ä¸º<strong>å¤åˆ¶ç®—æ³•ï¼ˆCopying Algorithmï¼‰</strong>ï¼Œå®ƒåœ¨æ–°ç”Ÿä»£å­˜æ´»å¯¹è±¡è¾ƒå°‘çš„æƒ…å†µä¸‹ï¼Œæ•ˆç‡éå¸¸é«˜ã€‚</li></ul></li></ol><hr><h3 id="ä¸ºä»€ä¹ˆæ˜¯-8-1-1ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆæ˜¯-8-1-1ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆæ˜¯ 8:1:1ï¼Ÿ"></a><strong>ä¸ºä»€ä¹ˆæ˜¯ 8:1:1ï¼Ÿ</strong></h3><p>è¿™ä¸ªæ¯”ä¾‹æ˜¯ä¸€ä¸ªç»éªŒå€¼ï¼ŒåŸºäºå¤§å¤šæ•° Java åº”ç”¨çš„ç‰¹ç‚¹ï¼š</p><ul><li><strong>å¤§å¤šæ•°å¯¹è±¡éƒ½æ˜¯æœç”Ÿå¤•ç­çš„</strong>ã€‚å› æ­¤ï¼Œå°† Eden åŒºè®¾ç½®å¾—æ›´å¤§ï¼Œå¯ä»¥å®¹çº³æ›´å¤šçš„æ–°å¯¹è±¡ï¼Œå‡å°‘ Minor GC çš„é¢‘ç‡ã€‚</li><li>ä¸¤ä¸ª Survivor åŒºåªéœ€è¦ç”¨æ¥æš‚å­˜å­˜æ´»çš„å¯¹è±¡ï¼Œå› æ­¤ä¸éœ€è¦å¤ªå¤§ã€‚10% çš„ç©ºé—´é€šå¸¸è¶³ä»¥å®¹çº³ä¸€æ¬¡ Minor GC åå­˜æ´»çš„å¯¹è±¡ã€‚</li></ul><p>å½“ç„¶ï¼Œè¿™ä¸ªæ¯”ä¾‹ä¸æ˜¯å›ºå®šçš„ã€‚åœ¨æŸäº›ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œå¦‚æœæ–°ç”Ÿä»£å­˜æ´»å¯¹è±¡è¾ƒå¤šï¼Œå¯¼è‡´ Survivor åŒºæ— æ³•å®¹çº³æ‰€æœ‰å­˜æ´»å¯¹è±¡ï¼ŒJVM ä¼šå‘ç”Ÿ<strong>ç©ºé—´åˆ†é…æ‹…ä¿</strong>ï¼Œå°†è¿™äº›å¯¹è±¡ç›´æ¥æ™‹å‡åˆ°è€å¹´ä»£ã€‚</p><p>ä½ å¯ä»¥é€šè¿‡ JVM å‚æ•°æ¥è°ƒæ•´è¿™ä¸ªæ¯”ä¾‹ï¼Œä¾‹å¦‚ï¼š <code>java -Xmn100m -XX:SurvivorRatio=8</code></p><p>è¿™ä¸ªå‘½ä»¤è®¾ç½®æ–°ç”Ÿä»£æ€»å¤§å°ä¸º 100MBï¼ŒEden åŒºå’Œ Survivor åŒºçš„æ¯”ä¾‹ä¸º 8:1:1ã€‚</p></li><li><p>å¯èƒ½æŠ›å‡º OutOfMemoryErrorã€‚</p></li></ul></li></ul></li><li><p><strong>æ–¹æ³•åŒº (Method Area)</strong></p><ul><li>åŠŸèƒ½:è¢«æ‰€æœ‰çº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸï¼Œç”¨äºå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®ã€‚</li><li>ç‰¹ç‚¹ï¼š<ul><li>åœ¨ JDK 1.7 åŠä¹‹å‰ï¼Œæ–¹æ³•åŒºè¢«ç§°ä¸ºâ€œæ°¸ä¹…ä»£ (Permanent Generation)â€ï¼Œå®ƒå±äºå †å†…å­˜çš„ä¸€éƒ¨åˆ†ã€‚</li><li>åœ¨ JDK 1.8 åŠä¹‹åï¼Œæ°¸ä¹…ä»£è¢«ç§»é™¤ï¼Œæ–¹æ³•åŒºçš„å®ç°æ”¹ä¸ºâ€œå…ƒç©ºé—´ (Metaspace)â€ï¼Œå¹¶ä¸”å…ƒç©ºé—´ä¸ä½¿ç”¨ JVM å†…å­˜ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨æœ¬åœ°å†…å­˜ (Native Memory)ã€‚</li><li>å¯èƒ½æŠ›å‡º OutOfMemoryErrorã€‚</li></ul></li></ul></li><li><p><strong>è¿è¡Œæ—¶å¸¸é‡æ±  (Runtime Constant Pool)</strong></p><ul><li>åŠŸèƒ½:æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºå­˜æ”¾ç¼–è¯‘æœŸç”Ÿæˆçš„å„ç§å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ã€‚</li><li>ç‰¹ç‚¹ï¼š<ul><li>åŠ¨æ€æ€§:Java è¯­è¨€å¹¶ä¸è¦æ±‚å¸¸é‡æ± åœ¨ç¼–è¯‘æœŸå°±å…¨éƒ¨ç¡®å®šï¼Œè¿è¡Œæ—¶ä¹Ÿå¯ä»¥å°†æ–°çš„å¸¸é‡æ”¾å…¥æ± ä¸­ (å¦‚ String.intern())ã€‚</li><li>å¯èƒ½æŠ›å‡º OutOfMemoryErrorã€‚</li></ul></li></ul></li></ul><h3 id="1-ç¨‹åºè®¡æ•°å™¨"><a href="#1-ç¨‹åºè®¡æ•°å™¨" class="headerlink" title="1. ç¨‹åºè®¡æ•°å™¨"></a>1. ç¨‹åºè®¡æ•°å™¨</h3><p>ç¨‹åºè®¡æ•°å™¨ï¼ˆProgram Counter Registerï¼‰ï¼šæ˜¯ä¸€å—è¾ƒå°çš„å†…å­˜ç©ºé—´ï¼Œå®ƒå¯ä»¥çœ‹ä½œæ˜¯å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ã€‚å­—èŠ‚ç è§£é‡Šå™¨å·¥ä½œæ—¶å°±æ˜¯é€šè¿‡æ”¹å˜è¿™ä¸ªè®¡æ•°å™¨çš„å€¼æ¥é€‰å–ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ã€‚ç¨‹åºçš„åˆ†æ”¯ã€å¾ªç¯ã€è·³è½¬ã€å¼‚å¸¸å¤„ç†ã€çº¿ç¨‹æ¢å¤ç­‰åŸºç¡€åŠŸèƒ½éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªè®¡æ•°å™¨æ¥å®Œæˆã€‚</p><p>ç”±äº Java è™šæ‹Ÿæœºçš„å¤šçº¿ç¨‹æ˜¯é€šè¿‡çº¿ç¨‹è½®æµåˆ‡æ¢å¹¶åˆ†é…å¤„ç†å™¨æ‰§è¡Œæ—¶é—´çš„æ–¹å¼æ¥å®ç°çš„ï¼Œåœ¨ä»»ä½•ä¸€ä¸ªç¡®å®šçš„æ—¶åˆ»ï¼Œä¸€ä¸ªå¤„ç†å™¨éƒ½åªä¼šæ‰§è¡Œä¸€æ¡çº¿ç¨‹ä¸­çš„å‘½ä»¤ã€‚å› æ­¤ï¼Œä¸ºäº†çº¿ç¨‹åˆ‡æ¢åèƒ½æ¢å¤åˆ°æ­£ç¡®çš„æ‰§è¡Œä½ç½®ï¼Œæ¯æ¡çº¿ç¨‹éƒ½éœ€è¦æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ç¨‹åºè®¡æ•°å™¨ï¼Œå„çº¿ç¨‹ä¹‹é—´çš„è®¡æ•°å™¨äº’ä¸å½±å“ï¼Œç‹¬ç«‹å­˜å‚¨ï¼Œæˆ‘ä»¬ç¨‹è¿™å—å†…å­˜åŒºåŸŸä¸ºâ€œçº¿ç¨‹ç§æœ‰â€çš„å†…å­˜ã€‚</p><p>æ­¤åŒºåŸŸæ˜¯å”¯ä¸€ä¸€ä¸ªè™šæ‹Ÿæœºè§„èŒƒä¸­æ²¡æœ‰è§„å®šä»»ä½• OutOfMemoryError æƒ…å†µçš„åŒºåŸŸã€‚</p><hr><h3 id="2-Java-è™šæ‹Ÿæœºæ ˆ"><a href="#2-Java-è™šæ‹Ÿæœºæ ˆ" class="headerlink" title="2. Java è™šæ‹Ÿæœºæ ˆ"></a>2. Java è™šæ‹Ÿæœºæ ˆ</h3><p>Java è™šæ‹Ÿæœºæ ˆï¼ˆJava Virtual Machine Stacksï¼‰ï¼šæè¿°çš„æ˜¯Javaæ–¹æ³•æ‰§è¡Œçš„å†…å­˜æ¨¡å‹ï¼šæ¯ä¸ªæ–¹æ³•åœ¨æ‰§è¡Œçš„åŒæ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªå¸§æ ˆï¼ˆStack Frameï¼‰ç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ç­‰ä¿¡æ¯ã€‚æ¯ä¸€ä¸ªæ–¹æ³•ä»è°ƒç”¨ç›´è‡³æ‰§è¡Œå®Œæˆçš„è¿‡ç¨‹ï¼Œå°±å¯¹åº”ç€ä¸€ä¸ªæ ˆå¸§åœ¨è™šæ‹Ÿæœºæ ˆä¸­å…¥æ ˆåˆ°å‡ºæ ˆçš„è¿‡ç¨‹ã€‚å®ƒçš„çº¿ç¨‹ä¹Ÿæ˜¯ç§æœ‰çš„ï¼Œç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹ç›¸åŒã€‚</p><p>å±€éƒ¨å˜é‡è¡¨å­˜æ”¾äº†ç¼–è¯‘æœŸå¯çŸ¥çš„å„ç§åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆbooleanã€byteã€charã€shortã€intã€floatã€longã€doubleï¼‰ã€å¯¹è±¡å¼•ç”¨å’Œ returnAddress ç±»å‹ï¼ˆæŒ‡å‘äº†ä¸€æ¡å­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€ï¼‰ã€‚</p><p>Java è™šæ‹Ÿæœºæ ˆçš„å±€éƒ¨å˜é‡è¡¨çš„ç©ºé—´å•ä½æ˜¯æ§½ï¼ˆSlotï¼‰ï¼Œå…¶ä¸­ 64 ä½é•¿åº¦çš„ double å’Œ long ç±»å‹ä¼šå ç”¨ä¸¤ä¸ª Slotã€‚å±€éƒ¨å˜é‡è¡¨æ‰€éœ€å†…å­˜ç©ºé—´åœ¨ç¼–è¯‘æœŸå®Œæˆåˆ†é…ï¼Œå½“è¿›å…¥ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œè¯¥æ–¹æ³•éœ€è¦åœ¨å¸§ä¸­åˆ†é…å¤šå¤§çš„å±€éƒ¨å˜é‡æ˜¯å®Œå…¨ç¡®å®šçš„ï¼Œåœ¨æ–¹æ³•è¿è¡ŒæœŸé—´ä¸ä¼šæ”¹å˜å±€éƒ¨å˜é‡è¡¨çš„å¤§å°ã€‚</p><p>Javaè™šæ‹Ÿæœºæ ˆæœ‰ä¸¤ç§å¼‚å¸¸çŠ¶å†µï¼šå¦‚æœçº¿ç¨‹è¯·æ±‚çš„æ ˆçš„æ·±åº¦å¤§äºè™šæ‹Ÿæœºæ‰€å…è®¸çš„æ·±åº¦ï¼Œå°†æŠ›å‡º <code>StackOverflowError</code> å¼‚å¸¸ï¼›å¦‚æœæ‰©å±•æ—¶æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜ï¼Œå°±ä¼šæŠ›å‡º <code>OutOfMemoryError</code> å¼‚å¸¸ã€‚</p><hr><h3 id="3-æœ¬åœ°æ–¹æ³•æ ˆ"><a href="#3-æœ¬åœ°æ–¹æ³•æ ˆ" class="headerlink" title="3. æœ¬åœ°æ–¹æ³•æ ˆ"></a>3. æœ¬åœ°æ–¹æ³•æ ˆ</h3><p>æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Method Stackï¼‰ï¼šä¸è™šæ‹Ÿæœºæ ˆæ‰€å‘çš„ä½œç”¨æ˜¯éå¸¸ç›¸ä¼¼çš„ï¼Œå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«åªä¸è¿‡æ˜¯è™šæ‹Ÿæœºæ ˆä¸ºè™šæ‹Ÿæœºæ‰§è¡ŒJavaæ–¹æ³•ï¼ˆä¹Ÿå°±æ˜¯å­—èŠ‚ç ï¼‰æœåŠ¡ï¼Œè€Œæœ¬åœ°æ–¹æ³•æ ˆåˆ™ä¸ºè™šæ‹Ÿæœºä½¿ç”¨åˆ°çš„ Native æ–¹æ³•æœåŠ¡ã€‚</p><p>Java è™šæ‹Ÿæœºè§„èŒƒæ²¡æœ‰å¯¹æœ¬åœ°æ–¹æ³•æ ˆä¸­æ–¹æ³•ä½¿ç”¨çš„è¯­è¨€ã€ä½¿ç”¨çš„æ–¹å¼å’Œæ•°æ®ç»“æ„åšå‡ºå¼ºåˆ¶è§„å®šï¼Œå› æ­¤å…·ä½“çš„è™šæ‹Ÿæœºå¯ä»¥è‡ªç”±åœ°å®ç°å®ƒã€‚æ¯”å¦‚ï¼šSun HotSpot è™šæ‹Ÿæœºç›´æ¥æŠŠJavaè™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆåˆäºŒä¸ºä¸€ã€‚</p><p>ä¸Javaè™šæ‹Ÿæœºæ ˆä¸€æ ·ï¼Œæœ¬åœ°æ–¹æ³•æ ˆä¹Ÿä¼šæŠ›å‡º<code>StackOverflowError</code>å’Œ <code>OutOfMemoryError</code> å¼‚å¸¸ã€‚</p><hr><h3 id="4-Java-å †"><a href="#4-Java-å †" class="headerlink" title="4. Java å †"></a>4. Java å †</h3><p>Javaå †ï¼ˆJava Heapï¼‰ï¼šæ˜¯è¢«æ‰€æœ‰çº¿ç¨‹æ‰€å…±äº«çš„ä¸€å—å†…å­˜åŒºåŸŸï¼Œåœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºã€‚æ­¤å†…å­˜åŒºåŸŸçš„å”¯ä¸€ç›®çš„å°±æ˜¯ï¼šå­˜æ”¾å¯¹è±¡å®ä¾‹ï¼Œå‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹éƒ½åœ¨è¿™é‡Œåˆ†é…å†…å­˜ã€‚</p><p>Java å †æ˜¯åƒåœ¾æ”¶é›†å™¨ç®¡ç†çš„ä¸»è¦åŒºåŸŸï¼Œå› æ­¤å¾ˆå¤šæ—¶å€™ä¹Ÿè¢«ç§°åšâ€œGCâ€å †ï¼ˆGarbage Collected Heapï¼‰ã€‚ä»å†…å­˜å›æ”¶çš„è§’åº¦çœ‹ï¼Œç”±äºç°åœ¨æ”¶é›†å™¨åŸºæœ¬éƒ½é‡‡ç”¨åˆ†ä»£æ”¶é›†ç®—æ³•ï¼Œæ‰€ä»¥ Java å †ä¸­è¿˜å¯ä»¥ç»†åˆ†ä¸ºï¼šæ–°ç”Ÿä»£å’Œè€å¹´ä»£ã€‚ä»å†…å­˜åˆ†é…è§’åº¦æ¥çœ‹ï¼Œçº¿ç¨‹å…±äº«çš„ Java å †ä¸­å¯èƒ½åˆ’åˆ†å‡ºå¤šä¸ªçº¿ç¨‹ç§æœ‰çš„åˆ†é…ç¼“å†²åŒºï¼ˆThread Local Allocation Buffer, TLABï¼‰ã€‚ä¸è¿‡æ— è®ºå¦‚ä½•åˆ’åˆ†ï¼Œéƒ½ä¸å­˜æ”¾çš„å†…å®¹æ— å…³ï¼Œæ— è®ºå“ªä¸ªåŒºåŸŸï¼Œå­˜å‚¨çš„éƒ½ä»ç„¶æ˜¯å¯¹è±¡å®ä¾‹ï¼Œè¿›ä¸€æ­¥åˆ’åˆ†çš„ç›®çš„æ˜¯ä¸ºäº†æ›´å¥½åœ°å›æ”¶å†…å­˜ï¼Œæˆ–è€…æ›´å¿«åœ°åˆ†é…å†…å­˜ã€‚</p><p>Java è™šæ‹Ÿæœºè§„å®šï¼ŒJava å †å¯ä»¥å¤„äºç‰©ç†ä¸Šä¸è¿ç»­çš„å†…å­˜ç©ºé—´ä¸­ï¼Œåªè¦é€»è¾‘ä¸Šæ˜¯è¿ç»­çš„å³å¯ã€‚åœ¨å®ç°æ—¶ï¼Œå¯ä»¥æ˜¯å›ºå®šå¤§å°çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯å¯æ‰©å±•çš„ã€‚å¦‚æœåœ¨å †ä¸­æ²¡æœ‰å®Œæˆå®ä¾‹åˆ†é…ã€‚å¹¶ä¸”å †ä¹Ÿæ— æ³•æ‰©å±•æ—¶ï¼Œå°†ä¼šæŠ›å‡º <code>OutOfMemoryError</code> å¼‚å¸¸ã€‚</p><hr><h3 id="5-æ–¹æ³•åŒº"><a href="#5-æ–¹æ³•åŒº" class="headerlink" title="5. æ–¹æ³•åŒº"></a>5. æ–¹æ³•åŒº</h3><p>æ–¹æ³•åŒºï¼ˆMethod Areaï¼‰ï¼šä¸ Java å †ä¸€æ ·ï¼Œæ˜¯å„ä¸ªçº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸï¼Œå®ƒç”¨äºå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®ã€‚</p><p>è™½ç„¶ Java è™šæ‹Ÿæœºè§„èŒƒæŠŠæ–¹æ³•åŒºæè¿°ä¸ºå †çš„ä¸€ä¸ªé€»è¾‘éƒ¨åˆ†ï¼Œä½†æ˜¯å®ƒå´æœ‰ä¸€ä¸ªåˆ«åå«åš Non-Heapï¼ˆéå †ï¼‰ï¼Œå…¶ç›®çš„åº”è¯¥å°±æ˜¯ä¸ Java å †åŒºåˆ†å¼€æ¥ã€‚</p><p>Java è™šæ‹Ÿæœºè§„èŒƒå¯¹æ–¹æ³•åŒºçš„é™åˆ¶éå¸¸å®½æ¾ï¼Œé™¤äº†å’Œ Java å †ä¸€æ ·ä¸éœ€è¦è¿ç»­çš„å†…å­˜å’Œå¯ä»¥é€‰æ‹©å›ºå®šå¤§å°æˆ–è€…å¯æ‰©å±•å¤–ï¼Œè¿˜å¯ä»¥é€‰æ‹©ä¸å®ç°åƒåœ¾æ”¶é›†ã€‚è¿™ä¸ªåŒºåŸŸçš„å†…å­˜å›æ”¶ç›®æ ‡ä¸»è¦æ˜¯é’ˆå¯¹å¸¸é‡æ± çš„å›æ”¶å’Œå¯¹ç±»å‹çš„å¸è½½ã€‚</p><p>æ ¹æ®Javaè™šæ‹Ÿæœºè§„èŒƒè§„å®šï¼Œå½“æ–¹æ³•åŒºæ— æ³•æ»¡è¶³å†…å­˜åˆ†é…éœ€æ±‚æ—¶ï¼Œå°†æŠ›å‡º <code>OutOfMemoryError</code> å¼‚å¸¸ã€‚</p><p><strong>è¿è¡Œæ—¶å¸¸é‡æ± </strong>ï¼šè¿è¡Œæ—¶å¸¸é‡æ± ï¼ˆRuntime Constant Poolï¼‰ï¼šæ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ã€‚<code>Class</code> æ–‡ä»¶ä¸­é™¤äº†æœ‰ç±»çš„ç‰ˆæœ¬ã€å­—æ®µã€æ–¹æ³•ã€æ¥å£ç­‰æè¿°ä¿¡æ¯å¤–ï¼Œè¿˜æœ‰ä¸€äº›ä¿¡æ¯æ˜¯å¸¸é‡æ± ï¼Œç”¨äºå­˜æ”¾ç¼–è¯‘æœŸç”Ÿæˆçš„å„ç§å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ï¼Œè¿™éƒ¨åˆ†å†…å®¹å°†åœ¨ç±»åŠ è½½åè¿›å…¥æ–¹æ³•åŒºçš„è¿è¡Œæ—¶å¸¸é‡æ± ä¸­å­˜æ”¾ã€‚</p><p>Java è™šæ‹Ÿæœºå¯¹ Class æ–‡ä»¶æ¯ä¸€éƒ¨åˆ†ï¼ˆè‡ªç„¶ä¹ŸåŒ…æ‹¬å¸¸é‡æ± ï¼‰çš„æ ¼å¼éƒ½æœ‰ä¸¥æ ¼çš„è§„å®šï¼Œæ¯ä¸€ä¸ªå­—èŠ‚ç”¨äºå­˜å‚¨å“ªç§æ•°æ®éƒ½å¿…é¡»ç¬¦åˆè§„èŒƒä¸Šçš„è¦æ±‚æ‰ä¼šè¢«è™šæ‹Ÿæœºè®¤å¯ã€è£…è½½å’Œæ‰§è¡Œã€‚</p><p><strong>ç›´æ¥å†…å­˜</strong>ï¼šç›´æ¥å†…å­˜ï¼ˆDirect Memoryï¼‰ï¼šå¹¶ä¸æ˜¯è™šæ‹Ÿæœºè¿è¡Œæ—¶æ•°æ®åŒºçš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿä¸æ˜¯ Java è™šæ‹Ÿæœºè§„èŒƒä¸­å®šä¹‰çš„å†…å­˜åŒºåŸŸã€‚ä½†æ˜¯è¿™éƒ¨åˆ†å†…å­˜ä¹Ÿé¢‘ç¹åœ°ä½¿ç”¨ï¼Œè€Œä¸”ä¹Ÿå¯èƒ½å¯¼è‡´ <code>OutOfMemoryError</code> å¼‚å¸¸ã€‚</p><p>æœ¬åœ°ç›´æ¥å†…å­˜çš„åˆ†é…ä¸ä¼šå—åˆ° Java å †å¤§å°çš„é™åˆ¶ï¼Œä½†æ˜¯ï¼Œæ—¢ç„¶æ˜¯å†…å­˜ï¼Œè‚¯å®šè¿˜æ˜¯ä¼šå—åˆ°æœ¬æœºæ€»å†…å­˜å¤§å°ä»¥åŠå¤„ç†å™¨å¯»å€ç©ºé—´çš„é™åˆ¶ã€‚å¦‚æœå„ä¸ªå†…å­˜åŒºåŸŸæ€»å’Œå¤§äºç‰©ç†å†…å­˜é™åˆ¶ï¼Œä»è€Œå¯¼è‡´åŠ¨æ€æ‰©å±•æ—¶å‡ºç° <code>OutOfMemoryError</code> å¼‚å¸¸ã€‚</p><hr><h3 id="3-å †å’Œæ ˆçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#3-å †å’Œæ ˆçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="3. å †å’Œæ ˆçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"></a>3. å †å’Œæ ˆçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>å †å’Œæ ˆï¼ˆè™šæ‹Ÿæœºæ ˆï¼‰æ˜¯å®Œå…¨ä¸åŒçš„ä¸¤å—å†…å­˜åŒºåŸŸï¼Œä¸€ä¸ªæ˜¯çº¿ç¨‹ç‹¬äº«çš„ï¼Œä¸€ä¸ªæ˜¯çº¿ç¨‹å…±äº«çš„ã€‚äºŒè€…ä¹‹é—´æœ€å¤§çš„åŒºåˆ«å°±æ˜¯å­˜å‚¨çš„å†…å®¹ä¸åŒï¼šå †ä¸­ä¸»è¦å­˜æ”¾å¯¹è±¡å®ä¾‹ã€‚æ ˆï¼ˆå±€éƒ¨å˜é‡è¡¨ï¼‰ä¸­ä¸»è¦å­˜æ”¾å„ç§åŸºæœ¬æ•°æ®ç±»å‹ã€å¯¹è±¡çš„å¼•ç”¨ã€‚</p><p>ä»ä½œç”¨æ¥è¯´ï¼Œæ ˆæ˜¯è¿è¡Œæ—¶çš„å•ä½ï¼Œè€Œå †æ˜¯å­˜å‚¨çš„å•ä½ã€‚æ ˆè§£å†³ç¨‹åºçš„è¿è¡Œé—®é¢˜ï¼Œå³ç¨‹åºå¦‚ä½•æ‰§è¡Œï¼Œæˆ–è€…è¯´å¦‚ä½•å¤„ç†æ•°æ®ã€‚å †è§£å†³çš„æ˜¯æ•°æ®å­˜å‚¨çš„é—®é¢˜ï¼Œå³æ•°æ®æ€ä¹ˆæ”¾ã€æ”¾åœ¨å“ªå„¿ã€‚åœ¨ Java ä¸­ä¸€ä¸ªçº¿ç¨‹å°±ä¼šç›¸åº”æœ‰ä¸€ä¸ªçº¿ç¨‹æ ˆä¸ä¹‹å¯¹åº”ï¼Œå› ä¸ºä¸åŒçš„çº¿ç¨‹æ‰§è¡Œé€»è¾‘æœ‰æ‰€ä¸åŒï¼Œå› æ­¤éœ€è¦ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹æ ˆã€‚è€Œå †åˆ™æ˜¯æ‰€æœ‰çº¿ç¨‹å…±äº«çš„ã€‚æ ˆå› ä¸ºæ˜¯è¿è¡Œå•ä½ï¼Œå› æ­¤é‡Œé¢å­˜å‚¨çš„ä¿¡æ¯éƒ½æ˜¯è·Ÿå½“å‰çº¿ç¨‹ï¼ˆæˆ–ç¨‹åºï¼‰ç›¸å…³ä¿¡æ¯çš„ã€‚åŒ…æ‹¬å±€éƒ¨å˜é‡ã€ç¨‹åºè¿è¡ŒçŠ¶æ€ã€æ–¹æ³•è¿”å›å€¼ç­‰ç­‰ï¼›è€Œå †åªè´Ÿè´£å­˜å‚¨å¯¹è±¡ä¿¡æ¯ã€‚</p><hr><h3 id="4-å †ä¸­å­˜ä»€ä¹ˆï¼Ÿæ ˆä¸­å­˜ä»€ä¹ˆï¼Ÿ"><a href="#4-å †ä¸­å­˜ä»€ä¹ˆï¼Ÿæ ˆä¸­å­˜ä»€ä¹ˆï¼Ÿ" class="headerlink" title="4. å †ä¸­å­˜ä»€ä¹ˆï¼Ÿæ ˆä¸­å­˜ä»€ä¹ˆï¼Ÿ"></a>4. å †ä¸­å­˜ä»€ä¹ˆï¼Ÿæ ˆä¸­å­˜ä»€ä¹ˆï¼Ÿ</h3><p>å †ä¸­å­˜çš„æ˜¯å¯¹è±¡ã€‚æ ˆä¸­å­˜çš„æ˜¯åŸºæœ¬æ•°æ®ç±»å‹å’Œå †ä¸­å¯¹è±¡çš„å¼•ç”¨ã€‚ä¸€ä¸ªå¯¹è±¡çš„å¤§å°æ˜¯ä¸å¯ä¼°è®¡çš„ï¼Œæˆ–è€…è¯´æ˜¯å¯ä»¥åŠ¨æ€å˜åŒ–çš„ï¼Œä½†æ˜¯åœ¨æ ˆä¸­ï¼Œä¸€ä¸ªå¯¹è±¡åªå¯¹åº”äº†ä¸€ä¸ª 4btye çš„å¼•ç”¨ï¼ˆå †æ ˆåˆ†ç¦»çš„å¥½å¤„ï¼‰ã€‚</p><p>ä¸ºä»€ä¹ˆä¸æŠŠåŸºæœ¬ç±»å‹æ”¾å †ä¸­å‘¢ï¼Ÿ</p><p>å› ä¸ºåŸºæœ¬æ•°æ®ç±»å‹å ç”¨çš„ç©ºé—´ä¸€èˆ¬æ˜¯1~8ä¸ªå­—èŠ‚ï¼Œéœ€è¦ç©ºé—´æ¯”è¾ƒå°‘ï¼Œè€Œä¸”å› ä¸ºæ˜¯åŸºæœ¬ç±»å‹ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°åŠ¨æ€å¢é•¿çš„æƒ…å†µï¼Œé•¿åº¦å›ºå®šï¼Œå› æ­¤æ ˆä¸­å­˜å‚¨å°±å¤Ÿäº†ã€‚å¦‚æœæŠŠå®ƒå­˜åœ¨å †ä¸­æ˜¯æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰çš„ã€‚åŸºæœ¬ç±»å‹å’Œå¯¹è±¡çš„å¼•ç”¨éƒ½æ˜¯å­˜æ”¾åœ¨æ ˆä¸­ï¼Œè€Œä¸”éƒ½æ˜¯å‡ ä¸ªå­—èŠ‚çš„ä¸€ä¸ªæ•°ï¼Œå› æ­¤åœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œå®ƒä»¬çš„å¤„ç†æ–¹å¼æ˜¯ç»Ÿä¸€çš„ã€‚ä½†æ˜¯åŸºæœ¬ç±»å‹ã€å¯¹è±¡å¼•ç”¨å’Œå¯¹è±¡æœ¬èº«å°±æœ‰æ‰€åŒºåˆ«äº†ï¼Œå› ä¸ºä¸€ä¸ªæ˜¯æ ˆä¸­çš„æ•°æ®ä¸€ä¸ªæ˜¯å †ä¸­çš„æ•°æ®ã€‚æœ€å¸¸è§çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼ŒJava ä¸­å‚æ•°ä¼ é€’æ—¶çš„é—®é¢˜ã€‚</p><hr><h3 id="5-ä¸ºä»€ä¹ˆè¦æŠŠå †å’Œæ ˆåŒºåˆ†å‡ºæ¥å‘¢ï¼Ÿæ ˆä¸­ä¸æ˜¯ä¹Ÿå¯ä»¥å­˜å‚¨æ•°æ®å—ï¼Ÿ"><a href="#5-ä¸ºä»€ä¹ˆè¦æŠŠå †å’Œæ ˆåŒºåˆ†å‡ºæ¥å‘¢ï¼Ÿæ ˆä¸­ä¸æ˜¯ä¹Ÿå¯ä»¥å­˜å‚¨æ•°æ®å—ï¼Ÿ" class="headerlink" title="5. ä¸ºä»€ä¹ˆè¦æŠŠå †å’Œæ ˆåŒºåˆ†å‡ºæ¥å‘¢ï¼Ÿæ ˆä¸­ä¸æ˜¯ä¹Ÿå¯ä»¥å­˜å‚¨æ•°æ®å—ï¼Ÿ"></a>5. ä¸ºä»€ä¹ˆè¦æŠŠå †å’Œæ ˆåŒºåˆ†å‡ºæ¥å‘¢ï¼Ÿæ ˆä¸­ä¸æ˜¯ä¹Ÿå¯ä»¥å­˜å‚¨æ•°æ®å—ï¼Ÿ</h3><ol><li>ä»è½¯ä»¶è®¾è®¡çš„è§’åº¦çœ‹ï¼Œæ ˆä»£è¡¨äº†å¤„ç†é€»è¾‘ï¼Œè€Œå †ä»£è¡¨äº†æ•°æ®ã€‚è¿™æ ·åˆ†å¼€ï¼Œä½¿å¾—å¤„ç†é€»è¾‘æ›´ä¸ºæ¸…æ™°ã€‚åˆ†è€Œæ²»ä¹‹çš„æ€æƒ³ã€‚è¿™ç§éš”ç¦»ã€æ¨¡å—åŒ–çš„æ€æƒ³åœ¨è½¯ä»¶è®¾è®¡çš„æ–¹æ–¹é¢é¢éƒ½æœ‰ä½“ç°ã€‚</li><li>å †ä¸æ ˆçš„åˆ†ç¦»ï¼Œä½¿å¾—å †ä¸­çš„å†…å®¹å¯ä»¥è¢«å¤šä¸ªæ ˆå…±äº«ï¼ˆä¹Ÿå¯ä»¥ç†è§£ä¸ºå¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€ä¸ªå¯¹è±¡ï¼‰ã€‚è¿™ç§å…±äº«çš„æ”¶ç›Šæ˜¯å¾ˆå¤šçš„ã€‚ä¸€æ–¹é¢è¿™ç§å…±äº«æä¾›äº†ä¸€ç§æœ‰æ•ˆçš„æ•°æ®äº¤äº’æ–¹å¼(å¦‚ï¼šå…±äº«å†…å­˜)ï¼Œå¦ä¸€æ–¹é¢ï¼Œå †ä¸­çš„å…±äº«å¸¸é‡å’Œç¼“å­˜å¯ä»¥è¢«æ‰€æœ‰æ ˆè®¿é—®ï¼ŒèŠ‚çœäº†ç©ºé—´ã€‚</li><li>æ ˆå› ä¸ºè¿è¡Œæ—¶çš„éœ€è¦ï¼Œæ¯”å¦‚ï¼šä¿å­˜ç³»ç»Ÿè¿è¡Œçš„ä¸Šä¸‹æ–‡ï¼Œéœ€è¦è¿›è¡Œåœ°å€æ®µçš„åˆ’åˆ†ã€‚ç”±äºæ ˆåªèƒ½å‘ä¸Šå¢é•¿ï¼Œå› æ­¤å°±ä¼šé™åˆ¶ä½æ ˆå­˜å‚¨å†…å®¹çš„èƒ½åŠ›ã€‚è€Œå †ä¸åŒï¼Œå †ä¸­çš„å¯¹è±¡æ˜¯å¯ä»¥æ ¹æ®éœ€è¦åŠ¨æ€å¢é•¿çš„ï¼Œå› æ­¤æ ˆå’Œå †çš„æ‹†åˆ†ï¼Œä½¿å¾—åŠ¨æ€å¢é•¿æˆä¸ºå¯èƒ½ï¼Œç›¸åº”æ ˆä¸­åªéœ€è®°å½•å †ä¸­çš„ä¸€ä¸ªåœ°å€å³å¯ã€‚</li></ol><hr><h3 id="6-Java-ä¸­çš„å‚æ•°ä¼ é€’æ—¶ä¼ å€¼å‘¢ï¼Ÿè¿˜æ˜¯ä¼ å¼•ç”¨ï¼Ÿ"><a href="#6-Java-ä¸­çš„å‚æ•°ä¼ é€’æ—¶ä¼ å€¼å‘¢ï¼Ÿè¿˜æ˜¯ä¼ å¼•ç”¨ï¼Ÿ" class="headerlink" title="6. Java ä¸­çš„å‚æ•°ä¼ é€’æ—¶ä¼ å€¼å‘¢ï¼Ÿè¿˜æ˜¯ä¼ å¼•ç”¨ï¼Ÿ"></a>6. Java ä¸­çš„å‚æ•°ä¼ é€’æ—¶ä¼ å€¼å‘¢ï¼Ÿè¿˜æ˜¯ä¼ å¼•ç”¨ï¼Ÿ</h3><p>è¦è¯´æ˜è¿™ä¸ªé—®é¢˜ï¼Œå…ˆè¦æ˜ç¡®ä¸¤ç‚¹ï¼š</p><ol><li>ä¸è¦è¯•å›¾ä¸ C è¿›è¡Œç±»æ¯”ï¼ŒJava ä¸­æ²¡æœ‰æŒ‡é’ˆçš„æ¦‚å¿µã€‚</li><li>ç¨‹åºè¿è¡Œæ°¸è¿œéƒ½æ˜¯åœ¨æ ˆä¸­è¿›è¡Œçš„ï¼Œå› è€Œå‚æ•°ä¼ é€’æ—¶ï¼Œåªå­˜åœ¨ä¼ é€’åŸºæœ¬ç±»å‹å’Œå¯¹è±¡å¼•ç”¨çš„é—®é¢˜ã€‚ä¸ä¼šç›´æ¥ä¼ å¯¹è±¡æœ¬èº«ã€‚</li></ol><p>Java åœ¨æ–¹æ³•è°ƒç”¨ä¼ é€’å‚æ•°æ—¶ï¼Œå› ä¸ºæ²¡æœ‰æŒ‡é’ˆï¼Œæ‰€ä»¥å®ƒéƒ½æ˜¯è¿›è¡Œä¼ å€¼è°ƒç”¨ã€‚ä½†æ˜¯ä¼ å¼•ç”¨çš„é”™è§‰æ˜¯å¦‚ä½•é€ æˆçš„å‘¢ï¼Ÿåœ¨è¿è¡Œæ ˆä¸­ï¼ŒåŸºæœ¬ç±»å‹å’Œå¼•ç”¨çš„å¤„ç†æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯ä¼ å€¼ã€‚æ‰€ä»¥ï¼Œå¦‚æœæ˜¯ä¼ å¼•ç”¨çš„æ–¹æ³•è°ƒç”¨ï¼Œä¹ŸåŒæ—¶å¯ä»¥ç†è§£ä¸ºâ€œä¼ å¼•ç”¨å€¼â€çš„ä¼ å€¼è°ƒç”¨ï¼Œå³å¼•ç”¨çš„å¤„ç†è·ŸåŸºæœ¬ç±»å‹æ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚ä½†æ˜¯å½“è¿›å…¥è¢«è°ƒç”¨æ–¹æ³•æ—¶ï¼Œè¢«ä¼ é€’çš„è¿™ä¸ªå¼•ç”¨çš„å€¼ï¼Œè¢«ç¨‹åºè§£é‡Šåˆ°å †ä¸­çš„å¯¹è±¡ï¼Œè¿™ä¸ªæ—¶å€™æ‰å¯¹åº”åˆ°çœŸæ­£çš„å¯¹è±¡ã€‚å¦‚æœæ­¤æ—¶è¿›è¡Œä¿®æ”¹ï¼Œä¿®æ”¹çš„æ˜¯å¼•ç”¨å¯¹åº”çš„å¯¹è±¡ï¼Œè€Œä¸æ˜¯å¼•ç”¨æœ¬èº«ï¼Œå³ï¼šä¿®æ”¹çš„æ˜¯å †ä¸­çš„æ•°æ®ã€‚æ‰€ä»¥è¿™ä¸ªä¿®æ”¹æ˜¯å¯ä»¥ä¿æŒçš„äº†ã€‚</p><p>å¯¹è±¡ï¼Œä»æŸç§æ„ä¹‰ä¸Šè¯´ï¼Œæ˜¯ç”±åŸºæœ¬ç±»å‹ç»„æˆçš„ã€‚å¯ä»¥æŠŠä¸€ä¸ªå¯¹è±¡çœ‹ä½œä¸ºä¸€æ£µæ ‘ï¼Œå¯¹è±¡çš„å±æ€§å¦‚æœè¿˜æ˜¯å¯¹è±¡ï¼Œåˆ™è¿˜æ˜¯ä¸€é¢—æ ‘ï¼ˆå³éå¶å­èŠ‚ç‚¹ï¼‰ï¼ŒåŸºæœ¬ç±»å‹åˆ™ä¸ºæ ‘çš„å¶å­èŠ‚ç‚¹ã€‚ç¨‹åºå‚æ•°ä¼ é€’æ—¶ï¼Œè¢«ä¼ é€’çš„å€¼æœ¬èº«éƒ½æ˜¯ä¸èƒ½è¿›è¡Œä¿®æ”¹çš„ï¼Œä½†æ˜¯ï¼Œå¦‚æœè¿™ä¸ªå€¼æ˜¯ä¸€ä¸ªéå¶å­èŠ‚ç‚¹ï¼ˆå³ä¸€ä¸ªå¯¹è±¡å¼•ç”¨ï¼‰ï¼Œåˆ™å¯ä»¥ä¿®æ”¹è¿™ä¸ªèŠ‚ç‚¹ä¸‹é¢çš„æ‰€æœ‰å†…å®¹ã€‚</p><hr><h3 id="7-Java-å¯¹è±¡çš„å¤§å°æ˜¯æ€ä¹ˆè®¡ç®—çš„ï¼Ÿ"><a href="#7-Java-å¯¹è±¡çš„å¤§å°æ˜¯æ€ä¹ˆè®¡ç®—çš„ï¼Ÿ" class="headerlink" title="7. Java å¯¹è±¡çš„å¤§å°æ˜¯æ€ä¹ˆè®¡ç®—çš„ï¼Ÿ"></a>7. Java å¯¹è±¡çš„å¤§å°æ˜¯æ€ä¹ˆè®¡ç®—çš„ï¼Ÿ</h3><p>åŸºæœ¬æ•°æ®ç±»å‹çš„å¤§å°æ˜¯å›ºå®šçš„ã€‚å¯¹äºéåŸºæœ¬ç±»å‹çš„ Java å¯¹è±¡ï¼Œå…¶å¤§å°å°±å€¼å¾—å•†æ¦·ã€‚åœ¨ Java ä¸­ï¼Œä¸€ä¸ªç©º <code>Object</code> å¯¹è±¡çš„å¤§å°æ˜¯ 8 byteï¼Œè¿™ä¸ªå¤§å°åªæ˜¯ä¿å­˜å †ä¸­ä¸€ä¸ªæ²¡æœ‰ä»»ä½•å±æ€§çš„å¯¹è±¡çš„<code>å¤§å°ã€‚çœ‹ä¸‹é¢è¯­å¥ï¼š </code>Object ob &#x3D; new Object();<code> è¿™æ ·åœ¨ç¨‹åºä¸­å®Œæˆäº†ä¸€ä¸ª Java å¯¹è±¡çš„ç”Ÿå‘½ï¼Œä½†æ˜¯å®ƒæ‰€å çš„ç©ºé—´ä¸ºï¼š</code>4 byte + 8 byte<code>ã€‚</code>4 byte<code>æ˜¯ä¸Šé¢éƒ¨åˆ†æ‰€è¯´çš„ Java æ ˆä¸­ä¿å­˜å¼•ç”¨çš„æ‰€éœ€è¦çš„ç©ºé—´ã€‚è€Œé‚£</code>8 byte<code>åˆ™æ˜¯ Java å †ä¸­å¯¹è±¡çš„ä¿¡æ¯ã€‚å› ä¸ºæ‰€æœ‰çš„ Java éåŸºæœ¬ç±»å‹çš„å¯¹è±¡éƒ½éœ€è¦é»˜è®¤ç»§æ‰¿</code>Object<code>å¯¹è±¡ï¼Œå› æ­¤ä¸è®ºä»€ä¹ˆæ ·çš„ Java å¯¹è±¡ï¼Œå…¶å¤§å°éƒ½å¿…é¡»æ˜¯å¤§äº</code>8 byte<code>ã€‚æœ‰äº† </code>Object&#96; å¯¹è±¡çš„å¤§å°ï¼Œæˆ‘ä»¬å°±å¯ä»¥è®¡ç®—å…¶ä»–å¯¹è±¡çš„å¤§å°äº†ã€‚</p><p>Java</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Class MaNong &#123;</span><br><span class="line">    int count;</span><br><span class="line">    boolean flag;</span><br><span class="line">    Object obj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>MaNong</code> çš„å¤§å°ä¸ºï¼šç©ºå¯¹è±¡å¤§å°(8 byte) + <code>int</code> å¤§å°(4 byte) + <code>Boolean</code> å¤§å°(1 byte) + ç©º <code>Object</code> å¼•ç”¨çš„<code>å¤§å°ï¼ˆ4 byteï¼‰</code> &#x3D; 17byteã€‚ä½†æ˜¯å› ä¸º Java åœ¨å¯¹å¯¹è±¡å†…å­˜åˆ†é…æ—¶éƒ½æ˜¯ä»¥ 8 çš„æ•´æ•°å€æ¥åˆ†ï¼Œå› æ­¤å¤§äº 17 byte çš„æœ€æ¥è¿‘ 8 çš„æ•´æ•°å€çš„æ˜¯ 24ï¼Œå› æ­¤æ­¤å¯¹è±¡çš„å¤§å°ä¸º 24 byteã€‚</p><p>è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä¸‹åŸºæœ¬ç±»å‹çš„åŒ…è£…ç±»å‹çš„å¤§å°ã€‚å› ä¸ºè¿™ç§åŒ…è£…ç±»å‹å·²ç»æˆä¸ºå¯¹è±¡äº†ï¼Œå› æ­¤éœ€è¦æŠŠå®ƒä»¬ä½œä¸ºå¯¹è±¡æ¥çœ‹å¾…ã€‚åŒ…è£…ç±»å‹çš„å¤§å°è‡³å°‘æ˜¯12 byteï¼ˆå£°æ˜ä¸€ä¸ªç©º <code>Object</code> è‡³å°‘éœ€è¦çš„ç©ºé—´ï¼‰ï¼Œè€Œä¸” 12 byte æ²¡æœ‰åŒ…å«ä»»ä½•æœ‰æ•ˆä¿¡æ¯ï¼ŒåŒæ—¶ï¼Œå› ä¸º Java å¯¹è±¡å¤§å°æ˜¯ 8 çš„æ•´æ•°å€ï¼Œå› æ­¤ä¸€ä¸ªåŸºæœ¬ç±»å‹åŒ…è£…ç±»çš„å¤§å°è‡³å°‘æ˜¯ 16 byteã€‚è¿™ä¸ªå†…å­˜å ç”¨æ˜¯å¾ˆææ€–çš„ï¼Œå®ƒæ˜¯ä½¿ç”¨åŸºæœ¬ç±»å‹çš„ N å€ï¼ˆN &gt; 2ï¼‰ï¼Œæœ‰äº›ç±»å‹çš„å†…å­˜å ç”¨æ›´æ˜¯å¤¸å¼ ï¼ˆéšä¾¿æƒ³ä¸‹å°±çŸ¥é“äº†ï¼‰ã€‚å› æ­¤ï¼Œå¯èƒ½çš„è¯åº”å°½é‡å°‘ä½¿ç”¨åŒ…è£…ç±»ã€‚åœ¨ JDK5 ä»¥åï¼Œå› ä¸ºåŠ å…¥äº†è‡ªåŠ¨ç±»å‹è£…æ¢ï¼Œå› æ­¤ï¼ŒJava è™šæ‹Ÿæœºä¼šåœ¨å­˜å‚¨æ–¹é¢è¿›è¡Œç›¸åº”çš„ä¼˜åŒ–ã€‚</p><hr><h3 id="8-å¯¹è±¡çš„è®¿é—®å®šä½çš„ä¸¤ç§æ–¹å¼ï¼Ÿ"><a href="#8-å¯¹è±¡çš„è®¿é—®å®šä½çš„ä¸¤ç§æ–¹å¼ï¼Ÿ" class="headerlink" title="8. å¯¹è±¡çš„è®¿é—®å®šä½çš„ä¸¤ç§æ–¹å¼ï¼Ÿ"></a>8. å¯¹è±¡çš„è®¿é—®å®šä½çš„ä¸¤ç§æ–¹å¼ï¼Ÿ</h3><p>Java ç¨‹åºé€šè¿‡æ ˆä¸Šçš„å¼•ç”¨æ•°æ®æ¥æ“ä½œå †ä¸Šçš„å…·ä½“å¯¹è±¡ã€‚ç›®å‰ä¸»æµçš„å¯¹è±¡è®¿é—®æ–¹å¼æœ‰ï¼šå¥æŸ„ å’Œ ç›´æ¥æŒ‡é’ˆã€‚</p><ol><li><p>ä½¿ç”¨å¥æŸ„</p><p>å¦‚æœä½¿ç”¨å¥æŸ„çš„è¯ï¼Œé‚£ä¹ˆ Java å †ä¸­å°†ä¼šåˆ’åˆ†å‡ºä¸€å—å†…å­˜æ¥ä½œä¸ºå¥æŸ„æ± ï¼Œå¼•ç”¨ä¸­å­˜å‚¨çš„å°±æ˜¯å¯¹è±¡çš„å¥æŸ„åœ°å€ï¼Œè€Œå¥æŸ„ä¸­åŒ…å«äº†å¯¹è±¡å®ä¾‹æ•°æ®ä¸ç±»å‹æ•°æ®å„è‡ªçš„å…·ä½“åœ°å€ä¿¡æ¯ã€‚</p></li><li><p>ç›´æ¥æŒ‡é’ˆ</p><p>å¦‚æœä½¿ç”¨ç›´æ¥æŒ‡é’ˆè®¿é—®ï¼Œé‚£ä¹ˆ Java å †å¯¹è±¡çš„å¸ƒå±€ä¸­å°±å¿…é¡»è€ƒè™‘å¦‚ä½•é˜²æ­¢è®¿é—®ç±»å‹æ•°æ®çš„ç›¸å…³ä¿¡æ¯ï¼Œreference ä¸­å­˜å‚¨çš„ç›´æ¥å°±æ˜¯å¯¹è±¡çš„åœ°å€ã€‚</p></li><li><p><strong>å„è‡ªçš„ä¼˜ç‚¹</strong></p></li><li><p>ä½¿ç”¨å¥æŸ„æ¥è®¿é—®çš„æœ€å¤§å¥½å¤„æ˜¯å¼•ç”¨ä¸­å­˜å‚¨çš„æ˜¯ç¨³å®šçš„å¥æŸ„åœ°å€ï¼Œåœ¨å¯¹è±¡è¢«ç§»åŠ¨æ—¶åªä¼šæ”¹å˜å¥æŸ„ä¸­çš„å®ä¾‹æ•°æ®æŒ‡é’ˆï¼Œè€Œå¼•ç”¨æœ¬èº«ä¸éœ€è¦ä¿®æ”¹ï¼›</p></li><li><p>ä½¿ç”¨ç›´æ¥æŒ‡é’ˆè®¿é—®æ–¹å¼æœ€å¤§çš„å¥½å¤„å°±æ˜¯é€Ÿåº¦å¿«ï¼Œå®ƒèŠ‚çœäº†ä¸€æ¬¡æŒ‡é’ˆå®šä½çš„æ—¶é—´å¼€é”€ã€‚</p></li></ol><h3 id="JVM-è°ƒä¼˜å‚æ•°"><a href="#JVM-è°ƒä¼˜å‚æ•°" class="headerlink" title="JVM è°ƒä¼˜å‚æ•°"></a>JVM è°ƒä¼˜å‚æ•°</h3><ul><li><strong>å †å†…å­˜å¤§å°è®¾ç½®:</strong><ul><li>-Xms<size>:è®¾ç½® JVM å †çš„åˆå§‹å†…å­˜å¤§å°ã€‚</li><li>-Xmx<size>:è®¾ç½® JVM å †çš„æœ€å¤§å†…å­˜å¤§å°ã€‚</li><li>æœ€ä½³å®è·µ:é€šå¸¸å»ºè®® -Xms å’Œ -Xmx è®¾ç½®ä¸ºç›¸åŒå€¼ï¼Œä»¥é¿å… JVM åœ¨è¿è¡Œæ—¶åŠ¨æ€è°ƒæ•´å †å¤§å°å¸¦æ¥çš„é¢å¤–å¼€é”€å’Œ GC åœé¡¿ã€‚ä¾‹å¦‚ -Xms4g -Xmx4gã€‚</li></ul></li><li><strong>æ–°ç”Ÿä»£å¤§å°è®¾ç½®:</strong><ul><li>-Xmn<size>:è®¾ç½®æ–°ç”Ÿä»£å†…å­˜å¤§å°ã€‚</li><li>-XX:NewRatio&#x3D;<ratio>:è®¾ç½®è€å¹´ä»£ä¸æ–°ç”Ÿä»£çš„æ¯”ä¾‹ï¼Œä¾‹å¦‚ -XX:NewRatio&#x3D;2 è¡¨ç¤ºè€å¹´ä»£:æ–°ç”Ÿä»£ &#x3D; 2:1ã€‚</li><li>è€ƒé‡:<ul><li>æ–°ç”Ÿä»£è¿‡å°:é¢‘ç¹ Minor GC, å¯¼è‡´å¯¹è±¡è¿‡æ—©è¿›å…¥è€å¹´ä»£ã€‚</li><li>æ–°ç”Ÿä»£è¿‡å¤§:Minor GC é—´éš”é•¿, ä½†æ¯æ¬¡ GC è€—æ—¶å¯èƒ½é•¿ã€‚</li></ul></li></ul></li><li><strong>å…ƒç©ºé—´å¤§å°è®¾ç½® (JDK 1.8+):</strong><ul><li>-XX:MetaspaceSize&#x3D;<size>:è®¾ç½®å…ƒç©ºé—´çš„åˆå§‹å¤§å°ã€‚</li><li>-XX:MaxMetaspaceSize&#x3D;<size>:è®¾ç½®å…ƒç©ºé—´çš„æœ€å¤§å¤§å°ã€‚</li><li>è€ƒé‡:å¦‚æœåº”ç”¨åŠ è½½å¤§é‡ç±»æˆ–ä½¿ç”¨åŠ¨æ€ä»£ç ç”Ÿæˆ, å¯èƒ½éœ€è¦è°ƒå¤§ã€‚</li></ul></li><li><strong>é€‰æ‹©åƒåœ¾æ”¶é›†å™¨:</strong><ul><li>-XX:+UseG1GC:å¯ç”¨ G1 åƒåœ¾æ”¶é›†å™¨ã€‚è¿™æ˜¯ JDK 9+ çš„é»˜è®¤æ”¶é›†å™¨ã€‚</li><li>-XX:MaxGCPauseMillis&#x3D;<ms>:è®¾ç½® G1 æ”¶é›†å™¨å¯æ¥å—çš„æœ€å¤§åœé¡¿æ—¶é—´(G1 ä¼šå°½é‡æ¥è¿‘è¿™ä¸ªç›®æ ‡, ä½†ä¸ä¿è¯å®Œå…¨è¾¾åˆ°)ã€‚ä¾‹å¦‚ -XX:MaxGCPauseMillis&#x3D;200ã€‚</li></ul></li></ul><h3 id="10-åƒåœ¾å›æ”¶æ˜¯ä»å“ªé‡Œå¼€å§‹çš„å‘¢ï¼Ÿ"><a href="#10-åƒåœ¾å›æ”¶æ˜¯ä»å“ªé‡Œå¼€å§‹çš„å‘¢ï¼Ÿ" class="headerlink" title="10. åƒåœ¾å›æ”¶æ˜¯ä»å“ªé‡Œå¼€å§‹çš„å‘¢ï¼Ÿ"></a>10. åƒåœ¾å›æ”¶æ˜¯ä»å“ªé‡Œå¼€å§‹çš„å‘¢ï¼Ÿ</h3><p>åƒåœ¾å›æ”¶ä»æŸ¥æ‰¾å“ªäº›å¯¹è±¡æ˜¯æ­£åœ¨è¢«å½“å‰ç³»ç»Ÿä½¿ç”¨çš„å¼€å§‹ã€‚ä¸Šé¢åˆ†æçš„å †å’Œæ ˆçš„åŒºåˆ«ï¼Œå…¶ä¸­æ ˆæ˜¯çœŸæ­£è¿›è¡Œç¨‹åºæ‰§è¡Œçš„åœ°æ–¹ï¼Œæ‰€ä»¥è¦è·å–å“ªäº›å¯¹è±¡æ­£åœ¨è¢«ä½¿ç”¨ï¼Œåˆ™éœ€è¦ä» Java æ ˆå¼€å§‹ã€‚åŒæ—¶ï¼Œä¸€ä¸ªæ ˆæ˜¯ä¸ä¸€ä¸ªçº¿ç¨‹å¯¹åº”çš„ï¼Œå› æ­¤ï¼Œå¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹çš„è¯ï¼Œåˆ™å¿…é¡»å¯¹è¿™äº›çº¿ç¨‹å¯¹åº”çš„æ‰€æœ‰çš„æ ˆè¿›è¡Œæ£€æŸ¥ã€‚</p><p>åŒæ—¶ï¼Œé™¤äº†æ ˆå¤–ï¼Œè¿˜æœ‰ç³»ç»Ÿè¿è¡Œæ—¶çš„å¯„å­˜å™¨ç­‰ï¼Œä¹Ÿæ˜¯å­˜å‚¨ç¨‹åºè¿è¡Œæ•°æ®çš„ã€‚è¿™æ ·ï¼Œä»¥æ ˆæˆ–å¯„å­˜å™¨ä¸­çš„å¼•ç”¨ä¸ºèµ·ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°å †ä¸­çš„å¯¹è±¡ï¼Œåˆä»è¿™äº›å¯¹è±¡æ‰¾åˆ°å¯¹å †ä¸­å…¶ä»–å¯¹è±¡çš„å¼•ç”¨ï¼Œè¿™ç§å¼•ç”¨é€æ­¥æ‰©å±•ï¼Œæœ€ç»ˆä»¥ <code>null</code> å¼•ç”¨æˆ–è€…åŸºæœ¬ç±»å‹ç»“æŸï¼Œè¿™æ ·å°±å½¢æˆäº†ä¸€æ£µä»¥ Java æ ˆä¸­å¼•ç”¨æ‰€å¯¹åº”çš„å¯¹è±¡ä¸ºæ ¹èŠ‚ç‚¹çš„ä¸€æ£µå¯¹è±¡æ ‘ã€‚å¦‚æœæ ˆä¸­æœ‰å¤šä¸ªå¼•ç”¨ï¼Œåˆ™æœ€ç»ˆä¼šå½¢æˆå¤šæ£µå¯¹è±¡æ ‘ã€‚åœ¨è¿™äº›å¯¹è±¡æ ‘ä¸Šçš„å¯¹è±¡ï¼Œéƒ½æ˜¯å½“å‰ç³»ç»Ÿè¿è¡Œæ‰€éœ€è¦çš„å¯¹è±¡ï¼Œä¸èƒ½è¢«åƒåœ¾å›æ”¶ã€‚è€Œå…¶ä»–å‰©ä½™å¯¹è±¡ï¼Œåˆ™å¯ä»¥è§†ä¸ºæ— æ³•è¢«å¼•ç”¨åˆ°çš„å¯¹è±¡ï¼Œå¯ä»¥è¢«å½“åšåƒåœ¾è¿›è¡Œå›æ”¶ã€‚</p><hr><h3 id="11-è¢«æ ‡è®°ä¸ºåƒåœ¾çš„å¯¹è±¡ä¸€å®šä¼šè¢«å›æ”¶å—ï¼Ÿ"><a href="#11-è¢«æ ‡è®°ä¸ºåƒåœ¾çš„å¯¹è±¡ä¸€å®šä¼šè¢«å›æ”¶å—ï¼Ÿ" class="headerlink" title="11. è¢«æ ‡è®°ä¸ºåƒåœ¾çš„å¯¹è±¡ä¸€å®šä¼šè¢«å›æ”¶å—ï¼Ÿ"></a>11. è¢«æ ‡è®°ä¸ºåƒåœ¾çš„å¯¹è±¡ä¸€å®šä¼šè¢«å›æ”¶å—ï¼Ÿ</h3><p>å³ä½¿åœ¨å¯è¾¾æ€§åˆ†æç®—æ³•ä¸­ä¸å¯è¾¾çš„å¯¹è±¡ï¼Œä¹Ÿå¹¶éæ˜¯â€œéæ­»ä¸å¯â€ï¼Œè¿™æ—¶å€™å®ƒä»¬æš‚æ—¶å¤„äºâ€œç¼“åˆ‘â€é˜¶æ®µï¼Œè¦çœŸæ­£å®£å‘Šä¸€ä¸ªå¯¹è±¡æ­»äº¡ï¼Œè‡³å°‘è¦ç»å†ä¸¤æ¬¡æ ‡è®°è¿‡ç¨‹ã€‚</p><ul><li><strong>ç¬¬ä¸€æ¬¡æ ‡è®°</strong>ï¼šå¦‚æœå¯¹è±¡åœ¨è¿›è¡Œå¯è¾¾æ€§åˆ†æåå‘ç°æ²¡æœ‰ä¸ GC Roots ç›¸è¿æ¥çš„å¼•ç”¨é“¾ï¼Œé‚£å®ƒå°†ä¼šè¢«ç¬¬ä¸€æ¬¡æ ‡è®°ï¼›</li><li><strong>ç¬¬äºŒæ¬¡æ ‡è®°</strong>ï¼šç¬¬ä¸€æ¬¡æ ‡è®°åæ¥ç€ä¼šè¿›è¡Œä¸€æ¬¡ç­›é€‰ï¼Œç­›é€‰çš„æ¡ä»¶æ˜¯æ­¤å¯¹è±¡æ˜¯å¦æœ‰å¿…è¦æ‰§è¡Œ <code>finalize()</code> æ–¹æ³•ã€‚åœ¨ <code>finalize()</code> æ–¹æ³•ä¸­æ²¡æœ‰é‡æ–°ä¸å¼•ç”¨é“¾å»ºç«‹å…³è”å…³ç³»çš„ï¼Œå°†è¢«è¿›è¡Œç¬¬äºŒæ¬¡æ ‡è®°ã€‚ç¬¬äºŒæ¬¡æ ‡è®°æˆåŠŸçš„å¯¹è±¡å°†çœŸçš„ä¼šè¢«å›æ”¶ï¼Œå¦‚æœå¯¹è±¡åœ¨ <code>finalize()</code> æ–¹æ³•ä¸­é‡æ–°ä¸å¼•ç”¨é“¾å»ºç«‹äº†å…³è”å…³ç³»ï¼Œé‚£ä¹ˆå°†ä¼šé€ƒç¦»æœ¬æ¬¡å›æ”¶ï¼Œç»§ç»­å­˜æ´»ã€‚</li></ul><hr><h3 id="12-è°ˆè°ˆå¯¹-Java-ä¸­å¼•ç”¨çš„äº†è§£ï¼Ÿ"><a href="#12-è°ˆè°ˆå¯¹-Java-ä¸­å¼•ç”¨çš„äº†è§£ï¼Ÿ" class="headerlink" title="12. è°ˆè°ˆå¯¹ Java ä¸­å¼•ç”¨çš„äº†è§£ï¼Ÿ"></a>12. è°ˆè°ˆå¯¹ Java ä¸­å¼•ç”¨çš„äº†è§£ï¼Ÿ</h3><p>æ— è®ºæ˜¯é€šè¿‡å¼•ç”¨è®¡æ•°ç®—æ³•åˆ¤æ–­å¯¹è±¡çš„å¼•ç”¨æ•°é‡ï¼Œè¿˜æ˜¯é€šè¿‡å¯è¾¾æ€§åˆ†æç®—æ³•åˆ¤æ–­å¯¹è±¡çš„å¼•ç”¨é“¾æ˜¯å¦å¯è¾¾ï¼Œåˆ¤å®šå¯¹è±¡æ˜¯å¦å­˜æ´»éƒ½ä¸â€œå¼•ç”¨â€æœ‰å…³ã€‚åœ¨Javaè¯­è¨€ä¸­ï¼Œå°†å¼•ç”¨åˆåˆ†ä¸ºå¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨ 4 ç§ï¼Œè¿™å››ç§å¼•ç”¨å¼ºåº¦ä¾æ¬¡é€æ¸å‡å¼±ã€‚</p><ol><li><p>å¼ºå¼•ç”¨</p><p>åœ¨ç¨‹åºä»£ç ä¸­æ™®éå­˜åœ¨çš„ï¼Œç±»ä¼¼ Object obj &#x3D; new Object() è¿™ç±»å¼•ç”¨ï¼Œåªè¦å¼ºå¼•ç”¨è¿˜å­˜åœ¨ï¼Œåƒåœ¾æ”¶é›†å™¨æ°¸è¿œä¸ä¼šå›æ”¶æ‰è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚</p></li><li><p>è½¯å¼•ç”¨</p><p>ç”¨æ¥æè¿°ä¸€äº›è¿˜æœ‰ç”¨ä½†å¹¶éå¿…é¡»çš„å¯¹è±¡ã€‚å¯¹äºè½¯å¼•ç”¨å…³è”ç€çš„å¯¹è±¡ï¼Œåœ¨ç³»ç»Ÿå°†è¦å‘ç”Ÿå†…å­˜æº¢å‡ºå¼‚å¸¸ä¹‹å‰ï¼Œå°†ä¼šæŠŠè¿™äº›å¯¹è±¡åˆ—è¿›å›æ”¶èŒƒå›´ä¹‹ä¸­è¿›è¡Œç¬¬äºŒæ¬¡å›æ”¶ã€‚å¦‚æœè¿™æ¬¡å›æ”¶åè¿˜æ²¡æœ‰è¶³å¤Ÿçš„å†…</p></li><li><p>å¼±å¼•ç”¨</p><p>ä¹Ÿæ˜¯ç”¨æ¥æè¿°éå¿…éœ€å¯¹è±¡çš„ï¼Œä½†æ˜¯å®ƒçš„å¼ºåº¦æ¯”è½¯å¼•ç”¨æ›´å¼±ä¸€äº›ï¼Œè¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡åªèƒ½ç”Ÿå­˜åˆ°ä¸‹ä¸€æ¬¡åƒåœ¾æ”¶é›†å‘ç”Ÿä¹‹å‰ã€‚å½“åƒåœ¾æ”¶é›†å™¨å·¥ä½œæ—¶ï¼Œæ— è®ºå½“å‰å†…å­˜æ˜¯å¦è¶³å¤Ÿï¼Œéƒ½ä¼šå›æ”¶æ‰åªè¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡ã€‚</p></li><li><p>è™šå¼•ç”¨</p><p>ä¹Ÿå«å¹½çµå¼•ç”¨æˆ–å¹»å½±å¼•ç”¨ï¼Œæ˜¯æœ€å¼±çš„ä¸€ç§å¼•ç”¨å…³ç³»ã€‚ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æœ‰è™šå¼•ç”¨çš„å­˜åœ¨ï¼Œå®Œå…¨ä¸ä¼šå¯¹å…¶ç”Ÿå­˜æ—¶é—´æ„æˆå½±å“ï¼Œä¹Ÿæ— æ³•é€šè¿‡è™šå¼•ç”¨æ¥å–å¾—ä¸€ä¸ªå¯¹è±¡å®ä¾‹ã€‚å®ƒçš„ä½œç”¨æ˜¯èƒ½åœ¨è¿™ä¸ªå¯¹è±¡è¢«æ”¶é›†å™¨å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ã€‚</p></li></ol><hr><h3 id="13-è°ˆè°ˆå¯¹å†…å­˜æ³„æ¼çš„ç†è§£ï¼Ÿ"><a href="#13-è°ˆè°ˆå¯¹å†…å­˜æ³„æ¼çš„ç†è§£ï¼Ÿ" class="headerlink" title="13. è°ˆè°ˆå¯¹å†…å­˜æ³„æ¼çš„ç†è§£ï¼Ÿ"></a>13. è°ˆè°ˆå¯¹å†…å­˜æ³„æ¼çš„ç†è§£ï¼Ÿ</h3><p>å†…å­˜æ³„éœ²çš„åŸºæœ¬æ¦‚å¿µ</p><p>åœ¨ Java ä¸­ï¼Œå†…å­˜æ³„æ¼å°±æ˜¯å­˜åœ¨ä¸€äº›ä¸ä¼šå†è¢«ä½¿ç”¨å´æ²¡æœ‰è¢«å›æ”¶çš„å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡æœ‰ä¸‹é¢ä¸¤ä¸ªç‰¹ç‚¹ï¼š</p><ol><li><p>è¿™äº›å¯¹è±¡æ˜¯å¯è¾¾çš„ï¼Œå³åœ¨æœ‰å‘å›¾ä¸­ï¼Œå­˜åœ¨é€šè·¯å¯ä»¥ä¸å…¶ç›¸è¿ï¼›</p></li><li><p>è¿™äº›å¯¹è±¡æ˜¯æ— ç”¨çš„ï¼Œå³ç¨‹åºä»¥åä¸ä¼šå†ä½¿ç”¨è¿™äº›å¯¹è±¡ã€‚</p><p>å¦‚æœå¯¹è±¡æ»¡è¶³è¿™ä¸¤ä¸ªæ¡ä»¶ï¼Œè¿™äº›å¯¹è±¡å°±å¯ä»¥åˆ¤å®šä¸º Java ä¸­çš„å†…å­˜æ³„æ¼ï¼Œè¿™äº›å¯¹è±¡ä¸ä¼šè¢« GC æ‰€å›æ”¶ï¼Œç„¶è€Œå®ƒå´å ç”¨å†…å­˜ã€‚</p></li></ol><hr><h3 id="14-å†…å­˜æ³„éœ²çš„æ ¹æœ¬åŸå› æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#14-å†…å­˜æ³„éœ²çš„æ ¹æœ¬åŸå› æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="14. å†…å­˜æ³„éœ²çš„æ ¹æœ¬åŸå› æ˜¯ä»€ä¹ˆï¼Ÿ"></a>14. å†…å­˜æ³„éœ²çš„æ ¹æœ¬åŸå› æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>é•¿ç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡æŒæœ‰çŸ­ç”Ÿå‘½å‘¨æœŸå¯¹è±¡çš„å¼•ç”¨å°±å¾ˆå¯èƒ½å‘ç”Ÿå†…å­˜æ³„æ¼ï¼Œå°½ç®¡çŸ­ç”Ÿå‘½å‘¨æœŸå¯¹è±¡å·²ç»ä¸å†éœ€è¦ï¼Œä½†æ˜¯å› ä¸ºé•¿ç”Ÿå‘½å‘¨æœŸæŒæœ‰å®ƒçš„å¼•ç”¨è€Œå¯¼è‡´ä¸èƒ½è¢«å›æ”¶ï¼Œè¿™å°±æ˜¯ Java ä¸­å†…å­˜æ³„æ¼çš„å‘ç”Ÿåœºæ™¯ã€‚</p><hr><h3 id="15-ä¸¾å‡ ä¸ªå¯èƒ½å‘ç”Ÿå†…å­˜æ³„æ¼çš„æƒ…å†µï¼Ÿ"><a href="#15-ä¸¾å‡ ä¸ªå¯èƒ½å‘ç”Ÿå†…å­˜æ³„æ¼çš„æƒ…å†µï¼Ÿ" class="headerlink" title="15. ä¸¾å‡ ä¸ªå¯èƒ½å‘ç”Ÿå†…å­˜æ³„æ¼çš„æƒ…å†µï¼Ÿ"></a>15. ä¸¾å‡ ä¸ªå¯èƒ½å‘ç”Ÿå†…å­˜æ³„æ¼çš„æƒ…å†µï¼Ÿ</h3><ol><li>é™æ€é›†åˆç±»å¼•èµ·çš„å†…å­˜æ³„æ¼ï¼›</li><li>å½“é›†åˆé‡Œé¢çš„å¯¹è±¡å±æ€§è¢«ä¿®æ”¹åï¼Œå†è°ƒç”¨ <code>remove()</code> æ–¹æ³•æ—¶ä¸èµ·ä½œç”¨ï¼›</li><li>ç›‘å¬å™¨ï¼šé‡Šæ”¾å¯¹è±¡çš„æ—¶å€™æ²¡æœ‰åˆ é™¤ç›‘å¬å™¨ï¼›</li><li>å„ç§è¿æ¥ï¼šæ¯”å¦‚æ•°æ®åº“è¿æ¥ï¼ˆ<code>dataSourse.getConnection()</code>ï¼‰ï¼Œç½‘ç»œè¿æ¥(<code>socket</code>) å’Œ IO è¿æ¥ï¼Œé™¤éå…¶æ˜¾å¼çš„è°ƒç”¨äº†å…¶ <code>close()</code> æ–¹æ³•å°†å…¶è¿æ¥å…³é—­ï¼Œå¦åˆ™æ˜¯ä¸ä¼šè‡ªåŠ¨è¢« GC å›æ”¶çš„ï¼›</li><li>å†…éƒ¨ç±»ï¼šå†…éƒ¨ç±»çš„å¼•ç”¨æ˜¯æ¯”è¾ƒå®¹æ˜“é—å¿˜çš„ä¸€ç§ï¼Œè€Œä¸”ä¸€æ—¦æ²¡é‡Šæ”¾å¯èƒ½å¯¼è‡´ä¸€ç³»åˆ—çš„åç»§ç±»å¯¹è±¡æ²¡æœ‰é‡Šæ”¾ï¼›</li><li>å•ä¾‹æ¨¡å¼ï¼šå•ä¾‹å¯¹è±¡åœ¨åˆå§‹åŒ–åå°†åœ¨ JVM çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­å­˜åœ¨ï¼ˆä»¥é™æ€å˜é‡çš„æ–¹å¼ï¼‰ï¼Œå¦‚æœå•ä¾‹å¯¹è±¡æŒæœ‰å¤–éƒ¨çš„å¼•ç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å°†ä¸èƒ½è¢« JVM æ­£å¸¸å›æ”¶ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼ã€‚</li></ol><hr><h3 id="16-å°½é‡é¿å…å†…å­˜æ³„æ¼çš„æ–¹æ³•ï¼Ÿ"><a href="#16-å°½é‡é¿å…å†…å­˜æ³„æ¼çš„æ–¹æ³•ï¼Ÿ" class="headerlink" title="16. å°½é‡é¿å…å†…å­˜æ³„æ¼çš„æ–¹æ³•ï¼Ÿ"></a>16. å°½é‡é¿å…å†…å­˜æ³„æ¼çš„æ–¹æ³•ï¼Ÿ</h3><ol><li>å°½é‡ä¸è¦ä½¿ç”¨ <code>static</code> æˆå‘˜å˜é‡ï¼Œå‡å°‘ç”Ÿå‘½å‘¨æœŸï¼›</li><li>åŠæ—¶å…³é—­èµ„æºï¼›</li><li>ä¸ç”¨çš„å¯¹è±¡ï¼Œå¯ä»¥æ‰‹åŠ¨è®¾ç½®ä¸º <code>null</code>ã€‚</li></ol><h3 id="åƒåœ¾æ”¶é›†å™¨-Garbage-Collector"><a href="#åƒåœ¾æ”¶é›†å™¨-Garbage-Collector" class="headerlink" title="åƒåœ¾æ”¶é›†å™¨ (Garbage Collector)"></a>åƒåœ¾æ”¶é›†å™¨ (Garbage Collector)</h3><p>åƒåœ¾æ”¶é›†å™¨æ˜¯ JVM çš„ä¸€ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†, è´Ÿè´£è‡ªåŠ¨ç®¡ç† Java å †å†…å­˜ä¸­çš„å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ, å›æ”¶ä¸å†ä½¿ç”¨çš„å¯¹è±¡æ‰€å ç”¨çš„å†…å­˜ã€‚</p><h4 id="åƒåœ¾åˆ¤æ–­ç®—æ³•"><a href="#åƒåœ¾åˆ¤æ–­ç®—æ³•" class="headerlink" title="åƒåœ¾åˆ¤æ–­ç®—æ³•:"></a><strong>åƒåœ¾åˆ¤æ–­ç®—æ³•:</strong></h4><ul><li>å¼•ç”¨è®¡æ•°ç®—æ³•:å½“ä¸€ä¸ªå¯¹è±¡è¢«å¼•ç”¨ä¸€æ¬¡, è®¡æ•°å™¨åŠ 1;å¼•ç”¨å¤±æ•ˆ, è®¡æ•°å™¨å‡1ã€‚å½“è®¡æ•°å™¨ä¸º0æ—¶, å¯¹è±¡è¢«åˆ¤å®šä¸ºå¯å›æ”¶ã€‚<ul><li>ç¼ºç‚¹:éš¾ä»¥è§£å†³å¯¹è±¡ä¹‹é—´çš„å¾ªç¯å¼•ç”¨é—®é¢˜ã€‚Java è™šæ‹Ÿæœºä¸é‡‡ç”¨æ­¤ç®—æ³•ã€‚</li></ul></li><li>å¯è¾¾æ€§åˆ†æç®—æ³• (Root Tracing):é€šè¿‡ä¸€ç³»åˆ—ç§°ä¸º â€œGC Rootsâ€ çš„å¯¹è±¡ä½œä¸ºèµ·å§‹ç‚¹, ä»è¿™äº›èŠ‚ç‚¹å‘ä¸‹æœç´¢, æœç´¢æ‰€èµ°è¿‡çš„è·¯å¾„ç§°ä¸ºå¼•ç”¨é“¾ (Reference Chain)ã€‚å½“ä¸€ä¸ªå¯¹è±¡åˆ° GC Roots æ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ç›¸è¿æ—¶, åˆ™è¯æ˜æ­¤å¯¹è±¡æ˜¯ä¸å¯ç”¨çš„ã€‚<ul><li>å¯ä½œä¸º GC Roots çš„å¯¹è±¡:<ul><li>è™šæ‹Ÿæœºæ ˆ (æ ˆå¸§ä¸­çš„å±€éƒ¨å˜é‡è¡¨) ä¸­å¼•ç”¨çš„å¯¹è±¡ã€‚</li><li>æœ¬åœ°æ–¹æ³•æ ˆ (Native æ–¹æ³•) ä¸­å¼•ç”¨çš„å¯¹è±¡ã€‚</li><li>æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡ã€‚</li><li>æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡ã€‚</li><li>è¢«åŒæ­¥é”æŒæœ‰çš„å¯¹è±¡ã€‚</li><li>JVM å†…éƒ¨çš„å¼•ç”¨ (å¦‚åŸºæœ¬æ•°æ®ç±»å‹å¯¹åº”çš„ Class å¯¹è±¡)ã€‚</li></ul></li></ul></li></ul><h4 id="å¸¸è§åƒåœ¾æ”¶é›†å™¨"><a href="#å¸¸è§åƒåœ¾æ”¶é›†å™¨" class="headerlink" title="å¸¸è§åƒåœ¾æ”¶é›†å™¨:"></a><strong>å¸¸è§åƒåœ¾æ”¶é›†å™¨:</strong></h4><ul><li><h5 id="Serial-æ”¶é›†å™¨"><a href="#Serial-æ”¶é›†å™¨" class="headerlink" title="Serial æ”¶é›†å™¨:"></a>Serial æ”¶é›†å™¨:</h5><ul><li>ç‰¹ç‚¹:å•çº¿ç¨‹, å·¥ä½œæ—¶éœ€è¦åœæ­¢æ‰€æœ‰ç”¨æˆ·çº¿ç¨‹ (â€œStop The Worldâ€, STW)ã€‚ç®€å•é«˜æ•ˆ, é€‚ç”¨äºå•æ ¸ CPU æˆ–å†…å­˜è¾ƒå°çš„å®¢æˆ·ç«¯åº”ç”¨ã€‚</li><li>æ–°ç”Ÿä»£ä½¿ç”¨:å¤åˆ¶ç®—æ³•ã€‚</li><li>è€å¹´ä»£ä½¿ç”¨:æ ‡è®°-æ•´ç†ç®—æ³•ã€‚</li></ul></li><li><h5 id="ParNew-æ”¶é›†å™¨"><a href="#ParNew-æ”¶é›†å™¨" class="headerlink" title="ParNew æ”¶é›†å™¨:"></a>ParNew æ”¶é›†å™¨:</h5><ul><li>ç‰¹ç‚¹:Serial æ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬, ç”¨äºæ–°ç”Ÿä»£ã€‚å¹¶è¡Œæ”¶é›†æ—¶ä¹Ÿéœ€è¦ STWã€‚</li><li>æ–°ç”Ÿä»£ä½¿ç”¨:å¤åˆ¶ç®—æ³•ã€‚</li><li>å¸¸ä¸ CMS æ”¶é›†å™¨é…åˆä½¿ç”¨ã€‚</li></ul></li><li><h5 id="Parallel-Scavenge-æ”¶é›†å™¨"><a href="#Parallel-Scavenge-æ”¶é›†å™¨" class="headerlink" title="Parallel Scavenge æ”¶é›†å™¨:"></a>Parallel Scavenge æ”¶é›†å™¨:</h5><ul><li>ç‰¹ç‚¹ï¼šå…³æ³¨ååé‡ï¼ˆThroughput &#x3D; ç”¨æˆ·ä»£ç æ‰§è¡Œæ—¶é—´ &#x2F; (ç”¨æˆ·ä»£ç æ‰§è¡Œæ—¶é—´ + GC æ—¶é—´)ï¼‰ï¼Œå¯ä»¥è®¾ç½®æœ€å¤§ååé‡æˆ–æœ€å¤§ GC åœé¡¿æ—¶é—´ã€‚</li><li>æ–°ç”Ÿä»£ä½¿ç”¨ï¼šå¤åˆ¶ç®—æ³•ã€‚</li><li>è€å¹´ä»£ä½¿ç”¨ï¼šä¸ Parallel Old é…åˆä½¿ç”¨ï¼Œä½¿ç”¨æ ‡è®°-æ•´ç†ç®—æ³•ã€‚</li></ul></li><li><h5 id="CMS-Concurrent-Mark-Sweep-æ”¶é›†å™¨ï¼š"><a href="#CMS-Concurrent-Mark-Sweep-æ”¶é›†å™¨ï¼š" class="headerlink" title="CMS (Concurrent Mark Sweep) æ”¶é›†å™¨ï¼š"></a>CMS (Concurrent Mark Sweep) æ”¶é›†å™¨ï¼š</h5><ul><li>ç‰¹ç‚¹ï¼šä»¥è·å–æœ€çŸ­å›æ”¶åœé¡¿æ—¶é—´ä¸ºç›®æ ‡ï¼Œå¹¶å‘æ”¶é›†ï¼ˆä¸ç”¨æˆ·çº¿ç¨‹ä¸€èµ·æ‰§è¡Œï¼‰ã€‚é€‚ç”¨äºå¯¹å“åº”æ—¶é—´è¦æ±‚é«˜çš„åº”ç”¨ï¼ˆå¦‚ Web æœåŠ¡å™¨ï¼‰ã€‚</li><li>å·¥ä½œæ­¥éª¤ï¼š<ol><li>åˆå§‹æ ‡è®° (Initial Mark)ï¼šSTWï¼Œæ ‡è®° GC Roots èƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡ï¼Œé€Ÿåº¦å¿«ã€‚</li><li>å¹¶å‘æ ‡è®° (Concurrent Mark)ï¼šä¸ç”¨æˆ·çº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼Œè¿›è¡Œ GC Roots Tracing è¿‡ç¨‹ï¼Œè€—æ—¶æœ€é•¿ã€‚</li><li>é‡æ–°æ ‡è®° (Remark)ï¼šSTWï¼Œä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´å› ç”¨æˆ·ç¨‹åºç»§ç»­è¿è¡Œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„å¯¹è±¡ï¼Œæ¯”åˆå§‹æ ‡è®°è€—æ—¶é•¿ï¼Œä½†è¿œæ¯”å¹¶å‘æ ‡è®°çŸ­ã€‚</li><li>å¹¶å‘æ¸…é™¤ (Concurrent Sweep)ï¼šä¸ç”¨æˆ·çº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼Œæ¸…é™¤å·²æ ‡è®°ä¸ºåƒåœ¾çš„å¯¹è±¡ã€‚</li></ol></li><li>ç¼ºç‚¹ï¼š<ul><li>å¯¹ CPU èµ„æºæ•æ„Ÿï¼šå¹¶å‘é˜¶æ®µä¼šå ç”¨ä¸€éƒ¨åˆ† CPUã€‚</li><li>æ— æ³•å¤„ç†æµ®åŠ¨åƒåœ¾ï¼šå¹¶å‘æ¸…é™¤é˜¶æ®µäº§ç”Ÿçš„åƒåœ¾ï¼ˆæ–°ç”Ÿæˆçš„å¯¹è±¡ï¼‰åªèƒ½ä¸‹æ¬¡ GC å†å¤„ç†ã€‚</li><li>å¯èƒ½äº§ç”Ÿå¤§é‡ç©ºé—´ç¢ç‰‡ï¼šé‡‡ç”¨â€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•ï¼Œä¸è¿›è¡Œæ•´ç†ï¼Œå¯èƒ½å¯¼è‡´å¤§å¯¹è±¡æ— æ³•åˆ†é…ç©ºé—´è€Œæå‰è§¦å‘ Full GCã€‚</li></ul></li></ul></li><li><h5 id="G1-Garbage-First-æ”¶é›†å™¨ï¼š"><a href="#G1-Garbage-First-æ”¶é›†å™¨ï¼š" class="headerlink" title="G1 (Garbage-First) æ”¶é›†å™¨ï¼š"></a>G1 (Garbage-First) æ”¶é›†å™¨ï¼š</h5><ul><li>ç‰¹ç‚¹ï¼šJDK 9+ çš„é»˜è®¤åƒåœ¾æ”¶é›†å™¨ã€‚é¢å‘æœåŠ¡ç«¯åº”ç”¨ï¼Œåˆ†åŒºï¼ˆå°† Java å †åˆ’åˆ†ä¸ºå¤šä¸ªç‹¬ç«‹åŒºåŸŸ Region)ï¼Œå¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹ã€‚</li><li>å·¥ä½œåŸç†ï¼š<ul><li>å°†å †å†…å­˜åˆ’åˆ†ä¸ºå¤šä¸ªå¤§å°ç›¸ç­‰çš„ Regionã€‚</li><li>G1 è·Ÿè¸ªæ¯ä¸ª Region çš„åƒåœ¾å›æ”¶ä»·å€¼ (Garbage-First)ï¼Œä¼˜å…ˆå›æ”¶åƒåœ¾æœ€å¤šçš„ Regionã€‚</li><li>å¹´è½»åŒ–å’Œè€å¹´ä»£ä¸å†æ˜¯ç‰©ç†éš”ç¦»ï¼Œè€Œæ˜¯é€»è¾‘ä¸Šçš„æ¦‚å¿µï¼ŒRegion å¯ä»¥åŠ¨æ€åœ°æˆä¸º Edenã€Survivor æˆ– Old åŒºåŸŸã€‚</li><li>å¹¶å‘ä¸å¹¶è¡Œå…¼å®¹ï¼šå¹¶å‘æ ‡è®°ï¼Œä½†å›æ”¶é˜¶æ®µå¹¶è¡Œã€‚</li><li>åŸºæœ¬æ— ç¢ç‰‡ï¼šé‡‡ç”¨å¤åˆ¶å’Œæ ‡è®°-æ•´ç†ç®—æ³•ç»“åˆã€‚</li></ul></li><li>å·¥ä½œæ­¥éª¤ï¼š<ol><li>åˆå§‹æ ‡è®° (Initial Mark)ï¼šSTWï¼Œæ ‡è®° GC Roots èƒ½ç›´æ¥å…³è”çš„å¯¹è±¡ã€‚</li><li>å¹¶å‘æ ‡è®° (Concurrent Mark)ï¼šä¸ç”¨æˆ·çº¿ç¨‹å¹¶å‘ï¼Œéå†å¯¹è±¡å›¾ã€‚</li><li>æœ€ç»ˆæ ‡è®° (Final Mark)ï¼šSTWï¼Œå¤„ç†å¹¶å‘æ ‡è®°é˜¶æ®µç»“æŸåä»ç„¶å­˜æ´»çš„å¯¹è±¡ã€‚</li><li>ç­›é€‰å›æ”¶ (Evacuation)ï¼šSTWï¼Œå¯¹å„ä¸ª Region çš„å›æ”¶ä»·å€¼è¿›è¡Œæ’åºï¼Œæ ¹æ®é¢„æœŸåœé¡¿æ—¶é—´æ¥å›æ”¶ Regionï¼Œé‡‡ç”¨å¤åˆ¶ç®—æ³•å°†å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°æ–°çš„ Regionã€‚</li></ol></li><li>ä¼˜åŠ¿ï¼šåœ¨ä¿æŒé«˜ååé‡çš„åŒæ—¶ï¼Œé™ä½äº† GC åœé¡¿æ—¶é—´ï¼Œé€‚åˆå¤§å†…å­˜ã€å¤šæ ¸å¤„ç†å™¨åœºæ™¯ã€‚</li></ul></li><li><h5 id="zGC-Z-Garbage-Collector-å’Œ-Shenandoah-æ”¶é›†å™¨ï¼š"><a href="#zGC-Z-Garbage-Collector-å’Œ-Shenandoah-æ”¶é›†å™¨ï¼š" class="headerlink" title="zGC (Z Garbage Collector) å’Œ Shenandoah æ”¶é›†å™¨ï¼š"></a>zGC (Z Garbage Collector) å’Œ Shenandoah æ”¶é›†å™¨ï¼š</h5><ul><li>ç‰¹ç‚¹ï¼šä½å»¶è¿Ÿã€å¹¶å‘ GC æ”¶é›†å™¨ï¼Œæ—¨åœ¨å®ç°æ¯«ç§’çº§çš„ GC åœé¡¿ã€‚</li><li>ZGC: JDK 11 å¼•å…¥ï¼Œæ”¯æŒ TB çº§åˆ«çš„å †å†…å­˜ï¼Œåœé¡¿æ—¶é—´ä¸å †å¤§å°æ— å…³ã€‚</li><li>Shenandoah: JDK 12 å¼•å…¥ï¼Œä¸ G1 ç±»ä¼¼ï¼Œä½†èƒ½è¿›ä¸€æ­¥é™ä½åœé¡¿æ—¶é—´ã€‚</li><li>åº”ç”¨åœºæ™¯ï¼šå¯¹å»¶è¿Ÿè¦æ±‚æé«˜çš„åº”ç”¨</li></ul></li></ul><h2 id="ç±»åŠ è½½æœºåˆ¶-Class-Loading-Mechanism"><a href="#ç±»åŠ è½½æœºåˆ¶-Class-Loading-Mechanism" class="headerlink" title="ç±»åŠ è½½æœºåˆ¶ (Class Loading Mechanism)"></a>ç±»åŠ è½½æœºåˆ¶ (Class Loading Mechanism)</h2><ul><li><p><strong>ä½œç”¨</strong>: å°† .class æ–‡ä»¶ä¸­çš„å­—èŠ‚ç åŠ è½½åˆ° JVM å†…å­˜ä¸­ï¼Œå¹¶è½¬æ¢ä¸ºè¿è¡Œæ—¶æ•°æ®ç»“æ„ã€‚  </p></li><li><p><strong>ç”Ÿå‘½å‘¨æœŸ</strong>: åŠ è½½ -&gt; éªŒè¯ -&gt; å‡†å¤‡ -&gt; è§£æ -&gt; åˆå§‹åŒ– -&gt; ä½¿ç”¨ -&gt; å¸è½½ã€‚  </p></li><li><p><strong>ä¸»è¦é˜¶æ®µ</strong>:  </p><ul><li><strong>åŠ è½½ (Loading)</strong>:  <ul><li>é€šè¿‡ç±»çš„å…¨é™å®šåè·å–è¯¥ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµã€‚  </li><li>å°†è¿™ä¸ªå­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ã€‚  </li><li>åœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¯¥ç±»çš„ java.lang.Class å¯¹è±¡ã€‚</li></ul></li><li><strong>éªŒè¯ (Verification)</strong>: ç¡®ä¿ Class æ–‡ä»¶çš„å­—èŠ‚æµç¬¦åˆ JVM è§„èŒƒï¼Œæ²¡æœ‰å®‰å…¨é—®é¢˜ã€‚  </li><li><strong>å‡†å¤‡ (Preparation)</strong>: ä¸ºç±»çš„é™æ€å˜é‡ï¼ˆstatic fieldsï¼‰åˆ†é…å†…å­˜å¹¶åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼ï¼ˆå¦‚ int å˜é‡ä¸º 0ï¼Œå¼•ç”¨ç±»å‹ä¸º nullï¼‰ã€‚  </li><li><strong>è§£æ (Resolution)</strong>: å°†å¸¸é‡æ± ä¸­çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨ã€‚  </li><li><strong>åˆå§‹åŒ– (Initialization)</strong>: æ‰§è¡Œç±»çš„æ„é€ å™¨ <code>&lt;clinit&gt;()</code> æ–¹æ³•ï¼ŒçœŸæ­£å¼€å§‹æ‰§è¡Œç±»ä¸­å®šä¹‰çš„ Java ç¨‹åºä»£ç ï¼ˆä¸ºé™æ€å˜é‡èµ‹äºˆåˆå§‹å€¼ï¼Œæ‰§è¡Œé™æ€ä»£ç å—ï¼‰ã€‚</li></ul></li><li><p>ç±»åŠ è½½æ˜¯ Java è™šæ‹Ÿæœºï¼ˆJVMï¼‰å°† <code>Class</code> æ–‡ä»¶ä¸­çš„äºŒè¿›åˆ¶æ•°æ®è¯»å–åˆ°å†…å­˜ä¸­ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºå¯ç”¨çš„ <code>java.lang.Class</code> å¯¹è±¡çš„è¿‡ç¨‹ã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯æ‰€æœ‰ Java ç¨‹åºè¿è¡Œçš„åŸºç¡€ã€‚</p><p>ç±»åŠ è½½çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸåŒ…æ‹¬ä»¥ä¸‹ 7 ä¸ªé˜¶æ®µï¼š</p><ol><li><strong>åŠ è½½ï¼ˆLoadingï¼‰</strong></li><li><strong>éªŒè¯ï¼ˆVerificationï¼‰</strong></li><li><strong>å‡†å¤‡ï¼ˆPreparationï¼‰</strong></li><li><strong>è§£æï¼ˆResolutionï¼‰</strong></li><li><strong>åˆå§‹åŒ–ï¼ˆInitializationï¼‰</strong></li><li>ä½¿ç”¨ï¼ˆUsingï¼‰</li><li>å¸è½½ï¼ˆUnloadingï¼‰</li></ol><p>å…¶ä¸­ï¼Œå‰äº”ä¸ªé˜¶æ®µæ˜¯ç±»åŠ è½½çš„æ ¸å¿ƒè¿‡ç¨‹ï¼Œåé¢ä¸¤ä¸ªé˜¶æ®µæ˜¯ç±»ç”Ÿå‘½å‘¨æœŸçš„å»¶ä¼¸ã€‚ä¸‹é¢æˆ‘ä»¬è¯¦ç»†è§£æå‰äº”ä¸ªæ ¸å¿ƒé˜¶æ®µã€‚</p><hr><h3 id="1-åŠ è½½ï¼ˆLoadingï¼‰"><a href="#1-åŠ è½½ï¼ˆLoadingï¼‰" class="headerlink" title="1. åŠ è½½ï¼ˆLoadingï¼‰"></a>1. åŠ è½½ï¼ˆLoadingï¼‰</h3><p>è¿™æ˜¯ç±»åŠ è½½è¿‡ç¨‹çš„ç¬¬ä¸€ä¸ªé˜¶æ®µï¼Œä¸»è¦ä»»åŠ¡æ˜¯æŸ¥æ‰¾å¹¶å¯¼å…¥ <code>Class</code> æ–‡ä»¶ä¸­çš„äºŒè¿›åˆ¶æ•°æ®ã€‚è¿™ä¸ªé˜¶æ®µä¸»è¦å®Œæˆä¸‰ä»¶äº‹ï¼š</p><ul><li><strong>é€šè¿‡ç±»çš„å…¨é™å®šåè·å–å®šä¹‰æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ</strong>ï¼šJVM å¯ä»¥ä»æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œã€å‹ç¼©åŒ…ï¼ˆJAR&#x2F;WAR&#x2F;EARï¼‰ç”šè‡³æ•°æ®åº“ä¸­è·å–å­—èŠ‚æµã€‚</li><li><strong>å°†å­—èŠ‚æµä¸­çš„é™æ€å­˜å‚¨ç»“æ„è½¬æ¢ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„</strong>ï¼šJVM ä¼šå°†äºŒè¿›åˆ¶æ•°æ®æŒ‰ç…§è™šæ‹Ÿæœºè§„èŒƒçš„è¦æ±‚ï¼Œè½¬åŒ–ä¸ºæ–¹æ³•åŒºä¸­å¯ç”¨çš„æ•°æ®ç»“æ„ã€‚</li><li><strong>åœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¯¥ç±»çš„ java.lang.Class å¯¹è±¡</strong>ï¼šè¿™ä¸ªå¯¹è±¡æ˜¯è®¿é—®æ–¹æ³•åŒºä¸­è¯¥ç±»å„ç§æ•°æ®ï¼ˆå¦‚æ–¹æ³•ã€å­—æ®µï¼‰çš„å…¥å£ï¼Œä¹Ÿæ˜¯åå°„æœºåˆ¶çš„åŸºçŸ³ã€‚</li></ul><hr><h3 id="2-éªŒè¯ï¼ˆVerificationï¼‰"><a href="#2-éªŒè¯ï¼ˆVerificationï¼‰" class="headerlink" title="2. éªŒè¯ï¼ˆVerificationï¼‰"></a>2. éªŒè¯ï¼ˆVerificationï¼‰</h3><p>éªŒè¯é˜¶æ®µçš„ç›®çš„æ˜¯ç¡®ä¿ <code>Class</code> æ–‡ä»¶çš„å­—èŠ‚æµç¬¦åˆ JVM è§„èŒƒï¼Œå¹¶ä¸”ä¸ä¼šå±å®³åˆ°è™šæ‹Ÿæœºçš„å®‰å…¨ã€‚è¿™ä¸ªé˜¶æ®µéå¸¸é‡è¦ï¼Œå› ä¸º <code>Class</code> æ–‡ä»¶ä¸ä¸€å®šæ˜¯ç”± Java æºç ç¼–è¯‘è€Œæ¥ï¼Œå®ƒå¯ä»¥æ˜¯ä»»ä½•æ¥æºã€‚éªŒè¯é€šå¸¸åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ£€æŸ¥ï¼š</p><ul><li><strong>æ–‡ä»¶æ ¼å¼éªŒè¯</strong>ï¼šæ£€æŸ¥å­—èŠ‚æµæ˜¯å¦ç¬¦åˆ <code>Class</code> æ–‡ä»¶æ ¼å¼çš„è§„èŒƒï¼Œä¾‹å¦‚é­”æ•°ï¼ˆ<code>0xCAFEBABE</code>ï¼‰ã€ç‰ˆæœ¬å·ç­‰ã€‚</li><li><strong>å…ƒæ•°æ®éªŒè¯</strong>ï¼šå¯¹ç±»çš„å…ƒæ•°æ®è¿›è¡Œè¯­ä¹‰åˆ†æï¼Œç¡®ä¿å…¶ç¬¦åˆ Java è¯­è¨€è§„èŒƒï¼Œä¾‹å¦‚æ˜¯å¦ç»§æ‰¿äº†ä¸å…è®¸ç»§æ‰¿çš„ <code>final</code> ç±»ã€å­—æ®µå’Œæ–¹æ³•ç­¾åæ˜¯å¦åˆç†ç­‰ã€‚</li><li><strong>å­—èŠ‚ç éªŒè¯</strong>ï¼šè¿™æ˜¯éªŒè¯é˜¶æ®µæœ€å¤æ‚çš„ä¸€æ­¥ï¼Œé€šè¿‡æ•°æ®æµå’Œæ§åˆ¶æµåˆ†æï¼Œç¡®ä¿ç¨‹åºè¯­ä¹‰æ˜¯åˆæ³•çš„ã€ç¬¦åˆé€»è¾‘çš„ã€‚ä¾‹å¦‚ï¼Œä¿è¯ç±»å‹è½¬æ¢æ˜¯æœ‰æ•ˆçš„ã€æ–¹æ³•è°ƒç”¨çš„å‚æ•°æ˜¯æ­£ç¡®çš„ã€‚</li><li><strong>ç¬¦å·å¼•ç”¨éªŒè¯</strong>ï¼šåœ¨è§£æé˜¶æ®µå‘ç”Ÿï¼Œç¡®ä¿è§£æå‡ºæ¥çš„ç±»ã€å­—æ®µã€æ–¹æ³•æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œå¹¶ä¸”å…·æœ‰è¶³å¤Ÿçš„è®¿é—®æƒé™ã€‚</li></ul><hr><h3 id="3-å‡†å¤‡ï¼ˆPreparationï¼‰"><a href="#3-å‡†å¤‡ï¼ˆPreparationï¼‰" class="headerlink" title="3. å‡†å¤‡ï¼ˆPreparationï¼‰"></a>3. å‡†å¤‡ï¼ˆPreparationï¼‰</h3><p>å‡†å¤‡é˜¶æ®µæ˜¯ä¸ºç±»çš„<strong>é™æ€å˜é‡</strong>åˆ†é…å†…å­˜å¹¶è®¾ç½®<strong>åˆå§‹å€¼</strong>çš„é˜¶æ®µã€‚</p><ul><li><strong>åªä¸ºé™æ€å˜é‡åˆ†é…å†…å­˜</strong>ï¼šåœ¨è¿™ä¸ªé˜¶æ®µï¼ŒJVM åªä¸º <code>static</code> å˜é‡ï¼ˆç±»å˜é‡ï¼‰åˆ†é…å†…å­˜ï¼Œè€Œä¸åŒ…æ‹¬å®ä¾‹å˜é‡ã€‚å®ä¾‹å˜é‡ä¼šåœ¨å¯¹è±¡å®ä¾‹åŒ–æ—¶éšç€å¯¹è±¡ä¸€èµ·åˆ†é…åœ¨å †ä¸­ã€‚</li><li><strong>è®¾ç½®åˆå§‹å€¼</strong>ï¼šè¿™é‡Œçš„åˆå§‹å€¼é€šå¸¸æ˜¯è¯¥æ•°æ®ç±»å‹çš„<strong>é›¶å€¼</strong>ï¼ˆä¾‹å¦‚ <code>int</code> çš„åˆå§‹å€¼ä¸º <code>0</code>ï¼Œ<code>boolean</code> ä¸º <code>false</code>ï¼Œ<code>String</code> ä¸º <code>null</code>ï¼‰ã€‚</li></ul><p><strong>æ³¨æ„</strong>ï¼šå¦‚æœé™æ€å˜é‡è¢« <code>final</code> ä¿®é¥°ï¼Œå¹¶ä¸”æ˜¯åŸºæœ¬æ•°æ®ç±»å‹æˆ–å­—ç¬¦ä¸²å­—é¢é‡ï¼Œé‚£ä¹ˆåœ¨å‡†å¤‡é˜¶æ®µå°±ä¼šç›´æ¥èµ‹å€¼ä¸ºå®ƒåœ¨ä»£ç ä¸­å®šä¹‰çš„å€¼ã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‡†å¤‡é˜¶æ®µï¼švalue çš„åˆå§‹å€¼ä¸º 0</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> <span class="number">123</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‡†å¤‡é˜¶æ®µï¼šfinalValue çš„åˆå§‹å€¼ç›´æ¥ä¸º 123</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">finalValue</span> <span class="operator">=</span> <span class="number">123</span>;</span><br></pre></td></tr></table></figure><hr><h3 id="4-è§£æï¼ˆResolutionï¼‰"><a href="#4-è§£æï¼ˆResolutionï¼‰" class="headerlink" title="4. è§£æï¼ˆResolutionï¼‰"></a>4. è§£æï¼ˆResolutionï¼‰</h3><p>è§£æé˜¶æ®µæ˜¯å°†å¸¸é‡æ± ä¸­çš„<strong>ç¬¦å·å¼•ç”¨</strong>è½¬æ¢ä¸º<strong>ç›´æ¥å¼•ç”¨</strong>çš„è¿‡ç¨‹ã€‚</p><ul><li><strong>ç¬¦å·å¼•ç”¨</strong>ï¼šä¸€ç»„ç¬¦å·æ¥æè¿°æ‰€å¼•ç”¨çš„ç›®æ ‡ï¼Œå¯ä»¥æ˜¯ä»»ä½•å½¢å¼çš„å­—é¢é‡ï¼Œåªè¦èƒ½å®šä½åˆ°ç›®æ ‡å³å¯ã€‚å®ƒä¸ä¾èµ–äºå†…å­˜å¸ƒå±€ã€‚</li><li><strong>ç›´æ¥å¼•ç”¨</strong>ï¼šç›´æ¥æŒ‡å‘ç›®æ ‡çš„æŒ‡é’ˆã€ç›¸å¯¹åç§»é‡æˆ–æ˜¯ä¸€ä¸ªå¯ä»¥é—´æ¥å®šä½åˆ°ç›®æ ‡çš„å¥æŸ„ã€‚å®ƒä¸å†…å­˜å¸ƒå±€ç›¸å…³ã€‚</li></ul><p>è§£æåŠ¨ä½œä¸»è¦é’ˆå¯¹ç±»æˆ–æ¥å£ã€å­—æ®µã€ç±»æ–¹æ³•ã€æ¥å£æ–¹æ³•ã€æ–¹æ³•ç±»å‹ã€æ–¹æ³•å¥æŸ„å’Œè°ƒç”¨ç‚¹é™å®šç¬¦ä¸ƒç±»ç¬¦å·å¼•ç”¨è¿›è¡Œã€‚è¿™ä¸ªé˜¶æ®µæ˜¯åŠ¨æ€çš„ï¼Œé€šå¸¸ä¼šåœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œå½“ç¬¦å·å¼•ç”¨è¢«é¦–æ¬¡ä½¿ç”¨æ—¶æ‰è¿›è¡Œã€‚</p><hr><h3 id="5-åˆå§‹åŒ–ï¼ˆInitializationï¼‰"><a href="#5-åˆå§‹åŒ–ï¼ˆInitializationï¼‰" class="headerlink" title="5. åˆå§‹åŒ–ï¼ˆInitializationï¼‰"></a>5. åˆå§‹åŒ–ï¼ˆInitializationï¼‰</h3><p>åˆå§‹åŒ–æ˜¯ç±»åŠ è½½è¿‡ç¨‹çš„æœ€åä¸€æ­¥ï¼Œåœ¨è¿™ä¸ªé˜¶æ®µï¼Œ<strong>çœŸæ­£æ‰§è¡Œ</strong>ç±»ä¸­å®šä¹‰çš„ Java ä»£ç ã€‚</p><ul><li><strong>æ‰§è¡Œ <clinit>() æ–¹æ³•</strong>ï¼šåˆå§‹åŒ–é˜¶æ®µä¼šæ‰§è¡Œç±»æ„é€ å™¨ <code>&lt;clinit&gt;()</code> æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ç”±ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆï¼Œå®ƒç”¨äºæ”¶é›†ç±»ä¸­æ‰€æœ‰é™æ€å˜é‡çš„èµ‹å€¼åŠ¨ä½œå’Œé™æ€ä»£ç å—ï¼ˆ<code>static &#123;&#125;</code>ï¼‰ä¸­çš„è¯­å¥ã€‚</li><li><strong>çº¿ç¨‹å®‰å…¨</strong>ï¼šJVM ä¼šç¡®ä¿ <code>&lt;clinit&gt;()</code> æ–¹æ³•åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹è¢«æ­£ç¡®åœ°åŠ é”å’ŒåŒæ­¥ï¼Œä¿è¯ä¸€ä¸ªç±»çš„ <code>&lt;clinit&gt;()</code> æ–¹æ³•åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡ã€‚</li><li><strong>è§¦å‘æ—¶æœº</strong>ï¼šåªæœ‰åœ¨ä»¥ä¸‹å‡ ç§æƒ…å†µä¸­ï¼Œä¸€ä¸ªç±»æ‰ä¼šè¢«â€œä¸»åŠ¨â€åˆå§‹åŒ–ï¼š<ul><li>åˆ›å»ºç±»çš„å®ä¾‹ï¼ˆ<code>new</code>ï¼‰ã€‚</li><li>è®¿é—®ç±»çš„é™æ€å˜é‡ï¼ˆé™¤äº†åœ¨ç¼–è¯‘æ—¶è¢« <code>final</code> åŒ–çš„å¸¸é‡ï¼‰ã€‚</li><li>è°ƒç”¨ç±»çš„é™æ€æ–¹æ³•ã€‚</li><li>ä½¿ç”¨ <code>java.lang.reflect</code> åŒ…çš„æ–¹æ³•è¿›è¡Œåå°„è°ƒç”¨ã€‚</li><li>åˆå§‹åŒ–ä¸€ä¸ªå­ç±»æ—¶ï¼Œå…¶çˆ¶ç±»å°šæœªåˆå§‹åŒ–ã€‚</li><li>è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œè¢«æŒ‡å®šä¸ºå¯åŠ¨ç±»çš„ç±»ï¼ˆå¦‚åŒ…å« <code>main()</code> æ–¹æ³•çš„ç±»ï¼‰ã€‚</li></ul></li></ul><p>ç†è§£è¿™äº”ä¸ªé˜¶æ®µå¯¹äºæ·±å…¥æŒæ¡ JVM çš„å·¥ä½œåŸç†è‡³å…³é‡è¦ã€‚</p></li><li><p><strong>ç±»åŠ è½½å™¨ (Class Loaders)</strong>:  </p><ul><li><p>ç±»åŠ è½½å™¨çš„åˆ†ç±»ï¼š</p><p>ï¼ˆ1ï¼‰Bootstrap class loader ï¼ˆä½¿ç”¨C++ç¼–å†™çš„ï¼‰</p><p>â€‹    ç®€ç§°ï¼šå¯åŠ¨ç±»åŠ è½½å™¨</p><p>â€‹    <strong>åŠ è½½è·¯å¾„</strong>ï¼šJAVA_HOME&#x2F;jre&#x2F;lib</p><p>â€‹    æ˜¾ç¤ºå½¢å¼ï¼šnull</p><p>ï¼ˆ2ï¼‰Platform class loaderï¼ˆç”±Javaç¼–å†™çš„ï¼‰</p><p>â€‹    ç®€ç§°ï¼šæ‰©å±•ç±»åŠ è½½å™¨</p><p>â€‹    <strong>åŠ è½½è·¯å¾„</strong>ï¼šJAVA_HOME&#x2F;jre&#x2F;lib&#x2F;ext</p><p>â€‹    æ˜¾ç¤ºå½¢å¼ï¼šExtClassLoader</p><p>ï¼ˆ3ï¼‰System class loaderï¼ˆç”±Javaç¼–å†™çš„ï¼‰</p><p>â€‹    ç®€ç§°ï¼šåº”ç”¨ç¨‹åºç±»åŠ è½½å™¨</p><p>â€‹    <strong>åŠ è½½è·¯å¾„</strong>ï¼šç±»è·¯å¾„ï¼ˆsrcç›®å½•ï¼‰</p><p>â€‹    æ˜¾ç¤ºå½¢å¼ï¼šAppClassLoader   &#x2F;&#x2F;sun.misc.Launcher$AppClassLoader@18b4aac2</p><p>ï¼ˆ4ï¼‰è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼ˆç”±Javaç¼–å†™çš„ï¼‰</p><p>â€‹    ç®€ç§°ï¼šè‡ªå®šä¹‰ç±»åŠ è½½å™¨</p><p>â€‹    åŠ è½½è·¯å¾„ï¼šè‡ªå®šä¹‰</p><h4 id="1-å¯åŠ¨ç±»åŠ è½½å™¨-Bootstrap-ClassLoader"><a href="#1-å¯åŠ¨ç±»åŠ è½½å™¨-Bootstrap-ClassLoader" class="headerlink" title="1. å¯åŠ¨ç±»åŠ è½½å™¨ (Bootstrap ClassLoader)"></a><strong>1. å¯åŠ¨ç±»åŠ è½½å™¨ (Bootstrap ClassLoader)</strong></h4><ul><li><strong>ä½œç”¨</strong>ï¼šå®ƒè´Ÿè´£åŠ è½½ Java æ ¸å¿ƒåº“ï¼Œæ¯”å¦‚ <code>rt.jar</code>ï¼ˆåŒ…å« <code>java.lang.*</code>, <code>java.util.*</code> ç­‰æ ¸å¿ƒç±»ï¼‰ã€‚</li><li><strong>å®ç°</strong>ï¼šå®ƒä¸æ˜¯ç”¨ Java å†™çš„ï¼Œè€Œæ˜¯ç”± C++ å®ç°çš„ï¼Œæ˜¯ JVM è‡ªèº«çš„ä¸€éƒ¨åˆ†ã€‚å› æ­¤ï¼Œä½ æ— æ³•åœ¨ Java ä»£ç ä¸­ç›´æ¥è·å–åˆ°å®ƒçš„å¯¹è±¡ï¼Œè°ƒç”¨ <code>getClassLoader()</code> å¾—åˆ°çš„ä¼šæ˜¯ <code>null</code>ã€‚</li><li><strong>çˆ¶åŠ è½½å™¨</strong>ï¼šå®ƒæ²¡æœ‰çˆ¶åŠ è½½å™¨ã€‚å®ƒæ˜¯ç±»åŠ è½½å™¨å±‚æ¬¡ç»“æ„çš„é¡¶ç«¯ã€‚</li></ul><h4 id="2-æ‰©å±•ç±»åŠ è½½å™¨-Extension-ClassLoader"><a href="#2-æ‰©å±•ç±»åŠ è½½å™¨-Extension-ClassLoader" class="headerlink" title="2. æ‰©å±•ç±»åŠ è½½å™¨ (Extension ClassLoader)"></a><strong>2. æ‰©å±•ç±»åŠ è½½å™¨ (Extension ClassLoader)</strong></h4><ul><li><strong>ä½œç”¨</strong>ï¼šå®ƒè´Ÿè´£åŠ è½½ JVM æ‰©å±•ç›®å½•ä¸­çš„æ‰€æœ‰ jar åŒ…ï¼Œé€šå¸¸æ˜¯ <code>JRE/lib/ext</code> ç›®å½•ä¸‹çš„åº“ã€‚</li><li><strong>å®ç°</strong>ï¼šå®ƒæ˜¯ç”± Java è¯­è¨€å®ç°çš„ã€‚</li><li><strong>çˆ¶åŠ è½½å™¨</strong>ï¼šå®ƒçš„çˆ¶åŠ è½½å™¨æ˜¯<strong>å¯åŠ¨ç±»åŠ è½½å™¨</strong>ã€‚</li></ul><h4 id="3-åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨-Application-ClassLoader"><a href="#3-åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨-Application-ClassLoader" class="headerlink" title="3. åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ (Application ClassLoader)"></a><strong>3. åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ (Application ClassLoader)</strong></h4><ul><li><strong>ä½œç”¨</strong>ï¼šå®ƒè´Ÿè´£åŠ è½½æˆ‘ä»¬è‡ªå·±ç¼–å†™çš„ Java ç¨‹åºä¸­çš„ç±»ï¼Œä¹Ÿå°±æ˜¯ä½ é¡¹ç›®ä¸­ <code>classpath</code> è·¯å¾„ä¸‹çš„æ‰€æœ‰ç±»ã€‚</li><li><strong>å®ç°</strong>ï¼šå®ƒä¹Ÿæ˜¯ç”± Java è¯­è¨€å®ç°çš„ã€‚</li><li><strong>çˆ¶åŠ è½½å™¨</strong>ï¼šå®ƒçš„çˆ¶åŠ è½½å™¨æ˜¯<strong>æ‰©å±•ç±»åŠ è½½å™¨</strong>ã€‚</li></ul><hr><h3 id="è‡ªå®šä¹‰ç±»åŠ è½½å™¨"><a href="#è‡ªå®šä¹‰ç±»åŠ è½½å™¨" class="headerlink" title="è‡ªå®šä¹‰ç±»åŠ è½½å™¨"></a><strong>è‡ªå®šä¹‰ç±»åŠ è½½å™¨</strong></h3><p>é™¤äº†ä¸Šé¢ä¸‰ä¸ªï¼Œä½ ä¹Ÿå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚åˆ›å»º<strong>è‡ªå®šä¹‰ç±»åŠ è½½å™¨</strong>ã€‚</p><ul><li><strong>ä½œç”¨</strong>ï¼šå½“ä½ éœ€è¦åŠ è½½ä¸€äº›ç‰¹å®šæ¥æºçš„ç±»æ—¶ï¼ˆæ¯”å¦‚ä»ç½‘ç»œä¸‹è½½çš„ç±»ã€å¯¹å­—èŠ‚ç è¿›è¡ŒåŠ å¯†æˆ–è§£å¯†ï¼‰ï¼Œè‡ªå®šä¹‰ç±»åŠ è½½å™¨å°±å¾ˆæœ‰ç”¨ã€‚ä¾‹å¦‚ï¼ŒWeb æœåŠ¡å™¨ï¼ˆå¦‚ Tomcatï¼‰å°±æ˜¯é€šè¿‡è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ¥éš”ç¦»ä¸åŒ Web åº”ç”¨çš„ç±»ã€‚</li><li><strong>å¦‚ä½•å®ç°</strong>ï¼šé€šå¸¸ï¼Œä½ éœ€è¦ç»§æ‰¿ <code>java.lang.ClassLoader</code> ç±»ï¼Œå¹¶é‡å†™ <code>findClass()</code> æ–¹æ³•ã€‚åœ¨ <code>findClass()</code> æ–¹æ³•ä¸­ï¼Œä½ éœ€è¦è‡ªå·±å®šä¹‰å¦‚ä½•è·å–ç±»çš„å­—èŠ‚ç ï¼ˆæ¯”å¦‚ä»æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œæˆ–æ•°æ®åº“ï¼‰ï¼Œç„¶åè°ƒç”¨ <code>defineClass()</code> æ–¹æ³•å°†å­—èŠ‚ç è½¬æ¢ä¸º <code>Class</code> å¯¹è±¡ã€‚</li></ul></li></ul></li></ul><h3 id="33-æœ‰å“ªäº›ç±»åŠ è½½å™¨ï¼Ÿåˆ†åˆ«æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ"><a href="#33-æœ‰å“ªäº›ç±»åŠ è½½å™¨ï¼Ÿåˆ†åˆ«æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ" class="headerlink" title="33. æœ‰å“ªäº›ç±»åŠ è½½å™¨ï¼Ÿåˆ†åˆ«æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ"></a>33. æœ‰å“ªäº›ç±»åŠ è½½å™¨ï¼Ÿåˆ†åˆ«æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</h3><ol><li><strong>å¯åŠ¨ç±»åŠ è½½å™¨ (Bootstrap ClassLoader)</strong>ï¼šè¿™ä¸ªç±»åŠ è½½å™¨æ˜¯ç”± C++ è¯­è¨€å®ç°çš„ï¼Œæ˜¯è™šæ‹Ÿæœºè‡ªèº«çš„ä¸€éƒ¨åˆ†ã€‚è´Ÿè´£å°†å­˜åœ¨ <code>\lib</code> ç›®å½•ä¸­çš„ï¼Œæˆ–è€…è¢« <code>-Xbootclasspath</code> å‚æ•°æ‰€æŒ‡å®šçš„è·¯å¾„ä¸­çš„ç±»åº“åŠ è½½åˆ°è™šæ‹Ÿæœºå†…å­˜ä¸­ã€‚å¯åŠ¨å†…åŠ è½½å™¨æ— æ³•è¢« Java ç¨‹åºç›´æ¥å¼•ç”¨ï¼Œç”¨æˆ·åœ¨ç¼–å†™è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ—¶ï¼Œå¦‚æœéœ€è¦æŠŠåŠ è½½è¯·æ±‚å§”æ´¾ç»™å¯åŠ¨ç±»åŠ è½½å™¨ï¼Œç›´æ¥ä½¿ç”¨ <code>null</code> å³å¯ï¼›</li><li><strong>å…¶ä»–ç±»åŠ è½½å™¨</strong>ï¼šç”± Java è¯­è¨€å®ç°ï¼Œç‹¬ç«‹äºè™šæ‹Ÿæœºå¤–éƒ¨ï¼Œå¹¶ä¸”å…¨éƒ½ç»§æ‰¿è‡ªæŠ½è±¡ç±» <code>java.lang.ClassLoader</code>ã€‚å¦‚æ‰©å±•ç±»åŠ è½½å™¨å’Œåº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼š<ul><li><strong>æ‰©å±•ç±»åŠ è½½å™¨ (Extension ClassLoader)</strong>ï¼šè¿™ä¸ªç±»åŠ è½½å™¨ç”± <code>sun.misc.Launcher$ExtClassLoader</code> å®ç°ï¼Œå®ƒè´Ÿè´£åŠ è½½<code>\lib\ext</code>ç›®å½•ä¸­çš„ï¼Œæˆ–è€…è¢« <code>java.ext.dirs</code> ç³»ç»Ÿå˜é‡æ‰€æŒ‡å®šçš„è·¯å¾„ä¸­çš„æ‰€æœ‰ç±»åº“ï¼Œå¼€å‘è€…å¯ä»¥ç›´æ¥ä½¿ç”¨æ‰©å±•ç±»åŠ è½½å™¨ã€‚</li><li><strong>åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ (Application ClassLoader)</strong>ï¼šè¿™ä¸ªç±»åŠ è½½å™¨ç”± <code>sun.misc.Launcher$AppClassLoder</code> å®ç°ã€‚ç”±äºä¸ªç±»åŠ è½½å™¨æ˜¯ <code>ClassLoader</code> ä¸­çš„ <code>getSystemClassLoader()</code> æ–¹æ³•çš„è¿”å›å€¼ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¹Ÿç§°ä¹‹ä¸ºç³»ç»Ÿç±»åŠ è½½å™¨ã€‚å®ƒè´Ÿè´£åŠ è½½ç”¨æˆ·è·¯å¾„ï¼ˆClassPathï¼‰æ‰€æŒ‡å®šçš„ç±»åº“ï¼Œå¼€å‘è€…å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªç±»åŠ è½½å™¨ï¼Œå¦‚æœåº”ç”¨ç¨‹åºä¸­æ²¡æœ‰è‡ªå®šä¹‰è¿‡è‡ªå·±çš„ç±»åŠ è½½å™¨ï¼Œä¸€èˆ¬æƒ…å†µä¸‹è¿™ä¸ªå°±æ˜¯ç¨‹åºä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ã€‚</li></ul></li></ol><ul><li><p><strong>åŒäº²å§”æ´¾æ¨¡å‹ (Parents Delegation Model)</strong>:  </p><ul><li><strong>åŸç†</strong>: å¦‚æœä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°äº†ç±»åŠ è½½çš„è¯·æ±‚ï¼Œå®ƒé¦–å…ˆä¸ä¼šè‡ªå·±å»å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œè€Œæ˜¯æŠŠè¿™ä¸ªè¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨å»å®Œæˆã€‚åªæœ‰å½“çˆ¶åŠ è½½å™¨åé¦ˆè‡ªå·±æ— æ³•å®Œæˆè¿™ä¸ªåŠ è½½è¯·æ±‚æ—¶ï¼Œå­åŠ è½½å™¨æ‰ä¼šå°è¯•è‡ªå·±å»åŠ è½½ã€‚  </li><li><strong>ä¼˜ç‚¹</strong>: é¿å…ç±»çš„é‡å¤åŠ è½½ï¼Œä¿è¯ Java æ ¸å¿ƒåº“çš„ç±»å‹å®‰å…¨ã€‚</li></ul></li></ul><h2 id="é¢è¯•é¢˜ï¼š"><a href="#é¢è¯•é¢˜ï¼š" class="headerlink" title="é¢è¯•é¢˜ï¼š"></a>é¢è¯•é¢˜ï¼š</h2><p>ä¸ºä»€ä¹ˆéœ€è¦å››ä¸ªç±»åŠ è½½å™¨ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªï¼Ÿ</p><p>è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é—®é¢˜ã€‚ä¸ºä»€ä¹ˆ Java è¦è®¾è®¡å¤šä¸ªç±»åŠ è½½å™¨ï¼Œè€Œä¸æ˜¯ç”¨ä¸€ä¸ªå¤§ä¸€ç»Ÿçš„åŠ è½½å™¨å‘¢ï¼Ÿè¿™èƒŒåä¸»è¦æœ‰ä¸‰ä¸ªæ ¸å¿ƒåŸå› ï¼š<strong>éš”ç¦»æ€§</strong>ã€<strong>å®‰å…¨æ€§</strong>å’Œ<strong>å¯æ‰©å±•æ€§</strong>ã€‚</p><hr><h3 id="1-éš”ç¦»æ€§ï¼ˆIsolationï¼‰"><a href="#1-éš”ç¦»æ€§ï¼ˆIsolationï¼‰" class="headerlink" title="1. éš”ç¦»æ€§ï¼ˆIsolationï¼‰"></a>1. éš”ç¦»æ€§ï¼ˆIsolationï¼‰</h3><p>å¤šç±»åŠ è½½å™¨çš„æœ€å¤§ä¼˜åŠ¿å°±æ˜¯å®ç°äº†<strong>ç±»éš”ç¦»</strong>ã€‚</p><p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æœ‰ä¸€ä¸ª Web æœåŠ¡å™¨ï¼Œä¸Šé¢éƒ¨ç½²äº†ä¸¤ä¸ªä¸åŒçš„ Web åº”ç”¨ï¼ˆæ¯”å¦‚ä¸€ä¸ªåšå®¢ç³»ç»Ÿå’Œä¸€ä¸ªè®ºå›ï¼‰ã€‚è¿™ä¸¤ä¸ªåº”ç”¨å¯èƒ½ä¾èµ–åŒä¸€ä¸ªç¬¬ä¸‰æ–¹åº“çš„ä¸åŒç‰ˆæœ¬ï¼ˆä¾‹å¦‚ï¼Œåšå®¢ç”¨çš„æ˜¯ Spring æ¡†æ¶çš„ 5.x ç‰ˆæœ¬ï¼Œè€Œè®ºå›ç”¨çš„æ˜¯ 4.x ç‰ˆæœ¬ï¼‰ã€‚</p><p>å¦‚æœåªæœ‰ä¸€ä¸ªç±»åŠ è½½å™¨ï¼Œå®ƒä¼šæŠŠæ‰€æœ‰ <code>classpath</code> ä¸Šçš„ç±»éƒ½åŠ è½½åˆ°åŒä¸€ä¸ªå†…å­˜ç©ºé—´ã€‚è¿™æ ·ä¸€æ¥ï¼Œä¸¤ä¸ªä¸åŒç‰ˆæœ¬çš„ Spring æ¡†æ¶å°±ä¼šäº§ç”Ÿå†²çªï¼ŒJVM æ ¹æœ¬æ— æ³•åŒºåˆ†å®ƒä»¬ï¼Œç¨‹åºå°±ä¼šæŠ¥é”™ã€‚</p><p>è€Œæœ‰äº†è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼ŒæœåŠ¡å™¨å°±å¯ä»¥ä¸ºæ¯ä¸ª Web åº”ç”¨åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„ç±»åŠ è½½å™¨ã€‚æ¯ä¸ªåŠ è½½å™¨è´Ÿè´£åŠ è½½è‡ªå·±åº”ç”¨ç›®å½•ä¸‹çš„ç±»ï¼Œè¿™æ ·ä¸¤ä¸ªåº”ç”¨å³ä½¿ä½¿ç”¨äº†åŒä¸€ä¸ªåº“çš„ä¸åŒç‰ˆæœ¬ï¼Œä¹Ÿèƒ½åœ¨å†…å­˜ä¸­å’Œè°å…±å­˜ï¼Œäº’ä¸å¹²æ‰°ã€‚</p><hr><h3 id="2-å®‰å…¨æ€§ï¼ˆSecurityï¼‰"><a href="#2-å®‰å…¨æ€§ï¼ˆSecurityï¼‰" class="headerlink" title="2. å®‰å…¨æ€§ï¼ˆSecurityï¼‰"></a>2. å®‰å…¨æ€§ï¼ˆSecurityï¼‰</h3><p>Java çš„æ ¸å¿ƒåº“ï¼ˆå¦‚ <code>java.lang</code>, <code>java.util</code> ç­‰ï¼‰å¯¹ JVM çš„ç¨³å®šå’Œå®‰å…¨è‡³å…³é‡è¦ã€‚</p><p><strong>åŒäº²å§”æ´¾æ¨¡å‹</strong>æ­£æ˜¯ä¸ºäº†ä¿æŠ¤è¿™äº›æ ¸å¿ƒåº“ä¸è¢«æ¶æ„ä»£ç æˆ–æ™®é€šç”¨æˆ·ä»£ç æ‰€ç¯¡æ”¹ã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœä½ å°è¯•è‡ªå·±å†™ä¸€ä¸ª <code>java.lang.String</code> ç±»å¹¶æŠŠå®ƒæ”¾åœ¨åº”ç”¨çš„ <code>classpath</code> ä¸‹ï¼ŒåŒäº²å§”æ´¾æœºåˆ¶ä¼šç¡®ä¿è¿™ä¸ªç±»ä¸ä¼šè¢«åŠ è½½ã€‚å› ä¸ºå½“åŠ è½½è¯·æ±‚åˆ°è¾¾åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨æ—¶ï¼Œå®ƒä¼šå…ˆå§”æ´¾ç»™å®ƒçš„çˆ¶åŠ è½½å™¨â€”â€”æ‰©å±•ç±»åŠ è½½å™¨ï¼Œç„¶åå†å§”æ´¾ç»™æœ€é¡¶å±‚çš„<strong>å¯åŠ¨ç±»åŠ è½½å™¨</strong>ã€‚å¯åŠ¨ç±»åŠ è½½å™¨ä¼šä¼˜å…ˆåŠ è½½ JDK è‡ªå¸¦çš„ <code>java.lang.String</code>ï¼Œä»è€Œä½ çš„æ¶æ„ä»£ç å°±æ°¸è¿œæ²¡æœ‰æœºä¼šè¢«æ‰§è¡Œã€‚</p><hr><h3 id="3-å¯æ‰©å±•æ€§ï¼ˆExtensibilityï¼‰"><a href="#3-å¯æ‰©å±•æ€§ï¼ˆExtensibilityï¼‰" class="headerlink" title="3. å¯æ‰©å±•æ€§ï¼ˆExtensibilityï¼‰"></a>3. å¯æ‰©å±•æ€§ï¼ˆExtensibilityï¼‰</h3><p>Java æ˜¯ä¸€ç§éå¸¸çµæ´»çš„è¯­è¨€ï¼Œéœ€è¦é€‚åº”å„ç§å¤æ‚çš„è¿è¡Œæ—¶ç¯å¢ƒã€‚</p><p>å¦‚æœåªæœ‰ä¸€ä¸ªç±»åŠ è½½å™¨ï¼Œæ‰€æœ‰çš„ç±»éƒ½å¿…é¡»æ¥è‡ªæ–‡ä»¶ç³»ç»Ÿã€‚ä½†åœ¨ç°å®ä¸–ç•Œä¸­ï¼Œç±»å¯èƒ½æ¥è‡ªå„ç§åœ°æ–¹ï¼š</p><ul><li>ä»ç½‘ç»œä¸Šä¸‹è½½çš„å­—èŠ‚ç ã€‚</li><li>é€šè¿‡æ•°æ®åº“å­˜å‚¨å’ŒåŠ è½½ã€‚</li><li>å¯¹å­—èŠ‚ç è¿›è¡ŒåŠ å¯†å’Œè§£å¯†ã€‚</li></ul><p>è‡ªå®šä¹‰ç±»åŠ è½½å™¨è®© Java èƒ½å¤Ÿ<strong>åŠ¨æ€åœ°åŠ è½½</strong>å’Œ<strong>å¤„ç†éæ ‡å‡†æ¥æºçš„ç±»</strong>ã€‚ä¾‹å¦‚ï¼Œçƒ­éƒ¨ç½²æŠ€æœ¯ï¼ˆåœ¨ä¸é‡å¯åº”ç”¨çš„æƒ…å†µä¸‹æ›´æ–°ä»£ç ï¼‰å°±æ˜¯é€šè¿‡è‡ªå®šä¹‰ç±»åŠ è½½å™¨å®ç°çš„ã€‚å®ƒä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„åŠ è½½å™¨æ¥åŠ è½½æ–°ç‰ˆæœ¬çš„ç±»ï¼Œè€Œæ—§çš„åŠ è½½å™¨å’Œå®ƒçš„ç±»åˆ™å¯ä»¥è¢«åƒåœ¾å›æ”¶ã€‚</p><hr><h3 id="æ€»ç»“-8"><a href="#æ€»ç»“-8" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æ‰€ä»¥ï¼Œä¸€ä¸ªå¤§ä¸€ç»Ÿçš„ç±»åŠ è½½å™¨è™½ç„¶ç®€å•ï¼Œä½†å®ƒæ— æ³•è§£å†³å¤æ‚çš„<strong>ç±»ç‰ˆæœ¬å†²çª</strong>ã€<strong>æ ¸å¿ƒåº“å®‰å…¨</strong>å’Œ<strong>åŠ¨æ€åŠ è½½</strong>ç­‰é—®é¢˜ã€‚é€šè¿‡åˆ†å±‚è®¾è®¡å’ŒåŒäº²å§”æ´¾æ¨¡å‹ï¼ŒJava çš„ç±»åŠ è½½å™¨ä½“ç³»å˜å¾—æ—¢å®‰å…¨åˆçµæ´»ï¼Œèƒ½å¤Ÿæ»¡è¶³ä»ç®€å•çš„æ¡Œé¢åº”ç”¨åˆ°å¤æ‚çš„ä¼ä¸šçº§æœåŠ¡å™¨ç­‰å„ç§åœºæ™¯çš„éœ€æ±‚ã€‚</p><h2 id="å¸¸è§çš„-OOM-OutOfMemoryError-å’Œ-StackOverflowError"><a href="#å¸¸è§çš„-OOM-OutOfMemoryError-å’Œ-StackOverflowError" class="headerlink" title="å¸¸è§çš„ OOM (OutOfMemoryError) å’Œ StackOverflowError"></a>å¸¸è§çš„ OOM (OutOfMemoryError) å’Œ StackOverflowError</h2><ul><li><strong>Java heap space</strong>: å †å†…å­˜ä¸è¶³ï¼Œæœ€å¸¸è§ã€‚é€šå¸¸é€šè¿‡è°ƒæ•´ JVM å¯åŠ¨å‚æ•° <code>-Xms</code> (åˆå§‹å †å¤§å°) å’Œ <code>-Xmx</code> (æœ€å¤§å †å¤§å°) æ¥è§£å†³ã€‚  </li><li><strong>StackOverflowError</strong>: è™šæ‹Ÿæœºæ ˆæº¢å‡ºã€‚é€šå¸¸æ˜¯é€’å½’è°ƒç”¨è¿‡æ·±å¯¼è‡´æ ˆå¸§ä¸æ–­å…¥æ ˆã€‚  </li><li><strong>PermGen space &#x2F; Metaspace</strong>: æ–¹æ³•åŒºæº¢å‡ºã€‚é€šå¸¸æ˜¯åŠ è½½çš„ç±»è¿‡å¤šï¼Œæˆ–è€…å­˜åœ¨å¤§é‡å­—ç¬¦ä¸²å¸¸é‡ã€‚é€šè¿‡ <code>-XX:MaxPermSize</code> (JDK 1.7) æˆ– <code>-XX:MaxMetaspaceSize</code> (JDK 1.8) è°ƒæ•´ã€‚  </li><li><strong>Direct buffer memory</strong>: ç›´æ¥å†…å­˜æº¢å‡ºã€‚é€šå¸¸æ˜¯ä½¿ç”¨äº† NIO æˆ– Netty ç­‰ç›´æ¥æ“ä½œå †å¤–å†…å­˜çš„åº“ã€‚  </li><li><strong>unable to create new native thread</strong>: æ— æ³•åˆ›å»ºæ–°çº¿ç¨‹ã€‚é€šå¸¸æ˜¯ç³»ç»Ÿçº¿ç¨‹æ•°è¾¾åˆ°ä¸Šé™æˆ–å†…å­˜ä¸è¶³ä»¥åˆ†é…æ–°çº¿ç¨‹çš„æ ˆç©ºé—´ã€‚</li></ul><h2 id="OOMå¸¸è§åœºæ™¯ï¼š"><a href="#OOMå¸¸è§åœºæ™¯ï¼š" class="headerlink" title="OOMå¸¸è§åœºæ™¯ï¼š"></a>OOMå¸¸è§åœºæ™¯ï¼š</h2><hr><h3 id="1-java-lang-OutOfMemoryError-Java-heap-space"><a href="#1-java-lang-OutOfMemoryError-Java-heap-space" class="headerlink" title="1. java.lang.OutOfMemoryError: Java heap space"></a><strong>1. java.lang.OutOfMemoryError: Java heap space</strong></h3><p>è¿™æ˜¯æœ€å¸¸è§ã€ä¹Ÿæœ€å¹¿ä¸ºäººçŸ¥çš„å†…å­˜æº¢å‡ºé”™è¯¯ã€‚å®ƒè¡¨ç¤º <strong>Java å †ï¼ˆHeapï¼‰</strong> ä¸­æ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´æ¥åˆ†é…æ–°çš„å¯¹è±¡ã€‚</p><p><strong>å¸¸è§åœºæ™¯ï¼š</strong></p><ul><li><strong>å†…å­˜æ³„æ¼ï¼ˆMemory Leakï¼‰</strong>ï¼šè¿™æ˜¯æœ€ä¸»è¦çš„åŸå› ã€‚ä½ çš„ç¨‹åºä¸­åˆ›å»ºäº†å¯¹è±¡ï¼Œä½†æœ¬åº”è¢«åƒåœ¾å›æ”¶å™¨ï¼ˆGCï¼‰å›æ”¶çš„å¯¹è±¡å´å› ä¸ºæŸäº›åŸå› ï¼ˆæ¯”å¦‚è¢«ä¸€ä¸ªé•¿ç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡å¼•ç”¨ç€ï¼‰è€Œæ— æ³•è¢«å›æ”¶ã€‚ä¾‹å¦‚ï¼š<ul><li>ä¸€ä¸ªé™æ€çš„ <code>Map</code> æˆ– <code>List</code> é›†åˆï¼Œä¸æ–­åœ°å¾€é‡Œé¢æ·»åŠ å¯¹è±¡ï¼Œä½†ä»ä¸åˆ é™¤ã€‚</li><li>ç›‘å¬å™¨æˆ–å›è°ƒå‡½æ•°æ²¡æœ‰æ­£ç¡®ç§»é™¤ï¼Œå¯¼è‡´è¢«ç›‘å¬çš„å¯¹è±¡æ— æ³•è¢«å›æ”¶ã€‚</li><li>æ•°æ®åº“è¿æ¥æˆ–æ–‡ä»¶æµæ²¡æœ‰æ­£ç¡®å…³é—­ï¼Œé•¿æ—¶é—´å ç”¨èµ„æºã€‚</li></ul></li><li><strong>å†…å­˜ä½¿ç”¨ä¸å½“</strong>ï¼šä¸€æ¬¡æ€§åŠ è½½å¤§é‡æ•°æ®åˆ°å†…å­˜ä¸­ã€‚ä¾‹å¦‚ï¼Œä»æ•°æ®åº“æŸ¥è¯¢æ•°ç™¾ä¸‡æ¡è®°å½•ï¼Œå¹¶æŠŠå®ƒä»¬å…¨éƒ¨åŠ è½½åˆ°ä¸€ä¸ª <code>List</code> ä¸­ï¼›æˆ–è€…å¤„ç†ä¸€ä¸ªè¶…å¤§çš„å›¾ç‰‡æˆ–æ–‡ä»¶ï¼Œå¯¼è‡´ç¬é—´å ç”¨å¤§é‡å†…å­˜ã€‚</li><li><strong>é…ç½®é—®é¢˜</strong>ï¼šJVM çš„å †å†…å­˜è®¾ç½®å¾—å¤ªå°ï¼Œæ— æ³•æ»¡è¶³ç¨‹åºçš„æ­£å¸¸è¿è¡Œéœ€æ±‚ã€‚è¿™åœ¨éƒ¨ç½²åº”ç”¨æ—¶å¾ˆå¸¸è§ï¼Œå¯ä»¥é€šè¿‡è°ƒæ•´ <code>-Xmx</code> å‚æ•°æ¥è§£å†³ã€‚</li></ul><hr><h3 id="2-java-lang-StackOverflowError"><a href="#2-java-lang-StackOverflowError" class="headerlink" title="2. java.lang.StackOverflowError"></a><strong>2. java.lang.StackOverflowError</strong></h3><p>è¿™ä¸ªé”™è¯¯è¡¨ç¤º <strong>è™šæ‹Ÿæœºæ ˆï¼ˆStackï¼‰</strong> æº¢å‡ºã€‚æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„æ ˆï¼Œç”¨äºå­˜å‚¨æ–¹æ³•è°ƒç”¨çš„æ ˆå¸§ã€‚å½“æ ˆçš„æ·±åº¦è¶…è¿‡äº† JVM å…è®¸çš„æœ€å¤§æ·±åº¦æ—¶ï¼Œå°±ä¼šæŠ›å‡ºæ­¤é”™è¯¯ã€‚</p><p><strong>å¸¸è§åœºæ™¯ï¼š</strong></p><ul><li><p><strong>æ— é™é€’å½’ï¼ˆInfinite Recursionï¼‰</strong>ï¼šè¿™æ˜¯æœ€å…¸å‹çš„åœºæ™¯ã€‚ä¸€ä¸ªæ–¹æ³•ä¸æ–­åœ°è°ƒç”¨è‡ªèº«ï¼Œä¸”æ²¡æœ‰æ­£ç¡®çš„é€€å‡ºæ¡ä»¶ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">recursiveMethod</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// æ²¡æœ‰é€€å‡ºæ¡ä»¶</span></span><br><span class="line">    recursiveMethod(); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦ä¸€ä¸ªä¾‹å­æ˜¯ä¸¤ä¸ªæ–¹æ³•äº’ç›¸è°ƒç”¨ï¼Œå½¢æˆå¾ªç¯ï¼šA è°ƒç”¨ Bï¼ŒB åˆè°ƒç”¨ Aã€‚</p></li><li><p><strong>é€’å½’è°ƒç”¨å±‚çº§è¿‡æ·±</strong>ï¼šå³ä½¿é€’å½’æœ‰æ­£ç¡®çš„é€€å‡ºæ¡ä»¶ï¼Œå¦‚æœæ•°æ®é‡è¿‡å¤§ï¼Œå¯¼è‡´é€’å½’è°ƒç”¨å±‚çº§éå¸¸æ·±ï¼Œä¹Ÿå¯èƒ½å¯¼è‡´æ ˆæº¢å‡ºã€‚ä¾‹å¦‚ï¼Œå¤„ç†ä¸€ä¸ªæ·±åº¦éå¸¸å¤§çš„æ ‘å½¢ç»“æ„ã€‚</p></li></ul><hr><h3 id="3-java-lang-OutOfMemoryError-PermGen-space-æˆ–-Metaspace"><a href="#3-java-lang-OutOfMemoryError-PermGen-space-æˆ–-Metaspace" class="headerlink" title="3. java.lang.OutOfMemoryError: PermGen space æˆ– Metaspace"></a><strong>3. java.lang.OutOfMemoryError: PermGen space æˆ– Metaspace</strong></h3><p>è¿™ä¸ªé”™è¯¯å‘ç”Ÿåœ¨ <strong>æ–¹æ³•åŒº</strong> æº¢å‡ºã€‚æ–¹æ³•åŒºç”¨äºå­˜å‚¨ç±»çš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œå¦‚ç±»çš„ç»“æ„ã€å­—æ®µã€æ–¹æ³•ã€å¸¸é‡æ± ç­‰ã€‚</p><ul><li><strong>JDK 1.7 åŠä¹‹å‰</strong>ï¼šæ–¹æ³•åŒºåœ¨å †ä¸­ï¼Œè¢«ç§°ä¸º<strong>æ°¸ä¹…ä»£ï¼ˆPermGenï¼‰</strong>ã€‚æº¢å‡ºé”™è¯¯ä¸º <code>PermGen space</code>ã€‚</li><li><strong>JDK 1.8 åŠä¹‹å</strong>ï¼šæ°¸ä¹…ä»£è¢«ç§»é™¤ï¼Œæ–¹æ³•åŒºæ”¹ä¸ºä½¿ç”¨<strong>å…ƒç©ºé—´ï¼ˆMetaspaceï¼‰</strong>ï¼Œå¹¶ä¸”é»˜è®¤ä½¿ç”¨æœ¬åœ°å†…å­˜ã€‚æº¢å‡ºé”™è¯¯ä¸º <code>Metaspace</code>ã€‚</li></ul><p><strong>å¸¸è§åœºæ™¯ï¼š</strong></p><ul><li><strong>åŠ¨æ€ç”Ÿæˆå¤§é‡ç±»</strong>ï¼šåœ¨è¿è¡Œæ—¶ç”Ÿæˆå¤§é‡æ–°çš„ç±»ã€‚è¿™åœ¨ä¸€äº›ä½¿ç”¨å­—èŠ‚ç å¢å¼ºæŠ€æœ¯çš„æ¡†æ¶ï¼ˆå¦‚ CGLibï¼‰æˆ–åŠ¨æ€ä»£ç†çš„åœºæ™¯ä¸­å¾ˆå¸¸è§ã€‚</li><li><strong>çƒ­éƒ¨ç½²</strong>ï¼šåœ¨åƒ Tomcat è¿™æ ·çš„ Web æœåŠ¡å™¨ä¸­è¿›è¡Œé¢‘ç¹çš„çƒ­éƒ¨ç½²æ“ä½œï¼Œå¦‚æœæ²¡æœ‰æ­£ç¡®æ¸…ç†æ—§çš„ç±»åŠ è½½å™¨ï¼Œä¼šå¯¼è‡´æ—§çš„ç±»å…ƒæ•°æ®æ— æ³•è¢«å›æ”¶ï¼Œä»è€Œé€æ¸è€—å°½æ–¹æ³•åŒºå†…å­˜ã€‚</li><li><strong>å¸¸é‡æ± æº¢å‡º</strong>ï¼šåœ¨ JDK 1.7 ä¹‹å‰ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± ä¹Ÿåœ¨æ°¸ä¹…ä»£ä¸­ã€‚å¦‚æœç¨‹åºåˆ›å»ºäº†å¤§é‡ä¸åŒçš„å­—ç¬¦ä¸²ï¼ˆä¾‹å¦‚åœ¨å¾ªç¯ä¸­ä¸æ–­ç”Ÿæˆæ–°çš„å­—ç¬¦ä¸²ï¼‰ï¼Œä¹Ÿå¯èƒ½å¯¼è‡´æ°¸ä¹…ä»£æº¢å‡ºã€‚</li></ul><hr><h3 id="4-java-lang-OutOfMemoryError-Direct-buffer-memory"><a href="#4-java-lang-OutOfMemoryError-Direct-buffer-memory" class="headerlink" title="4. java.lang.OutOfMemoryError: Direct buffer memory"></a><strong>4. java.lang.OutOfMemoryError: Direct buffer memory</strong></h3><p>è¿™ä¸ªé”™è¯¯ä¸ <strong>ç›´æ¥å†…å­˜ï¼ˆDirect Memoryï¼‰</strong> ç›¸å…³ï¼Œå®ƒä¸æ˜¯ Java å †çš„ä¸€éƒ¨åˆ†ï¼Œè€Œæ˜¯é€šè¿‡ <code>ByteBuffer.allocateDirect()</code> åœ¨å †å¤–åˆ†é…çš„å†…å­˜ã€‚</p><p><strong>å¸¸è§åœºæ™¯ï¼š</strong></p><ul><li><strong>NIO å’Œç½‘ç»œç¼–ç¨‹</strong>ï¼šåœ¨ä½¿ç”¨ Java NIOã€Nettyã€æˆ–è€…å…¶ä»–ä¾èµ–å †å¤–å†…å­˜çš„åº“æ—¶ï¼Œå¦‚æœé¢‘ç¹åœ°åˆ†é…ç›´æ¥å†…å­˜ä½†æ²¡æœ‰åŠæ—¶é‡Šæ”¾ï¼Œå°±å¯èƒ½å¯¼è‡´æ­¤é”™è¯¯ã€‚</li><li><strong>å†…å­˜æ³„æ¼</strong>ï¼šç›´æ¥å†…å­˜çš„å›æ”¶ä¸åƒå †å†…å­˜é‚£æ ·ç”± GC è‡ªåŠ¨ç®¡ç†ã€‚å¦‚æœç¨‹åºä¸­æ²¡æœ‰è°ƒç”¨ <code>ByteBuffer</code> çš„ <code>cleaner()</code> æ–¹æ³•ï¼Œæˆ–è€…åœ¨æ²¡æœ‰å…³é—­èµ„æºçš„æƒ…å†µä¸‹ç›´æ¥å†…å­˜æ³„æ¼ï¼Œå°±ä¼šè€—å°½ç³»ç»Ÿçš„ç›´æ¥å†…å­˜ã€‚</li></ul><hr><h3 id="5-java-lang-OutOfMemoryError-unable-to-create-new-native-thread"><a href="#5-java-lang-OutOfMemoryError-unable-to-create-new-native-thread" class="headerlink" title="5. java.lang.OutOfMemoryError: unable to create new native thread"></a><strong>5. java.lang.OutOfMemoryError: unable to create new native thread</strong></h3><p>è¿™ä¸ªé”™è¯¯é€šå¸¸ä¸æ˜¯å› ä¸º Java å †å†…å­˜ä¸è¶³ï¼Œè€Œæ˜¯å› ä¸º<strong>ç³»ç»Ÿèµ„æºè€—å°½</strong>ã€‚</p><p><strong>å¸¸è§åœºæ™¯ï¼š</strong></p><ul><li><strong>çº¿ç¨‹åˆ›å»ºè¿‡å¤š</strong>ï¼šç¨‹åºä¸­åˆ›å»ºäº†å¤§é‡çš„çº¿ç¨‹ï¼Œå¯¼è‡´ç³»ç»Ÿæ— æ³•ä¸ºæ–°çš„çº¿ç¨‹åˆ†é…å†…å­˜ç©ºé—´ã€‚æ¯ä¸ªçº¿ç¨‹é™¤äº† Java å †ä¸­çš„æ ˆç©ºé—´å¤–ï¼Œè¿˜éœ€è¦åˆ†é…ä¸€äº›æœ¬åœ°å†…å­˜ã€‚</li><li><strong>ç³»ç»Ÿé™åˆ¶</strong>ï¼šæ“ä½œç³»ç»Ÿå¯¹å•ä¸ªè¿›ç¨‹åˆ›å»ºçš„çº¿ç¨‹æ•°æœ‰é™åˆ¶ã€‚å¦‚æœè¾¾åˆ°äº†è¿™ä¸ªä¸Šé™ï¼ŒJVM å°±ä¼šæŠ›å‡ºæ­¤é”™è¯¯ã€‚åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œä½ å¯ä»¥é€šè¿‡ <code>ulimit -u</code> å‘½ä»¤æŸ¥çœ‹è¿™ä¸ªé™åˆ¶ã€‚</li><li><strong>å†…å­˜ä¸è¶³</strong>ï¼šç³»ç»Ÿå†…å­˜ï¼ˆåŒ…æ‹¬å †å¤–å†…å­˜ï¼‰å·²ç»æ‰€å‰©æ— å‡ ï¼ŒJVM æ— æ³•ä¸ºæ–°çš„çº¿ç¨‹æ ˆåˆ†é…è¶³å¤Ÿçš„å†…å­˜ã€‚</li></ul><h3 id="é¢è¯•é¢˜ï¼š-1"><a href="#é¢è¯•é¢˜ï¼š-1" class="headerlink" title="é¢è¯•é¢˜ï¼š"></a>é¢è¯•é¢˜ï¼š</h3><h3 id="1-ç®€è¿°-Java-å †å†…å­˜æº¢å‡ºï¼ˆJava-heap-spaceï¼‰çš„åŸå› åŠè§£å†³æ–¹æ¡ˆã€‚"><a href="#1-ç®€è¿°-Java-å †å†…å­˜æº¢å‡ºï¼ˆJava-heap-spaceï¼‰çš„åŸå› åŠè§£å†³æ–¹æ¡ˆã€‚" class="headerlink" title="1. ç®€è¿° Java å †å†…å­˜æº¢å‡ºï¼ˆJava heap spaceï¼‰çš„åŸå› åŠè§£å†³æ–¹æ¡ˆã€‚"></a>1. ç®€è¿° Java å †å†…å­˜æº¢å‡ºï¼ˆJava heap spaceï¼‰çš„åŸå› åŠè§£å†³æ–¹æ¡ˆã€‚</h3><p><strong>åŸå› ï¼š</strong> æœ€ä¸»è¦çš„åŸå› æ˜¯<strong>å†…å­˜æ³„æ¼</strong>ï¼Œå³ GC æ— æ³•å›æ”¶æœ¬åº”è¢«å›æ”¶çš„å¯¹è±¡ã€‚å…¶ä»–å¸¸è§åŸå› åŒ…æ‹¬ï¼š</p><ul><li><strong>å†…å­˜ä½¿ç”¨ä¸å½“</strong>ï¼šä¸€æ¬¡æ€§åŠ è½½å¤§é‡æ•°æ®åˆ°å†…å­˜ä¸­ï¼Œå¦‚ä»æ•°æ®åº“æŸ¥è¯¢æµ·é‡æ•°æ®ã€‚</li><li><strong>é…ç½®ä¸å½“</strong>ï¼šJVM å¯åŠ¨å‚æ•° <code>-Xmx</code> è®¾ç½®è¿‡å°ï¼Œæ— æ³•æ»¡è¶³åº”ç”¨éœ€æ±‚ã€‚</li></ul><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><ul><li><strong>åˆ†æå’Œå®šä½é—®é¢˜</strong>ï¼šä½¿ç”¨ <code>jmap</code>ã€<code>jstat</code>ã€<code>jstack</code> ç­‰ JDK è‡ªå¸¦å·¥å…·æˆ–è€… <code>Eclipse MAT</code> ç­‰å¯è§†åŒ–å·¥å…·åˆ†æå†…å­˜å¿«ç…§ï¼ˆ<code>heap dump</code>ï¼‰ï¼Œæ‰¾åˆ°å ç”¨å†…å­˜æœ€å¤šçš„å¯¹è±¡ï¼Œå¹¶åˆ†ææ˜¯å¦å­˜åœ¨å†…å­˜æ³„æ¼ã€‚</li><li><strong>ä»£ç å±‚é¢ä¼˜åŒ–</strong>ï¼š<ul><li>æ£€æŸ¥å¹¶è§£å†³å†…å­˜æ³„æ¼é—®é¢˜ï¼Œæ¯”å¦‚ç§»é™¤ä¸å†éœ€è¦çš„é™æ€é›†åˆå¼•ç”¨ã€‚</li><li>ä¼˜åŒ–å¤§æ‰¹é‡æ•°æ®å¤„ç†é€»è¾‘ï¼Œé‡‡ç”¨åˆ†æ‰¹ã€åˆ†é¡µå¤„ç†æˆ–æµå¼å¤„ç†ï¼Œé¿å…ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰æ•°æ®ã€‚</li><li>åŠæ—¶é‡Šæ”¾ä¸å†ä½¿ç”¨çš„èµ„æºï¼Œå¦‚å…³é—­æ•°æ®åº“è¿æ¥ã€æ–‡ä»¶æµç­‰ã€‚</li></ul></li><li><strong>JVM å‚æ•°è°ƒæ•´</strong>ï¼šå¦‚æœç¡®è®¤æ²¡æœ‰å†…å­˜æ³„æ¼ï¼Œåªæ˜¯åº”ç”¨ç¡®å®éœ€è¦æ›´å¤šå†…å­˜ï¼Œå¯ä»¥é€‚å½“å¢å¤§ <code>-Xmx</code> å’Œ <code>-Xms</code> å‚æ•°ã€‚</li></ul><hr><h3 id="2-ä»€ä¹ˆæ˜¯-StackOverflowErrorï¼Ÿå®ƒå’Œ-OOM-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#2-ä»€ä¹ˆæ˜¯-StackOverflowErrorï¼Ÿå®ƒå’Œ-OOM-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="2. ä»€ä¹ˆæ˜¯ StackOverflowErrorï¼Ÿå®ƒå’Œ OOM æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>2. ä»€ä¹ˆæ˜¯ StackOverflowErrorï¼Ÿå®ƒå’Œ OOM æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><p><strong>StackOverflowError</strong> è¡¨ç¤º<strong>è™šæ‹Ÿæœºæ ˆ</strong>æº¢å‡ºï¼Œé€šå¸¸æ˜¯ç”±äº<strong>æ— é™é€’å½’</strong>æˆ–<strong>é€’å½’è°ƒç”¨å±‚çº§è¿‡æ·±</strong>å¯¼è‡´æ ˆå¸§ä¸æ–­å…¥æ ˆè€Œè€—å°½äº†æ ˆç©ºé—´ã€‚</p><p><strong>ä¸ OOM çš„åŒºåˆ«ï¼š</strong></p><ul><li><strong>å‘ç”Ÿä½ç½®ä¸åŒ</strong>ï¼š<code>StackOverflowError</code> å‘ç”Ÿåœ¨<strong>è™šæ‹Ÿæœºæ ˆ</strong>ï¼Œè€Œ <code>OutOfMemoryError</code> å‘ç”Ÿåœ¨<strong>å †</strong>æˆ–<strong>æ–¹æ³•åŒº</strong>ç­‰å…¶ä»–å†…å­˜åŒºåŸŸã€‚</li><li><strong>åŸå› ä¸åŒ</strong>ï¼š<code>StackOverflowError</code> é€šå¸¸æ˜¯ç”±äº<strong>ä»£ç é€»è¾‘é—®é¢˜</strong>ï¼ˆå¦‚æ— é™é€’å½’ï¼‰å¯¼è‡´ï¼Œä¸ç¨‹åºå¤„ç†çš„æ•°æ®é‡å¤§å°å…³ç³»ä¸å¤§ï¼ˆé™¤éé€’å½’æ·±åº¦è¿‡æ·±ï¼‰ã€‚è€Œ <code>OOM</code> å¾€å¾€ä¸<strong>ç¨‹åºå¤„ç†çš„æ•°æ®é‡</strong>ã€<strong>JVM å†…å­˜é…ç½®</strong>æˆ–<strong>å†…å­˜æ³„æ¼</strong>æœ‰å…³ã€‚</li><li><strong>è§£å†³æ–¹å¼ä¸åŒ</strong>ï¼šè§£å†³ <code>StackOverflowError</code> ä¸»è¦éœ€è¦<strong>ä¿®æ”¹ä»£ç </strong>ï¼Œæ¯”å¦‚å¢åŠ é€’å½’çš„é€€å‡ºæ¡ä»¶æˆ–é‡‡ç”¨éé€’å½’ï¼ˆè¿­ä»£ï¼‰æ–¹å¼é‡æ„ã€‚è€Œè§£å†³ <code>OOM</code> åˆ™éœ€è¦<strong>å®šä½å†…å­˜æ³„æ¼</strong>ã€<strong>ä¼˜åŒ–ä»£ç </strong>æˆ–<strong>è°ƒæ•´ JVM å†…å­˜å‚æ•°</strong>ã€‚</li></ul><hr><h3 id="3-JDK-8-ä¸­-PermGen-space-æº¢å‡ºé”™è¯¯ä¸ºä»€ä¹ˆå˜æˆäº†-Metaspaceï¼Ÿ"><a href="#3-JDK-8-ä¸­-PermGen-space-æº¢å‡ºé”™è¯¯ä¸ºä»€ä¹ˆå˜æˆäº†-Metaspaceï¼Ÿ" class="headerlink" title="3. JDK 8 ä¸­ PermGen space æº¢å‡ºé”™è¯¯ä¸ºä»€ä¹ˆå˜æˆäº† Metaspaceï¼Ÿ"></a>3. JDK 8 ä¸­ PermGen space æº¢å‡ºé”™è¯¯ä¸ºä»€ä¹ˆå˜æˆäº† Metaspaceï¼Ÿ</h3><ul><li><strong>JDK 1.7 åŠä¹‹å‰</strong>ï¼šæ–¹æ³•åŒºè¢«å®ç°ä¸º<strong>æ°¸ä¹…ä»£ï¼ˆPermGenï¼‰</strong>ï¼Œå®ƒå±äº<strong>å †å†…å­˜çš„ä¸€éƒ¨åˆ†</strong>ã€‚å› æ­¤ï¼Œå®ƒçš„ç©ºé—´å¤§å°å—é™äº JVM å †å†…å­˜çš„è®¾ç½®ï¼Œå®¹æ˜“å‘ç”Ÿ <code>PermGen space</code> æº¢å‡ºã€‚</li><li><strong>JDK 1.8 åŠä¹‹å</strong>ï¼š<strong>æ°¸ä¹…ä»£è¢«ç§»é™¤</strong>ï¼Œæ–¹æ³•åŒºæ”¹ä¸º<strong>å…ƒç©ºé—´ï¼ˆMetaspaceï¼‰</strong>ã€‚å…ƒç©ºé—´<strong>ä¸åœ¨ JVM å †ä¸­</strong>ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨<strong>æœ¬åœ°å†…å­˜</strong>ï¼ˆNative Memoryï¼‰ã€‚</li></ul><p><strong>å˜åŒ–çš„å¥½å¤„ï¼š</strong></p><ul><li><strong>å‡å°‘ OOM å¯èƒ½æ€§</strong>ï¼šå…ƒç©ºé—´ä½¿ç”¨æœ¬åœ°å†…å­˜ï¼Œå…¶å¤§å°åªå—é™äºç³»ç»Ÿå¯ç”¨å†…å­˜ï¼Œé»˜è®¤æƒ…å†µä¸‹æ¯”æ°¸ä¹…ä»£å¤§å¾—å¤šï¼Œä»è€Œé™ä½äº†å› æ–¹æ³•åŒºè¿‡å°è€Œå¼•å‘ OOM çš„é£é™©ã€‚</li><li><strong>é¿å… GC è´Ÿæ‹…</strong>ï¼šæ°¸ä¹…ä»£éœ€è¦ç”± GC è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œè€Œå…ƒç©ºé—´åˆ™é€šè¿‡ <code>class loader</code> å¼•ç”¨æ¥ç®¡ç†ï¼Œå½“å¯¹åº”çš„ <code>class loader</code> è¢«å›æ”¶æ—¶ï¼Œå…¶åŠ è½½çš„ç±»å…ƒæ•°æ®ä¹Ÿä¼šè¢«å›æ”¶ã€‚</li><li><strong>æ›´çµæ´»</strong>ï¼šå…ƒç©ºé—´çš„å¤§å°å¯ä»¥é€šè¿‡å‚æ•° <code>-XX:MaxMetaspaceSize</code> æ¥è®¾ç½®ä¸Šé™ï¼Œå¦‚æœè¯¥å‚æ•°ä¸è®¾ç½®ï¼Œå…ƒç©ºé—´ä¼šæ ¹æ®éœ€è¦è‡ªåŠ¨æ‰©å®¹ã€‚</li></ul><hr><h3 id="4-é™¤äº†-Java-å †ï¼Œè¿˜æœ‰å“ªäº›å†…å­˜åŒºåŸŸå¯èƒ½å‘ç”Ÿ-OOMï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ"><a href="#4-é™¤äº†-Java-å †ï¼Œè¿˜æœ‰å“ªäº›å†…å­˜åŒºåŸŸå¯èƒ½å‘ç”Ÿ-OOMï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ" class="headerlink" title="4. é™¤äº† Java å †ï¼Œè¿˜æœ‰å“ªäº›å†…å­˜åŒºåŸŸå¯èƒ½å‘ç”Ÿ OOMï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ"></a>4. é™¤äº† Java å †ï¼Œè¿˜æœ‰å“ªäº›å†…å­˜åŒºåŸŸå¯èƒ½å‘ç”Ÿ OOMï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ</h3><ul><li><strong>ç›´æ¥å†…å­˜ï¼ˆDirect buffer memoryï¼‰</strong>ï¼š<ul><li><strong>åŸå› </strong>ï¼šé€šå¸¸æ˜¯ä½¿ç”¨ NIO æˆ– Netty ç­‰æ¡†æ¶æ—¶ï¼Œé¢‘ç¹åˆ†é…å †å¤–å†…å­˜ä½†æ²¡æœ‰åŠæ—¶é‡Šæ”¾ã€‚</li><li><strong>è§£å†³</strong>ï¼šæ£€æŸ¥ä»£ç ä¸­å †å¤–å†…å­˜çš„ä½¿ç”¨ï¼Œç¡®ä¿åœ¨ä¸å†éœ€è¦æ—¶é€šè¿‡ <code>Buffer.cleaner()</code> æˆ–èµ„æºå…³é—­æ“ä½œæ¥æ˜¾å¼é‡Šæ”¾å†…å­˜ã€‚</li></ul></li><li><strong>æ— æ³•åˆ›å»ºæ–°çº¿ç¨‹ï¼ˆunable to create new native threadï¼‰</strong>ï¼š<ul><li><strong>åŸå› </strong>ï¼š<ol><li>ç¨‹åºåˆ›å»ºäº†<strong>è¿‡å¤šçº¿ç¨‹</strong>ï¼Œè€—å°½äº†æ“ä½œç³»ç»Ÿå¯¹å•ä¸ªè¿›ç¨‹çš„çº¿ç¨‹æ•°é™åˆ¶ã€‚</li><li>ç³»ç»Ÿ<strong>å†…å­˜ä¸è¶³</strong>ï¼Œæ— æ³•ä¸ºæ–°çº¿ç¨‹åˆ†é…æ ˆç©ºé—´ã€‚</li></ol></li><li><strong>è§£å†³</strong>ï¼š<ol><li><strong>ä»£ç ä¼˜åŒ–</strong>ï¼šæ£€æŸ¥ä¸šåŠ¡é€»è¾‘ï¼Œçœ‹æ˜¯å¦å¯ä»¥å‡å°‘çº¿ç¨‹åˆ›å»ºæ•°é‡ï¼Œæˆ–è€…ä½¿ç”¨çº¿ç¨‹æ± æ¥å¤ç”¨çº¿ç¨‹ã€‚</li><li><strong>ç³»ç»Ÿé…ç½®</strong>ï¼š<ul><li>åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œä½¿ç”¨ <code>ulimit -u</code> å¢åŠ çº¿ç¨‹æ•°é™åˆ¶ã€‚</li><li>æ£€æŸ¥ç³»ç»Ÿå†…å­˜ï¼Œç¡®ä¿æœ‰è¶³å¤Ÿçš„å†…å­˜ç©ºé—´ã€‚</li></ul></li><li><strong>JVM å‚æ•°è°ƒæ•´</strong>ï¼šå¦‚æœçº¿ç¨‹ç¡®å®éœ€è¦ï¼Œå¯ä»¥é€‚å½“å‡å°çº¿ç¨‹æ ˆçš„å¤§å°ï¼ˆ<code>-Xss</code>ï¼‰æ¥å…è®¸åˆ›å»ºæ›´å¤šçº¿ç¨‹ï¼Œä½†éœ€è¦æ³¨æ„é˜²æ­¢ StackOverflowErrorã€‚</li></ol></li></ul></li></ul><h1 id="Javaæ¡†æ¶æ ¸å¿ƒçŸ¥è¯†è¯¦è§£"><a href="#Javaæ¡†æ¶æ ¸å¿ƒçŸ¥è¯†è¯¦è§£" class="headerlink" title="Javaæ¡†æ¶æ ¸å¿ƒçŸ¥è¯†è¯¦è§£"></a>Javaæ¡†æ¶æ ¸å¿ƒçŸ¥è¯†è¯¦è§£</h1><h2 id="ä¸€ã€Springæ¡†æ¶æ·±å…¥è§£æ"><a href="#ä¸€ã€Springæ¡†æ¶æ·±å…¥è§£æ" class="headerlink" title="ä¸€ã€Springæ¡†æ¶æ·±å…¥è§£æ"></a>ä¸€ã€Springæ¡†æ¶æ·±å…¥è§£æ</h2><h3 id="1-1-Springæ ¸å¿ƒæ¦‚å¿µä¸åŸç†"><a href="#1-1-Springæ ¸å¿ƒæ¦‚å¿µä¸åŸç†" class="headerlink" title="1.1 Springæ ¸å¿ƒæ¦‚å¿µä¸åŸç†"></a>1.1 Springæ ¸å¿ƒæ¦‚å¿µä¸åŸç†</h3><p>Springæ¡†æ¶æ˜¯ä¸€ä¸ªåˆ†å±‚çš„ä¼ä¸šçº§åº”ç”¨å¼€å‘æ¡†æ¶ï¼Œå…¶æ ¸å¿ƒæ˜¯æ§åˆ¶åè½¬ï¼ˆIoCï¼‰å’Œé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼ˆAOPï¼‰ã€‚</p><h4 id="IoCå®¹å™¨åŸç†æ·±å…¥åˆ†æ"><a href="#IoCå®¹å™¨åŸç†æ·±å…¥åˆ†æ" class="headerlink" title="IoCå®¹å™¨åŸç†æ·±å…¥åˆ†æ"></a>IoCå®¹å™¨åŸç†æ·±å…¥åˆ†æ</h4><p><strong>IoCï¼ˆæ§åˆ¶åè½¬ï¼‰çš„æœ¬è´¨ï¼š</strong> ä¼ ç»Ÿå¼€å‘ä¸­ï¼Œå¯¹è±¡çš„åˆ›å»ºå’Œä¾èµ–å…³ç³»ç”±ç¨‹åºä»£ç ç›´æ¥æ§åˆ¶ï¼Œè€ŒIoCå°†è¿™ä¸ªæ§åˆ¶æƒäº¤ç»™äº†å¤–éƒ¨å®¹å™¨ã€‚Springé€šè¿‡ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰æ¥å®ç°IoCã€‚</p><p><strong>IoCå®¹å™¨çš„å®ç°æœºåˆ¶ï¼š</strong></p><ol><li><strong>BeanFactory</strong>: åŸºç¡€å®¹å™¨ï¼Œæä¾›åŸºæœ¬çš„IoCåŠŸèƒ½</li><li><strong>ApplicationContext</strong>: é«˜çº§å®¹å™¨ï¼Œç»§æ‰¿BeanFactoryï¼Œæä¾›æ›´å¤šä¼ä¸šçº§åŠŸèƒ½</li></ol><p>å¥½çš„ï¼Œæˆ‘ä»¬æŠŠ <strong>Spring IoCå®¹å™¨çš„å®ç°æœºåˆ¶</strong> å±•å¼€è®²æ¸…æ¥šï¼Œä» <strong>BeanFactory</strong> åˆ° <strong>ApplicationContext</strong> çš„å±‚æ¬¡æ¼”è¿›ï¼Œä»¥åŠå®ƒä»¬åœ¨åº•å±‚æ˜¯å¦‚ä½•è¿ä½œçš„ã€‚</p><hr><h1 id="IoC-å®¹å™¨å®ç°æœºåˆ¶"><a href="#IoC-å®¹å™¨å®ç°æœºåˆ¶" class="headerlink" title="IoC å®¹å™¨å®ç°æœºåˆ¶"></a>IoC å®¹å™¨å®ç°æœºåˆ¶</h1><h2 id="1-BeanFactory-â€”â€”-åŸºç¡€-IoC-å®¹å™¨"><a href="#1-BeanFactory-â€”â€”-åŸºç¡€-IoC-å®¹å™¨" class="headerlink" title="1. BeanFactory â€”â€” åŸºç¡€ IoC å®¹å™¨"></a>1. BeanFactory â€”â€” åŸºç¡€ IoC å®¹å™¨</h2><p><code>BeanFactory</code> æ˜¯ Spring IoC çš„æœ€åº•å±‚å®¹å™¨æ¥å£ï¼Œå®šä¹‰äº† <strong>è·å– Bean çš„åŸºæœ¬è§„åˆ™</strong>ã€‚</p><h3 id="æ ¸å¿ƒç‰¹æ€§"><a href="#æ ¸å¿ƒç‰¹æ€§" class="headerlink" title="æ ¸å¿ƒç‰¹æ€§"></a>æ ¸å¿ƒç‰¹æ€§</h3><ul><li><strong>æ‡’åŠ è½½ï¼ˆLazy loadingï¼‰</strong><ul><li>åªæœ‰åœ¨è°ƒç”¨ <code>getBean()</code> æ—¶ï¼Œæ‰ä¼šå»å®ä¾‹åŒ– Beanã€‚</li><li>é¿å…å¯åŠ¨æ—¶æ¶ˆè€—è¿‡å¤šèµ„æºã€‚</li></ul></li><li><strong>æœ€å°ä¾èµ–</strong><ul><li>åªæä¾› IoC çš„åŸºç¡€åŠŸèƒ½ï¼š<ul><li>Bean çš„å®šä¹‰ï¼ˆBeanDefinitionï¼‰ç®¡ç†</li><li>Bean çš„ç”Ÿå‘½å‘¨æœŸï¼ˆåˆ›å»ºã€ä¾èµ–æ³¨å…¥ã€é”€æ¯ï¼‰</li><li>Bean çš„ä½œç”¨åŸŸï¼ˆsingleton &#x2F; prototypeï¼‰</li></ul></li></ul></li><li><strong>è½»é‡çº§</strong><ul><li>æ›´é€‚åˆèµ„æºå—é™ç¯å¢ƒï¼Œæ¯”å¦‚ IoTã€ç§»åŠ¨è®¾å¤‡ï¼Œæˆ– Spring çš„åº•å±‚æ¡†æ¶å†…éƒ¨ã€‚</li></ul></li></ul><h3 id="æ ¸å¿ƒå®ç°æœºåˆ¶"><a href="#æ ¸å¿ƒå®ç°æœºåˆ¶" class="headerlink" title="æ ¸å¿ƒå®ç°æœºåˆ¶"></a>æ ¸å¿ƒå®ç°æœºåˆ¶</h3><ol><li><strong>è¯»å– BeanDefinition</strong><ul><li>é…ç½®æ–‡ä»¶(XML)ã€æ³¨è§£(@Component)ã€Java Config( @Bean ) â†’ è½¬æ¢æˆ <strong>BeanDefinition</strong> å¯¹è±¡ã€‚</li><li>BeanDefinition æ˜¯ Bean çš„æŠ½è±¡æè¿°ï¼ŒåŒ…æ‹¬ï¼š<ul><li>Bean çš„ class ç±»å‹</li><li>æ˜¯å¦å•ä¾‹ &#x2F; åŸå‹</li><li>æ˜¯å¦æ‡’åŠ è½½</li><li>æ„é€ å‚æ•° &#x2F; ä¾èµ–å±æ€§</li></ul></li></ul></li><li><strong>å­˜å‚¨ BeanDefinition</strong><ul><li>å­˜å…¥ <strong>BeanDefinitionRegistry</strong>ï¼ˆé€šå¸¸æ˜¯ Map ç»“æ„ï¼‰ã€‚</li></ul></li><li><strong>æŒ‰éœ€å®ä¾‹åŒ– Bean</strong><ul><li>è°ƒç”¨ <code>getBean(name)</code> â†’ æ ¹æ® BeanDefinition åå°„åˆ›å»ºå®ä¾‹ã€‚</li><li>è¿›è¡Œä¾èµ–æ³¨å…¥ï¼ˆæ„é€ å™¨æ³¨å…¥ &#x2F; setter æ³¨å…¥ï¼‰ã€‚</li></ul></li><li><strong>Bean ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong><ul><li>åˆå§‹åŒ–å‰å›è°ƒï¼ˆBeanPostProcessor â†’ <code>postProcessBeforeInitialization</code>ï¼‰</li><li>è°ƒç”¨åˆå§‹åŒ–æ–¹æ³•ï¼ˆ<code>InitializingBean</code> æˆ– <code>@PostConstruct</code>ï¼‰</li><li>åˆå§‹åŒ–åå›è°ƒï¼ˆBeanPostProcessor â†’ <code>postProcessAfterInitialization</code>ï¼‰</li><li>é”€æ¯å‰å›è°ƒï¼ˆ<code>DisposableBean</code> æˆ– <code>@PreDestroy</code>ï¼‰</li></ul></li></ol><hr><h2 id="2-ApplicationContext-â€”â€”-é«˜çº§-IoC-å®¹å™¨"><a href="#2-ApplicationContext-â€”â€”-é«˜çº§-IoC-å®¹å™¨" class="headerlink" title="2. ApplicationContext â€”â€” é«˜çº§ IoC å®¹å™¨"></a>2. ApplicationContext â€”â€” é«˜çº§ IoC å®¹å™¨</h2><p><code>ApplicationContext</code> æ˜¯ <code>BeanFactory</code> çš„å­æ¥å£ï¼Œæ‰©å±•äº†å¾ˆå¤š <strong>ä¼ä¸šçº§ç‰¹æ€§</strong>ï¼Œæ˜¯æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­æœ€å¸¸ç”¨çš„å®¹å™¨ã€‚</p><h3 id="æ ¸å¿ƒç‰¹æ€§ï¼ˆå¯¹æ¯”-BeanFactoryï¼‰"><a href="#æ ¸å¿ƒç‰¹æ€§ï¼ˆå¯¹æ¯”-BeanFactoryï¼‰" class="headerlink" title="æ ¸å¿ƒç‰¹æ€§ï¼ˆå¯¹æ¯” BeanFactoryï¼‰"></a>æ ¸å¿ƒç‰¹æ€§ï¼ˆå¯¹æ¯” BeanFactoryï¼‰</h3><ol><li><strong>é¢„å®ä¾‹åŒ–ï¼ˆEager loadingï¼‰</strong><ul><li>é»˜è®¤åœ¨å®¹å™¨å¯åŠ¨æ—¶ï¼Œå°±ä¼šå®ä¾‹åŒ–æ‰€æœ‰å•ä¾‹ Beanã€‚</li><li>å¯åŠ¨æ—¶æ€§èƒ½å¼€é”€æ›´å¤§ï¼Œä½†è¿è¡Œæ—¶æ€§èƒ½æ›´å¥½ã€‚</li></ul></li><li><strong>å›½é™…åŒ–ï¼ˆI18Nï¼‰æ”¯æŒ</strong><ul><li>é€šè¿‡ <code>MessageSource</code> æ¥å£ï¼Œæ”¯æŒä¸åŒè¯­è¨€çš„æ¶ˆæ¯è§£æã€‚</li></ul></li><li><strong>äº‹ä»¶æœºåˆ¶ï¼ˆApplicationEventï¼‰</strong><ul><li>å†…ç½®äº‹ä»¶å‘å¸ƒ &#x2F; ç›‘å¬æœºåˆ¶ï¼ˆè§‚å¯Ÿè€…æ¨¡å¼ï¼‰ã€‚</li><li>å¼€å‘è€…å¯ä»¥è‡ªå®šä¹‰äº‹ä»¶ï¼Œå®ç°åº”ç”¨å†…è§£è€¦ã€‚</li></ul></li><li><strong>èµ„æºåŠ è½½</strong><ul><li>ç»Ÿä¸€çš„ <code>Resource</code> æŠ½è±¡ï¼Œå¯ä»¥åŠ è½½æ–‡ä»¶ã€URLã€classpath ä¸‹çš„èµ„æºã€‚</li></ul></li><li><strong>ä¸ AOPã€äº‹åŠ¡ç®¡ç†é›†æˆ</strong><ul><li>è‡ªåŠ¨è¯†åˆ« BeanPostProcessorã€BeanFactoryPostProcessorï¼Œç”¨äºæ‰©å±• Bean ç”Ÿå‘½å‘¨æœŸé€»è¾‘ï¼ˆä¾‹å¦‚äº‹åŠ¡ä»£ç†ã€AOP åŠ¨æ€ä»£ç†ï¼‰ã€‚</li></ul></li><li><strong>Profile ç¯å¢ƒæ”¯æŒ</strong><ul><li>æ”¯æŒå¤šç¯å¢ƒé…ç½®ï¼ˆå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ï¼‰ï¼Œé€šè¿‡ <code>@Profile</code> æ³¨è§£åˆ‡æ¢ã€‚</li></ul></li></ol><hr><h2 id="3-BeanFactory-vs-ApplicationContext-æ€»ç»“"><a href="#3-BeanFactory-vs-ApplicationContext-æ€»ç»“" class="headerlink" title="3. BeanFactory vs ApplicationContext æ€»ç»“"></a>3. BeanFactory vs ApplicationContext æ€»ç»“</h2><table><thead><tr><th>ç‰¹æ€§</th><th><strong>BeanFactory</strong></th><th><strong>ApplicationContext</strong></th></tr></thead><tbody><tr><td><strong>Bean åŠ è½½æ—¶æœº</strong></td><td>æ‡’åŠ è½½ï¼ˆæŒ‰éœ€åˆ›å»ºï¼‰</td><td>é¢„å®ä¾‹åŒ–ï¼ˆå¯åŠ¨æ—¶åˆ›å»ºå•ä¾‹ Beanï¼‰</td></tr><tr><td><strong>å›½é™…åŒ–æ”¯æŒ</strong></td><td>âŒ</td><td>âœ…</td></tr><tr><td><strong>äº‹ä»¶æœºåˆ¶</strong></td><td>âŒ</td><td>âœ…</td></tr><tr><td><strong>AOP &#x2F; äº‹åŠ¡</strong></td><td>æ‰‹åŠ¨æ³¨å†Œ BeanPostProcessor</td><td>è‡ªåŠ¨è¯†åˆ«å¹¶åº”ç”¨</td></tr><tr><td><strong>èµ„æºåŠ è½½</strong></td><td>åŸºç¡€ API</td><td>æ›´å¼ºå¤§çš„ Resource æŠ½è±¡</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>è½»é‡åº”ç”¨ã€åº•å±‚å®¹å™¨</td><td>ä¼ä¸šçº§åº”ç”¨ï¼Œå¤§éƒ¨åˆ† Spring é¡¹ç›®</td></tr></tbody></table><hr><h2 id="4-å¸¸è§-ApplicationContext-å®ç°ç±»"><a href="#4-å¸¸è§-ApplicationContext-å®ç°ç±»" class="headerlink" title="4. å¸¸è§ ApplicationContext å®ç°ç±»"></a>4. å¸¸è§ ApplicationContext å®ç°ç±»</h2><ul><li><strong>ClassPathXmlApplicationContext</strong><ul><li>ä» classpath ä¸‹çš„ XML åŠ è½½é…ç½®ã€‚</li></ul></li><li><strong>FileSystemXmlApplicationContext</strong><ul><li>ä»æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ä¸‹åŠ è½½ XML é…ç½®ã€‚</li></ul></li><li><strong>AnnotationConfigApplicationContext</strong><ul><li>åŸºäºæ³¨è§£å’Œ Java Config çš„å®¹å™¨ã€‚</li></ul></li><li><strong>WebApplicationContext</strong><ul><li>ä¸“é—¨ä¸º Web åº”ç”¨å‡†å¤‡çš„ IoC å®¹å™¨ï¼Œæ•´åˆ ServletContextã€‚</li></ul></li></ul><hr><p>ğŸ‘‰ å¯ä»¥è¿™æ ·ç†è§£ï¼š</p><ul><li><code>BeanFactory</code> å°±æ˜¯ IoC çš„â€œå‘åŠ¨æœºâ€ï¼Œæä¾›æœ€åŸºæœ¬çš„åŠ¨åŠ›ã€‚</li><li><code>ApplicationContext</code> å°±æ˜¯åŠ äº†â€œå˜é€Ÿç®±ã€è½¦è½½å¨±ä¹ç³»ç»Ÿã€ç©ºè°ƒã€æ™ºèƒ½å¯¼èˆªâ€çš„å®Œæ•´æ±½è½¦ï¼Œæ›´é€‚åˆå®é™…ä¼ä¸šåº”ç”¨ã€‚</li></ul><p><strong>Beançš„ç”Ÿå‘½å‘¨æœŸè¯¦è§£ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å®ä¾‹åŒ– â†’ å±æ€§èµ‹å€¼ â†’ åˆå§‹åŒ–å‰å¤„ç† â†’ åˆå§‹åŒ– â†’ åˆå§‹åŒ–åå¤„ç† â†’ ä½¿ç”¨ â†’ é”€æ¯å‰å¤„ç† â†’ é”€æ¯</span><br></pre></td></tr></table></figure><p><strong>è¯¦ç»†ç”Ÿå‘½å‘¨æœŸæ­¥éª¤ï¼š</strong></p><ol><li>Beanå…ƒæ•°æ®è§£æï¼ˆXMLã€æ³¨è§£ã€Javaé…ç½®ï¼‰</li><li>è°ƒç”¨Beanæ„é€ å‡½æ•°å®ä¾‹åŒ–</li><li>ä¾èµ–æ³¨å…¥ï¼ˆsetteræ–¹æ³•ã€æ„é€ å‡½æ•°ã€å­—æ®µæ³¨å…¥ï¼‰</li><li>å¦‚æœå®ç°äº†BeanNameAwareï¼Œè°ƒç”¨setBeanName()</li><li>å¦‚æœå®ç°äº†BeanFactoryAwareï¼Œè°ƒç”¨setBeanFactory()</li><li>å¦‚æœå®ç°äº†ApplicationContextAwareï¼Œè°ƒç”¨setApplicationContext()</li><li>å¦‚æœæœ‰BeanPostProcessorï¼Œè°ƒç”¨postProcessBeforeInitialization()</li><li>å¦‚æœå®ç°äº†InitializingBeanï¼Œè°ƒç”¨afterPropertiesSet()</li><li>å¦‚æœé…ç½®äº†init-methodï¼Œè°ƒç”¨è‡ªå®šä¹‰åˆå§‹åŒ–æ–¹æ³•</li><li>å¦‚æœæœ‰BeanPostProcessorï¼Œè°ƒç”¨postProcessAfterInitialization()</li><li>Beanå¯ä»¥è¢«ä½¿ç”¨</li><li>å®¹å™¨å…³é—­æ—¶ï¼Œå¦‚æœå®ç°äº†DisposableBeanï¼Œè°ƒç”¨destroy()</li><li>å¦‚æœé…ç½®äº†destroy-methodï¼Œè°ƒç”¨è‡ªå®šä¹‰é”€æ¯æ–¹æ³•</li></ol><h4 id="DIçš„ä¸‰ç§æ³¨å…¥æ–¹å¼å¯¹æ¯”"><a href="#DIçš„ä¸‰ç§æ³¨å…¥æ–¹å¼å¯¹æ¯”" class="headerlink" title="DIçš„ä¸‰ç§æ³¨å…¥æ–¹å¼å¯¹æ¯”"></a>DIçš„ä¸‰ç§æ³¨å…¥æ–¹å¼å¯¹æ¯”</h4><ul><li><strong>æ„é€ å™¨æ³¨å…¥ï¼ˆConstructor Injectionï¼‰</strong><ul><li><strong>ä¼˜ç‚¹</strong>ï¼šå¼ºåˆ¶ä¾èµ–ã€ä¾èµ–æ¸…æ™°ã€ä¸å¯å˜æ€§</li><li><strong>ç¼ºç‚¹</strong>ï¼šå½“ä¾èµ–é¡¹è¿‡å¤šæ—¶æ„é€ å‡½æ•°è‡ƒè‚¿</li><li><strong>æœ€ä½³å®è·µ</strong>ï¼šå®˜æ–¹æ¨èï¼Œç‰¹åˆ«æ˜¯å½“ä¾èµ–æ˜¯å¿…éœ€çš„ã€ä¸å¯é€‰çš„æ—¶å€™</li></ul></li><li><strong>Setteræ³¨å…¥ï¼ˆSetter Injectionï¼‰</strong><ul><li><strong>ä¼˜ç‚¹</strong>ï¼šå¯é€‰ä¾èµ–ï¼Œçµæ´»æ€§é«˜</li><li><strong>ç¼ºç‚¹</strong>ï¼šå¯¹è±¡å¯èƒ½å¤„äºä¸å®Œæ•´çŠ¶æ€ï¼Œæ— æ³•ä½¿ç”¨finalä¿®é¥°</li><li><strong>æœ€ä½³å®è·µ</strong>ï¼šç”¨äºæ³¨å…¥å¯é€‰çš„ä¾èµ–é¡¹</li></ul></li><li><strong>å­—æ®µæ³¨å…¥ï¼ˆField Injectionï¼‰</strong><ul><li><strong>ä¼˜ç‚¹</strong>ï¼šä»£ç ç®€æ´</li><li><strong>ç¼ºç‚¹</strong>ï¼šä¸æ¨èä½¿ç”¨ï¼Œéšè—ä¾èµ–ã€æµ‹è¯•å›°éš¾ã€æ— æ³•ä½¿ç”¨finalä¿®é¥°</li></ul></li></ul><h3 id="Bean-çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#Bean-çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="Bean çš„ç”Ÿå‘½å‘¨æœŸ"></a>Bean çš„ç”Ÿå‘½å‘¨æœŸ</h3><p>åœ¨ä¼ ç»Ÿçš„ Java åº”ç”¨ä¸­ï¼ŒBean çš„ç”Ÿå‘½å‘¨æœŸå¾ˆç®€å•ï¼šä½¿ç”¨ <code>new</code> å…³é”®å­—è¿›è¡Œå®ä¾‹åŒ–ï¼Œç„¶å Bean å°±èƒ½è¢«ä½¿ç”¨ï¼Œä¸å†ä½¿ç”¨æ—¶ï¼Œç”± Java è‡ªåŠ¨è¿›è¡Œåƒåœ¾å›æ”¶ã€‚</p><p>ç›¸æ¯”ä¹‹ä¸‹ï¼ŒSpring ç®¡ç† Bean çš„ç”Ÿå‘½å‘¨æœŸå°±å¤æ‚å¤šäº†ï¼Œæ­£ç¡®ç†è§£ Bean çš„ç”Ÿå‘½å‘¨æœŸéå¸¸é‡è¦ï¼Œå› ä¸º Spring å¯¹ Bean çš„ç®¡ç†å¯æ‰©å±•æ€§éå¸¸å¼ºã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ª Bean çš„æ„é€ è¿‡ç¨‹ï¼š</p><ol><li><strong>Spring å¯åŠ¨</strong>ï¼šæŸ¥æ‰¾å¹¶åŠ è½½éœ€è¦è¢« Spring ç®¡ç†çš„ Beanï¼Œè¿›è¡Œ Bean çš„å®ä¾‹åŒ–ã€‚</li><li><strong>å±æ€§æ³¨å…¥</strong>ï¼šå¯¹ Bean çš„å¼•ç”¨å’Œå€¼æ³¨å…¥åˆ° Bean çš„å±æ€§ä¸­ã€‚</li><li><strong>BeanNameAware æ¥å£</strong>ï¼šå¦‚æœ Bean å®ç°äº† <code>BeanNameAware</code> æ¥å£ï¼ŒSpring å°† Bean çš„ Id ä¼ é€’ç»™ <code>setBeanName()</code> æ–¹æ³•ã€‚</li><li><strong>BeanFactoryAware æ¥å£</strong>ï¼šå¦‚æœ Bean å®ç°äº† <code>BeanFactoryAware</code> æ¥å£ï¼ŒSpring å°†è°ƒç”¨ <code>setBeanFactory()</code> æ–¹æ³•ï¼Œå°† <code>BeanFactory</code> å®¹å™¨å®ä¾‹ä¼ å…¥ã€‚</li><li><strong>ApplicationContextAware æ¥å£</strong>ï¼šå¦‚æœ Bean å®ç°äº† <code>ApplicationContextAware</code> æ¥å£ï¼ŒSpring å°†è°ƒç”¨ Bean çš„ <code>setApplicationContext()</code> æ–¹æ³•ï¼Œå°† Bean æ‰€åœ¨çš„åº”ç”¨ä¸Šä¸‹æ–‡å¼•ç”¨ä¼ å…¥ã€‚</li><li><strong>BeanPostProcessor (å‰)</strong>ï¼šå¦‚æœ Bean å®ç°äº† <code>BeanPostProcessor</code> æ¥å£ï¼ŒSpring å°†è°ƒç”¨å®ƒä»¬çš„ <code>postProcessBeforeInitialization()</code> æ–¹æ³•ã€‚</li><li><strong>InitializingBean æ¥å£ä¸ init-method</strong>ï¼š<ul><li>å¦‚æœ Bean å®ç°äº† <code>InitializingBean</code> æ¥å£ï¼ŒSpring å°†è°ƒç”¨å®ƒä»¬çš„ <code>afterPropertiesSet()</code> æ–¹æ³•ã€‚</li><li>å¦‚æœ Bean ä½¿ç”¨ <code>init-method</code> å£°æ˜äº†åˆå§‹åŒ–æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¹Ÿä¼šè¢«è°ƒç”¨ã€‚</li></ul></li><li><strong>BeanPostProcessor (å)</strong>ï¼šå¦‚æœ Bean å®ç°äº† <code>BeanPostProcessor</code> æ¥å£ï¼ŒSpring å°†è°ƒç”¨å®ƒä»¬çš„ <code>postProcessAfterInitialization()</code> æ–¹æ³•ã€‚</li><li><strong>Bean å‡†å¤‡å°±ç»ª</strong>ï¼šæ­¤æ—¶ï¼ŒBean å·²ç»å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥è¢«åº”ç”¨ç¨‹åºä½¿ç”¨ã€‚å®ƒä»¬å°†ä¸€ç›´é©»ç•™åœ¨åº”ç”¨ä¸Šä¸‹æ–‡ä¸­ï¼Œç›´åˆ°åº”ç”¨ä¸Šä¸‹æ–‡è¢«é”€æ¯ã€‚</li><li><strong>é”€æ¯</strong>ï¼š<ul><li>å¦‚æœ Bean å®ç°äº† <code>DisposableBean</code> æ¥å£ï¼ŒSpring å°†è°ƒç”¨å®ƒçš„ <code>destory()</code> æ¥å£æ–¹æ³•ã€‚</li><li>å¦‚æœ Bean ä½¿ç”¨ <code>destory-method</code> å£°æ˜äº†é”€æ¯æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¹Ÿä¼šè¢«è°ƒç”¨ã€‚</li></ul></li></ol><hr><h3 id="Bean-çš„ä½œç”¨åŸŸ"><a href="#Bean-çš„ä½œç”¨åŸŸ" class="headerlink" title="Bean çš„ä½œç”¨åŸŸ"></a>Bean çš„ä½œç”¨åŸŸ</h3><ol><li><strong>singleton</strong>ï¼šå”¯ä¸€çš„ Bean å®ä¾‹ï¼ŒSpring ä¸­çš„ Bean é»˜è®¤éƒ½æ˜¯å•ä¾‹çš„ã€‚</li><li><strong>prototype</strong>ï¼šæ¯æ¬¡è¯·æ±‚éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ Bean å®ä¾‹ã€‚</li><li><strong>request</strong>ï¼šæ¯ä¸€æ¬¡ HTTP è¯·æ±‚éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„ Beanï¼Œè¯¥ Bean ä»…åœ¨å½“å‰ HTTP request å†…æœ‰æ•ˆã€‚</li><li><strong>session</strong>ï¼šæ¯ä¸€æ¬¡ HTTP è¯·æ±‚éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„ Beanï¼Œè¯¥ Bean ä»…åœ¨å½“å‰ HTTP session å†…æœ‰æ•ˆã€‚</li><li><strong>global-session</strong>ï¼šå…¨å±€ session ä½œç”¨åŸŸï¼Œä»…ä»…åœ¨åŸºäº portlet çš„ web åº”ç”¨ä¸­æ‰æœ‰æ„ä¹‰ï¼ŒSpring 5 å·²ç»æ²¡æœ‰äº†ã€‚Portlet æ˜¯èƒ½å¤Ÿç”Ÿæˆè¯­ä¹‰ä»£ç ï¼ˆä¾‹å¦‚ï¼šHTMLï¼‰ç‰‡æ®µçš„å°å‹ Java Web æ’ä»¶ã€‚å®ƒä»¬åŸºäº portlet å®¹å™¨ï¼Œå¯ä»¥åƒ servlet ä¸€æ ·å¤„ç† HTTP è¯·æ±‚ã€‚ä½†æ˜¯ï¼Œä¸ servlet ä¸åŒï¼Œæ¯ä¸ª portlet éƒ½æœ‰ä¸åŒçš„ä¼šè¯ã€‚</li></ol><hr><h3 id="Spring-ä¸­çš„å•ä¾‹-Bean-çš„çº¿ç¨‹å®‰å…¨é—®é¢˜"><a href="#Spring-ä¸­çš„å•ä¾‹-Bean-çš„çº¿ç¨‹å®‰å…¨é—®é¢˜" class="headerlink" title="Spring ä¸­çš„å•ä¾‹ Bean çš„çº¿ç¨‹å®‰å…¨é—®é¢˜"></a>Spring ä¸­çš„å•ä¾‹ Bean çš„çº¿ç¨‹å®‰å…¨é—®é¢˜</h3><p>å¤§å¤šæ•°æ—¶å€™æˆ‘ä»¬å¹¶æ²¡æœ‰åœ¨ç³»ç»Ÿä¸­ä½¿ç”¨å¤šçº¿ç¨‹ï¼Œæ‰€ä»¥å¾ˆå°‘æœ‰äººä¼šå…³æ³¨è¿™ä¸ªé—®é¢˜ã€‚å•ä¾‹ Bean å­˜åœ¨çº¿ç¨‹é—®é¢˜ï¼Œä¸»è¦æ˜¯å› ä¸ºï¼šå½“å¤šä¸ªçº¿ç¨‹æ“ä½œåŒä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œå¯¹è¿™ä¸ªå¯¹è±¡çš„éé™æ€æˆå‘˜å˜é‡çš„å†™æ“ä½œä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚å¸¸è§çš„æœ‰ä¸¤ç§è§£å†³åŠæ³•ï¼š</p><ol><li>åœ¨ Bean å¯¹è±¡ä¸­å°½é‡é¿å…å®šä¹‰å¯å˜çš„æˆå‘˜å˜é‡ï¼ˆä¸å¤ªç°å®ï¼‰ã€‚</li><li>åœ¨ç±»ä¸­å®šä¹‰ä¸€ä¸ª <code>ThreadLocal</code> æˆå‘˜å˜é‡ï¼Œå°†éœ€è¦çš„å¯å˜æˆå‘˜å˜é‡ä¿å­˜åœ¨ <code>ThreadLocal</code> ä¸­ï¼ˆæ¨èçš„ä¸€ç§æ–¹å¼ï¼‰ã€‚</li></ol><hr><h3 id="å¯¹-Spring-ä¸­çš„äº‹åŠ¡çš„ç†è§£"><a href="#å¯¹-Spring-ä¸­çš„äº‹åŠ¡çš„ç†è§£" class="headerlink" title="å¯¹ Spring ä¸­çš„äº‹åŠ¡çš„ç†è§£"></a>å¯¹ Spring ä¸­çš„äº‹åŠ¡çš„ç†è§£</h3><p>äº‹åŠ¡æ˜¯é€»è¾‘ä¸Šçš„ä¸€ç»„æ“ä½œï¼Œè¦ä¹ˆéƒ½æ‰§è¡Œï¼Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œã€‚</p><p><strong>äº‹åŠ¡ç‰¹æ€§</strong></p><ul><li><strong>åŸå­æ€§</strong>ï¼šäº‹åŠ¡æ˜¯æœ€å°çš„æ‰§è¡Œå•ä½ï¼Œä¸å…è®¸åˆ†å‰²ã€‚äº‹åŠ¡çš„åŸå­æ€§ç¡®ä¿åŠ¨ä½œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå®Œå…¨ä¸èµ·ä½œç”¨ã€‚</li><li><strong>ä¸€è‡´æ€§</strong>ï¼šæ‰§è¡Œäº‹åŠ¡å‰åï¼Œæ•°æ®ä¿æŒä¸€è‡´ã€‚</li><li><strong>éš”ç¦»æ€§</strong>ï¼šå¹¶å‘è®¿é—®æ•°æ®åº“æ—¶ï¼Œä¸€ä¸ªç”¨æˆ·çš„äº‹ç‰©ä¸è¢«å…¶ä»–äº‹ç‰©æ‰€å¹²æ‰°ï¼Œå„å¹¶å‘äº‹åŠ¡ä¹‹é—´æ•°æ®åº“æ˜¯ç‹¬ç«‹çš„ã€‚</li><li><strong>æŒä¹…æ€§</strong>ï¼šä¸€ä¸ªäº‹åŠ¡è¢«æäº¤ä¹‹åã€‚å®ƒå¯¹æ•°æ®åº“ä¸­æ•°æ®çš„æ”¹å˜æ˜¯æŒä¹…çš„ï¼Œå³ä½¿æ•°æ®åº“å‘ç”Ÿæ•…éšœä¹Ÿä¸åº”è¯¥å¯¹å…¶æœ‰ä»»ä½•å½±å“ã€‚</li></ul><p><strong>Spring äº‹åŠ¡ç®¡ç†æ¥å£</strong></p><ol><li><code>PlatformTransactionManager</code>ï¼šï¼ˆå¹³å°ï¼‰äº‹åŠ¡ç®¡ç†å™¨ã€‚</li><li><code>TransactionDefinition</code>ï¼šäº‹åŠ¡å®šä¹‰ä¿¡æ¯ï¼ˆäº‹åŠ¡éš”ç¦»çº§åˆ«ã€ä¼ æ’­è¡Œä¸ºã€è¶…æ—¶ã€åªè¯»ã€å›æ»šè§„åˆ™ï¼‰ã€‚</li><li><code>TransactionStatus</code>ï¼šäº‹åŠ¡è¿è¡ŒçŠ¶æ€ã€‚</li></ol><p>æ‰€è°“äº‹åŠ¡ç®¡ç†ï¼Œå…¶å®å°±æ˜¯â€œæŒ‰ç…§ç»™å®šçš„äº‹åŠ¡è§„åˆ™æ¥æ‰§è¡Œæäº¤æˆ–è€…å›æ»šæ“ä½œâ€ã€‚</p><hr><h3 id="Spring-ä¸­çš„äº‹åŠ¡éš”ç¦»çº§åˆ«"><a href="#Spring-ä¸­çš„äº‹åŠ¡éš”ç¦»çº§åˆ«" class="headerlink" title="Spring ä¸­çš„äº‹åŠ¡éš”ç¦»çº§åˆ«"></a>Spring ä¸­çš„äº‹åŠ¡éš”ç¦»çº§åˆ«</h3><p><code>TransactionDefinition</code> æ¥å£ä¸­å®šä¹‰äº†äº”ä¸ªè¡¨ç¤ºéš”ç¦»çº§åˆ«çš„å¸¸é‡ï¼š</p><ul><li><strong>TransactionDefinition.ISOLATION_DEFAULT</strong>ï¼šä½¿ç”¨åç«¯æ•°æ®åº“é»˜è®¤çš„éš”ç¦»çº§åˆ«ã€‚MySQL é»˜è®¤é‡‡ç”¨ <code>REPEATABLE_READ</code> éš”ç¦»çº§åˆ«ï¼ŒOracle é»˜è®¤é‡‡ç”¨ <code>READ_COMMITTED</code> éš”ç¦»çº§åˆ«ã€‚</li><li><strong>TransactionDefinition.ISOLATION_READ_UNCOMMITTED</strong>ï¼šæœ€ä½çš„éš”ç¦»çº§åˆ«ï¼Œå…è®¸è¯»å–å°šæœªæäº¤çš„æ•°æ®å˜æ›´ï¼Œå¯èƒ½ä¼šå¯¼è‡´è„è¯»ã€å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»ã€‚</li><li><strong>TransactionDefinition.ISOLATION_READ_COMMITTED</strong>ï¼šå…è®¸è¯»å–å¹¶å‘äº‹åŠ¡å·²ç»æäº¤çš„æ•°æ®ï¼Œå¯ä»¥é˜»æ­¢è„è¯»ï¼Œä½†æ˜¯å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»ä»æœ‰å¯èƒ½å‘ç”Ÿã€‚</li><li><strong>TransactionDefinition.ISOLATION_REPEATABLE_READ</strong>ï¼šå¯¹åŒä¸€å­—æ®µçš„å¤šæ¬¡è¯»å–ç»“æœéƒ½æ˜¯ä¸€è‡´çš„ï¼Œé™¤éæ•°æ®æ˜¯è¢«æœ¬èº«äº‹åŠ¡è‡ªå·±æ‰€ä¿®æ”¹ï¼Œå¯ä»¥é˜»æ­¢è„è¯»å’Œä¸å¯é‡å¤è¯»ï¼Œä½†å¹»è¯»ä»æœ‰å¯èƒ½å‘ç”Ÿã€‚</li><li><strong>TransactionDefinition.ISOLATION_SERIALIZABLE</strong>ï¼šæœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œå®Œå…¨æœä» ACID çš„éš”ç¦»çº§åˆ«ã€‚æ‰€æœ‰çš„äº‹åŠ¡ä¾æ¬¡é€ä¸ªæ‰§è¡Œï¼Œè¿™æ ·äº‹åŠ¡ä¹‹é—´å°±å®Œå…¨ä¸å¯èƒ½äº§ç”Ÿå¹²æ‰°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥çº§åˆ«å¯ä»¥é˜²æ­¢è„è¯»ã€ä¸å¯é‡å¤è¯»ä»¥åŠå¹»è¯»ã€‚ä½†æ˜¯è¿™å°†ä¸¥é‡å½±å“ç¨‹åºçš„æ€§èƒ½ã€‚é€šå¸¸æƒ…å†µä¸‹ä¹Ÿä¸ä¼šç”¨åˆ°è¯¥çº§åˆ«ã€‚</li></ul><hr><h3 id="Spring-ä¸­çš„äº‹ç‰©ä¼ æ’­è¡Œä¸º"><a href="#Spring-ä¸­çš„äº‹ç‰©ä¼ æ’­è¡Œä¸º" class="headerlink" title="Spring ä¸­çš„äº‹ç‰©ä¼ æ’­è¡Œä¸º"></a>Spring ä¸­çš„äº‹ç‰©ä¼ æ’­è¡Œä¸º</h3><p>äº‹åŠ¡ä¼ æ’­è¡Œä¸ºæ˜¯ä¸ºäº†è§£å†³ä¸šåŠ¡å±‚æ–¹æ³•ä¹‹é—´äº’ç›¸è°ƒç”¨çš„äº‹åŠ¡é—®é¢˜ã€‚å½“äº‹åŠ¡æ–¹æ³•è¢«å¦ä¸€ä¸ªäº‹åŠ¡æ–¹æ³•è°ƒç”¨æ—¶ï¼Œå¿…é¡»æŒ‡å®šäº‹åŠ¡åº”è¯¥å¦‚ä½•ä¼ æ’­ã€‚ä¾‹å¦‚ï¼šæ–¹æ³•å¯èƒ½ç»§ç»­åœ¨ç°æœ‰äº‹åŠ¡ä¸­è¿è¡Œï¼Œä¹Ÿå¯èƒ½å¼€å¯ä¸€ä¸ªæ–°äº‹åŠ¡ï¼Œå¹¶åœ¨è‡ªå·±çš„äº‹åŠ¡ä¸­è¿è¡Œã€‚åœ¨ <code>TransactionDefinition</code> å®šä¹‰ä¸­åŒ…æ‹¬äº†å¦‚ä¸‹å‡ ä¸ªè¡¨ç¤ºä¼ æ’­è¡Œä¸ºçš„å¸¸é‡ï¼š</p><p><strong>æ”¯æŒå½“å‰äº‹åŠ¡çš„æƒ…å†µï¼š</strong></p><ul><li><strong>TransactionDefinition.PROPAGATION_REQUIRED</strong>ï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡ã€‚</li><li><strong>TransactionDefinition.PROPAGATION_SUPPORTS</strong>ï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™ä»¥éäº‹åŠ¡çš„æ–¹å¼ç»§ç»­è¿è¡Œã€‚</li><li><strong>TransactionDefinition.PROPAGATION_MANDATORY</strong>ï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</li></ul><p><strong>ä¸æ”¯æŒå½“å‰äº‹åŠ¡çš„æƒ…å†µï¼š</strong></p><ul><li><strong>TransactionDefinition.PROPAGATION_REQUIRES_NEW</strong>ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚</li><li><strong>TransactionDefinition.PROPAGATION_NOT_SUPPORTED</strong>ï¼šä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚</li><li><strong>TransactionDefinition.PROPAGATION_NEVER</strong>ï¼šä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</li></ul><p><strong>å…¶ä»–æƒ…å†µï¼š</strong></p><ul><li><strong>TransactionDefinition.PROPAGATION_NESTED</strong>ï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªäº‹åŠ¡ä½œä¸ºå½“å‰äº‹åŠ¡çš„åµŒå¥—äº‹åŠ¡æ¥è¿è¡Œï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™è¯¥å–å€¼ç­‰ä»·äº <code>TransactionDefinition.PROPAGATION_REQUIRED</code>ã€‚</li></ul><hr><h3 id="Spring-å¸¸ç”¨æ³¨å…¥æ–¹å¼"><a href="#Spring-å¸¸ç”¨æ³¨å…¥æ–¹å¼" class="headerlink" title="Spring å¸¸ç”¨æ³¨å…¥æ–¹å¼"></a>Spring å¸¸ç”¨æ³¨å…¥æ–¹å¼</h3><ol><li><strong>æ„é€ å™¨ä¾èµ–æ³¨å…¥</strong>ï¼šæ„é€ å™¨ä¾èµ–æ³¨å…¥é€šè¿‡å®¹å™¨è§¦å‘ä¸€ä¸ªç±»çš„æ„é€ å™¨æ¥å®ç°çš„ï¼Œè¯¥ç±»æœ‰ä¸€ç³»åˆ—å‚æ•°ï¼Œæ¯ä¸ªå‚æ•°ä»£è¡¨ä¸€ä¸ªå¯¹å…¶ä»–ç±»çš„ä¾èµ–ã€‚</li><li><strong>Setter æ–¹æ³•æ³¨å…¥</strong>ï¼šSetter æ–¹æ³•æ³¨å…¥æ˜¯å®¹å™¨é€šè¿‡è°ƒç”¨æ— å‚æ„é€ å™¨æˆ–æ— å‚ static å·¥å‚æ–¹æ³•å®ä¾‹åŒ– bean ä¹‹åï¼Œè°ƒç”¨è¯¥ bean çš„ Setter æ–¹æ³•ï¼Œå³å®ç°äº†åŸºäº Setter çš„ä¾èµ–æ³¨å…¥ã€‚</li><li><strong>åŸºäºæ³¨è§£çš„æ³¨å…¥</strong>ï¼šæœ€å¥½çš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨æ„é€ å™¨å‚æ•°å®ç°å¼ºåˆ¶ä¾èµ–ï¼ŒSetter æ–¹æ³•å®ç°å¯é€‰ä¾èµ–ã€‚</li></ol><hr><h3 id="Spring-æ¡†æ¶ä¸­ç”¨åˆ°äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ"><a href="#Spring-æ¡†æ¶ä¸­ç”¨åˆ°äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ" class="headerlink" title="Spring æ¡†æ¶ä¸­ç”¨åˆ°äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ"></a>Spring æ¡†æ¶ä¸­ç”¨åˆ°äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ</h3><ol><li><strong>å·¥å‚è®¾è®¡æ¨¡å¼</strong>ï¼šSpring ä½¿ç”¨å·¥å‚æ¨¡å¼é€šè¿‡ <code>BeanFactory</code>ã€<code>ApplicationContext</code> åˆ›å»º bean å¯¹è±¡ã€‚</li><li><strong>ä»£ç†è®¾è®¡æ¨¡å¼</strong>ï¼šSpring AOP åŠŸèƒ½çš„å®ç°ã€‚</li><li><strong>å•ä¾‹è®¾è®¡æ¨¡å¼</strong>ï¼šSpring ä¸­çš„ Bean é»˜è®¤éƒ½æ˜¯å•ä¾‹çš„ã€‚</li><li><strong>æ¨¡æ¿æ–¹æ³•æ¨¡å¼</strong>ï¼šSpring ä¸­ <code>jdbcTemplate</code>ã€<code>hibernateTemplate</code> ç­‰ä»¥ <code>Template</code> ç»“å°¾çš„å¯¹æ•°æ®åº“æ“ä½œçš„ç±»ï¼Œå®ƒä»¬å°±ä½¿ç”¨åˆ°äº†æ¨¡æ¿æ¨¡å¼ã€‚</li><li><strong>åŒ…è£…å™¨è®¾è®¡æ¨¡å¼</strong>ï¼šæˆ‘ä»¬çš„é¡¹ç›®éœ€è¦è¿æ¥å¤šä¸ªæ•°æ®åº“ï¼Œè€Œä¸”ä¸åŒçš„å®¢æˆ·åœ¨æ¯æ¬¡è®¿é—®ä¸­æ ¹æ®éœ€è¦ä¼šå»è®¿é—®ä¸åŒçš„æ•°æ®åº“ã€‚è¿™ç§æ¨¡å¼è®©æˆ‘ä»¬æ ¹æ®å®¢æˆ·çš„éœ€æ±‚èƒ½å¤ŸåŠ¨æ€åˆ‡æ¢ä¸åŒçš„æ•°æ®æºã€‚</li><li><strong>è§‚å¯Ÿè€…æ¨¡å¼</strong>ï¼šSpring äº‹ä»¶é©±åŠ¨æ¨¡å‹å°±æ˜¯è§‚å¯Ÿè€…æ¨¡å¼å¾ˆç»å…¸çš„ä¸€ä¸ªåº”ç”¨ã€‚</li><li><strong>é€‚é…å™¨æ¨¡å¼</strong>ï¼šSpring AOP çš„å¢å¼ºæˆ–é€šçŸ¥ï¼ˆAdviceï¼‰ä½¿ç”¨åˆ°äº†é€‚é…å™¨æ¨¡å¼ã€Spring MVC ä¸­ä¹Ÿæ˜¯ç”¨åˆ°äº†é€‚é…å™¨æ¨¡å¼é€‚é… Controllerã€‚</li></ol><hr><h3 id="ApplicationContext-é€šå¸¸çš„å®ç°æœ‰å“ªäº›ï¼Ÿ"><a href="#ApplicationContext-é€šå¸¸çš„å®ç°æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="ApplicationContext é€šå¸¸çš„å®ç°æœ‰å“ªäº›ï¼Ÿ"></a>ApplicationContext é€šå¸¸çš„å®ç°æœ‰å“ªäº›ï¼Ÿ</h3><ol><li><strong>FileSystemXmlApplicationContext</strong>ï¼šæ­¤å®¹å™¨ä»ä¸€ä¸ª XML æ–‡ä»¶ä¸­åŠ è½½ beans çš„å®šä¹‰ï¼ŒXML Bean é…ç½®æ–‡ä»¶&#96;çš„å…¨è·¯å¾„åå¿…é¡»æä¾›ç»™å®ƒçš„æ„é€ å‡½æ•°ã€‚</li><li><strong>ClassPathXmlApplicationContext</strong>ï¼šæ­¤å®¹å™¨ä¹Ÿä»ä¸€ä¸ª XML æ–‡ä»¶ä¸­åŠ è½½ beans çš„å®šä¹‰ï¼Œè¿™é‡Œï¼Œä½ éœ€è¦æ­£ç¡®è®¾ç½® classpath å› ä¸ºè¿™ä¸ªå®¹å™¨å°†åœ¨ classpath é‡Œæ‰¾ bean é…ç½®ã€‚</li><li><strong>WebXmlApplicationContext</strong>ï¼šæ­¤å®¹å™¨åŠ è½½ä¸€ä¸ª XML æ–‡ä»¶ï¼Œæ­¤æ–‡ä»¶å®šä¹‰äº†ä¸€ä¸ª Web åº”ç”¨çš„æ‰€æœ‰ beanã€‚</li></ol><h4 id="AOPåŸç†æ·±å…¥åˆ†æ"><a href="#AOPåŸç†æ·±å…¥åˆ†æ" class="headerlink" title="AOPåŸç†æ·±å…¥åˆ†æ"></a>AOPåŸç†æ·±å…¥åˆ†æ</h4><p><strong>AOPå®ç°æœºåˆ¶ï¼š</strong> Spring AOPåŸºäºä»£ç†æ¨¡å¼å®ç°ï¼Œæ”¯æŒä¸¤ç§ä»£ç†æ–¹å¼ï¼š</p><ol><li><strong>JDKåŠ¨æ€ä»£ç†</strong>: é’ˆå¯¹å®ç°äº†æ¥å£çš„ç±»</li><li><strong>CGLIBä»£ç†</strong>: é’ˆå¯¹æ²¡æœ‰å®ç°æ¥å£çš„ç±»</li></ol><p>æˆ‘ä»¬æ¥ç³»ç»Ÿæ€§åœ°è®²è§£ä¸€ä¸‹ <strong>Spring AOP çš„å®ç°æœºåˆ¶</strong>ï¼ŒåŒ…æ‹¬ï¼š</p><ol><li>JDK åŠ¨æ€ä»£ç†</li><li>CGLIB åŠ¨æ€ä»£ç†</li><li>é™æ€ä»£ç†ï¼ˆå¯¹æ¯”è¯´æ˜ï¼‰</li></ol><hr><h2 id="ğŸŒŸ-ä¸€ã€Spring-AOP-å®ç°æœºåˆ¶æ¦‚è¿°"><a href="#ğŸŒŸ-ä¸€ã€Spring-AOP-å®ç°æœºåˆ¶æ¦‚è¿°" class="headerlink" title="ğŸŒŸ ä¸€ã€Spring AOP å®ç°æœºåˆ¶æ¦‚è¿°"></a>ğŸŒŸ ä¸€ã€Spring AOP å®ç°æœºåˆ¶æ¦‚è¿°</h2><p>Spring AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰æ˜¯åŸºäº <strong>ä»£ç†æ¨¡å¼</strong> å®ç°çš„ï¼Œå®ƒé€šè¿‡åœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œå‰åç»‡å…¥é€»è¾‘ï¼ˆå¢å¼ºï¼‰ï¼Œå®ç°æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼ˆå¦‚æ—¥å¿—ã€å®‰å…¨ã€äº‹åŠ¡ç­‰ï¼‰çš„åˆ†ç¦»ã€‚</p><blockquote><p>Spring AOP ä»…æ”¯æŒæ–¹æ³•çº§åˆ«çš„ä»£ç†ï¼ˆå³å¯¹æ–¹æ³•è¿›è¡Œå¢å¼ºï¼‰ï¼Œä¸æ”¯æŒå­—æ®µã€æ„é€ å™¨ç­‰åº•å±‚å­—èŠ‚ç å¢å¼ºï¼ˆè¿™è¦ç”¨ AspectJï¼‰ã€‚</p></blockquote><hr><h2 id="ğŸ§©-äºŒã€Spring-AOP-çš„ä¸¤ç§åŠ¨æ€ä»£ç†æ–¹å¼"><a href="#ğŸ§©-äºŒã€Spring-AOP-çš„ä¸¤ç§åŠ¨æ€ä»£ç†æ–¹å¼" class="headerlink" title="ğŸ§© äºŒã€Spring AOP çš„ä¸¤ç§åŠ¨æ€ä»£ç†æ–¹å¼"></a>ğŸ§© äºŒã€Spring AOP çš„ä¸¤ç§åŠ¨æ€ä»£ç†æ–¹å¼</h2><h3 id="1ï¸âƒ£-JDK-åŠ¨æ€ä»£ç†ï¼ˆåŸºäºæ¥å£ï¼‰"><a href="#1ï¸âƒ£-JDK-åŠ¨æ€ä»£ç†ï¼ˆåŸºäºæ¥å£ï¼‰" class="headerlink" title="1ï¸âƒ£ JDK åŠ¨æ€ä»£ç†ï¼ˆåŸºäºæ¥å£ï¼‰"></a>1ï¸âƒ£ JDK åŠ¨æ€ä»£ç†ï¼ˆåŸºäºæ¥å£ï¼‰</h3><h4 id="âœ…-åŸç†ï¼š"><a href="#âœ…-åŸç†ï¼š" class="headerlink" title="âœ… åŸç†ï¼š"></a>âœ… åŸç†ï¼š</h4><ul><li>åŸºäº Java çš„ <code>java.lang.reflect.Proxy</code> ç±»å®ç°ã€‚</li><li>å¿…é¡»è¦æœ‰æ¥å£ï¼ŒSpring ä¼šä¸ºæ¥å£ç”Ÿæˆä»£ç†ç±»ã€‚</li><li>ä»£ç†ç±»åœ¨è¿è¡Œæ—¶å®ç°æ¥å£ï¼Œå¹¶å°†è°ƒç”¨å§”æ‰˜ç»™ InvocationHandlerã€‚</li></ul><h4 id="ğŸ“¦-ç¤ºä¾‹ï¼š"><a href="#ğŸ“¦-ç¤ºä¾‹ï¼š" class="headerlink" title="ğŸ“¦ ç¤ºä¾‹ï¼š"></a>ğŸ“¦ ç¤ºä¾‹ï¼š</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">addUser</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addUser</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ·»åŠ ç”¨æˆ·&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Spring AOP ä¸º <code>UserService</code> åˆ›å»ºä»£ç†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">UserService</span> <span class="variable">proxy</span> <span class="operator">=</span> (UserService) Proxy.newProxyInstance(</span><br><span class="line">    userService.getClass().getClassLoader(),</span><br><span class="line">    userService.getClass().getInterfaces(),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">InvocationHandler</span>() &#123;</span><br><span class="line">        <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;å‰ç½®å¢å¼º&quot;</span>);</span><br><span class="line">            <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> method.invoke(userService, args);</span><br><span class="line">            System.out.println(<span class="string">&quot;åç½®å¢å¼º&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure><h4 id="ğŸ¯-ç‰¹ç‚¹ï¼š"><a href="#ğŸ¯-ç‰¹ç‚¹ï¼š" class="headerlink" title="ğŸ¯ ç‰¹ç‚¹ï¼š"></a>ğŸ¯ ç‰¹ç‚¹ï¼š</h4><table><thead><tr><th>ç‰¹æ€§</th><th>æè¿°</th></tr></thead><tbody><tr><td>æ˜¯å¦ä¾èµ–æ¥å£</td><td>âœ… æ˜¯</td></tr><tr><td>æ€§èƒ½</td><td>è¾ƒé«˜ï¼ˆæ¯” CGLIB ç•¥å¿«ï¼‰</td></tr><tr><td>ç”Ÿæˆçš„ä»£ç†ç±»</td><td>å®ç°æ¥å£</td></tr></tbody></table><hr><h3 id="2ï¸âƒ£-CGLIB-åŠ¨æ€ä»£ç†ï¼ˆåŸºäºå­ç±»ï¼‰"><a href="#2ï¸âƒ£-CGLIB-åŠ¨æ€ä»£ç†ï¼ˆåŸºäºå­ç±»ï¼‰" class="headerlink" title="2ï¸âƒ£ CGLIB åŠ¨æ€ä»£ç†ï¼ˆåŸºäºå­ç±»ï¼‰"></a>2ï¸âƒ£ CGLIB åŠ¨æ€ä»£ç†ï¼ˆåŸºäºå­ç±»ï¼‰</h3><h4 id="âœ…-åŸç†ï¼š-1"><a href="#âœ…-åŸç†ï¼š-1" class="headerlink" title="âœ… åŸç†ï¼š"></a>âœ… åŸç†ï¼š</h4><ul><li>ä½¿ç”¨ CGLIB åº“åœ¨è¿è¡Œæ—¶ <strong>ç”Ÿæˆç›®æ ‡ç±»çš„å­ç±»</strong>ï¼Œå¹¶é‡å†™å…¶æ–¹æ³•æ¥å®ç°å¢å¼ºã€‚</li><li>é€‚ç”¨äº <strong>æ²¡æœ‰æ¥å£</strong> çš„ç±»ï¼Œæˆ–è€…æƒ³å¯¹ç±»æœ¬èº«å¢å¼ºè€Œéæ¥å£ã€‚</li></ul><h4 id="ğŸ§ª-ç¤ºä¾‹ï¼š"><a href="#ğŸ§ª-ç¤ºä¾‹ï¼š" class="headerlink" title="ğŸ§ª ç¤ºä¾‹ï¼š"></a>ğŸ§ª ç¤ºä¾‹ï¼š</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addUser</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ·»åŠ ç”¨æˆ·&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Spring é€šè¿‡ CGLIB ç”Ÿæˆå­ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Enhancer</span> <span class="variable">enhancer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Enhancer</span>();</span><br><span class="line">enhancer.setSuperclass(UserService.class);</span><br><span class="line">enhancer.setCallback(<span class="keyword">new</span> <span class="title class_">MethodInterceptor</span>() &#123;</span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">intercept</span><span class="params">(Object obj, Method method, Object[] args, MethodProxy proxy)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å‰ç½®å¢å¼º&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> proxy.invokeSuper(obj, args);</span><br><span class="line">        System.out.println(<span class="string">&quot;åç½®å¢å¼º&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="type">UserService</span> <span class="variable">proxy</span> <span class="operator">=</span> (UserService) enhancer.create();</span><br></pre></td></tr></table></figure><h4 id="ğŸ¯-ç‰¹ç‚¹ï¼š-1"><a href="#ğŸ¯-ç‰¹ç‚¹ï¼š-1" class="headerlink" title="ğŸ¯ ç‰¹ç‚¹ï¼š"></a>ğŸ¯ ç‰¹ç‚¹ï¼š</h4><table><thead><tr><th>ç‰¹æ€§</th><th>æè¿°</th></tr></thead><tbody><tr><td>æ˜¯å¦ä¾èµ–æ¥å£</td><td>âŒ å¦</td></tr><tr><td>æ˜¯å¦å¯ä»£ç† final ç±»&#x2F;æ–¹æ³•</td><td>âŒ å¦ï¼ˆfinal æ— æ³•è¢«ç»§æ‰¿&#x2F;é‡å†™ï¼‰</td></tr><tr><td>ç”Ÿæˆçš„ä»£ç†ç±»</td><td>å­ç±»</td></tr></tbody></table><hr><h2 id="ğŸ—-ä¸‰ã€é™æ€ä»£ç†ï¼ˆå¯¹æ¯”åŠ¨æ€ä»£ç†ï¼‰"><a href="#ğŸ—-ä¸‰ã€é™æ€ä»£ç†ï¼ˆå¯¹æ¯”åŠ¨æ€ä»£ç†ï¼‰" class="headerlink" title="ğŸ— ä¸‰ã€é™æ€ä»£ç†ï¼ˆå¯¹æ¯”åŠ¨æ€ä»£ç†ï¼‰"></a>ğŸ— ä¸‰ã€é™æ€ä»£ç†ï¼ˆå¯¹æ¯”åŠ¨æ€ä»£ç†ï¼‰</h2><h3 id="âœ…-åŸç†ï¼š-2"><a href="#âœ…-åŸç†ï¼š-2" class="headerlink" title="âœ… åŸç†ï¼š"></a>âœ… åŸç†ï¼š</h3><ul><li>è‡ªå·±å†™ä¸€ä¸ªä»£ç†ç±»ï¼Œ<strong>å®ç°ç›¸åŒæ¥å£</strong>ï¼Œå°†æ–¹æ³•è°ƒç”¨å§”æ‰˜ç»™ç›®æ ‡å¯¹è±¡ï¼Œå¹¶åœ¨è°ƒç”¨å‰åæ‰‹åŠ¨æ·»åŠ å¢å¼ºé€»è¾‘ã€‚</li></ul><h4 id="ğŸ§ª-ç¤ºä¾‹ï¼š-1"><a href="#ğŸ§ª-ç¤ºä¾‹ï¼š-1" class="headerlink" title="ğŸ§ª ç¤ºä¾‹ï¼š"></a>ğŸ§ª ç¤ºä¾‹ï¼š</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">addUser</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addUser</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ·»åŠ ç”¨æˆ·&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é™æ€ä»£ç†ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceProxy</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> UserService target;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserServiceProxy</span><span class="params">(UserService target)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.target = target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addUser</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å‰ç½®å¢å¼º&quot;</span>);</span><br><span class="line">        target.addUser();</span><br><span class="line">        System.out.println(<span class="string">&quot;åç½®å¢å¼º&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ğŸ¯-ç‰¹ç‚¹ï¼š-2"><a href="#ğŸ¯-ç‰¹ç‚¹ï¼š-2" class="headerlink" title="ğŸ¯ ç‰¹ç‚¹ï¼š"></a>ğŸ¯ ç‰¹ç‚¹ï¼š</h4><table><thead><tr><th>ç‰¹æ€§</th><th>æè¿°</th></tr></thead><tbody><tr><td>æ˜¯å¦è‡ªåŠ¨ç”Ÿæˆ</td><td>âŒ éœ€æ‰‹åŠ¨ç¼–ç </td></tr><tr><td>çµæ´»æ€§</td><td>å·®ï¼ˆæ¯ä¸ªç±»éƒ½è¦å†™ä¸€ä¸ªä»£ç†ç±»ï¼‰</td></tr><tr><td>æ˜¯å¦æ”¯æŒ AOP</td><td>âŒ æ— æ³•åŠ¨æ€ç»‡å…¥å¤šä¸ªåˆ‡é¢</td></tr></tbody></table><hr><h2 id="ğŸ”š-å››ã€ä¸‰è€…å¯¹æ¯”æ€»ç»“"><a href="#ğŸ”š-å››ã€ä¸‰è€…å¯¹æ¯”æ€»ç»“" class="headerlink" title="ğŸ”š å››ã€ä¸‰è€…å¯¹æ¯”æ€»ç»“"></a>ğŸ”š å››ã€ä¸‰è€…å¯¹æ¯”æ€»ç»“</h2><table><thead><tr><th>ç‰¹æ€§</th><th>é™æ€ä»£ç†</th><th>JDK åŠ¨æ€ä»£ç†</th><th>CGLIB åŠ¨æ€ä»£ç†</th></tr></thead><tbody><tr><td>æ˜¯å¦ä¾èµ–æ¥å£</td><td>âœ… æ˜¯</td><td>âœ… æ˜¯</td><td>âŒ å¦</td></tr><tr><td>æ˜¯å¦è‡ªåŠ¨ç”Ÿæˆä»£ç†ç±»</td><td>âŒ æ‰‹åŠ¨ç¼–å†™</td><td>âœ… è¿è¡Œæ—¶ç”Ÿæˆ</td><td>âœ… è¿è¡Œæ—¶ç”Ÿæˆ</td></tr><tr><td>æ˜¯å¦å¯ä»£ç†ç±»</td><td>âŒ å¦ï¼ˆæ¥å£ä¸ºä¸»ï¼‰</td><td>âŒ å¦ï¼ˆæ¥å£ä¸ºä¸»ï¼‰</td><td>âœ… æ˜¯ï¼ˆç±»çš„å­ç±»ï¼‰</td></tr><tr><td>æ€§èƒ½</td><td>ä¸€èˆ¬</td><td>è¾ƒé«˜</td><td>ç•¥æ…¢ï¼ˆä½†å¯æ¥å—ï¼‰</td></tr><tr><td>æ˜¯å¦æ”¯æŒ final æ–¹æ³•</td><td>âœ…</td><td>âœ…</td><td>âŒ å¦</td></tr></tbody></table><hr><h2 id="âœ…-Spring-å¦‚ä½•é€‰æ‹©ä»£ç†æ–¹å¼ï¼Ÿ"><a href="#âœ…-Spring-å¦‚ä½•é€‰æ‹©ä»£ç†æ–¹å¼ï¼Ÿ" class="headerlink" title="âœ… Spring å¦‚ä½•é€‰æ‹©ä»£ç†æ–¹å¼ï¼Ÿ"></a>âœ… Spring å¦‚ä½•é€‰æ‹©ä»£ç†æ–¹å¼ï¼Ÿ</h2><ul><li>é»˜è®¤ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†ï¼ˆå¦‚æœç›®æ ‡ç±»å®ç°äº†æ¥å£ï¼‰ã€‚</li><li>å¦‚æœç›®æ ‡ç±»æ²¡æœ‰æ¥å£ï¼ŒSpring è‡ªåŠ¨åˆ‡æ¢ä¸º CGLIBã€‚</li><li>å¯ä»¥å¼ºåˆ¶ä½¿ç”¨ CGLIBï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableAspectJAutoProxy(proxyTargetClass = true)</span></span><br></pre></td></tr></table></figure><h5 id="AOPæ ¸å¿ƒæ¦‚å¿µï¼š"><a href="#AOPæ ¸å¿ƒæ¦‚å¿µï¼š" class="headerlink" title="AOPæ ¸å¿ƒæ¦‚å¿µï¼š"></a><strong>AOPæ ¸å¿ƒæ¦‚å¿µï¼š</strong></h5><ul><li><strong>åˆ‡é¢ï¼ˆAspectï¼‰</strong>: æ¨ªåˆ‡å…³æ³¨ç‚¹çš„æ¨¡å—åŒ–</li><li><strong>è¿æ¥ç‚¹ï¼ˆJoinpointï¼‰</strong>: ç¨‹åºæ‰§è¡Œä¸­çš„ç‰¹å®šç‚¹</li><li><strong>åˆ‡ç‚¹ï¼ˆPointcutï¼‰</strong>: è¿æ¥ç‚¹çš„é›†åˆ</li><li><strong>é€šçŸ¥ï¼ˆAdviceï¼‰</strong>: åˆ‡é¢åœ¨ç‰¹å®šè¿æ¥ç‚¹æ‰§è¡Œçš„ä»£ç </li><li><strong>ç›®æ ‡å¯¹è±¡ï¼ˆTargetï¼‰</strong>: è¢«ä»£ç†çš„å¯¹è±¡</li><li><strong>ä»£ç†å¯¹è±¡ï¼ˆProxyï¼‰</strong>: AOPæ¡†æ¶åˆ›å»ºçš„å¯¹è±¡</li></ul><h5 id="AOPé€šçŸ¥ç±»å‹ï¼š"><a href="#AOPé€šçŸ¥ç±»å‹ï¼š" class="headerlink" title="AOPé€šçŸ¥ç±»å‹ï¼š"></a>AOPé€šçŸ¥ç±»å‹ï¼š</h5><p><strong>1. å‰ç½®é€šçŸ¥ï¼ˆBefore adviceï¼‰</strong>ï¼šåœ¨æŸä¸ªè¿æ¥ç‚¹ï¼ˆJoinPointï¼‰ä¹‹å‰æ‰§è¡Œçš„é€šçŸ¥ï¼Œä½†å®ƒä¸èƒ½é˜»æ­¢è¿æ¥ç‚¹ä¹‹å‰çš„æ‰§è¡Œã€‚åœ¨ <code>ApplicationContext</code> ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ <code>&lt;aop:before&gt;</code> å…ƒç´ åœ¨ <code>&lt;aop:aspect&gt;</code> å†…éƒ¨è¿›è¡Œå£°æ˜ã€‚</p><p><strong>2. åç½®é€šçŸ¥ï¼ˆAfter adviceï¼‰</strong>ï¼šå½“æŸä¸ªè¿æ¥ç‚¹é€€å‡ºæ—¶æ‰§è¡Œçš„é€šçŸ¥ï¼Œæ— è®ºæ˜¯æ­£å¸¸è¿”å›è¿˜æ˜¯å¼‚å¸¸é€€å‡ºã€‚åœ¨ <code>ApplicationContext</code> ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ <code>&lt;aop:after&gt;</code> å…ƒç´ åœ¨ <code>&lt;aop:aspect&gt;</code> å†…éƒ¨è¿›è¡Œå£°æ˜ã€‚</p><p><strong>3. è¿”å›åé€šçŸ¥ï¼ˆAfter return adviceï¼‰</strong>ï¼šåœ¨æŸä¸ªè¿æ¥ç‚¹æ­£å¸¸å®Œæˆåæ‰§è¡Œçš„é€šçŸ¥ï¼Œä¸åŒ…æ‹¬æŠ›å‡ºå¼‚å¸¸çš„æƒ…å†µã€‚åœ¨ <code>ApplicationContext</code> ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ <code>&lt;aop:after-returning&gt;</code> å…ƒç´ åœ¨ <code>&lt;aop:aspect&gt;</code> å†…éƒ¨è¿›è¡Œå£°æ˜ã€‚</p><p><strong>4. ç¯ç»•é€šçŸ¥ï¼ˆAround adviceï¼‰</strong>ï¼šåŒ…å›´ä¸€ä¸ªè¿æ¥ç‚¹çš„é€šçŸ¥ï¼Œç±»ä¼¼äº Web ä¸­ Servlet è§„èŒƒä¸­çš„ <code>Filter</code> çš„ <code>doFilter</code> æ–¹æ³•ã€‚å¯ä»¥åœ¨æ–¹æ³•çš„è°ƒç”¨å‰åå®Œæˆè‡ªå®šä¹‰çš„è¡Œä¸ºï¼Œä¹Ÿå¯ä»¥é€‰æ‹©ä¸æ‰§è¡Œã€‚åœ¨ <code>ApplicationContext</code> ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ <code>&lt;aop:around&gt;</code> å…ƒç´ åœ¨ <code>&lt;aop:aspect&gt;</code> å†…éƒ¨è¿›è¡Œå£°æ˜ã€‚</p><p><strong>5. æŠ›å‡ºå¼‚å¸¸åé€šçŸ¥ï¼ˆAfter throwing adviceï¼‰</strong>ï¼šåœ¨æ–¹æ³•æŠ›å‡ºå¼‚å¸¸é€€å‡ºæ—¶æ‰§è¡Œçš„é€šçŸ¥ã€‚åœ¨ <code>ApplicationContext</code> ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ <code>&lt;aop:after-throwing&gt;</code> å…ƒç´ åœ¨ <code>&lt;aop:aspect&gt;</code> å†…éƒ¨è¿›è¡Œå£°æ˜ã€‚</p><p><strong>JDKåŠ¨æ€ä»£ç† vs. CGLIBåŠ¨æ€ä»£ç†</strong></p><ul><li><strong>JDKåŠ¨æ€ä»£ç†</strong>ï¼š<ul><li>åŸºäºæ¥å£å®ç°</li><li>ä½¿ç”¨Proxy.newProxyInstance()åˆ›å»ºä»£ç†</li><li>åªèƒ½ä»£ç†å®ç°äº†æ¥å£çš„ç±»</li></ul></li><li><strong>CGLIBåŠ¨æ€ä»£ç†</strong>ï¼š<ul><li>åŸºäºç»§æ‰¿å®ç°</li><li>ä½¿ç”¨Enhancerç±»åˆ›å»ºä»£ç†</li><li>å¯ä»¥ä»£ç†æ™®é€šç±»</li><li>ä¸èƒ½ä»£ç†finalç±»å’Œæ–¹æ³•</li></ul></li></ul><h3 id="1-2-Springæ ¸å¿ƒæ³¨è§£è¯¦è§£"><a href="#1-2-Springæ ¸å¿ƒæ³¨è§£è¯¦è§£" class="headerlink" title="1.2 Springæ ¸å¿ƒæ³¨è§£è¯¦è§£"></a>1.2 Springæ ¸å¿ƒæ³¨è§£è¯¦è§£</h3><h4 id="åŸºç¡€é…ç½®æ³¨è§£"><a href="#åŸºç¡€é…ç½®æ³¨è§£" class="headerlink" title="åŸºç¡€é…ç½®æ³¨è§£"></a>åŸºç¡€é…ç½®æ³¨è§£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>  <span class="comment">// è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªé…ç½®ç±»</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &quot;com.example&quot;)</span>  <span class="comment">// ç»„ä»¶æ‰«æ</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span>  <span class="comment">// å¯ç”¨è‡ªåŠ¨é…ç½®</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span>  <span class="comment">// SpringBootä¸»ç±»æ³¨è§£ï¼ŒåŒ…å«ä¸Šè¿°ä¸‰ä¸ª</span></span><br><span class="line"><span class="meta">@Import(OtherConfig.class)</span>  <span class="comment">// å¯¼å…¥å…¶ä»–é…ç½®ç±»</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;classpath:application.properties&quot;)</span>  <span class="comment">// åŠ è½½å±æ€§æ–‡ä»¶</span></span><br></pre></td></tr></table></figure><h4 id="Beanå®šä¹‰æ³¨è§£"><a href="#Beanå®šä¹‰æ³¨è§£" class="headerlink" title="Beanå®šä¹‰æ³¨è§£"></a>Beanå®šä¹‰æ³¨è§£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>  <span class="comment">// é€šç”¨ç»„ä»¶</span></span><br><span class="line"><span class="meta">@Service</span>    <span class="comment">// ä¸šåŠ¡å±‚ç»„ä»¶</span></span><br><span class="line"><span class="meta">@Repository</span> <span class="comment">// æ•°æ®è®¿é—®å±‚ç»„ä»¶</span></span><br><span class="line"><span class="meta">@Controller</span> <span class="comment">// æ§åˆ¶å±‚ç»„ä»¶</span></span><br><span class="line"><span class="meta">@RestController</span> <span class="comment">// RESTfulæ§åˆ¶å™¨ï¼Œç›¸å½“äº@Controller + @ResponseBody</span></span><br><span class="line"><span class="meta">@Bean</span>       <span class="comment">// æ–¹æ³•çº§åˆ«ï¼Œå®šä¹‰Bean</span></span><br><span class="line"><span class="meta">@Scope(&quot;singleton/prototype/request/session&quot;)</span>  <span class="comment">// Beanä½œç”¨åŸŸ</span></span><br><span class="line"><span class="meta">@Lazy</span>       <span class="comment">// å»¶è¿Ÿåˆå§‹åŒ–</span></span><br><span class="line"><span class="meta">@Primary</span>    <span class="comment">// ä¼˜å…ˆæ³¨å…¥</span></span><br><span class="line"><span class="meta">@Qualifier(&quot;beanName&quot;)</span>  <span class="comment">// æŒ‡å®šæ³¨å…¥çš„Beanåç§°</span></span><br></pre></td></tr></table></figure><h4 id="ä¾èµ–æ³¨å…¥æ³¨è§£"><a href="#ä¾èµ–æ³¨å…¥æ³¨è§£" class="headerlink" title="ä¾èµ–æ³¨å…¥æ³¨è§£"></a>ä¾èµ–æ³¨å…¥æ³¨è§£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span>  <span class="comment">// è‡ªåŠ¨è£…é…ï¼Œå¯ç”¨äºæ„é€ å‡½æ•°ã€æ–¹æ³•ã€å­—æ®µ</span></span><br><span class="line"><span class="meta">@Resource</span>   <span class="comment">// JSR-250æ ‡å‡†ï¼ŒæŒ‰åç§°æ³¨å…¥</span></span><br><span class="line"><span class="meta">@Inject</span>     <span class="comment">// JSR-330æ ‡å‡†</span></span><br><span class="line"><span class="meta">@Value(&quot;$&#123;property.name&#125;&quot;)</span>  <span class="comment">// æ³¨å…¥é…ç½®å€¼</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;app&quot;)</span>  <span class="comment">// ç»‘å®šé…ç½®å±æ€§</span></span><br></pre></td></tr></table></figure><h4 id="ç”Ÿå‘½å‘¨æœŸæ³¨è§£"><a href="#ç”Ÿå‘½å‘¨æœŸæ³¨è§£" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸæ³¨è§£"></a>ç”Ÿå‘½å‘¨æœŸæ³¨è§£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostConstruct</span>  <span class="comment">// åˆå§‹åŒ–æ–¹æ³•</span></span><br><span class="line"><span class="meta">@PreDestroy</span>     <span class="comment">// é”€æ¯æ–¹æ³•</span></span><br></pre></td></tr></table></figure><h4 id="AOPç›¸å…³æ³¨è§£"><a href="#AOPç›¸å…³æ³¨è§£" class="headerlink" title="AOPç›¸å…³æ³¨è§£"></a>AOPç›¸å…³æ³¨è§£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span>         <span class="comment">// å£°æ˜åˆ‡é¢</span></span><br><span class="line"><span class="meta">@Pointcut</span>       <span class="comment">// å®šä¹‰åˆ‡ç‚¹</span></span><br><span class="line"><span class="meta">@Before</span>         <span class="comment">// å‰ç½®é€šçŸ¥</span></span><br><span class="line"><span class="meta">@After</span>          <span class="comment">// åç½®é€šçŸ¥</span></span><br><span class="line"><span class="meta">@AfterReturning</span> <span class="comment">// è¿”å›åé€šçŸ¥</span></span><br><span class="line"><span class="meta">@AfterThrowing</span>  <span class="comment">// å¼‚å¸¸é€šçŸ¥</span></span><br><span class="line"><span class="meta">@Around</span>         <span class="comment">// ç¯ç»•é€šçŸ¥</span></span><br></pre></td></tr></table></figure><h3 id="1-3-Springå¸¸è§ä½¿ç”¨åœºæ™¯"><a href="#1-3-Springå¸¸è§ä½¿ç”¨åœºæ™¯" class="headerlink" title="1.3 Springå¸¸è§ä½¿ç”¨åœºæ™¯"></a>1.3 Springå¸¸è§ä½¿ç”¨åœºæ™¯</h3><h4 id="åœºæ™¯1ï¼šæœåŠ¡å±‚äº‹åŠ¡ç®¡ç†"><a href="#åœºæ™¯1ï¼šæœåŠ¡å±‚äº‹åŠ¡ç®¡ç†" class="headerlink" title="åœºæ™¯1ï¼šæœåŠ¡å±‚äº‹åŠ¡ç®¡ç†"></a>åœºæ™¯1ï¼šæœåŠ¡å±‚äº‹åŠ¡ç®¡ç†</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserRepository userRepository;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Transactional(propagation = Propagation.REQUIRED, rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">createUser</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="comment">// ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">        <span class="keyword">return</span> userRepository.save(user);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Transactional(readOnly = true)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">findById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userRepository.findById(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åœºæ™¯2ï¼šç¼“å­˜ç®¡ç†"><a href="#åœºæ™¯2ï¼šç¼“å­˜ç®¡ç†" class="headerlink" title="åœºæ™¯2ï¼šç¼“å­˜ç®¡ç†"></a>åœºæ™¯2ï¼šç¼“å­˜ç®¡ç†</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Cacheable(value = &quot;products&quot;, key = &quot;#id&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Product <span class="title function_">getProduct</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> productRepository.findById(id);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@CacheEvict(value = &quot;products&quot;, key = &quot;#product.id&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Product <span class="title function_">updateProduct</span><span class="params">(Product product)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> productRepository.save(product);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-4-Springå¸¸è§é¢è¯•é—®é¢˜"><a href="#1-4-Springå¸¸è§é¢è¯•é—®é¢˜" class="headerlink" title="1.4 Springå¸¸è§é¢è¯•é—®é¢˜"></a>1.4 Springå¸¸è§é¢è¯•é—®é¢˜</h3><p><strong>Q1: Spring IoCå®¹å™¨çš„åˆå§‹åŒ–è¿‡ç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ</strong></p><p>A: Spring IoCå®¹å™¨åˆå§‹åŒ–åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š</p><ol><li><strong>Resourceå®šä½</strong>: å®šä½é…ç½®æ–‡ä»¶</li><li><strong>BeanDefinitionè½½å…¥</strong>: å°†é…ç½®ä¿¡æ¯è½¬æ¢ä¸ºSpringå†…éƒ¨æ•°æ®ç»“æ„</li><li><strong>BeanDefinitionæ³¨å†Œ</strong>: å°†BeanDefinitionæ³¨å†Œåˆ°IoCå®¹å™¨çš„HashMapä¸­</li></ol><p>å…·ä½“æµç¨‹ï¼š</p><ul><li>åˆ›å»ºApplicationContext</li><li>åŠ è½½é…ç½®å…ƒæ•°æ®ï¼ˆXMLã€æ³¨è§£ã€Javaé…ç½®ï¼‰</li><li>è§£æé…ç½®ï¼Œåˆ›å»ºBeanDefinition</li><li>æ³¨å†ŒBeanDefinitionåˆ°BeanDefinitionRegistry</li><li>å®ä¾‹åŒ–éæ‡’åŠ è½½çš„å•ä¾‹Bean</li></ul><p><strong>Q2: Springä¸­çš„å¾ªç¯ä¾èµ–æ˜¯å¦‚ä½•è§£å†³çš„ï¼Ÿ</strong></p><p>A: Springé€šè¿‡ä¸‰çº§ç¼“å­˜è§£å†³å¾ªç¯ä¾èµ–ï¼š</p><ol><li><strong>singletonObjects</strong>: ä¸€çº§ç¼“å­˜ï¼Œå­˜æ”¾å®Œæ•´çš„Beanå®ä¾‹</li><li><strong>earlySingletonObjects</strong>: äºŒçº§ç¼“å­˜ï¼Œå­˜æ”¾æ—©æœŸçš„Beanå®ä¾‹</li><li><strong>singletonFactories</strong>: ä¸‰çº§ç¼“å­˜ï¼Œå­˜æ”¾Beanå·¥å‚</li></ol><p>è§£å†³è¿‡ç¨‹ï¼š</p><ul><li>Aä¾èµ–Bï¼ŒBä¾èµ–A</li><li>åˆ›å»ºAæ—¶ï¼Œå°†Açš„å·¥å‚æ”¾å…¥ä¸‰çº§ç¼“å­˜</li><li>Aéœ€è¦æ³¨å…¥Bï¼Œå¼€å§‹åˆ›å»ºB</li><li>Béœ€è¦æ³¨å…¥Aï¼Œä»ç¼“å­˜ä¸­è·å–Açš„æ—©æœŸå®ä¾‹</li><li>Båˆ›å»ºå®Œæˆï¼ŒAç»§ç»­åˆ›å»ºå®Œæˆ</li></ul><p><strong>Q3: Spring AOPçš„å®ç°åŸç†ï¼Ÿ</strong></p><p>A: Spring AOPåŸºäºä»£ç†æ¨¡å¼å®ç°ï¼š</p><ol><li><strong>JDKåŠ¨æ€ä»£ç†</strong>: ç›®æ ‡ç±»å®ç°æ¥å£æ—¶ä½¿ç”¨ï¼ŒåŸºäºåå°„æœºåˆ¶</li><li><strong>CGLIBä»£ç†</strong>: ç›®æ ‡ç±»æ²¡æœ‰æ¥å£æ—¶ä½¿ç”¨ï¼ŒåŸºäºå­—èŠ‚ç æŠ€æœ¯</li></ol><p>ä»£ç†åˆ›å»ºè¿‡ç¨‹ï¼š</p><ul><li>Springåœ¨Beanåˆå§‹åŒ–åï¼Œæ£€æŸ¥æ˜¯å¦éœ€è¦AOP</li><li>å¦‚æœéœ€è¦ï¼Œåˆ›å»ºä»£ç†å¯¹è±¡æ›¿æ¢åŸå§‹Bean</li><li>ä»£ç†å¯¹è±¡æ‹¦æˆªæ–¹æ³•è°ƒç”¨ï¼Œæ‰§è¡Œåˆ‡é¢é€»è¾‘</li></ul><h2 id="äºŒã€Spring-Bootæ·±å…¥è§£æ"><a href="#äºŒã€Spring-Bootæ·±å…¥è§£æ" class="headerlink" title="äºŒã€Spring Bootæ·±å…¥è§£æ"></a>äºŒã€Spring Bootæ·±å…¥è§£æ</h2><h3 id="2-1-Spring-Bootæ ¸å¿ƒåŸç†"><a href="#2-1-Spring-Bootæ ¸å¿ƒåŸç†" class="headerlink" title="2.1 Spring Bootæ ¸å¿ƒåŸç†"></a>2.1 Spring Bootæ ¸å¿ƒåŸç†</h3><p><strong>è‡ªåŠ¨é…ç½®åŸç†ï¼š</strong> Spring Booté€šè¿‡@EnableAutoConfigurationæ³¨è§£å¯ç”¨è‡ªåŠ¨é…ç½®æœºåˆ¶ã€‚</p><p>æ ¸å¿ƒç±»åˆ†æï¼š</p><ol><li><strong>SpringBootApplication</strong>: ç»„åˆæ³¨è§£ï¼ŒåŒ…å«@Configurationã€@EnableAutoConfigurationã€@ComponentScan</li><li><strong>AutoConfigurationImportSelector</strong>: è´Ÿè´£å¯¼å…¥è‡ªåŠ¨é…ç½®ç±»</li><li><strong>spring.factories</strong>: META-INF&#x2F;spring.factoriesæ–‡ä»¶å®šä¹‰è‡ªåŠ¨é…ç½®ç±»</li></ol><p><strong>è‡ªåŠ¨é…ç½®æµç¨‹ï¼š</strong></p><ol><li>SpringBootå¯åŠ¨æ—¶æ‰«ææ‰€æœ‰jaråŒ…ä¸‹çš„META-INF&#x2F;spring.factoriesæ–‡ä»¶</li><li>åŠ è½½æ–‡ä»¶ä¸­å®šä¹‰çš„è‡ªåŠ¨é…ç½®ç±»</li><li>æ ¹æ®æ¡ä»¶æ³¨è§£(@ConditionalOnClassç­‰)åˆ¤æ–­æ˜¯å¦ç”Ÿæ•ˆ</li><li>ç”Ÿæ•ˆçš„é…ç½®ç±»ä¼šåˆ›å»ºç›¸åº”çš„Bean</li></ol><h3 id="2-2-Spring-Bootå¯åŠ¨æµç¨‹è¯¦è§£"><a href="#2-2-Spring-Bootå¯åŠ¨æµç¨‹è¯¦è§£" class="headerlink" title="2.2 Spring Bootå¯åŠ¨æµç¨‹è¯¦è§£"></a>2.2 Spring Bootå¯åŠ¨æµç¨‹è¯¦è§£</h3><p><strong>SpringApplication.run()æ–¹æ³•æ‰§è¡Œæµç¨‹ï¼š</strong></p><ol><li><strong>å‡†å¤‡é˜¶æ®µ</strong>ï¼š<ul><li>åˆ›å»ºSpringApplicationå®ä¾‹</li><li>ç¡®å®šåº”ç”¨ç±»å‹ï¼ˆSERVLETã€REACTIVEã€NONEï¼‰</li><li>åŠ è½½ApplicationContextInitializer</li><li>åŠ è½½ApplicationListener</li></ul></li><li><strong>å¯åŠ¨é˜¶æ®µ</strong>ï¼š<ul><li>å¯åŠ¨è®¡æ—¶å™¨</li><li>é…ç½®Headlessæ¨¡å¼</li><li>è·å–å¹¶å¯åŠ¨ç›‘å¬å™¨</li><li>å‡†å¤‡ç¯å¢ƒï¼ˆEnvironmentï¼‰</li><li>æ‰“å°Banner</li></ul></li><li><strong>å®¹å™¨åˆ›å»ºé˜¶æ®µ</strong>ï¼š<ul><li>åˆ›å»ºApplicationContext</li><li>å‡†å¤‡ApplicationContext</li><li>åˆ·æ–°ApplicationContext</li><li>åˆ·æ–°åå¤„ç†</li></ul></li><li><strong>å®Œæˆé˜¶æ®µ</strong>ï¼š<ul><li>åœæ­¢è®¡æ—¶å™¨</li><li>å‘å¸ƒå¯åŠ¨å®Œæˆäº‹ä»¶</li><li>è°ƒç”¨Runners</li></ul></li></ol><h3 id="2-3-Spring-Bootæ ¸å¿ƒæ³¨è§£"><a href="#2-3-Spring-Bootæ ¸å¿ƒæ³¨è§£" class="headerlink" title="2.3 Spring Bootæ ¸å¿ƒæ³¨è§£"></a>2.3 Spring Bootæ ¸å¿ƒæ³¨è§£</h3><h4 id="å¯åŠ¨ç±»æ³¨è§£"><a href="#å¯åŠ¨ç±»æ³¨è§£" class="headerlink" title="å¯åŠ¨ç±»æ³¨è§£"></a>å¯åŠ¨ç±»æ³¨è§£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="comment">// ç­‰ä»·äºä»¥ä¸‹ä¸‰ä¸ªæ³¨è§£çš„ç»„åˆ</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootConfiguration</span>  <span class="comment">// Spring Booté…ç½®ç±»</span></span><br><span class="line"><span class="meta">@EnableScheduling</span>        <span class="comment">// å¯ç”¨å®šæ—¶ä»»åŠ¡</span></span><br><span class="line"><span class="meta">@EnableAsync</span>            <span class="comment">// å¯ç”¨å¼‚æ­¥å¤„ç†</span></span><br><span class="line"><span class="meta">@EnableCaching</span>          <span class="comment">// å¯ç”¨ç¼“å­˜</span></span><br></pre></td></tr></table></figure><h4 id="æ¡ä»¶æ³¨è§£"><a href="#æ¡ä»¶æ³¨è§£" class="headerlink" title="æ¡ä»¶æ³¨è§£"></a>æ¡ä»¶æ³¨è§£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConditionalOnClass(DataSource.class)</span>      <span class="comment">// ç±»è·¯å¾„ä¸‹å­˜åœ¨æŒ‡å®šç±»</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(DataSource.class)</span> <span class="comment">// å®¹å™¨ä¸­ä¸å­˜åœ¨æŒ‡å®šBean</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(name = &quot;app.enabled&quot;, havingValue = &quot;true&quot;)</span> <span class="comment">// å±æ€§åŒ¹é…</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication</span>               <span class="comment">// Webåº”ç”¨ç¯å¢ƒ</span></span><br><span class="line"><span class="meta">@ConditionalOnNotWebApplication</span>            <span class="comment">// éWebåº”ç”¨ç¯å¢ƒ</span></span><br><span class="line"><span class="meta">@Profile(&quot;dev&quot;)</span>                           <span class="comment">// æ¿€æ´»çš„profile</span></span><br></pre></td></tr></table></figure><h4 id="é…ç½®å±æ€§æ³¨è§£"><a href="#é…ç½®å±æ€§æ³¨è§£" class="headerlink" title="é…ç½®å±æ€§æ³¨è§£"></a>é…ç½®å±æ€§æ³¨è§£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;app.datasource&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceProperties</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="comment">// getters and setters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-4-Spring-Bootå®é™…åº”ç”¨åœºæ™¯"><a href="#2-4-Spring-Bootå®é™…åº”ç”¨åœºæ™¯" class="headerlink" title="2.4 Spring Bootå®é™…åº”ç”¨åœºæ™¯"></a>2.4 Spring Bootå®é™…åº”ç”¨åœºæ™¯</h3><h4 id="åœºæ™¯1ï¼šå¾®æœåŠ¡æ¶æ„"><a href="#åœºæ™¯1ï¼šå¾®æœåŠ¡æ¶æ„" class="headerlink" title="åœºæ™¯1ï¼šå¾®æœåŠ¡æ¶æ„"></a>åœºæ™¯1ï¼šå¾®æœåŠ¡æ¶æ„</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(UserServiceApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@FeignClient(name = &quot;order-service&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderServiceClient</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/orders/&#123;userId&#125;&quot;)</span></span><br><span class="line">    List&lt;Order&gt; <span class="title function_">getOrdersByUserId</span><span class="params">(<span class="meta">@PathVariable</span> Long userId)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åœºæ™¯2ï¼šæ•°æ®è®¿é—®å±‚æ•´åˆ"><a href="#åœºæ™¯2ï¼šæ•°æ®è®¿é—®å±‚æ•´åˆ" class="headerlink" title="åœºæ™¯2ï¼šæ•°æ®è®¿é—®å±‚æ•´åˆ"></a>åœºæ™¯2ï¼šæ•°æ®è®¿é—®å±‚æ•´åˆ</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableJpaRepositories</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(&quot;spring.datasource.primary&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DataSourceProperties <span class="title function_">primaryDataSourceProperties</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DataSourceProperties</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(&quot;spring.datasource.secondary&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DataSourceProperties <span class="title function_">secondaryDataSourceProperties</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DataSourceProperties</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-5-Spring-Booté¢è¯•é—®é¢˜"><a href="#2-5-Spring-Booté¢è¯•é—®é¢˜" class="headerlink" title="2.5 Spring Booté¢è¯•é—®é¢˜"></a>2.5 Spring Booté¢è¯•é—®é¢˜</h3><p><strong>Q1: Spring Bootçš„å¯åŠ¨åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p><p>A: Spring Bootå¯åŠ¨åŸç†æ ¸å¿ƒåœ¨äºè‡ªåŠ¨é…ç½®ï¼š</p><ol><li><strong>@SpringBootApplication</strong>ç»„åˆäº†ä¸‰ä¸ªæ³¨è§£ï¼Œå…¶ä¸­@EnableAutoConfigurationæ˜¯å…³é”®</li><li><strong>AutoConfigurationImportSelector</strong>ä¼šæ‰«ææ‰€æœ‰å¼•å…¥çš„jaråŒ…ï¼ŒæŸ¥æ‰¾å…¶META-INF&#x2F;spring.factoriesæ–‡ä»¶ä¸­org.springframework.boot.autoconfigure.EnableAutoConfigurationé”®æ‰€å¯¹åº”çš„é…ç½®ç±»å…¨é™å®šååˆ—è¡¨</li><li>æ ¹æ®æ¡ä»¶æ³¨è§£åˆ¤æ–­å“ªäº›è‡ªåŠ¨é…ç½®ç±»ç”Ÿæ•ˆ</li><li>ç”Ÿæ•ˆçš„é…ç½®ç±»ä¼šå‘å®¹å™¨ä¸­æ³¨å†Œç›¸åº”çš„Bean</li></ol><p><strong>Q2: Spring Bootå¦‚ä½•å®ç°è‡ªåŠ¨é…ç½®ï¼Ÿ</strong></p><p>A: è‡ªåŠ¨é…ç½®é€šè¿‡ä»¥ä¸‹æœºåˆ¶å®ç°ï¼š</p><ol><li><strong>æ¡ä»¶æ³¨è§£</strong>: @ConditionalOnClassã€@ConditionalOnBeanç­‰åˆ¤æ–­é…ç½®æ˜¯å¦ç”Ÿæ•ˆ</li><li><strong>é…ç½®æ–‡ä»¶</strong>: spring.factorieså®šä¹‰è‡ªåŠ¨é…ç½®ç±»åˆ—è¡¨</li><li><strong>é…ç½®å±æ€§</strong>: @ConfigurationPropertiesç»‘å®šé…ç½®æ–‡ä»¶ä¸­çš„å±æ€§</li><li><strong>é»˜è®¤é…ç½®</strong>: æä¾›åˆç†çš„é»˜è®¤å€¼ï¼Œç”¨æˆ·å¯è¦†ç›–</li></ol><p><strong>Q3: Spring Boot Starterçš„å·¥ä½œåŸç†ï¼Ÿ</strong></p><p>A: Starteræ˜¯Spring Bootè‡ªåŠ¨é…ç½®çš„è½½ä½“ï¼š</p><ol><li><strong>ä¾èµ–ç®¡ç†</strong>: é€šè¿‡Maven&#x2F;Gradleå¼•å…¥ç›¸å…³ä¾èµ–</li><li><strong>è‡ªåŠ¨é…ç½®</strong>: åŒ…å«AutoConfigurationç±»</li><li><strong>å±æ€§ç»‘å®š</strong>: æä¾›ConfigurationPropertiesç±»</li><li><strong>æ¡ä»¶è£…é…</strong>: ä½¿ç”¨æ¡ä»¶æ³¨è§£æ§åˆ¶Beançš„åˆ›å»º</li></ol><h2 id="ä¸‰ã€Spring-MVCæ·±å…¥è§£æ"><a href="#ä¸‰ã€Spring-MVCæ·±å…¥è§£æ" class="headerlink" title="ä¸‰ã€Spring MVCæ·±å…¥è§£æ"></a>ä¸‰ã€Spring MVCæ·±å…¥è§£æ</h2><h3 id="3-1-Spring-MVCæ ¸å¿ƒç»„ä»¶"><a href="#3-1-Spring-MVCæ ¸å¿ƒç»„ä»¶" class="headerlink" title="3.1 Spring MVCæ ¸å¿ƒç»„ä»¶"></a>3.1 Spring MVCæ ¸å¿ƒç»„ä»¶</h3><p><strong>DispatcherServletå¤„ç†æµç¨‹ï¼š</strong></p><ol><li><strong>æ¥æ”¶è¯·æ±‚</strong>: DispatcherServletæ¥æ”¶HTTPè¯·æ±‚</li><li><strong>æŸ¥æ‰¾Handler</strong>: HandlerMappingæŸ¥æ‰¾å¤„ç†è¯·æ±‚çš„Handler</li><li><strong>è·å–HandlerAdapter</strong>: è·å–èƒ½å¤Ÿæ‰§è¡ŒHandlerçš„HandlerAdapter</li><li><strong>æ‰§è¡ŒHandler</strong>: HandlerAdapteræ‰§è¡ŒHandlerï¼ˆControlleræ–¹æ³•ï¼‰</li><li><strong>å¤„ç†ç»“æœ</strong>: è¿”å›ModelAndView</li><li><strong>è§†å›¾è§£æ</strong>: ViewResolverè§£æè§†å›¾åç§°</li><li><strong>æ¸²æŸ“è§†å›¾</strong>: Viewæ¸²æŸ“æ¨¡å‹æ•°æ®</li><li><strong>è¿”å›å“åº”</strong>: å“åº”ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯</li></ol><p><strong>æ ¸å¿ƒç»„ä»¶è¯¦è§£ï¼š</strong></p><ul><li><strong>DispatcherServlet</strong>: å‰ç«¯æ§åˆ¶å™¨ï¼Œç»Ÿä¸€å¤„ç†è¯·æ±‚</li><li><strong>HandlerMapping</strong>: å¤„ç†å™¨æ˜ å°„å™¨ï¼ŒURLä¸Handlerçš„æ˜ å°„</li><li><strong>HandlerAdapter</strong>: å¤„ç†å™¨é€‚é…å™¨ï¼Œæ‰§è¡ŒHandler</li><li><strong>Handler</strong>: å¤„ç†å™¨ï¼Œå³Controller</li><li><strong>ViewResolver</strong>: è§†å›¾è§£æå™¨</li><li><strong>View</strong>: è§†å›¾</li></ul><h3 id="3-2-Spring-MVCæ ¸å¿ƒæ³¨è§£"><a href="#3-2-Spring-MVCæ ¸å¿ƒæ³¨è§£" class="headerlink" title="3.2 Spring MVCæ ¸å¿ƒæ³¨è§£"></a>3.2 Spring MVCæ ¸å¿ƒæ³¨è§£</h3><h4 id="æ§åˆ¶å™¨æ³¨è§£"><a href="#æ§åˆ¶å™¨æ³¨è§£" class="headerlink" title="æ§åˆ¶å™¨æ³¨è§£"></a>æ§åˆ¶å™¨æ³¨è§£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span>             <span class="comment">// æ ‡è®°æ§åˆ¶å™¨ç±»</span></span><br><span class="line"><span class="meta">@RestController</span>        <span class="comment">// RESTfulæ§åˆ¶å™¨</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api&quot;)</span> <span class="comment">// è¯·æ±‚æ˜ å°„</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/users&quot;)</span>   <span class="comment">// GETè¯·æ±‚æ˜ å°„</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/users&quot;)</span>  <span class="comment">// POSTè¯·æ±‚æ˜ å°„</span></span><br><span class="line"><span class="meta">@PutMapping(&quot;/users/&#123;id&#125;&quot;)</span>    <span class="comment">// PUTè¯·æ±‚æ˜ å°„</span></span><br><span class="line"><span class="meta">@DeleteMapping(&quot;/users/&#123;id&#125;&quot;)</span> <span class="comment">// DELETEè¯·æ±‚æ˜ å°„</span></span><br><span class="line"><span class="meta">@PatchMapping(&quot;/users/&#123;id&#125;&quot;)</span>  <span class="comment">// PATCHè¯·æ±‚æ˜ å°„</span></span><br></pre></td></tr></table></figure><h4 id="å‚æ•°ç»‘å®šæ³¨è§£"><a href="#å‚æ•°ç»‘å®šæ³¨è§£" class="headerlink" title="å‚æ•°ç»‘å®šæ³¨è§£"></a>å‚æ•°ç»‘å®šæ³¨è§£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestParam(&quot;name&quot;)</span>           <span class="comment">// è¯·æ±‚å‚æ•°</span></span><br><span class="line"><span class="meta">@PathVariable(&quot;id&quot;)</span>            <span class="comment">// è·¯å¾„å˜é‡</span></span><br><span class="line"><span class="meta">@RequestBody</span>                   <span class="comment">// è¯·æ±‚ä½“</span></span><br><span class="line"><span class="meta">@RequestHeader(&quot;Content-Type&quot;)</span> <span class="comment">// è¯·æ±‚å¤´</span></span><br><span class="line"><span class="meta">@CookieValue(&quot;sessionId&quot;)</span>      <span class="comment">// Cookieå€¼</span></span><br><span class="line"><span class="meta">@ModelAttribute</span>               <span class="comment">// æ¨¡å‹å±æ€§</span></span><br><span class="line"><span class="meta">@SessionAttribute</span>            <span class="comment">// Sessionå±æ€§</span></span><br><span class="line"><span class="meta">@RequestPart</span>                 <span class="comment">// æ–‡ä»¶ä¸Šä¼ </span></span><br></pre></td></tr></table></figure><h4 id="å“åº”å¤„ç†æ³¨è§£"><a href="#å“åº”å¤„ç†æ³¨è§£" class="headerlink" title="å“åº”å¤„ç†æ³¨è§£"></a>å“åº”å¤„ç†æ³¨è§£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ResponseBody</span>              <span class="comment">// å“åº”ä½“</span></span><br><span class="line"><span class="meta">@ResponseStatus(HttpStatus.CREATED)</span> <span class="comment">// å“åº”çŠ¶æ€ç </span></span><br><span class="line"><span class="meta">@ExceptionHandler</span>         <span class="comment">// å¼‚å¸¸å¤„ç†</span></span><br><span class="line"><span class="meta">@ControllerAdvice</span>        <span class="comment">// å…¨å±€æ§åˆ¶å™¨å¢å¼º</span></span><br><span class="line"><span class="meta">@RestControllerAdvice</span>    <span class="comment">// RESTfulå…¨å±€å¼‚å¸¸å¤„ç†</span></span><br></pre></td></tr></table></figure><h3 id="3-3-Spring-MVCå®é™…åº”ç”¨åœºæ™¯"><a href="#3-3-Spring-MVCå®é™…åº”ç”¨åœºæ™¯" class="headerlink" title="3.3 Spring MVCå®é™…åº”ç”¨åœºæ™¯"></a>3.3 Spring MVCå®é™…åº”ç”¨åœºæ™¯</h3><h4 id="åœºæ™¯1ï¼šRESTful-APIå¼€å‘"><a href="#åœºæ™¯1ï¼šRESTful-APIå¼€å‘" class="headerlink" title="åœºæ™¯1ï¼šRESTful APIå¼€å‘"></a>åœºæ™¯1ï¼šRESTful APIå¼€å‘</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/users&quot;)</span></span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;PageResult&lt;User&gt;&gt; <span class="title function_">getUsers</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(defaultValue = &quot;1&quot;)</span> <span class="type">int</span> page,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(defaultValue = &quot;10&quot;)</span> <span class="type">int</span> size,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(required = false)</span> String keyword)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        PageResult&lt;User&gt; result = userService.findUsers(page, size, keyword);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(result);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;User&gt; <span class="title function_">createUser</span><span class="params">(<span class="meta">@Valid</span> <span class="meta">@RequestBody</span> UserCreateRequest request)</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.createUser(request);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.status(HttpStatus.CREATED).body(user);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PutMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;User&gt; <span class="title function_">updateUser</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@PathVariable</span> Long id,</span></span><br><span class="line"><span class="params">            <span class="meta">@Valid</span> <span class="meta">@RequestBody</span> UserUpdateRequest request)</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.updateUser(id, request);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(user);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Void&gt; <span class="title function_">deleteUser</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        userService.deleteUser(id);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.noContent().build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åœºæ™¯2ï¼šå…¨å±€å¼‚å¸¸å¤„ç†"><a href="#åœºæ™¯2ï¼šå…¨å±€å¼‚å¸¸å¤„ç†" class="headerlink" title="åœºæ™¯2ï¼šå…¨å±€å¼‚å¸¸å¤„ç†"></a>åœºæ™¯2ï¼šå…¨å±€å¼‚å¸¸å¤„ç†</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ExceptionHandler(ValidationException.class)</span></span><br><span class="line">    <span class="meta">@ResponseStatus(HttpStatus.BAD_REQUEST)</span></span><br><span class="line">    <span class="keyword">public</span> ErrorResponse <span class="title function_">handleValidationException</span><span class="params">(ValidationException e)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ErrorResponse.builder()</span><br><span class="line">                .code(<span class="string">&quot;VALIDATION_ERROR&quot;</span>)</span><br><span class="line">                .message(e.getMessage())</span><br><span class="line">                .timestamp(LocalDateTime.now())</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ExceptionHandler(EntityNotFoundException.class)</span></span><br><span class="line">    <span class="meta">@ResponseStatus(HttpStatus.NOT_FOUND)</span></span><br><span class="line">    <span class="keyword">public</span> ErrorResponse <span class="title function_">handleEntityNotFoundException</span><span class="params">(EntityNotFoundException e)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ErrorResponse.builder()</span><br><span class="line">                .code(<span class="string">&quot;ENTITY_NOT_FOUND&quot;</span>)</span><br><span class="line">                .message(e.getMessage())</span><br><span class="line">                .timestamp(LocalDateTime.now())</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line">    <span class="meta">@ResponseStatus(HttpStatus.INTERNAL_SERVER_ERROR)</span></span><br><span class="line">    <span class="keyword">public</span> ErrorResponse <span class="title function_">handleGenericException</span><span class="params">(Exception e)</span> &#123;</span><br><span class="line">        log.error(<span class="string">&quot;Unexpected error occurred&quot;</span>, e);</span><br><span class="line">        <span class="keyword">return</span> ErrorResponse.builder()</span><br><span class="line">                .code(<span class="string">&quot;INTERNAL_ERROR&quot;</span>)</span><br><span class="line">                .message(<span class="string">&quot;An unexpected error occurred&quot;</span>)</span><br><span class="line">                .timestamp(LocalDateTime.now())</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åœºæ™¯3ï¼šæ–‡ä»¶ä¸Šä¼ å¤„ç†"><a href="#åœºæ™¯3ï¼šæ–‡ä»¶ä¸Šä¼ å¤„ç†" class="headerlink" title="åœºæ™¯3ï¼šæ–‡ä»¶ä¸Šä¼ å¤„ç†"></a>åœºæ™¯3ï¼šæ–‡ä»¶ä¸Šä¼ å¤„ç†</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/files&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/upload&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;FileUploadResponse&gt; <span class="title function_">uploadFile</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestPart(&quot;file&quot;)</span> MultipartFile file,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(required = false)</span> String description)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ–‡ä»¶ç±»å‹éªŒè¯</span></span><br><span class="line">        <span class="keyword">if</span> (!isValidFileType(file.getContentType())) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InvalidFileTypeException</span>(<span class="string">&quot;Invalid file type&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ–‡ä»¶å¤§å°éªŒè¯</span></span><br><span class="line">        <span class="keyword">if</span> (file.getSize() &gt; MAX_FILE_SIZE) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">FileSizeExceededException</span>(<span class="string">&quot;File size exceeds limit&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> fileService.saveFile(file, description);</span><br><span class="line">        </span><br><span class="line">        <span class="type">FileUploadResponse</span> <span class="variable">response</span> <span class="operator">=</span> FileUploadResponse.builder()</span><br><span class="line">                .fileName(fileName)</span><br><span class="line">                .originalName(file.getOriginalFilename())</span><br><span class="line">                .size(file.getSize())</span><br><span class="line">                .contentType(file.getContentType())</span><br><span class="line">                .uploadTime(LocalDateTime.now())</span><br><span class="line">                .build();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-4-Spring-MVCé¢è¯•é—®é¢˜"><a href="#3-4-Spring-MVCé¢è¯•é—®é¢˜" class="headerlink" title="3.4 Spring MVCé¢è¯•é—®é¢˜"></a>3.4 Spring MVCé¢è¯•é—®é¢˜</h3><p><strong>Q1: Spring MVCçš„æ‰§è¡Œæµç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ</strong></p><p>A: Spring MVCçš„æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p><ol><li>ç”¨æˆ·å‘é€è¯·æ±‚åˆ°DispatcherServlet</li><li>DispatcherServletè°ƒç”¨HandlerMappingæŸ¥æ‰¾Handler</li><li>HandlerMappingè¿”å›HandlerExecutionChainï¼ˆåŒ…å«Handlerå’Œæ‹¦æˆªå™¨ï¼‰</li><li>DispatcherServletè°ƒç”¨HandlerAdapteræ‰§è¡ŒHandler</li><li>Handleræ‰§è¡Œå®Œæˆåè¿”å›ModelAndView</li><li>DispatcherServletè°ƒç”¨ViewResolverè§£æè§†å›¾åç§°</li><li>ViewResolverè¿”å›Viewå¯¹è±¡</li><li>DispatcherServletè°ƒç”¨Viewçš„renderæ–¹æ³•æ¸²æŸ“è§†å›¾</li><li>å“åº”ç»“æœè¿”å›ç»™ç”¨æˆ·</li></ol><p><strong>Q2: Spring MVCä¸­çš„æ‹¦æˆªå™¨æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</strong></p><p>A: æ‹¦æˆªå™¨åŸºäºAOPæ€æƒ³ï¼Œåœ¨Handleræ‰§è¡Œå‰åè¿›è¡Œå¤„ç†ï¼š</p><ol><li><strong>HandlerInterceptoræ¥å£</strong>æä¾›ä¸‰ä¸ªæ–¹æ³•ï¼š<ul><li>preHandle(): å‰ç½®å¤„ç†ï¼Œè¿”å›falseåˆ™ä¸­æ–­è¯·æ±‚</li><li>postHandle(): åç½®å¤„ç†ï¼ŒHandleræ‰§è¡Œåè°ƒç”¨</li><li>afterCompletion(): å®Œæˆå¤„ç†ï¼Œè§†å›¾æ¸²æŸ“åè°ƒç”¨</li></ul></li><li><strong>æ‰§è¡Œé¡ºåº</strong>ï¼š<ul><li>å¤šä¸ªæ‹¦æˆªå™¨æŒ‰é…ç½®é¡ºåºæ‰§è¡ŒpreHandle()</li><li>æŒ‰ç›¸åé¡ºåºæ‰§è¡ŒpostHandle()å’ŒafterCompletion()</li></ul></li></ol><p><strong>Q3: @RequestBodyå’Œ@ResponseBodyçš„å·¥ä½œåŸç†ï¼Ÿ</strong></p><p>A: è¿™ä¸¤ä¸ªæ³¨è§£åŸºäºHttpMessageConverterå·¥ä½œï¼š</p><ol><li><strong>@RequestBody</strong>:<ul><li>ä½¿ç”¨HttpMessageConverterå°†HTTPè¯·æ±‚ä½“è½¬æ¢ä¸ºJavaå¯¹è±¡</li><li>å¸¸ç”¨çš„è½¬æ¢å™¨ï¼šMappingJackson2HttpMessageConverterå¤„ç†JSON</li></ul></li><li><strong>@ResponseBody</strong>:<ul><li>ä½¿ç”¨HttpMessageConverterå°†Javaå¯¹è±¡è½¬æ¢ä¸ºHTTPå“åº”ä½“</li><li>æ ¹æ®Acceptå¤´é€‰æ‹©åˆé€‚çš„è½¬æ¢å™¨</li></ul></li></ol><h2 id="å››ã€MyBatisæ·±å…¥è§£æ"><a href="#å››ã€MyBatisæ·±å…¥è§£æ" class="headerlink" title="å››ã€MyBatisæ·±å…¥è§£æ"></a>å››ã€MyBatisæ·±å…¥è§£æ</h2><h3 id="4-1-MyBatisæ ¸å¿ƒåŸç†"><a href="#4-1-MyBatisæ ¸å¿ƒåŸç†" class="headerlink" title="4.1 MyBatisæ ¸å¿ƒåŸç†"></a>4.1 MyBatisæ ¸å¿ƒåŸç†</h3><p><strong>MyBatisæ¶æ„åˆ†æï¼š</strong> MyBatisé‡‡ç”¨åˆ†å±‚æ¶æ„è®¾è®¡ï¼š</p><ol><li><strong>APIæ¥å£å±‚</strong>: æä¾›ç»™å¤–éƒ¨ä½¿ç”¨çš„æ¥å£API</li><li><strong>æ•°æ®å¤„ç†å±‚</strong>: å‚æ•°æ˜ å°„ã€SQLè§£æã€ç»“æœæ˜ å°„</li><li><strong>åŸºç¡€æ”¯æ’‘å±‚</strong>: è¿æ¥ç®¡ç†ã€äº‹åŠ¡ç®¡ç†ã€é…ç½®åŠ è½½ã€ç¼“å­˜å¤„ç†</li></ol><p><strong>MyBatisæ ¸å¿ƒç»„ä»¶ï¼š</strong></p><ul><li><strong>SqlSessionFactory</strong>: ä¼šè¯å·¥å‚ï¼Œè´Ÿè´£åˆ›å»ºSqlSession</li><li><strong>SqlSession</strong>: ä¼šè¯ï¼Œæ‰§è¡ŒSQLçš„æ ¸å¿ƒæ¥å£</li><li><strong>Executor</strong>: æ‰§è¡Œå™¨ï¼Œå®é™…æ‰§è¡ŒSQL</li><li><strong>StatementHandler</strong>: è¯­å¥å¤„ç†å™¨ï¼Œå¤„ç†SQLè¯­å¥</li><li><strong>ParameterHandler</strong>: å‚æ•°å¤„ç†å™¨ï¼Œå¤„ç†SQLå‚æ•°</li><li><strong>ResultSetHandler</strong>: ç»“æœé›†å¤„ç†å™¨ï¼Œå¤„ç†æŸ¥è¯¢ç»“æœ</li><li><strong>MappedStatement</strong>: æ˜ å°„è¯­å¥ï¼Œå°è£…SQLé…ç½®ä¿¡æ¯</li></ul><h3 id="4-2-MyBatisæ‰§è¡Œæµç¨‹è¯¦è§£"><a href="#4-2-MyBatisæ‰§è¡Œæµç¨‹è¯¦è§£" class="headerlink" title="4.2 MyBatisæ‰§è¡Œæµç¨‹è¯¦è§£"></a>4.2 MyBatisæ‰§è¡Œæµç¨‹è¯¦è§£</h3><p><strong>SQLæ‰§è¡Œæµç¨‹ï¼š</strong></p><ol><li><strong>è§£æé…ç½®</strong>: è§£æmybatis-config.xmlå’ŒMapper XMLæ–‡ä»¶</li><li><strong>åˆ›å»ºä¼šè¯</strong>: é€šè¿‡SqlSessionFactoryåˆ›å»ºSqlSession</li><li><strong>è·å–Mapper</strong>: é€šè¿‡åŠ¨æ€ä»£ç†åˆ›å»ºMapperæ¥å£å®ä¾‹</li><li><strong>æ‰§è¡ŒSQL</strong>: è°ƒç”¨Mapperæ–¹æ³•ï¼Œè½¬æ¢ä¸ºMappedStatementæ‰§è¡Œ</li><li><strong>å‚æ•°å¤„ç†</strong>: ParameterHandlerå¤„ç†è¾“å…¥å‚æ•°</li><li><strong>æ‰§è¡ŒæŸ¥è¯¢</strong>: StatementHandleræ‰§è¡ŒSQLè¯­å¥</li><li><strong>ç»“æœæ˜ å°„</strong>: ResultSetHandlerå¤„ç†ç»“æœé›†</li><li><strong>è¿”å›ç»“æœ</strong>: å°†ç»“æœè¿”å›ç»™è°ƒç”¨æ–¹</li></ol><p><strong>åŠ¨æ€ä»£ç†åŸç†ï¼š</strong> MyBatisä½¿ç”¨JDKåŠ¨æ€ä»£ç†ä¸ºMapperæ¥å£åˆ›å»ºä»£ç†å¯¹è±¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MapperProxyå®ç°InvocationHandler</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MapperProxy</span>&lt;T&gt; <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// æ ¹æ®æ–¹æ³•ç­¾åæ‰¾åˆ°å¯¹åº”çš„MappedStatement</span></span><br><span class="line">        <span class="comment">// æ‰§è¡ŒSQLå¹¶è¿”å›ç»“æœ</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-3-MyBatisæ ¸å¿ƒæ³¨è§£"><a href="#4-3-MyBatisæ ¸å¿ƒæ³¨è§£" class="headerlink" title="4.3 MyBatisæ ¸å¿ƒæ³¨è§£"></a>4.3 MyBatisæ ¸å¿ƒæ³¨è§£</h3><h4 id="åŸºç¡€æ˜ å°„æ³¨è§£"><a href="#åŸºç¡€æ˜ å°„æ³¨è§£" class="headerlink" title="åŸºç¡€æ˜ å°„æ³¨è§£"></a>åŸºç¡€æ˜ å°„æ³¨è§£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select(&quot;SELECT * FROM users WHERE id = #&#123;id&#125;&quot;)</span></span><br><span class="line">User <span class="title function_">findById</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> Long id)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Insert(&quot;INSERT INTO users(name, email) VALUES(#&#123;name&#125;, #&#123;email&#125;)&quot;)</span></span><br><span class="line"><span class="meta">@Options(useGeneratedKeys = true, keyProperty = &quot;id&quot;)</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">insert</span><span class="params">(User user)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Update(&quot;UPDATE users SET name = #&#123;name&#125; WHERE id = #&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">update</span><span class="params">(User user)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Delete(&quot;DELETE FROM users WHERE id = #&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">delete</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> Long id)</span>;</span><br></pre></td></tr></table></figure><h4 id="é«˜çº§æ˜ å°„æ³¨è§£"><a href="#é«˜çº§æ˜ å°„æ³¨è§£" class="headerlink" title="é«˜çº§æ˜ å°„æ³¨è§£"></a>é«˜çº§æ˜ å°„æ³¨è§£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç»“æœæ˜ å°„</span></span><br><span class="line"><span class="meta">@Results(&#123;</span></span><br><span class="line"><span class="meta">    @Result(column = &quot;user_id&quot;, property = &quot;id&quot;),</span></span><br><span class="line"><span class="meta">    @Result(column = &quot;user_name&quot;, property = &quot;name&quot;),</span></span><br><span class="line"><span class="meta">    @Result(column = &quot;create_time&quot;, property = &quot;createTime&quot;)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="meta">@Select(&quot;SELECT user_id, user_name, create_time FROM users&quot;)</span></span><br><span class="line">List&lt;User&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸€å¯¹ä¸€æ˜ å°„</span></span><br><span class="line"><span class="meta">@One(select = &quot;findUserById&quot;)</span></span><br><span class="line"><span class="meta">@Result(column = &quot;user_id&quot;, property = &quot;user&quot;)</span></span><br><span class="line">Order <span class="title function_">findOrderById</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> Long id)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸€å¯¹å¤šæ˜ å°„</span></span><br><span class="line"><span class="meta">@Many(select = &quot;findOrdersByUserId&quot;)</span></span><br><span class="line"><span class="meta">@Result(column = &quot;id&quot;, property = &quot;orders&quot;)</span></span><br><span class="line">User <span class="title function_">findUserWithOrders</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> Long id)</span>;</span><br></pre></td></tr></table></figure><h4 id="åŠ¨æ€SQLæ³¨è§£"><a href="#åŠ¨æ€SQLæ³¨è§£" class="headerlink" title="åŠ¨æ€SQLæ³¨è§£"></a>åŠ¨æ€SQLæ³¨è§£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SelectProvider(type = UserSqlProvider.class, method = &quot;findUsers&quot;)</span></span><br><span class="line">List&lt;User&gt; <span class="title function_">findUsers</span><span class="params">(<span class="meta">@Param(&quot;name&quot;)</span> String name, <span class="meta">@Param(&quot;email&quot;)</span> String email)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserSqlProvider</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">findUsers</span><span class="params">(Map&lt;String, Object&gt; params)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SQL</span>() &#123;&#123;</span><br><span class="line">            SELECT(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">            FROM(<span class="string">&quot;users&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (params.get(<span class="string">&quot;name&quot;</span>) != <span class="literal">null</span>) &#123;</span><br><span class="line">                WHERE(<span class="string">&quot;name LIKE CONCAT(&#x27;%&#x27;, #&#123;name&#125;, &#x27;%&#x27;)&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (params.get(<span class="string">&quot;email&quot;</span>) != <span class="literal">null</span>) &#123;</span><br><span class="line">                WHERE(<span class="string">&quot;email = #&#123;email&#125;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;&#125;.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-4-MyBatisç¼“å­˜æœºåˆ¶"><a href="#4-4-MyBatisç¼“å­˜æœºåˆ¶" class="headerlink" title="4.4 MyBatisç¼“å­˜æœºåˆ¶"></a>4.4 MyBatisç¼“å­˜æœºåˆ¶</h3><p><strong>ä¸€çº§ç¼“å­˜ï¼ˆé»˜è®¤å¼€å¯ï¼‰ï¼š</strong></p><ul><li>ä½œç”¨åŸŸï¼šSqlSessionçº§åˆ«</li><li>ç”Ÿå‘½å‘¨æœŸï¼šä¸SqlSessionç›¸åŒ</li><li>å­˜å‚¨ï¼šHashMapç»“æ„ï¼Œkeyä¸ºCacheKey</li></ul><p><strong>äºŒçº§ç¼“å­˜ï¼ˆéœ€è¦é…ç½®ï¼‰ï¼š</strong></p><ul><li>ä½œç”¨åŸŸï¼šMapperçº§åˆ«</li><li>ç”Ÿå‘½å‘¨æœŸï¼šä¸åº”ç”¨ç¨‹åºç›¸åŒ</li><li>é…ç½®ï¼š@CacheNamespaceæ³¨è§£æˆ–<cache>æ ‡ç­¾</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CacheNamespace(</span></span><br><span class="line"><span class="meta">    eviction = LRU.class,</span></span><br><span class="line"><span class="meta">    flushInterval = 60000,</span></span><br><span class="line"><span class="meta">    size = 1024,</span></span><br><span class="line"><span class="meta">    readWrite = true</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    <span class="comment">// mapper methods</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-5-MyBatiså®é™…åº”ç”¨åœºæ™¯"><a href="#4-5-MyBatiså®é™…åº”ç”¨åœºæ™¯" class="headerlink" title="4.5 MyBatiså®é™…åº”ç”¨åœºæ™¯"></a>4.5 MyBatiså®é™…åº”ç”¨åœºæ™¯</h3><h4 id="åœºæ™¯1ï¼šå¤æ‚æŸ¥è¯¢åœºæ™¯"><a href="#åœºæ™¯1ï¼šå¤æ‚æŸ¥è¯¢åœºæ™¯" class="headerlink" title="åœºæ™¯1ï¼šå¤æ‚æŸ¥è¯¢åœºæ™¯"></a>åœºæ™¯1ï¼šå¤æ‚æŸ¥è¯¢åœºæ™¯</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderMapper</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ†é¡µæŸ¥è¯¢è®¢å•</span></span><br><span class="line">    <span class="meta">@Select(&quot;&quot;&quot;</span></span><br><span class="line"><span class="meta">        SELECT o.*, u.name as user_name, u.email as user_email</span></span><br><span class="line"><span class="meta">        FROM orders o</span></span><br><span class="line"><span class="meta">        LEFT JOIN users u ON o.user_id = u.id</span></span><br><span class="line"><span class="meta">        WHERE o.status = #&#123;status&#125;</span></span><br><span class="line"><span class="meta">        AND o.create_time BETWEEN #&#123;startTime&#125; AND #&#123;endTime&#125;</span></span><br><span class="line"><span class="meta">        ORDER BY o.create_time DESC</span></span><br><span class="line"><span class="meta">        LIMIT #&#123;offset&#125;, #&#123;limit&#125;</span></span><br><span class="line"><span class="meta">    &quot;&quot;&quot;)</span></span><br><span class="line">    <span class="meta">@Results(&#123;</span></span><br><span class="line"><span class="meta">        @Result(column = &quot;id&quot;, property = &quot;id&quot;),</span></span><br><span class="line"><span class="meta">        @Result(column = &quot;user_id&quot;, property = &quot;userId&quot;),</span></span><br><span class="line"><span class="meta">        @Result(column = &quot;user_name&quot;, property = &quot;user.name&quot;),</span></span><br><span class="line"><span class="meta">        @Result(column = &quot;user_email&quot;, property = &quot;user.email&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    List&lt;OrderVO&gt; <span class="title function_">findOrdersWithUser</span><span class="params">(</span></span><br><span class="line"><span class="params">        <span class="meta">@Param(&quot;status&quot;)</span> String status,</span></span><br><span class="line"><span class="params">        <span class="meta">@Param(&quot;startTime&quot;)</span> LocalDateTime startTime,</span></span><br><span class="line"><span class="params">        <span class="meta">@Param(&quot;endTime&quot;)</span> LocalDateTime endTime,</span></span><br><span class="line"><span class="params">        <span class="meta">@Param(&quot;offset&quot;)</span> <span class="type">int</span> offset,</span></span><br><span class="line"><span class="params">        <span class="meta">@Param(&quot;limit&quot;)</span> <span class="type">int</span> limit</span></span><br><span class="line"><span class="params">    )</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç»Ÿè®¡æŸ¥è¯¢</span></span><br><span class="line">    <span class="meta">@Select(&quot;&quot;&quot;</span></span><br><span class="line"><span class="meta">        SELECT </span></span><br><span class="line"><span class="meta">            COUNT(*) as total_count,</span></span><br><span class="line"><span class="meta">            SUM(amount) as total_amount,</span></span><br><span class="line"><span class="meta">            AVG(amount) as avg_amount</span></span><br><span class="line"><span class="meta">        FROM orders </span></span><br><span class="line"><span class="meta">        WHERE status = #&#123;status&#125;</span></span><br><span class="line"><span class="meta">        AND create_time &gt;= #&#123;startTime&#125;</span></span><br><span class="line"><span class="meta">    &quot;&quot;&quot;)</span></span><br><span class="line">    OrderStatistics <span class="title function_">getOrderStatistics</span><span class="params">(</span></span><br><span class="line"><span class="params">        <span class="meta">@Param(&quot;status&quot;)</span> String status,</span></span><br><span class="line"><span class="params">        <span class="meta">@Param(&quot;startTime&quot;)</span> LocalDateTime startTime</span></span><br><span class="line"><span class="params">    )</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åœºæ™¯2ï¼šæ‰¹é‡æ“ä½œåœºæ™¯"><a href="#åœºæ™¯2ï¼šæ‰¹é‡æ“ä½œåœºæ™¯" class="headerlink" title="åœºæ™¯2ï¼šæ‰¹é‡æ“ä½œåœºæ™¯"></a>åœºæ™¯2ï¼šæ‰¹é‡æ“ä½œåœºæ™¯</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BatchMapper</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ‰¹é‡æ’å…¥</span></span><br><span class="line">    <span class="meta">@Insert(&quot;&quot;&quot;</span></span><br><span class="line"><span class="meta">        &lt;script&gt;</span></span><br><span class="line"><span class="meta">        INSERT INTO users (name, email, create_time) VALUES</span></span><br><span class="line"><span class="meta">        &lt;foreach collection=&quot;users&quot; item=&quot;user&quot; separator=&quot;,&quot;&gt;</span></span><br><span class="line"><span class="meta">            (#&#123;user.name&#125;, #&#123;user.email&#125;, #&#123;user.createTime&#125;)</span></span><br><span class="line"><span class="meta">        &lt;/foreach&gt;</span></span><br><span class="line"><span class="meta">        &lt;/script&gt;</span></span><br><span class="line"><span class="meta">    &quot;&quot;&quot;)</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">batchInsertUsers</span><span class="params">(<span class="meta">@Param(&quot;users&quot;)</span> List&lt;User&gt; users)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ‰¹é‡æ›´æ–°</span></span><br><span class="line">    <span class="meta">@Update(&quot;&quot;&quot;</span></span><br><span class="line"><span class="meta">        &lt;script&gt;</span></span><br><span class="line"><span class="meta">        &lt;foreach collection=&quot;users&quot; item=&quot;user&quot; separator=&quot;;&quot;&gt;</span></span><br><span class="line"><span class="meta">            UPDATE users SET </span></span><br><span class="line"><span class="meta">                name = #&#123;user.name&#125;,</span></span><br><span class="line"><span class="meta">                email = #&#123;user.email&#125;,</span></span><br><span class="line"><span class="meta">                update_time = NOW()</span></span><br><span class="line"><span class="meta">            WHERE id = #&#123;user.id&#125;</span></span><br><span class="line"><span class="meta">        &lt;/foreach&gt;</span></span><br><span class="line"><span class="meta">        &lt;/script&gt;</span></span><br><span class="line"><span class="meta">    &quot;&quot;&quot;)</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">batchUpdateUsers</span><span class="params">(<span class="meta">@Param(&quot;users&quot;)</span> List&lt;User&gt; users)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åœºæ™¯3ï¼šåŠ¨æ€SQLåœºæ™¯"><a href="#åœºæ™¯3ï¼šåŠ¨æ€SQLåœºæ™¯" class="headerlink" title="åœºæ™¯3ï¼šåŠ¨æ€SQLåœºæ™¯"></a>åœºæ™¯3ï¼šåŠ¨æ€SQLåœºæ™¯</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SelectProvider(type = UserSqlProvider.class, method = &quot;searchUsers&quot;)</span></span><br><span class="line">List&lt;User&gt; <span class="title function_">searchUsers</span><span class="params">(UserSearchCriteria criteria)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserSqlProvider</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">searchUsers</span><span class="params">(UserSearchCriteria criteria)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SQL</span>() &#123;&#123;</span><br><span class="line">            SELECT(<span class="string">&quot;u.*, p.name as profile_name&quot;</span>);</span><br><span class="line">            FROM(<span class="string">&quot;users u&quot;</span>);</span><br><span class="line">            LEFT_OUTER_JOIN(<span class="string">&quot;user_profiles p ON u.id = p.user_id&quot;</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (StringUtils.hasText(criteria.getName())) &#123;</span><br><span class="line">                WHERE(<span class="string">&quot;u.name LIKE CONCAT(&#x27;%&#x27;, #&#123;name&#125;, &#x27;%&#x27;)&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (StringUtils.hasText(criteria.getEmail())) &#123;</span><br><span class="line">                WHERE(<span class="string">&quot;u.email = #&#123;email&#125;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (criteria.getMinAge() != <span class="literal">null</span>) &#123;</span><br><span class="line">                WHERE(<span class="string">&quot;u.age &gt;= #&#123;minAge&#125;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (criteria.getMaxAge() != <span class="literal">null</span>) &#123;</span><br><span class="line">                WHERE(<span class="string">&quot;u.age &lt;= #&#123;maxAge&#125;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (criteria.getCreateTimeStart() != <span class="literal">null</span>) &#123;</span><br><span class="line">                WHERE(<span class="string">&quot;u.create_time &gt;= #&#123;createTimeStart&#125;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (criteria.getCreateTimeEnd() != <span class="literal">null</span>) &#123;</span><br><span class="line">                WHERE(<span class="string">&quot;u.create_time &lt;= #&#123;createTimeEnd&#125;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (CollectionUtils.isNotEmpty(criteria.getStatuses())) &#123;</span><br><span class="line">                WHERE(<span class="string">&quot;u.status IN (&quot;</span> + </span><br><span class="line">                    criteria.getStatuses().stream()</span><br><span class="line">                        .map(s -&gt; <span class="string">&quot;&#x27;&quot;</span> + s + <span class="string">&quot;&#x27;&quot;</span>)</span><br><span class="line">                        .collect(Collectors.joining(<span class="string">&quot;,&quot;</span>)) + <span class="string">&quot;)&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// æ’åº</span></span><br><span class="line">            <span class="keyword">if</span> (StringUtils.hasText(criteria.getSortField())) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="string">&quot;desc&quot;</span>.equalsIgnoreCase(criteria.getSortDirection())) &#123;</span><br><span class="line">                    ORDER_BY(<span class="string">&quot;u.&quot;</span> + criteria.getSortField() + <span class="string">&quot; DESC&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    ORDER_BY(<span class="string">&quot;u.&quot;</span> + criteria.getSortField() + <span class="string">&quot; ASC&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                ORDER_BY(<span class="string">&quot;u.create_time DESC&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;&#125;.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-6-MyBatisæ€§èƒ½ä¼˜åŒ–"><a href="#4-6-MyBatisæ€§èƒ½ä¼˜åŒ–" class="headerlink" title="4.6 MyBatisæ€§èƒ½ä¼˜åŒ–"></a>4.6 MyBatisæ€§èƒ½ä¼˜åŒ–</h3><h4 id="ä¼˜åŒ–ç­–ç•¥1ï¼šåˆç†ä½¿ç”¨ç¼“å­˜"><a href="#ä¼˜åŒ–ç­–ç•¥1ï¼šåˆç†ä½¿ç”¨ç¼“å­˜" class="headerlink" title="ä¼˜åŒ–ç­–ç•¥1ï¼šåˆç†ä½¿ç”¨ç¼“å­˜"></a>ä¼˜åŒ–ç­–ç•¥1ï¼šåˆç†ä½¿ç”¨ç¼“å­˜</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼€å¯äºŒçº§ç¼“å­˜ï¼Œè®¾ç½®åˆç†çš„ç¼“å­˜ç­–ç•¥</span></span><br><span class="line"><span class="meta">@CacheNamespace(</span></span><br><span class="line"><span class="meta">    eviction = LRU.class,        // ç¼“å­˜å›æ”¶ç­–ç•¥</span></span><br><span class="line"><span class="meta">    flushInterval = 300000,      // ç¼“å­˜åˆ·æ–°é—´éš”ï¼ˆ5åˆ†é’Ÿï¼‰</span></span><br><span class="line"><span class="meta">    size = 1024,                 // ç¼“å­˜å¤§å°</span></span><br><span class="line"><span class="meta">    readWrite = true,            // è¯»å†™ç¼“å­˜</span></span><br><span class="line"><span class="meta">    blocking = false             // éé˜»å¡ç¼“å­˜</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ProductMapper</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¯¹äºé¢‘ç¹æŸ¥è¯¢ä¸”å˜åŒ–ä¸å¤§çš„æ•°æ®ä½¿ç”¨ç¼“å­˜</span></span><br><span class="line">    <span class="meta">@Select(&quot;SELECT * FROM products WHERE category_id = #&#123;categoryId&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@Options(useCache = true)</span></span><br><span class="line">    List&lt;Product&gt; <span class="title function_">findByCategory</span><span class="params">(<span class="meta">@Param(&quot;categoryId&quot;)</span> Long categoryId)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¯¹äºå®æ—¶æ€§è¦æ±‚é«˜çš„æ•°æ®ç¦ç”¨ç¼“å­˜</span></span><br><span class="line">    <span class="meta">@Select(&quot;SELECT * FROM products WHERE id = #&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@Options(useCache = false)</span></span><br><span class="line">    Product <span class="title function_">findRealTimeById</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> Long id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä¼˜åŒ–ç­–ç•¥2ï¼šæ‰¹é‡æ“ä½œ"><a href="#ä¼˜åŒ–ç­–ç•¥2ï¼šæ‰¹é‡æ“ä½œ" class="headerlink" title="ä¼˜åŒ–ç­–ç•¥2ï¼šæ‰¹é‡æ“ä½œ"></a>ä¼˜åŒ–ç­–ç•¥2ï¼šæ‰¹é‡æ“ä½œ</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨æ‰¹é‡æ’å…¥æ›¿ä»£å¾ªç¯æ’å…¥</span></span><br><span class="line"><span class="meta">@Insert(&quot;&quot;&quot;</span></span><br><span class="line"><span class="meta">    &lt;script&gt;</span></span><br><span class="line"><span class="meta">    INSERT INTO order_items (order_id, product_id, quantity, price) VALUES</span></span><br><span class="line"><span class="meta">    &lt;foreach collection=&quot;items&quot; item=&quot;item&quot; separator=&quot;,&quot;&gt;</span></span><br><span class="line"><span class="meta">        (#&#123;item.orderId&#125;, #&#123;item.productId&#125;, #&#123;item.quantity&#125;, #&#123;item.price&#125;)</span></span><br><span class="line"><span class="meta">    &lt;/foreach&gt;</span></span><br><span class="line"><span class="meta">    &lt;/script&gt;</span></span><br><span class="line"><span class="meta">&quot;&quot;&quot;)</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">batchInsertOrderItems</span><span class="params">(<span class="meta">@Param(&quot;items&quot;)</span> List&lt;OrderItem&gt; items)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰¹é‡æ›´æ–°ä¼˜åŒ–</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">batchUpdateProducts</span><span class="params">(List&lt;Product&gt; products)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> (<span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession(ExecutorType.BATCH)) &#123;</span><br><span class="line">        <span class="type">ProductMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(ProductMapper.class);</span><br><span class="line">        <span class="keyword">for</span> (Product product : products) &#123;</span><br><span class="line">            mapper.updateProduct(product);</span><br><span class="line">        &#125;</span><br><span class="line">        sqlSession.commit();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä¼˜åŒ–ç­–ç•¥3ï¼šå»¶è¿ŸåŠ è½½"><a href="#ä¼˜åŒ–ç­–ç•¥3ï¼šå»¶è¿ŸåŠ è½½" class="headerlink" title="ä¼˜åŒ–ç­–ç•¥3ï¼šå»¶è¿ŸåŠ è½½"></a>ä¼˜åŒ–ç­–ç•¥3ï¼šå»¶è¿ŸåŠ è½½</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ResultMap(&quot;userResultMap&quot;)</span></span><br><span class="line"><span class="meta">@Select(&quot;SELECT * FROM users WHERE id = #&#123;id&#125;&quot;)</span></span><br><span class="line">User <span class="title function_">findUserById</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> Long id)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨ResultMapä¸­é…ç½®å»¶è¿ŸåŠ è½½</span></span><br><span class="line">&lt;resultMap id=<span class="string">&quot;userResultMap&quot;</span> type=<span class="string">&quot;User&quot;</span>&gt;</span><br><span class="line">    &lt;id column=<span class="string">&quot;id&quot;</span> property=<span class="string">&quot;id&quot;</span>/&gt;</span><br><span class="line">    &lt;result column=<span class="string">&quot;name&quot;</span> property=<span class="string">&quot;name&quot;</span>/&gt;</span><br><span class="line">    &lt;collection property=<span class="string">&quot;orders&quot;</span> </span><br><span class="line">                select=<span class="string">&quot;findOrdersByUserId&quot;</span> </span><br><span class="line">                column=<span class="string">&quot;id&quot;</span> </span><br><span class="line">                fetchType=<span class="string">&quot;lazy&quot;</span>/&gt;</span><br><span class="line">&lt;/resultMap&gt;</span><br></pre></td></tr></table></figure><h3 id="4-7-MyBatiså¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ"><a href="#4-7-MyBatiså¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ" class="headerlink" title="4.7 MyBatiså¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ"></a>4.7 MyBatiså¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</h3><h4 id="é—®é¢˜1ï¼šN-1æŸ¥è¯¢é—®é¢˜"><a href="#é—®é¢˜1ï¼šN-1æŸ¥è¯¢é—®é¢˜" class="headerlink" title="é—®é¢˜1ï¼šN+1æŸ¥è¯¢é—®é¢˜"></a>é—®é¢˜1ï¼šN+1æŸ¥è¯¢é—®é¢˜</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é—®é¢˜ï¼šä¼šäº§ç”ŸN+1æ¬¡æŸ¥è¯¢</span></span><br><span class="line"><span class="meta">@Select(&quot;SELECT * FROM users&quot;)</span></span><br><span class="line">List&lt;User&gt; <span class="title function_">findAllUsers</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Select(&quot;SELECT * FROM orders WHERE user_id = #&#123;userId&#125;&quot;)</span></span><br><span class="line">List&lt;Order&gt; <span class="title function_">findOrdersByUserId</span><span class="params">(<span class="meta">@Param(&quot;userId&quot;)</span> Long userId)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è§£å†³æ–¹æ¡ˆ1ï¼šä½¿ç”¨è”è¡¨æŸ¥è¯¢</span></span><br><span class="line"><span class="meta">@Select(&quot;&quot;&quot;</span></span><br><span class="line"><span class="meta">    SELECT u.*, o.id as order_id, o.amount, o.status as order_status</span></span><br><span class="line"><span class="meta">    FROM users u</span></span><br><span class="line"><span class="meta">    LEFT JOIN orders o ON u.id = o.user_id</span></span><br><span class="line"><span class="meta">&quot;&quot;&quot;)</span></span><br><span class="line"><span class="meta">@Results(&#123;</span></span><br><span class="line"><span class="meta">    @Result(column = &quot;id&quot;, property = &quot;id&quot;),</span></span><br><span class="line"><span class="meta">    @Result(column = &quot;name&quot;, property = &quot;name&quot;),</span></span><br><span class="line"><span class="meta">    @Result(column = &quot;order_id&quot;, property = &quot;orders.id&quot;),</span></span><br><span class="line"><span class="meta">    @Result(column = &quot;amount&quot;, property = &quot;orders.amount&quot;),</span></span><br><span class="line"><span class="meta">    @Result(column = &quot;order_status&quot;, property = &quot;orders.status&quot;)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line">List&lt;User&gt; <span class="title function_">findUsersWithOrders</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è§£å†³æ–¹æ¡ˆ2ï¼šä½¿ç”¨æ‰¹é‡æŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findUsersWithOrdersOptimized</span><span class="params">(List&lt;Long&gt; userIds)</span> &#123;</span><br><span class="line">    List&lt;User&gt; users = userMapper.findUsersByIds(userIds);</span><br><span class="line">    <span class="keyword">if</span> (!users.isEmpty()) &#123;</span><br><span class="line">        List&lt;Long&gt; ids = users.stream().map(User::getId).collect(Collectors.toList());</span><br><span class="line">        List&lt;Order&gt; orders = orderMapper.findOrdersByUserIds(ids);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ‰‹åŠ¨ç»„è£…æ•°æ®</span></span><br><span class="line">        Map&lt;Long, List&lt;Order&gt;&gt; orderMap = orders.stream()</span><br><span class="line">            .collect(Collectors.groupingBy(Order::getUserId));</span><br><span class="line">        </span><br><span class="line">        users.forEach(user -&gt; user.setOrders(orderMap.get(user.getId())));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> users;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é—®é¢˜2ï¼šå¤§æ•°æ®é‡æŸ¥è¯¢å†…å­˜æº¢å‡º"><a href="#é—®é¢˜2ï¼šå¤§æ•°æ®é‡æŸ¥è¯¢å†…å­˜æº¢å‡º" class="headerlink" title="é—®é¢˜2ï¼šå¤§æ•°æ®é‡æŸ¥è¯¢å†…å­˜æº¢å‡º"></a>é—®é¢˜2ï¼šå¤§æ•°æ®é‡æŸ¥è¯¢å†…å­˜æº¢å‡º</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é—®é¢˜ï¼šä¸€æ¬¡æ€§åŠ è½½å¤§é‡æ•°æ®å¯¼è‡´å†…å­˜æº¢å‡º</span></span><br><span class="line"><span class="meta">@Select(&quot;SELECT * FROM large_table&quot;)</span></span><br><span class="line">List&lt;LargeData&gt; <span class="title function_">findAllData</span><span class="params">()</span>; <span class="comment">// å¯èƒ½å¯¼è‡´OOM</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è§£å†³æ–¹æ¡ˆ1ï¼šåˆ†é¡µæŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">public</span> List&lt;LargeData&gt; <span class="title function_">findAllDataWithPaging</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;LargeData&gt; allData = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">int</span> <span class="variable">pageSize</span> <span class="operator">=</span> <span class="number">1000</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">offset</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    List&lt;LargeData&gt; pageData;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        pageData = mapper.findDataWithLimit(offset, pageSize);</span><br><span class="line">        allData.addAll(pageData);</span><br><span class="line">        offset += pageSize;</span><br><span class="line">    &#125; <span class="keyword">while</span> (pageData.size() == pageSize);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> allData;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è§£å†³æ–¹æ¡ˆ2ï¼šä½¿ç”¨æ¸¸æ ‡æŸ¥è¯¢</span></span><br><span class="line"><span class="meta">@Select(&quot;SELECT * FROM large_table WHERE process_status = &#x27;PENDING&#x27;&quot;)</span></span><br><span class="line"><span class="meta">@Options(resultSetType = ResultSetType.FORWARD_ONLY, fetchSize = 1000)</span></span><br><span class="line">Cursor&lt;LargeData&gt; <span class="title function_">findPendingDataCursor</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processLargeData</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> (Cursor&lt;LargeData&gt; cursor = mapper.findPendingDataCursor()) &#123;</span><br><span class="line">        cursor.forEach(<span class="built_in">this</span>::processData);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é—®é¢˜3ï¼šSQLæ³¨å…¥é˜²æŠ¤"><a href="#é—®é¢˜3ï¼šSQLæ³¨å…¥é˜²æŠ¤" class="headerlink" title="é—®é¢˜3ï¼šSQLæ³¨å…¥é˜²æŠ¤"></a>é—®é¢˜3ï¼šSQLæ³¨å…¥é˜²æŠ¤</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å±é™©ï¼šç›´æ¥æ‹¼æ¥SQLï¼Œå®¹æ˜“SQLæ³¨å…¥</span></span><br><span class="line"><span class="meta">@Select(&quot;SELECT * FROM users WHERE name = &#x27;$&#123;name&#125;&#x27;&quot;)</span> <span class="comment">// é”™è¯¯ç¤ºä¾‹</span></span><br><span class="line">List&lt;User&gt; <span class="title function_">findByNameUnsafe</span><span class="params">(<span class="meta">@Param(&quot;name&quot;)</span> String name)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®‰å…¨ï¼šä½¿ç”¨å‚æ•°ç»‘å®š</span></span><br><span class="line"><span class="meta">@Select(&quot;SELECT * FROM users WHERE name = #&#123;name&#125;&quot;)</span></span><br><span class="line">List&lt;User&gt; <span class="title function_">findByNameSafe</span><span class="params">(<span class="meta">@Param(&quot;name&quot;)</span> String name)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŠ¨æ€æ’åºçš„å®‰å…¨å¤„ç†</span></span><br><span class="line"><span class="meta">@SelectProvider(type = UserSqlProvider.class, method = &quot;findUsersWithSort&quot;)</span></span><br><span class="line">List&lt;User&gt; <span class="title function_">findUsersWithSort</span><span class="params">(<span class="meta">@Param(&quot;sortField&quot;)</span> String sortField, </span></span><br><span class="line"><span class="params">                            <span class="meta">@Param(&quot;sortDirection&quot;)</span> String sortDirection)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserSqlProvider</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Set&lt;String&gt; ALLOWED_SORT_FIELDS = </span><br><span class="line">        Set.of(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;email&quot;</span>, <span class="string">&quot;create_time&quot;</span>, <span class="string">&quot;update_time&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">findUsersWithSort</span><span class="params">(Map&lt;String, Object&gt; params)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sortField</span> <span class="operator">=</span> (String) params.get(<span class="string">&quot;sortField&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">sortDirection</span> <span class="operator">=</span> (String) params.get(<span class="string">&quot;sortDirection&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ç™½åå•éªŒè¯</span></span><br><span class="line">        <span class="keyword">if</span> (!ALLOWED_SORT_FIELDS.contains(sortField)) &#123;</span><br><span class="line">            sortField = <span class="string">&quot;id&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!<span class="string">&quot;DESC&quot;</span>.equalsIgnoreCase(sortDirection)) &#123;</span><br><span class="line">            sortDirection = <span class="string">&quot;ASC&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;SELECT * FROM users ORDER BY &quot;</span> + sortField + <span class="string">&quot; &quot;</span> + sortDirection;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-8-MyBatisé¢è¯•é«˜é¢‘é—®é¢˜"><a href="#4-8-MyBatisé¢è¯•é«˜é¢‘é—®é¢˜" class="headerlink" title="4.8 MyBatisé¢è¯•é«˜é¢‘é—®é¢˜"></a>4.8 MyBatisé¢è¯•é«˜é¢‘é—®é¢˜</h3><p><strong>Q1: MyBatisçš„æ‰§è¡Œæµç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ</strong></p><p>A: MyBatisçš„æ‰§è¡Œæµç¨‹åŒ…æ‹¬ä»¥ä¸‹æ­¥éª¤ï¼š</p><ol><li><strong>é…ç½®è§£æ</strong>: è§£æmybatis-config.xmlé…ç½®æ–‡ä»¶å’ŒMapper XMLæ–‡ä»¶ï¼Œåˆ›å»ºConfigurationå¯¹è±¡</li><li><strong>SqlSessionFactoryåˆ›å»º</strong>: æ ¹æ®Configurationåˆ›å»ºSqlSessionFactory</li><li><strong>SqlSessionåˆ›å»º</strong>: é€šè¿‡SqlSessionFactory.openSession()åˆ›å»ºSqlSession</li><li><strong>Mapperè·å–</strong>: é€šè¿‡SqlSession.getMapper()è·å–Mapperæ¥å£çš„ä»£ç†å¯¹è±¡</li><li><strong>æ–¹æ³•è°ƒç”¨</strong>: è°ƒç”¨Mapperæ¥å£æ–¹æ³•ï¼Œé€šè¿‡åŠ¨æ€ä»£ç†è½¬æ¢ä¸ºSQLæ‰§è¡Œ</li><li><strong>SQLæ‰§è¡Œ</strong>: é€šè¿‡Executoræ‰§è¡ŒSQLï¼ŒåŒ…æ‹¬å‚æ•°å¤„ç†ã€è¯­å¥æ‰§è¡Œã€ç»“æœæ˜ å°„</li><li><strong>ç»“æœè¿”å›</strong>: å°†æ‰§è¡Œç»“æœè¿”å›ç»™è°ƒç”¨æ–¹</li></ol><p><strong>Q2: MyBatisçš„ä¸€çº§ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></p><p>A: ä¸¤çº§ç¼“å­˜çš„ä¸»è¦åŒºåˆ«ï¼š</p><p><strong>ä¸€çº§ç¼“å­˜ï¼ˆé»˜è®¤å¼€å¯ï¼‰ï¼š</strong></p><ul><li>ä½œç”¨åŸŸï¼šSqlSessionçº§åˆ«</li><li>ç”Ÿå‘½å‘¨æœŸï¼šä¸SqlSessionç›¸åŒï¼ŒSqlSessionå…³é—­æ—¶ç¼“å­˜æ¸…ç©º</li><li>å­˜å‚¨ç»“æ„ï¼šHashMapï¼Œkeyä¸ºCacheKeyï¼ˆç”±SQLã€å‚æ•°ã€åˆ†é¡µç­‰ç»„æˆï¼‰</li><li>å¤±æ•ˆæ¡ä»¶ï¼šæ‰§è¡Œupdateã€insertã€deleteæ“ä½œæˆ–æ‰‹åŠ¨æ¸…ç©º</li></ul><p><strong>äºŒçº§ç¼“å­˜ï¼ˆéœ€è¦é…ç½®ï¼‰ï¼š</strong></p><ul><li>ä½œç”¨åŸŸï¼šMapperçº§åˆ«ï¼Œå¤šä¸ªSqlSessionå¯ä»¥å…±äº«</li><li>ç”Ÿå‘½å‘¨æœŸï¼šä¸åº”ç”¨ç¨‹åºç›¸åŒ</li><li>å­˜å‚¨ç»“æ„ï¼šå¯é…ç½®ï¼ˆHashMapã€LRUã€FIFOç­‰ï¼‰</li><li>é…ç½®æ–¹å¼ï¼š@CacheNamespaceæ³¨è§£æˆ–<cache>æ ‡ç­¾</li><li>æ³¨æ„äº‹é¡¹ï¼šéœ€è¦åºåˆ—åŒ–ï¼Œå¯èƒ½å­˜åœ¨è„è¯»é—®é¢˜</li></ul><p><strong>Q3: MyBatiså¦‚ä½•é˜²æ­¢SQLæ³¨å…¥ï¼Ÿ</strong></p><p>A: MyBatisé€šè¿‡ä»¥ä¸‹æ–¹å¼é˜²æ­¢SQLæ³¨å…¥ï¼š</p><ol><li><strong>å‚æ•°ç»‘å®š</strong>: ä½¿ç”¨#{}è€Œä¸æ˜¯${}<ul><li>#{}ï¼šé¢„ç¼–è¯‘å¤„ç†ï¼Œå‚æ•°ä½œä¸ºå ä½ç¬¦ä¼ é€’</li><li>${}ï¼šå­—ç¬¦ä¸²æ›¿æ¢ï¼Œç›´æ¥æ‹¼æ¥åˆ°SQLä¸­ï¼ˆå±é™©ï¼‰</li></ul></li><li><strong>ç±»å‹æ£€æŸ¥</strong>: MyBatisä¼šå¯¹å‚æ•°ç±»å‹è¿›è¡Œæ£€æŸ¥</li><li><strong>ç™½åå•éªŒè¯</strong>: å¯¹äºåŠ¨æ€æ’åºç­‰åœºæ™¯ï¼Œä½¿ç”¨ç™½åå•éªŒè¯</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®‰å…¨çš„å†™æ³•</span></span><br><span class="line"><span class="meta">@Select(&quot;SELECT * FROM users WHERE name = #&#123;name&#125; AND age &gt; #&#123;age&#125;&quot;)</span></span><br><span class="line">List&lt;User&gt; <span class="title function_">findUsers</span><span class="params">(<span class="meta">@Param(&quot;name&quot;)</span> String name, <span class="meta">@Param(&quot;age&quot;)</span> Integer age)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å±é™©çš„å†™æ³•ï¼ˆé¿å…ä½¿ç”¨ï¼‰</span></span><br><span class="line"><span class="meta">@Select(&quot;SELECT * FROM users WHERE name = &#x27;$&#123;name&#125;&#x27;&quot;)</span></span><br><span class="line">List&lt;User&gt; <span class="title function_">findUsersUnsafe</span><span class="params">(<span class="meta">@Param(&quot;name&quot;)</span> String name)</span>;</span><br></pre></td></tr></table></figure><p><strong>Q4: MyBatisä¸­#{}å’Œ${}çš„åŒºåˆ«ï¼Ÿ</strong></p><p>A: ä¸¤è€…çš„ä¸»è¦åŒºåˆ«ï¼š</p><p><strong>#{}ï¼ˆæ¨èä½¿ç”¨ï¼‰ï¼š</strong></p><ul><li>é¢„ç¼–è¯‘å¤„ç†ï¼Œç”ŸæˆPreparedStatement</li><li>å‚æ•°ä¼šè¢«å¤„ç†ä¸ºå ä½ç¬¦?</li><li>å¯ä»¥é˜²æ­¢SQLæ³¨å…¥</li><li>ä¼šè¿›è¡Œç±»å‹è½¬æ¢</li><li>é€‚ç”¨äºå‚æ•°å€¼ä¼ é€’</li></ul><p><strong>${}ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰ï¼š</strong></p><ul><li>å­—ç¬¦ä¸²æ›¿æ¢ï¼Œç›´æ¥æ‹¼æ¥åˆ°SQLä¸­</li><li>ä¸ä¼šè¿›è¡Œé¢„ç¼–è¯‘</li><li>å­˜åœ¨SQLæ³¨å…¥é£é™©</li><li>ä¸ä¼šè¿›è¡Œç±»å‹è½¬æ¢</li><li>é€‚ç”¨äºåŠ¨æ€è¡¨åã€åˆ—åç­‰åœºæ™¯</li></ul><p><strong>Q5: MyBatisçš„åŠ¨æ€SQLæ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</strong></p><p>A: MyBatisçš„åŠ¨æ€SQLé€šè¿‡ä»¥ä¸‹æ ‡ç­¾å®ç°ï¼š</p><ol><li><strong>ifæ ‡ç­¾</strong>: æ¡ä»¶åˆ¤æ–­</li><li><strong>choose&#x2F;when&#x2F;otherwise</strong>: ç±»ä¼¼switch-case</li><li><strong>whereæ ‡ç­¾</strong>: æ™ºèƒ½å¤„ç†WHEREæ¡ä»¶</li><li><strong>setæ ‡ç­¾</strong>: æ™ºèƒ½å¤„ç†SETè¯­å¥</li><li><strong>foreachæ ‡ç­¾</strong>: å¾ªç¯å¤„ç†</li><li><strong>trimæ ‡ç­¾</strong>: å»é™¤å¤šä½™çš„å­—ç¬¦</li></ol><p>å®ç°åŸç†ï¼š</p><ul><li>ä½¿ç”¨OGNLè¡¨è¾¾å¼è¿›è¡Œæ¡ä»¶åˆ¤æ–­</li><li>åœ¨SQLè§£æé˜¶æ®µæ ¹æ®å‚æ•°å€¼åŠ¨æ€ç”ŸæˆSQL</li><li>é€šè¿‡SqlNodeæ ‘ç»“æ„è¡¨ç¤ºåŠ¨æ€SQL</li><li>åœ¨æ‰§è¡Œæ—¶éå†SqlNodeæ ‘ç”Ÿæˆæœ€ç»ˆSQL</li></ul><h2 id="äº”ã€æ¡†æ¶æ•´åˆä¸æœ€ä½³å®è·µ"><a href="#äº”ã€æ¡†æ¶æ•´åˆä¸æœ€ä½³å®è·µ" class="headerlink" title="äº”ã€æ¡†æ¶æ•´åˆä¸æœ€ä½³å®è·µ"></a>äº”ã€æ¡†æ¶æ•´åˆä¸æœ€ä½³å®è·µ</h2><h3 id="5-1-Spring-Boot-MyBatisæ•´åˆ"><a href="#5-1-Spring-Boot-MyBatisæ•´åˆ" class="headerlink" title="5.1 Spring Boot + MyBatisæ•´åˆ"></a>5.1 Spring Boot + MyBatisæ•´åˆ</h3><h4 id="å®Œæ•´é…ç½®ç¤ºä¾‹"><a href="#å®Œæ•´é…ç½®ç¤ºä¾‹" class="headerlink" title="å®Œæ•´é…ç½®ç¤ºä¾‹"></a>å®Œæ•´é…ç½®ç¤ºä¾‹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸»å¯åŠ¨ç±»</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.example.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ•°æ®æºé…ç½®</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(&quot;spring.datasource.primary&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DataSourceProperties <span class="title function_">primaryDataSourceProperties</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DataSourceProperties</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">primaryDataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> primaryDataSourceProperties()</span><br><span class="line">                .initializeDataSourceBuilder()</span><br><span class="line">                .type(HikariDataSource.class)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SqlSessionFactory <span class="title function_">sqlSessionFactory</span><span class="params">(DataSource dataSource)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">SqlSessionFactoryBean</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBean</span>();</span><br><span class="line">        factory.setDataSource(dataSource);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// MyBatisé…ç½®</span></span><br><span class="line">        org.apache.ibatis.session.<span class="type">Configuration</span> <span class="variable">config</span> <span class="operator">=</span> </span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">org</span>.apache.ibatis.session.Configuration();</span><br><span class="line">        config.setMapUnderscoreToCamelCase(<span class="literal">true</span>);</span><br><span class="line">        config.setLogImpl(Slf4jImpl.class);</span><br><span class="line">        config.setCacheEnabled(<span class="literal">true</span>);</span><br><span class="line">        config.setLazyLoadingEnabled(<span class="literal">true</span>);</span><br><span class="line">        config.setAggressiveLazyLoading(<span class="literal">false</span>);</span><br><span class="line">        </span><br><span class="line">        factory.setConfiguration(config);</span><br><span class="line">        <span class="keyword">return</span> factory.getObject();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="äº‹åŠ¡ç®¡ç†é…ç½®"><a href="#äº‹åŠ¡ç®¡ç†é…ç½®" class="headerlink" title="äº‹åŠ¡ç®¡ç†é…ç½®"></a>äº‹åŠ¡ç®¡ç†é…ç½®</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderMapper orderMapper;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderItemMapper orderItemMapper;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ProductMapper productMapper;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> Order <span class="title function_">createOrder</span><span class="params">(CreateOrderRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. åˆ›å»ºè®¢å•</span></span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Order</span>();</span><br><span class="line">        order.setUserId(request.getUserId());</span><br><span class="line">        order.setStatus(<span class="string">&quot;PENDING&quot;</span>);</span><br><span class="line">        order.setCreateTime(LocalDateTime.now());</span><br><span class="line">        orderMapper.insert(order);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. åˆ›å»ºè®¢å•é¡¹</span></span><br><span class="line">        <span class="type">BigDecimal</span> <span class="variable">totalAmount</span> <span class="operator">=</span> BigDecimal.ZERO;</span><br><span class="line">        List&lt;OrderItem&gt; orderItems = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (CreateOrderItemRequest itemRequest : request.getItems()) &#123;</span><br><span class="line">            <span class="comment">// æ£€æŸ¥åº“å­˜</span></span><br><span class="line">            <span class="type">Product</span> <span class="variable">product</span> <span class="operator">=</span> productMapper.findById(itemRequest.getProductId());</span><br><span class="line">            <span class="keyword">if</span> (product == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ProductNotFoundException</span>(<span class="string">&quot;Product not found: &quot;</span> + itemRequest.getProductId());</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (product.getStock() &lt; itemRequest.getQuantity()) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InsufficientStockException</span>(<span class="string">&quot;Insufficient stock for product: &quot;</span> + product.getName());</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// å‡åº“å­˜</span></span><br><span class="line">            productMapper.decreaseStock(itemRequest.getProductId(), itemRequest.getQuantity());</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// åˆ›å»ºè®¢å•é¡¹</span></span><br><span class="line">            <span class="type">OrderItem</span> <span class="variable">orderItem</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderItem</span>();</span><br><span class="line">            orderItem.setOrderId(order.getId());</span><br><span class="line">            orderItem.setProductId(itemRequest.getProductId());</span><br><span class="line">            orderItem.setQuantity(itemRequest.getQuantity());</span><br><span class="line">            orderItem.setPrice(product.getPrice());</span><br><span class="line">            orderItems.add(orderItem);</span><br><span class="line">            </span><br><span class="line">            totalAmount = totalAmount.add(</span><br><span class="line">                product.getPrice().multiply(BigDecimal.valueOf(itemRequest.getQuantity()))</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. æ‰¹é‡æ’å…¥è®¢å•é¡¹</span></span><br><span class="line">        <span class="keyword">if</span> (!orderItems.isEmpty()) &#123;</span><br><span class="line">            orderItemMapper.batchInsert(orderItems);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 4. æ›´æ–°è®¢å•æ€»é‡‘é¢</span></span><br><span class="line">        order.setTotalAmount(totalAmount);</span><br><span class="line">        orderMapper.updateAmount(order.getId(), totalAmount);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> order;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Transactional(readOnly = true)</span></span><br><span class="line">    <span class="keyword">public</span> OrderDetailVO <span class="title function_">getOrderDetail</span><span class="params">(Long orderId)</span> &#123;</span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> orderMapper.findById(orderId);</span><br><span class="line">        <span class="keyword">if</span> (order == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OrderNotFoundException</span>(<span class="string">&quot;Order not found: &quot;</span> + orderId);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        List&lt;OrderItem&gt; orderItems = orderItemMapper.findByOrderId(orderId);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> OrderDetailVO.builder()</span><br><span class="line">                .order(order)</span><br><span class="line">                .items(orderItems)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-2-ç»Ÿä¸€å¼‚å¸¸å¤„ç†"><a href="#5-2-ç»Ÿä¸€å¼‚å¸¸å¤„ç†" class="headerlink" title="5.2 ç»Ÿä¸€å¼‚å¸¸å¤„ç†"></a>5.2 ç»Ÿä¸€å¼‚å¸¸å¤„ç†</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ExceptionHandler(ValidationException.class)</span></span><br><span class="line">    <span class="meta">@ResponseStatus(HttpStatus.BAD_REQUEST)</span></span><br><span class="line">    <span class="keyword">public</span> ApiResponse&lt;Void&gt; <span class="title function_">handleValidationException</span><span class="params">(ValidationException e)</span> &#123;</span><br><span class="line">        log.warn(<span class="string">&quot;Validation error: &#123;&#125;&quot;</span>, e.getMessage());</span><br><span class="line">        <span class="keyword">return</span> ApiResponse.error(<span class="string">&quot;VALIDATION_ERROR&quot;</span>, e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ExceptionHandler(MethodArgumentNotValidException.class)</span></span><br><span class="line">    <span class="meta">@ResponseStatus(HttpStatus.BAD_REQUEST)</span></span><br><span class="line">    <span class="keyword">public</span> ApiResponse&lt;Void&gt; <span class="title function_">handleMethodArgumentNotValid</span><span class="params">(MethodArgumentNotValidException e)</span> &#123;</span><br><span class="line">        List&lt;String&gt; errors = e.getBindingResult()</span><br><span class="line">                .getFieldErrors()</span><br><span class="line">                .stream()</span><br><span class="line">                .map(error -&gt; error.getField() + <span class="string">&quot;: &quot;</span> + error.getDefaultMessage())</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ApiResponse.error(<span class="string">&quot;VALIDATION_ERROR&quot;</span>, String.join(<span class="string">&quot;, &quot;</span>, errors));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ExceptionHandler(DataIntegrityViolationException.class)</span></span><br><span class="line">    <span class="meta">@ResponseStatus(HttpStatus.CONFLICT)</span></span><br><span class="line">    <span class="keyword">public</span> ApiResponse&lt;Void&gt; <span class="title function_">handleDataIntegrityViolation</span><span class="params">(DataIntegrityViolationException e)</span> &#123;</span><br><span class="line">        log.error(<span class="string">&quot;Data integrity violation&quot;</span>, e);</span><br><span class="line">        <span class="keyword">return</span> ApiResponse.error(<span class="string">&quot;DATA_CONFLICT&quot;</span>, <span class="string">&quot;Data conflict occurred&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ExceptionHandler(OptimisticLockingFailureException.class)</span></span><br><span class="line">    <span class="meta">@ResponseStatus(HttpStatus.CONFLICT)</span></span><br><span class="line">    <span class="keyword">public</span> ApiResponse&lt;Void&gt; <span class="title function_">handleOptimisticLockingFailure</span><span class="params">(OptimisticLockingFailureException e)</span> &#123;</span><br><span class="line">        log.warn(<span class="string">&quot;Optimistic locking failure: &#123;&#125;&quot;</span>, e.getMessage());</span><br><span class="line">        <span class="keyword">return</span> ApiResponse.error(<span class="string">&quot;OPTIMISTIC_LOCK_ERROR&quot;</span>, <span class="string">&quot;Resource has been modified by another user&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line">    <span class="meta">@ResponseStatus(HttpStatus.INTERNAL_SERVER_ERROR)</span></span><br><span class="line">    <span class="keyword">public</span> ApiResponse&lt;Void&gt; <span class="title function_">handleGenericException</span><span class="params">(Exception e)</span> &#123;</span><br><span class="line">        log.error(<span class="string">&quot;Unexpected error occurred&quot;</span>, e);</span><br><span class="line">        <span class="keyword">return</span> ApiResponse.error(<span class="string">&quot;INTERNAL_ERROR&quot;</span>, <span class="string">&quot;An unexpected error occurred&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-3-æ¥å£æ–‡æ¡£ä¸éªŒè¯"><a href="#5-3-æ¥å£æ–‡æ¡£ä¸éªŒè¯" class="headerlink" title="5.3 æ¥å£æ–‡æ¡£ä¸éªŒè¯"></a>5.3 æ¥å£æ–‡æ¡£ä¸éªŒè¯</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç»Ÿä¸€å“åº”æ ¼å¼</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApiResponse</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> success;</span><br><span class="line">    <span class="keyword">private</span> String code;</span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line">    <span class="keyword">private</span> T data;</span><br><span class="line">    <span class="keyword">private</span> Long timestamp;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; ApiResponse&lt;T&gt; <span class="title function_">success</span><span class="params">(T data)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ApiResponse.&lt;T&gt;builder()</span><br><span class="line">                .success(<span class="literal">true</span>)</span><br><span class="line">                .code(<span class="string">&quot;SUCCESS&quot;</span>)</span><br><span class="line">                .data(data)</span><br><span class="line">                .timestamp(System.currentTimeMillis())</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; ApiResponse&lt;T&gt; <span class="title function_">error</span><span class="params">(String code, String message)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ApiResponse.&lt;T&gt;builder()</span><br><span class="line">                .success(<span class="literal">false</span>)</span><br><span class="line">                .code(code)</span><br><span class="line">                .message(message)</span><br><span class="line">                .timestamp(System.currentTimeMillis())</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯·æ±‚å‚æ•°éªŒè¯</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Valid</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CreateUserRequest</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;ç”¨æˆ·åä¸èƒ½ä¸ºç©º&quot;)</span></span><br><span class="line">    <span class="meta">@Size(min = 2, max = 20, message = &quot;ç”¨æˆ·åé•¿åº¦å¿…é¡»åœ¨2-20ä¸ªå­—ç¬¦ä¹‹é—´&quot;)</span></span><br><span class="line">    <span class="meta">@Pattern(regexp = &quot;^[a-zA-Z0-9_\\u4e00-\\u9fa5]+$&quot;, message = &quot;ç”¨æˆ·ååªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿å’Œä¸­æ–‡&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;é‚®ç®±ä¸èƒ½ä¸ºç©º&quot;)</span></span><br><span class="line">    <span class="meta">@Email(message = &quot;é‚®ç®±æ ¼å¼ä¸æ­£ç¡®&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;å¯†ç ä¸èƒ½ä¸ºç©º&quot;)</span></span><br><span class="line">    <span class="meta">@Size(min = 8, max = 20, message = &quot;å¯†ç é•¿åº¦å¿…é¡»åœ¨8-20ä¸ªå­—ç¬¦ä¹‹é—´&quot;)</span></span><br><span class="line">    <span class="meta">@Pattern(</span></span><br><span class="line"><span class="meta">        regexp = &quot;^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[@$!%*?&amp;])[A-Za-z\\d@$!%*?&amp;]+$&quot;,</span></span><br><span class="line"><span class="meta">        message = &quot;å¯†ç å¿…é¡»åŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šå­—ç¬¦&quot;</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotNull(message = &quot;å¹´é¾„ä¸èƒ½ä¸ºç©º&quot;)</span></span><br><span class="line">    <span class="meta">@Min(value = 1, message = &quot;å¹´é¾„å¿…é¡»å¤§äº0&quot;)</span></span><br><span class="line">    <span class="meta">@Max(value = 150, message = &quot;å¹´é¾„ä¸èƒ½è¶…è¿‡150&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotEmpty(message = &quot;è§’è‰²ä¸èƒ½ä¸ºç©º&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;<span class="meta">@NotBlank(message = &quot;è§’è‰²åç§°ä¸èƒ½ä¸ºç©º&quot;)</span> String&gt; roles;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-4-æ€§èƒ½ç›‘æ§ä¸ä¼˜åŒ–"><a href="#5-4-æ€§èƒ½ç›‘æ§ä¸ä¼˜åŒ–" class="headerlink" title="5.4 æ€§èƒ½ç›‘æ§ä¸ä¼˜åŒ–"></a>5.4 æ€§èƒ½ç›‘æ§ä¸ä¼˜åŒ–</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ€§èƒ½ç›‘æ§åˆ‡é¢</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PerformanceMonitorAspect</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Around(&quot;@annotation(org.springframework.web.bind.annotation.RequestMapping) || &quot; +</span></span><br><span class="line"><span class="meta">            &quot;@annotation(org.springframework.web.bind.annotation.GetMapping) || &quot; +</span></span><br><span class="line"><span class="meta">            &quot;@annotation(org.springframework.web.bind.annotation.PostMapping) || &quot; +</span></span><br><span class="line"><span class="meta">            &quot;@annotation(org.springframework.web.bind.annotation.PutMapping) || &quot; +</span></span><br><span class="line"><span class="meta">            &quot;@annotation(org.springframework.web.bind.annotation.DeleteMapping)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">monitorPerformance</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> joinPoint.getSignature().toShortString();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> joinPoint.proceed();</span><br><span class="line">            <span class="type">long</span> <span class="variable">endTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">            <span class="type">long</span> <span class="variable">executionTime</span> <span class="operator">=</span> endTime - startTime;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (executionTime &gt; <span class="number">1000</span>) &#123; <span class="comment">// è¶…è¿‡1ç§’è®°å½•è­¦å‘Š</span></span><br><span class="line">                log.warn(<span class="string">&quot;Slow API detected: &#123;&#125; took &#123;&#125;ms&quot;</span>, methodName, executionTime);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                log.info(<span class="string">&quot;API performance: &#123;&#125; took &#123;&#125;ms&quot;</span>, methodName, executionTime);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">endTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">            log.error(<span class="string">&quot;API error: &#123;&#125; took &#123;&#125;ms, error: &#123;&#125;&quot;</span>, </span><br><span class="line">                     methodName, endTime - startTime, e.getMessage());</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ•°æ®åº“è¿æ¥æ± ç›‘æ§</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceHealthIndicator</span> <span class="keyword">implements</span> <span class="title class_">HealthIndicator</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DataSource dataSource;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Health <span class="title function_">health</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (dataSource <span class="keyword">instanceof</span> HikariDataSource) &#123;</span><br><span class="line">                <span class="type">HikariDataSource</span> <span class="variable">hikariDataSource</span> <span class="operator">=</span> (HikariDataSource) dataSource;</span><br><span class="line">                <span class="type">HikariPoolMXBean</span> <span class="variable">poolBean</span> <span class="operator">=</span> hikariDataSource.getHikariPoolMXBean();</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">return</span> Health.up()</span><br><span class="line">                        .withDetail(<span class="string">&quot;database&quot;</span>, <span class="string">&quot;MySQL&quot;</span>)</span><br><span class="line">                        .withDetail(<span class="string">&quot;activeConnections&quot;</span>, poolBean.getActiveConnections())</span><br><span class="line">                        .withDetail(<span class="string">&quot;idleConnections&quot;</span>, poolBean.getIdleConnections())</span><br><span class="line">                        .withDetail(<span class="string">&quot;totalConnections&quot;</span>, poolBean.getTotalConnections())</span><br><span class="line">                        .withDetail(<span class="string">&quot;threadsAwaitingConnection&quot;</span>, poolBean.getThreadsAwaitingConnection())</span><br><span class="line">                        .build();</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">try</span> (<span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> dataSource.getConnection()) &#123;</span><br><span class="line">                <span class="keyword">return</span> Health.up()</span><br><span class="line">                        .withDetail(<span class="string">&quot;database&quot;</span>, connection.getMetaData().getDatabaseProductName())</span><br><span class="line">                        .build();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> Health.down()</span><br><span class="line">                    .withDetail(<span class="string">&quot;error&quot;</span>, e.getMessage())</span><br><span class="line">                    .build();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-5-é«˜é¢‘é¢è¯•ç»¼åˆé¢˜"><a href="#5-5-é«˜é¢‘é¢è¯•ç»¼åˆé¢˜" class="headerlink" title="5.5 é«˜é¢‘é¢è¯•ç»¼åˆé¢˜"></a>5.5 é«˜é¢‘é¢è¯•ç»¼åˆé¢˜</h3><p><strong>Q1: åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œå¦‚ä½•è®¾è®¡ä¸€ä¸ªé«˜å¹¶å‘çš„è®¢å•ç³»ç»Ÿï¼Ÿ</strong></p><p>A: è®¾è®¡é«˜å¹¶å‘è®¢å•ç³»ç»Ÿéœ€è¦è€ƒè™‘ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p><p><strong>1. æ¶æ„è®¾è®¡ï¼š</strong></p><ul><li>ä½¿ç”¨åˆ†å¸ƒå¼æ¶æ„ï¼Œè®¢å•æœåŠ¡ã€åº“å­˜æœåŠ¡ã€æ”¯ä»˜æœåŠ¡åˆ†ç¦»</li><li>å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—å¤„ç†å¼‚æ­¥ä»»åŠ¡</li><li>ä½¿ç”¨Redisåšç¼“å­˜å’Œåˆ†å¸ƒå¼é”</li><li>æ•°æ®åº“è¯»å†™åˆ†ç¦»ï¼Œåˆ†åº“åˆ†è¡¨</li></ul><p><strong>2. å¹¶å‘æ§åˆ¶ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, String&gt; redisTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> Order <span class="title function_">createOrder</span><span class="params">(CreateOrderRequest request)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">lockKey</span> <span class="operator">=</span> <span class="string">&quot;order:lock:&quot;</span> + request.getUserId();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// åˆ†å¸ƒå¼é”é˜²æ­¢é‡å¤ä¸‹å•</span></span><br><span class="line">        <span class="type">Boolean</span> <span class="variable">locked</span> <span class="operator">=</span> redisTemplate.opsForValue()</span><br><span class="line">            .setIfAbsent(lockKey, <span class="string">&quot;1&quot;</span>, Duration.ofSeconds(<span class="number">30</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!locked) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OrderCreationException</span>(<span class="string">&quot;Order creation in progress&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// è®¢å•åˆ›å»ºé€»è¾‘</span></span><br><span class="line">            <span class="keyword">return</span> processOrder(request);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            redisTemplate.delete(lockKey);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>3. æ€§èƒ½ä¼˜åŒ–ï¼š</strong></p><ul><li>ä½¿ç”¨æ‰¹é‡æ“ä½œå‡å°‘æ•°æ®åº“äº¤äº’</li><li>åˆç†ä½¿ç”¨ç¼“å­˜ç­–ç•¥</li><li>å¼‚æ­¥å¤„ç†éæ ¸å¿ƒä¸šåŠ¡é€»è¾‘</li><li>æ•°æ®åº“è¿æ¥æ± ä¼˜åŒ–</li></ul><p><strong>Q2: å¦‚ä½•å¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡ï¼Ÿ</strong></p><p>A: åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†æ–¹æ¡ˆï¼š</p><p><strong>1. 2PC&#x2F;3PCåè®®ï¼š</strong></p><ul><li>å¼ºä¸€è‡´æ€§ï¼Œä½†æ€§èƒ½è¾ƒå·®</li><li>é€‚ç”¨äºå¯¹ä¸€è‡´æ€§è¦æ±‚æé«˜çš„åœºæ™¯</li></ul><p><strong>2. TCCæ¨¡å¼ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TccTransaction</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderTccService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">tryCreateOrder</span><span class="params">(CreateOrderRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// Tryé˜¶æ®µï¼šé¢„ç•™èµ„æº</span></span><br><span class="line">        orderService.reserveOrder(request);</span><br><span class="line">        stockService.reserveStock(request.getItems());</span><br><span class="line">        paymentService.reservePayment(request.getPaymentInfo());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">confirmCreateOrder</span><span class="params">(CreateOrderRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// Confirmé˜¶æ®µï¼šç¡®è®¤æ“ä½œ</span></span><br><span class="line">        orderService.confirmOrder(request);</span><br><span class="line">        stockService.confirmStock(request.getItems());</span><br><span class="line">        paymentService.confirmPayment(request.getPaymentInfo());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cancelCreateOrder</span><span class="params">(CreateOrderRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// Cancelé˜¶æ®µï¼šå›æ»šæ“ä½œ</span></span><br><span class="line">        orderService.cancelOrder(request);</span><br><span class="line">        stockService.cancelStock(request.getItems());</span><br><span class="line">        paymentService.cancelPayment(request.getPaymentInfo());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>3. æ¶ˆæ¯é˜Ÿåˆ—æœ€ç»ˆä¸€è‡´æ€§ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderEventService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="meta">@Async</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleOrderCreated</span><span class="params">(OrderCreatedEvent event)</span> &#123;</span><br><span class="line">        <span class="comment">// å¼‚æ­¥å¤„ç†è®¢å•ç›¸å…³ä¸šåŠ¡</span></span><br><span class="line">        notificationService.sendOrderNotification(event.getOrder());</span><br><span class="line">        inventoryService.updateInventory(event.getOrderItems());</span><br><span class="line">        pointsService.addPoints(event.getUserId(), event.getAmount());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Q3: Spring Bootåº”ç”¨å¦‚ä½•ä¼˜åŒ–å¯åŠ¨é€Ÿåº¦ï¼Ÿ</strong></p><p>A: Spring Bootå¯åŠ¨ä¼˜åŒ–ç­–ç•¥ï¼š</p><p><strong>1. ä¾èµ–ä¼˜åŒ–ï¼š</strong></p><ul><li>ç§»é™¤ä¸å¿…è¦çš„ä¾èµ–</li><li>ä½¿ç”¨spring-boot-starter-webæ›¿ä»£å®Œæ•´çš„spring-web</li><li>é¿å…å¼•å…¥å¤§é‡è‡ªåŠ¨é…ç½®ç±»</li></ul><p><strong>2. é…ç½®ä¼˜åŒ–ï¼š</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">main:</span></span><br><span class="line">    <span class="attr">lazy-initialization:</span> <span class="literal">true</span>  <span class="comment"># å¯ç”¨æ‡’åŠ è½½</span></span><br><span class="line">  <span class="attr">jpa:</span></span><br><span class="line">    <span class="attr">hibernate:</span></span><br><span class="line">      <span class="attr">ddl-auto:</span> <span class="string">none</span>           <span class="comment"># ç¦ç”¨DDLè‡ªåŠ¨ç”Ÿæˆ</span></span><br><span class="line">    <span class="attr">show-sql:</span> <span class="literal">false</span>            <span class="comment"># ç¦ç”¨SQLæ—¥å¿—</span></span><br><span class="line">  <span class="attr">devtools:</span></span><br><span class="line">    <span class="attr">restart:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">false</span>           <span class="comment"># ç”Ÿäº§ç¯å¢ƒç¦ç”¨çƒ­é‡å¯</span></span><br></pre></td></tr></table></figure><p><strong>3. JVMä¼˜åŒ–ï¼š</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">java -XX:+UnlockExperimentalVMOptions </span><br><span class="line">     -XX:+UseZGC </span><br><span class="line">     -XX:+UseTransparentHugePages</span><br><span class="line">     -XX:MaxMetaspaceSize=256m</span><br><span class="line">     -Xms512m -Xmx1024m</span><br><span class="line">     -jar application.jar</span><br></pre></td></tr></table></figure><p><strong>4. ä»£ç ä¼˜åŒ–ï¼š</strong></p><ul><li>ä½¿ç”¨@Lazyæ³¨è§£å»¶è¿ŸBeanåˆå§‹åŒ–</li><li>é¿å…åœ¨@PostConstructä¸­æ‰§è¡Œè€—æ—¶æ“ä½œ</li><li>åˆç†ä½¿ç”¨@ConditionalOn*æ³¨è§£</li></ul><p>å¥½çš„ï¼Œè¿™æ˜¯ä¸€ä»½è¯¦ç»†çš„è§£é‡Šï¼Œæˆ‘ä»¬æ¥é€ä¸ªåˆ†æè¿™äº› Java è™šæ‹Ÿæœºï¼ˆJVMï¼‰å‚æ•°ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">java -XX:+UnlockExperimentalVMOptions -XX:+UseZGC -XX:+UseTransparentHugePages -XX:MaxMetaspaceSize=256m -Xms512m -Xmx1024m -jar application.jar</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><code>java</code>: è¿™æ˜¯å¯åŠ¨ Java ç¨‹åºçš„å‘½ä»¤ã€‚</li></ul><hr><h3 id="å†…å­˜ç®¡ç†å’Œåƒåœ¾å›æ”¶"><a href="#å†…å­˜ç®¡ç†å’Œåƒåœ¾å›æ”¶" class="headerlink" title="å†…å­˜ç®¡ç†å’Œåƒåœ¾å›æ”¶"></a>å†…å­˜ç®¡ç†å’Œåƒåœ¾å›æ”¶</h3><p>è¿™éƒ¨åˆ†å‚æ•°ä¸»è¦ç”¨äºä¼˜åŒ– JVM çš„å†…å­˜ä½¿ç”¨å’Œåƒåœ¾å›æ”¶æœºåˆ¶ï¼Œä»¥è·å¾—æ›´å¥½çš„æ€§èƒ½ã€‚</p><ul><li><code>-XX:+UnlockExperimentalVMOptions</code>: è¿™ä¸ªå‚æ•°æ˜¯ç”¨æ¥<strong>è§£é”å®éªŒæ€§ï¼ˆexperimentalï¼‰çš„ JVM é€‰é¡¹</strong>ã€‚ZGC æ›¾ç»æ˜¯å®éªŒæ€§åŠŸèƒ½ï¼Œæ‰€ä»¥éœ€è¦è¿™ä¸ªå‚æ•°æ‰èƒ½ä½¿ç”¨ã€‚</li><li><code>-XX:+UseZGC</code>: è¿™æ¡å‘½ä»¤æ˜¯å¯ç”¨ <strong>Z åƒåœ¾å›æ”¶å™¨ï¼ˆZ Garbage Collectorï¼‰</strong>ã€‚ZGC æ˜¯ä¸€ç§ä¸º<strong>è¶…å¤§å †å†…å­˜</strong>ï¼ˆä»å‡ GBåˆ°å‡ åTBï¼‰è®¾è®¡çš„ã€<strong>ä½å»¶è¿Ÿ</strong>çš„åƒåœ¾å›æ”¶å™¨ã€‚å®ƒçš„ä¸»è¦ç›®æ ‡æ˜¯åœ¨åƒåœ¾å›æ”¶æ—¶ï¼Œå°½é‡å‡å°‘åº”ç”¨ç¨‹åºçš„åœé¡¿æ—¶é—´ï¼Œè¿™å¯¹äºéœ€è¦æä½å»¶è¿Ÿçš„åº”ç”¨ç¨‹åºéå¸¸é‡è¦ã€‚</li><li><code>-XX:+UseTransparentHugePages</code>: è¿™ä¸ªå‚æ•°å¼€å¯äº†<strong>é€æ˜å¤§é¡µï¼ˆTransparent Huge Pagesï¼‰çš„æ”¯æŒã€‚åœ¨æ“ä½œç³»ç»Ÿå±‚é¢ï¼Œé€šå¸¸å†…å­˜æ˜¯ä»¥ 4KB çš„å°é¡µæ¥ç®¡ç†çš„ã€‚è€Œå¤§é¡µï¼ˆé€šå¸¸æ˜¯ 2MB æˆ– 1GBï¼‰å¯ä»¥å‡å°‘ CPU åœ¨å†…å­˜ç®¡ç†ä¸Šçš„å¼€é”€ï¼Œä»è€Œæå‡æ€§èƒ½ï¼Œå°¤å…¶å¯¹äºå†…å­˜å ç”¨è¾ƒå¤§</strong>çš„åº”ç”¨æ•ˆæœæ›´æ˜æ˜¾ã€‚</li><li><code>-XX:MaxMetaspaceSize=256m</code>: è¿™ä¸ªå‚æ•°è®¾ç½®äº†<strong>å…ƒç©ºé—´ï¼ˆMetaspaceï¼‰çš„æœ€å¤§å¤§å°ä¸º 256MB</strong>ã€‚å…ƒç©ºé—´æ˜¯ JVM å­˜å‚¨ç±»çš„å…ƒæ•°æ®ï¼ˆå¦‚ç±»çš„åç§°ã€æ–¹æ³•ã€å­—æ®µç­‰ä¿¡æ¯ï¼‰çš„åœ°æ–¹ã€‚åœ¨ Java 8 ä¹‹åï¼Œå®ƒå–ä»£äº†ä¹‹å‰çš„â€œæ°¸ä¹…ä»£â€ï¼ˆPermGenï¼‰ã€‚</li><li><code>-Xms512m</code>: è¿™æ¡å‘½ä»¤è®¾å®šäº† <strong>JVM å †çš„åˆå§‹å†…å­˜ä¸º 512MB</strong>ã€‚å †æ˜¯ç”¨æ¥å­˜æ”¾ Java å¯¹è±¡çš„åœ°æ–¹ã€‚<code>-Xms</code> å†³å®šäº† JVM å¯åŠ¨æ—¶ä¼šç”³è¯·çš„æœ€å°å†…å­˜ã€‚</li><li><code>-Xmx1024m</code>: è¿™æ¡å‘½ä»¤è®¾å®šäº† <strong>JVM å †çš„æœ€å¤§å†…å­˜ä¸º 1024MBï¼ˆå³ 1GBï¼‰</strong>ã€‚è¿™æ˜¯ JVM è¿è¡Œæ—¶å¯ä»¥ä½¿ç”¨çš„æœ€å¤§å†…å­˜ã€‚å½“å †å†…å­˜ç”¨å°½æ—¶ï¼ŒJVM ä¼šè§¦å‘åƒåœ¾å›æ”¶ï¼Œå¦‚æœä¾ç„¶ä¸è¶³ï¼Œå°±ä¼šæŠ›å‡º <code>OutOfMemoryError</code>ã€‚</li></ul><hr><p>å¥½çš„ï¼Œæˆ‘ä»¬æ¥æ›´è¯¦ç»†åœ°èŠèŠ JVM å †å†…å­˜çš„ç»“æ„ï¼Œç‰¹åˆ«æ˜¯åˆ†ä»£è®¾è®¡å’Œå…·ä½“çš„åˆ’åˆ†æ¯”ä¾‹ã€‚</p><hr><h3 id="å †å†…å­˜çš„ä¼ ç»Ÿåˆ†ä»£ç»“æ„"><a href="#å †å†…å­˜çš„ä¼ ç»Ÿåˆ†ä»£ç»“æ„" class="headerlink" title="å †å†…å­˜çš„ä¼ ç»Ÿåˆ†ä»£ç»“æ„"></a>å †å†…å­˜çš„ä¼ ç»Ÿåˆ†ä»£ç»“æ„</h3><p>åœ¨ç»å¤§å¤šæ•°çš„åƒåœ¾å›æ”¶å™¨ä¸­ï¼ˆä¾‹å¦‚ CMSã€G1 ä¹‹å‰çš„ä¸²è¡Œå’Œå¹¶è¡Œ GCï¼‰ï¼Œå †å†…å­˜è¢«åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªä»£ï¼ˆGenerationï¼‰ï¼š</p><h4 id="1-å¹´è½»ä»£ï¼ˆYoung-Generationï¼‰"><a href="#1-å¹´è½»ä»£ï¼ˆYoung-Generationï¼‰" class="headerlink" title="1. å¹´è½»ä»£ï¼ˆYoung Generationï¼‰"></a>1. å¹´è½»ä»£ï¼ˆYoung Generationï¼‰</h4><p><strong>å¹´è½»ä»£æ˜¯æ–°å¯¹è±¡çš„è¯ç”Ÿåœ°ã€‚</strong> ç»å¤§å¤šæ•°å¯¹è±¡ï¼Œæ¯”å¦‚å±€éƒ¨å˜é‡åˆ›å»ºçš„ä¸´æ—¶å¯¹è±¡ï¼Œéƒ½ä¼šåœ¨å¹´è½»ä»£è¢«åˆ›å»ºã€‚å¹´è½»ä»£è¢«è®¾è®¡æˆè¾ƒå°ä¸”åƒåœ¾å›æ”¶é¢‘ç‡é«˜çš„åŒºåŸŸã€‚</p><ul><li><strong>Eden åŒº</strong>ï¼šè¿™æ˜¯å¹´è½»ä»£çš„ä¸»è¦éƒ¨åˆ†ï¼Œæ–°åˆ›å»ºçš„å¯¹è±¡é¦–å…ˆè¢«åˆ†é…åˆ°è¿™é‡Œã€‚</li><li><strong>Survivor åŒºï¼ˆå¹¸å­˜è€…åŒºï¼‰</strong>ï¼šæœ‰ä¸¤ä¸ªå¤§å°ç›¸ç­‰çš„ Survivor åŒºï¼Œé€šå¸¸å‘½åä¸º <strong>S0</strong> å’Œ <strong>S1</strong>ã€‚å®ƒä»¬çš„ä½œç”¨æ˜¯ä¿å­˜æ¯æ¬¡åƒåœ¾å›æ”¶åï¼Œè¿˜å­˜æ´»çš„å¯¹è±¡ã€‚</li></ul><p><strong>åˆ’åˆ†æ¯”ä¾‹</strong></p><p>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå¹´è½»ä»£å†…éƒ¨çš„åˆ’åˆ†æ¯”ä¾‹é€šå¸¸æ˜¯ï¼š</p><ul><li><strong>Eden åŒº : S0 åŒº : S1 åŒº &#x3D; 8 : 1 : 1</strong></li></ul><p>è¿™ä¸ªæ¯”ä¾‹å¯ä»¥é€šè¿‡ JVM å‚æ•°è¿›è¡Œè°ƒæ•´ï¼Œæ¯”å¦‚ä½¿ç”¨ <code>-XX:SurvivorRatio=8</code>ã€‚è¿™æ„å‘³ç€ Eden åŒºçš„å¤§å°æ˜¯å•ä¸ª Survivor åŒºçš„ 8 å€ã€‚</p><h4 id="2-è€å¹´ä»£ï¼ˆOld-Generationï¼‰"><a href="#2-è€å¹´ä»£ï¼ˆOld-Generationï¼‰" class="headerlink" title="2. è€å¹´ä»£ï¼ˆOld Generationï¼‰"></a>2. è€å¹´ä»£ï¼ˆOld Generationï¼‰</h4><p><strong>è€å¹´ä»£ç”¨äºå­˜æ”¾ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„å¯¹è±¡ã€‚</strong> å½“ä¸€ä¸ªå¯¹è±¡åœ¨å¹´è½»ä»£ç»è¿‡å¤šæ¬¡åƒåœ¾å›æ”¶ï¼ˆé€šå¸¸æ˜¯ 15 æ¬¡ï¼Œè¿™ä¸ªæ¬¡æ•°ä¹Ÿå¯ä»¥é€šè¿‡ <code>-XX:MaxTenuringThreshold</code> å‚æ•°è°ƒæ•´ï¼‰åä»ç„¶å­˜æ´»ï¼Œæˆ–è€…å¹´è½»ä»£æ”¾ä¸ä¸‹çš„å¤§å¯¹è±¡ï¼Œå°±ä¼šè¢«â€œæ™‹å‡â€åˆ°è€å¹´ä»£ã€‚</p><p>è€å¹´ä»£çš„åƒåœ¾å›æ”¶é¢‘ç‡è¿œä½äºå¹´è½»ä»£ï¼Œä½†æ¯æ¬¡å›æ”¶çš„å¼€é”€æ›´å¤§ã€‚</p><p><strong>åˆ’åˆ†æ¯”ä¾‹</strong></p><p>å †å†…å­˜ä¸­ï¼Œå¹´è½»ä»£å’Œè€å¹´ä»£çš„é»˜è®¤åˆ’åˆ†æ¯”ä¾‹é€šå¸¸æ˜¯ï¼š</p><ul><li><strong>å¹´è½»ä»£ : è€å¹´ä»£ &#x3D; 1 : 2</strong></li></ul><p>ä¾‹å¦‚ï¼Œå¦‚æœä½ è®¾ç½® <code>-Xms1200m -Xmx1200m</code>ï¼Œé‚£ä¹ˆå¹´è½»ä»£å¤§çº¦æ˜¯ 400MBï¼Œè€å¹´ä»£å¤§çº¦æ˜¯ 800MBã€‚è¿™ä¸ªæ¯”ä¾‹å¯ä»¥é€šè¿‡ <code>-XX:NewRatio</code> å‚æ•°æ¥è°ƒæ•´ã€‚ä¾‹å¦‚ï¼Œ<code>-XX:NewRatio=2</code> è¡¨ç¤ºè€å¹´ä»£ä¸å¹´è½»ä»£çš„å¤§å°æ¯”å€¼ä¸º 2:1ã€‚</p><hr><h3 id="åƒåœ¾å›æ”¶è¿‡ç¨‹ï¼ˆä»¥-Minor-GC-ä¸ºä¾‹ï¼‰"><a href="#åƒåœ¾å›æ”¶è¿‡ç¨‹ï¼ˆä»¥-Minor-GC-ä¸ºä¾‹ï¼‰" class="headerlink" title="åƒåœ¾å›æ”¶è¿‡ç¨‹ï¼ˆä»¥ Minor GC ä¸ºä¾‹ï¼‰"></a>åƒåœ¾å›æ”¶è¿‡ç¨‹ï¼ˆä»¥ Minor GC ä¸ºä¾‹ï¼‰</h3><p>ç†è§£äº†è¿™äº›åŒºåŸŸï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹åƒåœ¾å›æ”¶æ˜¯æ€ä¹ˆè¿›è¡Œçš„ï¼š</p><ol><li>å½“ <strong>Eden åŒº</strong>æ»¡äº†ï¼Œä¼šè§¦å‘ä¸€æ¬¡ <strong>Minor GC</strong>ã€‚</li><li>Minor GC ä¼šæ£€æŸ¥ Eden åŒºå’Œå…¶ä¸­ä¸€ä¸ª Survivor åŒºï¼ˆæ¯”å¦‚ S0ï¼‰ã€‚</li><li>å®ƒä¼šå°†æ‰€æœ‰è¿˜<strong>å­˜æ´»çš„å¯¹è±¡</strong>å¤åˆ¶åˆ°å¦ä¸€ä¸ªç©ºçš„ Survivor åŒºï¼ˆæ¯”å¦‚ S1ï¼‰ã€‚</li><li>åŒæ—¶ï¼Œé‚£äº›<strong>ä¸å†è¢«å¼•ç”¨çš„å¯¹è±¡</strong>åˆ™ä¼šè¢«æ¸…ç†ã€‚</li><li>æ‰€æœ‰è¢«å¤åˆ¶åˆ° S1 åŒºçš„å¯¹è±¡ï¼Œå®ƒä»¬çš„å¹´é¾„ï¼ˆ<code>age</code>ï¼‰ä¼šåŠ ä¸€ã€‚</li><li>ä¸‹ä¸€æ¬¡ Minor GC å‘ç”Ÿæ—¶ï¼ŒåŒæ ·ä¼šæ‰«æ Eden åŒºå’Œ S1 åŒºï¼Œå°†å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ° S0 åŒºï¼Œæ¸…ç©º Eden å’Œ S1 åŒºï¼Œå¹¶å¢åŠ å¯¹è±¡çš„å¹´é¾„ã€‚</li><li>å½“å¯¹è±¡çš„å¹´é¾„è¾¾åˆ°æŸä¸ªé˜ˆå€¼æ—¶ï¼Œå®ƒå°±ä¼šè¢«<strong>æ™‹å‡</strong>åˆ°è€å¹´ä»£ã€‚</li></ol><h3 id="ç°ä»£åƒåœ¾å›æ”¶å™¨ï¼ˆå¦‚-G1-å’Œ-ZGCï¼‰"><a href="#ç°ä»£åƒåœ¾å›æ”¶å™¨ï¼ˆå¦‚-G1-å’Œ-ZGCï¼‰" class="headerlink" title="ç°ä»£åƒåœ¾å›æ”¶å™¨ï¼ˆå¦‚ G1 å’Œ ZGCï¼‰"></a>ç°ä»£åƒåœ¾å›æ”¶å™¨ï¼ˆå¦‚ G1 å’Œ ZGCï¼‰</h3><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåƒ <strong>G1 åƒåœ¾å›æ”¶å™¨</strong>å·²ç»æ‰“ç ´äº†è¿™ç§ä¸¥æ ¼çš„åˆ†ä»£æ¯”ä¾‹ã€‚å®ƒå°†å †åˆ’åˆ†ä¸ºä¸€ä¸ªä¸ªå¤§å°ç›¸ç­‰çš„<strong>åŒºåŸŸï¼ˆRegionï¼‰</strong>ï¼Œæ¯ä¸ªåŒºåŸŸéƒ½å¯ä»¥æ˜¯ Edenã€Survivor æˆ–è€…è€å¹´ä»£ã€‚G1 èƒ½å¤Ÿæ›´æ™ºèƒ½åœ°é€‰æ‹©è¦å›æ”¶çš„åŒºåŸŸï¼Œä»è€Œåœ¨ä¿è¯ä½åœé¡¿çš„åŒæ—¶ï¼Œæé«˜ååé‡ã€‚</p><p>è€Œ <strong>ZGC</strong> åˆ™æ›´è¿›ä¸€æ­¥ï¼Œå¦‚æˆ‘ä¹‹å‰æ‰€è¯´ï¼Œå®ƒ<strong>å®Œå…¨æ²¡æœ‰å¹´è½»ä»£ã€è€å¹´ä»£çš„æ¦‚å¿µ</strong>ï¼Œè€Œæ˜¯é€šè¿‡ç€è‰²æŒ‡é’ˆå’Œè¯»å±éšœæŠ€æœ¯ï¼Œåœ¨ä¸ä¸­æ–­åº”ç”¨ç¨‹åºçš„æƒ…å†µä¸‹å¹¶å‘åœ°è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œå®ç°äº†æ›´ä½çš„åœé¡¿ã€‚</p><p>å› æ­¤ï¼Œå½“ä½ ä½¿ç”¨ ZGC æ—¶ï¼Œä¼ ç»Ÿçš„åˆ†ä»£æ¯”ä¾‹å°±ä¸é€‚ç”¨äº†ã€‚ä¸è¿‡ï¼Œäº†è§£ä¼ ç»Ÿçš„åˆ†ä»£ç»“æ„å¯¹äºç†è§£ Java å†…å­˜ç®¡ç†çš„åŸºç¡€ä¾ç„¶éå¸¸é‡è¦ã€‚</p><p>ä»¥ä¸‹æ˜¯é’ˆå¯¹Spring Cloud AlibabaåŠå…¶ä»–åˆ†å¸ƒå¼æŠ€æœ¯çš„æ·±åº¦è¡¥å……ï¼ŒåŒ…å«å®ç°åŸç†å’Œæ ¸å¿ƒç»„ä»¶çš„è¯¦ç»†è¯´æ˜ï¼š</p><hr><h2 id="å…­ã€Spring-Cloudä¸åˆ†å¸ƒå¼æŠ€æœ¯è¯¦è§£"><a href="#å…­ã€Spring-Cloudä¸åˆ†å¸ƒå¼æŠ€æœ¯è¯¦è§£" class="headerlink" title="å…­ã€Spring Cloudä¸åˆ†å¸ƒå¼æŠ€æœ¯è¯¦è§£"></a>å…­ã€Spring Cloudä¸åˆ†å¸ƒå¼æŠ€æœ¯è¯¦è§£</h2><h3 id="6-1-Spring-Cloud-Alibabaæ ¸å¿ƒç»„ä»¶"><a href="#6-1-Spring-Cloud-Alibabaæ ¸å¿ƒç»„ä»¶" class="headerlink" title="6.1 Spring Cloud Alibabaæ ¸å¿ƒç»„ä»¶"></a>6.1 Spring Cloud Alibabaæ ¸å¿ƒç»„ä»¶</h3><h4 id="Nacosæ·±åº¦è§£æ"><a href="#Nacosæ·±åº¦è§£æ" class="headerlink" title="Nacosæ·±åº¦è§£æ"></a>Nacosæ·±åº¦è§£æ</h4><p><strong>æœåŠ¡å‘ç°åŸç†</strong>ï¼š</p><ol><li><p><strong>æ³¨å†Œæµç¨‹</strong>ï¼š</p><ul><li>æœåŠ¡å¯åŠ¨æ—¶å‘Nacos Serverå‘é€æ³¨å†Œè¯·æ±‚ï¼ˆHTTP&#x2F;GRPCï¼‰</li><li>æ³¨å†Œä¿¡æ¯åŒ…å«å…ƒæ•°æ®ã€å¥åº·æ£€æŸ¥æ–¹å¼ï¼ˆTCP&#x2F;HTTP&#x2F;MySQLï¼‰</li><li>å®¢æˆ·ç«¯æœ¬åœ°ç¼“å­˜æœåŠ¡åˆ—è¡¨ï¼ˆæ•…éšœè½¬ç§»ï¼‰</li></ul></li><li><p><strong>å¥åº·æ£€æŸ¥æœºåˆ¶</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Nacoså¥åº·æ£€æŸ¥é…ç½®ç¤ºä¾‹</span></span><br><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    nacos:</span><br><span class="line">      discovery:</span><br><span class="line">        health-check-enabled: <span class="literal">true</span></span><br><span class="line">        health-check-interval: 10s</span><br><span class="line">        health-check-timeout: 5s</span><br></pre></td></tr></table></figure></li></ol><p><strong>é…ç½®ä¸­å¿ƒå®ç°</strong>ï¼š</p><ul><li><strong>é•¿è½®è¯¢æœºåˆ¶</strong>ï¼ˆPush+Pullæ··åˆæ¨¡å¼ï¼‰ï¼š<ul><li>å®¢æˆ·ç«¯å‘èµ·é•¿è½®è¯¢è¯·æ±‚ï¼ˆé»˜è®¤30ç§’è¶…æ—¶ï¼‰</li><li>æœåŠ¡ç«¯é…ç½®å˜æ›´æ—¶ç«‹å³å“åº”</li><li>å®¢æˆ·ç«¯æ”¶åˆ°å˜æ›´åæ‹‰å–æœ€æ–°é…ç½®</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŠ¨æ€é…ç½®åˆ·æ–°ç¤ºä¾‹</span></span><br><span class="line"><span class="meta">@RefreshScope</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfigController</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;app.config.item&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String configItem;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Sentinelæ ¸å¿ƒåŸç†"><a href="#Sentinelæ ¸å¿ƒåŸç†" class="headerlink" title="Sentinelæ ¸å¿ƒåŸç†"></a>Sentinelæ ¸å¿ƒåŸç†</h4><p><strong>æµé‡æ§åˆ¶è§„åˆ™</strong>ï¼š</p><ul><li><strong>æ»‘åŠ¨çª—å£ç®—æ³•</strong>ï¼š<ul><li>ç»Ÿè®¡å‘¨æœŸï¼ˆ1ç§’ï¼‰åˆ†ä¸ºå¤šä¸ªæ ¼å­ï¼ˆå¦‚20ä¸ª50msï¼‰</li><li>å®æ—¶æ·˜æ±°è¿‡æœŸæ ¼å­æ•°æ®</li><li>QPSè®¡ç®—åŸºäºå½“å‰çª—å£æ€»è¯·æ±‚æ•°</li></ul></li></ul><p><strong>ç†”æ–­é™çº§ç­–ç•¥</strong>ï¼š</p><table><thead><tr><th>ç­–ç•¥ç±»å‹</th><th>è®¡ç®—å…¬å¼</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>æ…¢è°ƒç”¨æ¯”ä¾‹</td><td>å“åº”æ—¶é—´ &gt; RTé˜ˆå€¼ &amp;&amp; æ¯”ä¾‹ &gt; é˜ˆå€¼</td><td>æ¥å£æ€§èƒ½æ³¢åŠ¨</td></tr><tr><td>å¼‚å¸¸æ¯”ä¾‹</td><td>å¼‚å¸¸æ•° &#x2F; è¯·æ±‚æ•° &gt; é˜ˆå€¼</td><td>ä¾èµ–æœåŠ¡ä¸ç¨³å®š</td></tr><tr><td>å¼‚å¸¸æ•°</td><td>å¼‚å¸¸æ•° &gt; é˜ˆå€¼ï¼ˆæ—¶é—´çª—å£å†…ï¼‰</td><td>å…³é”®ä¸šåŠ¡ç†”æ–­</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Sentinelè§„åˆ™æŒä¹…åŒ–åˆ°Nacosç¤ºä¾‹</span></span><br><span class="line"><span class="meta">@PostConstruct</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initRules</span><span class="params">()</span> &#123;</span><br><span class="line">    FlowRuleManager.register2Property(</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">NacosDataSourceWrapper</span>(</span><br><span class="line">            <span class="string">&quot;nacos-server:8848&quot;</span>, <span class="string">&quot;sentinel-flow-rules&quot;</span>,</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Converter</span>&lt;String, List&lt;FlowRule&gt;&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> List&lt;FlowRule&gt; <span class="title function_">convert</span><span class="params">(String source)</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> JSON.parseArray(source, FlowRule.class);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="RocketMQé›†æˆ"><a href="#RocketMQé›†æˆ" class="headerlink" title="RocketMQé›†æˆ"></a>RocketMQé›†æˆ</h4><p><strong>æ¶ˆæ¯è½¨è¿¹è¿½è¸ª</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç”Ÿäº§è€…é…ç½®</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> RocketMQTemplate <span class="title function_">rocketMQTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">RocketMQTemplate</span> <span class="variable">template</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RocketMQTemplate</span>();</span><br><span class="line">    template.setProducer(<span class="keyword">new</span> <span class="title class_">DefaultMQProducer</span>(<span class="string">&quot;producer_group&quot;</span>) &#123;&#123;</span><br><span class="line">        setVipChannelEnabled(<span class="literal">false</span>);</span><br><span class="line">        setTraceDispatcher(<span class="keyword">new</span> <span class="title class_">AsyncTraceDispatcher</span>(<span class="string">&quot;trace_topic&quot;</span>));</span><br><span class="line">    &#125;&#125;);</span><br><span class="line">    <span class="keyword">return</span> template;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¶ˆè´¹è€…è½¨è¿¹è¿½è¸ª</span></span><br><span class="line"><span class="meta">@RocketMQMessageListener(</span></span><br><span class="line"><span class="meta">    topic = &quot;order_topic&quot;, </span></span><br><span class="line"><span class="meta">    consumerGroup = &quot;order_consumer&quot;,</span></span><br><span class="line"><span class="meta">    enableMsgTrace = true</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderConsumer</span> <span class="keyword">implements</span> <span class="title class_">RocketMQListener</span>&lt;String&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onMessage</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="comment">// å¤„ç†é€»è¾‘</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-2-åˆ†å¸ƒå¼äº‹åŠ¡å¢å¼ºï¼ˆSeataåŸç†ï¼‰"><a href="#6-2-åˆ†å¸ƒå¼äº‹åŠ¡å¢å¼ºï¼ˆSeataåŸç†ï¼‰" class="headerlink" title="6.2 åˆ†å¸ƒå¼äº‹åŠ¡å¢å¼ºï¼ˆSeataåŸç†ï¼‰"></a>6.2 åˆ†å¸ƒå¼äº‹åŠ¡å¢å¼ºï¼ˆSeataåŸç†ï¼‰</h3><h4 id="ATæ¨¡å¼å·¥ä½œæµç¨‹"><a href="#ATæ¨¡å¼å·¥ä½œæµç¨‹" class="headerlink" title="ATæ¨¡å¼å·¥ä½œæµç¨‹"></a>ATæ¨¡å¼å·¥ä½œæµç¨‹</h4><ol><li><strong>ä¸€é˜¶æ®µ</strong>ï¼š<ul><li>è§£æSQLç”Ÿæˆå‰åé•œåƒ</li><li>æ³¨å†Œåˆ†æ”¯äº‹åŠ¡åˆ°TCï¼ˆTransaction Coordinatorï¼‰</li><li>æœ¬åœ°äº‹åŠ¡æäº¤å‰è®°å½•undo_log</li></ul></li><li><strong>äºŒé˜¶æ®µ</strong>ï¼š<ul><li>æˆåŠŸï¼šå¼‚æ­¥åˆ é™¤undo_log</li><li>å¤±è´¥ï¼šæ ¹æ®undo_logè¡¥å¿ï¼ˆåå‘SQLï¼‰</li></ul></li></ol><p><strong>undo_logè¡¨ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> `undo_log` (</span><br><span class="line">  `id` <span class="type">bigint</span> <span class="keyword">NOT NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `branch_id` <span class="type">bigint</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">  `xid` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  `context` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  `rollback_info` longblob <span class="keyword">NOT NULL</span>,</span><br><span class="line">  `log_status` <span class="type">int</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">  `log_created` datetime <span class="keyword">NOT NULL</span>,</span><br><span class="line">  `log_modified` datetime <span class="keyword">NOT NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY KEY</span> (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `ux_undo_log` (`xid`,`branch_id`)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h4 id="TCCæ¨¡å¼æœ€ä½³å®è·µ"><a href="#TCCæ¨¡å¼æœ€ä½³å®è·µ" class="headerlink" title="TCCæ¨¡å¼æœ€ä½³å®è·µ"></a>TCCæ¨¡å¼æœ€ä½³å®è·µ</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è´¦æˆ·æœåŠ¡TCCæ¥å£</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AccountTccService</span> &#123;</span><br><span class="line">    <span class="meta">@TwoPhaseBusinessAction(</span></span><br><span class="line"><span class="meta">        name = &quot;deduct&quot;,</span></span><br><span class="line"><span class="meta">        commitMethod = &quot;confirmDeduct&quot;,</span></span><br><span class="line"><span class="meta">        rollbackMethod = &quot;cancelDeduct&quot;</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">prepareDeduct</span><span class="params">(</span></span><br><span class="line"><span class="params">        <span class="meta">@BusinessActionContextParameter(paramName = &quot;userId&quot;)</span> String userId,</span></span><br><span class="line"><span class="params">        <span class="meta">@BusinessActionContextParameter(paramName = &quot;amount&quot;)</span> BigDecimal amount</span></span><br><span class="line"><span class="params">    )</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">confirmDeduct</span><span class="params">(BusinessActionContext context)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">cancelDeduct</span><span class="params">(BusinessActionContext context)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸šåŠ¡è°ƒç”¨æ–¹</span></span><br><span class="line"><span class="meta">@GlobalTransactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">placeOrder</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. å†»ç»“åº“å­˜</span></span><br><span class="line">    inventoryTccService.prepare(<span class="literal">null</span>, order.getProductId(), order.getCount());</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. é¢„æ‰£æ¬¾</span></span><br><span class="line">    accountTccService.prepareDeduct(order.getUserId(), order.getAmount());</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. åˆ›å»ºè®¢å•</span></span><br><span class="line">    orderMapper.insert(order);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-3-åˆ†å¸ƒå¼ç¼“å­˜æ·±åº¦ä¼˜åŒ–"><a href="#6-3-åˆ†å¸ƒå¼ç¼“å­˜æ·±åº¦ä¼˜åŒ–" class="headerlink" title="6.3 åˆ†å¸ƒå¼ç¼“å­˜æ·±åº¦ä¼˜åŒ–"></a>6.3 åˆ†å¸ƒå¼ç¼“å­˜æ·±åº¦ä¼˜åŒ–</h3><h4 id="Rediså¤šçº§ç¼“å­˜æ¶æ„"><a href="#Rediså¤šçº§ç¼“å­˜æ¶æ„" class="headerlink" title="Rediså¤šçº§ç¼“å­˜æ¶æ„"></a>Rediså¤šçº§ç¼“å­˜æ¶æ„</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æœ¬åœ°ç¼“å­˜+Caffeine+Rediså®ç°</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> CacheManager <span class="title function_">cacheManager</span><span class="params">(RedisConnectionFactory factory)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CaffeineRedisCacheManager</span>(</span><br><span class="line">        Caffeine.newBuilder()</span><br><span class="line">            .expireAfterWrite(<span class="number">10</span>, TimeUnit.MINUTES)</span><br><span class="line">            .maximumSize(<span class="number">1000</span>),</span><br><span class="line">        RedisCacheWriter.nonLockingRedisCacheWriter(factory),</span><br><span class="line">        RedisCacheConfiguration.defaultCacheConfig()</span><br><span class="line">            .entryTtl(Duration.ofHours(<span class="number">1</span>))</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// çƒ­ç‚¹Keyæ¢æµ‹</span></span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; T <span class="title function_">getWithHotspotProtection</span><span class="params">(String key, Class&lt;T&gt; type)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. æœ¬åœ°ç¼“å­˜æŸ¥è¯¢</span></span><br><span class="line">    <span class="type">T</span> <span class="variable">value</span> <span class="operator">=</span> localCache.getIfPresent(key);</span><br><span class="line">    <span class="keyword">if</span> (value != <span class="literal">null</span>) <span class="keyword">return</span> value;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. Redisé›†ç¾¤æŸ¥è¯¢ï¼ˆå¸¦éšæœºè¿‡æœŸæ—¶é—´ï¼‰</span></span><br><span class="line">    value = redisTemplate.opsForValue().get(key);</span><br><span class="line">    <span class="keyword">if</span> (value != <span class="literal">null</span>) &#123;</span><br><span class="line">        localCache.put(key, value);</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. åˆ†å¸ƒå¼é”é˜²å‡»ç©¿</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">lockKey</span> <span class="operator">=</span> <span class="string">&quot;lock:&quot;</span> + key;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (redisLock.tryLock(lockKey, <span class="number">3</span>, <span class="number">30</span>)) &#123;</span><br><span class="line">            <span class="comment">// 4. æ•°æ®åº“æŸ¥è¯¢</span></span><br><span class="line">            value = databaseLoader.load(key);</span><br><span class="line">            redisTemplate.opsForValue().set(</span><br><span class="line">                key, value, </span><br><span class="line">                ThreadLocalRandom.current().nextInt(<span class="number">30</span>) + <span class="number">30</span>, </span><br><span class="line">                TimeUnit.MINUTES</span><br><span class="line">            );</span><br><span class="line">            localCache.put(key, value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        redisLock.unlock(lockKey);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-4-æ¶ˆæ¯é˜Ÿåˆ—é«˜çº§ç‰¹æ€§"><a href="#6-4-æ¶ˆæ¯é˜Ÿåˆ—é«˜çº§ç‰¹æ€§" class="headerlink" title="6.4 æ¶ˆæ¯é˜Ÿåˆ—é«˜çº§ç‰¹æ€§"></a>6.4 æ¶ˆæ¯é˜Ÿåˆ—é«˜çº§ç‰¹æ€§</h3><h4 id="RocketMQäº‹åŠ¡æ¶ˆæ¯"><a href="#RocketMQäº‹åŠ¡æ¶ˆæ¯" class="headerlink" title="RocketMQäº‹åŠ¡æ¶ˆæ¯"></a>RocketMQäº‹åŠ¡æ¶ˆæ¯</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// äº‹åŠ¡æ¶ˆæ¯ç”Ÿäº§è€…</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendTransactionMessage</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">    <span class="type">TransactionSendResult</span> <span class="variable">result</span> <span class="operator">=</span> rocketMQTemplate.sendMessageInTransaction(</span><br><span class="line">        <span class="string">&quot;order-tx-group&quot;</span>,</span><br><span class="line">        MessageBuilder.withPayload(order)</span><br><span class="line">            .setHeader(RocketMQHeaders.TRANSACTION_ID, order.getId())</span><br><span class="line">            .build(),</span><br><span class="line">        order</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æœ¬åœ°äº‹åŠ¡æ‰§è¡Œå™¨</span></span><br><span class="line"><span class="meta">@RocketMQTransactionListener(txProducerGroup = &quot;order-tx-group&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderTransactionListenerImpl</span> <span class="keyword">implements</span> <span class="title class_">RocketMQLocalTransactionListener</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> RocketMQLocalTransactionState <span class="title function_">executeLocalTransaction</span><span class="params">(Message msg, Object arg)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> (Order) arg;</span><br><span class="line">            orderService.createOrder(order); <span class="comment">// æœ¬åœ°äº‹åŠ¡</span></span><br><span class="line">            <span class="keyword">return</span> RocketMQLocalTransactionState.COMMIT;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> RocketMQLocalTransactionState.ROLLBACK;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> RocketMQLocalTransactionState <span class="title function_">checkLocalTransaction</span><span class="params">(Message msg)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">orderId</span> <span class="operator">=</span> msg.getHeaders().get(<span class="string">&quot;TRANSACTION_ID&quot;</span>).toString();</span><br><span class="line">        <span class="keyword">return</span> orderService.exists(orderId) ? </span><br><span class="line">            RocketMQLocalTransactionState.COMMIT : </span><br><span class="line">            RocketMQLocalTransactionState.ROLLBACK;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Kafkaç²¾ç¡®ä¸€æ¬¡è¯­ä¹‰"><a href="#Kafkaç²¾ç¡®ä¸€æ¬¡è¯­ä¹‰" class="headerlink" title="Kafkaç²¾ç¡®ä¸€æ¬¡è¯­ä¹‰"></a>Kafkaç²¾ç¡®ä¸€æ¬¡è¯­ä¹‰</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç”Ÿäº§è€…é…ç½®</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> ProducerFactory&lt;String, String&gt; <span class="title function_">producerFactory</span><span class="params">()</span> &#123;</span><br><span class="line">    Map&lt;String, Object&gt; configs = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    configs.put(ProducerConfig.ENABLE_IDEMPOTENCE_CONFIG, <span class="literal">true</span>);</span><br><span class="line">    configs.put(ProducerConfig.TRANSACTIONAL_ID_CONFIG, <span class="string">&quot;tx-producer-1&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DefaultKafkaProducerFactory</span>&lt;&gt;(configs);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¶ˆè´¹è€…é…ç½®</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> ConsumerFactory&lt;String, String&gt; <span class="title function_">consumerFactory</span><span class="params">()</span> &#123;</span><br><span class="line">    Map&lt;String, Object&gt; configs = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    configs.put(ConsumerConfig.ISOLATION_LEVEL_CONFIG, <span class="string">&quot;read_committed&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DefaultKafkaConsumerFactory</span>&lt;&gt;(configs);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// äº‹åŠ¡æ€§æ¶ˆè´¹</span></span><br><span class="line"><span class="meta">@KafkaListener(topics = &quot;order-topic&quot;)</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processOrder</span><span class="params">(ConsumerRecord&lt;String, String&gt; record)</span> &#123;</span><br><span class="line">    <span class="type">OrderEvent</span> <span class="variable">event</span> <span class="operator">=</span> parseEvent(record.value());</span><br><span class="line">    orderService.process(event); <span class="comment">// æ•°æ®åº“æ“ä½œ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="ä¸ƒã€äº‘åŸç”Ÿæ”¯æŒï¼ˆæ–°å¢ï¼‰"><a href="#ä¸ƒã€äº‘åŸç”Ÿæ”¯æŒï¼ˆæ–°å¢ï¼‰" class="headerlink" title="ä¸ƒã€äº‘åŸç”Ÿæ”¯æŒï¼ˆæ–°å¢ï¼‰"></a>ä¸ƒã€äº‘åŸç”Ÿæ”¯æŒï¼ˆæ–°å¢ï¼‰</h2><h3 id="7-1-Kubernetesé›†æˆæ–¹æ¡ˆ"><a href="#7-1-Kubernetesé›†æˆæ–¹æ¡ˆ" class="headerlink" title="7.1 Kubernetesé›†æˆæ–¹æ¡ˆ"></a>7.1 Kubernetesé›†æˆæ–¹æ¡ˆ</h3><h4 id="æœåŠ¡å‘ç°é€‚é…"><a href="#æœåŠ¡å‘ç°é€‚é…" class="headerlink" title="æœåŠ¡å‘ç°é€‚é…"></a>æœåŠ¡å‘ç°é€‚é…</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Nacosä¸K8s Serviceé›†æˆ</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">kubernetes:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">all-namespaces:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">$&#123;NACOS_HOST:nacos-headless&#125;:$&#123;NACOS_PORT:8848&#125;</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">$&#123;POD_NAMESPACE:default&#125;</span></span><br></pre></td></tr></table></figure><h4 id="é…ç½®ç®¡ç†æ–¹æ¡ˆ"><a href="#é…ç½®ç®¡ç†æ–¹æ¡ˆ" class="headerlink" title="é…ç½®ç®¡ç†æ–¹æ¡ˆ"></a>é…ç½®ç®¡ç†æ–¹æ¡ˆ</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¤šé…ç½®æºåŠ è½½ï¼ˆK8s ConfigMap + Nacosï¼‰</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;app&quot;)</span></span><br><span class="line"><span class="meta">@RefreshScope</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;configFromNacos&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String nacosConfig;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;configFromK8s&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String k8sConfig;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="7-2-Service-Meshæ•´åˆ"><a href="#7-2-Service-Meshæ•´åˆ" class="headerlink" title="7.2 Service Meshæ•´åˆ"></a>7.2 Service Meshæ•´åˆ</h3><h4 id="Istioæµé‡æ²»ç†"><a href="#Istioæµé‡æ²»ç†" class="headerlink" title="Istioæµé‡æ²»ç†"></a>Istioæµé‡æ²»ç†</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é‡‘ä¸é›€å‘å¸ƒç­–ç•¥</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.istio.io/v1alpha3</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">VirtualService</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">order-service</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">hosts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">order-service</span></span><br><span class="line">  <span class="attr">http:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">route:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">destination:</span></span><br><span class="line">            <span class="attr">host:</span> <span class="string">order-service</span></span><br><span class="line">            <span class="attr">subset:</span> <span class="string">v1</span></span><br><span class="line">          <span class="attr">weight:</span> <span class="number">90</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">destination:</span></span><br><span class="line">            <span class="attr">host:</span> <span class="string">order-service</span></span><br><span class="line">            <span class="attr">subset:</span> <span class="string">v2</span></span><br><span class="line">          <span class="attr">weight:</span> <span class="number">10</span></span><br></pre></td></tr></table></figure><hr><h2 id="å…«ã€æ€§èƒ½ä¼˜åŒ–æ·±åº¦å®è·µ"><a href="#å…«ã€æ€§èƒ½ä¼˜åŒ–æ·±åº¦å®è·µ" class="headerlink" title="å…«ã€æ€§èƒ½ä¼˜åŒ–æ·±åº¦å®è·µ"></a>å…«ã€æ€§èƒ½ä¼˜åŒ–æ·±åº¦å®è·µ</h2><h3 id="8-1-å…¨é“¾è·¯å‹æµ‹æ–¹æ¡ˆ"><a href="#8-1-å…¨é“¾è·¯å‹æµ‹æ–¹æ¡ˆ" class="headerlink" title="8.1 å…¨é“¾è·¯å‹æµ‹æ–¹æ¡ˆ"></a>8.1 å…¨é“¾è·¯å‹æµ‹æ–¹æ¡ˆ</h3><h4 id="å½±å­åº“è¡¨é…ç½®"><a href="#å½±å­åº“è¡¨é…ç½®" class="headerlink" title="å½±å­åº“è¡¨é…ç½®"></a>å½±å­åº“è¡¨é…ç½®</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ShardingSphereå½±å­åº“é…ç½®</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">shardingsphere:</span></span><br><span class="line">    <span class="attr">datasource:</span></span><br><span class="line">      <span class="attr">names:</span> <span class="string">ds-real,ds-shadow</span></span><br><span class="line">    <span class="attr">rules:</span></span><br><span class="line">      <span class="attr">shadow:</span></span><br><span class="line">        <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">data-sources:</span></span><br><span class="line">          <span class="attr">shadow-data-source:</span></span><br><span class="line">            <span class="attr">source-data-source-name:</span> <span class="string">ds-real</span></span><br><span class="line">            <span class="attr">shadow-data-source-name:</span> <span class="string">ds-shadow</span></span><br><span class="line">        <span class="attr">tables:</span></span><br><span class="line">          <span class="attr">t_order:</span></span><br><span class="line">            <span class="attr">shadow-algorithm-names:</span> [<span class="string">simple-hint-algorithm</span>]</span><br></pre></td></tr></table></figure><h4 id="æµé‡æŸ“è‰²æ ‡è®°"><a href="#æµé‡æŸ“è‰²æ ‡è®°" class="headerlink" title="æµé‡æŸ“è‰²æ ‡è®°"></a>æµé‡æŸ“è‰²æ ‡è®°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€šè¿‡ThreadLocalä¼ é€’å‹æµ‹æ ‡è®°</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PressureTestContext</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;Boolean&gt; FLAG = ThreadLocal.withInitial(() -&gt; <span class="literal">false</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">markPressureTest</span><span class="params">()</span> &#123;</span><br><span class="line">        FLAG.set(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isPressureTest</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> FLAG.get();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MyBatisæ‹¦æˆªå™¨è‡ªåŠ¨è·¯ç”±</span></span><br><span class="line"><span class="meta">@Intercepts(@Signature(type=Executor.class, method=&quot;update&quot;, args=&#123;MappedStatement.class,Object.class&#125;))</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShadowDbInterceptor</span> <span class="keyword">implements</span> <span class="title class_">Interceptor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">intercept</span><span class="params">(Invocation invocation)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="keyword">if</span> (PressureTestContext.isPressureTest()) &#123;</span><br><span class="line">            RoutingContext.setShadowDataSource();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> invocation.proceed();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h1 id="åˆ†å¸ƒå¼"><a href="#åˆ†å¸ƒå¼" class="headerlink" title="åˆ†å¸ƒå¼"></a>åˆ†å¸ƒå¼</h1><h4 id="1-Spring-Cloud-ä½“ç³»"><a href="#1-Spring-Cloud-ä½“ç³»" class="headerlink" title="1. Spring Cloud ä½“ç³»"></a><strong>1. Spring Cloud ä½“ç³»</strong></h4><h5 id="æ ¸å¿ƒæ€æƒ³"><a href="#æ ¸å¿ƒæ€æƒ³" class="headerlink" title="æ ¸å¿ƒæ€æƒ³"></a><strong>æ ¸å¿ƒæ€æƒ³</strong></h5><p>Spring Cloud å¹¶éä¸€ä¸ªå…¨æ–°çš„æ¡†æ¶ï¼Œè€Œæ˜¯ä¸€å¥—ç”¨äºæ„å»ºå¾®æœåŠ¡æ¶æ„çš„<strong>è§„èŒƒå’Œè§£å†³æ–¹æ¡ˆçš„é›†åˆ</strong>ã€‚å®ƒå·§å¦™åœ°åˆ©ç”¨äº† Spring Boot çš„è‡ªåŠ¨é…ç½®å’Œå¿«é€Ÿå¼€å‘ç‰¹æ€§ï¼Œå°†ä¸šç•Œç»è¿‡å¹¿æ³›éªŒè¯çš„ä¼˜ç§€å¾®æœåŠ¡ç»„ä»¶ï¼ˆå¦‚ Netflix OSSã€Alibaba Nacosã€HashiCorp Consul ç­‰ï¼‰è¿›è¡Œå°è£…å’Œé›†æˆï¼Œä¸ºå¼€å‘è€…æä¾›äº†ä¸€ç«™å¼çš„åˆ†å¸ƒå¼ç³»ç»Ÿå¼€å‘å·¥å…·ç®±ï¼Œæ¶µç›–äº†æœåŠ¡æ²»ç†ã€é…ç½®ç®¡ç†ã€ç†”æ–­é™çº§ã€æ™ºèƒ½è·¯ç”±ã€æœåŠ¡è°ƒç”¨ç­‰æ–¹æ–¹é¢é¢ã€‚</p><h5 id="Netflix-OSS-å¸¸ç”¨ç»„ä»¶ï¼ˆéƒ¨åˆ†è¿›å…¥ç»´æŠ¤æ¨¡å¼ï¼‰"><a href="#Netflix-OSS-å¸¸ç”¨ç»„ä»¶ï¼ˆéƒ¨åˆ†è¿›å…¥ç»´æŠ¤æ¨¡å¼ï¼‰" class="headerlink" title="Netflix OSS å¸¸ç”¨ç»„ä»¶ï¼ˆéƒ¨åˆ†è¿›å…¥ç»´æŠ¤æ¨¡å¼ï¼‰"></a><strong>Netflix OSS å¸¸ç”¨ç»„ä»¶ï¼ˆéƒ¨åˆ†è¿›å…¥ç»´æŠ¤æ¨¡å¼ï¼‰</strong></h5><ul><li><strong>æœåŠ¡æ³¨å†Œä¸å‘ç° (Service Discovery): Eureka</strong><ul><li><strong>ä½œç”¨</strong>: æä¾›ä¸€ä¸ªæœåŠ¡æ³¨å†Œä¸­å¿ƒã€‚æ¯ä¸ªå¾®æœåŠ¡å¯åŠ¨æ—¶ï¼Œå°†è‡ªå·±çš„ç½‘ç»œåœ°å€ç­‰ä¿¡æ¯â€œæ³¨å†Œâ€åˆ° Eureka Serverã€‚å…¶ä»–æœåŠ¡ï¼ˆæ¶ˆè´¹è€…ï¼‰åˆ™ä» Eureka Server â€œå‘ç°â€å¹¶æ‹‰å–æ‰€éœ€æœåŠ¡æä¾›è€…çš„åœ°å€åˆ—è¡¨ï¼Œä»è€Œå®ç°æœåŠ¡é—´çš„åŠ¨æ€å¯»å€å’Œè°ƒç”¨ã€‚</li><li><strong>ä½¿ç”¨</strong>: æœåŠ¡ç«¯æ·»åŠ  <code>spring-cloud-starter-netflix-eureka-server</code> ä¾èµ–ï¼Œå¹¶ä½¿ç”¨ <code>@EnableEurekaServer</code> æ³¨è§£ã€‚å®¢æˆ·ç«¯æ·»åŠ  <code>spring-cloud-starter-netflix-eureka-client</code> ä¾èµ–ï¼Œå¹¶é…ç½® Eureka Server åœ°å€ã€‚</li></ul></li><li><strong>æœåŠ¡è°ƒç”¨ä¸è´Ÿè½½å‡è¡¡ (RPC &amp; Load Balancing): OpenFeign + Ribbon</strong><ul><li><strong>ä½œç”¨</strong>: Feign è®©è¿œç¨‹æœåŠ¡è°ƒç”¨å˜å¾—åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·ç®€å•ã€‚å¼€å‘è€…åªéœ€å®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œå¹¶ä½¿ç”¨ <code>@FeignClient</code> æ³¨è§£ï¼Œå³å¯å®Œæˆå¯¹è¿œç¨‹æœåŠ¡çš„è°ƒç”¨ã€‚Ribbonï¼ˆç°å·²è¢« Spring Cloud LoadBalancer æ›¿ä»£ï¼‰åˆ™æä¾›äº†å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡èƒ½åŠ›ï¼Œå½“ä» Eureka è·å–åˆ°å¤šä¸ªæœåŠ¡å®ä¾‹åœ°å€æ—¶ï¼ŒRibbon ä¼šæ ¹æ®é…ç½®çš„ç­–ç•¥ï¼ˆå¦‚è½®è¯¢ã€éšæœºï¼‰é€‰æ‹©ä¸€ä¸ªå®ä¾‹è¿›è¡Œè°ƒç”¨ã€‚</li><li><strong>ä½¿ç”¨</strong>: æ·»åŠ  <code>spring-cloud-starter-openfeign</code> ä¾èµ–ï¼Œåœ¨å¯åŠ¨ç±»ä¸ŠåŠ  <code>@EnableFeignClients</code>ï¼Œåˆ›å»ºæ¥å£å¹¶ä½¿ç”¨ <code>@FeignClient(&quot;service-name&quot;)</code> æ³¨è§£ã€‚</li></ul></li><li><strong>ç†”æ–­ä¸é™çº§ (Circuit Breaker): Hystrix</strong><ul><li><strong>ä½œç”¨</strong>: å½“æŸä¸ªä¸‹æ¸¸æœåŠ¡å‡ºç°æ•…éšœæˆ–å“åº”ç¼“æ…¢æ—¶ï¼Œä¸ºäº†é˜²æ­¢æ•…éšœåœ¨ç³»ç»Ÿä¸­è”“å»¶ï¼ˆå³â€œæœåŠ¡é›ªå´©â€ï¼‰ï¼Œç†”æ–­å™¨ä¼šå¿«é€Ÿå¤±è´¥ï¼Œæš‚æ—¶åˆ‡æ–­å¯¹è¯¥æœåŠ¡çš„è°ƒç”¨ã€‚åŒæ—¶ï¼Œå¯ä»¥æ‰§è¡Œä¸€ä¸ªé¢„å®šä¹‰çš„é™çº§é€»è¾‘ï¼ˆFallbackï¼‰ï¼Œä¾‹å¦‚è¿”å›ä¸€ä¸ªç¼“å­˜çš„ã€é»˜è®¤çš„æˆ–å‹å¥½çš„æç¤ºä¿¡æ¯ã€‚</li><li><strong>çŠ¶æ€</strong>: Hystrix å·²è¿›å…¥ç»´æŠ¤æ¨¡å¼ï¼Œå®˜æ–¹æ¨èä½¿ç”¨ Resilience4j æˆ–å…¶ä»–æ›¿ä»£æ–¹æ¡ˆã€‚</li></ul></li><li><strong>API ç½‘å…³ (API Gateway): Zuul</strong><ul><li><strong>ä½œç”¨</strong>: ä½œä¸ºç³»ç»Ÿçš„ç»Ÿä¸€å…¥å£ï¼ŒAPI ç½‘å…³è´Ÿè´£è¯·æ±‚è·¯ç”±ã€åè®®è½¬æ¢ã€æƒé™æ ¡éªŒã€æµé‡æ§åˆ¶ã€æ—¥å¿—ç›‘æ§ç­‰ã€‚æ‰€æœ‰å¤–éƒ¨è¯·æ±‚éƒ½å…ˆç»è¿‡ç½‘å…³ï¼Œå†ç”±ç½‘å…³åˆ†å‘åˆ°åç«¯çš„å„ä¸ªå¾®æœåŠ¡ã€‚</li><li><strong>çŠ¶æ€</strong>: Zuul 1.x å·²è¿›å…¥ç»´æŠ¤æ¨¡å¼ï¼Œå®˜æ–¹æ¨èä½¿ç”¨ Spring Cloud Gatewayã€‚</li></ul></li></ul><hr><h5 id="Spring-Cloud-Alibaba-è¯¦è§£"><a href="#Spring-Cloud-Alibaba-è¯¦è§£" class="headerlink" title="Spring Cloud Alibaba è¯¦è§£"></a><strong>Spring Cloud Alibaba è¯¦è§£</strong></h5><p>Spring Cloud Alibaba è‡´åŠ›äºæä¾›å¾®æœåŠ¡å¼€å‘çš„ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆï¼Œæ˜¯ Spring Cloud ä½“ç³»çš„é‡è¦å®ç°ã€‚å®ƒé›†æˆäº†é˜¿é‡Œå·´å·´å¼€æºçš„ä¼˜ç§€ç»„ä»¶ï¼Œä¸ºå¼€å‘è€…æä¾›äº†æ›´ç¬¦åˆå›½å†…æŠ€æœ¯ç”Ÿæ€çš„é€‰æ‹©ã€‚</p><ul><li><strong>æœåŠ¡æ³¨å†Œä¸å‘ç° &amp; åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒ: Nacos</strong><ul><li><strong>ä½œç”¨</strong>: Nacos (Naming and Configuration Service) æ˜¯ä¸€ä¸ªåŠŸèƒ½ä¸°å¯Œçš„å¹³å°ï¼Œå®Œç¾æ•´åˆäº†<strong>æœåŠ¡æ³¨å†Œå‘ç°</strong>å’Œ<strong>é…ç½®ç®¡ç†</strong>ä¸¤å¤§æ ¸å¿ƒåŠŸèƒ½ã€‚<ul><li><strong>æœåŠ¡å‘ç°</strong>: ä¸ Eureka ç±»ä¼¼ï¼Œæä¾›æœåŠ¡æ³¨å†Œã€å‘ç°å’Œå¥åº·æ£€æŸ¥ã€‚ä½† Nacos æ”¯æŒåŸºäº DNS å’Œ RPC çš„æœåŠ¡å‘ç°ï¼Œå¹¶æä¾›æ›´å®æ—¶çš„å¥åº·æ£€æŸ¥æœºåˆ¶ã€‚</li><li><strong>é…ç½®ç®¡ç†</strong>: å¯ä»¥ä½œä¸ºåˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒï¼Œå¯¹æ‰€æœ‰å¾®æœåŠ¡çš„é…ç½®è¿›è¡Œé›†ä¸­åŒ–ç®¡ç†ã€‚æ”¯æŒé…ç½®çš„çƒ­æ›´æ–°ï¼Œå³ä¿®æ”¹é…ç½®åæ— éœ€é‡å¯æœåŠ¡å³å¯ç”Ÿæ•ˆã€‚è¿˜æ”¯æŒé…ç½®çš„ç‰ˆæœ¬ç®¡ç†ã€ç°åº¦å‘å¸ƒç­‰é«˜çº§åŠŸèƒ½ã€‚</li></ul></li><li><strong>ä½¿ç”¨</strong>:<ol><li>å¼•å…¥ <code>spring-cloud-starter-alibaba-nacos-discovery</code> å’Œ <code>spring-cloud-starter-alibaba-nacos-config</code> ä¾èµ–ã€‚</li><li>åœ¨ <code>bootstrap.properties</code> (æˆ– <code>.yml</code>) æ–‡ä»¶ä¸­é…ç½® Nacos æœåŠ¡å™¨åœ°å€å’Œåº”ç”¨åã€‚</li><li>ä½¿ç”¨ <code>@Value</code> æˆ– <code>@ConfigurationProperties</code> æ³¨è§£å³å¯åŠ¨æ€è·å–å’Œåˆ·æ–°é…ç½®ã€‚</li></ol></li></ul></li><li><strong>ç†”æ–­ã€é™çº§ä¸æµé‡æ§åˆ¶: Sentinel</strong><ul><li><strong>ä½œç”¨</strong>: Sentinel æ˜¯é¢å‘åˆ†å¸ƒå¼æœåŠ¡æ¶æ„çš„â€œæµé‡çš„å®ˆæŠ¤è€…â€ï¼Œä»¥æµé‡ä¸ºåˆ‡å…¥ç‚¹ï¼Œä»<strong>æµé‡æ§åˆ¶ã€ç†”æ–­é™çº§ã€ç³»ç»Ÿè´Ÿè½½ä¿æŠ¤</strong>ç­‰å¤šä¸ªç»´åº¦ä¿æŠ¤æœåŠ¡çš„ç¨³å®šæ€§ã€‚ç›¸è¾ƒäº Hystrixï¼ŒSentinel åŠŸèƒ½æ›´å¼ºå¤§ï¼Œæä¾›äº†å¯è§†åŒ–çš„ç›‘æ§å’Œé…ç½®å¹³å°ï¼Œå¹¶ä¸”æ”¯æŒçƒ­ç‚¹å‚æ•°é™æµç­‰ç²¾ç»†åŒ–æ§åˆ¶ã€‚</li><li><strong>æ ¸å¿ƒæ¦‚å¿µ</strong>:<ul><li><strong>èµ„æº (Resource)</strong>: Sentinel ä¸­ä¸€åˆ‡çš†èµ„æºï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªæ–¹æ³•ã€ä¸€æ®µä»£ç æˆ–ä¸€ä¸ªæœåŠ¡ URLã€‚</li><li><strong>è§„åˆ™ (Rule)</strong>: å®šä¹‰å¦‚ä½•ä¿æŠ¤èµ„æºï¼ŒåŒ…æ‹¬æµæ§è§„åˆ™ã€é™çº§è§„åˆ™ã€ç³»ç»Ÿä¿æŠ¤è§„åˆ™ç­‰ã€‚</li></ul></li><li><strong>ä½¿ç”¨</strong>:<ol><li>å¼•å…¥ <code>spring-cloud-starter-alibaba-sentinel</code> ä¾èµ–ã€‚</li><li>é…ç½® Sentinel æ§åˆ¶å°åœ°å€ã€‚</li><li>é€šè¿‡ <code>@SentinelResource</code> æ³¨è§£æ¥å®šä¹‰èµ„æºï¼Œå¹¶æŒ‡å®š Fallback (é™çº§é€»è¾‘) å’Œ BlockHandler (æµæ§&#x2F;ç†”æ–­é€»è¾‘)ã€‚</li></ol></li></ul></li><li><strong>åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ: Seata</strong><ul><li><strong>ä½œç”¨</strong>: Seata æ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼Œæä¾›äº†é«˜æ€§èƒ½ä¸”æ˜“äºä½¿ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡æœåŠ¡ã€‚å®ƒæ”¯æŒå¤šç§äº‹åŠ¡æ¨¡å¼ï¼ŒåŒ…æ‹¬ ATï¼ˆè‡ªåŠ¨è¡¥å¿ï¼‰ã€TCCã€Saga å’Œ XA æ¨¡å¼ï¼Œæ—¨åœ¨è§£å†³å¾®æœåŠ¡æ¶æ„ä¸‹çš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚</li><li><strong>ä½¿ç”¨</strong>: å¼•å…¥ <code>spring-cloud-starter-alibaba-seata</code> ä¾èµ–ï¼Œé…ç½® Seata Server åœ°å€ï¼Œå¹¶ä½¿ç”¨ <code>@GlobalTransactional</code> æ³¨è§£å¼€å¯å…¨å±€äº‹åŠ¡ã€‚</li></ul></li></ul><hr><h4 id="2-åˆ†å¸ƒå¼IDï¼šé›ªèŠ±ç®—æ³•ï¼ˆSnowflakeï¼‰"><a href="#2-åˆ†å¸ƒå¼IDï¼šé›ªèŠ±ç®—æ³•ï¼ˆSnowflakeï¼‰" class="headerlink" title="2. åˆ†å¸ƒå¼IDï¼šé›ªèŠ±ç®—æ³•ï¼ˆSnowflakeï¼‰"></a><strong>2. åˆ†å¸ƒå¼IDï¼šé›ªèŠ±ç®—æ³•ï¼ˆSnowflakeï¼‰</strong></h4><h5 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a><strong>åŸç†</strong></h5><p>Snowflake æ˜¯ Twitter å¼€æºçš„ä¸€ç§åˆ†å¸ƒå¼ ID ç”Ÿæˆç®—æ³•ï¼Œå®ƒèƒ½ç”Ÿæˆä¸€ä¸ª 64 ä½çš„ <code>long</code> å‹æ•°å­—ä½œä¸ºå…¨å±€å”¯ä¸€ IDã€‚è¿™ä¸ª 64 ä½çš„ ID ç”±å››éƒ¨åˆ†æ„æˆï¼š</p><ul><li><strong>1ä½ç¬¦å·ä½</strong>: æœ€é«˜ä½ï¼Œå›ºå®šä¸º0ï¼Œè¡¨ç¤ºæ­£æ•°ï¼Œæ— å®é™…æ„ä¹‰ã€‚</li><li><strong>41ä½æ—¶é—´æˆ³ (Timestamp)</strong>: ç²¾ç¡®åˆ°æ¯«ç§’çº§ï¼Œæ˜¯ <code>(å½“å‰æ—¶é—´æˆ³ - èµ·å§‹æ—¶é—´æˆ³)</code> çš„å·®å€¼ã€‚41ä½å¯ä»¥è¡¨ç¤º (241âˆ’1) æ¯«ç§’ï¼Œå¤§çº¦å¯ä»¥ä½¿ç”¨ 69 å¹´ã€‚</li><li><strong>10ä½å·¥ä½œæœºå™¨ID (Worker ID)</strong>: è¿™ 10 ä½å¯ä»¥è¢«çµæ´»åˆ’åˆ†ï¼Œä¾‹å¦‚å‰ 5 ä½ä»£è¡¨æ•°æ®ä¸­å¿ƒ ID (Datacenter ID)ï¼Œå 5 ä½ä»£è¡¨æœºå™¨ ID (Machine ID)ã€‚è¿™æ ·æ€»å…±å¯ä»¥æ”¯æŒ 210&#x3D;1024 å°æœºå™¨ã€‚</li><li><strong>12ä½åºåˆ—å· (Sequence)</strong>: è¡¨ç¤ºåœ¨åŒä¸€æ¯«ç§’å†…ï¼ŒåŒä¸€å°æœºå™¨ä¸Šç”Ÿæˆçš„ ID åºåˆ—å·ã€‚12ä½æ„å‘³ç€æ¯å°æœºå™¨æ¯æ¯«ç§’å¯ä»¥ç”Ÿæˆ 212&#x3D;4096 ä¸ªä¸åŒçš„ IDã€‚</li></ul><h5 id="ä¼˜ç‚¹-1"><a href="#ä¼˜ç‚¹-1" class="headerlink" title="ä¼˜ç‚¹"></a><strong>ä¼˜ç‚¹</strong></h5><ul><li><strong>å…¨å±€å”¯ä¸€</strong>: é€šè¿‡æ—¶é—´æˆ³ã€æœºå™¨ ID å’Œåºåˆ—å·çš„ç»„åˆï¼Œå¯ä»¥ä¿è¯åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„ ID å”¯ä¸€æ€§ã€‚</li><li><strong>è¶‹åŠ¿é€’å¢</strong>: ç”±äºæ—¶é—´æˆ³åœ¨é«˜ä½ï¼Œæ‰€ä»¥ç”Ÿæˆçš„ ID æ•´ä½“ä¸Šæ˜¯æŒ‰æ—¶é—´è¶‹åŠ¿é€’å¢çš„ï¼Œè¿™å¯¹äºæ•°æ®åº“ç´¢å¼•ï¼ˆç‰¹åˆ«æ˜¯ B+æ ‘ï¼‰éå¸¸å‹å¥½ï¼Œå¯ä»¥å‡å°‘é¡µåˆ†è£‚ï¼Œæé«˜æ’å…¥æ€§èƒ½ã€‚</li><li><strong>é«˜æ€§èƒ½</strong>: ID åœ¨æœ¬åœ°ç”Ÿæˆï¼Œä¸ä¾èµ–ä»»ä½•å¤–éƒ¨æœåŠ¡ï¼ˆå¦‚æ•°æ®åº“æˆ– Redisï¼‰ï¼Œç”Ÿæˆæ•ˆç‡æé«˜ã€‚</li><li><strong>é«˜å¯ç”¨</strong>: ç®—æ³•æœ¬èº«ä¸ä¾èµ–ç½‘ç»œï¼Œéƒ¨ç½²ç®€å•ï¼Œå…·æœ‰å¾ˆé«˜çš„å¯ç”¨æ€§ã€‚</li></ul><h5 id="é¢è¯•é¢˜ï¼šâ€œé›ªèŠ±ç®—æ³•æœ‰æ—¶é’Ÿå›æ‹¨é—®é¢˜ï¼Œå¦‚ä½•è§£å†³ï¼Ÿâ€"><a href="#é¢è¯•é¢˜ï¼šâ€œé›ªèŠ±ç®—æ³•æœ‰æ—¶é’Ÿå›æ‹¨é—®é¢˜ï¼Œå¦‚ä½•è§£å†³ï¼Ÿâ€" class="headerlink" title="é¢è¯•é¢˜ï¼šâ€œé›ªèŠ±ç®—æ³•æœ‰æ—¶é’Ÿå›æ‹¨é—®é¢˜ï¼Œå¦‚ä½•è§£å†³ï¼Ÿâ€"></a><strong>é¢è¯•é¢˜ï¼šâ€œé›ªèŠ±ç®—æ³•æœ‰æ—¶é’Ÿå›æ‹¨é—®é¢˜ï¼Œå¦‚ä½•è§£å†³ï¼Ÿâ€</strong></h5><p>å›ç­”è¦ç‚¹:</p><p>æ—¶é’Ÿå›æ‹¨æ˜¯æŒ‡æœåŠ¡å™¨æ—¶é—´è¢«åŒæ­¥åˆ°ä¸€ä¸ªè¿‡å»çš„æ—¶é—´ç‚¹ã€‚å¦‚æœç®—æ³•ä¸åšå¤„ç†ï¼Œå¯èƒ½ä¼šç”Ÿæˆé‡å¤çš„ IDã€‚è§£å†³æ–¹æ¡ˆé€šå¸¸æ˜¯ï¼šåœ¨ç”Ÿæˆ ID æ—¶ï¼Œè®°å½•ä¸Šä¸€æ¬¡ç”Ÿæˆ ID æ—¶æ‰€ä½¿ç”¨çš„æ—¶é—´æˆ³ã€‚å½“å‘ç°å½“å‰æ—¶é—´æˆ³å°äºä¸Šæ¬¡è®°å½•çš„æ—¶é—´æˆ³æ—¶ï¼Œå°±æ„å‘³ç€å‘ç”Ÿäº†æ—¶é’Ÿå›æ‹¨ã€‚</p><ul><li><strong>æ–¹æ¡ˆä¸€ï¼ˆæ‹’ç»æœåŠ¡ï¼‰</strong>: ç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œæ‹’ç»ç”Ÿæˆ IDï¼Œç­‰å¾…æ—¶é’Ÿæ¢å¤æ­£å¸¸ã€‚è¿™ç§æ–¹æ¡ˆç®€å•ï¼Œä½†ä¼šæš‚æ—¶å½±å“å¯ç”¨æ€§ï¼Œé€‚åˆå¯¹ ID è¿ç»­æ€§è¦æ±‚ä¸é«˜çš„åœºæ™¯ã€‚</li><li><strong>æ–¹æ¡ˆäºŒï¼ˆç­‰å¾…è¿½èµ¶ï¼‰</strong>: å¦‚æœå›æ‹¨å¹…åº¦å¾ˆå°ï¼ˆæ¯”å¦‚å‡ æ¯«ç§’ï¼‰ï¼Œç¨‹åºå¯ä»¥ <code>while(currentTime &lt; lastTimestamp)</code> è¿™æ ·è‡ªæ—‹ç­‰å¾…ï¼Œç›´åˆ°å½“å‰æ—¶é—´è¿½èµ¶ä¸Šä¸Šæ¬¡çš„æ—¶é—´æˆ³ã€‚è¿™ä¼šé€ æˆçŸ­æš‚çš„çº¿ç¨‹é˜»å¡ã€‚</li><li><strong>æ–¹æ¡ˆä¸‰ï¼ˆä½¿ç”¨å¤‡ç”¨ä½ï¼‰</strong>: ä¸€äº›æ”¹è¿›ç‰ˆçš„é›ªèŠ±ç®—æ³•ä¼šé¢„ç•™å‡ ä½ä½œä¸ºæ‰©å±•ä½ï¼Œå½“å‘ç”Ÿæ—¶é’Ÿå›æ‹¨æ—¶ï¼Œåœ¨è¿™å‡ ä½ä¸Šåšè‡ªå¢ï¼Œä»è€Œåœ¨çŸ­æ—¶é—´å›æ‹¨å†…ä»èƒ½ç”Ÿæˆä¸åŒçš„ IDã€‚ï¼ˆè¿™ç§æ–¹æ¡ˆå®ç°è¾ƒä¸ºå¤æ‚ï¼‰</li><li><strong>ä¸šç•Œå®è·µï¼ˆç¾å›¢ Leafï¼‰</strong>: åœ¨å‘ç”Ÿæ—¶é’Ÿå›æ‹¨æ—¶ï¼Œåˆ‡æ¢åˆ°å¦ä¸€ç§å¤‡ç”¨ ID ç”Ÿæˆç­–ç•¥ï¼ˆå¦‚å·æ®µæ¨¡å¼ï¼‰ï¼Œæˆ–è€…ç›´æ¥æŠ¥é”™ã€‚</li></ul><hr><h4 id="3-RBACï¼ˆåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼‰"><a href="#3-RBACï¼ˆåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼‰" class="headerlink" title="3. RBACï¼ˆåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼‰"></a><strong>3. RBACï¼ˆåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼‰</strong></h4><h5 id="åŸç†-1"><a href="#åŸç†-1" class="headerlink" title="åŸç†"></a><strong>åŸç†</strong></h5><p>RBAC (Role-Based Access Control) æ˜¯ä¸€ç§ä¸»æµä¸”çµæ´»çš„æƒé™ç®¡ç†æ¨¡å‹ã€‚å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯åœ¨ <strong>ç”¨æˆ· (User)</strong> å’Œ <strong>æƒé™ (Permission)</strong> ä¹‹é—´å¼•å…¥ä¸€ä¸ªä¸­é—´å±‚â€”â€”<strong>è§’è‰² (Role)</strong>ã€‚æƒé™ä¸å†ç›´æ¥æˆäºˆç”¨æˆ·ï¼Œè€Œæ˜¯æˆäºˆè§’è‰²ï¼›ç„¶åå°†è§’è‰²åˆ†é…ç»™ç”¨æˆ·ã€‚è¿™æ ·ï¼Œç”¨æˆ·ä¸æƒé™å®ç°äº†è§£è€¦ï¼Œå½“éœ€è¦ä¿®æ”¹å¤§é‡ç”¨æˆ·çš„æƒé™æ—¶ï¼Œåªéœ€ä¿®æ”¹ä»–ä»¬å…±åŒæ‹¥æœ‰çš„è§’è‰²çš„æƒé™å³å¯ï¼Œæå¤§åœ°ç®€åŒ–äº†æƒé™ç®¡ç†å’Œç»´æŠ¤ã€‚</p><h5 id="æ ¸å¿ƒä¸‰è¦ç´ "><a href="#æ ¸å¿ƒä¸‰è¦ç´ " class="headerlink" title="æ ¸å¿ƒä¸‰è¦ç´ "></a><strong>æ ¸å¿ƒä¸‰è¦ç´ </strong></h5><ul><li><strong>ç”¨æˆ· (User)</strong>: ç³»ç»Ÿæ“ä½œçš„ä¸»ä½“ã€‚</li><li><strong>è§’è‰² (Role)</strong>: æƒé™çš„é›†åˆï¼Œä»£è¡¨äº†ä¸€ç»„ç‰¹å®šçš„èŒè´£æˆ–èº«ä»½ï¼Œå¦‚â€œç®¡ç†å‘˜â€ã€â€œæ–‡ç« ç¼–è¾‘â€ã€â€œæ™®é€šä¼šå‘˜â€ã€‚</li><li><strong>æƒé™ (Permission)</strong>: å¯¹ç³»ç»Ÿä¸­ç‰¹å®šèµ„æºè¿›è¡Œç‰¹å®šæ“ä½œçš„è®¸å¯ã€‚é€šå¸¸ç”¨ä¸€ä¸ªå­—ç¬¦ä¸²è¡¨ç¤ºï¼Œå¦‚ <code>user:create</code>ã€<code>order:delete</code>ã€<code>article:publish</code>ã€‚</li></ul><h5 id="é¢è¯•é¢˜ï¼šâ€œè¯·è®¾è®¡ä¸€ä¸ª-RBAC-æƒé™ç®¡ç†ç³»ç»Ÿçš„æ•°æ®åº“è¡¨ç»“æ„ã€‚â€"><a href="#é¢è¯•é¢˜ï¼šâ€œè¯·è®¾è®¡ä¸€ä¸ª-RBAC-æƒé™ç®¡ç†ç³»ç»Ÿçš„æ•°æ®åº“è¡¨ç»“æ„ã€‚â€" class="headerlink" title="é¢è¯•é¢˜ï¼šâ€œè¯·è®¾è®¡ä¸€ä¸ª RBAC æƒé™ç®¡ç†ç³»ç»Ÿçš„æ•°æ®åº“è¡¨ç»“æ„ã€‚â€"></a><strong>é¢è¯•é¢˜ï¼šâ€œè¯·è®¾è®¡ä¸€ä¸ª RBAC æƒé™ç®¡ç†ç³»ç»Ÿçš„æ•°æ®åº“è¡¨ç»“æ„ã€‚â€</strong></h5><p>å›ç­”è¦ç‚¹:</p><p>ä¸€ä¸ªåŸºç¡€çš„ RBAC æ¨¡å‹è‡³å°‘éœ€è¦äº”å¼ è¡¨ï¼š</p><ul><li><strong>ç”¨æˆ·è¡¨ (t_user)</strong>: å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ã€‚<ul><li><code>user_id</code> (ä¸»é”®), <code>username</code>, <code>password</code>, â€¦</li></ul></li><li><strong>è§’è‰²è¡¨ (t_role)</strong>: å­˜å‚¨è§’è‰²ä¿¡æ¯ã€‚<ul><li><code>role_id</code> (ä¸»é”®), <code>role_name</code> (è§’è‰²å, å¦‚â€ç®¡ç†å‘˜â€), <code>role_key</code> (è§’è‰²æ ‡è¯†, å¦‚â€adminâ€), â€¦</li></ul></li><li><strong>æƒé™è¡¨ (t_permission)</strong>: å­˜å‚¨å…·ä½“çš„æƒé™ç‚¹ä¿¡æ¯ã€‚<ul><li><code>permission_id</code> (ä¸»é”®), <code>permission_name</code> (æƒé™åç§°, å¦‚â€œæ–°å¢ç”¨æˆ·â€), <code>permission_code</code> (æƒé™æ ‡è¯†, å¦‚ <code>user:add</code>), <code>parent_id</code> (ç”¨äºèœå•å±‚çº§), â€¦</li></ul></li><li><strong>ç”¨æˆ·-è§’è‰²å…³è”è¡¨ (t_user_role)</strong>: å­˜å‚¨ç”¨æˆ·å’Œè§’è‰²çš„å¤šå¯¹å¤šå…³ç³»ã€‚<ul><li><code>user_id</code> (å¤–é”®), <code>role_id</code> (å¤–é”®)ã€‚(ä¸»é”®æ˜¯ <code>user_id</code> å’Œ <code>role_id</code> çš„è”åˆä¸»é”®)</li></ul></li><li><strong>è§’è‰²-æƒé™å…³è”è¡¨ (t_role_permission)</strong>: å­˜å‚¨è§’è‰²å’Œæƒé™çš„å¤šå¯¹å¤šå…³ç³»ã€‚<ul><li><code>role_id</code> (å¤–é”®), <code>permission_id</code> (å¤–é”®)ã€‚(ä¸»é”®æ˜¯ <code>role_id</code> å’Œ <code>permission_id</code> çš„è”åˆä¸»é”®)</li></ul></li></ul><hr><h4 id="4-Redis-è¿›é˜¶è¯¦è§£"><a href="#4-Redis-è¿›é˜¶è¯¦è§£" class="headerlink" title="4. Redis è¿›é˜¶è¯¦è§£"></a><strong>4. Redis è¿›é˜¶è¯¦è§£</strong></h4><h5 id="æ ¸å¿ƒç‰¹ç‚¹"><a href="#æ ¸å¿ƒç‰¹ç‚¹" class="headerlink" title="æ ¸å¿ƒç‰¹ç‚¹"></a><strong>æ ¸å¿ƒç‰¹ç‚¹</strong></h5><ul><li><strong>åŸºäºå†…å­˜</strong>: Redis æ˜¯ä¸€ä¸ªå†…å­˜æ•°æ®ç»“æ„å­˜å‚¨ç³»ç»Ÿï¼Œæ‰€æœ‰æ•°æ®éƒ½å­˜æ”¾åœ¨å†…å­˜ä¸­ï¼Œå› æ­¤è¯»å†™é€Ÿåº¦æå¿«ã€‚</li><li><strong>å•çº¿ç¨‹æ¨¡å‹</strong>: Redis çš„æ ¸å¿ƒç½‘ç»œæ¨¡å‹å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚æ˜¯å•çº¿ç¨‹çš„ã€‚è¿™é¿å…äº†å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œé”ç«äº‰å¸¦æ¥çš„å¼€é”€ã€‚ï¼ˆæ³¨æ„ï¼šRedis 6.0 ä¹‹åå¼•å…¥äº†å¤šçº¿ç¨‹æ¥å¤„ç† I&#x2F;Oï¼Œä½†æ‰§è¡Œå‘½ä»¤çš„æ ¸å¿ƒä»ç„¶æ˜¯å•çº¿ç¨‹ï¼‰ã€‚</li><li><strong>IOå¤šè·¯å¤ç”¨</strong>: å•çº¿ç¨‹èƒ½å®ç°é«˜æ€§èƒ½çš„å…³é”®åœ¨äºå®ƒä½¿ç”¨äº† IO å¤šè·¯å¤ç”¨æŠ€æœ¯ï¼ˆå¦‚ Linux ä¸‹çš„ epollï¼‰ã€‚è¯¥æŠ€æœ¯å…è®¸å•ä¸ªçº¿ç¨‹åŒæ—¶ç›‘å¬å¤šä¸ªç½‘ç»œè¿æ¥ä¸Šçš„ IO äº‹ä»¶ï¼Œå½“æŸä¸ªè¿æ¥å‡†å¤‡å¥½è¯»æˆ–å†™æ—¶ï¼Œæ‰å»å¤„ç†å®ƒï¼Œæå¤§åœ°æé«˜äº†å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚</li><li><strong>ä¸°å¯Œçš„æ•°æ®ç±»å‹</strong>: æ”¯æŒ String, Hash, List, Set, Sorted Set, Bitmap, HyperLogLog, GEO ç­‰å¤šç§æ•°æ®ç»“æ„ã€‚</li></ul><h5 id="ç¼“å­˜ä¸‰å¤§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ"><a href="#ç¼“å­˜ä¸‰å¤§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ" class="headerlink" title="ç¼“å­˜ä¸‰å¤§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ"></a><strong>ç¼“å­˜ä¸‰å¤§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</strong></h5><ul><li><strong>ç¼“å­˜ç©¿é€</strong>:<ul><li><strong>é—®é¢˜</strong>: å®¢æˆ·ç«¯æŸ¥è¯¢ä¸€ä¸ªæ•°æ®åº“å’Œç¼“å­˜ä¸­<strong>éƒ½</strong>ä¸å­˜åœ¨çš„æ•°æ®ã€‚è¿™å¯¼è‡´æ¯æ¬¡è¯·æ±‚éƒ½ä¼šç»•è¿‡ç¼“å­˜ï¼Œç›´æ¥æ‰“åˆ°æ•°æ®åº“ä¸Šï¼Œå½“æœ‰å¤§é‡æ­¤ç±»è¯·æ±‚æ—¶ï¼Œä¼šç»™æ•°æ®åº“å¸¦æ¥å·¨å¤§å‹åŠ›ã€‚</li><li><strong>è§£å†³</strong>:<ol><li><strong>ç¼“å­˜ç©ºå¯¹è±¡</strong>: å½“ä»æ•°æ®åº“æŸ¥è¯¢ä¸åˆ°æ•°æ®æ—¶ï¼Œä¹Ÿåœ¨ç¼“å­˜ä¸­å­˜å…¥ä¸€ä¸ªç‰¹æ®Šçš„ç©ºå€¼ï¼ˆå¦‚ <code>null</code> æˆ–ç‰¹å®šå­—ç¬¦ä¸²ï¼‰ï¼Œå¹¶è®¾ç½®ä¸€ä¸ªè¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´ã€‚</li><li><strong>å¸ƒéš†è¿‡æ»¤å™¨ (Bloom Filter)</strong>: åœ¨è®¿é—®ç¼“å­˜ä¹‹å‰ï¼Œå…ˆé€šè¿‡å¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­ key æ˜¯å¦<strong>å¯èƒ½</strong>å­˜åœ¨ã€‚å¸ƒéš†è¿‡æ»¤å™¨å¯ä»¥é«˜æ•ˆåœ°åˆ¤æ–­ä¸€ä¸ªå…ƒç´ <strong>ä¸€å®šä¸å­˜åœ¨</strong>ï¼Œä»è€Œåœ¨ç¬¬ä¸€å±‚å°±æ‹¦æˆªæ‰å¤§é‡æ— æ•ˆè¯·æ±‚ã€‚</li></ol></li></ul></li><li><strong>ç¼“å­˜å‡»ç©¿</strong>:<ul><li><strong>é—®é¢˜</strong>: æŸä¸ª<strong>çƒ­ç‚¹ Key</strong> åœ¨æŸä¸€æ—¶åˆ»çªç„¶å¤±æ•ˆï¼Œè€Œæ­¤æ—¶æ°å¥½æœ‰å¤§é‡çš„å¹¶å‘è¯·æ±‚è®¿é—®è¿™ä¸ª Keyï¼Œè¿™äº›è¯·æ±‚ä¼šåŒæ—¶ç©¿é€ç¼“å­˜ï¼Œç›´æ¥æ‰“åˆ°æ•°æ®åº“ä¸Šï¼Œå¯èƒ½å¯¼è‡´æ•°æ®åº“ç¬é—´å´©æºƒã€‚</li><li><strong>è§£å†³</strong>:<ol><li><strong>è®¾ç½®çƒ­ç‚¹ Key æ°¸ä¸è¿‡æœŸ</strong>: å¯¹äºä¸€äº›è®¿é—®æå…¶é¢‘ç¹ä¸”æ•°æ®ç›¸å¯¹å›ºå®šçš„çƒ­ç‚¹æ•°æ®ï¼Œå¯ä»¥è€ƒè™‘ä¸è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œé€šè¿‡åå°ä»»åŠ¡å®šæ—¶æ›´æ–°ã€‚</li><li><strong>ä½¿ç”¨åˆ†å¸ƒå¼é”</strong>: åœ¨æŸ¥è¯¢æ•°æ®åº“ä¹‹å‰ï¼Œå…ˆè·å–ä¸€ä¸ªè¯¥ Key å¯¹åº”çš„åˆ†å¸ƒå¼é”ã€‚åªæœ‰ç¬¬ä¸€ä¸ªè·å–åˆ°é”çš„çº¿ç¨‹æ‰èƒ½å»æŸ¥è¯¢æ•°æ®åº“å¹¶å›å†™ç¼“å­˜ï¼Œå…¶ä»–çº¿ç¨‹åˆ™ç­‰å¾…æˆ–ç›´æ¥è¿”å›ã€‚</li></ol></li></ul></li><li><strong>ç¼“å­˜é›ªå´©</strong>:<ul><li><strong>é—®é¢˜</strong>: å¤§é‡çš„ç¼“å­˜ Key åœ¨<strong>åŒä¸€æ—¶é—´é›†ä¸­å¤±æ•ˆ</strong>ï¼ˆä¾‹å¦‚ï¼Œåœ¨åº”ç”¨å¯åŠ¨æ—¶ç¼“å­˜äº†å¤§é‡æ•°æ®ï¼Œå¹¶è®¾ç½®äº†ç›¸åŒçš„è¿‡æœŸæ—¶é—´ï¼‰ï¼Œå¯¼è‡´æ‰€æœ‰è¯·æ±‚éƒ½ç¬é—´æ¶Œå‘æ•°æ®åº“ï¼Œé€ æˆæ•°æ®åº“å‹åŠ›å‰§å¢ç”šè‡³å®•æœºã€‚</li><li><strong>è§£å†³</strong>:<ol><li><strong>è¿‡æœŸæ—¶é—´åŠ éšæœºå€¼</strong>: åœ¨è®¾ç½®ç¼“å­˜çš„è¿‡æœŸæ—¶é—´æ—¶ï¼Œåœ¨ä¸€ä¸ªåŸºç¡€æ—¶é—´ä¸Šå¢åŠ ä¸€ä¸ªéšæœºæ•°ï¼Œä½¿å¾— Key çš„å¤±æ•ˆæ—¶é—´ç‚¹å°½å¯èƒ½åˆ†æ•£ã€‚</li><li><strong>å¤šçº§ç¼“å­˜</strong>: å»ºç«‹å¤šçº§ç¼“å­˜ä½“ç³»ï¼Œå¦‚ Nginx ç¼“å­˜ + Redis ç¼“å­˜ + JVM æœ¬åœ°ç¼“å­˜ï¼ˆCaffeine&#x2F;Guava Cacheï¼‰ã€‚</li><li><strong>ç†”æ–­é™çº§</strong>: ä½¿ç”¨ Hystrix æˆ– Sentinel ç­‰ç»„ä»¶ï¼Œå½“æ£€æµ‹åˆ°æ•°æ®åº“å‹åŠ›è¿‡å¤§æ—¶ï¼Œè¿›è¡Œç†”æ–­æˆ–é™çº§å¤„ç†ï¼Œæš‚æ—¶ä¸è®¿é—®æ•°æ®åº“ï¼Œè¿”å›ä¸€ä¸ªé»˜è®¤å€¼æˆ–æç¤ºä¿¡æ¯ã€‚</li></ol></li></ul></li></ul><hr><h4 id="5-æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼‰"><a href="#5-æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼‰" class="headerlink" title="5. æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼‰"></a><strong>5. æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼‰</strong></h4><h5 id="æ ¸å¿ƒä½œç”¨"><a href="#æ ¸å¿ƒä½œç”¨" class="headerlink" title="æ ¸å¿ƒä½œç”¨"></a><strong>æ ¸å¿ƒä½œç”¨</strong></h5><ul><li><strong>å¼‚æ­¥ (Asynchronous)</strong>: å°†è€—æ—¶çš„æ“ä½œï¼ˆå¦‚å‘é€é‚®ä»¶ã€ç”ŸæˆæŠ¥è¡¨ï¼‰ä½œä¸ºæ¶ˆæ¯æ”¾å…¥ MQï¼Œä¸»æµç¨‹å¯ä»¥ç«‹å³è¿”å›ï¼Œæ— éœ€ç­‰å¾…è¿™äº›æ“ä½œå®Œæˆï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„å“åº”é€Ÿåº¦å’Œååé‡ã€‚</li><li><strong>è§£è€¦ (Decoupling)</strong>: ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´é€šè¿‡ MQ è¿›è¡Œé€šä¿¡ï¼Œæ— éœ€ç›´æ¥ç›¸äº’ä¾èµ–ã€‚ä»»ä½•ä¸€æ–¹çš„ä¿®æ”¹ã€å®•æœºæˆ–å‡çº§éƒ½ä¸ä¼šå½±å“åˆ°å¦ä¸€æ–¹ï¼Œå¢å¼ºäº†ç³»ç»Ÿçš„çµæ´»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</li><li><strong>å‰Šå³° (Peak Shaving)</strong>: åœ¨ç§’æ€ã€å¤§ä¿ƒç­‰é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œå°†ç¬æ—¶æ¶Œå…¥çš„å¤§é‡è¯·æ±‚æš‚å­˜åœ¨ MQ ä¸­ï¼Œä¸‹æ¸¸çš„æ¶ˆè´¹è€…ç³»ç»Ÿå¯ä»¥æŒ‰ç…§è‡ªå·±çš„å¤„ç†èƒ½åŠ›ï¼Œå¹³ç¨³åœ°ä» MQ ä¸­æ‹‰å–å¹¶å¤„ç†è¯·æ±‚ï¼Œé¿å…äº†æµé‡æ´ªå³°ç›´æ¥å†²å®ä¸‹æ¸¸æœåŠ¡ã€‚</li></ul><h5 id="é¢è¯•é¢˜ï¼šâ€œè¯·åˆ—ä¸¾ä½ ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—æ—¶å¯èƒ½é‡åˆ°çš„é—®é¢˜ï¼Œå¹¶ç»™å‡ºè§£å†³æ–¹æ¡ˆã€‚â€"><a href="#é¢è¯•é¢˜ï¼šâ€œè¯·åˆ—ä¸¾ä½ ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—æ—¶å¯èƒ½é‡åˆ°çš„é—®é¢˜ï¼Œå¹¶ç»™å‡ºè§£å†³æ–¹æ¡ˆã€‚â€" class="headerlink" title="é¢è¯•é¢˜ï¼šâ€œè¯·åˆ—ä¸¾ä½ ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—æ—¶å¯èƒ½é‡åˆ°çš„é—®é¢˜ï¼Œå¹¶ç»™å‡ºè§£å†³æ–¹æ¡ˆã€‚â€"></a><strong>é¢è¯•é¢˜ï¼šâ€œè¯·åˆ—ä¸¾ä½ ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—æ—¶å¯èƒ½é‡åˆ°çš„é—®é¢˜ï¼Œå¹¶ç»™å‡ºè§£å†³æ–¹æ¡ˆã€‚â€</strong></h5><p><strong>å›ç­”è¦ç‚¹</strong>:</p><ul><li><strong>æ¶ˆæ¯ä¸¢å¤± (Message Loss)</strong>:<ul><li><strong>é—®é¢˜</strong>: æ¶ˆæ¯ä»ç”Ÿäº§è€…å‘å‡ºåï¼Œç”±äºç½‘ç»œæˆ– MQ æœåŠ¡æ•…éšœï¼Œæœªèƒ½æˆåŠŸåˆ°è¾¾æ¶ˆè´¹è€…ã€‚</li><li><strong>è§£å†³</strong>:<ol><li><strong>ç”Ÿäº§è€…ç«¯</strong>: å¼€å¯ç”Ÿäº§è€…çš„ <code>confirm</code> æˆ– <code>ack</code> æœºåˆ¶ï¼Œç¡®ä¿æ¶ˆæ¯è¢« MQ æˆåŠŸæ¥æ”¶ã€‚å¦‚æœå‘é€å¤±è´¥ï¼Œå¯ä»¥è¿›è¡Œé‡è¯•ã€‚</li><li><strong>MQ æœåŠ¡ç«¯</strong>: å¯¹æ¶ˆæ¯è¿›è¡ŒæŒä¹…åŒ–ï¼Œé˜²æ­¢ MQ å®•æœºå¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ï¼ˆå¦‚ RabbitMQ çš„æŒä¹…åŒ–é˜Ÿåˆ—å’Œæ¶ˆæ¯ï¼ŒKafka çš„ç£ç›˜å­˜å‚¨ï¼‰ã€‚</li><li><strong>æ¶ˆè´¹è€…ç«¯</strong>: æ¶ˆè´¹è€…åœ¨å¤„ç†å®Œä¸šåŠ¡é€»è¾‘åï¼Œå†å‘ MQ å‘é€ç¡®è®¤åº”ç­”ï¼ˆ<code>ack</code>ï¼‰ã€‚å¦‚æœå¤„ç†è¿‡ç¨‹ä¸­æ¶ˆè´¹è€…å®•æœºï¼ŒMQ æ²¡æœ‰æ”¶åˆ° <code>ack</code>ï¼Œä¼šå°†è¯¥æ¶ˆæ¯é‡æ–°æŠ•é€’ç»™å…¶ä»–æ¶ˆè´¹è€…ã€‚</li></ol></li></ul></li><li><strong>é‡å¤æ¶ˆè´¹ (Duplicate Consumption)</strong>:<ul><li><strong>é—®é¢˜</strong>: ç”±äºç½‘ç»œæŠ–åŠ¨ã€æ¶ˆè´¹è€… <code>ack</code> è¶…æ—¶ç­‰åŸå› ï¼ŒMQ å¯èƒ½ä¼šé‡å¤æŠ•é€’åŒä¸€æ¡æ¶ˆæ¯ã€‚</li><li><strong>è§£å†³</strong>: æ ¸å¿ƒæ˜¯ä¿è¯æ¶ˆè´¹é€»è¾‘çš„<strong>å¹‚ç­‰æ€§ (Idempotence)</strong>ã€‚å³å¤šæ¬¡æ‰§è¡ŒåŒä¸€ä¸ªæ“ä½œï¼Œç»“æœéƒ½æ˜¯ç›¸åŒçš„ã€‚å®ç°æ–¹å¼æœ‰ï¼š<ol><li>åœ¨æ•°æ®åº“ä¸­ä¸ºä¸šåŠ¡æ“ä½œåˆ›å»ºä¸€ä¸ª<strong>å”¯ä¸€é”®</strong>ï¼Œæ¯æ¬¡æ“ä½œå‰å…ˆæ£€æŸ¥è¯¥å”¯ä¸€é”®æ˜¯å¦å­˜åœ¨ã€‚</li><li>ä½¿ç”¨ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„<strong>ä¸šåŠ¡ ID</strong>ï¼ˆå¦‚è®¢å•å·ï¼‰ï¼Œåœ¨å¤„ç†æ¶ˆæ¯å‰ï¼Œå…ˆæŸ¥è¯¢è¿™ä¸ª ID æ˜¯å¦å·²ç»è¢«å¤„ç†è¿‡ï¼ˆä¾‹å¦‚ï¼Œå­˜å…¥ Redis Set æˆ–æ•°æ®åº“ï¼‰ã€‚</li></ol></li></ul></li><li><strong>æ¶ˆæ¯å †ç§¯ (Message Backlog)</strong>:<ul><li><strong>é—®é¢˜</strong>: ç”Ÿäº§è€…çš„ç”Ÿäº§é€Ÿåº¦è¿œå¤§äºæ¶ˆè´¹è€…çš„æ¶ˆè´¹é€Ÿåº¦ï¼Œå¯¼è‡´å¤§é‡æ¶ˆæ¯åœ¨ MQ ä¸­ç§¯å‹ï¼Œå ç”¨èµ„æºå¹¶å¯èƒ½å¯¼è‡´æ¶ˆæ¯è¶…æ—¶ä¸¢å¤±ã€‚</li><li><strong>è§£å†³</strong>:<ol><li><strong>æ°´å¹³æ‰©å±•æ¶ˆè´¹è€…</strong>: å¢åŠ æ¶ˆè´¹è€…å®ä¾‹çš„æ•°é‡ï¼Œå¹¶è¡Œå¤„ç†æ¶ˆæ¯ã€‚è¿™æ˜¯æœ€å¸¸ç”¨çš„æ–¹æ³•ã€‚</li><li><strong>ä¼˜åŒ–æ¶ˆè´¹é€»è¾‘</strong>: æ£€æŸ¥æ¶ˆè´¹è€…ä»£ç ï¼Œçœ‹æ˜¯å¦æœ‰å¯ä»¥ä¼˜åŒ–çš„æ…¢æ“ä½œï¼ˆå¦‚ I&#x2F;O å¯†é›†å‹æ“ä½œï¼‰ã€‚</li><li><strong>æ¶ˆæ¯åˆ†ç‰‡&#x2F;åˆ†åŒº</strong>: å¯¹ Topic è¿›è¡Œåˆ†åŒºï¼ˆPartitioningï¼‰ï¼Œè®©ä¸åŒçš„æ¶ˆè´¹è€…ç»„å¤„ç†ä¸åŒçš„åˆ†åŒºï¼Œæé«˜å¹¶å‘åº¦ã€‚</li><li><strong>å¢åŠ é¢„è­¦ç›‘æ§</strong>: å¯¹æ¶ˆæ¯å †ç§¯æ•°é‡è®¾ç½®é˜ˆå€¼ï¼Œè¾¾åˆ°é˜ˆå€¼æ—¶åŠæ—¶å‘Šè­¦ï¼Œäººå·¥ä»‹å…¥ã€‚</li></ol></li></ul></li></ul><hr><h4 id="6-åˆ†å¸ƒå¼é”è¯¦è§£"><a href="#6-åˆ†å¸ƒå¼é”è¯¦è§£" class="headerlink" title="6. åˆ†å¸ƒå¼é”è¯¦è§£"></a><strong>6. åˆ†å¸ƒå¼é”è¯¦è§£</strong></h4><h5 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a><strong>ä½œç”¨</strong></h5><p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿç¯å¢ƒä¸‹ï¼Œå¤šä¸ªè¿›ç¨‹æˆ–æœåŠ¡å™¨ä¸Šçš„å¤šä¸ªçº¿ç¨‹éœ€è¦è®¿é—®åŒä¸€ä¸ªå…±äº«èµ„æºæ—¶ï¼Œä¸ºäº†ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§å’Œæ“ä½œçš„åŸå­æ€§ï¼Œéœ€è¦ä¸€ç§æœºåˆ¶æ¥ç¡®ä¿åœ¨åŒä¸€æ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯èƒ½å¤ŸæŒæœ‰é”å¹¶è®¿é—®è¯¥èµ„æºã€‚</p><h5 id="å®ç°æ–¹æ¡ˆå¯¹æ¯”"><a href="#å®ç°æ–¹æ¡ˆå¯¹æ¯”" class="headerlink" title="å®ç°æ–¹æ¡ˆå¯¹æ¯”"></a><strong>å®ç°æ–¹æ¡ˆå¯¹æ¯”</strong></h5><table><thead><tr><th>å®ç°æ–¹å¼</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>åŸºäºæ•°æ®åº“</strong></td><td>å®ç°ç®€å•ï¼Œç›´æ¥åˆ©ç”¨æ•°æ®åº“ï¼ˆå¦‚å”¯ä¸€ç´¢å¼•ã€æ‚²è§‚é” <code>for update</code>ï¼‰ã€‚</td><td>æ€§èƒ½å¼€é”€å¤§ï¼Œæœ‰é”åº“é”è¡¨çš„é£é™©ï¼Œä¸å¯é‡å…¥ï¼Œä¸æ˜¯é˜»å¡é”ï¼Œæ•°æ®åº“å•ç‚¹æ•…éšœé—®é¢˜ã€‚</td><td>å¹¶å‘åº¦ä¸é«˜çš„ç®€å•åœºæ™¯ã€‚</td></tr><tr><td><strong>åŸºäº ZooKeeper</strong></td><td>å¯é æ€§é«˜ï¼Œå¤©ç„¶æ”¯æŒé˜»å¡é”å’Œå¯é‡å…¥ï¼Œè§£å†³æ­»é”é—®é¢˜ï¼ˆä¸´æ—¶èŠ‚ç‚¹ï¼‰ï¼Œæ— é”è¿‡æœŸé—®é¢˜ï¼Œæ”¯æŒå…¬å¹³é”ã€‚</td><td>æ€§èƒ½ä¸å¦‚ Redisï¼Œå®ç°å¤æ‚ï¼Œä¾èµ– ZK é›†ç¾¤ã€‚</td><td>å¯¹å¯é æ€§è¦æ±‚æé«˜ï¼Œä¸”èƒ½å®¹å¿ä¸€å®šæ€§èƒ½æŸè€—çš„åœºæ™¯ï¼Œå¦‚åˆ†å¸ƒå¼åè°ƒã€‚</td></tr><tr><td><strong>åŸºäº Redis</strong></td><td>æ€§èƒ½æé«˜ï¼Œå®ç°ç›¸å¯¹ç®€å•ï¼Œæœ‰æˆç†Ÿçš„æ¡†æ¶ (Redisson) å¯ç”¨ã€‚</td><td>å¯é æ€§ç›¸å¯¹ ZK ç¨å·®ï¼Œéœ€è¦å¤„ç†é”è¿‡æœŸå’Œä¸šåŠ¡æœªæ‰§è¡Œå®Œçš„é—®é¢˜ï¼Œéå…¬å¹³é”ã€‚</td><td>äº’è”ç½‘é«˜å¹¶å‘ã€å¯¹æ€§èƒ½è¦æ±‚é«˜çš„ç»å¤§å¤šæ•°åœºæ™¯ã€‚</td></tr></tbody></table><h5 id="åŸºäº-Redis-çš„å®ç°è¿›é˜¶"><a href="#åŸºäº-Redis-çš„å®ç°è¿›é˜¶" class="headerlink" title="åŸºäº Redis çš„å®ç°è¿›é˜¶"></a><strong>åŸºäº Redis çš„å®ç°è¿›é˜¶</strong></h5><ul><li><p>åŠ é”çš„æ­£ç¡®å§¿åŠ¿:</p><p>ä½¿ç”¨ SET key value NX EX time å‘½ä»¤ã€‚</p><ul><li><p><code>SET key value</code>: è®¾ç½®é”®å€¼ã€‚<code>value</code> é€šå¸¸æ˜¯ä¸€ä¸ªå”¯ä¸€çš„éšæœºå­—ç¬¦ä¸²ï¼ˆå¦‚ UUIDï¼‰ï¼Œç”¨äºæ ‡è¯†é”çš„æŒæœ‰è€…ã€‚</p></li><li><p><code>NX</code>: (if Not eXists)ï¼Œç¡®ä¿åªæœ‰åœ¨ key ä¸å­˜åœ¨æ—¶æ‰èƒ½è®¾ç½®æˆåŠŸï¼Œå®ç°äº†â€œåŠ é”â€çš„åŸå­æ€§ã€‚</p></li><li><p>EX time: è®¾ç½®ä¸€ä¸ªè‡ªåŠ¨è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰ï¼Œé˜²æ­¢å› å®¢æˆ·ç«¯å®•æœºè€Œå¯¼è‡´æ­»é”ã€‚</p><p>è¿™ä¸‰ä¸ªå‚æ•°å¿…é¡»åœ¨ä¸€ä¸ªå‘½ä»¤ä¸­æ‰§è¡Œï¼Œä¿è¯åŸå­æ€§ã€‚</p></li></ul></li><li><p><strong>è§£é”çš„æ­£ç¡®å§¿åŠ¿ï¼šLua è„šæœ¬</strong></p><ul><li><p><strong>ä¸ºä»€ä¹ˆéœ€è¦ Lua</strong>: è§£é”æ“ä½œåŒ…å«â€œåˆ¤æ–­â€å’Œâ€œåˆ é™¤â€ä¸¤æ­¥ï¼š1. <code>GET</code> é”çš„ <code>value</code>ï¼Œåˆ¤æ–­æ˜¯å¦ä¸è‡ªå·±åŠ é”æ—¶è®¾ç½®çš„éšæœºå­—ç¬¦ä¸²ç›¸ç­‰ã€‚2. å¦‚æœç›¸ç­‰ï¼Œåˆ™ <code>DEL</code> é”ã€‚å¦‚æœä¸ç”¨ Lua è„šæœ¬ï¼Œåœ¨æ‰§è¡Œå®Œç¬¬ä¸€æ­¥åï¼Œè‹¥è¯¥çº¿ç¨‹é˜»å¡ï¼Œæ­¤æ—¶é”æ°å¥½è¿‡æœŸï¼Œå¦ä¸€ä¸ªçº¿ç¨‹è·å–äº†é”ï¼Œé‚£ä¹ˆå½“åŸçº¿ç¨‹æ¢å¤æ‰§è¡Œç¬¬äºŒæ­¥æ—¶ï¼Œå°±ä¼š<strong>è¯¯åˆ æ‰æ–°çº¿ç¨‹çš„é”</strong>ã€‚</p></li><li><p><strong>Lua è„šæœ¬ç¤ºä¾‹</strong>:</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- è„šæœ¬æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šKEYS[1] æ˜¯é”çš„ keyï¼ŒARGV[1] æ˜¯åŠ é”æ—¶è®¾ç½®çš„å”¯ä¸€å€¼</span></span><br><span class="line"><span class="keyword">if</span> redis.call(<span class="string">&#x27;get&#x27;</span>, KEYS[<span class="number">1</span>]) == ARGV[<span class="number">1</span>] <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">return</span> redis.call(<span class="string">&#x27;del&#x27;</span>, KEYS[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></li></ul><p>Lua è„šæœ¬å¯ä»¥ç¡®ä¿å¤šä¸ªå‘½ä»¤åœ¨ Redis æœåŠ¡ç«¯è¢«åŸå­æ€§åœ°æ‰§è¡Œï¼Œæœç»äº†ä¸Šè¿°é—®é¢˜ã€‚</p></li><li><p><strong>Redis ä¹è§‚é”ï¼šWATCH å‘½ä»¤</strong></p><ul><li><p><strong>ä½œç”¨</strong>: <code>WATCH</code> å‘½ä»¤å¯ä»¥ç›‘è§†ä¸€ä¸ªæˆ–å¤šä¸ª keyï¼Œå¦‚æœåœ¨äº‹åŠ¡ <code>EXEC</code> æ‰§è¡Œä¹‹å‰ï¼Œä»»ä½•ä¸€ä¸ªè¢«ç›‘è§†çš„ key è¢«å…¶ä»–å‘½ä»¤ä¿®æ”¹äº†ï¼Œé‚£ä¹ˆæ•´ä¸ªäº‹åŠ¡å°†è¢«å–æ¶ˆï¼Œ<code>EXEC</code> è¿”å› <code>nil</code>ã€‚</p></li><li><p><strong>åŸç†</strong>: è¿™æ˜¯ä¸€ç§<strong>æ£€æŸ¥åè®¾ç½® (Check-And-Set, CAS)</strong> çš„å®ç°ã€‚å®ƒä¸æ˜¯çœŸæ­£çš„åŠ é”ï¼Œè€Œæ˜¯åœ¨æ›´æ–°æ•°æ®æ—¶æ£€æŸ¥æ•°æ®æ˜¯å¦è¢«ä¿®æ”¹è¿‡ã€‚</p></li><li><p><strong>ä½¿ç”¨åœºæ™¯</strong>: é€‚ç”¨äº<strong>è¯»å¤šå†™å°‘</strong>çš„å¹¶å‘åœºæ™¯ï¼Œå¯ä»¥å‡å°‘é”çš„å¼€é”€ã€‚ä¾‹å¦‚ï¼Œæ›´æ–°å•†å“åº“å­˜ã€‚</p><ol><li><p><code>WATCH stock_key</code> &#x2F;&#x2F; ç›‘è§†åº“å­˜</p></li><li><p><code>current_stock = GET stock_key</code> &#x2F;&#x2F; è·å–å½“å‰åº“å­˜</p></li><li><p>(åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­åˆ¤æ–­ <code>current_stock</code> æ˜¯å¦è¶³å¤Ÿ)</p></li><li><p><code>MULTI</code> &#x2F;&#x2F; å¼€å¯äº‹åŠ¡</p></li><li><p><code>SET stock_key new_stock</code> &#x2F;&#x2F; å‡†å¤‡æ›´æ–°åº“å­˜</p></li><li><p>EXEC &#x2F;&#x2F; æ‰§è¡Œäº‹åŠ¡</p><p>å¦‚æœä» WATCH åˆ° EXEC ä¹‹é—´ stock_key è¢«å…¶ä»–å®¢æˆ·ç«¯ä¿®æ”¹ï¼ŒEXEC å°†å¤±è´¥ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯éœ€è¦é‡è¯•æ•´ä¸ªæ“ä½œã€‚</p></li></ol></li></ul></li></ul><h5 id="é¢è¯•é¢˜ï¼šâ€œRedis-åˆ†å¸ƒå¼é”é”è¿‡æœŸäº†ä½†ä¸šåŠ¡æ²¡æ‰§è¡Œå®Œæ€ä¹ˆåŠï¼Ÿâ€"><a href="#é¢è¯•é¢˜ï¼šâ€œRedis-åˆ†å¸ƒå¼é”é”è¿‡æœŸäº†ä½†ä¸šåŠ¡æ²¡æ‰§è¡Œå®Œæ€ä¹ˆåŠï¼Ÿâ€" class="headerlink" title="é¢è¯•é¢˜ï¼šâ€œRedis åˆ†å¸ƒå¼é”é”è¿‡æœŸäº†ä½†ä¸šåŠ¡æ²¡æ‰§è¡Œå®Œæ€ä¹ˆåŠï¼Ÿâ€"></a><strong>é¢è¯•é¢˜ï¼šâ€œRedis åˆ†å¸ƒå¼é”é”è¿‡æœŸäº†ä½†ä¸šåŠ¡æ²¡æ‰§è¡Œå®Œæ€ä¹ˆåŠï¼Ÿâ€</strong></h5><p>å›ç­”è¦ç‚¹:</p><p>è¿™æ˜¯åˆ†å¸ƒå¼é”çš„ä¸€ä¸ªç»å…¸é—®é¢˜ï¼Œè¢«ç§°ä¸ºé”çš„è¶…æ—¶ç»­æœŸé—®é¢˜ã€‚</p><ul><li><strong>é—®é¢˜æ ¹æº</strong>: æˆ‘ä»¬ç»™é”è®¾ç½®äº†ä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼Œæ¯”å¦‚ 30 ç§’ï¼Œä½†ä¸šåŠ¡æ‰§è¡Œäº† 35 ç§’ã€‚åœ¨ç¬¬ 30 ç§’æ—¶é”ä¼šè‡ªåŠ¨é‡Šæ”¾ï¼Œå…¶ä»–çº¿ç¨‹å°±èƒ½è·å–åˆ°é”ï¼Œå¯¼è‡´å¹¶å‘é—®é¢˜ã€‚</li><li><strong>è§£å†³æ–¹æ¡ˆï¼šâ€œçœ‹é—¨ç‹—â€(Watchdog)æœºåˆ¶</strong>ã€‚<ul><li><strong>åŸç†</strong>: æ¯”å¦‚ Java ä¸­çš„ Redisson æ¡†æ¶å°±å†…ç½®äº†çœ‹é—¨ç‹—ã€‚å½“ä¸€ä¸ªçº¿ç¨‹è·å–é”æˆåŠŸåï¼ŒRedisson ä¼šå¯åŠ¨ä¸€ä¸ªåå°çº¿ç¨‹ï¼ˆçœ‹é—¨ç‹—ï¼‰ï¼Œå®šæœŸï¼ˆä¾‹å¦‚æ¯ 10 ç§’ï¼‰æ£€æŸ¥è¯¥çº¿ç¨‹æ˜¯å¦è¿˜æŒæœ‰é”ã€‚å¦‚æœæŒæœ‰ï¼Œå¹¶ä¸”ä¸šåŠ¡ä»åœ¨æ‰§è¡Œï¼Œçœ‹é—¨ç‹—å°±ä¼šè‡ªåŠ¨ä¸ºè¿™ä¸ªé”<strong>å»¶é•¿è¿‡æœŸæ—¶é—´</strong>ï¼ˆç»­æœŸï¼‰ï¼Œæ¯”å¦‚å†ç»­ 30 ç§’ã€‚è¿™ä¸ªè¿‡ç¨‹ä¼šä¸€ç›´æŒç»­ï¼Œç›´åˆ°ä¸šåŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œçº¿ç¨‹ä¸»åŠ¨é‡Šæ”¾é”ï¼Œçœ‹é—¨ç‹—æ‰ä¼šåœæ­¢ã€‚</li><li><strong>æ€»ç»“</strong>: çœ‹é—¨ç‹—æœºåˆ¶é€šè¿‡åå°çº¿ç¨‹è‡ªåŠ¨ç»­æœŸï¼Œç¡®ä¿äº†åœ¨ä¸šåŠ¡æ‰§è¡Œå®Œæˆä¹‹å‰ï¼Œé”ä¸ä¼šå› ä¸ºè¶…æ—¶è€Œæå‰é‡Šæ”¾ï¼Œä»è€Œä¿è¯äº†é”çš„å¯é æ€§ã€‚</li></ul></li></ul><hr><h4 id="7-åˆ†å¸ƒå¼äº‹åŠ¡è¯¦è§£"><a href="#7-åˆ†å¸ƒå¼äº‹åŠ¡è¯¦è§£" class="headerlink" title="7. åˆ†å¸ƒå¼äº‹åŠ¡è¯¦è§£"></a><strong>7. åˆ†å¸ƒå¼äº‹åŠ¡è¯¦è§£</strong></h4><h5 id="ä½œç”¨-1"><a href="#ä½œç”¨-1" class="headerlink" title="ä½œç”¨"></a><strong>ä½œç”¨</strong></h5><p>åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œä¸€ä¸ªä¸šåŠ¡æ“ä½œå¯èƒ½éœ€è¦è°ƒç”¨å¤šä¸ªç‹¬ç«‹çš„æœåŠ¡æ¥å…±åŒå®Œæˆï¼ˆä¾‹å¦‚ï¼Œç”µå•†ä¸‹å•æ“ä½œéœ€è¦è°ƒç”¨è®¢å•æœåŠ¡ã€åº“å­˜æœåŠ¡ã€ç§¯åˆ†æœåŠ¡ï¼‰ã€‚åˆ†å¸ƒå¼äº‹åŠ¡æ—¨åœ¨ä¿è¯è¿™äº›è·¨æœåŠ¡çš„æ•°æ®åº“æ“ä½œèƒ½å¤Ÿéµå¾ª ACID åŸåˆ™ï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å›æ»šï¼Œä»¥ç¡®ä¿æ•°æ®çš„<strong>æœ€ç»ˆä¸€è‡´æ€§</strong>ã€‚</p><h5 id="è§£å†³æ–¹æ¡ˆæ·±å…¥åˆ†æ"><a href="#è§£å†³æ–¹æ¡ˆæ·±å…¥åˆ†æ" class="headerlink" title="è§£å†³æ–¹æ¡ˆæ·±å…¥åˆ†æ"></a><strong>è§£å†³æ–¹æ¡ˆæ·±å…¥åˆ†æ</strong></h5><ul><li><strong>XA (2PC&#x2F;3PC)</strong>: ä¸¤é˜¶æ®µ&#x2F;ä¸‰é˜¶æ®µæäº¤åè®®ã€‚<ul><li><strong>è§’è‰²</strong>: äº‹åŠ¡ç®¡ç†å™¨ (Transaction Manager, TM) å’Œ èµ„æºç®¡ç†å™¨ (Resource Manager, RM)ã€‚</li><li><strong>æµç¨‹ (2PC)</strong>:<ol><li><strong>å‡†å¤‡é˜¶æ®µ (Prepare)</strong>: TM é€šçŸ¥æ‰€æœ‰ RM å‡†å¤‡æäº¤ï¼ŒRM æ‰§è¡Œæœ¬åœ°äº‹åŠ¡å¹¶é”å®šèµ„æºï¼Œä½†ä¸æäº¤ï¼Œç„¶åå‘ TM æŠ¥å‘Šå‡†å¤‡å°±ç»ªã€‚</li><li><strong>æäº¤&#x2F;å›æ»šé˜¶æ®µ (Commit&#x2F;Rollback)</strong>: å¦‚æœæ‰€æœ‰ RM éƒ½å‡†å¤‡å°±ç»ªï¼ŒTM é€šçŸ¥æ‰€æœ‰ RM æäº¤ï¼›å¦åˆ™ï¼Œé€šçŸ¥æ‰€æœ‰ RM å›æ»šã€‚</li></ol></li><li><strong>è¯„ä»·</strong>: æ˜¯ä¸€ç§<strong>å¼ºä¸€è‡´æ€§</strong>çš„æ–¹æ¡ˆï¼Œä½†åè®®å¤æ‚ï¼Œæ€§èƒ½å·®ï¼ŒåŒæ­¥é˜»å¡æ¨¡å‹ä¼šé•¿æ—¶é—´é”å®šèµ„æºï¼Œä¸”åè°ƒå™¨å­˜åœ¨å•ç‚¹æ•…éšœé£é™©ï¼Œåœ¨äº’è”ç½‘é«˜å¹¶å‘åœºæ™¯ä¸‹<strong>å¾ˆå°‘ä½¿ç”¨</strong>ã€‚</li></ul></li><li><strong>TCC (Try-Confirm-Cancel)</strong>: è¡¥å¿å‹äº‹åŠ¡ã€‚<ul><li><strong>æ ¸å¿ƒ</strong>: æ˜¯ä¸€ç§<strong>ä¸šåŠ¡å±‚é¢</strong>çš„æŸ”æ€§äº‹åŠ¡æ–¹æ¡ˆï¼Œå¯¹ä»£ç ä¾µå…¥æ€§å¼ºã€‚</li><li><strong>æµç¨‹</strong>:<ol><li><strong>Try</strong>: å¯¹ä¸šåŠ¡èµ„æºè¿›è¡Œ<strong>æ£€æŸ¥å’Œé¢„ç•™</strong>ã€‚ä¾‹å¦‚ï¼Œæ‰£å‡åº“å­˜æ“ä½œï¼ŒTry é˜¶æ®µæ˜¯å†»ç»“åº“å­˜ã€‚</li><li><strong>Confirm</strong>: å¦‚æœæ‰€æœ‰æœåŠ¡çš„ Try é˜¶æ®µéƒ½æˆåŠŸï¼Œåˆ™æ‰§è¡Œæ‰€æœ‰æœåŠ¡çš„ <strong>Confirm</strong> æ“ä½œï¼ŒçœŸæ­£å®Œæˆä¸šåŠ¡ã€‚ä¾‹å¦‚ï¼Œå°†å†»ç»“çš„åº“å­˜çœŸå®æ‰£å‡ã€‚</li><li><strong>Cancel</strong>: å¦‚æœä»»ä½•ä¸€ä¸ªæœåŠ¡çš„ Try é˜¶æ®µå¤±è´¥ï¼Œåˆ™æ‰§è¡Œæ‰€æœ‰å·²æˆåŠŸæœåŠ¡çš„ <strong>Cancel</strong> æ“ä½œï¼Œé‡Šæ”¾é¢„ç•™çš„èµ„æºã€‚ä¾‹å¦‚ï¼Œè§£å†»ä¹‹å‰è¢«å†»ç»“çš„åº“å­˜ã€‚</li></ol></li><li><strong>è¯„ä»·</strong>: æ€§èƒ½è¾ƒå¥½ï¼Œæ•°æ®ä¸€è‡´æ€§é«˜äºå¯é æ¶ˆæ¯æ–¹æ¡ˆã€‚ä½†å¼€å‘æˆæœ¬æé«˜ï¼Œéœ€è¦ä¸ºæ¯ä¸ªæ“ä½œéƒ½ç¼–å†™ Try, Confirm, Cancel ä¸‰ä¸ªå¹‚ç­‰çš„æ–¹æ³•ã€‚</li></ul></li><li><strong>Saga æ¨¡å¼</strong>: é•¿äº‹åŠ¡è§£å†³æ–¹æ¡ˆã€‚<ul><li><strong>æ ¸å¿ƒ</strong>: å°†ä¸€ä¸ªå¤§çš„åˆ†å¸ƒå¼äº‹åŠ¡æ‹†åˆ†æˆå¤šä¸ª<strong>æœ¬åœ°äº‹åŠ¡</strong>ï¼Œæ¯ä¸ªæœ¬åœ°äº‹åŠ¡éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„<strong>è¡¥å¿æ“ä½œ</strong>ã€‚</li><li><strong>æµç¨‹</strong>:<ul><li><strong>æ­£å‘æ‰§è¡Œ</strong>: Saga åè°ƒå™¨æŒ‰é¡ºåºè°ƒç”¨ T1, T2, T3â€¦Tnã€‚</li><li><strong>åå‘è¡¥å¿</strong>: å¦‚æœ Ti å¤±è´¥ï¼ŒSaga ä¼šæŒ‰ç›¸åé¡ºåºè°ƒç”¨å‰é¢å·²æˆåŠŸäº‹åŠ¡çš„è¡¥å¿æ“ä½œ C(i-1)â€¦C2, C1ï¼Œè¿›è¡Œå›æ»šã€‚</li></ul></li><li><strong>ä¸ TCC å¯¹æ¯”</strong>:<ul><li>TCC æœ‰èµ„æº<strong>é¢„ç•™</strong>é˜¶æ®µï¼Œé”èµ„æºæ—¶é—´é•¿ï¼›Saga æ²¡æœ‰é¢„ç•™ï¼Œç›´æ¥æäº¤æœ¬åœ°äº‹åŠ¡ï¼Œé”èµ„æºæ—¶é—´çŸ­ã€‚</li><li>TCC çš„è¡¥å¿æ˜¯<strong>é€†å‘æ“ä½œ</strong> (Cancel)ï¼›Saga çš„è¡¥å¿æ˜¯<strong>åå‘æ“ä½œ</strong>ã€‚</li></ul></li><li><strong>è¯„ä»·</strong>: é€‚åˆäºä¸šåŠ¡æµç¨‹é•¿ã€éœ€è¦ä¿è¯æœ€ç»ˆä¸€è‡´æ€§çš„åœºæ™¯ã€‚åŒæ ·å¯¹ä»£ç æœ‰ä¾µå…¥æ€§ï¼Œéœ€è¦è®¾è®¡å¥½æ¯ä¸ªå­äº‹åŠ¡çš„è¡¥å¿é€»è¾‘ã€‚</li></ul></li><li><strong>åŸºäºå¯é æ¶ˆæ¯çš„æœ€ç»ˆä¸€è‡´æ€§ (å¸¸ç”¨)</strong>:<ul><li><strong>æ ¸å¿ƒ</strong>: è¿™æ˜¯å¾®æœåŠ¡æ¶æ„ä¸­<strong>æœ€å¸¸ç”¨</strong>çš„æŸ”æ€§äº‹åŠ¡æ–¹æ¡ˆã€‚</li><li><strong>åŸç†</strong>: æœåŠ¡ A åœ¨æ‰§è¡Œå®Œæœ¬åœ°äº‹åŠ¡åï¼Œå‘é€ä¸€æ¡æ¶ˆæ¯åˆ° MQã€‚æœåŠ¡ B è®¢é˜…è¯¥æ¶ˆæ¯ï¼Œæ¶ˆè´¹æ¶ˆæ¯å¹¶æ‰§è¡Œè‡ªå·±çš„æœ¬åœ°äº‹åŠ¡ã€‚</li><li><strong>å…³é”®é—®é¢˜</strong>: å¦‚ä½•ä¿è¯<strong>æœ¬åœ°äº‹åŠ¡æ‰§è¡Œ</strong>å’Œ<strong>æ¶ˆæ¯å‘é€</strong>çš„åŸå­æ€§ï¼Ÿ<ul><li><strong>äº‹åŠ¡æ¶ˆæ¯ (RocketMQ æ”¯æŒ)</strong>: ç”Ÿäº§è€…å…ˆå‘é€ä¸€æ¡â€œåŠæ¶ˆæ¯â€åˆ° MQï¼ŒMQ æ”¶åˆ°åä¸æŠ•é€’ã€‚ç„¶åç”Ÿäº§è€…æ‰§è¡Œæœ¬åœ°äº‹åŠ¡ã€‚å¦‚æœäº‹åŠ¡æˆåŠŸï¼Œåˆ™å‘ MQ å‘é€ç¡®è®¤ï¼ŒMQ æŠ•é€’è¯¥æ¶ˆæ¯ï¼›å¦‚æœäº‹åŠ¡å¤±è´¥ï¼Œåˆ™é€šçŸ¥ MQ åˆ é™¤è¯¥åŠæ¶ˆæ¯ã€‚</li><li><strong>æœ¬åœ°æ¶ˆæ¯è¡¨</strong>: ä¸šåŠ¡æ“ä½œå’Œâ€œå¾…å‘é€æ¶ˆæ¯â€è®°å½•åœ¨åŒä¸€æœ¬åœ°äº‹åŠ¡ä¸­ã€‚ä¸€ä¸ªåå°ä»»åŠ¡å®šæ—¶æ‰«æè¿™å¼ è¡¨ï¼Œå°†æ¶ˆæ¯å‘é€åˆ° MQï¼Œå‘é€æˆåŠŸåæ›´æ–°è¡¨çŠ¶æ€ã€‚</li></ul></li><li><strong>è¯„ä»·</strong>: å®ç°äº†æœåŠ¡é—´çš„è§£è€¦ï¼Œæ€§èƒ½é«˜ï¼Œååé‡å¤§ã€‚ä½†å®ƒä¸ä¿è¯æ•°æ®çš„å¼ºä¸€è‡´æ€§ï¼Œåªä¿è¯<strong>æœ€ç»ˆä¸€è‡´æ€§</strong>ï¼Œå­˜åœ¨ä¸€ä¸ªçŸ­æš‚çš„æ•°æ®ä¸ä¸€è‡´çŠ¶æ€çª—å£ã€‚éœ€è¦å¤„ç†å¥½æ¶ˆæ¯çš„å¯é æŠ•é€’å’Œå¹‚ç­‰æ¶ˆè´¹é—®é¢˜ã€‚</li></ul></li></ul><h3 id="Lua-è„šæœ¬è¯¦è§£-åœ¨-Redis-ä¸­çš„åº”ç”¨"><a href="#Lua-è„šæœ¬è¯¦è§£-åœ¨-Redis-ä¸­çš„åº”ç”¨" class="headerlink" title="Lua è„šæœ¬è¯¦è§£ (åœ¨ Redis ä¸­çš„åº”ç”¨)"></a><strong>Lua è„šæœ¬è¯¦è§£ (åœ¨ Redis ä¸­çš„åº”ç”¨)</strong></h3><h4 id="1-Lua-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#1-Lua-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1. Lua æ˜¯ä»€ä¹ˆï¼Ÿ"></a><strong>1. Lua æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h4><p>Lua æ˜¯ä¸€ç§è½»é‡çº§ã€å¯æ‰©å±•çš„è„šæœ¬è¯­è¨€ï¼Œè¢«è®¾è®¡ç”¨äºåµŒå…¥åˆ°å…¶ä»–åº”ç”¨ç¨‹åºä¸­ï¼Œä»è€Œä¸ºåº”ç”¨ç¨‹åºæä¾›çµæ´»çš„æ‰©å±•å’Œå®šåˆ¶åŠŸèƒ½ã€‚å®ƒä»¥å…¶ç®€æ´çš„è¯­æ³•ã€é«˜æ•ˆçš„æ‰§è¡Œæ€§èƒ½å’Œæå°çš„å†…å­˜å ç”¨è€Œé—»åã€‚</p><p>åœ¨ Redis çš„ä¸Šä¸‹æ–‡ä¸­ï¼ŒLua è„šæœ¬æä¾›äº†ä¸€ç§åœ¨ Redis æœåŠ¡å™¨ç«¯æ‰§è¡Œå¤æ‚é€»è¾‘çš„å¼ºå¤§èƒ½åŠ›ã€‚</p><h4 id="2-ä¸ºä»€ä¹ˆ-Redis-è¦æ”¯æŒ-Lua-è„šæœ¬ï¼Ÿ"><a href="#2-ä¸ºä»€ä¹ˆ-Redis-è¦æ”¯æŒ-Lua-è„šæœ¬ï¼Ÿ" class="headerlink" title="2. ä¸ºä»€ä¹ˆ Redis è¦æ”¯æŒ Lua è„šæœ¬ï¼Ÿ"></a><strong>2. ä¸ºä»€ä¹ˆ Redis è¦æ”¯æŒ Lua è„šæœ¬ï¼Ÿ</strong></h4><ul><li><strong>åŸå­æ€§ (Atomicity)</strong>: è¿™æ˜¯åœ¨ Redis ä¸­ä½¿ç”¨ Lua æœ€æ ¸å¿ƒçš„åŸå› ã€‚Redis ä¼šå°†æ•´ä¸ª Lua è„šæœ¬ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„å‘½ä»¤æ¥æ‰§è¡Œï¼Œ<strong>åœ¨è„šæœ¬æ‰§è¡ŒæœŸé—´ï¼Œä¸ä¼šæœ‰å…¶ä»–å®¢æˆ·ç«¯çš„å‘½ä»¤è¢«æ’å…¥æ‰§è¡Œ</strong>ã€‚è¿™å®Œç¾åœ°è§£å†³äº†éœ€è¦ç»„åˆå¤šä¸ª Redis å‘½ä»¤æ‰èƒ½å®Œæˆä¸€ä¸ªä¸šåŠ¡é€»è¾‘æ—¶ï¼Œå¯èƒ½å‡ºç°çš„ç«æ€æ¡ä»¶é—®é¢˜ã€‚ä¾‹å¦‚å‰é¢æåˆ°çš„â€œåˆ¤æ–­é”å¹¶åˆ é™¤é”â€çš„æ“ä½œï¼Œå¦‚æœåˆ†ä¸¤æ­¥æ‰§è¡Œï¼Œå°±ä¸æ˜¯åŸå­çš„ï¼Œè€Œå°è£…åœ¨ Lua è„šæœ¬ä¸­å°±æ˜¯åŸå­çš„ã€‚</li><li><strong>å‡å°‘ç½‘ç»œå¼€é”€</strong>: å¯¹äºéœ€è¦å¤šæ¬¡ä¸ Redis äº¤äº’çš„å¤æ‚æ“ä½œï¼Œå¯ä»¥å°†æ‰€æœ‰é€»è¾‘å°è£…åœ¨ä¸€ä¸ª Lua è„šæœ¬ä¸­ï¼Œä¸€æ¬¡æ€§å‘é€ç»™ Redis æœåŠ¡å™¨ã€‚å®¢æˆ·ç«¯åªéœ€å‘é€ä¸€æ¬¡è¯·æ±‚ï¼Œè€Œä¸æ˜¯å¤šæ¬¡ï¼Œè¿™æ˜¾è‘—å‡å°‘äº†å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„ç½‘ç»œå¾€è¿”æ—¶é—´ï¼ˆRTTï¼‰ï¼Œæå‡äº†æ€§èƒ½ã€‚</li><li><strong>ä»£ç å¤ç”¨</strong>: ç¼–å†™å¥½çš„ Lua è„šæœ¬å¯ä»¥è¢«ç¼“å­˜ï¼ˆé€šè¿‡ <code>SCRIPT LOAD</code> å‘½ä»¤ç”Ÿæˆä¸€ä¸ª SHA1 æ ¡éªŒå’Œï¼‰ï¼Œä¹‹åå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡è¿™ä¸ªç®€çŸ­çš„ SHA1 æ ¡éªŒå’Œï¼ˆä½¿ç”¨ <code>EVALSHA</code> å‘½ä»¤ï¼‰æ¥è°ƒç”¨è„šæœ¬ï¼Œé¿å…äº†æ¯æ¬¡éƒ½å‘é€å®Œæ•´çš„è„šæœ¬å†…å®¹ã€‚</li></ul><h4 id="3-å¦‚ä½•åœ¨-Redis-ä¸­ä½¿ç”¨-Lua-è„šæœ¬ï¼Ÿ"><a href="#3-å¦‚ä½•åœ¨-Redis-ä¸­ä½¿ç”¨-Lua-è„šæœ¬ï¼Ÿ" class="headerlink" title="3. å¦‚ä½•åœ¨ Redis ä¸­ä½¿ç”¨ Lua è„šæœ¬ï¼Ÿ"></a><strong>3. å¦‚ä½•åœ¨ Redis ä¸­ä½¿ç”¨ Lua è„šæœ¬ï¼Ÿ</strong></h4><p>é€šè¿‡ EVAL æˆ– EVALSHA å‘½ä»¤æ¥æ‰§è¡Œã€‚</p><p>EVAL script numkeys key [key â€¦] arg [arg â€¦]</p><ul><li><code>script</code>: è¦æ‰§è¡Œçš„ Lua è„šæœ¬å­—ç¬¦ä¸²ã€‚</li><li><code>numkeys</code>: åé¢è·Ÿçš„ <code>key</code> å‚æ•°çš„æ•°é‡ã€‚è¿™æœ‰åŠ©äº Redis æ­£ç¡®åœ°å°†å‚æ•°åŒºåˆ†ä¸ºé”®åï¼ˆ<code>KEYS</code>ï¼‰å’Œæ™®é€šå‚æ•°ï¼ˆ<code>ARGV</code>ï¼‰ï¼Œè¿™å¯¹äº Redis Cluster æ¨¡å¼ä¸‹çš„è·¯ç”±è‡³å…³é‡è¦ã€‚</li><li><code>key [key ...]</code>ï¼šè„šæœ¬ä¸­è¦æ“ä½œçš„ Redis é”®ï¼Œåœ¨ Lua è„šæœ¬ä¸­å¯ä»¥é€šè¿‡å…¨å±€å˜é‡ <code>KEYS</code> tableï¼ˆä¾‹å¦‚ <code>KEYS[1]</code>ï¼‰æ¥è®¿é—®ã€‚</li><li><code>arg [arg ...]</code>ï¼šä¼ é€’ç»™è„šæœ¬çš„é¢å¤–å‚æ•°ï¼Œåœ¨ Lua è„šæœ¬ä¸­å¯ä»¥é€šè¿‡å…¨å±€å˜é‡ <code>ARGV</code> tableï¼ˆä¾‹å¦‚ <code>ARGV[1]</code>ï¼‰æ¥è®¿é—®ã€‚</li></ul><p><strong>ç¤ºä¾‹ï¼šå®ç°ä¸€ä¸ªå®‰å…¨çš„åº“å­˜æ‰£å‡</strong></p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- è„šæœ¬é€»è¾‘ï¼šæ£€æŸ¥åº“å­˜æ˜¯å¦å……è¶³ï¼Œå¦‚æœå……è¶³åˆ™æ‰£å‡å¹¶è¿”å›1ï¼Œå¦åˆ™è¿”å›0</span></span><br><span class="line"><span class="comment">-- KEYS[1]: åº“å­˜çš„ keyï¼Œä¾‹å¦‚ &quot;product:1001:stock&quot;</span></span><br><span class="line"><span class="comment">-- ARGV[1]: æœ¬æ¬¡è¦æ‰£å‡çš„æ•°é‡</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> stock = <span class="built_in">tonumber</span>(redis.call(<span class="string">&#x27;get&#x27;</span>, KEYS[<span class="number">1</span>]))</span><br><span class="line"><span class="keyword">local</span> quantity = <span class="built_in">tonumber</span>(ARGV[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> stock &gt;= quantity <span class="keyword">then</span></span><br><span class="line">    redis.call(<span class="string">&#x27;decrby&#x27;</span>, KEYS[<span class="number">1</span>], quantity)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªè„šæœ¬ä¿è¯äº†â€œè¯»å–åº“å­˜â€å’Œâ€œæ‰£å‡åº“å­˜â€ä¸¤ä¸ªæ“ä½œçš„åŸå­æ€§ï¼Œé¿å…äº†åœ¨é«˜å¹¶å‘ä¸‹è¶…å–çš„é—®é¢˜ã€‚</p><hr><h3 id="Token-è®¤è¯æœºåˆ¶è¯¦è§£"><a href="#Token-è®¤è¯æœºåˆ¶è¯¦è§£" class="headerlink" title="Token è®¤è¯æœºåˆ¶è¯¦è§£"></a><strong>Token è®¤è¯æœºåˆ¶è¯¦è§£</strong></h3><h4 id="1-Token-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#1-Token-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1. Token æ˜¯ä»€ä¹ˆï¼Ÿ"></a><strong>1. Token æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h4><p>Tokenï¼ˆä»¤ç‰Œï¼‰æ˜¯åœ¨æœåŠ¡ç«¯ç”Ÿæˆçš„ä¸€ä¸²åŠ å¯†å­—ç¬¦ä¸²ï¼Œä½œä¸ºå®¢æˆ·ç«¯è¿›è¡Œè¯·æ±‚çš„ä¸€ä¸ªâ€œå‡­è¯â€ã€‚å½“ç”¨æˆ·ç¬¬ä¸€æ¬¡ç™»å½•æˆåŠŸåï¼ŒæœåŠ¡ç«¯ä¼šç”Ÿæˆä¸€ä¸ª Token å¹¶è¿”å›ç»™å®¢æˆ·ç«¯ã€‚ä¹‹åï¼Œå®¢æˆ·ç«¯åœ¨æ¯æ¬¡è¯·æ±‚éœ€è¦èº«ä»½è®¤è¯çš„æ¥å£æ—¶ï¼Œéƒ½éœ€è¦åœ¨è¯·æ±‚å¤´ï¼ˆé€šå¸¸æ˜¯ <code>Authorization</code> å­—æ®µï¼‰ä¸­æºå¸¦è¿™ä¸ª Tokenã€‚æœåŠ¡ç«¯æ¥æ”¶åˆ°è¯·æ±‚åï¼Œä¼šéªŒè¯ Token çš„æœ‰æ•ˆæ€§ï¼Œå¦‚æœéªŒè¯é€šè¿‡ï¼Œåˆ™å¤„ç†è¯¥è¯·æ±‚ï¼›å¦åˆ™ï¼Œæ‹’ç»è¯¥è¯·æ±‚ã€‚</p><p>ä¸€ä¸ªå…¸å‹çš„ Token æ˜¯ <strong>JWT (JSON Web Token)</strong>ï¼Œå®ƒç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œç”¨ <code>.</code> åˆ†éš”ï¼š</p><ul><li><strong>Header (å¤´éƒ¨)</strong>: åŒ…å«äº†ä»¤ç‰Œçš„ç±»å‹ï¼ˆ<code>typ</code>ï¼Œå³ JWTï¼‰å’Œæ‰€ä½¿ç”¨çš„ç­¾åç®—æ³•ï¼ˆ<code>alg</code>ï¼Œå¦‚ HMAC SHA256 æˆ– RSAï¼‰ã€‚</li><li><strong>Payload (è´Ÿè½½)</strong>: åŒ…å«äº†â€œå£°æ˜ (claims)â€ï¼Œæ˜¯å­˜æ”¾å®é™…éœ€è¦ä¼ é€’çš„æ•°æ®çš„åœ°æ–¹ã€‚ä¾‹å¦‚ç”¨æˆ·IDï¼ˆ<code>sub</code>ï¼‰ã€ç­¾å‘æ—¶é—´ï¼ˆ<code>iat</code>ï¼‰ã€è¿‡æœŸæ—¶é—´ï¼ˆ<code>exp</code>ï¼‰ä»¥åŠå…¶ä»–è‡ªå®šä¹‰çš„ç”¨æˆ·ä¿¡æ¯ã€‚<strong>æ³¨æ„ï¼šPayload éƒ¨åˆ†æ˜¯ Base64 ç¼–ç çš„ï¼Œå¹¶éåŠ å¯†ï¼Œå› æ­¤ä¸åº”å­˜æ”¾æ•æ„Ÿä¿¡æ¯ã€‚</strong></li><li><strong>Signature (ç­¾å)</strong>: å¯¹å‰ä¸¤éƒ¨åˆ†ï¼ˆHeader å’Œ Payloadï¼‰ä½¿ç”¨æŒ‡å®šçš„ç®—æ³•å’Œå­˜å‚¨åœ¨æœåŠ¡ç«¯çš„å¯†é’¥ï¼ˆsecretï¼‰è¿›è¡Œç­¾åã€‚è¿™ä¸ªç­¾åçš„ä½œç”¨æ˜¯<strong>é˜²æ­¢æ•°æ®è¢«ç¯¡æ”¹</strong>ã€‚æœåŠ¡ç«¯æ”¶åˆ° Token åï¼Œä¼šç”¨åŒæ ·çš„ç®—æ³•å’Œå¯†é’¥é‡æ–°è®¡ç®—ç­¾åï¼Œå¹¶ä¸ Token ä¸­çš„ç­¾åè¿›è¡Œæ¯”å¯¹ï¼Œè‹¥ä¸€è‡´ï¼Œåˆ™è¯´æ˜ Token æœªè¢«ç¯¡æ”¹ä¸”æ˜¯å¯ä¿¡çš„ã€‚</li></ul><h4 id="2-Token-è®¤è¯åŸç†ï¼ˆå·¥ä½œæµç¨‹ï¼‰"><a href="#2-Token-è®¤è¯åŸç†ï¼ˆå·¥ä½œæµç¨‹ï¼‰" class="headerlink" title="2. Token è®¤è¯åŸç†ï¼ˆå·¥ä½œæµç¨‹ï¼‰"></a><strong>2. Token è®¤è¯åŸç†ï¼ˆå·¥ä½œæµç¨‹ï¼‰</strong></h4><ol><li><strong>ç™»å½•</strong>: ç”¨æˆ·ä½¿ç”¨ç”¨æˆ·åå’Œå¯†ç å‘èµ·ç™»å½•è¯·æ±‚ã€‚</li><li><strong>éªŒè¯</strong>: æœåŠ¡ç«¯éªŒè¯ç”¨æˆ·çš„å‡­æ®æ˜¯å¦æ­£ç¡®ã€‚</li><li><strong>ç­¾å‘ Token</strong>: éªŒè¯æˆåŠŸåï¼ŒæœåŠ¡ç«¯æ ¹æ®ç”¨æˆ·IDã€è§’è‰²ç­‰ä¿¡æ¯ï¼Œç»“åˆå¯†é’¥ï¼ˆsecretï¼‰ï¼Œç”Ÿæˆä¸€ä¸ª Tokenã€‚</li><li><strong>è¿”å› Token</strong>: æœåŠ¡ç«¯å°†ç”Ÿæˆçš„ Token è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li><li><strong>å­˜å‚¨ Token</strong>: å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ã€Appï¼‰å°† Token å­˜å‚¨èµ·æ¥ï¼Œé€šå¸¸æ”¾åœ¨ <code>localStorage</code>ã€<code>sessionStorage</code> æˆ– <code>HttpOnly</code> çš„ Cookie ä¸­ã€‚</li><li><strong>æºå¸¦ Token è¯·æ±‚</strong>: å®¢æˆ·ç«¯åœ¨åç»­æ¯æ¬¡è¯·æ±‚å—ä¿æŠ¤çš„ API æ—¶ï¼Œéƒ½ä¼šåœ¨ HTTP è¯·æ±‚å¤´çš„ <code>Authorization</code> å­—æ®µä¸­é™„ä¸Š Tokenï¼Œæ ¼å¼é€šå¸¸ä¸º <code>Bearer &lt;token&gt;</code>ã€‚</li><li><strong>éªŒè¯ Token</strong>: æœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚åï¼Œä»è¯·æ±‚å¤´ä¸­è§£æå‡º Tokenï¼Œç„¶åï¼š<ul><li>éªŒè¯ç­¾åæ˜¯å¦æ­£ç¡®ï¼Œç¡®ä¿ Token æœªè¢«ç¯¡æ”¹ã€‚</li><li>æ£€æŸ¥ Token æ˜¯å¦åœ¨æœ‰æ•ˆæœŸå†…ï¼ˆ<code>exp</code> å£°æ˜ï¼‰ã€‚</li><li>å¦‚æœéªŒè¯é€šè¿‡ï¼Œåˆ™ä» Payload ä¸­è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œæ‰§è¡Œä¸šåŠ¡é€»è¾‘å¹¶è¿”å›ç»“æœã€‚</li><li>å¦‚æœéªŒè¯å¤±è´¥ï¼Œåˆ™è¿”å› <code>401 Unauthorized</code> é”™è¯¯ã€‚</li></ul></li></ol><h4 id="3-ä¸ºä»€ä¹ˆä½¿ç”¨-Tokenï¼Ÿï¼ˆä¸-Session-çš„åŒºåˆ«ï¼‰"><a href="#3-ä¸ºä»€ä¹ˆä½¿ç”¨-Tokenï¼Ÿï¼ˆä¸-Session-çš„åŒºåˆ«ï¼‰" class="headerlink" title="3. ä¸ºä»€ä¹ˆä½¿ç”¨ Tokenï¼Ÿï¼ˆä¸ Session çš„åŒºåˆ«ï¼‰"></a><strong>3. ä¸ºä»€ä¹ˆä½¿ç”¨ Tokenï¼Ÿï¼ˆä¸ Session çš„åŒºåˆ«ï¼‰</strong></h4><p>åœ¨ Web å¼€å‘æ—©æœŸï¼Œ<code>Session-Cookie</code> æœºåˆ¶æ˜¯ä¸»æµã€‚æœåŠ¡ç«¯åœ¨ç”¨æˆ·ç™»å½•ååˆ›å»ºä¸€ä¸ª Session å¯¹è±¡å­˜å‚¨åœ¨å†…å­˜æˆ– Redis ä¸­ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ª Session IDï¼Œé€šè¿‡ Cookie è¿”å›ç»™æµè§ˆå™¨ã€‚æµè§ˆå™¨åç»­è¯·æ±‚ä¼šè‡ªåŠ¨å¸¦ä¸Šè¿™ä¸ª Session IDï¼ŒæœåŠ¡ç«¯æ ¹æ® ID æ‰¾åˆ°å¯¹åº”çš„ Session ä¿¡æ¯æ¥è¯†åˆ«ç”¨æˆ·ã€‚</p><p><strong>Token æœºåˆ¶ç›¸æ¯” Session æœºåˆ¶ï¼Œæ ¸å¿ƒä¼˜åŠ¿åœ¨äºâ€œæ— çŠ¶æ€æ€§ (Statelessness)â€</strong>ï¼Œè¿™å¸¦æ¥äº†ä»¥ä¸‹å¥½å¤„ï¼š</p><table><thead><tr><th>ç‰¹æ€§å¯¹æ¯”</th><th>Session æœºåˆ¶</th><th>Token æœºåˆ¶</th><th>ä¼˜åŠ¿è¯´æ˜</th></tr></thead><tbody><tr><td><strong>çŠ¶æ€å­˜å‚¨</strong></td><td><strong>æœ‰çŠ¶æ€ (Stateful)</strong>ã€‚Session ä¿¡æ¯éœ€å­˜å‚¨åœ¨æœåŠ¡ç«¯ã€‚</td><td><strong>æ— çŠ¶æ€ (Stateless)</strong>ã€‚ç”¨æˆ·ä¿¡æ¯åŒ…å«åœ¨ Token çš„ Payload ä¸­ï¼ŒæœåŠ¡ç«¯æ— éœ€å­˜å‚¨ã€‚</td><td><strong>å‡è½»æœåŠ¡ç«¯å‹åŠ›</strong>ã€‚æœåŠ¡ç«¯ä¸éœ€è¦ä¸ºæ¯ä¸ªåœ¨çº¿ç”¨æˆ·ç»´æŠ¤ä¸€ä¸ª Session å¯¹è±¡ã€‚</td></tr><tr><td><strong>å¯æ‰©å±•æ€§</strong></td><td><strong>å·®</strong>ã€‚åœ¨åˆ†å¸ƒå¼æˆ–é›†ç¾¤ç¯å¢ƒä¸‹ï¼Œéœ€è¦è§£å†³ Session å…±äº«é—®é¢˜ï¼ˆå¦‚ Session Stickyã€Session Replicationã€é›†ä¸­å­˜å‚¨ï¼‰ã€‚</td><td><strong>å¥½</strong>ã€‚ç”±äºæœåŠ¡ç«¯ä¸å­˜å‚¨çŠ¶æ€ï¼Œä»»ä½•ä¸€å°æœåŠ¡å™¨åªè¦æœ‰ç›¸åŒçš„å¯†é’¥ï¼Œå°±èƒ½éªŒè¯ Tokenï¼Œå¤©ç„¶é€‚åˆåˆ†å¸ƒå¼å’Œå¾®æœåŠ¡æ¶æ„ã€‚</td><td><strong>è½»æ¾å®ç°æ°´å¹³æ‰©å±•</strong>ã€‚å¢åŠ æœåŠ¡å™¨èŠ‚ç‚¹æ— éœ€é¢å¤–é…ç½® Session å…±äº«ã€‚</td></tr><tr><td><strong>è·¨åŸŸæ”¯æŒ</strong></td><td><strong>æœ‰é™</strong>ã€‚åŸºäº Cookie çš„ Session æœºåˆ¶åœ¨è·¨åŸŸï¼ˆCORSï¼‰åœºæ™¯ä¸‹å¤„ç†èµ·æ¥æ¯”è¾ƒéº»çƒ¦ã€‚</td><td><strong>ä¼˜ç§€</strong>ã€‚Token å¯ä»¥é€šè¿‡ HTTP è¯·æ±‚å¤´å‘é€ï¼Œä¸å—åŒæºç­–ç•¥é™åˆ¶ï¼Œéå¸¸é€‚åˆå‰åç«¯åˆ†ç¦»å’Œè·¨åŸŸ API è°ƒç”¨ã€‚</td><td><strong>é€‚åº”ç°ä»£æ¶æ„</strong>ã€‚å®Œç¾æ”¯æŒ SPAï¼ˆå•é¡µåº”ç”¨ï¼‰ã€ç§»åŠ¨ App ç­‰å¤šç§å®¢æˆ·ç«¯ã€‚</td></tr><tr><td><strong>å®‰å…¨æ€§</strong></td><td>ä¾èµ– Cookie æœºåˆ¶ï¼Œå¯èƒ½é­å— CSRF æ”»å‡»ã€‚</td><td>å¦‚æœ Token å­˜å‚¨åœ¨ <code>localStorage</code>ï¼Œå¯èƒ½é­å— XSS æ”»å‡»ã€‚éœ€è¦ç»¼åˆè€ƒè™‘å­˜å‚¨æ–¹å¼ã€‚</td><td>ä¸¤è€…å„æœ‰å®‰å…¨é£é™©ç‚¹ï¼Œéœ€é…åˆå…¶ä»–å®‰å…¨ç­–ç•¥ã€‚Token æœºåˆ¶ä¸ä¾èµ– Cookieï¼Œæ›´çµæ´»ã€‚</td></tr><tr><td><strong>é€‚ç”¨æ€§</strong></td><td>é€‚åˆä¼ ç»Ÿçš„ã€ä¸€ä½“åŒ–çš„ Web åº”ç”¨ã€‚</td><td>é€‚åˆç°ä»£çš„ã€åˆ†å¸ƒå¼çš„ã€è·¨ç»ˆç«¯çš„ï¼ˆWeb, Mobile, IoTï¼‰åº”ç”¨æ¶æ„ã€‚</td><td>Token æ›´å…·é€šç”¨æ€§å’Œå‰ç»æ€§ã€‚</td></tr></tbody></table><h4 id="4-åŒä»¤ç‰Œç­–ç•¥-Access-Token-Refresh-Token"><a href="#4-åŒä»¤ç‰Œç­–ç•¥-Access-Token-Refresh-Token" class="headerlink" title="4. åŒä»¤ç‰Œç­–ç•¥ (Access Token + Refresh Token)"></a><strong>4. åŒä»¤ç‰Œç­–ç•¥ (Access Token + Refresh Token)</strong></h4><ul><li><strong>Q: ä¸ºä»€ä¹ˆä¸ç”¨å•ä¸ª Tokenï¼Ÿ</strong><ul><li><strong>å¦‚æœ Token æœ‰æ•ˆæœŸå¾ˆé•¿ï¼ˆå¦‚ä¸€ä¸ªæœˆï¼‰</strong>: å®‰å…¨é£é™©é«˜ã€‚ä¸€æ—¦ Token åœ¨æ­¤æœŸé—´è¢«çªƒå–ï¼Œæ”»å‡»è€…å¯ä»¥é•¿æ—¶é—´å†’å……ç”¨æˆ·èº«ä»½è¿›è¡Œæ“ä½œã€‚</li><li><strong>å¦‚æœ Token æœ‰æ•ˆæœŸå¾ˆçŸ­ï¼ˆå¦‚ 15 åˆ†é’Ÿï¼‰</strong>: ç”¨æˆ·ä½“éªŒå·®ã€‚ç”¨æˆ·éœ€è¦é¢‘ç¹åœ°é‡æ–°ç™»å½•ï¼Œè¿™æ˜¯æ— æ³•æ¥å—çš„ã€‚</li></ul></li><li><strong>A: åŒä»¤ç‰Œç­–ç•¥åº”è¿è€Œç”Ÿï¼Œå®Œç¾å¹³è¡¡äº†å®‰å…¨æ€§å’Œç”¨æˆ·ä½“éªŒã€‚</strong><ul><li><strong>Access Token (è®¿é—®ä»¤ç‰Œ)</strong>: å®ƒçš„æœ‰æ•ˆæœŸ<strong>éå¸¸çŸ­</strong>ï¼ˆå¦‚ 15 åˆ†é’Ÿåˆ° 1 å°æ—¶ï¼‰ã€‚å®ƒè¢«ç”¨äºè®¿é—®å—ä¿æŠ¤çš„èµ„æºï¼Œç”±äºå…¶ç”Ÿå‘½å‘¨æœŸçŸ­ï¼Œå³ä½¿è¢«çªƒå–ï¼Œæ”»å‡»è€…èƒ½é€ æˆçš„å±å®³ä¹Ÿæœ‰é™ã€‚</li><li><strong>Refresh Token (åˆ·æ–°ä»¤ç‰Œ)</strong>: å®ƒçš„æœ‰æ•ˆæœŸ<strong>å¾ˆé•¿</strong>ï¼ˆå¦‚ 7 å¤©æˆ– 30 å¤©ï¼‰ã€‚å®ƒçš„<strong>å”¯ä¸€ä½œç”¨</strong>æ˜¯ç”¨æ¥è·å–æ–°çš„ Access Tokenã€‚Refresh Token æœ¬èº«ä¸åŒ…å«ä»»ä½•æƒé™ä¿¡æ¯ï¼Œä¸èƒ½ç”¨äºç›´æ¥è®¿é—® APIã€‚</li></ul></li><li><strong>åŒä»¤ç‰Œå·¥ä½œæµç¨‹ï¼ˆé™é»˜åˆ·æ–°ï¼‰</strong><ol><li><strong>é¦–æ¬¡ç™»å½•</strong>: ç”¨æˆ·ç™»å½•æˆåŠŸï¼ŒæœåŠ¡ç«¯è¿”å›ä¸€ä¸ªçŸ­æœŸçš„ <code>Access Token</code> å’Œä¸€ä¸ªé•¿æœŸçš„ <code>Refresh Token</code>ã€‚å®¢æˆ·ç«¯å°†ä¸¤è€…éƒ½å­˜å‚¨èµ·æ¥ã€‚</li><li><strong>æ­£å¸¸è®¿é—®</strong>: å®¢æˆ·ç«¯ä½¿ç”¨ <code>Access Token</code> è®¿é—® APIã€‚æœåŠ¡ç«¯éªŒè¯ <code>Access Token</code> é€šè¿‡ï¼Œè¿”å›æ•°æ®ã€‚</li><li><strong>Access Token è¿‡æœŸ</strong>: å®¢æˆ·ç«¯å†æ¬¡ä½¿ç”¨è¿‡æœŸçš„ <code>Access Token</code> è®¿é—® APIï¼ŒæœåŠ¡ç«¯è¿”å› <code>401 Unauthorized</code> é”™è¯¯ï¼Œå¹¶å¯èƒ½å¸¦ä¸Šä¸€ä¸ªç‰¹å®šé”™è¯¯ç ï¼Œå‘ŠçŸ¥å®¢æˆ·ç«¯æ˜¯â€œä»¤ç‰Œè¿‡æœŸâ€è€Œéâ€œæ— æ•ˆä»¤ç‰Œâ€ã€‚</li><li><strong>é™é»˜åˆ·æ–°</strong>: å®¢æˆ·ç«¯çš„è¯·æ±‚æ‹¦æˆªå™¨æ•è·åˆ°è¿™ä¸ª <code>401</code> é”™è¯¯åï¼Œ<strong>ä¸ä¼šç«‹å³è·³è½¬åˆ°ç™»å½•é¡µ</strong>ã€‚è€Œæ˜¯è‡ªåŠ¨å‘èµ·ä¸€ä¸ªç‰¹æ®Šçš„è¯·æ±‚ï¼Œæºå¸¦é‚£ä¸ªé•¿æœŸçš„ <code>Refresh Token</code> å»è®¿é—®ä¸€ä¸ªä¸“é—¨çš„åˆ·æ–°æ¥å£ï¼ˆå¦‚ <code>/api/token/refresh</code>ï¼‰ã€‚</li><li><strong>ç­¾å‘æ–°ä»¤ç‰Œ</strong>: æœåŠ¡ç«¯éªŒè¯ <code>Refresh Token</code> çš„æœ‰æ•ˆæ€§ï¼ˆé€šå¸¸ä¼šå°†å…¶å­˜å‚¨åœ¨ Redis æˆ–æ•°æ®åº“ä¸­è¿›è¡Œæ¯”å¯¹ï¼Œä»¥å®ç°å¼ºåˆ¶ä¸‹çº¿åŠŸèƒ½ï¼‰ã€‚å¦‚æœéªŒè¯é€šè¿‡ï¼Œå°±ç”Ÿæˆä¸€ä¸ª<strong>æ–°çš„ Access Token</strong>ï¼ˆæœ‰æ—¶ä¹Ÿä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ <code>Refresh Token</code>ï¼Œè¿™è¢«ç§°ä¸ºåˆ·æ–°ä»¤ç‰Œæ»šåŠ¨ç­–ç•¥ï¼‰å¹¶è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li><li><strong>é‡è¯•è¯·æ±‚</strong>: å®¢æˆ·ç«¯æ”¶åˆ°æ–°çš„ <code>Access Token</code> åï¼Œç”¨å®ƒæ›¿æ¢æ‰æœ¬åœ°æ—§çš„ <code>Access Token</code>ï¼Œç„¶å<strong>è‡ªåŠ¨é‡æ–°å‘é€åˆšæ‰å› ä»¤ç‰Œè¿‡æœŸè€Œå¤±è´¥çš„é‚£ä¸ªè¯·æ±‚</strong>ã€‚</li><li><strong>æ— æ„Ÿä½“éªŒ</strong>: æ•´ä¸ªè¿‡ç¨‹å¯¹ç”¨æˆ·æ˜¯é€æ˜çš„ï¼Œç”¨æˆ·æ„Ÿè§‰ä¸åˆ°ä»¤ç‰Œå·²ç»è¿‡æœŸå¹¶è¢«åˆ·æ–°ï¼Œå®ç°äº†â€œé™é»˜åˆ·æ–°â€ï¼Œä½“éªŒéå¸¸æµç•…ã€‚</li><li><strong>Refresh Token è¿‡æœŸ</strong>: å¦‚æœ <code>Refresh Token</code> ä¹Ÿè¿‡æœŸäº†ï¼Œé‚£ä¹ˆåˆ·æ–°æ¥å£ä¼šè¿”å›é”™è¯¯ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯æ‰ä¼šçœŸæ­£æ¸…é™¤ç”¨æˆ·å‡­è¯å¹¶å¼•å¯¼ç”¨æˆ·é‡æ–°ç™»å½•ã€‚</li></ol></li></ul><h4 id="5-Token-ç›¸å…³åœºæ™¯ä¸é¢è¯•é¢˜"><a href="#5-Token-ç›¸å…³åœºæ™¯ä¸é¢è¯•é¢˜" class="headerlink" title="5. Token ç›¸å…³åœºæ™¯ä¸é¢è¯•é¢˜"></a><strong>5. Token ç›¸å…³åœºæ™¯ä¸é¢è¯•é¢˜</strong></h4><ul><li><strong>é¢è¯•é¢˜ 1ï¼šâ€œToken åº”è¯¥å­˜å‚¨åœ¨å“ªé‡Œï¼ŸlocalStorageã€sessionStorage è¿˜æ˜¯ Cookieï¼Ÿâ€</strong><ul><li><p><strong>å›ç­”è¦ç‚¹</strong>:</p><ul><li><strong>localStorage&#x2F;sessionStorage</strong>:<ul><li><strong>ä¼˜ç‚¹</strong>: æ–¹ä¾¿ JavaScript ç›´æ¥è¯»å†™ï¼Œå®¹é‡è¾ƒå¤§ï¼ˆ5MBï¼‰ã€‚</li><li><strong>ç¼ºç‚¹</strong>: å®¹æ˜“å—åˆ° <strong>XSS (è·¨ç«™è„šæœ¬æ”»å‡»)</strong>ã€‚å¦‚æœç½‘ç«™å­˜åœ¨ XSS æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥æ‰§è¡Œ JS ä»£ç ç›´æ¥çªƒå–å­˜å‚¨åœ¨å…¶ä¸­çš„ Tokenã€‚</li></ul></li><li><strong>Cookie (HttpOnly)</strong>:<ul><li><strong>ä¼˜ç‚¹</strong>: è®¾ç½®ä¸º <code>HttpOnly</code> åï¼ŒJavaScript å°†æ— æ³•è¯»å†™è¯¥ Cookieï¼Œå¯ä»¥æœ‰æ•ˆ<strong>é˜²å¾¡ XSS æ”»å‡»</strong>ã€‚æµè§ˆå™¨ä¼šè‡ªåŠ¨åœ¨åŒåŸŸè¯·æ±‚ä¸­æºå¸¦å®ƒã€‚</li><li><strong>ç¼ºç‚¹</strong>: å®¹æ˜“å—åˆ° <strong>CSRF (è·¨ç«™è¯·æ±‚ä¼ªé€ )</strong> æ”»å‡»ã€‚æ”»å‡»è€…å¯ä»¥è¯±å¯¼ç”¨æˆ·ç‚¹å‡»æ¶æ„é“¾æ¥ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨å¸¦ä¸Šç”¨æˆ·çš„ Cookie å»è¯·æ±‚ä½ çš„ç½‘ç«™ï¼Œæ‰§è¡Œéç”¨æˆ·æœ¬æ„çš„æ“ä½œã€‚éœ€è¦é…åˆ Anti-CSRF Token ç­‰æœºåˆ¶æ¥é˜²å¾¡ã€‚å®¹é‡è¾ƒå°ï¼ˆ4KBï¼‰ã€‚</li></ul></li><li><strong>æœ€ä½³å®è·µ&#x2F;ç»“è®º</strong>: æ²¡æœ‰ç»å¯¹å®Œç¾çš„é€‰æ‹©ï¼Œéœ€è¦æƒè¡¡ã€‚<ul><li><strong>é«˜å®‰å…¨æ€§æ–¹æ¡ˆ</strong>: å°† <code>Refresh Token</code> å­˜å‚¨åœ¨ <code>HttpOnly</code> çš„ Cookie ä¸­ï¼ˆé˜²æ­¢ XSSï¼‰ï¼Œå°† <code>Access Token</code> å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼ˆå˜é‡é‡Œï¼Œé¡µé¢åˆ·æ–°ä¸¢å¤±ï¼‰æˆ– <code>sessionStorage</code> ä¸­ã€‚åŒæ—¶ï¼Œåç«¯æ¥å£å¿…é¡»å®æ–½ CSRF é˜²å¾¡ç­–ç•¥ã€‚</li><li><strong>ä¸»æµå®è·µæ–¹æ¡ˆ (å‰åç«¯åˆ†ç¦»)</strong>: å°† Token å­˜å‚¨åœ¨ <code>localStorage</code> ä¸­ï¼Œå¹¶åœ¨ <code>Authorization</code> è¯·æ±‚å¤´ä¸­æºå¸¦ã€‚åŒæ—¶ï¼Œå‰ç«¯å¿…é¡»ä¸¥æ ¼åšå¥½è¾“å…¥è¿‡æ»¤å’Œå†…å®¹è½¬ä¹‰ï¼Œå°½æœ€å¤§åŠªåŠ›é˜²æ­¢ XSS æ¼æ´çš„å‡ºç°ã€‚</li></ul></li></ul><p>å¥½çš„ï¼Œæˆ‘ä»¬æ¥è¯¦ç»†æ¢è®¨<strong>åŒä»¤ç‰Œï¼ˆDual Tokenï¼‰çš„å­˜å‚¨æ–¹æ¡ˆã€‚è¿™ç§æ–¹æ¡ˆæ˜¯ç°ä»£ Web å®‰å…¨è®¤è¯çš„å¸¸è§æ¨¡å¼ï¼Œä¸»è¦ç”¨äºè§£å†³ä¼ ç»Ÿ JWTï¼ˆJSON Web Tokenï¼‰æ–¹æ¡ˆä¸­çš„ä¸€äº›å®‰å…¨é—®é¢˜ï¼Œå°¤å…¶æ˜¯é˜²æ­¢ XSSï¼ˆè·¨ç«™è„šæœ¬æ”»å‡»ï¼‰å’Œ CSRFï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰æ”»å‡»</strong>ã€‚</p><p>åŒä»¤ç‰Œæ–¹æ¡ˆçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šå°†ç”¨æˆ·è®¤è¯æ‰€éœ€çš„æƒé™ä¿¡æ¯åˆ†ä¸ºä¸¤ä¸ªç‹¬ç«‹çš„ä»¤ç‰Œï¼Œå¹¶é‡‡ç”¨ä¸åŒçš„å­˜å‚¨å’Œä¼ è¾“æ–¹å¼ï¼Œä»¥è¾¾åˆ°æ›´é«˜çš„å®‰å…¨æ€§ã€‚è¿™ä¸¤ä¸ªä»¤ç‰Œé€šå¸¸æ˜¯ï¼š</p><ol><li><strong>è®¿é—®ä»¤ç‰Œï¼ˆAccess Tokenï¼‰</strong></li><li><strong>åˆ·æ–°ä»¤ç‰Œï¼ˆRefresh Tokenï¼‰</strong></li></ol><h3 id="1-è®¿é—®ä»¤ç‰Œ-Access-Token"><a href="#1-è®¿é—®ä»¤ç‰Œ-Access-Token" class="headerlink" title="1. è®¿é—®ä»¤ç‰Œ (Access Token)"></a>1. è®¿é—®ä»¤ç‰Œ (Access Token)</h3><p>è®¿é—®ä»¤ç‰Œæ˜¯ç”¨äº<strong>è®¿é—®å—ä¿æŠ¤èµ„æº</strong>çš„å‡­è¯ã€‚å®ƒé€šå¸¸æ˜¯ä¸€ä¸ª<strong>æœ‰æ•ˆæœŸå¾ˆçŸ­</strong>çš„ JWTã€‚</p><ul><li><strong>ä½œç”¨</strong>ï¼šæºå¸¦ç”¨æˆ·çš„èº«ä»½ä¿¡æ¯å’Œæƒé™ï¼Œç”¨äºåç«¯ API æ¥å£çš„è®¤è¯ã€‚åç«¯åœ¨æ”¶åˆ°è¯·æ±‚æ—¶ï¼Œä¼šéªŒè¯è¿™ä¸ªä»¤ç‰Œçš„æœ‰æ•ˆæ€§ï¼ˆç­¾åã€æœ‰æ•ˆæœŸï¼‰ã€‚</li><li><strong>æœ‰æ•ˆæœŸ</strong>ï¼š<strong>éå¸¸çŸ­</strong>ï¼Œé€šå¸¸åªæœ‰å‡ åˆ†é’Ÿåˆ°å‡ å°æ—¶ã€‚è¿™æå¤§åœ°é™ä½äº†ä»¤ç‰Œè¢«ç›—åé€ æˆçš„æŸå¤±ã€‚</li><li><strong>å­˜å‚¨æ–¹æ¡ˆ</strong>ï¼šä¸ºäº†é˜²æ­¢ XSS æ”»å‡»ï¼Œè®¿é—®ä»¤ç‰Œé€šå¸¸ä¸åº”è¯¥å­˜å‚¨åœ¨æµè§ˆå™¨æœ¬åœ°çš„ <code>localStorage</code> æˆ– <code>sessionStorage</code> ä¸­ï¼Œå› ä¸ºè¿™äº›å­˜å‚¨ç©ºé—´å¯ä»¥è¢«æ¶æ„è„šæœ¬è®¿é—®ã€‚<ul><li><strong>æ¨èæ–¹æ¡ˆ</strong>ï¼šå­˜å‚¨åœ¨<strong>å†…å­˜ä¸­</strong>ã€‚å½“ç”¨æˆ·å…³é—­æµè§ˆå™¨æ ‡ç­¾é¡µæ—¶ï¼Œä»¤ç‰Œå°±ä¼šè¢«æ¸…é™¤ã€‚è¿™æ„å‘³ç€ç”¨æˆ·æ¯æ¬¡æ‰“å¼€æ–°æ ‡ç­¾é¡µéƒ½éœ€è¦é‡æ–°è·å–ä»¤ç‰Œï¼Œä½†è¿™æ˜¯ä¸ºäº†å®‰å…¨ç‰ºç‰²ä¸€äº›ä¾¿åˆ©æ€§ã€‚</li><li><strong>æ¬¡ä¼˜æ–¹æ¡ˆ</strong>ï¼šå­˜å‚¨åœ¨<strong>HTTP-only Cookie</strong> ä¸­ã€‚è¿™ç§ Cookie åªèƒ½ç”±æœåŠ¡å™¨è®¾ç½®ï¼Œæ— æ³•é€šè¿‡ JavaScript è„šæœ¬è¯»å–ï¼Œæœ‰æ•ˆé˜²æ­¢äº† XSS æ”»å‡»ã€‚ä½†æ˜¯ï¼Œå®ƒä»ç„¶å¯èƒ½å—åˆ° CSRF æ”»å‡»çš„é£é™©ã€‚</li></ul></li></ul><h3 id="2-åˆ·æ–°ä»¤ç‰Œ-Refresh-Token"><a href="#2-åˆ·æ–°ä»¤ç‰Œ-Refresh-Token" class="headerlink" title="2. åˆ·æ–°ä»¤ç‰Œ (Refresh Token)"></a>2. åˆ·æ–°ä»¤ç‰Œ (Refresh Token)</h3><p>åˆ·æ–°ä»¤ç‰Œæ˜¯ç”¨äº<strong>è·å–æ–°çš„è®¿é—®ä»¤ç‰Œ</strong>çš„å‡­è¯ã€‚å®ƒé€šå¸¸æ˜¯ä¸€ä¸ª<strong>æœ‰æ•ˆæœŸå¾ˆé•¿</strong>çš„ä»¤ç‰Œï¼Œå¯ä»¥ç”¨äºåœ¨è®¿é—®ä»¤ç‰Œè¿‡æœŸåï¼Œæ— æ„Ÿåœ°é‡æ–°è·å–ä¸€ä¸ªæ–°çš„ã€‚</p><ul><li><strong>ä½œç”¨</strong>ï¼šå½“è®¿é—®ä»¤ç‰Œè¿‡æœŸæ—¶ï¼Œå®¢æˆ·ç«¯æºå¸¦åˆ·æ–°ä»¤ç‰Œå‘è®¤è¯æœåŠ¡å™¨è¯·æ±‚ä¸€ä¸ªæ–°çš„è®¿é—®ä»¤ç‰Œã€‚</li><li><strong>æœ‰æ•ˆæœŸ</strong>ï¼š<strong>å¾ˆé•¿</strong>ï¼Œé€šå¸¸æ˜¯å‡ å¤©ã€å‡ å‘¨ç”šè‡³å‡ ä¸ªæœˆã€‚</li><li><strong>å­˜å‚¨æ–¹æ¡ˆ</strong>ï¼šç”±äºåˆ·æ–°ä»¤ç‰Œæ˜¯è·å–è®¿é—®ä»¤ç‰Œçš„å…³é”®ï¼Œå®ƒçš„å­˜å‚¨å¿…é¡»<strong>ç»å¯¹å®‰å…¨</strong>ã€‚<ul><li><strong>æ¨èæ–¹æ¡ˆ</strong>ï¼šå­˜å‚¨åœ¨<strong>HTTP-only Cookie</strong> ä¸­ã€‚HTTP-only å±æ€§å¯ä»¥é˜²æ­¢æ¶æ„è„šæœ¬ï¼ˆXSSï¼‰è¯»å–è¯¥ä»¤ç‰Œã€‚åŒæ—¶ï¼Œç”±äºåˆ·æ–°ä»¤ç‰Œåªå‘é€ç»™è®¤è¯æœåŠ¡å™¨ï¼Œå¹¶ä¸”ä¸ç”¨äºè®¿é—®å…¶ä»– APIï¼Œå¯ä»¥é‡‡å–ä¸€äº›é¢å¤–çš„å®‰å…¨æªæ–½ï¼Œå¦‚ CSRF ä»¤ç‰Œæˆ– SameSite Cookie å±æ€§ï¼Œæ¥é˜²æ­¢ CSRF æ”»å‡»ã€‚</li><li><strong>æ³¨æ„</strong>ï¼šåˆ·æ–°ä»¤ç‰Œ<strong>ç»å¯¹ä¸åº”è¯¥</strong>å­˜å‚¨åœ¨ <code>localStorage</code> ä¸­ã€‚</li></ul></li></ul><h3 id="åŒä»¤ç‰Œå·¥ä½œæµç¨‹ï¼ˆç»“åˆå­˜å‚¨æ–¹æ¡ˆï¼‰"><a href="#åŒä»¤ç‰Œå·¥ä½œæµç¨‹ï¼ˆç»“åˆå­˜å‚¨æ–¹æ¡ˆï¼‰" class="headerlink" title="åŒä»¤ç‰Œå·¥ä½œæµç¨‹ï¼ˆç»“åˆå­˜å‚¨æ–¹æ¡ˆï¼‰"></a>åŒä»¤ç‰Œå·¥ä½œæµç¨‹ï¼ˆç»“åˆå­˜å‚¨æ–¹æ¡ˆï¼‰</h3><ol><li><strong>é¦–æ¬¡ç™»å½•</strong>ï¼š<ul><li>ç”¨æˆ·é€šè¿‡ç”¨æˆ·å&#x2F;å¯†ç ç™»å½•ã€‚</li><li>è®¤è¯æœåŠ¡å™¨éªŒè¯é€šè¿‡åï¼Œç”Ÿæˆä¸€ä¸ª<strong>è®¿é—®ä»¤ç‰Œï¼ˆAccess Tokenï¼‰å’Œä¸€ä¸ªåˆ·æ–°ä»¤ç‰Œï¼ˆRefresh Tokenï¼‰</strong>ã€‚</li><li>æœåŠ¡å™¨å°†åˆ·æ–°ä»¤ç‰Œè®¾ç½®åˆ° <strong>HTTP-only Cookie</strong> ä¸­ï¼Œå‘é€ç»™æµè§ˆå™¨ã€‚</li><li>æœåŠ¡å™¨å°†è®¿é—®ä»¤ç‰Œè¿”å›ç»™å‰ç«¯ï¼Œå‰ç«¯å°†å…¶å­˜å‚¨åœ¨<strong>å†…å­˜ä¸­</strong>ã€‚</li></ul></li><li><strong>è®¿é—®å—ä¿æŠ¤èµ„æº</strong>ï¼š<ul><li>å‰ç«¯å‘èµ· API è¯·æ±‚æ—¶ï¼Œä»å†…å­˜ä¸­å–å‡ºè®¿é—®ä»¤ç‰Œï¼Œå¹¶å°†å…¶æ”¾åœ¨è¯·æ±‚å¤´ï¼ˆå¦‚ <code>Authorization: Bearer &lt;AccessToken&gt;</code>ï¼‰ä¸­å‘é€ç»™åç«¯ã€‚</li><li>åç«¯ API æœåŠ¡å™¨éªŒè¯è®¿é—®ä»¤ç‰Œçš„æœ‰æ•ˆæ€§ï¼Œå¦‚æœæœ‰æ•ˆåˆ™è¿”å›æ•°æ®ã€‚</li></ul></li><li><strong>è®¿é—®ä»¤ç‰Œè¿‡æœŸ</strong>ï¼š<ul><li>ä¸€æ®µæ—¶é—´åï¼Œè®¿é—®ä»¤ç‰Œè¿‡æœŸã€‚å‰ç«¯å†æ¬¡å‘èµ· API è¯·æ±‚æ—¶ï¼Œåç«¯ä¼šè¿”å›ä¸€ä¸ª 401 Unauthorized é”™è¯¯ã€‚</li><li>å‰ç«¯æ•è·åˆ°è¿™ä¸ªé”™è¯¯åï¼Œä¼šå‘èµ·ä¸€ä¸ª<strong>åˆ·æ–°è¯·æ±‚</strong>ï¼ˆé€šå¸¸æ˜¯å‘ä¸€ä¸ªä¸“é—¨çš„ <code>/refresh</code> æ¥å£ï¼‰ï¼Œè¿™ä¸ªè¯·æ±‚ä¼šè‡ªåŠ¨å¸¦ä¸Šå­˜å‚¨åœ¨ HTTP-only Cookie ä¸­çš„åˆ·æ–°ä»¤ç‰Œã€‚</li></ul></li><li><strong>åˆ·æ–°ä»¤ç‰Œå·¥ä½œ</strong>ï¼š<ul><li>è®¤è¯æœåŠ¡å™¨æ”¶åˆ°åˆ·æ–°è¯·æ±‚ï¼ŒéªŒè¯åˆ·æ–°ä»¤ç‰Œçš„æœ‰æ•ˆæ€§ã€‚</li><li>å¦‚æœåˆ·æ–°ä»¤ç‰Œæœ‰æ•ˆï¼ŒæœåŠ¡å™¨ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„<strong>è®¿é—®ä»¤ç‰Œ</strong>å’Œï¼ˆå¯é€‰ï¼‰ä¸€ä¸ªæ–°çš„<strong>åˆ·æ–°ä»¤ç‰Œ</strong>ã€‚</li><li>æœåŠ¡å™¨å°†æ–°çš„è®¿é—®ä»¤ç‰Œè¿”å›ç»™å‰ç«¯ï¼Œå‰ç«¯æ›´æ–°å†…å­˜ä¸­çš„ä»¤ç‰Œã€‚</li><li>æœåŠ¡å™¨å°†æ–°çš„åˆ·æ–°ä»¤ç‰Œè®¾ç½®åˆ° <strong>HTTP-only Cookie</strong> ä¸­ã€‚</li><li>å‰ç«¯ä½¿ç”¨æ–°çš„è®¿é—®ä»¤ç‰Œé‡æ–°å‘èµ·ä¹‹å‰çš„ API è¯·æ±‚ã€‚</li></ul></li></ol><h3 id="ä¸ºä»€ä¹ˆè¿™ä¸ªæ–¹æ¡ˆæ›´å®‰å…¨ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¿™ä¸ªæ–¹æ¡ˆæ›´å®‰å…¨ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¿™ä¸ªæ–¹æ¡ˆæ›´å®‰å…¨ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¿™ä¸ªæ–¹æ¡ˆæ›´å®‰å…¨ï¼Ÿ</h3><ol><li><strong>é˜²æ­¢ XSS æ”»å‡»</strong>ï¼šæœ€æ•æ„Ÿçš„åˆ·æ–°ä»¤ç‰Œå­˜å‚¨åœ¨ HTTP-only Cookie ä¸­ï¼Œè„šæœ¬æ— æ³•è¯»å–ã€‚è€Œè®¿é—®ä»¤ç‰Œè™½ç„¶å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œä½†å…¶æœ‰æ•ˆæœŸçŸ­ï¼Œå³ä½¿è¢«ç›—ï¼Œä¹Ÿå¾ˆå¿«ä¼šå¤±æ•ˆã€‚</li><li><strong>é˜²æ­¢ CSRF æ”»å‡»</strong>ï¼šåˆ·æ–°ä»¤ç‰Œé€šå¸¸åªç”¨äºä¸€ä¸ªç‰¹å®šçš„ <code>/refresh</code> æ¥å£ï¼Œå¹¶ä¸”å¯ä»¥ä¸ CSRF ä»¤ç‰Œï¼ˆæˆ– SameSite Cookieï¼‰ç»“åˆä½¿ç”¨ï¼Œè¿›ä¸€æ­¥é™ä½é£é™©ã€‚åŒæ—¶ï¼Œç”±äºå…¶ä»– API æ¥å£ä¸ä¾èµ–äº Cookie ä¸­çš„åˆ·æ–°ä»¤ç‰Œï¼Œè€Œæ˜¯ä¾èµ–äºè¯·æ±‚å¤´ä¸­çš„è®¿é—®ä»¤ç‰Œï¼Œå› æ­¤æ— æ³•è¢« CSRF æ”»å‡»è€…åˆ©ç”¨ã€‚</li><li><strong>æå‡ç”¨æˆ·ä½“éªŒ</strong>ï¼šå°½ç®¡è®¿é—®ä»¤ç‰Œæœ‰æ•ˆæœŸå¾ˆçŸ­ï¼Œä½†ç”¨æˆ·æ— éœ€é¢‘ç¹ç™»å½•ï¼Œå› ä¸ºåˆ·æ–°ä»¤ç‰Œå¯ä»¥åœ¨åå°æ— æ„Ÿåœ°è·å–æ–°ä»¤ç‰Œã€‚</li></ol><p>æ€»ä¹‹ï¼ŒåŒä»¤ç‰Œæ–¹æ¡ˆé€šè¿‡å°†ä»¤ç‰ŒèŒè´£åˆ†ç¦»å’Œé‡‡ç”¨ä¸åŒçš„å­˜å‚¨æœºåˆ¶ï¼Œåœ¨ä¿è¯ç”¨æˆ·ä½“éªŒçš„åŒæ—¶ï¼Œæ˜¾è‘—æå‡äº†ç³»ç»Ÿçš„å®‰å…¨æ€§ï¼Œæ˜¯ç°ä»£ Web åº”ç”¨ä¸­ä¸€ç§éå¸¸æˆç†Ÿå’Œæ¨èçš„è®¤è¯æ¨¡å¼ã€‚</p></li></ul></li><li><strong>é¢è¯•é¢˜ 2ï¼šâ€œç”¨æˆ·ç‚¹å‡»â€œé€€å‡ºç™»å½•â€æ—¶ï¼ŒToken å¦‚ä½•å¤±æ•ˆï¼Ÿâ€</strong><ul><li><strong>å›ç­”è¦ç‚¹</strong>:<ul><li><h4 id="æ ¸å¿ƒè§‚ç‚¹ï¼šæ— çŠ¶æ€-JWT-çš„ç‰¹æ€§å†³å®šäº†â€œé€€å‡ºç™»å½•â€çš„æœ¬è´¨"><a href="#æ ¸å¿ƒè§‚ç‚¹ï¼šæ— çŠ¶æ€-JWT-çš„ç‰¹æ€§å†³å®šäº†â€œé€€å‡ºç™»å½•â€çš„æœ¬è´¨" class="headerlink" title="æ ¸å¿ƒè§‚ç‚¹ï¼šæ— çŠ¶æ€ JWT çš„ç‰¹æ€§å†³å®šäº†â€œé€€å‡ºç™»å½•â€çš„æœ¬è´¨"></a>æ ¸å¿ƒè§‚ç‚¹ï¼šæ— çŠ¶æ€ JWT çš„ç‰¹æ€§å†³å®šäº†â€œé€€å‡ºç™»å½•â€çš„æœ¬è´¨</h4><p>é¦–å…ˆï¼Œè¦æ˜ç¡®æŒ‡å‡º JWT çš„æ ¸å¿ƒç‰¹ç‚¹æ˜¯<strong>æ— çŠ¶æ€</strong>ã€‚è¿™æ„å‘³ç€æœåŠ¡å™¨<strong>æ— æ³•ä¸»åŠ¨</strong>è®©ä¸€ä¸ªå·²ç»ç­¾å‘å‡ºå»çš„ä»¤ç‰Œå¤±æ•ˆï¼Œè¿™ä¸ä¼ ç»Ÿçš„ Session æœºåˆ¶ï¼ˆæœåŠ¡å™¨å¯ä»¥ä¸»åŠ¨é”€æ¯ä¼šè¯ï¼‰æœ‰æœ¬è´¨åŒºåˆ«ã€‚å› æ­¤ï¼Œâ€œé€€å‡ºç™»å½•â€çš„å®ç°æ–¹å¼ä¹Ÿæˆªç„¶ä¸åŒã€‚</p><h4 id="1-å®¢æˆ·ç«¯å®ç°ï¼ˆå¸¸è§„é€€å‡ºç™»å½•ï¼‰"><a href="#1-å®¢æˆ·ç«¯å®ç°ï¼ˆå¸¸è§„é€€å‡ºç™»å½•ï¼‰" class="headerlink" title="1. å®¢æˆ·ç«¯å®ç°ï¼ˆå¸¸è§„é€€å‡ºç™»å½•ï¼‰"></a>1. å®¢æˆ·ç«¯å®ç°ï¼ˆå¸¸è§„é€€å‡ºç™»å½•ï¼‰</h4><ul><li><strong>å®ç°æ–¹å¼</strong>ï¼šè¿™æ˜¯æœ€ç®€å•ã€æœ€å¸¸è§çš„æ–¹æ¡ˆï¼Œé€‚ç”¨äºç”¨æˆ·ä¸»åŠ¨é€€å‡ºç™»å½•çš„æƒ…å†µã€‚</li><li><strong>å…·ä½“æ“ä½œ</strong>ï¼š<ul><li>å‰ç«¯ä»£ç åœ¨ç”¨æˆ·ç‚¹å‡»â€œé€€å‡ºç™»å½•â€æ—¶ï¼Œæ‰§è¡Œä¸€ä¸ªç®€å•çš„æ“ä½œï¼š<strong>ä»æœ¬åœ°å­˜å‚¨ï¼ˆå¦‚ localStorageã€sessionStorageã€å†…å­˜æˆ– Cookieï¼‰ä¸­åˆ é™¤ Access Token</strong>ã€‚</li><li>ä¸€æ—¦ä»¤ç‰Œè¢«åˆ é™¤ï¼Œå‰ç«¯åç»­çš„è¯·æ±‚å°†æ— æ³•æºå¸¦æœ‰æ•ˆçš„ <code>Authorization</code> å¤´ï¼ŒæœåŠ¡å™¨ä¼šè¿”å› 401 é”™è¯¯ï¼Œä»è€Œå®ç°äº†â€œé€€å‡ºç™»å½•â€çš„æ•ˆæœã€‚</li></ul></li><li><strong>å±€é™æ€§</strong>ï¼šè¿™ç§æ–¹æ³•åªæ˜¯ä¸€ä¸ª<strong>å®¢æˆ·ç«¯è¡Œä¸º</strong>ã€‚å¦‚æœä»¤ç‰Œè¢«å¤åˆ¶æˆ–è¢«æ”»å‡»è€…æˆªè·ï¼Œå®ƒåœ¨è¿‡æœŸä¹‹å‰ä»ç„¶æ˜¯æœ‰æ•ˆçš„ã€‚</li></ul><h4 id="2-æœåŠ¡ç«¯å®ç°ï¼ˆå¼ºåˆ¶ä¸‹çº¿æˆ–å³æ—¶å¤±æ•ˆï¼‰"><a href="#2-æœåŠ¡ç«¯å®ç°ï¼ˆå¼ºåˆ¶ä¸‹çº¿æˆ–å³æ—¶å¤±æ•ˆï¼‰" class="headerlink" title="2. æœåŠ¡ç«¯å®ç°ï¼ˆå¼ºåˆ¶ä¸‹çº¿æˆ–å³æ—¶å¤±æ•ˆï¼‰"></a>2. æœåŠ¡ç«¯å®ç°ï¼ˆå¼ºåˆ¶ä¸‹çº¿æˆ–å³æ—¶å¤±æ•ˆï¼‰</h4><ul><li><strong>å¼•å…¥èƒŒæ™¯</strong>ï¼šå½“éœ€è¦å®ç°æ›´ä¸¥æ ¼çš„å®‰å…¨éœ€æ±‚æ—¶ï¼Œå¦‚â€œç®¡ç†å‘˜è¸¢äººä¸‹çº¿â€ã€â€œç”¨æˆ·ä¿®æ”¹å¯†ç åæ‰€æœ‰è®¾å¤‡ä¸‹çº¿â€æˆ–â€œä»¤ç‰Œæ³„éœ²åç«‹å³å¤±æ•ˆâ€ï¼Œå•çº¯çš„å®¢æˆ·ç«¯æ¸…é™¤æ˜¯ä¸å¤Ÿçš„ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»æ‰“ç ´æ— çŠ¶æ€çš„ç‰¹æ€§ï¼Œå¼•å…¥æœåŠ¡ç«¯çš„çŠ¶æ€ç®¡ç†ã€‚</li><li><strong>æ–¹æ¡ˆä¸€ï¼šé»‘åå•æœºåˆ¶ (Blacklist)</strong><ul><li><strong>å·¥ä½œåŸç†</strong>ï¼š<ol><li>æœåŠ¡ç«¯ç»´æŠ¤ä¸€ä¸ªé«˜æ•ˆã€å¯å¿«é€ŸæŸ¥æ‰¾çš„<strong>é»‘åå•åˆ—è¡¨</strong>ï¼ˆé€šå¸¸ä½¿ç”¨ <strong>Redis çš„ Set æ•°æ®ç»“æ„</strong>ï¼Œå› ä¸ºå®ƒå…·æœ‰ O(1) çš„æŸ¥æ‰¾æ•ˆç‡ï¼‰ã€‚</li><li>åœ¨ç”¨æˆ·é€€å‡ºç™»å½•æˆ–éœ€è¦å¼ºåˆ¶ä¸‹çº¿æ—¶ï¼Œå°†è¯¥ JWT çš„å”¯ä¸€æ ‡è¯† <code>jti</code>ï¼ˆæˆ–æ•´ä¸ªä»¤ç‰Œæœ¬èº«ï¼‰æ·»åŠ åˆ°è¿™ä¸ªé»‘åå•ä¸­ã€‚</li><li>ä¸ºé»‘åå•ä¸­çš„æ¡ç›®è®¾ç½®ä¸€ä¸ª<strong>è¿‡æœŸæ—¶é—´</strong>ï¼Œè¯¥è¿‡æœŸæ—¶é—´åº”ä¸ä»¤ç‰Œæœ¬èº«çš„å‰©ä½™æœ‰æ•ˆæœŸä¸€è‡´ã€‚</li><li>åœ¨æ¯æ¬¡éªŒè¯ JWT çš„è¿‡ç¨‹ä¸­ï¼Œé™¤äº†æ ¡éªŒç­¾åå’Œè¿‡æœŸæ—¶é—´å¤–ï¼Œé¢å¤–å¢åŠ ä¸€æ­¥ï¼š<strong>æ£€æŸ¥è¯¥ä»¤ç‰Œçš„ jti æ˜¯å¦å­˜åœ¨äºé»‘åå•ä¸­</strong>ã€‚å¦‚æœå­˜åœ¨ï¼Œåˆ™è®¤è¯å¤±è´¥ã€‚</li></ol></li></ul></li><li><strong>æ–¹æ¡ˆäºŒï¼šåŸºäº Refresh Token çš„ç®¡ç†</strong><ul><li><strong>å·¥ä½œåŸç†</strong>ï¼šè¿™ç§æ–¹æ¡ˆæ˜¯åŸºäº<strong>åŒä»¤ç‰Œæ¨¡å¼</strong>è®¾è®¡çš„ï¼Œæ›´ä¼˜é›…åœ°è§£å†³äº†é—®é¢˜ã€‚<ol><li>æœåŠ¡å™¨åœ¨ç­¾å‘ <code>Access Token</code> å’Œ <code>Refresh Token</code> æ—¶ï¼Œä¼šå°† <code>Refresh Token</code> å­˜å…¥æ•°æ®åº“æˆ– Redis ä¸­ã€‚</li><li>å½“ç”¨æˆ·ç‚¹å‡»â€œé€€å‡ºç™»å½•â€æˆ–éœ€è¦å¼ºåˆ¶ä¸‹çº¿æ—¶ï¼ŒæœåŠ¡å™¨<strong>åˆ é™¤</strong>æˆ–<strong>æ ‡è®°å¤±æ•ˆ</strong>å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯çš„ <code>Refresh Token</code>ã€‚</li><li>å½“ç”¨æˆ·çš„ <code>Access Token</code> è¿‡æœŸåï¼Œå®ƒå°†æ— æ³•é€šè¿‡ <code>Refresh Token</code> æ¢å–æ–°çš„ <code>Access Token</code>ï¼Œå› ä¸ºæœåŠ¡å™¨ç«¯çš„ <code>Refresh Token</code> å·²ç»å¤±æ•ˆã€‚è¿™æ ·ï¼Œç”¨æˆ·å°±æ— æ³•ç»§ç»­ä¿æŒç™»å½•çŠ¶æ€ã€‚</li></ol></li></ul></li></ul><h3 id="æ€»ç»“ä¸å¯¹æ¯”"><a href="#æ€»ç»“ä¸å¯¹æ¯”" class="headerlink" title="æ€»ç»“ä¸å¯¹æ¯”"></a>æ€»ç»“ä¸å¯¹æ¯”</h3><table><thead><tr><th>æ–¹æ¡ˆ</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>å®¢æˆ·ç«¯æ¸…é™¤</strong></td><td>å®ç°ç®€å•ï¼Œå¼€é”€å°ã€‚</td><td>å®‰å…¨æ€§æœ€ä½ï¼Œæ— æ³•å¼ºåˆ¶ä¸‹çº¿ã€‚</td><td>ç”¨æˆ·ä¸»åŠ¨é€€å‡ºç™»å½•ã€‚</td></tr><tr><td><strong>é»‘åå•æœºåˆ¶</strong></td><td>èƒ½å¤Ÿå®ç°å³æ—¶ä¸‹çº¿ï¼Œå®‰å…¨å¯æ§ã€‚</td><td>å¢åŠ äº†æœåŠ¡ç«¯å¼€é”€ï¼ˆé¢å¤–çš„ Redis å­˜å‚¨å’ŒæŸ¥è¯¢ï¼‰ã€‚</td><td>å¼ºåˆ¶ä¸‹çº¿ã€ä¿®æ”¹å¯†ç ã€ä»¤ç‰Œæ³„éœ²ã€‚</td></tr><tr><td><strong>Refresh Token æ–¹æ¡ˆ</strong></td><td>æ—¢å®ç°äº†å³æ—¶ä¸‹çº¿ï¼Œåˆæ— éœ€é¢‘ç¹æŸ¥è¯¢é»‘åå•ï¼Œæ¶æ„æ›´ä¼˜é›…ã€‚</td><td>å¿…é¡»é‡‡ç”¨åŒä»¤ç‰Œæ¨¡å¼ï¼Œå®ç°ç›¸å¯¹å¤æ‚ã€‚</td><td>ç°ä»£å‰åç«¯åˆ†ç¦»åº”ç”¨ï¼Œå¯¹å®‰å…¨æ€§è¦æ±‚è¾ƒé«˜ã€‚</td></tr></tbody></table></li></ul></li></ul></li><li><strong>é¢è¯•é¢˜ 3ï¼šâ€œè¯·ä½ è®¾è®¡ä¸€ä¸ªæ”¯æŒ Web ç«¯å’Œ App ç«¯ç»Ÿä¸€ç™»å½•çš„è®¤è¯ç³»ç»Ÿã€‚â€</strong><ul><li><strong>å›ç­”è¦ç‚¹</strong>:<ul><li>è¿™æ­£æ˜¯ Token è®¤è¯æœºåˆ¶çš„å…¸å‹åº”ç”¨åœºæ™¯ã€‚æˆ‘ä¼šé‡‡ç”¨åŸºäº <strong>OAuth 2.0&#x2F;OIDC</strong> æˆ–è‡ªå®šä¹‰çš„**åŒä»¤ç‰Œï¼ˆAccess&#x2F;Refresh Tokenï¼‰**æ–¹æ¡ˆã€‚</li><li><strong>ç»Ÿä¸€è®¤è¯ä¸­å¿ƒ (UAC)</strong>: å»ºç«‹ä¸€ä¸ªç‹¬ç«‹çš„è®¤è¯æœåŠ¡ï¼Œè´Ÿè´£å¤„ç†æ‰€æœ‰å®¢æˆ·ç«¯ï¼ˆWeb, iOS, Androidï¼‰çš„ç™»å½•ã€æ³¨å†Œã€Token ç­¾å‘å’Œåˆ·æ–°ã€‚</li><li><strong>API ç½‘å…³</strong>: æ‰€æœ‰ä¸šåŠ¡è¯·æ±‚éƒ½é€šè¿‡ API ç½‘å…³ã€‚ç½‘å…³çš„æ ¸å¿ƒèŒè´£ä¹‹ä¸€å°±æ˜¯<strong>ç»Ÿä¸€é‰´æƒ</strong>ã€‚å®ƒä¼šæ‹¦æˆªæ‰€æœ‰è¯·æ±‚ï¼Œè§£æ <code>Authorization</code> å¤´ä¸­çš„ <code>Access Token</code>ï¼Œè°ƒç”¨è®¤è¯ä¸­å¿ƒæˆ–è‡ªè¡ŒéªŒè¯ Token çš„æœ‰æ•ˆæ€§ã€‚éªŒè¯é€šè¿‡åï¼Œå¯ä»¥å°†è§£æå‡ºçš„ç”¨æˆ·ä¿¡æ¯ï¼ˆå¦‚ç”¨æˆ·IDï¼‰é™„åŠ åˆ°è¯·æ±‚å¤´ä¸­ï¼Œå†è½¬å‘ç»™åç«¯çš„ä¸šåŠ¡å¾®æœåŠ¡ã€‚</li><li><strong>ä¸šåŠ¡å¾®æœåŠ¡</strong>: ä¸šåŠ¡å¾®æœåŠ¡æœ¬èº«<strong>ä¸å†å…³å¿ƒ Token çš„éªŒè¯ç»†èŠ‚</strong>ï¼Œå®ƒä»¬ä¿¡ä»»æ¥è‡ªç½‘å…³çš„è¯·æ±‚ï¼Œç›´æ¥ä»è¯·æ±‚å¤´ä¸­è·å–ç”¨æˆ·ä¿¡æ¯è¿›è¡Œä¸šåŠ¡å¤„ç†ï¼Œå®ç°äº†ä¸šåŠ¡ä¸è®¤è¯çš„è§£è€¦ã€‚</li><li><strong>æµç¨‹</strong>:<ol><li>Web&#x2F;App å®¢æˆ·ç«¯å¼•å¯¼ç”¨æˆ·åˆ°è®¤è¯ä¸­å¿ƒè¿›è¡Œç™»å½•ã€‚</li><li>ç™»å½•æˆåŠŸåï¼Œè®¤è¯ä¸­å¿ƒè¿”å› <code>Access Token</code> å’Œ <code>Refresh Token</code>ã€‚</li><li>å®¢æˆ·ç«¯ä¿å­˜ä»¤ç‰Œï¼Œåç»­è®¿é—®ä¸šåŠ¡ API æ—¶ï¼Œåœ¨è¯·æ±‚å¤´æºå¸¦ <code>Access Token</code>ã€‚</li><li>API ç½‘å…³æ‹¦æˆªè¯·æ±‚ï¼ŒéªŒè¯ <code>Access Token</code>ã€‚</li><li><code>Access Token</code> è¿‡æœŸåï¼Œå®¢æˆ·ç«¯ä½¿ç”¨ <code>Refresh Token</code> å‘è®¤è¯ä¸­å¿ƒç”³è¯·æ–°ä»¤ç‰Œã€‚</li></ol></li><li>è¿™ä¸ªæ¶æ„å…·æœ‰é«˜å†…èšã€ä½è€¦åˆã€å¯æ‰©å±•æ€§å¼ºã€å®‰å…¨æ€§é«˜çš„ä¼˜ç‚¹ã€‚</li></ul></li></ul></li></ul><h1 id="Redis-è¯¦ç»†æŠ€æœ¯è§£æ"><a href="#Redis-è¯¦ç»†æŠ€æœ¯è§£æ" class="headerlink" title="Redis è¯¦ç»†æŠ€æœ¯è§£æ"></a>Redis è¯¦ç»†æŠ€æœ¯è§£æ</h1><h2 id="Redis-æ ¸å¿ƒæ¶æ„ä¸åŸç†"><a href="#Redis-æ ¸å¿ƒæ¶æ„ä¸åŸç†" class="headerlink" title="Redis æ ¸å¿ƒæ¶æ„ä¸åŸç†"></a>Redis æ ¸å¿ƒæ¶æ„ä¸åŸç†</h2><h3 id="å†…å­˜æ¨¡å‹ä¸æ•°æ®ç»“æ„"><a href="#å†…å­˜æ¨¡å‹ä¸æ•°æ®ç»“æ„" class="headerlink" title="å†…å­˜æ¨¡å‹ä¸æ•°æ®ç»“æ„"></a>å†…å­˜æ¨¡å‹ä¸æ•°æ®ç»“æ„</h3><p>Redisé‡‡ç”¨åŸºäºå†…å­˜çš„å­˜å‚¨æ¶æ„ï¼Œæ‰€æœ‰æ•°æ®éƒ½ä¿å­˜åœ¨RAMä¸­ï¼Œè¿™æ˜¯å…¶é«˜æ€§èƒ½çš„æ ¹æœ¬åŸå› ã€‚Redisä½¿ç”¨äº†å¤šç§åº•å±‚æ•°æ®ç»“æ„æ¥å®ç°ä¸Šå±‚çš„æŠ½è±¡æ•°æ®ç±»å‹ï¼š</p><p><strong>SDSï¼ˆSimple Dynamic Stringï¼‰</strong> Redisæ²¡æœ‰ç›´æ¥ä½¿ç”¨Cè¯­è¨€çš„å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯æ„å»ºäº†SDSã€‚SDSåœ¨å­—ç¬¦ä¸²å¤´éƒ¨è®°å½•äº†é•¿åº¦ä¿¡æ¯ï¼Œé¿å…äº†strlençš„O(n)å¤æ‚åº¦ï¼ŒåŒæ—¶é¢„åˆ†é…ç©ºé—´å‡å°‘å†…å­˜é‡åˆ†é…æ¬¡æ•°ã€‚</p><p><strong>è·³è·ƒè¡¨ï¼ˆSkip Listï¼‰</strong> æœ‰åºé›†åˆçš„åº•å±‚å®ç°ä¹‹ä¸€ï¼Œæ˜¯ä¸€ç§éšæœºåŒ–çš„æ•°æ®ç»“æ„ï¼Œé€šè¿‡å¤šå±‚é“¾è¡¨å®ç°O(log N)çš„æŸ¥æ‰¾å¤æ‚åº¦ã€‚ç›¸æ¯”çº¢é»‘æ ‘ï¼Œè·³è·ƒè¡¨å®ç°æ›´ç®€å•ï¼Œä¸”æ”¯æŒèŒƒå›´æŸ¥è¯¢ã€‚</p><p><strong>å‹ç¼©åˆ—è¡¨ï¼ˆZiplistï¼‰</strong> å½“å“ˆå¸Œã€åˆ—è¡¨ã€æœ‰åºé›†åˆå…ƒç´ è¾ƒå°‘æ—¶ä½¿ç”¨çš„ç´§å‡‘å­˜å‚¨ç»“æ„ï¼Œæ‰€æœ‰å…ƒç´ å­˜å‚¨åœ¨ä¸€å—è¿ç»­å†…å­˜ä¸­ï¼ŒèŠ‚çœå†…å­˜ä½†æ’å…¥åˆ é™¤æ•ˆç‡è¾ƒä½ã€‚</p><p><strong>å­—å…¸ï¼ˆDictï¼‰</strong> Redisçš„æ ¸å¿ƒæ•°æ®ç»“æ„ï¼Œä½¿ç”¨å¼€æ”¾å¯»å€æ³•è§£å†³å“ˆå¸Œå†²çªï¼Œæ”¯æŒæ¸è¿›å¼rehashã€‚å½“è´Ÿè½½å› å­è¿‡é«˜æ—¶ï¼Œä¼šåˆ›å»ºæ–°çš„å“ˆå¸Œè¡¨å¹¶é€æ­¥è¿ç§»æ•°æ®ã€‚</p><h3 id="å•çº¿ç¨‹æ¨¡å‹ä¸äº‹ä»¶å¾ªç¯"><a href="#å•çº¿ç¨‹æ¨¡å‹ä¸äº‹ä»¶å¾ªç¯" class="headerlink" title="å•çº¿ç¨‹æ¨¡å‹ä¸äº‹ä»¶å¾ªç¯"></a>å•çº¿ç¨‹æ¨¡å‹ä¸äº‹ä»¶å¾ªç¯</h3><p>Redis 6.0ä¹‹å‰é‡‡ç”¨å•çº¿ç¨‹æ¨¡å‹å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ï¼Œé€šè¿‡I&#x2F;Oå¤šè·¯å¤ç”¨ï¼ˆepoll&#x2F;kqueueï¼‰å®ç°é«˜å¹¶å‘ã€‚å•çº¿ç¨‹é¿å…äº†çº¿ç¨‹åˆ‡æ¢å¼€é”€å’Œå¹¶å‘æ§åˆ¶é—®é¢˜ï¼Œä½†ä¹Ÿé™åˆ¶äº†CPUåˆ©ç”¨ç‡ã€‚</p><p><strong>äº‹ä»¶å¾ªç¯æœºåˆ¶</strong> Redisä½¿ç”¨Reactoræ¨¡å¼çš„äº‹ä»¶å¾ªç¯ï¼Œåˆ†ä¸ºæ–‡ä»¶äº‹ä»¶å’Œæ—¶é—´äº‹ä»¶ï¼š</p><ul><li>æ–‡ä»¶äº‹ä»¶ï¼šå¤„ç†å®¢æˆ·ç«¯è¿æ¥ã€è¯»å†™è¯·æ±‚</li><li>æ—¶é—´äº‹ä»¶ï¼šå¤„ç†å®šæ—¶ä»»åŠ¡ï¼Œå¦‚è¿‡æœŸé”®åˆ é™¤ã€æŒä¹…åŒ–ç­‰</li></ul><p>Redis 6.0å¼•å…¥äº†å¤šçº¿ç¨‹I&#x2F;Oï¼Œä½†å‘½ä»¤æ‰§è¡Œä»æ˜¯å•çº¿ç¨‹ï¼Œå¤šçº¿ç¨‹åªç”¨äºç½‘ç»œI&#x2F;Oæ“ä½œçš„è¯»å†™ï¼Œè¿™æ ·æ—¢æé«˜äº†ç½‘ç»œå¤„ç†èƒ½åŠ›ï¼Œåˆä¿æŒäº†æ•°æ®æ“ä½œçš„åŸå­æ€§ã€‚</p><h2 id="æ•°æ®ç±»å‹è¯¦è§£ä¸åº”ç”¨åœºæ™¯"><a href="#æ•°æ®ç±»å‹è¯¦è§£ä¸åº”ç”¨åœºæ™¯" class="headerlink" title="æ•°æ®ç±»å‹è¯¦è§£ä¸åº”ç”¨åœºæ™¯"></a>æ•°æ®ç±»å‹è¯¦è§£ä¸åº”ç”¨åœºæ™¯</h2><h3 id="Redis-çš„æ•°æ®ç»“æ„è¯¦è§£"><a href="#Redis-çš„æ•°æ®ç»“æ„è¯¦è§£" class="headerlink" title="Redis çš„æ•°æ®ç»“æ„è¯¦è§£"></a>Redis çš„æ•°æ®ç»“æ„è¯¦è§£</h3><hr><p>è¿™æ˜¯ Redis æœ€æœ‰ç‰¹è‰²çš„åœ°æ–¹ï¼Œç†è§£è¿™äº›æ•°æ®ç»“æ„æ˜¯æŒæ¡ Redis çš„å…³é”®ã€‚</p><h4 id="1-String-å­—ç¬¦ä¸²"><a href="#1-String-å­—ç¬¦ä¸²" class="headerlink" title="1. String (å­—ç¬¦ä¸²)"></a>1. String (å­—ç¬¦ä¸²)</h4><ul><li><strong>æœ€åŸºæœ¬çš„æ•°æ®ç»“æ„</strong>ï¼Œå¯ä»¥å­˜å‚¨ä»»ä½•ç±»å‹çš„æ•°æ®ï¼Œæ¯”å¦‚å­—ç¬¦ä¸²ã€æ•°å­—æˆ–äºŒè¿›åˆ¶æ•°æ®ã€‚ä¸€ä¸ªé”®æœ€å¤šå¯ä»¥å­˜å‚¨ 512MB çš„å€¼ã€‚</li><li><strong>å¸¸ç”¨å‘½ä»¤</strong>:<ul><li><code>SET key value</code>: è®¾ç½®é”®å€¼å¯¹ã€‚</li><li><code>GET key</code>: è·å–é”®å¯¹åº”çš„å€¼ã€‚</li><li><code>INCR key</code>: å°†é”®å¯¹åº”çš„å€¼åŠ  1ï¼Œå¸¸ç”¨äºè®¡æ•°å™¨ã€‚</li><li><code>MSET key1 value1 key2 value2</code>: åŒæ—¶è®¾ç½®å¤šä¸ªé”®å€¼å¯¹ã€‚</li><li><code>MGET key1 key2</code>: åŒæ—¶è·å–å¤šä¸ªé”®çš„å€¼ã€‚</li></ul></li><li><strong>åº”ç”¨åœºæ™¯</strong>: ç¼“å­˜ã€è®¡æ•°å™¨ã€åˆ†å¸ƒå¼é”ç­‰ã€‚</li></ul><h4 id="2-Hash-å“ˆå¸Œ"><a href="#2-Hash-å“ˆå¸Œ" class="headerlink" title="2. Hash (å“ˆå¸Œ)"></a>2. Hash (å“ˆå¸Œ)</h4><ul><li><strong>ç±»ä¼¼äºä¸€ä¸ªé”®å€¼å¯¹çš„é›†åˆ</strong>ã€‚ä¸€ä¸ªå“ˆå¸Œé”®å¯ä»¥å­˜å‚¨å¤šä¸ªå­—æ®µï¼ˆfieldï¼‰å’Œå¯¹åº”çš„å€¼ï¼ˆvalueï¼‰ï¼Œéå¸¸é€‚åˆå­˜å‚¨å¯¹è±¡ã€‚</li><li><strong>å¸¸ç”¨å‘½ä»¤</strong>:<ul><li><code>HSET key field value</code>: è®¾ç½®å“ˆå¸Œé”®ä¸­ä¸€ä¸ªå­—æ®µçš„å€¼ã€‚</li><li><code>HGET key field</code>: è·å–å“ˆå¸Œé”®ä¸­ä¸€ä¸ªå­—æ®µçš„å€¼ã€‚</li><li><code>HGETALL key</code>: è·å–å“ˆå¸Œé”®ä¸­æ‰€æœ‰çš„å­—æ®µå’Œå€¼ã€‚</li><li><code>HMSET key field1 value1 field2 value2</code>: åŒæ—¶è®¾ç½®å¤šä¸ªå­—æ®µã€‚</li><li><code>HDEL key field1 field2</code>: åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ®µã€‚</li></ul></li><li><strong>åº”ç”¨åœºæ™¯</strong>: å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ï¼ˆå¦‚<code>user:100</code>ä½œä¸ºé”®ï¼Œ<code>name</code>ã€<code>age</code>ã€<code>city</code>ä½œä¸ºå­—æ®µï¼‰ï¼Œå•†å“ä¿¡æ¯ç­‰ã€‚</li></ul><h4 id="3-List-åˆ—è¡¨"><a href="#3-List-åˆ—è¡¨" class="headerlink" title="3. List (åˆ—è¡¨)"></a>3. List (åˆ—è¡¨)</h4><ul><li><strong>ä¸€ä¸ªæœ‰åºçš„ã€å¯ä»¥é‡å¤çš„å­—ç¬¦ä¸²é›†åˆ</strong>ã€‚å¯ä»¥ä»åˆ—è¡¨çš„å¤´éƒ¨æˆ–å°¾éƒ¨æ·»åŠ æˆ–åˆ é™¤å…ƒç´ ã€‚</li><li><strong>å¸¸ç”¨å‘½ä»¤</strong>:<ul><li><code>LPUSH key value1 value2</code>: ä»åˆ—è¡¨çš„å¤´éƒ¨æ’å…¥ä¸€ä¸ªæˆ–å¤šä¸ªå€¼ã€‚</li><li><code>RPUSH key value1 value2</code>: ä»åˆ—è¡¨çš„å°¾éƒ¨æ’å…¥ä¸€ä¸ªæˆ–å¤šä¸ªå€¼ã€‚</li><li><code>LPOP key</code>: ä»åˆ—è¡¨çš„å¤´éƒ¨ç§»é™¤å¹¶è¿”å›ä¸€ä¸ªå€¼ã€‚</li><li><code>RPOP key</code>: ä»åˆ—è¡¨çš„å°¾éƒ¨ç§»é™¤å¹¶è¿”å›ä¸€ä¸ªå€¼ã€‚</li><li><code>LRANGE key start stop</code>: è·å–åˆ—è¡¨ä¸­æŒ‡å®šèŒƒå›´çš„å…ƒç´ ã€‚</li></ul></li><li><strong>åº”ç”¨åœºæ™¯</strong>: æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆé˜Ÿåˆ—ã€æ ˆï¼‰ã€æœ€æ–°æ–‡ç« åˆ—è¡¨ã€å†å²è®°å½•ç­‰ã€‚</li></ul><h4 id="4-Set-é›†åˆ"><a href="#4-Set-é›†åˆ" class="headerlink" title="4. Set (é›†åˆ)"></a>4. Set (é›†åˆ)</h4><ul><li><strong>ä¸€ä¸ªæ— åºçš„ã€ä¸é‡å¤çš„å­—ç¬¦ä¸²é›†åˆ</strong>ã€‚é›†åˆæä¾›äº†äº¤é›†ã€å¹¶é›†å’Œå·®é›†ç­‰æ“ä½œã€‚</li><li><strong>å¸¸ç”¨å‘½ä»¤</strong>:<ul><li><code>SADD key member1 member2</code>: å‘é›†åˆä¸­æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜ã€‚</li><li><code>SMEMBERS key</code>: è·å–é›†åˆä¸­çš„æ‰€æœ‰æˆå‘˜ã€‚</li><li><code>SISMEMBER key member</code>: åˆ¤æ–­ä¸€ä¸ªæˆå‘˜æ˜¯å¦åœ¨é›†åˆä¸­ã€‚</li><li><code>SINTER key1 key2</code>: æ±‚ä¸¤ä¸ªé›†åˆçš„äº¤é›†ã€‚</li><li><code>SUNION key1 key2</code>: æ±‚ä¸¤ä¸ªé›†åˆçš„å¹¶é›†ã€‚</li></ul></li><li><strong>åº”ç”¨åœºæ™¯</strong>: ç¤¾äº¤ç½‘ç»œä¸­çš„å…±åŒå¥½å‹ã€æ ‡ç­¾ç³»ç»Ÿã€å»é‡ç­‰ã€‚</li></ul><h4 id="5-Sorted-Set-æœ‰åºé›†åˆ"><a href="#5-Sorted-Set-æœ‰åºé›†åˆ" class="headerlink" title="5. Sorted Set (æœ‰åºé›†åˆ)"></a>5. Sorted Set (æœ‰åºé›†åˆ)</h4><ul><li><strong>å’Œé›†åˆç±»ä¼¼ï¼Œä½†æ¯ä¸ªæˆå‘˜éƒ½ä¼šå…³è”ä¸€ä¸ªåˆ†æ•°ï¼ˆscoreï¼‰</strong>ã€‚é€šè¿‡è¿™ä¸ªåˆ†æ•°ï¼Œå¯ä»¥å¯¹é›†åˆä¸­çš„æˆå‘˜è¿›è¡Œæ’åºã€‚åˆ†æ•°å¯ä»¥é‡å¤ï¼Œä½†æˆå‘˜å¿…é¡»å”¯ä¸€ã€‚</li><li><strong>å¸¸ç”¨å‘½ä»¤</strong>:<ul><li><code>ZADD key score1 member1 score2 member2</code>: å‘æœ‰åºé›†åˆä¸­æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå¸¦åˆ†æ•°çš„æˆå‘˜ã€‚</li><li><code>ZRANGE key start stop</code>: æŒ‰åˆ†æ•°ä»å°åˆ°å¤§æ’åºï¼Œè·å–æŒ‡å®šèŒƒå›´çš„æˆå‘˜ã€‚</li><li><code>ZREVRANGE key start stop</code>: æŒ‰åˆ†æ•°ä»å¤§åˆ°å°æ’åºï¼Œè·å–æŒ‡å®šèŒƒå›´çš„æˆå‘˜ã€‚</li><li><code>ZSCORE key member</code>: è·å–ä¸€ä¸ªæˆå‘˜çš„åˆ†æ•°ã€‚</li><li><code>ZINCRBY key increment member</code>: ç»™æŒ‡å®šæˆå‘˜çš„åˆ†æ•°å¢åŠ æŒ‡å®šå€¼ã€‚</li></ul></li><li><strong>åº”ç”¨åœºæ™¯</strong>: æ’è¡Œæ¦œï¼ˆæ¸¸æˆåˆ†æ•°ã€çƒ­ç‚¹æ–°é—»ï¼‰ã€å¸¦æƒé‡çš„ä»»åŠ¡é˜Ÿåˆ—ç­‰ã€‚</li></ul><h3 id="Redis-çš„æŒä¹…åŒ–æœºåˆ¶"><a href="#Redis-çš„æŒä¹…åŒ–æœºåˆ¶" class="headerlink" title="Redis çš„æŒä¹…åŒ–æœºåˆ¶"></a>Redis çš„æŒä¹…åŒ–æœºåˆ¶</h3><hr><p>Redis æä¾›äº†ä¸¤ç§æŒä¹…åŒ–æ–¹å¼ï¼Œå¯ä»¥å°†æ•°æ®ä»å†…å­˜ä¿å­˜åˆ°ç¡¬ç›˜ï¼Œç¡®ä¿æ•°æ®ä¸ä¼šå› ä¸ºæœåŠ¡é‡å¯è€Œä¸¢å¤±ã€‚</p><h4 id="1-RDB-Redis-Database"><a href="#1-RDB-Redis-Database" class="headerlink" title="1. RDB (Redis Database)"></a>1. RDB (Redis Database)</h4><ul><li><strong>å¿«ç…§æ–¹å¼</strong>ã€‚å®ƒä¼šåœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…ï¼Œå°†å†…å­˜ä¸­çš„æ•°æ®å¿«ç…§å†™å…¥åˆ°ç£ç›˜ä¸Šä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼ˆ<code>dump.rdb</code>ï¼‰ã€‚</li><li><strong>ä¼˜ç‚¹</strong>: RDB æ–‡ä»¶æ˜¯ä¸€ä¸ªéå¸¸ç´§å‡‘çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œéå¸¸é€‚åˆå¤‡ä»½å’Œç¾éš¾æ¢å¤ã€‚</li><li><strong>ç¼ºç‚¹</strong>: æ¯æ¬¡ä¿å­˜éƒ½ä¼šä¸¢å¤±ä»ä¸Šæ¬¡å¿«ç…§åˆ°ç°åœ¨ä¹‹é—´çš„æ•°æ®ã€‚</li></ul><h4 id="2-AOF-Append-Only-File"><a href="#2-AOF-Append-Only-File" class="headerlink" title="2. AOF (Append Only File)"></a>2. AOF (Append Only File)</h4><ul><li><strong>æ—¥å¿—æ–¹å¼</strong>ã€‚å®ƒä¼šè®°å½•æ¯ä¸€æ¬¡å¯¹ Redis æ•°æ®åº“çš„å†™æ“ä½œå‘½ä»¤ï¼Œå¹¶ä»¥è¿½åŠ ï¼ˆappendï¼‰çš„æ–¹å¼å†™å…¥åˆ°æ–‡ä»¶ä¸­ã€‚å½“ Redis é‡å¯æ—¶ï¼Œä¼šé‡æ–°æ‰§è¡Œ AOF æ–‡ä»¶ä¸­çš„å‘½ä»¤æ¥æ¢å¤æ•°æ®ã€‚</li><li><strong>ä¼˜ç‚¹</strong>: æ•°æ®ä¸¢å¤±é£é™©ä½ï¼Œå¯ä»¥é…ç½®ä¸ºæ¯ç§’åŒæ­¥ä¸€æ¬¡ï¼Œæˆ–è€…æ¯æ‰§è¡Œä¸€ä¸ªå‘½ä»¤å°±åŒæ­¥ä¸€æ¬¡ã€‚</li><li><strong>ç¼ºç‚¹</strong>: AOF æ–‡ä»¶é€šå¸¸æ¯” RDB æ–‡ä»¶å¤§ï¼Œä¸”æ¢å¤é€Ÿåº¦å¯èƒ½è¾ƒæ…¢ã€‚</li></ul><p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œé€šå¸¸ä¼š<strong>åŒæ—¶ä½¿ç”¨ RDB å’Œ AOF</strong>ï¼Œä»¥è·å¾—æ›´é«˜çš„å¯é æ€§ã€‚</p><h3 id="Stringç±»å‹"><a href="#Stringç±»å‹" class="headerlink" title="Stringç±»å‹"></a>Stringç±»å‹</h3><p>Stringæ˜¯Redisæœ€åŸºç¡€çš„æ•°æ®ç±»å‹ï¼Œåº•å±‚å¯ä»¥æ˜¯SDSã€æ•´æ•°æˆ–æµ®ç‚¹æ•°ã€‚</p><p><strong>å¸¸ç”¨å‘½ä»¤</strong>ï¼šSETã€GETã€INCRã€DECRã€APPENDã€GETRANGE <strong>åº”ç”¨åœºæ™¯</strong>ï¼š</p><ul><li>ç¼“å­˜ï¼šå­˜å‚¨ç”¨æˆ·ä¼šè¯ã€é…ç½®ä¿¡æ¯</li><li>è®¡æ•°å™¨ï¼šç½‘ç«™è®¿é—®é‡ã€ç‚¹èµæ•°ï¼ˆINCRåŸå­æ€§ä¿è¯ï¼‰</li><li>åˆ†å¸ƒå¼é”ï¼šSET key value NX EX seconds</li><li>é™æµï¼šç»“åˆEXPIREå®ç°æ»‘åŠ¨çª—å£é™æµ</li></ul><h3 id="Hashç±»å‹"><a href="#Hashç±»å‹" class="headerlink" title="Hashç±»å‹"></a>Hashç±»å‹</h3><p>Hashç±»å‹é€‚åˆå­˜å‚¨å¯¹è±¡ï¼Œé¿å…äº†å°†å¯¹è±¡åºåˆ—åŒ–ä¸ºJSONå­—ç¬¦ä¸²çš„å¼€é”€ã€‚</p><p><strong>åº•å±‚å®ç°</strong>ï¼šå…ƒç´ è¾ƒå°‘æ—¶ä½¿ç”¨ziplistï¼Œå…ƒç´ è¾ƒå¤šæ—¶ä½¿ç”¨hashtable <strong>åº”ç”¨åœºæ™¯</strong>ï¼š</p><ul><li>å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ï¼šHSET user:1001 name â€œå¼ ä¸‰â€ age 25</li><li>è´­ç‰©è½¦ï¼šHSET cart:1001 product:123 2</li><li>é…ç½®ç®¡ç†ï¼šåˆ†ç±»å­˜å‚¨ä¸åŒæ¨¡å—çš„é…ç½®</li></ul><h3 id="Listç±»å‹"><a href="#Listç±»å‹" class="headerlink" title="Listç±»å‹"></a>Listç±»å‹</h3><p>Listæ˜¯åŒå‘é“¾è¡¨å®ç°ï¼Œæ”¯æŒåœ¨ä¸¤ç«¯è¿›è¡ŒO(1)çš„æ’å…¥å’Œåˆ é™¤æ“ä½œã€‚</p><p><strong>å¸¸ç”¨å‘½ä»¤</strong>ï¼šLPUSHã€RPUSHã€LPOPã€RPOPã€LRANGEã€BLPOP <strong>åº”ç”¨åœºæ™¯</strong>ï¼š</p><ul><li>æ¶ˆæ¯é˜Ÿåˆ—ï¼šç”Ÿäº§è€…LPUSHï¼Œæ¶ˆè´¹è€…BRPOPå®ç°é˜»å¡é˜Ÿåˆ—</li><li>æœ€æ–°åˆ—è¡¨ï¼šæœ‹å‹åœˆåŠ¨æ€ã€å•†å“è¯„è®º</li><li>æ ˆå’Œé˜Ÿåˆ—ï¼šLPUSH+LPOPå®ç°æ ˆï¼ŒLPUSH+RPOPå®ç°é˜Ÿåˆ—</li></ul><h3 id="Setç±»å‹"><a href="#Setç±»å‹" class="headerlink" title="Setç±»å‹"></a>Setç±»å‹</h3><p>Setæ˜¯æ— åºé›†åˆï¼Œå…ƒç´ å”¯ä¸€ï¼Œåº•å±‚ä½¿ç”¨hashtableæˆ–intsetå®ç°ã€‚</p><p><strong>é›†åˆè¿ç®—</strong>ï¼šSINTERï¼ˆäº¤é›†ï¼‰ã€SUNIONï¼ˆå¹¶é›†ï¼‰ã€SDIFFï¼ˆå·®é›†ï¼‰ <strong>åº”ç”¨åœºæ™¯</strong>ï¼š</p><ul><li>å»é‡ï¼šç»Ÿè®¡ç½‘ç«™ç‹¬ç«‹è®¿å®¢</li><li>ç¤¾äº¤å…³ç³»ï¼šå…±åŒå¥½å‹ã€æ¨èç”¨æˆ·</li><li>æ ‡ç­¾ç³»ç»Ÿï¼šç”¨æˆ·æ ‡ç­¾ã€æ–‡ç« åˆ†ç±»</li><li>æŠ½å¥–ç³»ç»Ÿï¼šSRANDMEMBERéšæœºæŠ½å–</li></ul><h3 id="Sorted-Setç±»å‹"><a href="#Sorted-Setç±»å‹" class="headerlink" title="Sorted Setç±»å‹"></a>Sorted Setç±»å‹</h3><p>æœ‰åºé›†åˆï¼Œæ¯ä¸ªå…ƒç´ å…³è”ä¸€ä¸ªåˆ†æ•°ï¼ŒæŒ‰åˆ†æ•°æ’åºã€‚åº•å±‚ä½¿ç”¨è·³è·ƒè¡¨å’Œå“ˆå¸Œè¡¨ã€‚</p><p><strong>åº”ç”¨åœºæ™¯</strong>ï¼š</p><ul><li>æ’è¡Œæ¦œï¼šæ¸¸æˆç§¯åˆ†ã€çƒ­æœæ¦œ</li><li>å»¶æ—¶é˜Ÿåˆ—ï¼šåˆ†æ•°ä¸ºæ‰§è¡Œæ—¶é—´æˆ³</li><li>èŒƒå›´æŸ¥è¯¢ï¼šæŒ‰æ—¶é—´ã€æŒ‰åˆ†æ•°èŒƒå›´è·å–æ•°æ®</li></ul><h2 id="æŒä¹…åŒ–æœºåˆ¶æ·±åº¦è§£æ"><a href="#æŒä¹…åŒ–æœºåˆ¶æ·±åº¦è§£æ" class="headerlink" title="æŒä¹…åŒ–æœºåˆ¶æ·±åº¦è§£æ"></a>æŒä¹…åŒ–æœºåˆ¶æ·±åº¦è§£æ</h2><h3 id="RDBæŒä¹…åŒ–"><a href="#RDBæŒä¹…åŒ–" class="headerlink" title="RDBæŒä¹…åŒ–"></a>RDBæŒä¹…åŒ–</h3><p>RDBé€šè¿‡forkå­è¿›ç¨‹ï¼Œå°†å†…å­˜æ•°æ®å¿«ç…§å†™å…¥ç£ç›˜ã€‚</p><p><strong>ä¼˜ç‚¹</strong>ï¼š</p><ul><li>æ–‡ä»¶ç´§å‡‘ï¼Œé€‚åˆå¤‡ä»½å’Œç¾éš¾æ¢å¤</li><li>æ¢å¤é€Ÿåº¦å¿«</li><li>å¯¹Redisæ€§èƒ½å½±å“å°ï¼ˆå­è¿›ç¨‹æ“ä½œï¼‰</li></ul><p><strong>ç¼ºç‚¹</strong>ï¼š</p><ul><li>æ•°æ®ä¸¢å¤±é£é™©ï¼šä¸¤æ¬¡å¿«ç…§é—´çš„æ•°æ®å¯èƒ½ä¸¢å¤±</li><li>forkè¿‡ç¨‹ä¼šé˜»å¡ä¸»è¿›ç¨‹</li><li>å¤§æ•°æ®é›†forkè€—æ—¶è¾ƒé•¿</li></ul><p><strong>è§¦å‘æ¡ä»¶</strong>ï¼š</p><ul><li>æ‰‹åŠ¨æ‰§è¡ŒSAVEæˆ–BGSAVEå‘½ä»¤</li><li>é…ç½®è‡ªåŠ¨è§¦å‘ï¼šsave 900 1ï¼ˆ900ç§’å†…è‡³å°‘1ä¸ªé”®æ”¹å˜ï¼‰</li><li>ä¸»ä»å¤åˆ¶æ—¶è‡ªåŠ¨ç”ŸæˆRDB</li></ul><h3 id="AOFæŒä¹…åŒ–"><a href="#AOFæŒä¹…åŒ–" class="headerlink" title="AOFæŒä¹…åŒ–"></a>AOFæŒä¹…åŒ–</h3><p>AOFè®°å½•æ¯ä¸ªå†™å‘½ä»¤ï¼Œé€šè¿‡é‡æ”¾å‘½ä»¤æ¢å¤æ•°æ®ã€‚</p><p><strong>å†™å…¥æ—¶æœº</strong>ï¼š</p><ul><li>alwaysï¼šæ¯ä¸ªå†™å‘½ä»¤ç«‹å³åŒæ­¥ï¼Œå®‰å…¨ä½†æ€§èƒ½ä½</li><li>everysecï¼šæ¯ç§’åŒæ­¥ä¸€æ¬¡ï¼Œå¹³è¡¡å®‰å…¨æ€§å’Œæ€§èƒ½</li><li>noï¼šç”±æ“ä½œç³»ç»Ÿå†³å®šåŒæ­¥æ—¶æœºï¼Œæ€§èƒ½é«˜ä½†å®‰å…¨æ€§ä½</li></ul><p><strong>AOFé‡å†™</strong>ï¼š AOFæ–‡ä»¶ä¼šè¶Šæ¥è¶Šå¤§ï¼ŒRedisæä¾›é‡å†™æœºåˆ¶ä¼˜åŒ–ï¼š</p><ul><li>éå†å†…å­˜æ•°æ®ï¼Œç”¨æœ€å°‘å‘½ä»¤é‡å»ºAOFæ–‡ä»¶</li><li>é‡å†™æœŸé—´çš„æ–°å‘½ä»¤å†™å…¥AOFé‡å†™ç¼“å†²åŒº</li><li>åŸå­æ€§æ›¿æ¢æ—§AOFæ–‡ä»¶</li></ul><p><strong>æ··åˆæŒä¹…åŒ–</strong>ï¼š Redis 4.0å¼•å…¥RDB+AOFæ··åˆæ¨¡å¼ï¼Œé‡å†™æ—¶ä»¥RDBæ ¼å¼å†™å…¥åŸºç¡€æ•°æ®ï¼Œå¢é‡å‘½ä»¤ä»¥AOFæ ¼å¼è¿½åŠ ï¼Œå…¼é¡¾äº†æ¢å¤é€Ÿåº¦å’Œæ•°æ®å®‰å…¨ã€‚</p><h2 id="ç¼“å­˜é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ"><a href="#ç¼“å­˜é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ" class="headerlink" title="ç¼“å­˜é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ"></a>ç¼“å­˜é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</h2><h3 id="ç¼“å­˜ç©¿é€"><a href="#ç¼“å­˜ç©¿é€" class="headerlink" title="ç¼“å­˜ç©¿é€"></a>ç¼“å­˜ç©¿é€</h3><p>æŸ¥è¯¢ä¸å­˜åœ¨çš„æ•°æ®ï¼Œç¼“å­˜æ— æ³•ç”Ÿæ•ˆï¼Œè¯·æ±‚ç›´è¾¾æ•°æ®åº“ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><ol><li><strong>ç©ºå€¼ç¼“å­˜</strong>ï¼šæŸ¥è¯¢ç»“æœä¸ºç©ºæ—¶ä¹Ÿç¼“å­˜ï¼Œè®¾ç½®è¾ƒçŸ­è¿‡æœŸæ—¶é—´</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (data == <span class="literal">null</span>) &#123;</span><br><span class="line">    redis.setex(key, <span class="number">60</span>, <span class="string">&quot;null&quot;</span>);  <span class="comment">// ç¼“å­˜ç©ºå€¼60ç§’</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li><strong>å¸ƒéš†è¿‡æ»¤å™¨</strong>ï¼šé¢„å…ˆå°†æ‰€æœ‰å¯èƒ½å­˜åœ¨çš„æ•°æ®å“ˆå¸Œåˆ°ä½æ•°ç»„</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">BloomFilter&lt;String&gt; filter = BloomFilter.create(Funnels.stringFunnel(Charset.defaultCharset()), <span class="number">1000000</span>, <span class="number">0.01</span>);</span><br><span class="line"><span class="comment">// æŸ¥è¯¢å‰å…ˆæ£€æŸ¥å¸ƒéš†è¿‡æ»¤å™¨</span></span><br><span class="line"><span class="keyword">if</span> (!filter.mightContain(key)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;  <span class="comment">// ä¸€å®šä¸å­˜åœ¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li><strong>å‚æ•°æ ¡éªŒ</strong>ï¼šåœ¨APIå±‚é¢è¿›è¡Œå‚æ•°åˆæ³•æ€§æ ¡éªŒ</li></ol><h3 id="ç¼“å­˜å‡»ç©¿"><a href="#ç¼“å­˜å‡»ç©¿" class="headerlink" title="ç¼“å­˜å‡»ç©¿"></a>ç¼“å­˜å‡»ç©¿</h3><p>çƒ­ç‚¹æ•°æ®è¿‡æœŸç¬é—´ï¼Œå¤§é‡å¹¶å‘è¯·æ±‚å‡»ç©¿ç¼“å­˜ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><ol><li><strong>äº’æ–¥é”</strong>ï¼šåªå…è®¸ä¸€ä¸ªçº¿ç¨‹æŸ¥è¯¢æ•°æ®åº“å¹¶é‡å»ºç¼“å­˜</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">getData</span><span class="params">(String key)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> redis.get(key);</span><br><span class="line">    <span class="keyword">if</span> (data == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">lockKey</span> <span class="operator">=</span> <span class="string">&quot;lock:&quot;</span> + key;</span><br><span class="line">        <span class="keyword">if</span> (redis.setnx(lockKey, <span class="string">&quot;1&quot;</span>, <span class="number">10</span>)) &#123;  <span class="comment">// è·å–é”</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                data = database.query(key);  <span class="comment">// æŸ¥è¯¢æ•°æ®åº“</span></span><br><span class="line">                redis.setex(key, <span class="number">3600</span>, data);  <span class="comment">// é‡å»ºç¼“å­˜</span></span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                redis.del(lockKey);  <span class="comment">// é‡Šæ”¾é”</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">50</span>);  <span class="comment">// ç­‰å¾…å…¶ä»–çº¿ç¨‹é‡å»ºç¼“å­˜</span></span><br><span class="line">            <span class="keyword">return</span> getData(key);  <span class="comment">// é€’å½’é‡è¯•</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li><strong>çƒ­ç‚¹æ•°æ®æ°¸ä¸è¿‡æœŸ</strong>ï¼šé€»è¾‘ä¸Šè®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œç‰©ç†ä¸Šä¸è¿‡æœŸï¼Œå¼‚æ­¥æ›´æ–°</li><li><strong>é¢„çƒ­æœºåˆ¶</strong>ï¼šç³»ç»Ÿå¯åŠ¨æ—¶é¢„å…ˆåŠ è½½çƒ­ç‚¹æ•°æ®</li><li><strong>äºŒçº§ç¼“å­˜</strong>ï¼šL1ç¼“å­˜è¿‡æœŸåï¼Œå…ˆè¿”å›L2ç¼“å­˜æ•°æ®ï¼Œå¼‚æ­¥æ›´æ–°L1</li></ol><h3 id="ç¼“å­˜é›ªå´©"><a href="#ç¼“å­˜é›ªå´©" class="headerlink" title="ç¼“å­˜é›ªå´©"></a>ç¼“å­˜é›ªå´©</h3><p>å¤§é‡ç¼“å­˜åŒæ—¶è¿‡æœŸæˆ–Rediså®•æœºï¼Œè¯·æ±‚æ¶Œå‘æ•°æ®åº“ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><ol><li><strong>è¿‡æœŸæ—¶é—´éšæœºåŒ–</strong>ï¼šé¿å…åŒæ—¶è¿‡æœŸ</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">randomExpire</span> <span class="operator">=</span> baseExpire + <span class="keyword">new</span> <span class="title class_">Random</span>().nextInt(<span class="number">300</span>);  <span class="comment">// åŸºç¡€æ—¶é—´+éšæœºæ—¶é—´</span></span><br><span class="line">redis.setex(key, randomExpire, data);</span><br></pre></td></tr></table></figure><ol><li><strong>å¤šçº§ç¼“å­˜æ¶æ„</strong>ï¼š<ul><li>L1ï¼šæœ¬åœ°ç¼“å­˜ï¼ˆå¦‚Caffeineï¼‰</li><li>L2ï¼šRedisåˆ†å¸ƒå¼ç¼“å­˜</li><li>L3ï¼šæ•°æ®åº“</li></ul></li><li><strong>é™æµé™çº§</strong>ï¼šä½¿ç”¨Sentinelã€Hystrixç­‰ç»„ä»¶</li><li><strong>Redisé«˜å¯ç”¨</strong>ï¼šä¸»ä»å¤åˆ¶ã€å“¨å…µæ¨¡å¼ã€é›†ç¾¤éƒ¨ç½²</li></ol><h3 id="ç¼“å­˜é¢„çƒ­"><a href="#ç¼“å­˜é¢„çƒ­" class="headerlink" title="ç¼“å­˜é¢„çƒ­"></a>ç¼“å­˜é¢„çƒ­</h3><p>ç³»ç»Ÿå¯åŠ¨æ—¶é¢„å…ˆåŠ è½½çƒ­ç‚¹æ•°æ®åˆ°ç¼“å­˜ã€‚</p><p><strong>å®ç°æ–¹å¼</strong>ï¼š</p><ol><li><strong>å®šæ—¶ä»»åŠ¡é¢„çƒ­</strong>ï¼šå‡Œæ™¨ä½å³°æœŸæ‰§è¡Œ</li><li><strong>æ‰‹åŠ¨é¢„çƒ­</strong>ï¼šç®¡ç†åå°è§¦å‘é¢„çƒ­ä»»åŠ¡</li><li><strong>å®æ—¶é¢„çƒ­</strong>ï¼šç›‘æ§ç³»ç»Ÿå‘ç°çƒ­ç‚¹æ•°æ®è‡ªåŠ¨é¢„çƒ­</li></ol><h2 id="æ•°æ®ä¸€è‡´æ€§ä¿è¯"><a href="#æ•°æ®ä¸€è‡´æ€§ä¿è¯" class="headerlink" title="æ•°æ®ä¸€è‡´æ€§ä¿è¯"></a>æ•°æ®ä¸€è‡´æ€§ä¿è¯</h2><h3 id="Cache-Asideæ¨¡å¼ï¼ˆæ—è·¯ç¼“å­˜ï¼‰"><a href="#Cache-Asideæ¨¡å¼ï¼ˆæ—è·¯ç¼“å­˜ï¼‰" class="headerlink" title="Cache Asideæ¨¡å¼ï¼ˆæ—è·¯ç¼“å­˜ï¼‰"></a>Cache Asideæ¨¡å¼ï¼ˆæ—è·¯ç¼“å­˜ï¼‰</h3><p>åº”ç”¨ç¨‹åºè´Ÿè´£ç»´æŠ¤ç¼“å­˜å’Œæ•°æ®åº“çš„ä¸€è‡´æ€§ã€‚</p><p><strong>è¯»æ“ä½œ</strong>ï¼š</p><ol><li>å…ˆè¯»ç¼“å­˜ï¼Œå‘½ä¸­åˆ™è¿”å›</li><li>ç¼“å­˜ä¸å‘½ä¸­ï¼ŒæŸ¥è¯¢æ•°æ®åº“</li><li>å°†æ•°æ®å†™å…¥ç¼“å­˜å¹¶è¿”å›</li></ol><p><strong>å†™æ“ä½œ</strong>ï¼š</p><ol><li>å…ˆæ›´æ–°æ•°æ®åº“</li><li>åˆ é™¤ç¼“å­˜ï¼ˆè®©ä¸‹æ¬¡è¯»å–æ—¶é‡æ–°åŠ è½½ï¼‰</li></ol><p><strong>ä¸ºä»€ä¹ˆæ˜¯åˆ é™¤è€Œä¸æ˜¯æ›´æ–°ç¼“å­˜ï¼Ÿ</strong></p><ul><li>æ›´æ–°ç¼“å­˜å¯èƒ½å­˜åœ¨å¹¶å‘é—®é¢˜</li><li>å¤æ‚æŸ¥è¯¢çš„ç¼“å­˜æ›´æ–°æˆæœ¬é«˜</li><li>åˆ é™¤ç¼“å­˜æ›´ç®€å•å¯é </li></ul><h3 id="å»¶æ—¶åŒåˆ ç­–ç•¥"><a href="#å»¶æ—¶åŒåˆ ç­–ç•¥" class="headerlink" title="å»¶æ—¶åŒåˆ ç­–ç•¥"></a>å»¶æ—¶åŒåˆ ç­–ç•¥</h3><p>è§£å†³è¯»å†™å¹¶å‘å¯¼è‡´çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜ã€‚</p><p><strong>å®ç°æ­¥éª¤</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateData</span><span class="params">(String key, Object data)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. åˆ é™¤ç¼“å­˜</span></span><br><span class="line">    redis.del(key);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. æ›´æ–°æ•°æ®åº“</span></span><br><span class="line">    database.update(data);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. å»¶æ—¶åˆ é™¤ç¼“å­˜ï¼ˆå¼‚æ­¥ï¼‰</span></span><br><span class="line">    CompletableFuture.runAsync(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">500</span>);  <span class="comment">// å»¶æ—¶500ms</span></span><br><span class="line">            redis.del(key);     <span class="comment">// å†æ¬¡åˆ é™¤ç¼“å­˜</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;å»¶æ—¶åˆ é™¤ç¼“å­˜å¤±è´¥&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å»¶æ—¶æ—¶é—´è®¾ç½®</strong>ï¼šé€šå¸¸ä¸ºä¸»ä»åŒæ­¥æ—¶é—´ + è¯»æ•°æ®åº“æ—¶é—´ + å‡ åæ¯«ç§’</p><h3 id="åŸºäºæ¶ˆæ¯é˜Ÿåˆ—çš„æœ€ç»ˆä¸€è‡´æ€§"><a href="#åŸºäºæ¶ˆæ¯é˜Ÿåˆ—çš„æœ€ç»ˆä¸€è‡´æ€§" class="headerlink" title="åŸºäºæ¶ˆæ¯é˜Ÿåˆ—çš„æœ€ç»ˆä¸€è‡´æ€§"></a>åŸºäºæ¶ˆæ¯é˜Ÿåˆ—çš„æœ€ç»ˆä¸€è‡´æ€§</h3><p>ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—å¼‚æ­¥å¤„ç†ç¼“å­˜æ›´æ–°ï¼Œä¿è¯æœ€ç»ˆä¸€è‡´æ€§ã€‚</p><p><strong>å®ç°æµç¨‹</strong>ï¼š</p><ol><li>æ›´æ–°æ•°æ®åº“ï¼Œå‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—</li><li>æ¶ˆæ¯æ¶ˆè´¹è€…åˆ é™¤ç›¸å…³ç¼“å­˜</li><li>æ¶ˆè´¹å¤±è´¥æ—¶é‡è¯•ï¼Œä¿è¯æœ€ç»ˆä¸€è‡´æ€§</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‘é€ç¼“å­˜åˆ é™¤æ¶ˆæ¯</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateUser</span><span class="params">(User user)</span> &#123;</span><br><span class="line">    userDao.update(user);  <span class="comment">// æ›´æ–°æ•°æ®åº“</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å‘é€ç¼“å­˜åˆ é™¤æ¶ˆæ¯ï¼ˆäº‹åŠ¡æäº¤åå‘é€ï¼‰</span></span><br><span class="line">    TransactionSynchronizationManager.registerSynchronization(</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">TransactionSynchronizationAdapter</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCommit</span><span class="params">()</span> &#123;</span><br><span class="line">                cacheDeleteMQ.send(<span class="string">&quot;user:&quot;</span> + user.getId());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åˆ†å¸ƒå¼äº‹åŠ¡æ–¹æ¡ˆ"><a href="#åˆ†å¸ƒå¼äº‹åŠ¡æ–¹æ¡ˆ" class="headerlink" title="åˆ†å¸ƒå¼äº‹åŠ¡æ–¹æ¡ˆ"></a>åˆ†å¸ƒå¼äº‹åŠ¡æ–¹æ¡ˆ</h3><p>å¯¹äºå¼ºä¸€è‡´æ€§è¦æ±‚é«˜çš„åœºæ™¯ï¼Œå¯ä»¥ä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡ã€‚</p><p><strong>2PCï¼ˆä¸¤é˜¶æ®µæäº¤ï¼‰</strong>ï¼š</p><ul><li>å‡†å¤‡é˜¶æ®µï¼šåè°ƒè€…è¯¢é—®å‚ä¸è€…æ˜¯å¦å‡†å¤‡å¥½</li><li>æäº¤é˜¶æ®µï¼šæ‰€æœ‰å‚ä¸è€…éƒ½å‡†å¤‡å¥½åˆ™æäº¤ï¼Œå¦åˆ™å›æ»š</li></ul><p><strong>TCCï¼ˆTry-Confirm-Cancelï¼‰</strong>ï¼š</p><ul><li>Tryï¼šå°è¯•æ‰§è¡Œï¼Œé¢„ç•™èµ„æº</li><li>Confirmï¼šç¡®è®¤æäº¤</li><li>Cancelï¼šå–æ¶ˆæ‰§è¡Œï¼Œé‡Šæ”¾èµ„æº</li></ul><h2 id="åˆ†å¸ƒå¼é”å®ç°"><a href="#åˆ†å¸ƒå¼é”å®ç°" class="headerlink" title="åˆ†å¸ƒå¼é”å®ç°"></a>åˆ†å¸ƒå¼é”å®ç°</h2><h3 id="åŸºäºSETå‘½ä»¤çš„åˆ†å¸ƒå¼é”"><a href="#åŸºäºSETå‘½ä»¤çš„åˆ†å¸ƒå¼é”" class="headerlink" title="åŸºäºSETå‘½ä»¤çš„åˆ†å¸ƒå¼é”"></a>åŸºäºSETå‘½ä»¤çš„åˆ†å¸ƒå¼é”</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisDistributedLock</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Jedis jedis;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">tryLock</span><span class="params">(String lockKey, String requestId, <span class="type">int</span> expireTime)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> jedis.set(lockKey, requestId, <span class="string">&quot;NX&quot;</span>, <span class="string">&quot;PX&quot;</span>, expireTime);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;OK&quot;</span>.equals(result);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">releaseLock</span><span class="params">(String lockKey, String requestId)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">script</span> <span class="operator">=</span> <span class="string">&quot;if redis.call(&#x27;get&#x27;, KEYS[1]) == ARGV[1] then &quot;</span> +</span><br><span class="line">                       <span class="string">&quot;return redis.call(&#x27;del&#x27;, KEYS[1]) else return 0 end&quot;</span>;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> jedis.eval(script, Collections.singletonList(lockKey),</span><br><span class="line">                                 Collections.singletonList(requestId));</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;1&quot;</span>.equals(result.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä½¿ç”¨æ–¹å¼</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">lockKey</span> <span class="operator">=</span> <span class="string">&quot;lock:user:1001&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">requestId</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (tryLock(lockKey, requestId, <span class="number">30000</span>)) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// æ‰§è¡Œä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">        doSomething();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        releaseLock(lockKey, requestId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Redlockç®—æ³•"><a href="#Redlockç®—æ³•" class="headerlink" title="Redlockç®—æ³•"></a>Redlockç®—æ³•</h3><p>ä¸ºäº†è§£å†³å•ç‚¹æ•…éšœé—®é¢˜ï¼ŒRediså®˜æ–¹æå‡ºäº†Redlockç®—æ³•ã€‚</p><p><strong>ç®—æ³•æ­¥éª¤</strong>ï¼š</p><ol><li>è·å–å½“å‰æ—¶é—´æˆ³</li><li>ä¾æ¬¡å‘Nä¸ªRediså®ä¾‹ç”³è¯·é”</li><li>å¦‚æœåœ¨å¤§å¤šæ•°å®ä¾‹ï¼ˆN&#x2F;2+1ï¼‰ä¸Šè·å–é”æˆåŠŸï¼Œä¸”æ€»è€—æ—¶å°äºé”è¶…æ—¶æ—¶é—´ï¼Œåˆ™è®¤ä¸ºè·å–é”æˆåŠŸ</li><li>é”çš„æœ‰æ•ˆæ—¶é—´ &#x3D; åˆå§‹æœ‰æ•ˆæ—¶é—´ - è·å–é”æ¶ˆè€—çš„æ—¶é—´</li><li>é‡Šæ”¾é”æ—¶ï¼Œå‘æ‰€æœ‰Rediså®ä¾‹å‘é€é‡Šæ”¾å‘½ä»¤</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Redlock</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Jedis&gt; jedisInstances;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">lock</span><span class="params">(String resource, <span class="type">int</span> ttl)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">quorum</span> <span class="operator">=</span> jedisInstances.size() / <span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">successCount</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (Jedis jedis : jedisInstances) &#123;</span><br><span class="line">            <span class="keyword">if</span> (lockInstance(jedis, resource, ttl)) &#123;</span><br><span class="line">                successCount++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">long</span> <span class="variable">elapsedTime</span> <span class="operator">=</span> System.currentTimeMillis() - startTime;</span><br><span class="line">        <span class="keyword">if</span> (successCount &gt;= quorum &amp;&amp; elapsedTime &lt; ttl) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            unlock(resource);  <span class="comment">// é‡Šæ”¾å·²è·å–çš„é”</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é”çš„é—®é¢˜ä¸ä¼˜åŒ–"><a href="#é”çš„é—®é¢˜ä¸ä¼˜åŒ–" class="headerlink" title="é”çš„é—®é¢˜ä¸ä¼˜åŒ–"></a>é”çš„é—®é¢˜ä¸ä¼˜åŒ–</h3><p><strong>é”è¶…æ—¶é—®é¢˜</strong>ï¼š ä¸šåŠ¡æ‰§è¡Œæ—¶é—´è¶…è¿‡é”è¶…æ—¶æ—¶é—´ï¼Œé”è‡ªåŠ¨é‡Šæ”¾ï¼Œå¯èƒ½å¯¼è‡´å¹¶å‘é—®é¢˜ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><ol><li><strong>çœ‹é—¨ç‹—æœºåˆ¶</strong>ï¼šå®šæ—¶ç»­æœŸé”çš„è¿‡æœŸæ—¶é—´</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WatchDog</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">ScheduledExecutorService</span> <span class="variable">scheduler</span> <span class="operator">=</span> Executors.newScheduledThreadPool(<span class="number">1</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">startWatchDog</span><span class="params">(String lockKey, String requestId)</span> &#123;</span><br><span class="line">        scheduler.scheduleAtFixedRate(() -&gt; &#123;</span><br><span class="line">            <span class="comment">// ç»­æœŸé”</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">script</span> <span class="operator">=</span> <span class="string">&quot;if redis.call(&#x27;get&#x27;, KEYS[1]) == ARGV[1] then &quot;</span> +</span><br><span class="line">                           <span class="string">&quot;return redis.call(&#x27;expire&#x27;, KEYS[1], ARGV[2]) else return 0 end&quot;</span>;</span><br><span class="line">            jedis.eval(script, Arrays.asList(lockKey), </span><br><span class="line">                      Arrays.asList(requestId, <span class="string">&quot;30&quot;</span>));</span><br><span class="line">        &#125;, <span class="number">10</span>, <span class="number">10</span>, TimeUnit.SECONDS);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li><strong>åˆç†è¯„ä¼°ä¸šåŠ¡æ‰§è¡Œæ—¶é—´</strong>ï¼šè®¾ç½®è¶³å¤Ÿçš„é”è¶…æ—¶æ—¶é—´</li></ol><p><strong>é”ç«äº‰æ¿€çƒˆé—®é¢˜</strong>ï¼š å¤§é‡çº¿ç¨‹ç«äº‰åŒä¸€æŠŠé”ï¼Œå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><ol><li><strong>åˆ†æ®µé”</strong>ï¼šå°†èµ„æºåˆ†æ®µï¼Œå‡å°‘é”ç«äº‰</li><li><strong>é˜Ÿåˆ—é”</strong>ï¼šä½¿ç”¨Listå®ç°å…¬å¹³é”</li><li><strong>è‡ªæ—‹é”ä¼˜åŒ–</strong>ï¼šé€‚å½“çš„é€€é¿ç®—æ³•</li></ol><h2 id="æ‚²è§‚é”ä¸ä¹è§‚é”"><a href="#æ‚²è§‚é”ä¸ä¹è§‚é”" class="headerlink" title="æ‚²è§‚é”ä¸ä¹è§‚é”"></a>æ‚²è§‚é”ä¸ä¹è§‚é”</h2><h3 id="æ‚²è§‚é”"><a href="#æ‚²è§‚é”" class="headerlink" title="æ‚²è§‚é”"></a>æ‚²è§‚é”</h3><p>å‡è®¾ä¼šå‘ç”Ÿå¹¶å‘å†²çªï¼Œåœ¨æ“ä½œæ•°æ®å‰å…ˆè·å–é”ã€‚</p><p><strong>Rediså®ç°</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨Redisåˆ†å¸ƒå¼é”å®ç°æ‚²è§‚é”</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateWithPessimisticLock</span><span class="params">(String userId, <span class="type">int</span> amount)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">lockKey</span> <span class="operator">=</span> <span class="string">&quot;lock:account:&quot;</span> + userId;</span><br><span class="line">    <span class="type">String</span> <span class="variable">requestId</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (tryLock(lockKey, requestId, <span class="number">30000</span>)) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// æŸ¥è¯¢è´¦æˆ·ä½™é¢</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">balance</span> <span class="operator">=</span> getBalance(userId);</span><br><span class="line">            <span class="keyword">if</span> (balance &gt;= amount) &#123;</span><br><span class="line">                <span class="comment">// æ‰£å‡ä½™é¢</span></span><br><span class="line">                updateBalance(userId, balance - amount);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InsufficientBalanceException</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            releaseLock(lockKey, requestId);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LockAcquisitionException</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¹è§‚é”"><a href="#ä¹è§‚é”" class="headerlink" title="ä¹è§‚é”"></a>ä¹è§‚é”</h3><p>å‡è®¾ä¸ä¼šå‘ç”Ÿå†²çªï¼Œåœ¨æ›´æ–°æ—¶æ£€æŸ¥æ•°æ®æ˜¯å¦è¢«ä¿®æ”¹ã€‚</p><p><strong>åŸºäºç‰ˆæœ¬å·çš„ä¹è§‚é”</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">updateWithOptimisticLock</span><span class="params">(String userId, <span class="type">int</span> amount, <span class="type">int</span> expectedVersion)</span> &#123;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨Luaè„šæœ¬ä¿è¯åŸå­æ€§</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">script</span> <span class="operator">=</span> </span><br><span class="line">        <span class="string">&quot;local current = redis.call(&#x27;hmget&#x27;, KEYS[1], &#x27;balance&#x27;, &#x27;version&#x27;) &quot;</span> +</span><br><span class="line">        <span class="string">&quot;if current[2] == ARGV[2] then &quot;</span> +</span><br><span class="line">        <span class="string">&quot;  if tonumber(current[1]) &gt;= tonumber(ARGV[1]) then &quot;</span> +</span><br><span class="line">        <span class="string">&quot;    redis.call(&#x27;hmset&#x27;, KEYS[1], &#x27;balance&#x27;, current[1] - ARGV[1], &#x27;version&#x27;, current[2] + 1) &quot;</span> +</span><br><span class="line">        <span class="string">&quot;    return 1 &quot;</span> +</span><br><span class="line">        <span class="string">&quot;  else &quot;</span> +</span><br><span class="line">        <span class="string">&quot;    return -1 &quot;</span> +  <span class="comment">// ä½™é¢ä¸è¶³</span></span><br><span class="line">        <span class="string">&quot;  end &quot;</span> +</span><br><span class="line">        <span class="string">&quot;else &quot;</span> +</span><br><span class="line">        <span class="string">&quot;  return 0 &quot;</span> +     <span class="comment">// ç‰ˆæœ¬å·ä¸åŒ¹é…</span></span><br><span class="line">        <span class="string">&quot;end&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;account:&quot;</span> + userId;</span><br><span class="line">    <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> jedis.eval(script, Arrays.asList(key), </span><br><span class="line">                              Arrays.asList(String.valueOf(amount), String.valueOf(expectedVersion)));</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> <span class="variable">code</span> <span class="operator">=</span> ((Long) result).intValue();</span><br><span class="line">    <span class="keyword">if</span> (code == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;  <span class="comment">// æ›´æ–°æˆåŠŸ</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (code == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OptimisticLockException</span>(<span class="string">&quot;æ•°æ®å·²è¢«ä¿®æ”¹&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InsufficientBalanceException</span>(<span class="string">&quot;ä½™é¢ä¸è¶³&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åŸºäºCASçš„ä¹è§‚é”</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateWithCAS</span><span class="params">(String key, Function&lt;String, String&gt; updater)</span> &#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="comment">// 1. è·å–å½“å‰å€¼</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">currentValue</span> <span class="operator">=</span> redis.get(key);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. è®¡ç®—æ–°å€¼</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">newValue</span> <span class="operator">=</span> updater.apply(currentValue);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. CASæ›´æ–°</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">script</span> <span class="operator">=</span> <span class="string">&quot;if redis.call(&#x27;get&#x27;, KEYS[1]) == ARGV[1] then &quot;</span> +</span><br><span class="line">                       <span class="string">&quot;return redis.call(&#x27;set&#x27;, KEYS[1], ARGV[2]) else return nil end&quot;</span>;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> redis.eval(script, Arrays.asList(key), </span><br><span class="line">                                  Arrays.asList(currentValue, newValue));</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (result != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">break</span>;  <span class="comment">// æ›´æ–°æˆåŠŸ</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ›´æ–°å¤±è´¥ï¼Œé‡è¯•</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ‚²è§‚é”-vs-ä¹è§‚é”é€‰æ‹©"><a href="#æ‚²è§‚é”-vs-ä¹è§‚é”é€‰æ‹©" class="headerlink" title="æ‚²è§‚é” vs ä¹è§‚é”é€‰æ‹©"></a>æ‚²è§‚é” vs ä¹è§‚é”é€‰æ‹©</h3><p><strong>æ‚²è§‚é”é€‚ç”¨åœºæ™¯</strong>ï¼š</p><ul><li>å†™æ“ä½œé¢‘ç¹ï¼Œå†²çªæ¦‚ç‡é«˜</li><li>ä¸šåŠ¡é€»è¾‘å¤æ‚ï¼Œé‡è¯•æˆæœ¬é«˜</li><li>å¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚ä¸¥æ ¼</li></ul><p><strong>ä¹è§‚é”é€‚ç”¨åœºæ™¯</strong>ï¼š</p><ul><li>è¯»å¤šå†™å°‘ï¼Œå†²çªæ¦‚ç‡ä½</li><li>ä¸šåŠ¡é€»è¾‘ç®€å•ï¼Œé‡è¯•æˆæœ¬ä½</li><li>å¯¹æ€§èƒ½è¦æ±‚é«˜</li></ul><h2 id="é«˜å¯ç”¨æ¶æ„"><a href="#é«˜å¯ç”¨æ¶æ„" class="headerlink" title="é«˜å¯ç”¨æ¶æ„"></a>é«˜å¯ç”¨æ¶æ„</h2><h3 id="ä¸»ä»å¤åˆ¶"><a href="#ä¸»ä»å¤åˆ¶" class="headerlink" title="ä¸»ä»å¤åˆ¶"></a>ä¸»ä»å¤åˆ¶</h3><p>Masterè´Ÿè´£å†™æ“ä½œï¼ŒSlaveè´Ÿè´£è¯»æ“ä½œï¼Œé€šè¿‡å¤åˆ¶å®ç°æ•°æ®åŒæ­¥ã€‚</p><p><strong>å¤åˆ¶åŸç†</strong>ï¼š</p><ol><li>Slaveå‘Masterå‘é€PSYNCå‘½ä»¤</li><li>Masteræ‰§è¡ŒBGSAVEç”ŸæˆRDBæ–‡ä»¶</li><li>Masterå°†RDBæ–‡ä»¶å‘é€ç»™Slave</li><li>Slaveè½½å…¥RDBæ–‡ä»¶</li><li>Masterå°†ç¼“å†²åŒºçš„å†™å‘½ä»¤å‘é€ç»™Slave</li><li>åç»­å†™å‘½ä»¤å®æ—¶åŒæ­¥</li></ol><p><strong>éƒ¨åˆ†é‡åŒæ­¥</strong>ï¼š ç½‘ç»œæ–­è¿åï¼ŒSlaveåªéœ€è¦åŒæ­¥æ–­è¿æœŸé—´çš„å‘½ä»¤ï¼Œè€Œä¸æ˜¯å®Œæ•´é‡åŒæ­¥ã€‚</p><h3 id="å“¨å…µæ¨¡å¼ï¼ˆSentinelï¼‰"><a href="#å“¨å…µæ¨¡å¼ï¼ˆSentinelï¼‰" class="headerlink" title="å“¨å…µæ¨¡å¼ï¼ˆSentinelï¼‰"></a>å“¨å…µæ¨¡å¼ï¼ˆSentinelï¼‰</h3><p>å“¨å…µè´Ÿè´£ç›‘æ§MasterçŠ¶æ€ï¼Œåœ¨Masteræ•…éšœæ—¶è‡ªåŠ¨è¿›è¡Œæ•…éšœè½¬ç§»ã€‚</p><p><strong>å“¨å…µèŒè´£</strong>ï¼š</p><ul><li>ç›‘æ§ï¼šå®šæœŸping Masterå’ŒSlave</li><li>é€šçŸ¥ï¼šæ•…éšœæ—¶é€šçŸ¥ç®¡ç†å‘˜å’Œå®¢æˆ·ç«¯</li><li>æ•…éšœè½¬ç§»ï¼šè‡ªåŠ¨å°†Slaveæå‡ä¸ºæ–°Master</li><li>é…ç½®ç®¡ç†ï¼šä¸ºå®¢æˆ·ç«¯æä¾›æœåŠ¡å‘ç°</li></ul><p><strong>æ•…éšœè½¬ç§»æµç¨‹</strong>ï¼š</p><ol><li>å“¨å…µå‘ç°Masterä¸‹çº¿ï¼ˆä¸»è§‚ä¸‹çº¿ï¼‰</li><li>å¤šä¸ªå“¨å…µç¡®è®¤Masterä¸‹çº¿ï¼ˆå®¢è§‚ä¸‹çº¿ï¼‰</li><li>é€‰ä¸¾é¢†å¯¼å“¨å…µæ‰§è¡Œæ•…éšœè½¬ç§»</li><li>é€‰æ‹©åˆé€‚çš„Slaveä½œä¸ºæ–°Master</li><li>ä¿®æ”¹å…¶ä»–Slaveçš„é…ç½®æŒ‡å‘æ–°Master</li><li>é€šçŸ¥å®¢æˆ·ç«¯Masteråœ°å€å˜æ›´</li></ol><h3 id="é›†ç¾¤æ¨¡å¼ï¼ˆClusterï¼‰"><a href="#é›†ç¾¤æ¨¡å¼ï¼ˆClusterï¼‰" class="headerlink" title="é›†ç¾¤æ¨¡å¼ï¼ˆClusterï¼‰"></a>é›†ç¾¤æ¨¡å¼ï¼ˆClusterï¼‰</h3><p>Redis Clusteré€šè¿‡åˆ†ç‰‡å®ç°æ¨ªå‘æ‰©å±•å’Œé«˜å¯ç”¨ã€‚</p><p><strong>åˆ†ç‰‡ç®—æ³•</strong>ï¼š ä½¿ç”¨CRC16ç®—æ³•è®¡ç®—keyçš„å“ˆå¸Œå€¼ï¼Œç„¶åå¯¹16384å–æ¨¡å¾—åˆ°æ§½ä½å·ã€‚</p><p><strong>èŠ‚ç‚¹é€šä¿¡</strong>ï¼š ä½¿ç”¨Gossipåè®®åœ¨èŠ‚ç‚¹é—´äº¤æ¢çŠ¶æ€ä¿¡æ¯ï¼ŒåŒ…æ‹¬èŠ‚ç‚¹ä¸Šçº¿&#x2F;ä¸‹çº¿ã€æ§½ä½åˆ†é…ç­‰ã€‚</p><p><strong>æ•…éšœè½¬ç§»</strong>ï¼š å½“MasterèŠ‚ç‚¹æ•…éšœæ—¶ï¼Œå…¶Slaveè‡ªåŠ¨æå‡ä¸ºæ–°Masterï¼Œè¿‡ç¨‹å¯¹å®¢æˆ·ç«¯é€æ˜ã€‚</p><p><strong>æ•°æ®è¿ç§»</strong>ï¼š é›†ç¾¤æ‰©å®¹æ—¶ï¼Œéœ€è¦å°†éƒ¨åˆ†æ§½ä½ä»ç°æœ‰èŠ‚ç‚¹è¿ç§»åˆ°æ–°èŠ‚ç‚¹ã€‚</p><h4 id="Redis-å“ˆå¸Œæ§½ï¼ˆHash-Slotï¼‰è¯¦è§£"><a href="#Redis-å“ˆå¸Œæ§½ï¼ˆHash-Slotï¼‰è¯¦è§£" class="headerlink" title="Redis å“ˆå¸Œæ§½ï¼ˆHash Slotï¼‰è¯¦è§£"></a>Redis å“ˆå¸Œæ§½ï¼ˆHash Slotï¼‰è¯¦è§£</h4><p>åœ¨ Redis Cluster ä¸­ï¼Œæ•°æ®ä¸æ˜¯å­˜å‚¨åœ¨å•ä¸ªèŠ‚ç‚¹ä¸Šï¼Œè€Œæ˜¯è¢«åˆ†æ•£å­˜å‚¨åœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šã€‚ä¸ºäº†å®ç°è¿™ç§åˆ†æ•£å­˜å‚¨ï¼ŒRedis å¼•å…¥äº† <strong>å“ˆå¸Œæ§½ï¼ˆhash slotï¼‰</strong> çš„æ¦‚å¿µã€‚</p><h4 id="1-ä»€ä¹ˆæ˜¯å“ˆå¸Œæ§½ï¼Ÿ"><a href="#1-ä»€ä¹ˆæ˜¯å“ˆå¸Œæ§½ï¼Ÿ" class="headerlink" title="1. ä»€ä¹ˆæ˜¯å“ˆå¸Œæ§½ï¼Ÿ"></a>1. ä»€ä¹ˆæ˜¯å“ˆå¸Œæ§½ï¼Ÿ</h4><p>Redis Cluster ä¸€å…±æœ‰ <strong>16384 ä¸ªå“ˆå¸Œæ§½ï¼ˆslotï¼‰</strong>ï¼Œç¼–å·ä» 0 åˆ° 16383ã€‚é›†ç¾¤ä¸­çš„æ¯ä¸ªé”®ï¼ˆkeyï¼‰éƒ½ä¼šé€šè¿‡ä¸€ä¸ªå›ºå®šçš„ç®—æ³•æ˜ å°„åˆ°è¿™ 16384 ä¸ªå“ˆå¸Œæ§½ä¸­çš„ä¸€ä¸ªï¼Œç„¶åè¿™äº›å“ˆå¸Œæ§½ä¼šè¢«åˆ†é…ç»™é›†ç¾¤ä¸­çš„ä¸åŒèŠ‚ç‚¹ã€‚</p><h4 id="2-é”®å¦‚ä½•æ˜ å°„åˆ°å“ˆå¸Œæ§½ï¼Ÿ"><a href="#2-é”®å¦‚ä½•æ˜ å°„åˆ°å“ˆå¸Œæ§½ï¼Ÿ" class="headerlink" title="2. é”®å¦‚ä½•æ˜ å°„åˆ°å“ˆå¸Œæ§½ï¼Ÿ"></a>2. é”®å¦‚ä½•æ˜ å°„åˆ°å“ˆå¸Œæ§½ï¼Ÿ</h4><p>Redis ä½¿ç”¨ä¸€ä¸ªç®€å•çš„ç®—æ³•æ¥å†³å®šä¸€ä¸ªé”®å±äºå“ªä¸ªå“ˆå¸Œæ§½ï¼š<br>$$<br>slot&#x3D;CRC16(key)(mod16384)<br>$$</p><ul><li><strong>CRC16(key)</strong>ï¼šå¯¹é”®åæ‰§è¡Œ CRC16 æ ¡éªŒå’Œè®¡ç®—ã€‚</li><li><strong>mod 16384</strong>ï¼šå°† CRC16 æ ¡éªŒå’Œçš„ç»“æœå¯¹ 16384 å–æ¨¡ï¼Œå¾—åˆ°çš„ç»“æœå°±æ˜¯è¿™ä¸ªé”®æ‰€å±çš„å“ˆå¸Œæ§½ç¼–å·ã€‚</li></ul><p>ä¾‹å¦‚ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ªé”® <code>mykey</code>ï¼ŒRedis ä¼šè®¡ç®— <code>CRC16(&#39;mykey&#39;) % 16384</code>ï¼Œå¾—åˆ°ä¸€ä¸ª 0 åˆ° 16383 ä¹‹é—´çš„æ•°å­—ã€‚</p><h4 id="3-å“ˆå¸Œæ§½å¦‚ä½•åˆ†é…ç»™èŠ‚ç‚¹ï¼Ÿ"><a href="#3-å“ˆå¸Œæ§½å¦‚ä½•åˆ†é…ç»™èŠ‚ç‚¹ï¼Ÿ" class="headerlink" title="3. å“ˆå¸Œæ§½å¦‚ä½•åˆ†é…ç»™èŠ‚ç‚¹ï¼Ÿ"></a>3. å“ˆå¸Œæ§½å¦‚ä½•åˆ†é…ç»™èŠ‚ç‚¹ï¼Ÿ</h4><p>é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£ç®¡ç†ä¸€éƒ¨åˆ†å“ˆå¸Œæ§½ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªä¸‰èŠ‚ç‚¹çš„é›†ç¾¤å¯ä»¥è¿™æ ·åˆ†é…å“ˆå¸Œæ§½ï¼š</p><ul><li><strong>èŠ‚ç‚¹ A</strong>ï¼šè´Ÿè´£å“ˆå¸Œæ§½ 0 åˆ° 5460ã€‚</li><li><strong>èŠ‚ç‚¹ B</strong>ï¼šè´Ÿè´£å“ˆå¸Œæ§½ 5461 åˆ° 10922ã€‚</li><li><strong>èŠ‚ç‚¹ C</strong>ï¼šè´Ÿè´£å“ˆå¸Œæ§½ 10923 åˆ° 16383ã€‚</li></ul><p>å½“ä¸€ä¸ªå®¢æˆ·ç«¯éœ€è¦æ“ä½œä¸€ä¸ªé”®æ—¶ï¼Œå®ƒä¼šé¦–å…ˆè®¡ç®—è¿™ä¸ªé”®æ‰€å±çš„å“ˆå¸Œæ§½ï¼Œç„¶åæ ¹æ®å“ˆå¸Œæ§½ä¸èŠ‚ç‚¹çš„æ˜ å°„å…³ç³»ï¼Œæ‰¾åˆ°è´Ÿè´£è¯¥å“ˆå¸Œæ§½çš„èŠ‚ç‚¹ï¼Œå¹¶å‘å…¶å‘é€è¯·æ±‚ã€‚</p><p>å¦‚æœå®¢æˆ·ç«¯è¯·æ±‚çš„é”®ä¸åœ¨å½“å‰è¿æ¥çš„èŠ‚ç‚¹ä¸Šï¼Œè¿™ä¸ªèŠ‚ç‚¹ä¼šè¿”å›ä¸€ä¸ª <code>MOVED</code> é‡å®šå‘é”™è¯¯ï¼Œå‘Šè¯‰å®¢æˆ·ç«¯æ­£ç¡®çš„èŠ‚ç‚¹åœ°å€ï¼Œå®¢æˆ·ç«¯ä¼šæ ¹æ®è¿™ä¸ªåœ°å€é‡æ–°å‘èµ·è¯·æ±‚ã€‚</p><h4 id="4-å“ˆå¸Œæ§½çš„ä¼˜åŠ¿"><a href="#4-å“ˆå¸Œæ§½çš„ä¼˜åŠ¿" class="headerlink" title="4. å“ˆå¸Œæ§½çš„ä¼˜åŠ¿"></a>4. å“ˆå¸Œæ§½çš„ä¼˜åŠ¿</h4><ul><li><strong>é«˜å¯ç”¨æ€§</strong>ï¼šå½“ä¸€ä¸ªèŠ‚ç‚¹å¤±æ•ˆæ—¶ï¼Œå®ƒæ‰€è´Ÿè´£çš„å“ˆå¸Œæ§½å¯ä»¥è¢«å…¶ä»–èŠ‚ç‚¹æ¥ç®¡ï¼Œä»è€Œä¿è¯æ•°æ®çš„å¯ç”¨æ€§ã€‚</li><li><strong>å¼¹æ€§ä¼¸ç¼©</strong>ï¼š<ul><li><strong>æ·»åŠ èŠ‚ç‚¹</strong>ï¼šå½“éœ€è¦æ‰©å±•é›†ç¾¤æ—¶ï¼Œå¯ä»¥æ·»åŠ æ–°èŠ‚ç‚¹ï¼Œå¹¶ä»ç°æœ‰èŠ‚ç‚¹ä¸Šè¿ç§»ä¸€éƒ¨åˆ†å“ˆå¸Œæ§½åˆ°æ–°èŠ‚ç‚¹ä¸Šï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯å¢é‡çš„ï¼Œä¸éœ€è¦åœæœºã€‚</li><li><strong>ç§»é™¤èŠ‚ç‚¹</strong>ï¼šå½“éœ€è¦ç¼©å‡é›†ç¾¤æ—¶ï¼Œå¯ä»¥å°†æŸä¸ªèŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰å“ˆå¸Œæ§½è¿ç§»åˆ°å…¶ä»–èŠ‚ç‚¹ï¼Œç„¶åç§»é™¤è¯¥èŠ‚ç‚¹ã€‚</li></ul></li></ul><h2 id="æ€§èƒ½ç›‘æ§ä¸ä¼˜åŒ–"><a href="#æ€§èƒ½ç›‘æ§ä¸ä¼˜åŒ–" class="headerlink" title="æ€§èƒ½ç›‘æ§ä¸ä¼˜åŒ–"></a>æ€§èƒ½ç›‘æ§ä¸ä¼˜åŒ–</h2><h3 id="æ…¢æŸ¥è¯¢æ—¥å¿—"><a href="#æ…¢æŸ¥è¯¢æ—¥å¿—" class="headerlink" title="æ…¢æŸ¥è¯¢æ—¥å¿—"></a>æ…¢æŸ¥è¯¢æ—¥å¿—</h3><p>Redisæä¾›æ…¢æŸ¥è¯¢æ—¥å¿—åŠŸèƒ½ï¼Œè®°å½•æ‰§è¡Œæ—¶é—´è¶…è¿‡é˜ˆå€¼çš„å‘½ä»¤ã€‚</p><p><strong>é…ç½®å‚æ•°</strong>ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">slowlog-log-slower-than</span> <span class="number">10000</span>  <span class="comment"># è¶…è¿‡10æ¯«ç§’è®°å½•</span></span><br><span class="line"><span class="string">slowlog-max-len</span> <span class="number">128</span>           <span class="comment"># æœ€å¤šä¿å­˜128æ¡è®°å½•</span></span><br></pre></td></tr></table></figure><p><strong>æŸ¥çœ‹æ…¢æŸ¥è¯¢</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SLOWLOG GET 10  <span class="comment"># è·å–æœ€è¿‘10æ¡æ…¢æŸ¥è¯¢</span></span><br></pre></td></tr></table></figure><h3 id="å†…å­˜åˆ†æ"><a href="#å†…å­˜åˆ†æ" class="headerlink" title="å†…å­˜åˆ†æ"></a>å†…å­˜åˆ†æ</h3><p>ä½¿ç”¨MEMORYå‘½ä»¤åˆ†æå†…å­˜ä½¿ç”¨æƒ…å†µã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MEMORY USAGE key         <span class="comment"># æŸ¥çœ‹keyå ç”¨å†…å­˜</span></span><br><span class="line">MEMORY STATS            <span class="comment"># æŸ¥çœ‹å†…å­˜ç»Ÿè®¡ä¿¡æ¯</span></span><br><span class="line">MEMORY DOCTOR           <span class="comment"># å†…å­˜ä½¿ç”¨å»ºè®®</span></span><br></pre></td></tr></table></figure><h3 id="æ€§èƒ½ä¼˜åŒ–å»ºè®®"><a href="#æ€§èƒ½ä¼˜åŒ–å»ºè®®" class="headerlink" title="æ€§èƒ½ä¼˜åŒ–å»ºè®®"></a>æ€§èƒ½ä¼˜åŒ–å»ºè®®</h3><p><strong>é¿å…å¤§key</strong>ï¼š</p><ul><li>å•ä¸ªkeyçš„valueä¸è¦è¶…è¿‡10KB</li><li>é›†åˆç±»å‹å…ƒç´ æ•°é‡æ§åˆ¶åœ¨åˆç†èŒƒå›´</li><li>ä½¿ç”¨SCANä»£æ›¿KEYSå‘½ä»¤</li></ul><p><strong>åˆç†ä½¿ç”¨æ•°æ®ç»“æ„</strong>ï¼š</p><ul><li>å°å¯¹è±¡ä½¿ç”¨Hashè€Œä¸æ˜¯å¤šä¸ªString</li><li>åˆç†è®¾ç½®ziplistç­‰å‹ç¼©ç»“æ„çš„é˜ˆå€¼</li><li>ä½¿ç”¨ä½å›¾(bitmap)å­˜å‚¨å¸ƒå°”ç±»å‹å¤§æ•°æ®é›†</li></ul><p><strong>ç½‘ç»œä¼˜åŒ–</strong>ï¼š</p><ul><li>ä½¿ç”¨Pipelineæ‰¹é‡æ“ä½œ</li><li>åˆç†è®¾ç½®å®¢æˆ·ç«¯è¿æ¥æ± </li><li>å¯ç”¨TCP_NODELAYé€‰é¡¹</li></ul><p><strong>æŒä¹…åŒ–ä¼˜åŒ–</strong>ï¼š</p><ul><li>æ ¹æ®ä¸šåŠ¡éœ€æ±‚é€‰æ‹©RDBæˆ–AOF</li><li>åˆç†é…ç½®è‡ªåŠ¨ä¿å­˜æ¡ä»¶</li><li>åœ¨ä»èŠ‚ç‚¹ä¸Šè¿›è¡ŒæŒä¹…åŒ–æ“ä½œ</li></ul><p>è¿™äº›è¯¦ç»†çš„æŠ€æœ¯ç‚¹æ¶µç›–äº†Redisçš„æ ¸å¿ƒæ¦‚å¿µã€å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆå’Œå®é™…åº”ç”¨åœºæ™¯ï¼Œæ˜¯RedisæŠ€æœ¯é¢è¯•çš„é‡è¦è€ƒæŸ¥å†…å®¹ã€‚æŒæ¡è¿™äº›çŸ¥è¯†ç‚¹å¹¶èƒ½ç»“åˆå®é™…é¡¹ç›®ç»éªŒè¿›è¡Œè¯´æ˜ï¼Œå°†å¤§å¤§æé«˜é¢è¯•é€šè¿‡ç‡ã€‚</p><h2 id="å†…å­˜ç®¡ç†ä¸æ·˜æ±°æœºåˆ¶"><a href="#å†…å­˜ç®¡ç†ä¸æ·˜æ±°æœºåˆ¶" class="headerlink" title="å†…å­˜ç®¡ç†ä¸æ·˜æ±°æœºåˆ¶"></a>å†…å­˜ç®¡ç†ä¸æ·˜æ±°æœºåˆ¶</h2><h3 id="å†…å­˜æ·˜æ±°ç­–ç•¥è¯¦è§£"><a href="#å†…å­˜æ·˜æ±°ç­–ç•¥è¯¦è§£" class="headerlink" title="å†…å­˜æ·˜æ±°ç­–ç•¥è¯¦è§£"></a>å†…å­˜æ·˜æ±°ç­–ç•¥è¯¦è§£</h3><p>å½“Rediså†…å­˜ä½¿ç”¨è¾¾åˆ°maxmemoryé™åˆ¶æ—¶ï¼Œä¼šæ ¹æ®é…ç½®çš„ç­–ç•¥æ·˜æ±°æ•°æ®ã€‚</p><p><strong>8ç§æ·˜æ±°ç­–ç•¥</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é’ˆå¯¹æ‰€æœ‰key</span></span><br><span class="line">noeviction          <span class="comment"># ä¸æ·˜æ±°ï¼Œå†™å…¥è¿”å›é”™è¯¯</span></span><br><span class="line">allkeys-lru         <span class="comment"># æ‰€æœ‰keyä¸­æ·˜æ±°æœ€è¿‘æœ€å°‘ä½¿ç”¨</span></span><br><span class="line">allkeys-lfu         <span class="comment"># æ‰€æœ‰keyä¸­æ·˜æ±°æœ€å°‘é¢‘ç‡ä½¿ç”¨</span></span><br><span class="line">allkeys-random      <span class="comment"># æ‰€æœ‰keyä¸­éšæœºæ·˜æ±°</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é’ˆå¯¹è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„key</span></span><br><span class="line">volatile-lru        <span class="comment"># è¿‡æœŸkeyä¸­æ·˜æ±°æœ€è¿‘æœ€å°‘ä½¿ç”¨</span></span><br><span class="line">volatile-lfu        <span class="comment"># è¿‡æœŸkeyä¸­æ·˜æ±°æœ€å°‘é¢‘ç‡ä½¿ç”¨</span></span><br><span class="line">volatile-random     <span class="comment"># è¿‡æœŸkeyä¸­éšæœºæ·˜æ±°</span></span><br><span class="line">volatile-ttl        <span class="comment"># è¿‡æœŸkeyä¸­æ·˜æ±°å³å°†è¿‡æœŸçš„</span></span><br></pre></td></tr></table></figure><p><strong>LRU vs LFU å®ç°ç»†èŠ‚</strong>ï¼š Redisçš„LRUå¹¶éä¸¥æ ¼çš„LRUï¼Œè€Œæ˜¯è¿‘ä¼¼LRUç®—æ³•ï¼š</p><ul><li>æ¯ä¸ªkeyéƒ½æœ‰24ä½çš„æ—¶é’Ÿå­—æ®µè®°å½•è®¿é—®æ—¶é—´</li><li>æ·˜æ±°æ—¶éšæœºé‡‡æ ·5ä¸ªkeyï¼ˆå¯é…ç½®ï¼‰ï¼Œé€‰æ‹©æ—¶é’Ÿå€¼æœ€å°çš„</li></ul><p>LFUç®—æ³•ç»´æŠ¤è®¿é—®é¢‘ç‡ï¼š</p><ul><li>é«˜16ä½å­˜å‚¨ä¸Šæ¬¡è®¿é—®æ—¶é—´</li><li>ä½8ä½å­˜å‚¨è®¿é—®é¢‘ç‡è®¡æ•°å™¨</li><li>è®¡æ•°å™¨é‡‡ç”¨æ¦‚ç‡æ€§é€’å¢ï¼Œé¿å…é¢‘ç‡æ— é™å¢é•¿</li></ul><h3 id="å†…å­˜ç¢ç‰‡é—®é¢˜"><a href="#å†…å­˜ç¢ç‰‡é—®é¢˜" class="headerlink" title="å†…å­˜ç¢ç‰‡é—®é¢˜"></a>å†…å­˜ç¢ç‰‡é—®é¢˜</h3><p><strong>äº§ç”ŸåŸå› </strong>ï¼š</p><ul><li>é¢‘ç¹çš„æ•°æ®æ›´æ–°å¯¼è‡´å†…å­˜åˆ†é…&#x2F;é‡Šæ”¾</li><li>Redisä½¿ç”¨jemallocå†…å­˜åˆ†é…å™¨ï¼Œå­˜åœ¨å†…å­˜å¯¹é½</li><li>åˆ é™¤å¤§keyåç•™ä¸‹å†…å­˜ç©ºæ´</li></ul><p><strong>æ£€æµ‹æ–¹æ³•</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">INFO memory</span><br><span class="line"><span class="comment"># å…³æ³¨ mem_fragmentation_ratio æŒ‡æ ‡</span></span><br><span class="line"><span class="comment"># æ¯”å€¼ &gt; 1.5 è¡¨ç¤ºç¢ç‰‡è¾ƒå¤š</span></span><br><span class="line"><span class="comment"># æ¯”å€¼ &lt; 1 è¡¨ç¤ºä½¿ç”¨äº†swapï¼Œæ€§èƒ½ä¸¥é‡ä¸‹é™</span></span><br></pre></td></tr></table></figure><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><ol><li><strong>å†…å­˜æ•´ç†</strong>ï¼ˆRedis 4.0+ï¼‰ï¼š</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CONFIG SET activedefrag <span class="built_in">yes</span>        <span class="comment"># å¼€å¯è‡ªåŠ¨æ•´ç†</span></span><br><span class="line">CONFIG SET active-defrag-threshold-lower 10  <span class="comment"># ç¢ç‰‡ç‡è¶…è¿‡10%å¯åŠ¨</span></span><br><span class="line">MEMORY PURGE                       <span class="comment"># æ‰‹åŠ¨è§¦å‘æ•´ç†</span></span><br></pre></td></tr></table></figure><ol><li><strong>é‡å¯Redis</strong>ï¼šæœ€å½»åº•ä½†å½±å“æœåŠ¡å¯ç”¨æ€§</li><li><strong>ä¼˜åŒ–æ•°æ®ç»“æ„</strong>ï¼šå‡å°‘å°å¯¹è±¡ï¼Œä½¿ç”¨Hashå­˜å‚¨ç›¸å…³æ•°æ®</li></ol><h2 id="è¿‡æœŸç­–ç•¥ä¸åˆ é™¤æœºåˆ¶"><a href="#è¿‡æœŸç­–ç•¥ä¸åˆ é™¤æœºåˆ¶" class="headerlink" title="è¿‡æœŸç­–ç•¥ä¸åˆ é™¤æœºåˆ¶"></a>è¿‡æœŸç­–ç•¥ä¸åˆ é™¤æœºåˆ¶</h2><h3 id="ä¸‰ç§è¿‡æœŸåˆ é™¤ç­–ç•¥"><a href="#ä¸‰ç§è¿‡æœŸåˆ é™¤ç­–ç•¥" class="headerlink" title="ä¸‰ç§è¿‡æœŸåˆ é™¤ç­–ç•¥"></a>ä¸‰ç§è¿‡æœŸåˆ é™¤ç­–ç•¥</h3><p><strong>å®šæ—¶åˆ é™¤</strong>ï¼šè®¾ç½®è¿‡æœŸæ—¶é—´æ—¶åˆ›å»ºå®šæ—¶å™¨ï¼Œåˆ°æœŸç«‹å³åˆ é™¤</p><ul><li>ä¼˜ç‚¹ï¼šåŠæ—¶é‡Šæ”¾å†…å­˜</li><li>ç¼ºç‚¹ï¼šæ¶ˆè€—CPUèµ„æºåˆ›å»ºå’Œç®¡ç†å®šæ—¶å™¨</li></ul><p><strong>æƒ°æ€§åˆ é™¤</strong>ï¼šè®¿é—®keyæ—¶æ£€æŸ¥æ˜¯å¦è¿‡æœŸï¼Œè¿‡æœŸåˆ™åˆ é™¤</p><ul><li>ä¼˜ç‚¹ï¼šCPUå‹å¥½ï¼Œåªåœ¨å¿…è¦æ—¶åˆ é™¤</li><li>ç¼ºç‚¹ï¼šå†…å­˜ä¸å‹å¥½ï¼Œè¿‡æœŸkeyå¯èƒ½é•¿æœŸå ç”¨å†…å­˜</li></ul><p><strong>å®šæœŸåˆ é™¤</strong>ï¼šå®šæœŸéšæœºæ£€æŸ¥éƒ¨åˆ†keyï¼Œåˆ é™¤è¿‡æœŸçš„</p><ul><li>Redisçš„å®é™…ç­–ç•¥ï¼Œå¹³è¡¡CPUå’Œå†…å­˜ä½¿ç”¨</li></ul><h3 id="Redisè¿‡æœŸåˆ é™¤å®ç°"><a href="#Redisè¿‡æœŸåˆ é™¤å®ç°" class="headerlink" title="Redisè¿‡æœŸåˆ é™¤å®ç°"></a>Redisè¿‡æœŸåˆ é™¤å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç®€åŒ–çš„è¿‡æœŸåˆ é™¤é€»è¾‘</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">activeExpireCycle</span><span class="params">(<span class="type">int</span> type)</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">int</span> <span class="variable">current_db</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">int</span> <span class="variable">timelimit_exit</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; server.dbnum; i++) &#123;</span><br><span class="line">        redisDb *db = server.db + current_db % server.dbnum;</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span> <span class="variable">iteration</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (iteration &lt; <span class="number">20</span>) &#123;  <span class="comment">// æœ€å¤šæ£€æŸ¥20ä¸ªkey</span></span><br><span class="line">            <span class="type">long</span> <span class="variable">sampled</span> <span class="operator">=</span> <span class="number">0</span>, expired = <span class="number">0</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// éšæœºé€‰æ‹©keyæ£€æŸ¥è¿‡æœŸ</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">                dictEntry *de = dictGetRandomKey(db-&gt;expires);</span><br><span class="line">                <span class="keyword">if</span> (de == NULL) <span class="keyword">break</span>;</span><br><span class="line">                </span><br><span class="line">                sampled++;</span><br><span class="line">                <span class="keyword">if</span> (keyIsExpired(db, de)) &#123;</span><br><span class="line">                    deleteExpiredKey(db, de);</span><br><span class="line">                    expired++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// å¦‚æœè¿‡æœŸæ¯”ä¾‹è¶…è¿‡25%ï¼Œç»§ç»­ä¸‹è½®æ£€æŸ¥</span></span><br><span class="line">            <span class="keyword">if</span> (expired &gt; <span class="number">5</span>) iteration++;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        current_db++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ•°æ®ç»“æ„åº•å±‚å®ç°æ·±åº¦è§£æ"><a href="#æ•°æ®ç»“æ„åº•å±‚å®ç°æ·±åº¦è§£æ" class="headerlink" title="æ•°æ®ç»“æ„åº•å±‚å®ç°æ·±åº¦è§£æ"></a>æ•°æ®ç»“æ„åº•å±‚å®ç°æ·±åº¦è§£æ</h2><h3 id="å‹ç¼©åˆ—è¡¨ï¼ˆZipListï¼‰æ¼”è¿›"><a href="#å‹ç¼©åˆ—è¡¨ï¼ˆZipListï¼‰æ¼”è¿›" class="headerlink" title="å‹ç¼©åˆ—è¡¨ï¼ˆZipListï¼‰æ¼”è¿›"></a>å‹ç¼©åˆ—è¡¨ï¼ˆZipListï¼‰æ¼”è¿›</h3><p>Redis 7.0ç”¨ListPackæ›¿ä»£äº†ZipListï¼Œè§£å†³äº†çº§è”æ›´æ–°é—®é¢˜ã€‚</p><p><strong>ZipListé—®é¢˜</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ZipListç»“æ„å¯¼è‡´çš„çº§è”æ›´æ–°</span></span><br><span class="line"><span class="comment">// å½“æ’å…¥å…ƒç´ å¯¼è‡´æŸä¸ªentryçš„é•¿åº¦æ”¹å˜æ—¶</span></span><br><span class="line"><span class="comment">// å¯èƒ½å¼•èµ·åç»­æ‰€æœ‰entryçš„é‡æ–°ç¼–ç </span></span><br></pre></td></tr></table></figure><p><strong>ListPackä¼˜åŠ¿</strong>ï¼š</p><ul><li>æ¯ä¸ªå…ƒç´ ç‹¬ç«‹ç¼–ç ï¼Œé¿å…çº§è”æ›´æ–°</li><li>æ”¯æŒä»å°¾éƒ¨éå†ï¼Œæé«˜æŸäº›æ“ä½œæ•ˆç‡</li></ul><h3 id="å­—å…¸æ‰©å®¹ä¸rehash"><a href="#å­—å…¸æ‰©å®¹ä¸rehash" class="headerlink" title="å­—å…¸æ‰©å®¹ä¸rehash"></a>å­—å…¸æ‰©å®¹ä¸rehash</h3><p>Rediså­—å…¸ä½¿ç”¨å¢é‡å¼rehashé¿å…é˜»å¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¸è¿›å¼rehashå®ç°</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">dictRehash</span><span class="params">(dict *d, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">empty_visits</span> <span class="operator">=</span> n * <span class="number">10</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!dictIsRehashing(d)) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (n-- &amp;&amp; d-&gt;ht[<span class="number">0</span>].used != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// è·³è¿‡ç©ºæ¡¶</span></span><br><span class="line">        <span class="keyword">while</span> (d-&gt;ht[<span class="number">0</span>].table[d-&gt;rehashidx] == NULL) &#123;</span><br><span class="line">            d-&gt;rehashidx++;</span><br><span class="line">            <span class="keyword">if</span> (--empty_visits == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è¿ç§»æ¡¶ä¸­æ‰€æœ‰å…ƒç´ </span></span><br><span class="line">        dictEntry *de = d-&gt;ht[<span class="number">0</span>].table[d-&gt;rehashidx];</span><br><span class="line">        <span class="keyword">while</span> (de) &#123;</span><br><span class="line">            dictEntry *nextde = de-&gt;next;</span><br><span class="line">            unsigned <span class="type">int</span> <span class="variable">h</span> <span class="operator">=</span> dictHashKey(d, de-&gt;key) &amp; d-&gt;ht[<span class="number">1</span>].sizemask;</span><br><span class="line">            de-&gt;next = d-&gt;ht[<span class="number">1</span>].table[h];</span><br><span class="line">            d-&gt;ht[<span class="number">1</span>].table[h] = de;</span><br><span class="line">            d-&gt;ht[<span class="number">0</span>].used--;</span><br><span class="line">            d-&gt;ht[<span class="number">1</span>].used++;</span><br><span class="line">            de = nextde;</span><br><span class="line">        &#125;</span><br><span class="line">        d-&gt;ht[<span class="number">0</span>].table[d-&gt;rehashidx] = NULL;</span><br><span class="line">        d-&gt;rehashidx++;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç½‘ç»œæ¨¡å‹ä¸æ€§èƒ½ä¼˜åŒ–"><a href="#ç½‘ç»œæ¨¡å‹ä¸æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="ç½‘ç»œæ¨¡å‹ä¸æ€§èƒ½ä¼˜åŒ–"></a>ç½‘ç»œæ¨¡å‹ä¸æ€§èƒ½ä¼˜åŒ–</h2><h3 id="Redis-6-0-å¤šçº¿ç¨‹I-O"><a href="#Redis-6-0-å¤šçº¿ç¨‹I-O" class="headerlink" title="Redis 6.0 å¤šçº¿ç¨‹I&#x2F;O"></a>Redis 6.0 å¤šçº¿ç¨‹I&#x2F;O</h3><p>å¤šçº¿ç¨‹åªç”¨äºç½‘ç»œI&#x2F;Oï¼Œå‘½ä»¤æ‰§è¡Œä»æ˜¯å•çº¿ç¨‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¤šçº¿ç¨‹I/Oå¤„ç†æµç¨‹</span></span><br><span class="line"><span class="keyword">void</span> *IOThreadMain(<span class="keyword">void</span> *myid) &#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// ç­‰å¾…ä¸»çº¿ç¨‹åˆ†é…ä»»åŠ¡</span></span><br><span class="line">        pthread_mutex_lock(&amp;io_threads_mutex[id]);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> (io_threads_list[id] &amp;&amp; io_threads_pending[id] == <span class="number">0</span>) &#123;</span><br><span class="line">            pthread_cond_wait(&amp;io_threads_cond[id], &amp;io_threads_mutex[id]);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å¤„ç†è¯»å†™ä»»åŠ¡</span></span><br><span class="line">        listNode *ln;</span><br><span class="line">        listIter li;</span><br><span class="line">        listRewind(io_threads_list[id], &amp;li);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> ((ln = listNext(&amp;li))) &#123;</span><br><span class="line">            client *c = listNodeValue(ln);</span><br><span class="line">            <span class="keyword">if</span> (io_threads_op == IO_THREADS_OP_WRITE) &#123;</span><br><span class="line">                writeToClient(c, <span class="number">0</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (io_threads_op == IO_THREADS_OP_READ) &#123;</span><br><span class="line">                readQueryFromClient(c-&gt;conn);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        io_threads_pending[id] = <span class="number">0</span>;</span><br><span class="line">        pthread_mutex_unlock(&amp;io_threads_mutex[id]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®¢æˆ·ç«¯è¿æ¥ç®¡ç†"><a href="#å®¢æˆ·ç«¯è¿æ¥ç®¡ç†" class="headerlink" title="å®¢æˆ·ç«¯è¿æ¥ç®¡ç†"></a>å®¢æˆ·ç«¯è¿æ¥ç®¡ç†</h3><p><strong>è¿æ¥æ± é…ç½®ä¼˜åŒ–</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Jedisè¿æ¥æ± é…ç½®</span></span><br><span class="line"><span class="type">JedisPoolConfig</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JedisPoolConfig</span>();</span><br><span class="line">config.setMaxTotal(<span class="number">200</span>);                    <span class="comment">// æœ€å¤§è¿æ¥æ•°</span></span><br><span class="line">config.setMaxIdle(<span class="number">50</span>);                      <span class="comment">// æœ€å¤§ç©ºé—²è¿æ¥</span></span><br><span class="line">config.setMinIdle(<span class="number">10</span>);                      <span class="comment">// æœ€å°ç©ºé—²è¿æ¥</span></span><br><span class="line">config.setTestOnBorrow(<span class="literal">true</span>);               <span class="comment">// è·å–è¿æ¥æ—¶æµ‹è¯•</span></span><br><span class="line">config.setTestOnReturn(<span class="literal">true</span>);               <span class="comment">// å½’è¿˜è¿æ¥æ—¶æµ‹è¯•</span></span><br><span class="line">config.setTestWhileIdle(<span class="literal">true</span>);              <span class="comment">// ç©ºé—²æ—¶æµ‹è¯•</span></span><br><span class="line">config.setTimeBetweenEvictionRunsMillis(<span class="number">30000</span>);  <span class="comment">// æ£€æŸ¥é—´éš”</span></span><br><span class="line">config.setNumTestsPerEvictionRun(<span class="number">10</span>);       <span class="comment">// æ¯æ¬¡æ£€æŸ¥è¿æ¥æ•°</span></span><br><span class="line">config.setMinEvictableIdleTimeMillis(<span class="number">60000</span>);     <span class="comment">// æœ€å°ç©ºé—²æ—¶é—´</span></span><br><span class="line"></span><br><span class="line"><span class="type">JedisPool</span> <span class="variable">pool</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JedisPool</span>(config, <span class="string">&quot;localhost&quot;</span>, <span class="number">6379</span>);</span><br></pre></td></tr></table></figure><p><strong>Pipelineä¼˜åŒ–</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Pipelineæ‰¹é‡æ“ä½œ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">batchSet</span><span class="params">(Map&lt;String, String&gt; data)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> (<span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> pool.getResource()) &#123;</span><br><span class="line">        <span class="type">Pipeline</span> <span class="variable">pipeline</span> <span class="operator">=</span> jedis.pipelined();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; entry : data.entrySet()) &#123;</span><br><span class="line">            pipeline.set(entry.getKey(), entry.getValue());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        List&lt;Object&gt; results = pipeline.syncAndReturnAll();</span><br><span class="line">        <span class="comment">// å¤„ç†ç»“æœ</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é«˜çº§æ•°æ®ç±»å‹ä¸åº”ç”¨"><a href="#é«˜çº§æ•°æ®ç±»å‹ä¸åº”ç”¨" class="headerlink" title="é«˜çº§æ•°æ®ç±»å‹ä¸åº”ç”¨"></a>é«˜çº§æ•°æ®ç±»å‹ä¸åº”ç”¨</h2><h3 id="HyperLogLog"><a href="#HyperLogLog" class="headerlink" title="HyperLogLog"></a>HyperLogLog</h3><p>ç”¨äºåŸºæ•°ç»Ÿè®¡ï¼Œå ç”¨å†…å­˜å›ºå®šï¼ˆ12KBï¼‰ï¼Œè¯¯å·®ç‡0.81%ã€‚</p><p><strong>å®ç°åŸç†</strong>ï¼š</p><ul><li>åŸºäºæ¦‚ç‡ç®—æ³•ï¼Œé€šè¿‡è§‚å¯Ÿéšæœºæ•°çš„æœ€å¤§å‰å¯¼é›¶ä¸ªæ•°ä¼°ç®—åŸºæ•°</li><li>ä½¿ç”¨è°ƒå’Œå¹³å‡æ•°å‡å°‘è¯¯å·®</li><li>é€‚ç”¨äºUVç»Ÿè®¡ç­‰åœºæ™¯</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç½‘ç«™UVç»Ÿè®¡</span></span><br><span class="line">PFADD uv:20230815 user1 user2 user3</span><br><span class="line">PFCOUNT uv:20230815                    <span class="comment"># è·å–UVæ•°é‡</span></span><br><span class="line">PFMERGE uv:week uv:20230815 uv:20230816  <span class="comment"># åˆå¹¶å¤šæ—¥æ•°æ®</span></span><br></pre></td></tr></table></figure><h3 id="å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆRedis-Moduleï¼‰"><a href="#å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆRedis-Moduleï¼‰" class="headerlink" title="å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆRedis Moduleï¼‰"></a>å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆRedis Moduleï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Rediså¸ƒéš†è¿‡æ»¤å™¨æ¨¡å—</span></span><br><span class="line">BF.RESERVE myfilter 0.01 1000000       <span class="comment"># åˆ›å»ºè¿‡æ»¤å™¨ï¼Œè¯¯æŠ¥ç‡0.01%ï¼Œé¢„æœŸå…ƒç´ 100ä¸‡</span></span><br><span class="line">BF.ADD myfilter <span class="string">&quot;user123&quot;</span>              <span class="comment"># æ·»åŠ å…ƒç´ </span></span><br><span class="line">BF.EXISTS myfilter <span class="string">&quot;user123&quot;</span>           <span class="comment"># æ£€æŸ¥å…ƒç´ æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">BF.MADD myfilter item1 item2 item3     <span class="comment"># æ‰¹é‡æ·»åŠ </span></span><br><span class="line">BF.MEXISTS myfilter item1 item2 item3  <span class="comment"># æ‰¹é‡æ£€æŸ¥</span></span><br></pre></td></tr></table></figure><h3 id="Geoåœ°ç†ä½ç½®"><a href="#Geoåœ°ç†ä½ç½®" class="headerlink" title="Geoåœ°ç†ä½ç½®"></a>Geoåœ°ç†ä½ç½®</h3><p>åŸºäºSorted Setå®ç°ï¼Œä½¿ç”¨GeoHashç®—æ³•ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ·»åŠ åœ°ç†ä½ç½®</span></span><br><span class="line">GEOADD cities 116.397128 39.916527 <span class="string">&quot;åŒ—äº¬&quot;</span> 121.473701 31.230416 <span class="string">&quot;ä¸Šæµ·&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¡ç®—è·ç¦»</span></span><br><span class="line">GEODIST cities <span class="string">&quot;åŒ—äº¬&quot;</span> <span class="string">&quot;ä¸Šæµ·&quot;</span> km</span><br><span class="line"></span><br><span class="line"><span class="comment"># èŒƒå›´æŸ¥è¯¢</span></span><br><span class="line">GEORADIUS cities 116.397128 39.916527 1000 km WITHDIST WITHCOORD</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ ¹æ®æˆå‘˜æŸ¥è¯¢</span></span><br><span class="line">GEORADIUSBYMEMBER cities <span class="string">&quot;åŒ—äº¬&quot;</span> 1000 km</span><br></pre></td></tr></table></figure><h2 id="å®‰å…¨æ€§é—®é¢˜ä¸é˜²æŠ¤"><a href="#å®‰å…¨æ€§é—®é¢˜ä¸é˜²æŠ¤" class="headerlink" title="å®‰å…¨æ€§é—®é¢˜ä¸é˜²æŠ¤"></a>å®‰å…¨æ€§é—®é¢˜ä¸é˜²æŠ¤</h2><h3 id="å¸¸è§å®‰å…¨æ¼æ´"><a href="#å¸¸è§å®‰å…¨æ¼æ´" class="headerlink" title="å¸¸è§å®‰å…¨æ¼æ´"></a>å¸¸è§å®‰å…¨æ¼æ´</h3><p><strong>å‘½ä»¤æ³¨å…¥</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é”™è¯¯åšæ³•ï¼šç›´æ¥æ‹¼æ¥ç”¨æˆ·è¾“å…¥</span></span><br><span class="line"><span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;user:&quot;</span> + userInput;  <span class="comment">// userInputå¯èƒ½åŒ…å«æ¶æ„å‘½ä»¤</span></span><br><span class="line">jedis.eval(<span class="string">&quot;return redis.call(&#x27;get&#x27;, &#x27;&quot;</span> + key + <span class="string">&quot;&#x27;)&quot;</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ­£ç¡®åšæ³•ï¼šä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢</span></span><br><span class="line">jedis.eval(<span class="string">&quot;return redis.call(&#x27;get&#x27;, KEYS[1])&quot;</span>, <span class="number">1</span>, key);</span><br></pre></td></tr></table></figure><p><strong>æœªæˆæƒè®¿é—®</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># redis.confå®‰å…¨é…ç½®</span></span><br><span class="line"><span class="built_in">bind</span> 127.0.0.1                        <span class="comment"># ç»‘å®šæŒ‡å®šIP</span></span><br><span class="line">requirepass your_password              <span class="comment"># è®¾ç½®å¯†ç </span></span><br><span class="line">protected-mode <span class="built_in">yes</span>                     <span class="comment"># å¼€å¯ä¿æŠ¤æ¨¡å¼</span></span><br><span class="line">port 0                                <span class="comment"># ç¦ç”¨é»˜è®¤ç«¯å£</span></span><br><span class="line">port 6380                             <span class="comment"># ä½¿ç”¨éæ ‡å‡†ç«¯å£</span></span><br></pre></td></tr></table></figure><p><strong>å±é™©å‘½ä»¤ç¦ç”¨</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é‡å‘½åå±é™©å‘½ä»¤</span></span><br><span class="line">rename-command FLUSHDB <span class="string">&quot;&quot;</span>             <span class="comment"># ç¦ç”¨FLUSHDB</span></span><br><span class="line">rename-command FLUSHALL <span class="string">&quot;&quot;</span>            <span class="comment"># ç¦ç”¨FLUSHALL</span></span><br><span class="line">rename-command SHUTDOWN <span class="string">&quot;REDIS_SHUTDOWN&quot;</span>  <span class="comment"># é‡å‘½åSHUTDOWN</span></span><br><span class="line">rename-command CONFIG <span class="string">&quot;REDIS_CONFIG&quot;</span>   <span class="comment"># é‡å‘½åCONFIG</span></span><br></pre></td></tr></table></figure><h3 id="ACLè®¿é—®æ§åˆ¶ï¼ˆRedis-6-0-ï¼‰"><a href="#ACLè®¿é—®æ§åˆ¶ï¼ˆRedis-6-0-ï¼‰" class="headerlink" title="ACLè®¿é—®æ§åˆ¶ï¼ˆRedis 6.0+ï¼‰"></a>ACLè®¿é—®æ§åˆ¶ï¼ˆRedis 6.0+ï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºç”¨æˆ·</span></span><br><span class="line">ACL SETUSER alice on &gt;password123 ~cached:* +get +<span class="built_in">set</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç”¨æˆ·æƒé™</span></span><br><span class="line">ACL LIST</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤ç”¨æˆ·</span></span><br><span class="line">ACL DELUSER alice</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥æƒé™</span></span><br><span class="line">AUTH alice password123</span><br></pre></td></tr></table></figure><h2 id="ç›‘æ§ä¸è¿ç»´"><a href="#ç›‘æ§ä¸è¿ç»´" class="headerlink" title="ç›‘æ§ä¸è¿ç»´"></a>ç›‘æ§ä¸è¿ç»´</h2><h3 id="å…³é”®ç›‘æ§æŒ‡æ ‡"><a href="#å…³é”®ç›‘æ§æŒ‡æ ‡" class="headerlink" title="å…³é”®ç›‘æ§æŒ‡æ ‡"></a>å…³é”®ç›‘æ§æŒ‡æ ‡</h3><p><strong>æ€§èƒ½æŒ‡æ ‡</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é€šè¿‡INFOå‘½ä»¤è·å–</span></span><br><span class="line">INFO stats</span><br><span class="line"><span class="comment"># å…³æ³¨æŒ‡æ ‡ï¼š</span></span><br><span class="line"><span class="comment"># - instantaneous_ops_per_sec: QPS</span></span><br><span class="line"><span class="comment"># - keyspace_hits/keyspace_misses: å‘½ä¸­ç‡</span></span><br><span class="line"><span class="comment"># - used_cpu_sys/used_cpu_user: CPUä½¿ç”¨ç‡</span></span><br><span class="line"><span class="comment"># - connected_clients: è¿æ¥æ•°</span></span><br><span class="line"><span class="comment"># - blocked_clients: é˜»å¡è¿æ¥æ•°</span></span><br></pre></td></tr></table></figure><p><strong>å†…å­˜æŒ‡æ ‡</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">INFO memory</span><br><span class="line"><span class="comment"># å…³æ³¨æŒ‡æ ‡ï¼š</span></span><br><span class="line"><span class="comment"># - used_memory: å·²ä½¿ç”¨å†…å­˜</span></span><br><span class="line"><span class="comment"># - used_memory_rss: ç‰©ç†å†…å­˜å ç”¨</span></span><br><span class="line"><span class="comment"># - mem_fragmentation_ratio: å†…å­˜ç¢ç‰‡ç‡</span></span><br><span class="line"><span class="comment"># - used_memory_peak: å†…å­˜ä½¿ç”¨å³°å€¼</span></span><br></pre></td></tr></table></figure><p><strong>æŒä¹…åŒ–æŒ‡æ ‡</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">INFO persistence</span><br><span class="line"><span class="comment"># å…³æ³¨æŒ‡æ ‡ï¼š</span></span><br><span class="line"><span class="comment"># - rdb_last_save_time: æœ€åRDBä¿å­˜æ—¶é—´</span></span><br><span class="line"><span class="comment"># - aof_last_rewrite_time_sec: AOFé‡å†™è€—æ—¶</span></span><br><span class="line"><span class="comment"># - aof_current_size: AOFæ–‡ä»¶å¤§å°</span></span><br></pre></td></tr></table></figure><h3 id="æ•…éšœæ’æŸ¥å¸¸ç”¨å‘½ä»¤"><a href="#æ•…éšœæ’æŸ¥å¸¸ç”¨å‘½ä»¤" class="headerlink" title="æ•…éšœæ’æŸ¥å¸¸ç”¨å‘½ä»¤"></a>æ•…éšœæ’æŸ¥å¸¸ç”¨å‘½ä»¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®¢æˆ·ç«¯è¿æ¥ä¿¡æ¯</span></span><br><span class="line">CLIENT LIST</span><br><span class="line">CLIENT INFO</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ…¢æŸ¥è¯¢åˆ†æ</span></span><br><span class="line">SLOWLOG GET 10</span><br><span class="line">CONFIG GET slowlog-log-slower-than</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤§keyæŸ¥æ‰¾</span></span><br><span class="line">MEMORY USAGE keyname</span><br><span class="line">redis-cli --bigkeys</span><br><span class="line"></span><br><span class="line"><span class="comment"># çƒ­ç‚¹keyåˆ†æ</span></span><br><span class="line">redis-cli --hotkeys</span><br><span class="line"></span><br><span class="line"><span class="comment"># å»¶è¿Ÿç›‘æ§</span></span><br><span class="line">LATENCY HISTORY <span class="built_in">command</span></span><br><span class="line">CONFIG SET latency-monitor-threshold 100</span><br></pre></td></tr></table></figure><h2 id="ç‰¹æ®Šåº”ç”¨åœºæ™¯"><a href="#ç‰¹æ®Šåº”ç”¨åœºæ™¯" class="headerlink" title="ç‰¹æ®Šåº”ç”¨åœºæ™¯"></a>ç‰¹æ®Šåº”ç”¨åœºæ™¯</h2><h3 id="åˆ†å¸ƒå¼é™æµ"><a href="#åˆ†å¸ƒå¼é™æµ" class="headerlink" title="åˆ†å¸ƒå¼é™æµ"></a>åˆ†å¸ƒå¼é™æµ</h3><p><strong>å›ºå®šçª—å£é™æµ</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisRateLimiter</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isAllowed</span><span class="params">(String key, <span class="type">int</span> limit, <span class="type">int</span> window)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">current</span> <span class="operator">=</span> System.currentTimeMillis() / <span class="number">1000</span> / window;</span><br><span class="line">        <span class="type">String</span> <span class="variable">windowKey</span> <span class="operator">=</span> key + <span class="string">&quot;:&quot;</span> + current;</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">script</span> <span class="operator">=</span> </span><br><span class="line">            <span class="string">&quot;local count = redis.call(&#x27;incr&#x27;, KEYS[1]) &quot;</span> +</span><br><span class="line">            <span class="string">&quot;if count == 1 then &quot;</span> +</span><br><span class="line">            <span class="string">&quot;  redis.call(&#x27;expire&#x27;, KEYS[1], ARGV[1]) &quot;</span> +</span><br><span class="line">            <span class="string">&quot;end &quot;</span> +</span><br><span class="line">            <span class="string">&quot;return count&quot;</span>;</span><br><span class="line">            </span><br><span class="line">        <span class="type">Long</span> <span class="variable">count</span> <span class="operator">=</span> (Long) jedis.eval(script, Arrays.asList(windowKey), </span><br><span class="line">                                      Arrays.asList(String.valueOf(window)));</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> count &lt;= limit;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ»‘åŠ¨çª—å£é™æµ</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">slidingWindowLimit</span><span class="params">(String key, <span class="type">int</span> limit, <span class="type">int</span> window)</span> &#123;</span><br><span class="line">    <span class="type">long</span> <span class="variable">now</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    <span class="type">long</span> <span class="variable">windowStart</span> <span class="operator">=</span> now - window * <span class="number">1000</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="type">String</span> <span class="variable">script</span> <span class="operator">=</span> </span><br><span class="line">        <span class="string">&quot;redis.call(&#x27;zremrangebyscore&#x27;, KEYS[1], 0, ARGV[1]) &quot;</span> +</span><br><span class="line">        <span class="string">&quot;local count = redis.call(&#x27;zcard&#x27;, KEYS[1]) &quot;</span> +</span><br><span class="line">        <span class="string">&quot;if count &lt; tonumber(ARGV[2]) then &quot;</span> +</span><br><span class="line">        <span class="string">&quot;  redis.call(&#x27;zadd&#x27;, KEYS[1], ARGV[3], ARGV[3]) &quot;</span> +</span><br><span class="line">        <span class="string">&quot;  redis.call(&#x27;expire&#x27;, KEYS[1], ARGV[4]) &quot;</span> +</span><br><span class="line">        <span class="string">&quot;  return 1 &quot;</span> +</span><br><span class="line">        <span class="string">&quot;else &quot;</span> +</span><br><span class="line">        <span class="string">&quot;  return 0 &quot;</span> +</span><br><span class="line">        <span class="string">&quot;end&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="type">Long</span> <span class="variable">result</span> <span class="operator">=</span> (Long) jedis.eval(script, Arrays.asList(key),</span><br><span class="line">        Arrays.asList(String.valueOf(windowStart), String.valueOf(limit),</span><br><span class="line">                     String.valueOf(now), String.valueOf(window)));</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> result == <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åˆ†å¸ƒå¼Session"><a href="#åˆ†å¸ƒå¼Session" class="headerlink" title="åˆ†å¸ƒå¼Session"></a>åˆ†å¸ƒå¼Session</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisSessionManager</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createSession</span><span class="params">(String sessionId, String userId, <span class="type">int</span> timeout)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;session:&quot;</span> + sessionId;</span><br><span class="line">        Map&lt;String, Object&gt; sessionData = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        sessionData.put(<span class="string">&quot;userId&quot;</span>, userId);</span><br><span class="line">        sessionData.put(<span class="string">&quot;createTime&quot;</span>, System.currentTimeMillis());</span><br><span class="line">        </span><br><span class="line">        redisTemplate.opsForHash().putAll(key, sessionData);</span><br><span class="line">        redisTemplate.expire(key, timeout, TimeUnit.SECONDS);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValidSession</span><span class="params">(String sessionId)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;session:&quot;</span> + sessionId;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.hasKey(key);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">renewSession</span><span class="params">(String sessionId, <span class="type">int</span> timeout)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;session:&quot;</span> + sessionId;</span><br><span class="line">        <span class="keyword">if</span> (redisTemplate.hasKey(key)) &#123;</span><br><span class="line">            redisTemplate.expire(key, timeout, TimeUnit.SECONDS);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ¶ˆæ¯é˜Ÿåˆ—å®ç°"><a href="#æ¶ˆæ¯é˜Ÿåˆ—å®ç°" class="headerlink" title="æ¶ˆæ¯é˜Ÿåˆ—å®ç°"></a>æ¶ˆæ¯é˜Ÿåˆ—å®ç°</h3><p><strong>åŸºäºListçš„ç®€å•é˜Ÿåˆ—</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisQueue</span> &#123;</span><br><span class="line">    <span class="comment">// ç”Ÿäº§è€…</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">produce</span><span class="params">(String queue, String message)</span> &#123;</span><br><span class="line">        jedis.lpush(queue, message);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ¶ˆè´¹è€…ï¼ˆé˜»å¡å¼ï¼‰</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">consume</span><span class="params">(String queue, <span class="type">int</span> timeout)</span> &#123;</span><br><span class="line">        List&lt;String&gt; result = jedis.brpop(timeout, queue);</span><br><span class="line">        <span class="keyword">return</span> result != <span class="literal">null</span> ? result.get(<span class="number">1</span>) : <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åŸºäºStreamçš„æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼ˆRedis 5.0+ï¼‰ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç”Ÿäº§æ¶ˆæ¯</span></span><br><span class="line"><span class="string">XADD</span> <span class="string">mystream</span> <span class="string">*</span> <span class="string">field1</span> <span class="string">value1</span> <span class="string">field2</span> <span class="string">value2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºæ¶ˆè´¹è€…ç»„</span></span><br><span class="line"><span class="string">XGROUP</span> <span class="string">CREATE</span> <span class="string">mystream</span> <span class="string">mygroup</span> <span class="string">$</span> <span class="string">MKSTREAM</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¶ˆè´¹æ¶ˆæ¯</span></span><br><span class="line"><span class="string">XREADGROUP</span> <span class="string">GROUP</span> <span class="string">mygroup</span> <span class="string">consumer1</span> <span class="string">COUNT</span> <span class="number">10</span> <span class="string">STREAMS</span> <span class="string">mystream</span> <span class="string">&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¡®è®¤æ¶ˆæ¯</span></span><br><span class="line"><span class="string">XACK</span> <span class="string">mystream</span> <span class="string">mygroup</span> <span class="string">message_id</span></span><br></pre></td></tr></table></figure><h3 id="å»¶æ—¶é˜Ÿåˆ—"><a href="#å»¶æ—¶é˜Ÿåˆ—" class="headerlink" title="å»¶æ—¶é˜Ÿåˆ—"></a>å»¶æ—¶é˜Ÿåˆ—</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisDelayQueue</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addDelayTask</span><span class="params">(String task, <span class="type">long</span> delayTime)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">executeTime</span> <span class="operator">=</span> System.currentTimeMillis() + delayTime;</span><br><span class="line">        jedis.zadd(<span class="string">&quot;delay_queue&quot;</span>, executeTime, task);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">getReadyTasks</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">now</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        Set&lt;String&gt; tasks = jedis.zrangeByScore(<span class="string">&quot;delay_queue&quot;</span>, <span class="number">0</span>, now);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!tasks.isEmpty()) &#123;</span><br><span class="line">            <span class="comment">// åŸå­æ€§åˆ é™¤å·²è·å–çš„ä»»åŠ¡</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">script</span> <span class="operator">=</span> </span><br><span class="line">                <span class="string">&quot;local tasks = redis.call(&#x27;zrangebyscore&#x27;, KEYS[1], 0, ARGV[1]) &quot;</span> +</span><br><span class="line">                <span class="string">&quot;if #tasks &gt; 0 then &quot;</span> +</span><br><span class="line">                <span class="string">&quot;  redis.call(&#x27;zremrangebyscore&#x27;, KEYS[1], 0, ARGV[1]) &quot;</span> +</span><br><span class="line">                <span class="string">&quot;end &quot;</span> +</span><br><span class="line">                <span class="string">&quot;return tasks&quot;</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">            List&lt;String&gt; result = (List&lt;String&gt;) jedis.eval(script, </span><br><span class="line">                Arrays.asList(<span class="string">&quot;delay_queue&quot;</span>), Arrays.asList(String.valueOf(now)));</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> Collections.emptyList();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ€§èƒ½è°ƒä¼˜æŠ€å·§"><a href="#æ€§èƒ½è°ƒä¼˜æŠ€å·§" class="headerlink" title="æ€§èƒ½è°ƒä¼˜æŠ€å·§"></a>æ€§èƒ½è°ƒä¼˜æŠ€å·§</h2><h3 id="å†…å­˜ä¼˜åŒ–"><a href="#å†…å­˜ä¼˜åŒ–" class="headerlink" title="å†…å­˜ä¼˜åŒ–"></a>å†…å­˜ä¼˜åŒ–</h3><p><strong>ä½¿ç”¨Hashå­˜å‚¨å°å¯¹è±¡</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸æ¨èï¼šä¸ºæ¯ä¸ªç”¨æˆ·å­—æ®µå•ç‹¬è®¾ç½®key</span></span><br><span class="line">jedis.set(<span class="string">&quot;user:1001:name&quot;</span>, <span class="string">&quot;å¼ ä¸‰&quot;</span>);</span><br><span class="line">jedis.set(<span class="string">&quot;user:1001:age&quot;</span>, <span class="string">&quot;25&quot;</span>);</span><br><span class="line">jedis.set(<span class="string">&quot;user:1001:email&quot;</span>, <span class="string">&quot;zhang@example.com&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨èï¼šä½¿ç”¨Hashå­˜å‚¨</span></span><br><span class="line">jedis.hset(<span class="string">&quot;user:1001&quot;</span>, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;å¼ ä¸‰&quot;</span>);</span><br><span class="line">jedis.hset(<span class="string">&quot;user:1001&quot;</span>, <span class="string">&quot;age&quot;</span>, <span class="string">&quot;25&quot;</span>);</span><br><span class="line">jedis.hset(<span class="string">&quot;user:1001&quot;</span>, <span class="string">&quot;email&quot;</span>, <span class="string">&quot;zhang@example.com&quot;</span>);</span><br></pre></td></tr></table></figure><p><strong>åˆç†è®¾ç½®è¿‡æœŸæ—¶é—´</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é¿å…åŒæ—¶è¿‡æœŸå¯¼è‡´é›ªå´©</span></span><br><span class="line"><span class="type">int</span> <span class="variable">baseExpire</span> <span class="operator">=</span> <span class="number">3600</span>;  <span class="comment">// 1å°æ—¶</span></span><br><span class="line"><span class="type">int</span> <span class="variable">randomExpire</span> <span class="operator">=</span> baseExpire + <span class="keyword">new</span> <span class="title class_">Random</span>().nextInt(<span class="number">300</span>);  <span class="comment">// å¢åŠ 0-5åˆ†é’Ÿéšæœºæ—¶é—´</span></span><br><span class="line">jedis.setex(key, randomExpire, value);</span><br></pre></td></tr></table></figure><h3 id="ç½‘ç»œä¼˜åŒ–"><a href="#ç½‘ç»œä¼˜åŒ–" class="headerlink" title="ç½‘ç»œä¼˜åŒ–"></a>ç½‘ç»œä¼˜åŒ–</h3><p><strong>æ‰¹é‡æ“ä½œä¼˜åŒ–</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨Pipeline</span></span><br><span class="line"><span class="type">Pipeline</span> <span class="variable">pipeline</span> <span class="operator">=</span> jedis.pipelined();</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">    pipeline.set(<span class="string">&quot;key&quot;</span> + i, <span class="string">&quot;value&quot;</span> + i);</span><br><span class="line">&#125;</span><br><span class="line">pipeline.sync();</span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆ–ä½¿ç”¨åŸç”Ÿæ‰¹é‡å‘½ä»¤</span></span><br><span class="line">Map&lt;String, String&gt; batch = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"><span class="comment">// ... å¡«å……æ•°æ®</span></span><br><span class="line">jedis.mset(flattenMap(batch));</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="CPUä¼˜åŒ–"><a href="#CPUä¼˜åŒ–" class="headerlink" title="CPUä¼˜åŒ–"></a>CPUä¼˜åŒ–</h3><p><strong>Luaè„šæœ¬å‡å°‘ç½‘ç»œå¾€è¿”</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">-- åŸå­æ€§å¢åŠ åº“å­˜</span><br><span class="line"><span class="type">local</span> <span class="variable">current</span> <span class="operator">=</span> redis.call(<span class="string">&#x27;get&#x27;</span>, KEYS[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">if</span> current == <span class="literal">false</span> then</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>  -- keyä¸å­˜åœ¨</span><br><span class="line"><span class="type">end</span></span><br><span class="line"></span><br><span class="line"><span class="variable">current</span> <span class="operator">=</span> tonumber(current)</span><br><span class="line"><span class="keyword">if</span> current &gt;= tonumber(ARGV[<span class="number">1</span>]) then</span><br><span class="line">    redis.call(<span class="string">&#x27;decrby&#x27;</span>, KEYS[<span class="number">1</span>], ARGV[<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">return</span> current - tonumber(ARGV[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> -<span class="number">2</span>  -- åº“å­˜ä¸è¶³</span><br><span class="line">end</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mysql </tag>
            
            <tag> Linux </tag>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2025/09/11/hello-world/"/>
      <url>/2025/09/11/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
